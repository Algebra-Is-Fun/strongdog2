var passiveEventsAreSupported=null,crossPromoJSIsReady=!1,crossPromoConfigName="",jsFunctions={isFullscreen:function(){try{return null!=document.fullscreenElement||null!=document.mozFullScreenElement||null!=document.webkitFullscreenElement||null!=document.msFullscreenElement}catch(t){return!1}},goFullscreen:function(t,e){try{if(null!=document.fullscreenElement||null!=document.mozFullScreenElement||null!=document.webkitFullscreenElement||null!=document.msFullscreenElement)return void(t&&(document.cancelFullScreen?document.cancelFullScreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitCancelFullScreen?document.webkitCancelFullScreen():document.msCancelFullScreen&&document.msCancelFullScreen()));var i=!1;function n(){"orientation"in screen?"lock"in screen.orientation?screen.orientation.lock("landscape").catch(function(){i=!0}):"lockOrientation"in screen.orientation?screen.orientation.lockOrientation("landscape"):"mozLockOrientation"in screen.orientation&&screen.orientation.mozLockOrientation("landscape"):"mozOrientation"in screen?"mozLock"in screen.mozOrientation?screen.orientation.mozLock("landscape").catch(function(){i=!0}):"mozLockOrientation"in screen.mozOrientation&&screen.orientation.mozLockOrientation("landscape"):"msOrientation"in screen?"msLock"in screen.msOrientation?screen.orientation.msLock("landscape").catch(function(){i=!0}):"msLockOrientation"in screen.msOrientation&&screen.orientation.msLockOrientation("landscape"):"webkitOrientation"in screen&&("webkitLock"in screen.webkitOrientation?screen.orientation.webkitLock("landscape").catch(function(){i=!0}):"webkitLockOrientation"in screen.webkitOrientation&&screen.orientation.webkitLockOrientation("landscape"))}var r=document.body;if(r.requestFullscreen){var s=r.requestFullscreen();null!=s&&s.catch(function(){}).then(function(){null!=e&&e(),i&&n()})}else r.mozRequestFullScreen?r.mozRequestFullScreen():r.webkitRequestFullscreen?r.webkitRequestFullscreen():r.msRequestFullscreen&&r.msRequestFullscreen();n()}catch(t){}},orientationLockSupported:function(){try{return"orientation"in screen||"mozOrientation"in screen||"msOrientation"in screen||"webkitOrientation"in screen}catch(t){return!1}},getPassiveEventListenerVar:function(){if(null!=passiveEventsAreSupported)return!!passiveEventsAreSupported&&{passive:!1};try{var t={get passive(){passiveEventsAreSupported=!0}};window.addEventListener("test",t,t),window.removeEventListener("test",t,t)}catch(t){passiveEventsAreSupported=!1}return!!passiveEventsAreSupported&&{passive:!1}},loadJS:function(t,e,i){var n=document.createElement("script");n.setAttribute("src",t),document.getElementsByTagName("head")[0].appendChild(n),n.onload=e,null!=i&&(n.onerror=i)},initGA:function(){function s(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],s("js",new Date),s("config","UA-48290579-2",{anonymize_ip:!0}),jsFunctions.gaSendEvent=function(t,e,i,n,r){s("event",e,{event_category:t,event_label:i,value:n,non_interaction:r})},jsFunctions.gaSendError=function(t){s("event","exception",{description:t})}},initCrossPromo:function(t){jsFunctions.loadJS("https://florianvanstrien.nl/crosspromo/wagtail_crosspromo.js",function(){try{crossPromoConfig("The Final Earth 2",t),crossPromoJSIsReady=!0,crossPromoConfigName=t}catch(t){crossPromoJSIsReady=!1}})},showCrossPromoDisplay:function(t){crossPromoJSIsReady?crossPromoOpen():t&&window.location.assign("https://florianvanstrien.nl/crosspromo/index.html?name=The%20Final%20Earth%202&config="+crossPromoConfigName)},crossPromoIsVisible:function(){return!!crossPromoJSIsReady&&crossPromoVisible()},crossPromoClose:function(){crossPromoJSIsReady&&window.closeCrossPromo()},crossPromoInited:function(){return!!crossPromoJSIsReady&&crossPromoIsReady()},getGPUString:function(){var t=document.createElement("canvas");t.setAttribute("width","1"),t.setAttribute("height","1"),document.body.appendChild(t);var e=document.getElementsByTagName("canvas"),i=e[0].getContext("webgl",{stencil:!0});if(e[0].parentNode.removeChild(e[0]),!i)return"";var n=i.getExtension("WEBGL_debug_renderer_info");return null!=n?i.getParameter(n.UNMASKED_RENDERER_WEBGL):""},maliDetect:function(){var t=document.createElement("canvas");t.setAttribute("width","1"),t.setAttribute("height","1"),document.body.appendChild(t);var e=document.getElementsByTagName("canvas"),i=e[0].getContext("webgl",{stencil:!0});if(e[0].parentNode.removeChild(e[0]),!i)return!1;var n,r=i.getExtension("WEBGL_debug_renderer_info");return null!=r&&(-1!=(n=i.getParameter(r.UNMASKED_RENDERER_WEBGL)).search("Mali-400")||(-1!=n.search("Mali-T720")||(-1!=n.search("Mali T720")||(-1!=n.search("Mali-T860 MP2")||-1!=n.search("Mali T860 MP2")))))},fontsPrepareVietnamese:function(){for(var t=Object.keys(PIXI.BitmapFont.available),e=0;e<t.length;e++){PIXI.BitmapFont.available[t[e]];var i=Object.create(PIXI.BitmapFont.available[t[e]]);i.lineHeight=i.lineHeight+("Arial10"==t[e]||"Arial16"==t[e]?2:1),PIXI.BitmapFont.available[t[e]+"_vi"]=i}}};!function(t){"use strict";var u,c=t.Uint8Array,e=t.HTMLCanvasElement,i=e&&e.prototype,l=/\s*;\s*base64\s*(?:;|$)/i,h="toDataURL";c&&(u=new c([62,-1,-1,-1,63,52,53,54,55,56,57,58,59,60,61,-1,-1,-1,0,-1,-1,-1,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,-1,-1,-1,-1,-1,-1,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51])),!e||i.toBlob&&i.toBlobHD||(i.toBlob||(i.toBlob=function(t,e){if(e=e||"image/png",this.mozGetAsFile)t(this.mozGetAsFile("canvas",e));else if(this.msToBlob&&/^\s*image\/png\s*(?:$|;)/i.test(e))t(this.msToBlob());else{var i,n=Array.prototype.slice.call(arguments,1),r=this[h].apply(this,n),s=r.indexOf(","),o=r.substring(s+1),a=l.test(r.substring(0,s));Blob.fake?((i=new Blob).encoding=a?"base64":"URI",i.data=o,i.size=o.length):c&&(i=a?new Blob([function(t){for(var e,i,n=t.length,r=new c(n/4*3|0),s=0,o=0,a=[0,0],l=0,h=0;n--;)i=t.charCodeAt(s++),255!==(e=u[i-43])&&void 0!==e&&(a[1]=a[0],a[0]=i,h=h<<6|e,4===++l&&(r[o++]=h>>>16,61!==a[1]&&(r[o++]=h>>>8),61!==a[0]&&(r[o++]=h),l=0));return r}(o)],{type:e}):new Blob([decodeURIComponent(o)],{type:e})),t(i)}}),!i.toBlobHD&&i.toDataURLHD?i.toBlobHD=function(){h="toDataURLHD";var t=this.toBlob();return h="toDataURL",t}:i.toBlobHD=i.toBlob)}("undefined"!=typeof self&&self||"undefined"!=typeof window&&window||this.content||this);var saveAs=saveAs||function(a){"use strict";if(!(void 0===a||"undefined"!=typeof navigator&&/MSIE [1-9]\./.test(navigator.userAgent))){var t=a.document,l=function(){return a.URL||a.webkitURL||a},h=t.createElementNS("http://www.w3.org/1999/xhtml","a"),u="download"in h,c=/constructor/i.test(a.HTMLElement)||a.safari,d=/CriOS\/[\d]+/.test(navigator.userAgent),p=function(t){(a.setImmediate||a.setTimeout)(function(){throw t},0)},f=function(t){setTimeout(function(){"string"==typeof t?l().revokeObjectURL(t):t.remove()},4e4)},g=function(t){return/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(t.type)?new Blob([String.fromCharCode(65279),t],{type:t.type}):t},n=function(t,e,i){i||(t=g(t));function n(){!function(t,e,i){for(var n=(e=[].concat(e)).length;n--;){var r=t["on"+e[n]];if("function"==typeof r)try{r.call(t,i||t)}catch(t){p(t)}}}(s,"writestart progress write writeend".split(" "))}var r,s=this,o="application/octet-stream"===t.type;if(s.readyState=s.INIT,u)return r=l().createObjectURL(t),void setTimeout(function(){h.href=r,h.download=e,function(t){var e=new MouseEvent("click");t.dispatchEvent(e)}(h),n(),f(r),s.readyState=s.DONE});!function(){if((d||o&&c)&&a.FileReader){var e=new FileReader;return e.onloadend=function(){var t=d?e.result:e.result.replace(/^data:[^;]*;/,"data:attachment/file;");a.open(t,"_blank")||(a.location.href=t),t=void 0,s.readyState=s.DONE,n()},e.readAsDataURL(t),s.readyState=s.INIT}(r=r||l().createObjectURL(t),o)?a.location.href=r:a.open(r,"_blank")||(a.location.href=r);s.readyState=s.DONE,n(),f(r)}()},e=n.prototype;return"undefined"!=typeof navigator&&navigator.msSaveOrOpenBlob?function(t,e,i){return e=e||t.name||"download",i||(t=g(t)),navigator.msSaveOrOpenBlob(t,e)}:(e.abort=function(){},e.readyState=e.INIT=0,e.WRITING=1,e.DONE=2,e.error=e.onwritestart=e.onprogress=e.onwrite=e.onabort=e.onerror=e.onwriteend=null,function(t,e,i){return new n(t,e||t.name||"download",i)})}}("undefined"!=typeof self&&self||"undefined"!=typeof window&&window||this);"undefined"!=typeof module&&module.exports?module.exports.saveAs=saveAs:"undefined"!=typeof define&&null!==define&&null!==define.amd&&define("FileSaver.js",function(){return saveAs}),jsFunctions.saveAs=saveAs,function(t){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).localforage=t()}}(function(){return function s(o,a,l){function h(e,t){if(!a[e]){if(!o[e]){var i="function"==typeof require&&require;if(!t&&i)return i(e,!0);if(u)return u(e,!0);var n=new Error("Cannot find module '"+e+"'");throw n.code="MODULE_NOT_FOUND",n}var r=a[e]={exports:{}};o[e][0].call(r.exports,function(t){return h(o[e][1][t]||t)},r,r.exports,s,o,a,l)}return a[e].exports}for(var u="function"==typeof require&&require,t=0;t<l.length;t++)h(l[t]);return h}({1:[function(t,u,e){(function(e){"use strict";function i(){l=!0;for(var t,e,i=h.length;i;){for(e=h,h=[],t=-1;++t<i;)e[t]();i=h.length}l=!1}var n,t=e.MutationObserver||e.WebKitMutationObserver;if(t){var r=0,s=new t(i),o=e.document.createTextNode("");s.observe(o,{characterData:!0}),n=function(){o.data=r=++r%2}}else if(e.setImmediate||void 0===e.MessageChannel)n="document"in e&&"onreadystatechange"in e.document.createElement("script")?function(){var t=e.document.createElement("script");t.onreadystatechange=function(){i(),t.onreadystatechange=null,t.parentNode.removeChild(t),t=null},e.document.documentElement.appendChild(t)}:function(){setTimeout(i,0)};else{var a=new e.MessageChannel;a.port1.onmessage=i,n=function(){a.port2.postMessage(0)}}var l,h=[];u.exports=function(t){1!==h.push(t)||l||n()}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],2:[function(t,e,i){"use strict";function h(){}function n(t){if("function"!=typeof t)throw new TypeError("resolver must be a function");this.state=f,this.queue=[],this.outcome=void 0,t!==h&&a(this,t)}function r(t,e,i){this.promise=t,"function"==typeof e&&(this.onFulfilled=e,this.callFulfilled=this.otherCallFulfilled),"function"==typeof i&&(this.onRejected=i,this.callRejected=this.otherCallRejected)}function s(e,i,n){u(function(){var t;try{t=i(n)}catch(t){return c.reject(e,t)}t===e?c.reject(e,new TypeError("Cannot resolve promise with itself")):c.resolve(e,t)})}function o(t){var e=t&&t.then;if(t&&("object"==typeof t||"function"==typeof t)&&"function"==typeof e)return function(){e.apply(t,arguments)}}function a(e,t){function i(t){r||(r=!0,c.reject(e,t))}function n(t){r||(r=!0,c.resolve(e,t))}var r=!1,s=l(function(){t(n,i)});"error"===s.status&&i(s.value)}function l(t,e){var i={};try{i.value=t(e),i.status="success"}catch(t){i.status="error",i.value=t}return i}var u=t(1),c={},d=["REJECTED"],p=["FULFILLED"],f=["PENDING"];(e.exports=n).prototype.catch=function(t){return this.then(null,t)},n.prototype.then=function(t,e){if("function"!=typeof t&&this.state===p||"function"!=typeof e&&this.state===d)return this;var i=new this.constructor(h);return this.state!==f?s(i,this.state===p?t:e,this.outcome):this.queue.push(new r(i,t,e)),i},r.prototype.callFulfilled=function(t){c.resolve(this.promise,t)},r.prototype.otherCallFulfilled=function(t){s(this.promise,this.onFulfilled,t)},r.prototype.callRejected=function(t){c.reject(this.promise,t)},r.prototype.otherCallRejected=function(t){s(this.promise,this.onRejected,t)},c.resolve=function(t,e){var i=l(o,e);if("error"===i.status)return c.reject(t,i.value);var n=i.value;if(n)a(t,n);else{t.state=p,t.outcome=e;for(var r=-1,s=t.queue.length;++r<s;)t.queue[r].callFulfilled(e)}return t},c.reject=function(t,e){t.state=d,t.outcome=e;for(var i=-1,n=t.queue.length;++i<n;)t.queue[i].callRejected(e);return t},n.resolve=function(t){return t instanceof this?t:c.resolve(new this(h),t)},n.reject=function(t){var e=new this(h);return c.reject(e,t)},n.all=function(t){function e(t,e){i.resolve(t).then(function(t){s[e]=t,++o!==n||r||(r=!0,c.resolve(l,s))},function(t){r||(r=!0,c.reject(l,t))})}var i=this;if("[object Array]"!==Object.prototype.toString.call(t))return this.reject(new TypeError("must be an array"));var n=t.length,r=!1;if(!n)return this.resolve([]);for(var s=new Array(n),o=0,a=-1,l=new this(h);++a<n;)e(t[a],a);return l},n.race=function(t){var e=this;if("[object Array]"!==Object.prototype.toString.call(t))return this.reject(new TypeError("must be an array"));var i,n=t.length,r=!1;if(!n)return this.resolve([]);for(var s=-1,o=new this(h);++s<n;)i=t[s],e.resolve(i).then(function(t){r||(r=!0,c.resolve(o,t))},function(t){r||(r=!0,c.reject(o,t))});return o}},{1:1}],3:[function(e,t,i){(function(t){"use strict";"function"!=typeof t.Promise&&(t.Promise=e(2))}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{2:2}],4:[function(t,e,i){"use strict";function o(e,i){e=e||[],i=i||{};try{return new Blob(e,i)}catch(t){if("TypeError"!==t.name)throw t;for(var n=new("undefined"!=typeof BlobBuilder?BlobBuilder:"undefined"!=typeof MSBlobBuilder?MSBlobBuilder:"undefined"!=typeof MozBlobBuilder?MozBlobBuilder:WebKitBlobBuilder),r=0;r<e.length;r+=1)n.append(e[r]);return n.getBlob(i.type)}}function c(t,e){e&&t.then(function(t){e(null,t)},function(t){e(t)})}function u(t,e,i){"function"==typeof e&&t.then(e),"function"==typeof i&&t.catch(i)}function d(t){return"string"!=typeof t&&(console.warn(t+" used as a key, but it is not a string."),t=String(t)),t}function a(){if(arguments.length&&"function"==typeof arguments[arguments.length-1])return arguments[arguments.length-1]}function n(t){return"boolean"==typeof M?R.resolve(M):function(n){return new R(function(i){var t=n.transaction(O,F),e=o([""]);t.objectStore(O).put(e,"key"),t.onabort=function(t){t.preventDefault(),t.stopPropagation(),i(!1)},t.oncomplete=function(){var t=navigator.userAgent.match(/Chrome\/(\d+)/),e=navigator.userAgent.match(/Edge\//);i(e||!t||43<=parseInt(t[1],10))}}).catch(function(){return!1})}(t).then(function(t){return M=t})}function l(t){var e=B[t.name],i={};i.promise=new R(function(t,e){i.resolve=t,i.reject=e}),e.deferredOperations.push(i),e.dbReady?e.dbReady=e.dbReady.then(function(){return i.promise}):e.dbReady=i.promise}function h(t){var e=B[t.name].deferredOperations.pop();if(e)return e.resolve(),e.promise}function p(t,e){var i=B[t.name].deferredOperations.pop();if(i)return i.reject(e),i.promise}function r(r,s){return new R(function(t,e){if(r.db){if(!s)return t(r.db);l(r),r.db.close()}var i=[r.name];s&&i.push(r.version);var n=A.open.apply(A,i);s&&(n.onupgradeneeded=function(t){var e=n.result;try{e.createObjectStore(r.storeName),t.oldVersion<=1&&e.createObjectStore(O)}catch(e){if("ConstraintError"!==e.name)throw e;console.warn('The database "'+r.name+'" has been upgraded from version '+t.oldVersion+" to version "+t.newVersion+', but the storage "'+r.storeName+'" already exists.')}}),n.onerror=function(t){t.preventDefault(),e(n.error)},n.onsuccess=function(){t(n.result),h(r)}})}function f(t){return r(t,!1)}function g(t){return r(t,!0)}function m(t,e){if(!t.db)return!0;var i=!t.db.objectStoreNames.contains(t.storeName),n=t.version<t.db.version,r=t.version>t.db.version;if(n&&(t.version!==e&&console.warn('The database "'+t.name+"\" can't be downgraded from version "+t.db.version+" to version "+t.version+"."),t.version=t.db.version),r||i){if(i){var s=t.db.version+1;s>t.version&&(t.version=s)}return!0}return!1}function y(t){return o([function(t){for(var e=t.length,i=new ArrayBuffer(e),n=new Uint8Array(i),r=0;r<e;r++)n[r]=t.charCodeAt(r);return i}(atob(t.data))],{type:t.type})}function _(t){return t&&t.__local_forage_encoded_blob}function v(t){var e=this,i=e._initReady().then(function(){var t=B[e._dbInfo.name];if(t&&t.dbReady)return t.dbReady});return u(i,t,t),i}function b(t,e,i,n){void 0===n&&(n=1);try{var r=t.db.transaction(t.storeName,e);i(null,r)}catch(r){if(0<n&&(!t.db||"InvalidStateError"===r.name||"NotFoundError"===r.name))return R.resolve().then(function(){if(!t.db||"NotFoundError"===r.name&&!t.db.objectStoreNames.contains(t.storeName)&&t.version<=t.db.version)return t.db&&(t.version=t.db.version+1),g(t)}).then(function(){return function(i){l(i);for(var n=B[i.name].forages,t=0;t<n.length;t++){var e=n[t];e._dbInfo.db&&(e._dbInfo.db.close(),e._dbInfo.db=null)}return f(i).then(function(t){for(var e=0;e<n.length;e++)n[e]._dbInfo.db=t;i.db=t}).then(function(){if(m(i))return g(i)}).catch(function(t){throw p(i,t),t})}(t).then(function(){b(t,e,i,n-1)})}).catch(i);i(r)}}function w(t){var e,i,n,r,s,o=.75*t.length,a=t.length,l=0;"="===t[t.length-1]&&(o--,"="===t[t.length-2]&&o--);var h=new ArrayBuffer(o),u=new Uint8Array(h);for(e=0;e<a;e+=4)i=L.indexOf(t[e]),n=L.indexOf(t[e+1]),r=L.indexOf(t[e+2]),s=L.indexOf(t[e+3]),u[l++]=i<<2|n>>4,u[l++]=(15&n)<<4|r>>2,u[l++]=(3&r)<<6|63&s;return h}function S(t){var e,i=new Uint8Array(t),n="";for(e=0;e<i.length;e+=3)n+=L[i[e]>>2],n+=L[(3&i[e])<<4|i[e+1]>>4],n+=L[(15&i[e+1])<<2|i[e+2]>>6],n+=L[63&i[e+2]];return i.length%3==2?n=n.substring(0,n.length-1)+"=":i.length%3==1&&(n=n.substring(0,n.length-2)+"=="),n}function x(t,e,i,n){t.executeSql("CREATE TABLE IF NOT EXISTS "+e.storeName+" (id INTEGER PRIMARY KEY, key unique, value)",[],i,n)}function T(t,n,r,s,o,a){t.executeSql(r,s,o,function(t,i){i.code===i.SYNTAX_ERR?t.executeSql("SELECT name FROM sqlite_master WHERE type='table' AND name = ?",[name],function(t,e){e.rows.length?a(t,i):x(t,n,function(){t.executeSql(r,s,o,a)},a)},a):a(t,i)},a)}function s(t,e){var i=t.name+"/";return t.storeName!==e.storeName&&(i+=t.storeName+"/"),i}function I(){return!function(){var t="_localforage_support_test";try{return localStorage.setItem(t,!0),localStorage.removeItem(t),!1}catch(t){return!0}}()||0<localStorage.length}function P(e,i){e[i]=function(){var t=arguments;return e.ready().then(function(){return e[i].apply(e,t)})}}function C(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];if(i)for(var n in i)i.hasOwnProperty(n)&&(K(i[n])?t[n]=i[n].slice():t[n]=i[n])}return t}var E="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},A=function(){try{if("undefined"!=typeof indexedDB)return indexedDB;if("undefined"!=typeof webkitIndexedDB)return webkitIndexedDB;if("undefined"!=typeof mozIndexedDB)return mozIndexedDB;if("undefined"!=typeof OIndexedDB)return OIndexedDB;if("undefined"!=typeof msIndexedDB)return msIndexedDB}catch(t){return}}();"undefined"==typeof Promise&&t(3);var M,B,R=Promise,O="local-forage-detect-blob-support",k=Object.prototype.toString,D="readonly",F="readwrite",N={_driver:"asyncStorage",_initStorage:function(t){function e(){return R.resolve()}var n=this,r={db:null};if(t)for(var i in t)r[i]=t[i];var s=(B=B||{})[r.name];s||(s={forages:[],db:null,dbReady:null,deferredOperations:[]},B[r.name]=s),s.forages.push(n),n._initReady||(n._initReady=n.ready,n.ready=v);for(var o=[],a=0;a<s.forages.length;a++){var l=s.forages[a];l!==n&&o.push(l._initReady().catch(e))}var h=s.forages.slice(0);return R.all(o).then(function(){return r.db=s.db,f(r)}).then(function(t){return r.db=t,m(r,n._defaultConfig.version)?g(r):t}).then(function(t){r.db=s.db=t,n._dbInfo=r;for(var e=0;e<h.length;e++){var i=h[e];i!==n&&(i._dbInfo.db=r.db,i._dbInfo.version=r.version)}})},_support:function(){try{if(!A)return!1;var t="undefined"!=typeof openDatabase&&/(Safari|iPhone|iPad|iPod)/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent)&&!/BlackBerry/.test(navigator.platform),e="function"==typeof fetch&&-1!==fetch.toString().indexOf("[native code");return(!t||e)&&"undefined"!=typeof indexedDB&&"undefined"!=typeof IDBKeyRange}catch(t){return!1}}(),iterate:function(o,t){var a=this,e=new R(function(s,i){a.ready().then(function(){b(a._dbInfo,D,function(t,e){if(t)return i(t);try{var n=e.objectStore(a._dbInfo.storeName).openCursor(),r=1;n.onsuccess=function(){var t=n.result;if(t){var e=t.value;_(e)&&(e=y(e));var i=o(e,t.key,r++);void 0!==i?s(i):t.continue()}else s()},n.onerror=function(){i(n.error)}}catch(t){i(t)}})}).catch(i)});return c(e,t),e},getItem:function(s,t){var o=this;s=d(s);var e=new R(function(n,r){o.ready().then(function(){b(o._dbInfo,D,function(t,e){if(t)return r(t);try{var i=e.objectStore(o._dbInfo.storeName).get(s);i.onsuccess=function(){var t=i.result;void 0===t&&(t=null),_(t)&&(t=y(t)),n(t)},i.onerror=function(){r(i.error)}}catch(t){r(t)}})}).catch(r)});return c(e,t),e},setItem:function(a,e,t){var l=this;a=d(a);var i=new R(function(s,o){var t;l.ready().then(function(){return t=l._dbInfo,"[object Blob]"===k.call(e)?n(t.db).then(function(t){return t?e:function(n){return new R(function(i,t){var e=new FileReader;e.onerror=t,e.onloadend=function(t){var e=btoa(t.target.result||"");i({__local_forage_encoded_blob:!0,data:e,type:n.type})},e.readAsBinaryString(n)})}(e)}):e}).then(function(r){b(l._dbInfo,F,function(t,e){if(t)return o(t);try{var i=e.objectStore(l._dbInfo.storeName);null===r&&(r=void 0);var n=i.put(r,a);e.oncomplete=function(){void 0===r&&(r=null),s(r)},e.onabort=e.onerror=function(){var t=n.error?n.error:n.transaction.error;o(t)}}catch(t){o(t)}})}).catch(o)});return c(i,t),i},removeItem:function(s,t){var o=this;s=d(s);var e=new R(function(n,r){o.ready().then(function(){b(o._dbInfo,F,function(t,e){if(t)return r(t);try{var i=e.objectStore(o._dbInfo.storeName).delete(s);e.oncomplete=function(){n()},e.onerror=function(){r(i.error)},e.onabort=function(){var t=i.error?i.error:i.transaction.error;r(t)}}catch(t){r(t)}})}).catch(r)});return c(e,t),e},clear:function(t){var s=this,e=new R(function(n,r){s.ready().then(function(){b(s._dbInfo,F,function(t,e){if(t)return r(t);try{var i=e.objectStore(s._dbInfo.storeName).clear();e.oncomplete=function(){n()},e.onabort=e.onerror=function(){var t=i.error?i.error:i.transaction.error;r(t)}}catch(t){r(t)}})}).catch(r)});return c(e,t),e},length:function(t){var s=this,e=new R(function(n,r){s.ready().then(function(){b(s._dbInfo,D,function(t,e){if(t)return r(t);try{var i=e.objectStore(s._dbInfo.storeName).count();i.onsuccess=function(){n(i.result)},i.onerror=function(){r(i.error)}}catch(t){r(t)}})}).catch(r)});return c(e,t),e},key:function(a,t){var l=this,e=new R(function(s,o){a<0?s(null):l.ready().then(function(){b(l._dbInfo,D,function(t,e){if(t)return o(t);try{var i=e.objectStore(l._dbInfo.storeName),n=!1,r=i.openCursor();r.onsuccess=function(){var t=r.result;t?0===a?s(t.key):n?s(t.key):(n=!0,t.advance(a)):s(null)},r.onerror=function(){o(r.error)}}catch(t){o(t)}})}).catch(o)});return c(e,t),e},keys:function(t){var o=this,e=new R(function(r,s){o.ready().then(function(){b(o._dbInfo,D,function(t,e){if(t)return s(t);try{var i=e.objectStore(o._dbInfo.storeName).openCursor(),n=[];i.onsuccess=function(){var t=i.result;t?(n.push(t.key),t.continue()):r(n)},i.onerror=function(){s(i.error)}}catch(t){s(t)}})}).catch(s)});return c(e,t),e},dropInstance:function(s,t){t=a.apply(this,arguments);var e,i=this.config();if((s="function"!=typeof s&&s||{}).name||(s.name=s.name||i.name,s.storeName=s.storeName||i.storeName),s.name){var n=s.name===i.name&&this._dbInfo.db?R.resolve(this._dbInfo.db):f(s);e=s.storeName?n.then(function(t){if(t.objectStoreNames.contains(s.storeName)){var n=t.version+1;l(s);for(var r=B[s.name].forages,e=0;e<r.length;e++){var i=r[e];i._dbInfo.db&&(i._dbInfo.db.close(),i._dbInfo.db=null,i._dbInfo.version=n)}return new R(function(e,t){var i=A.open(s.name,n);i.onerror=t,i.onupgradeneeded=function(){i.result.deleteObjectStore(s.storeName)},i.onsuccess=function(){var t=i.result;e(t)}}).then(function(t){for(var e=0;e<r.length;e++){var i=r[e];i._dbInfo.db=t,h(i._dbInfo)}}).catch(function(t){throw(p(s,t)||R.resolve()).catch(function(){}),t})}}):n.then(function(){l(s);for(var e=B[s.name].forages,t=0;t<e.length;t++){var i=e[t];i._dbInfo.db&&(i._dbInfo.db.close(),i._dbInfo.db=null)}return new R(function(t,e){var i=A.deleteDatabase(s.name);i.onerror=i.onblocked=e,i.onsuccess=t}).then(function(){for(var t=0;t<e.length;t++)h(i._dbInfo)}).catch(function(t){throw(p(s,t)||R.resolve()).catch(function(){}),t})})}else e=R.reject("Invalid arguments");return c(e,t),e}},L="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",U=/^~~local_forage_type~([^~]+)~/,z="__lfsc__:",W=z.length,G="arbf",H="blob",X=W+G.length,j=Object.prototype.toString,V={serialize:function(e,i){var t="";if(e&&(t=j.call(e)),e&&("[object ArrayBuffer]"===t||e.buffer&&"[object ArrayBuffer]"===j.call(e.buffer))){var n,r=z;e instanceof ArrayBuffer?(n=e,r+=G):(n=e.buffer,"[object Int8Array]"===t?r+="si08":"[object Uint8Array]"===t?r+="ui08":"[object Uint8ClampedArray]"===t?r+="uic8":"[object Int16Array]"===t?r+="si16":"[object Uint16Array]"===t?r+="ur16":"[object Int32Array]"===t?r+="si32":"[object Uint32Array]"===t?r+="ui32":"[object Float32Array]"===t?r+="fl32":"[object Float64Array]"===t?r+="fl64":i(new Error("Failed to get type for BinaryArray"))),i(r+S(n))}else if("[object Blob]"===t){var s=new FileReader;s.onload=function(){var t="~~local_forage_type~"+e.type+"~"+S(this.result);i(z+H+t)},s.readAsArrayBuffer(e)}else try{i(JSON.stringify(e))}catch(t){console.error("Couldn't convert value into a JSON string: ",e),i(null,t)}},deserialize:function(t){if(t.substring(0,W)!==z)return JSON.parse(t);var e,i=t.substring(X),n=t.substring(W,X);if(n===H&&U.test(i)){var r=i.match(U);e=r[1],i=i.substring(r[0].length)}var s=w(i);switch(n){case G:return s;case H:return o([s],{type:e});case"si08":return new Int8Array(s);case"ui08":return new Uint8Array(s);case"uic8":return new Uint8ClampedArray(s);case"si16":return new Int16Array(s);case"ur16":return new Uint16Array(s);case"si32":return new Int32Array(s);case"ui32":return new Uint32Array(s);case"fl32":return new Float32Array(s);case"fl64":return new Float64Array(s);default:throw new Error("Unkown type: "+n)}},stringToBuffer:w,bufferToString:S},Y={_driver:"webSQLStorage",_initStorage:function(t){var n=this,r={db:null};if(t)for(var e in t)r[e]="string"!=typeof t[e]?t[e].toString():t[e];var i=new R(function(e,i){try{r.db=openDatabase(r.name,String(r.version),r.description,r.size)}catch(e){return i(e)}r.db.transaction(function(t){x(t,r,function(){n._dbInfo=r,e()},function(t,e){i(e)})},i)});return r.serializer=V,i},_support:"function"==typeof openDatabase,iterate:function(h,t){var e=this,i=new R(function(l,i){e.ready().then(function(){var a=e._dbInfo;a.db.transaction(function(t){T(t,a,"SELECT * FROM "+a.storeName,[],function(t,e){for(var i=e.rows,n=i.length,r=0;r<n;r++){var s=i.item(r),o=s.value;if(o=o&&a.serializer.deserialize(o),void 0!==(o=h(o,s.key,r+1)))return void l(o)}l()},function(t,e){i(e)})})}).catch(i)});return c(i,t),i},getItem:function(e,t){var s=this;e=d(e);var i=new R(function(r,i){s.ready().then(function(){var n=s._dbInfo;n.db.transaction(function(t){T(t,n,"SELECT * FROM "+n.storeName+" WHERE key = ? LIMIT 1",[e],function(t,e){var i=e.rows.length?e.rows.item(0).value:null;i=i&&n.serializer.deserialize(i),r(i)},function(t,e){i(e)})})}).catch(i)});return c(i,t),i},setItem:function(t,e,i){return function o(a,t,l,h){var u=this;a=d(a);var e=new R(function(r,s){u.ready().then(function(){void 0===t&&(t=null);var i=t,n=u._dbInfo;n.serializer.serialize(t,function(e,t){t?s(t):n.db.transaction(function(t){T(t,n,"INSERT OR REPLACE INTO "+n.storeName+" (key, value) VALUES (?, ?)",[a,e],function(){r(i)},function(t,e){s(e)})},function(t){if(t.code===t.QUOTA_ERR){if(0<h)return void r(o.apply(u,[a,i,l,h-1]));s(t)}})})}).catch(s)});return c(e,l),e}.apply(this,[t,e,i,1])},removeItem:function(r,t){var s=this;r=d(r);var e=new R(function(i,n){s.ready().then(function(){var e=s._dbInfo;e.db.transaction(function(t){T(t,e,"DELETE FROM "+e.storeName+" WHERE key = ?",[r],function(){i()},function(t,e){n(e)})})}).catch(n)});return c(e,t),e},clear:function(t){var r=this,e=new R(function(i,n){r.ready().then(function(){var e=r._dbInfo;e.db.transaction(function(t){T(t,e,"DELETE FROM "+e.storeName,[],function(){i()},function(t,e){n(e)})})}).catch(n)});return c(e,t),e},length:function(t){var r=this,e=new R(function(n,i){r.ready().then(function(){var e=r._dbInfo;e.db.transaction(function(t){T(t,e,"SELECT COUNT(key) as c FROM "+e.storeName,[],function(t,e){var i=e.rows.item(0).c;n(i)},function(t,e){i(e)})})}).catch(i)});return c(e,t),e},key:function(r,t){var s=this,e=new R(function(n,i){s.ready().then(function(){var e=s._dbInfo;e.db.transaction(function(t){T(t,e,"SELECT key FROM "+e.storeName+" WHERE id = ? LIMIT 1",[r+1],function(t,e){var i=e.rows.length?e.rows.item(0).key:null;n(i)},function(t,e){i(e)})})}).catch(i)});return c(e,t),e},keys:function(t){var n=this,e=new R(function(r,i){n.ready().then(function(){var e=n._dbInfo;e.db.transaction(function(t){T(t,e,"SELECT key FROM "+e.storeName,[],function(t,e){for(var i=[],n=0;n<e.rows.length;n++)i.push(e.rows.item(n).key);r(i)},function(t,e){i(e)})})}).catch(i)});return c(e,t),e},dropInstance:function(i,t){t=a.apply(this,arguments);var n=this.config();(i="function"!=typeof i&&i||{}).name||(i.name=i.name||n.name,i.storeName=i.storeName||n.storeName);var e,r=this;return c(e=i.name?new R(function(t){var e;e=i.name===n.name?r._dbInfo.db:openDatabase(i.name,"","",0),t(i.storeName?{db:e,storeNames:[i.storeName]}:function(s){return new R(function(r,i){s.transaction(function(t){t.executeSql("SELECT name FROM sqlite_master WHERE type='table' AND name <> '__WebKitDatabaseInfoTable__'",[],function(t,e){for(var i=[],n=0;n<e.rows.length;n++)i.push(e.rows.item(n).name);r({db:s,storeNames:i})},function(t,e){i(e)})},function(t){i(t)})})}(e))}).then(function(a){return new R(function(s,o){a.db.transaction(function(n){function t(e){return new R(function(t,i){n.executeSql("DROP TABLE IF EXISTS "+e,[],function(){t()},function(t,e){i(e)})})}for(var e=[],i=0,r=a.storeNames.length;i<r;i++)e.push(t(a.storeNames[i]));R.all(e).then(function(){s()}).catch(function(t){o(t)})},function(t){o(t)})})}):R.reject("Invalid arguments"),t),e}},q={_driver:"localStorageWrapper",_initStorage:function(t){var e={};if(t)for(var i in t)e[i]=t[i];return e.keyPrefix=s(t,this._defaultConfig),I()?((this._dbInfo=e).serializer=V,R.resolve()):R.reject()},_support:function(){try{return"undefined"!=typeof localStorage&&"setItem"in localStorage&&"function"==typeof localStorage.setItem}catch(t){return!1}}(),iterate:function(l,t){var h=this,e=h.ready().then(function(){for(var t=h._dbInfo,e=t.keyPrefix,i=e.length,n=localStorage.length,r=1,s=0;s<n;s++){var o=localStorage.key(s);if(0===o.indexOf(e)){var a=localStorage.getItem(o);if(a=a&&t.serializer.deserialize(a),void 0!==(a=l(a,o.substring(i),r++)))return a}}});return c(e,t),e},getItem:function(i,t){var n=this;i=d(i);var e=n.ready().then(function(){var t=n._dbInfo,e=localStorage.getItem(t.keyPrefix+i);return e=e&&t.serializer.deserialize(e)});return c(e,t),e},setItem:function(o,t,e){var a=this;o=d(o);var i=a.ready().then(function(){void 0===t&&(t=null);var s=t;return new R(function(i,n){var r=a._dbInfo;r.serializer.serialize(t,function(t,e){if(e)n(e);else try{localStorage.setItem(r.keyPrefix+o,t),i(s)}catch(t){"QuotaExceededError"!==t.name&&"NS_ERROR_DOM_QUOTA_REACHED"!==t.name||n(t),n(t)}})})});return c(i,e),i},removeItem:function(e,t){var i=this;e=d(e);var n=i.ready().then(function(){var t=i._dbInfo;localStorage.removeItem(t.keyPrefix+e)});return c(n,t),n},clear:function(t){var n=this,e=n.ready().then(function(){for(var t=n._dbInfo.keyPrefix,e=localStorage.length-1;0<=e;e--){var i=localStorage.key(e);0===i.indexOf(t)&&localStorage.removeItem(i)}});return c(e,t),e},length:function(t){var e=this.keys().then(function(t){return t.length});return c(e,t),e},key:function(i,t){var n=this,e=n.ready().then(function(){var e,t=n._dbInfo;try{e=localStorage.key(i)}catch(t){e=null}return e=e&&e.substring(t.keyPrefix.length)});return c(e,t),e},keys:function(t){var s=this,e=s.ready().then(function(){for(var t=s._dbInfo,e=localStorage.length,i=[],n=0;n<e;n++){var r=localStorage.key(n);0===r.indexOf(t.keyPrefix)&&i.push(r.substring(t.keyPrefix.length))}return i});return c(e,t),e},dropInstance:function(e,t){if(t=a.apply(this,arguments),!(e="function"!=typeof e&&e||{}).name){var i=this.config();e.name=e.name||i.name,e.storeName=e.storeName||i.storeName}var n,r=this;return c(n=e.name?new R(function(t){t(e.storeName?s(e,r._defaultConfig):e.name+"/")}).then(function(t){for(var e=localStorage.length-1;0<=e;e--){var i=localStorage.key(e);0===i.indexOf(t)&&localStorage.removeItem(i)}}):R.reject("Invalid arguments"),t),n}},K=Array.isArray||function(t){return"[object Array]"===Object.prototype.toString.call(t)},$={},Q={},J={INDEXEDDB:N,WEBSQL:Y,LOCALSTORAGE:q},Z=[J.INDEXEDDB._driver,J.WEBSQL._driver,J.LOCALSTORAGE._driver],tt=["dropInstance"],et=["clear","getItem","iterate","key","keys","length","removeItem","setItem"].concat(tt),it={description:"",driver:Z.slice(),name:"localforage",size:4980736,storeName:"keyvaluepairs",version:1},nt=new(rt.prototype.config=function(t){if("object"!==(void 0===t?"undefined":E(t)))return"string"==typeof t?this._config[t]:this._config;if(this._ready)return new Error("Can't call config() after localforage has been used.");for(var e in t){if("storeName"===e&&(t[e]=t[e].replace(/\W/g,"_")),"version"===e&&"number"!=typeof t[e])return new Error("Database version must be a number.");this._config[e]=t[e]}return!("driver"in t&&t.driver)||this.setDriver(this._config.driver)},rt.prototype.defineDriver=function(h,t,e){var i=new R(function(e,i){try{var n=h._driver,t=new Error("Custom driver not compliant; see https://mozilla.github.io/localForage/#definedriver");if(!h._driver)return void i(t);for(var r=et.concat("_initStorage"),s=0,o=r.length;s<o;s++){var a=r[s];if((tt.indexOf(a)<0||h[a])&&"function"!=typeof h[a])return void i(t)}!function(){for(var t=function(i){return function(){var t=new Error("Method "+i+" is not implemented by the current driver"),e=R.reject(t);return c(e,arguments[arguments.length-1]),e}},e=0,i=tt.length;e<i;e++){var n=tt[e];h[n]||(h[n]=t(n))}}();var l=function(t){$[n]&&console.info("Redefining LocalForage driver: "+n),$[n]=h,Q[n]=t,e()};"_support"in h?h._support&&"function"==typeof h._support?h._support().then(l,i):l(!!h._support):l(!0)}catch(t){i(t)}});return u(i,t,e),i},rt.prototype.driver=function(){return this._driver||null},rt.prototype.getDriver=function(t,e,i){var n=$[t]?R.resolve($[t]):R.reject(new Error("Driver not found."));return u(n,e,i),n},rt.prototype.getSerializer=function(t){var e=R.resolve(V);return u(e,t),e},rt.prototype.ready=function(t){var e=this,i=e._driverSet.then(function(){return null===e._ready&&(e._ready=e._initDriver()),e._ready});return u(i,t,t),i},rt.prototype.setDriver=function(t,e,i){function s(){a._config.driver=a.driver()}function o(t){return a._extend(t),s(),a._ready=a._initStorage(a._config),a._ready}function n(r){return function(){var n=0;return function t(){for(;n<r.length;){var e=r[n];return n++,a._dbInfo=null,a._ready=null,a.getDriver(e).then(o).catch(t)}s();var i=new Error("No available storage method found.");return a._driverSet=R.reject(i),a._driverSet}()}}var a=this;K(t)||(t=[t]);var r=this._getSupportedDrivers(t),l=null!==this._driverSet?this._driverSet.catch(function(){return R.resolve()}):R.resolve();return this._driverSet=l.then(function(){var t=r[0];return a._dbInfo=null,a._ready=null,a.getDriver(t).then(function(t){a._driver=t._driver,s(),a._wrapLibraryMethodsWithReady(),a._initDriver=n(r)})}).catch(function(){s();var t=new Error("No available storage method found.");return a._driverSet=R.reject(t),a._driverSet}),u(this._driverSet,e,i),this._driverSet},rt.prototype.supports=function(t){return!!Q[t]},rt.prototype._extend=function(t){C(this,t)},rt.prototype._getSupportedDrivers=function(t){for(var e=[],i=0,n=t.length;i<n;i++){var r=t[i];this.supports(r)&&e.push(r)}return e},rt.prototype._wrapLibraryMethodsWithReady=function(){for(var t=0,e=et.length;t<e;t++)P(this,et[t])},rt.prototype.createInstance=function(t){return new rt(t)},rt);function rt(t){for(var e in!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,rt),J)if(J.hasOwnProperty(e)){var i=J[e],n=i._driver;this[e]=n,$[n]||this.defineDriver(i)}this._defaultConfig=C({},it),this._config=C({},this._defaultConfig,t),this._driverSet=null,this._initDriver=null,this._ready=!1,this._dbInfo=null,this._wrapLibraryMethodsWithReady(),this.setDriver(this._config.driver).catch(function(){})}e.exports=nt},{3:3}]},{},[4])(4)}),localforage.config({name:"Floating Space Cities"}),function(){var t,o=/iPhone/i,a=/iPod/i,l=/iPad/i,h=/\biOS-universal(?:.+)Mac\b/i,u=/\bAndroid(?:.+)Mobile\b/i,c=/Android/i,d=/(?:SD4930UR|\bSilk(?:.+)Mobile\b)/i,p=/Silk/i,f=/Windows Phone/i,g=/\bWindows(?:.+)ARM\b/i,m=/BlackBerry/i,y=/BB10/i,_=/Opera Mini/i,v=/\b(CriOS|Chrome)(?:.+)Mobile/i,b=/Mobile(?:.+)Firefox\b/i,w=function(t){return void 0!==t&&"MacIntel"===t.platform&&"number"==typeof t.maxTouchPoints&&1<t.maxTouchPoints&&"undefined"==typeof MSStream};t=function(t){var e={userAgent:"",platform:"",maxTouchPoints:0};t||"undefined"==typeof navigator?"string"==typeof t?e.userAgent=t:t&&t.userAgent&&(e={userAgent:t.userAgent,platform:t.platform,maxTouchPoints:t.maxTouchPoints||0}):e={userAgent:navigator.userAgent,platform:navigator.platform,maxTouchPoints:navigator.maxTouchPoints||0};var i=e.userAgent,n=i.split("[FBAN");void 0!==n[1]&&(i=n[0]),void 0!==(n=i.split("Twitter"))[1]&&(i=n[0]);var r=function(e){return function(t){return t.test(e)}}(i),s={apple:{phone:r(o)&&!r(f),ipod:r(a),tablet:!r(o)&&(r(l)||w(e))&&!r(f),universal:r(h),device:(r(o)||r(a)||r(l)||r(h)||w(e))&&!r(f)},amazon:{phone:r(d),tablet:!r(d)&&r(p),device:r(d)||r(p)},android:{phone:!r(f)&&r(d)||!r(f)&&r(u),tablet:!r(f)&&!r(d)&&!r(u)&&(r(p)||r(c)),device:!r(f)&&(r(d)||r(p)||r(u)||r(c))||r(/\bokhttp\b/i)},windows:{phone:r(f),tablet:r(g),device:r(f)||r(g)},other:{blackberry:r(m),blackberry10:r(y),opera:r(_),firefox:r(b),chrome:r(v),device:r(m)||r(y)||r(_)||r(b)||r(v)},any:!1,phone:!1,tablet:!1};return s.any=s.apple.device||s.android.device||s.windows.device||s.other.device,s.phone=s.apple.phone||s.android.phone||s.windows.phone,s.tablet=s.apple.tablet||s.android.tablet||s.windows.tablet,s}(),"object"==typeof exports&&"undefined"!=typeof module?module.exports=t:"function"==typeof define&&define.amd?define(function(){return t}):this.isMobile=t}(),jsFunctions.isAnyMobile=function(){return isMobile.any},jsFunctions.isAnyApple=function(){return isMobile.apple.device},localforage.getItemParsed=function(t,e){localforage.getItem(t,e)},localforage.getItemBuffer=function(t,e){localforage.getItem(t,e)};var PIXI=function(nt){"use strict";var e=setTimeout,i="undefined"!=typeof setImmediate?setImmediate:null;function l(t){return Boolean(t&&void 0!==t.length)}function n(){}function s(t){if(!(this instanceof s))throw new TypeError("Promises must be constructed via new");if("function"!=typeof t)throw new TypeError("not a function");this._state=0,this._handled=!1,this._value=void 0,this._deferreds=[],c(t,this)}function r(i,n){for(;3===i._state;)i=i._value;0!==i._state?(i._handled=!0,s._immediateFn(function(){var t=1===i._state?n.onFulfilled:n.onRejected;if(null!==t){var e;try{e=t(i._value)}catch(t){return void a(n.promise,t)}o(n.promise,e)}else(1===i._state?o:a)(n.promise,i._value)})):i._deferreds.push(n)}function o(t,e){try{if(e===t)throw new TypeError("A promise cannot be resolved with itself.");if(e&&("object"==typeof e||"function"==typeof e)){var i=e.then;if(e instanceof s)return t._state=3,t._value=e,void h(t);if("function"==typeof i)return void c((n=i,r=e,function(){n.apply(r,arguments)}),t)}t._state=1,t._value=e,h(t)}catch(e){a(t,e)}var n,r}function a(t,e){t._state=2,t._value=e,h(t)}function h(t){2===t._state&&0===t._deferreds.length&&s._immediateFn(function(){t._handled||s._unhandledRejectionFn(t._value)});for(var e=0,i=t._deferreds.length;e<i;e++)r(t,t._deferreds[e]);t._deferreds=null}function u(t,e,i){this.onFulfilled="function"==typeof t?t:null,this.onRejected="function"==typeof e?e:null,this.promise=i}function c(t,e){var i=!1;try{t(function(t){i||(i=!0,o(e,t))},function(t){i||(i=!0,a(e,t))})}catch(t){if(i)return;i=!0,a(e,t)}}s.prototype.catch=function(t){return this.then(null,t)},s.prototype.then=function(t,e){var i=new this.constructor(n);return r(this,new u(t,e,i)),i},s.prototype.finally=function(e){var i=this.constructor;return this.then(function(t){return i.resolve(e()).then(function(){return t})},function(t){return i.resolve(e()).then(function(){return i.reject(t)})})},s.all=function(e){return new s(function(n,r){if(!l(e))return r(new TypeError("Promise.all accepts an array"));var s=Array.prototype.slice.call(e);if(0===s.length)return n([]);var o=s.length;function a(e,t){try{if(t&&("object"==typeof t||"function"==typeof t)){var i=t.then;if("function"==typeof i)return void i.call(t,function(t){a(e,t)},r)}s[e]=t,0==--o&&n(s)}catch(e){r(e)}}for(var t=0;t<s.length;t++)a(t,s[t])})},s.allSettled=function(i){return new this(function(n,t){if(!i||void 0===i.length)return t(new TypeError(typeof i+" "+i+" is not iterable(cannot read property Symbol(Symbol.iterator))"));var r=Array.prototype.slice.call(i);if(0===r.length)return n([]);var s=r.length;function o(e,t){if(t&&("object"==typeof t||"function"==typeof t)){var i=t.then;if("function"==typeof i)return void i.call(t,function(t){o(e,t)},function(t){r[e]={status:"rejected",reason:t},0==--s&&n(r)})}r[e]={status:"fulfilled",value:t},0==--s&&n(r)}for(var e=0;e<r.length;e++)o(e,r[e])})},s.resolve=function(e){return e&&"object"==typeof e&&e.constructor===s?e:new s(function(t){t(e)})},s.reject=function(i){return new s(function(t,e){e(i)})},s.race=function(r){return new s(function(t,e){if(!l(r))return e(new TypeError("Promise.race accepts an array"));for(var i=0,n=r.length;i<n;i++)s.resolve(r[i]).then(t,e)})},s._immediateFn="function"==typeof i&&function(t){i(t)}||function(t){e(t,0)},s._unhandledRejectionFn=function(t){"undefined"!=typeof console&&console&&console.warn("Possible Unhandled Promise Rejection:",t)};var d=Object.getOwnPropertySymbols,p=Object.prototype.hasOwnProperty,f=Object.prototype.propertyIsEnumerable,t=function(){try{if(!Object.assign)return 0;var t=new String("abc");if(t[5]="de","5"===Object.getOwnPropertyNames(t)[0])return 0;for(var e={},i=0;i<10;i++)e["_"+String.fromCharCode(i)]=i;if("0123456789"!==Object.getOwnPropertyNames(e).map(function(t){return e[t]}).join(""))return 0;var n={};return"abcdefghijklmnopqrst".split("").forEach(function(t){n[t]=t}),"abcdefghijklmnopqrst"===Object.keys(Object.assign({},n)).join("")}catch(t){return 0}}()?Object.assign:function(t,e){for(var i,n,r=arguments,s=function(t){if(null==t)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(t)}(t),o=1;o<arguments.length;o++){for(var a in i=Object(r[o]))p.call(i,a)&&(s[a]=i[a]);if(d){n=d(i);for(var l=0;l<n.length;l++)f.call(i,n[l])&&(s[n[l]]=i[n[l]])}}return s};if(self.Promise||(self.Promise=s),Object.assign||(Object.assign=t),Date.now&&Date.prototype.getTime||(Date.now=function(){return(new Date).getTime()}),!self.performance||!self.performance.now){var g=Date.now();self.performance||(self.performance={}),self.performance.now=function(){return Date.now()-g}}for(var m=Date.now(),y=["ms","moz","webkit","o"],_=0;_<y.length&&!self.requestAnimationFrame;++_){var v=y[_];self.requestAnimationFrame=self[v+"RequestAnimationFrame"],self.cancelAnimationFrame=self[v+"CancelAnimationFrame"]||self[v+"CancelRequestAnimationFrame"]}self.requestAnimationFrame||(self.requestAnimationFrame=function(t){if("function"!=typeof t)throw new TypeError(t+"is not a function");var e=Date.now(),i=16+m-e;return i<0&&(i=0),m=e,self.setTimeout(function(){m=Date.now(),t(performance.now())},i)}),self.cancelAnimationFrame||(self.cancelAnimationFrame=function(t){return clearTimeout(t)}),Math.sign||(Math.sign=function(t){return 0===(t=Number(t))||isNaN(t)?t:0<t?1:-1}),Number.isInteger||(Number.isInteger=function(t){return"number"==typeof t&&isFinite(t)&&Math.floor(t)===t}),self.ArrayBuffer||(self.ArrayBuffer=Array),self.Float32Array||(self.Float32Array=Array),self.Uint32Array||(self.Uint32Array=Array),self.Uint16Array||(self.Uint16Array=Array),self.Uint8Array||(self.Uint8Array=Array),self.Int32Array||(self.Int32Array=Array);function b(t){return void 0!==t&&"MacIntel"===t.platform&&"number"==typeof t.maxTouchPoints&&1<t.maxTouchPoints&&"undefined"==typeof MSStream}var w,S,x,T,I,P,C,E,A,M,B,R,O,k,D,F,N,L,U,z,W,G,H,X,j,V,Y,q,K,$,Q,J,Z,tt,et,it,rt,st,ot=/iPhone/i,at=/iPod/i,lt=/iPad/i,ht=/\biOS-universal(?:.+)Mac\b/i,ut=/\bAndroid(?:.+)Mobile\b/i,ct=/Android/i,dt=/(?:SD4930UR|\bSilk(?:.+)Mobile\b)/i,pt=/Silk/i,ft=/Windows Phone/i,gt=/\bWindows(?:.+)ARM\b/i,mt=/BlackBerry/i,yt=/BB10/i,_t=/Opera Mini/i,vt=/\b(CriOS|Chrome)(?:.+)Mobile/i,bt=/Mobile(?:.+)Firefox\b/i,wt=function(t){var e={userAgent:"",platform:"",maxTouchPoints:0};t||"undefined"==typeof navigator?"string"==typeof t?e.userAgent=t:t&&t.userAgent&&(e={userAgent:t.userAgent,platform:t.platform,maxTouchPoints:t.maxTouchPoints||0}):e={userAgent:navigator.userAgent,platform:navigator.platform,maxTouchPoints:navigator.maxTouchPoints||0};var i=e.userAgent,n=i.split("[FBAN");void 0!==n[1]&&(i=n[0]),void 0!==(n=i.split("Twitter"))[1]&&(i=n[0]);var r,s=(r=i,function(t){return t.test(r)}),o={apple:{phone:s(ot)&&!s(ft),ipod:s(at),tablet:!s(ot)&&(s(lt)||b(e))&&!s(ft),universal:s(ht),device:(s(ot)||s(at)||s(lt)||s(ht)||b(e))&&!s(ft)},amazon:{phone:s(dt),tablet:!s(dt)&&s(pt),device:s(dt)||s(pt)},android:{phone:!s(ft)&&s(dt)||!s(ft)&&s(ut),tablet:!s(ft)&&!s(dt)&&!s(ut)&&(s(pt)||s(ct)),device:!s(ft)&&(s(dt)||s(pt)||s(ut)||s(ct))||s(/\bokhttp\b/i)},windows:{phone:s(ft),tablet:s(gt),device:s(ft)||s(gt)},other:{blackberry:s(mt),blackberry10:s(yt),opera:s(_t),firefox:s(bt),chrome:s(vt),device:s(mt)||s(yt)||s(_t)||s(bt)||s(vt)},any:!1,phone:!1,tablet:!1};return o.any=o.apple.device||o.android.device||o.windows.device||o.other.device,o.phone=o.apple.phone||o.android.phone||o.windows.phone,o.tablet=o.apple.tablet||o.android.tablet||o.windows.tablet,o}(self.navigator);(st=w=w||{})[st.WEBGL_LEGACY=0]="WEBGL_LEGACY",st[st.WEBGL=1]="WEBGL",st[st.WEBGL2=2]="WEBGL2",(rt=S=S||{})[rt.UNKNOWN=0]="UNKNOWN",rt[rt.WEBGL=1]="WEBGL",rt[rt.CANVAS=2]="CANVAS",(it=x=x||{})[it.COLOR=16384]="COLOR",it[it.DEPTH=256]="DEPTH",it[it.STENCIL=1024]="STENCIL",(et=T=T||{})[et.NORMAL=0]="NORMAL",et[et.ADD=1]="ADD",et[et.MULTIPLY=2]="MULTIPLY",et[et.SCREEN=3]="SCREEN",et[et.OVERLAY=4]="OVERLAY",et[et.DARKEN=5]="DARKEN",et[et.LIGHTEN=6]="LIGHTEN",et[et.COLOR_DODGE=7]="COLOR_DODGE",et[et.COLOR_BURN=8]="COLOR_BURN",et[et.HARD_LIGHT=9]="HARD_LIGHT",et[et.SOFT_LIGHT=10]="SOFT_LIGHT",et[et.DIFFERENCE=11]="DIFFERENCE",et[et.EXCLUSION=12]="EXCLUSION",et[et.HUE=13]="HUE",et[et.SATURATION=14]="SATURATION",et[et.COLOR=15]="COLOR",et[et.LUMINOSITY=16]="LUMINOSITY",et[et.NORMAL_NPM=17]="NORMAL_NPM",et[et.ADD_NPM=18]="ADD_NPM",et[et.SCREEN_NPM=19]="SCREEN_NPM",et[et.NONE=20]="NONE",et[et.SRC_OVER=0]="SRC_OVER",et[et.SRC_IN=21]="SRC_IN",et[et.SRC_OUT=22]="SRC_OUT",et[et.SRC_ATOP=23]="SRC_ATOP",et[et.DST_OVER=24]="DST_OVER",et[et.DST_IN=25]="DST_IN",et[et.DST_OUT=26]="DST_OUT",et[et.DST_ATOP=27]="DST_ATOP",et[et.ERASE=26]="ERASE",et[et.SUBTRACT=28]="SUBTRACT",et[et.XOR=29]="XOR",(tt=I=I||{})[tt.POINTS=0]="POINTS",tt[tt.LINES=1]="LINES",tt[tt.LINE_LOOP=2]="LINE_LOOP",tt[tt.LINE_STRIP=3]="LINE_STRIP",tt[tt.TRIANGLES=4]="TRIANGLES",tt[tt.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",tt[tt.TRIANGLE_FAN=6]="TRIANGLE_FAN",(Z=P=P||{})[Z.RGBA=6408]="RGBA",Z[Z.RGB=6407]="RGB",Z[Z.RG=33319]="RG",Z[Z.RED=6403]="RED",Z[Z.RGBA_INTEGER=36249]="RGBA_INTEGER",Z[Z.RGB_INTEGER=36248]="RGB_INTEGER",Z[Z.RG_INTEGER=33320]="RG_INTEGER",Z[Z.RED_INTEGER=36244]="RED_INTEGER",Z[Z.ALPHA=6406]="ALPHA",Z[Z.LUMINANCE=6409]="LUMINANCE",Z[Z.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",Z[Z.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",Z[Z.DEPTH_STENCIL=34041]="DEPTH_STENCIL",(J=C=C||{})[J.TEXTURE_2D=3553]="TEXTURE_2D",J[J.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",J[J.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",J[J.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",J[J.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",J[J.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",J[J.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",J[J.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",J[J.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",(Q=E=E||{})[Q.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",Q[Q.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",Q[Q.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",Q[Q.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",Q[Q.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",Q[Q.UNSIGNED_INT=5125]="UNSIGNED_INT",Q[Q.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",Q[Q.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",Q[Q.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",Q[Q.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",Q[Q.BYTE=5120]="BYTE",Q[Q.SHORT=5122]="SHORT",Q[Q.INT=5124]="INT",Q[Q.FLOAT=5126]="FLOAT",Q[Q.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV",Q[Q.HALF_FLOAT=36193]="HALF_FLOAT",($=A=A||{})[$.FLOAT=0]="FLOAT",$[$.INT=1]="INT",$[$.UINT=2]="UINT",(K=M=M||{})[K.NEAREST=0]="NEAREST",K[K.LINEAR=1]="LINEAR",(q=B=B||{})[q.CLAMP=33071]="CLAMP",q[q.REPEAT=10497]="REPEAT",q[q.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",(Y=R=R||{})[Y.OFF=0]="OFF",Y[Y.POW2=1]="POW2",Y[Y.ON=2]="ON",Y[Y.ON_MANUAL=3]="ON_MANUAL",(V=O=O||{})[V.NPM=0]="NPM",V[V.UNPACK=1]="UNPACK",V[V.PMA=2]="PMA",V[V.NO_PREMULTIPLIED_ALPHA=0]="NO_PREMULTIPLIED_ALPHA",V[V.PREMULTIPLY_ON_UPLOAD=1]="PREMULTIPLY_ON_UPLOAD",V[V.PREMULTIPLY_ALPHA=2]="PREMULTIPLY_ALPHA",V[V.PREMULTIPLIED_ALPHA=2]="PREMULTIPLIED_ALPHA",(j=k=k||{})[j.NO=0]="NO",j[j.YES=1]="YES",j[j.AUTO=2]="AUTO",j[j.BLEND=0]="BLEND",j[j.CLEAR=1]="CLEAR",j[j.BLIT=2]="BLIT",(X=D=D||{})[X.AUTO=0]="AUTO",X[X.MANUAL=1]="MANUAL",(H=F=F||{}).LOW="lowp",H.MEDIUM="mediump",H.HIGH="highp",(G=N=N||{})[G.NONE=0]="NONE",G[G.SCISSOR=1]="SCISSOR",G[G.STENCIL=2]="STENCIL",G[G.SPRITE=3]="SPRITE",(W=L=L||{})[W.NONE=0]="NONE",W[W.LOW=2]="LOW",W[W.MEDIUM=4]="MEDIUM",W[W.HIGH=8]="HIGH",(z=U=U||{})[z.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",z[z.ARRAY_BUFFER=34962]="ARRAY_BUFFER",z[z.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER";var St,xt,Tt={MIPMAP_TEXTURES:R.POW2,ANISOTROPIC_LEVEL:0,RESOLUTION:1,FILTER_RESOLUTION:1,FILTER_MULTISAMPLE:L.NONE,SPRITE_MAX_TEXTURES:(xt=!0,(wt.tablet||wt.phone)&&(wt.apple.device&&(St=navigator.userAgent.match(/OS (\d+)_(\d+)?/))&&parseInt(St[1],10)<11&&(xt=!1),wt.android.device&&(St=navigator.userAgent.match(/Android\s([0-9.]*)/))&&parseInt(St[1],10)<7&&(xt=!1)),xt?32:4),SPRITE_BATCH_SIZE:4096,RENDER_OPTIONS:{view:null,antialias:!1,autoDensity:!1,backgroundColor:0,backgroundAlpha:1,useContextAlpha:!0,clearBeforeRender:!0,preserveDrawingBuffer:!1,width:800,height:600,legacy:!1},GC_MODE:D.AUTO,GC_MAX_IDLE:3600,GC_MAX_CHECK_COUNT:600,WRAP_MODE:B.CLAMP,SCALE_MODE:M.LINEAR,PRECISION_VERTEX:F.HIGH,PRECISION_FRAGMENT:wt.apple.device?F.HIGH:F.MEDIUM,CAN_UPLOAD_SAME_BUFFER:!wt.apple.device,CREATE_IMAGE_BITMAP:!1,ROUND_PIXELS:!1},It="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function Pt(t,e,i){return t(i={path:e,exports:{},require:function(t,e){return function(){throw new Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}(null==e&&i.path)}},i.exports),i.exports}var Ct=Pt(function(t){var n=Object.prototype.hasOwnProperty,f="~";function i(){}function a(t,e,i){this.fn=t,this.context=e,this.once=i||!1}function r(t,e,i,n,r){if("function"!=typeof i)throw new TypeError("The listener must be a function");var s=new a(i,n||t,r),o=f?f+e:e;return t._events[o]?t._events[o].fn?t._events[o]=[t._events[o],s]:t._events[o].push(s):(t._events[o]=s,t._eventsCount++),t}function h(t,e){0==--t._eventsCount?t._events=new i:delete t._events[e]}function e(){this._events=new i,this._eventsCount=0}Object.create&&(i.prototype=Object.create(null),(new i).__proto__||(f=!1)),e.prototype.eventNames=function(){var t,e,i=[];if(0===this._eventsCount)return i;for(e in t=this._events)n.call(t,e)&&i.push(f?e.slice(1):e);return Object.getOwnPropertySymbols?i.concat(Object.getOwnPropertySymbols(t)):i},e.prototype.listeners=function(t){var e=f?f+t:t,i=this._events[e];if(!i)return[];if(i.fn)return[i.fn];for(var n=0,r=i.length,s=new Array(r);n<r;n++)s[n]=i[n].fn;return s},e.prototype.listenerCount=function(t){var e=f?f+t:t,i=this._events[e];return i?i.fn?1:i.length:0},e.prototype.emit=function(t,e,i,n,r,s){var o=arguments,a=f?f+t:t;if(!this._events[a])return!1;var l,h,u=this._events[a],c=arguments.length;if(u.fn){switch(u.once&&this.removeListener(t,u.fn,void 0,!0),c){case 1:return u.fn.call(u.context),!0;case 2:return u.fn.call(u.context,e),!0;case 3:return u.fn.call(u.context,e,i),!0;case 4:return u.fn.call(u.context,e,i,n),!0;case 5:return u.fn.call(u.context,e,i,n,r),!0;case 6:return u.fn.call(u.context,e,i,n,r,s),!0}for(h=1,l=new Array(c-1);h<c;h++)l[h-1]=o[h];u.fn.apply(u.context,l)}else{var d,p=u.length;for(h=0;h<p;h++)switch(u[h].once&&this.removeListener(t,u[h].fn,void 0,!0),c){case 1:u[h].fn.call(u[h].context);break;case 2:u[h].fn.call(u[h].context,e);break;case 3:u[h].fn.call(u[h].context,e,i);break;case 4:u[h].fn.call(u[h].context,e,i,n);break;default:if(!l)for(d=1,l=new Array(c-1);d<c;d++)l[d-1]=o[d];u[h].fn.apply(u[h].context,l)}}return!0},e.prototype.on=function(t,e,i){return r(this,t,e,i,!1)},e.prototype.once=function(t,e,i){return r(this,t,e,i,!0)},e.prototype.removeListener=function(t,e,i,n){var r=f?f+t:t;if(!this._events[r])return this;if(!e)return h(this,r),this;var s=this._events[r];if(s.fn)s.fn!==e||n&&!s.once||i&&s.context!==i||h(this,r);else{for(var o=0,a=[],l=s.length;o<l;o++)(s[o].fn!==e||n&&!s[o].once||i&&s[o].context!==i)&&a.push(s[o]);a.length?this._events[r]=1===a.length?a[0]:a:h(this,r)}return this},e.prototype.removeAllListeners=function(t){var e;return t?(e=f?f+t:t,this._events[e]&&h(this,e)):(this._events=new i,this._eventsCount=0),this},e.prototype.off=e.prototype.removeListener,e.prototype.addListener=e.prototype.on,e.prefixed=f,e.EventEmitter=e,t.exports=e}),Et=Mt,At=Mt;function Mt(t,e,i){i=i||2;var n,r,s,o,a,l,h,u=e&&e.length,c=u?e[0]*i:t.length,d=Bt(t,0,c,i,!0),p=[];if(!d||d.next===d.prev)return p;if(u&&(d=function(t,e,i,n){var r,s,o,a=[];for(r=0,s=e.length;r<s;r++)(o=Bt(t,e[r]*n,r<s-1?e[r+1]*n:t.length,n,!1))===o.next&&(o.steiner=!0),a.push(Wt(o));for(a.sort(Lt),r=0;r<a.length;r++)i=Rt(i=Ut(a[r],i),i.next);return i}(t,e,d,i)),t.length>80*i){n=s=t[0],r=o=t[1];for(var f=i;f<c;f+=i)(a=t[f])<n&&(n=a),(l=t[f+1])<r&&(r=l),s<a&&(s=a),o<l&&(o=l);h=0!==(h=Math.max(s-n,o-r))?1/h:0}return Ot(d,p,i,n,r,h),p}function Bt(t,e,i,n,r){var s,o;if(r===0<Zt(t,e,i,n))for(s=e;s<i;s+=n)o=$t(s,t[s],t[s+1],o);else for(s=i-n;e<=s;s-=n)o=$t(s,t[s],t[s+1],o);return o&&Xt(o,o.next)&&(Qt(o),o=o.next),o}function Rt(t,e){if(!t)return t;e=e||t;var i,n=t;do{if(i=!1,n.steiner||!Xt(n,n.next)&&0!==Ht(n.prev,n,n.next))n=n.next;else{if(Qt(n),(n=e=n.prev)===n.next)break;i=!0}}while(i||n!==e);return e}function Ot(t,e,i,n,r,s,o){if(t){!o&&s&&function(t,e,i,n){for(var r=t;null===r.z&&(r.z=zt(r.x,r.y,e,i,n)),r.prevZ=r.prev,r.nextZ=r.next,(r=r.next)!==t;);r.prevZ.nextZ=null,r.prevZ=null,function(t){var e,i,n,r,s,o,a,l,h=1;do{for(i=t,s=t=null,o=0;i;){for(o++,n=i,e=a=0;e<h&&(a++,n=n.nextZ);e++);for(l=h;0<a||0<l&&n;)0!==a&&(0===l||!n||i.z<=n.z)?(i=(r=i).nextZ,a--):(n=(r=n).nextZ,l--),s?s.nextZ=r:t=r,r.prevZ=s,s=r;i=n}s.nextZ=null,h*=2}while(1<o)}(r)}(t,n,r,s);for(var a,l,h=t;t.prev!==t.next;)if(a=t.prev,l=t.next,s?Dt(t,n,r,s):kt(t))e.push(a.i/i),e.push(t.i/i),e.push(l.i/i),Qt(t),t=l.next,h=l.next;else if((t=l)===h){o?1===o?Ot(t=Ft(Rt(t),e,i),e,i,n,r,s,2):2===o&&Nt(t,e,i,n,r,s):Ot(Rt(t),e,i,n,r,s,1);break}}}function kt(t){var e=t.prev,i=t,n=t.next;if(0<=Ht(e,i,n))return!1;for(var r=t.next.next;r!==t.prev;){if(Gt(e.x,e.y,i.x,i.y,n.x,n.y,r.x,r.y)&&0<=Ht(r.prev,r,r.next))return!1;r=r.next}return!0}function Dt(t,e,i,n){var r=t.prev,s=t,o=t.next;if(0<=Ht(r,s,o))return!1;for(var a=r.x<s.x?r.x<o.x?r.x:o.x:s.x<o.x?s.x:o.x,l=r.y<s.y?r.y<o.y?r.y:o.y:s.y<o.y?s.y:o.y,h=r.x>s.x?r.x>o.x?r.x:o.x:s.x>o.x?s.x:o.x,u=r.y>s.y?r.y>o.y?r.y:o.y:s.y>o.y?s.y:o.y,c=zt(a,l,e,i,n),d=zt(h,u,e,i,n),p=t.prevZ,f=t.nextZ;p&&p.z>=c&&f&&f.z<=d;){if(p!==t.prev&&p!==t.next&&Gt(r.x,r.y,s.x,s.y,o.x,o.y,p.x,p.y)&&0<=Ht(p.prev,p,p.next))return!1;if(p=p.prevZ,f!==t.prev&&f!==t.next&&Gt(r.x,r.y,s.x,s.y,o.x,o.y,f.x,f.y)&&0<=Ht(f.prev,f,f.next))return!1;f=f.nextZ}for(;p&&p.z>=c;){if(p!==t.prev&&p!==t.next&&Gt(r.x,r.y,s.x,s.y,o.x,o.y,p.x,p.y)&&0<=Ht(p.prev,p,p.next))return!1;p=p.prevZ}for(;f&&f.z<=d;){if(f!==t.prev&&f!==t.next&&Gt(r.x,r.y,s.x,s.y,o.x,o.y,f.x,f.y)&&0<=Ht(f.prev,f,f.next))return!1;f=f.nextZ}return!0}function Ft(t,e,i){var n=t;do{var r=n.prev,s=n.next.next;!Xt(r,s)&&jt(r,n,n.next,s)&&qt(r,s)&&qt(s,r)&&(e.push(r.i/i),e.push(n.i/i),e.push(s.i/i),Qt(n),Qt(n.next),n=t=s),n=n.next}while(n!==t);return Rt(n)}function Nt(t,e,i,n,r,s){var o,a,l=t;do{for(var h=l.next.next;h!==l.prev;){if(l.i!==h.i&&(a=h,(o=l).next.i!==a.i&&o.prev.i!==a.i&&!function(t,e){var i=t;do{if(i.i!==t.i&&i.next.i!==t.i&&i.i!==e.i&&i.next.i!==e.i&&jt(i,i.next,t,e))return 1;i=i.next}while(i!==t);return 0}(o,a)&&(qt(o,a)&&qt(a,o)&&function(t,e){for(var i=t,n=!1,r=(t.x+e.x)/2,s=(t.y+e.y)/2;i.y>s!=i.next.y>s&&i.next.y!==i.y&&r<(i.next.x-i.x)*(s-i.y)/(i.next.y-i.y)+i.x&&(n=!n),(i=i.next)!==t;);return n}(o,a)&&(Ht(o.prev,o,a.prev)||Ht(o,a.prev,a))||Xt(o,a)&&0<Ht(o.prev,o,o.next)&&0<Ht(a.prev,a,a.next)))){var u=Kt(l,h);return l=Rt(l,l.next),u=Rt(u,u.next),Ot(l,e,i,n,r,s),void Ot(u,e,i,n,r,s)}h=h.next}l=l.next}while(l!==t)}function Lt(t,e){return t.x-e.x}function Ut(t,e){var i=function(t,e){var i,n=e,r=t.x,s=t.y,o=-1/0;do{if(s<=n.y&&s>=n.next.y&&n.next.y!==n.y){var a=n.x+(s-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(a<=r&&o<a){if((o=a)===r){if(s===n.y)return n;if(s===n.next.y)return n.next}i=n.x<n.next.x?n:n.next}}n=n.next}while(n!==e);if(!i)return null;if(r===o)return i;var l,h,u,c=i,d=i.x,p=i.y,f=1/0;for(n=i;r>=n.x&&n.x>=d&&r!==n.x&&Gt(s<p?r:o,s,d,p,s<p?o:r,s,n.x,n.y)&&(l=Math.abs(s-n.y)/(r-n.x),qt(n,t)&&(l<f||l===f&&(n.x>i.x||n.x===i.x&&(u=n,Ht((h=i).prev,h,u.prev)<0&&Ht(u.next,h,h.next)<0)))&&(i=n,f=l)),(n=n.next)!==c;);return i}(t,e);if(!i)return e;var n=Kt(i,t),r=Rt(i,i.next);return Rt(n,n.next),e===i?r:e}function zt(t,e,i,n,r){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-i)*r)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-n)*r)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function Wt(t){for(var e=t,i=t;(e.x<i.x||e.x===i.x&&e.y<i.y)&&(i=e),(e=e.next)!==t;);return i}function Gt(t,e,i,n,r,s,o,a){return 0<=(r-o)*(e-a)-(t-o)*(s-a)&&0<=(t-o)*(n-a)-(i-o)*(e-a)&&0<=(i-o)*(s-a)-(r-o)*(n-a)}function Ht(t,e,i){return(e.y-t.y)*(i.x-e.x)-(e.x-t.x)*(i.y-e.y)}function Xt(t,e){return t.x===e.x&&t.y===e.y}function jt(t,e,i,n){var r=Yt(Ht(t,e,i)),s=Yt(Ht(t,e,n)),o=Yt(Ht(i,n,t)),a=Yt(Ht(i,n,e));return r!==s&&o!==a||!(0!==r||!Vt(t,i,e))||!(0!==s||!Vt(t,n,e))||!(0!==o||!Vt(i,t,n))||!(0!==a||!Vt(i,e,n))}function Vt(t,e,i){return e.x<=Math.max(t.x,i.x)&&e.x>=Math.min(t.x,i.x)&&e.y<=Math.max(t.y,i.y)&&e.y>=Math.min(t.y,i.y)}function Yt(t){return 0<t?1:t<0?-1:0}function qt(t,e){return Ht(t.prev,t,t.next)<0?0<=Ht(t,e,t.next)&&0<=Ht(t,t.prev,e):Ht(t,e,t.prev)<0||Ht(t,t.next,e)<0}function Kt(t,e){var i=new Jt(t.i,t.x,t.y),n=new Jt(e.i,e.x,e.y),r=t.next,s=e.prev;return(t.next=e).prev=t,(i.next=r).prev=i,(n.next=i).prev=n,(s.next=n).prev=s,n}function $t(t,e,i,n){var r=new Jt(t,e,i);return n?(r.next=n.next,(r.prev=n).next.prev=r,n.next=r):(r.prev=r).next=r,r}function Qt(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function Jt(t,e,i){this.i=t,this.x=e,this.y=i,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Zt(t,e,i,n){for(var r=0,s=e,o=i-n;s<i;s+=n)r+=(t[o]-t[s])*(t[s+1]+t[o+1]),o=s;return r}Mt.deviation=function(t,e,i,n){var r=e&&e.length,s=r?e[0]*i:t.length,o=Math.abs(Zt(t,0,s,i));if(r)for(var a=0,l=e.length;a<l;a++){var h=e[a]*i,u=a<l-1?e[a+1]*i:t.length;o-=Math.abs(Zt(t,h,u,i))}var c=0;for(a=0;a<n.length;a+=3){var d=n[a]*i,p=n[a+1]*i,f=n[a+2]*i;c+=Math.abs((t[d]-t[f])*(t[1+p]-t[1+d])-(t[d]-t[p])*(t[1+f]-t[1+d]))}return 0===o&&0===c?0:Math.abs((c-o)/o)},Mt.flatten=function(t){for(var e=t[0][0].length,i={vertices:[],holes:[],dimensions:e},n=0,r=0;r<t.length;r++){for(var s=0;s<t[r].length;s++)for(var o=0;o<e;o++)i.vertices.push(t[r][s][o]);0<r&&(n+=t[r-1].length,i.holes.push(n))}return i},Et.default=At;var te=Pt(function(C,E){!function(t){var e=E&&!E.nodeType&&E,i=C&&!C.nodeType&&C,n="object"==typeof It&&It;n.global!==n&&n.window!==n&&n.self!==n||(t=n);var r,s,y=2147483647,_=36,v=26,o=38,a=700,l=/^xn--/,h=/[^\x20-\x7E]/,u=/[\x2E\u3002\uFF0E\uFF61]/g,c={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},d=_-1,b=Math.floor,w=String.fromCharCode;function S(t){throw RangeError(c[t])}function p(t,e){for(var i=t.length,n=[];i--;)n[i]=e(t[i]);return n}function f(t,e){var i=t.split("@"),n="";return 1<i.length&&(n=i[0]+"@",t=i[1]),n+p((t=t.replace(u,".")).split("."),e).join(".")}function x(t){for(var e,i,n=[],r=0,s=t.length;r<s;)55296<=(e=t.charCodeAt(r++))&&e<=56319&&r<s?56320==(64512&(i=t.charCodeAt(r++)))?n.push(((1023&e)<<10)+(1023&i)+65536):(n.push(e),r--):n.push(e);return n}function T(t){return p(t,function(t){var e="";return 65535<t&&(e+=w((t-=65536)>>>10&1023|55296),t=56320|1023&t),e+w(t)}).join("")}function I(t,e){return t+22+75*(t<26)-((0!=e)<<5)}function P(t,e,i){var n=0;for(t=i?b(t/a):t>>1,t+=b(t/e);d*v>>1<t;n+=_)t=b(t/d);return b(n+(d+1)*t/(t+o))}function g(t){var e,i,n,r,s,o,a,l,h,u,c,d=[],p=t.length,f=0,g=128,m=72;for((i=t.lastIndexOf("-"))<0&&(i=0),n=0;n<i;++n)128<=t.charCodeAt(n)&&S("not-basic"),d.push(t.charCodeAt(n));for(r=0<i?i+1:0;r<p;){for(s=f,o=1,a=_;p<=r&&S("invalid-input"),((l=(c=t.charCodeAt(r++))-48<10?c-22:c-65<26?c-65:c-97<26?c-97:_)>=_||l>b((y-f)/o))&&S("overflow"),f+=l*o,!(l<(h=a<=m?1:m+v<=a?v:a-m));a+=_)o>b(y/(u=_-h))&&S("overflow"),o*=u;m=P(f-s,e=d.length+1,0==s),b(f/e)>y-g&&S("overflow"),g+=b(f/e),f%=e,d.splice(f++,0,g)}return T(d)}function m(t){var e,i,n,r,s,o,a,l,h,u,c,d,p,f,g,m=[];for(d=(t=x(t)).length,e=128,s=72,o=i=0;o<d;++o)(c=t[o])<128&&m.push(w(c));for(n=r=m.length,r&&m.push("-");n<d;){for(a=y,o=0;o<d;++o)(c=t[o])>=e&&c<a&&(a=c);for(a-e>b((y-i)/(p=n+1))&&S("overflow"),i+=(a-e)*p,e=a,o=0;o<d;++o)if((c=t[o])<e&&++i>y&&S("overflow"),c==e){for(l=i,h=_;!(l<(u=h<=s?1:s+v<=h?v:h-s));h+=_)g=l-u,f=_-u,m.push(w(I(u+g%f,0))),l=b(g/f);m.push(w(I(l,0))),s=P(i,p,n==r),i=0,++n}++i,++e}return m.join("")}if(r={version:"1.3.2",ucs2:{decode:x,encode:T},decode:g,encode:m,toASCII:function(t){return f(t,function(t){return h.test(t)?"xn--"+m(t):t})},toUnicode:function(t){return f(t,function(t){return l.test(t)?g(t.slice(4).toLowerCase()):t})}},e&&i)if(C.exports==e)i.exports=r;else for(s in r)r.hasOwnProperty(s)&&(e[s]=r[s]);else t.punycode=r}(It)}),ee=function(t){return"string"==typeof t},ie=function(t){return"object"==typeof t&&null!==t},ne=function(t){return null===t},re=function(t){return null==t};function se(t,e,i,n){e=e||"&",i=i||"=";var r={};if("string"!=typeof t||0===t.length)return r;var s=/\+/g;t=t.split(e);var o=1e3;n&&"number"==typeof n.maxKeys&&(o=n.maxKeys);var a,l,h=t.length;0<o&&o<h&&(h=o);for(var u=0;u<h;++u){var c,d,p,f,g=t[u].replace(s,"%20"),m=g.indexOf(i);d=0<=m?(c=g.substr(0,m),g.substr(m+1)):(c=g,""),p=decodeURIComponent(c),f=decodeURIComponent(d),a=r,l=p,Object.prototype.hasOwnProperty.call(a,l)?Array.isArray(r[p])?r[p].push(f):r[p]=[r[p],f]:r[p]=f}return r}function oe(t){switch(typeof t){case"string":return t;case"boolean":return t?"true":"false";case"number":return isFinite(t)?t:"";default:return""}}function ae(i,n,r,t){return n=n||"&",r=r||"=",null===i&&(i=void 0),"object"==typeof i?Object.keys(i).map(function(t){var e=encodeURIComponent(oe(t))+r;return Array.isArray(i[t])?i[t].map(function(t){return e+encodeURIComponent(oe(t))}).join(n):e+encodeURIComponent(oe(i[t]))}).join(n):t?encodeURIComponent(oe(t))+r+encodeURIComponent(oe(i)):""}var le=Pt(function(t,e){e.decode=e.parse=se,e.encode=e.stringify=ae}),he=Ge;function ue(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}var ce,de,pe,fe,ge,me,ye,_e,ve,be,we,Se,xe,Te,Ie,Pe,Ce,Ee,Ae,Me=/^([a-z0-9.+-]+:)/i,Be=/:[0-9]*$/,Re=/^(\/\/?(?!\/)[^\?\s]*)(\?[^\s]*)?$/,Oe=["{","}","|","\\","^","`"].concat(["<",">",'"',"`"," ","\r","\n","\t"]),ke=["'"].concat(Oe),De=["%","/","?",";","#"].concat(ke),Fe=["/","?","#"],Ne=/^[+a-z0-9A-Z_-]{0,63}$/,Le=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,Ue={javascript:!0,"javascript:":!0},ze={javascript:!0,"javascript:":!0},We={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0};function Ge(t,e,i){if(t&&ie(t)&&t instanceof ue)return t;var n=new ue;return n.parse(t,e,i),n}ue.prototype.parse=function(t,e,i){if(!ee(t))throw new TypeError("Parameter 'url' must be a string, not "+typeof t);var n=t.indexOf("?"),r=-1!==n&&n<t.indexOf("#")?"?":"#",s=t.split(r);s[0]=s[0].replace(/\\/g,"/");var o=t=s.join(r);if(o=o.trim(),!i&&1===t.split("#").length){var a=Re.exec(o);if(a)return this.path=o,this.href=o,this.pathname=a[1],a[2]?(this.search=a[2],this.query=e?le.parse(this.search.substr(1)):this.search.substr(1)):e&&(this.search="",this.query={}),this}var l=Me.exec(o);if(l){var h=(l=l[0]).toLowerCase();this.protocol=h,o=o.substr(l.length)}if(i||l||o.match(/^\/\/[^@\/]+@[^@\/]+/)){var u="//"===o.substr(0,2);!u||l&&ze[l]||(o=o.substr(2),this.slashes=!0)}if(!ze[l]&&(u||l&&!We[l])){for(var c,d,p=-1,f=0;f<Fe.length;f++)-1!==(g=o.indexOf(Fe[f]))&&(-1===p||g<p)&&(p=g);for(-1!==(d=-1===p?o.lastIndexOf("@"):o.lastIndexOf("@",p))&&(c=o.slice(0,d),o=o.slice(d+1),this.auth=decodeURIComponent(c)),p=-1,f=0;f<De.length;f++){var g;-1!==(g=o.indexOf(De[f]))&&(-1===p||g<p)&&(p=g)}-1===p&&(p=o.length),this.host=o.slice(0,p),o=o.slice(p),this.parseHost(),this.hostname=this.hostname||"";var m="["===this.hostname[0]&&"]"===this.hostname[this.hostname.length-1];if(!m)for(var y=this.hostname.split(/\./),_=(f=0,y.length);f<_;f++){var v=y[f];if(v&&!v.match(Ne)){for(var b="",w=0,S=v.length;w<S;w++)127<v.charCodeAt(w)?b+="x":b+=v[w];if(!b.match(Ne)){var x=y.slice(0,f),T=y.slice(f+1),I=v.match(Le);I&&(x.push(I[1]),T.unshift(I[2])),T.length&&(o="/"+T.join(".")+o),this.hostname=x.join(".");break}}}255<this.hostname.length?this.hostname="":this.hostname=this.hostname.toLowerCase(),m||(this.hostname=te.toASCII(this.hostname));var P=this.port?":"+this.port:"",C=this.hostname||"";this.host=C+P,this.href+=this.host,m&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),"/"!==o[0]&&(o="/"+o))}if(!Ue[h])for(f=0,_=ke.length;f<_;f++){var E=ke[f];if(-1!==o.indexOf(E)){var A=encodeURIComponent(E);A===E&&(A=escape(E)),o=o.split(E).join(A)}}var M=o.indexOf("#");-1!==M&&(this.hash=o.substr(M),o=o.slice(0,M));var B=o.indexOf("?");if(-1!==B?(this.search=o.substr(B),this.query=o.substr(B+1),e&&(this.query=le.parse(this.query)),o=o.slice(0,B)):e&&(this.search="",this.query={}),o&&(this.pathname=o),We[h]&&this.hostname&&!this.pathname&&(this.pathname="/"),this.pathname||this.search){P=this.pathname||"";var R=this.search||"";this.path=P+R}return this.href=this.format(),this},ue.prototype.format=function(){var t=this.auth||"";t&&(t=(t=encodeURIComponent(t)).replace(/%3A/i,":"),t+="@");var e=this.protocol||"",i=this.pathname||"",n=this.hash||"",r=!1,s="";this.host?r=t+this.host:this.hostname&&(r=t+(-1===this.hostname.indexOf(":")?this.hostname:"["+this.hostname+"]"),this.port&&(r+=":"+this.port)),this.query&&ie(this.query)&&Object.keys(this.query).length&&(s=le.stringify(this.query));var o=this.search||s&&"?"+s||"";return e&&":"!==e.substr(-1)&&(e+=":"),this.slashes||(!e||We[e])&&!1!==r?(r="//"+(r||""),i&&"/"!==i.charAt(0)&&(i="/"+i)):r=r||"",n&&"#"!==n.charAt(0)&&(n="#"+n),o&&"?"!==o.charAt(0)&&(o="?"+o),e+r+(i=i.replace(/[?#]/g,function(t){return encodeURIComponent(t)}))+(o=o.replace("#","%23"))+n},ue.prototype.resolve=function(t){return this.resolveObject(Ge(t,!1,!0)).format()},ue.prototype.resolveObject=function(t){if(ee(t)){var e=new ue;e.parse(t,!1,!0),t=e}for(var i=new ue,n=Object.keys(this),r=0;r<n.length;r++){var s=n[r];i[s]=this[s]}if(i.hash=t.hash,""===t.href)return i.href=i.format(),i;if(t.slashes&&!t.protocol){for(var o=Object.keys(t),a=0;a<o.length;a++){var l=o[a];"protocol"!==l&&(i[l]=t[l])}return We[i.protocol]&&i.hostname&&!i.pathname&&(i.path=i.pathname="/"),i.href=i.format(),i}if(t.protocol&&t.protocol!==i.protocol){if(!We[t.protocol]){for(var h=Object.keys(t),u=0;u<h.length;u++){var c=h[u];i[c]=t[c]}return i.href=i.format(),i}if(i.protocol=t.protocol,t.host||ze[t.protocol])i.pathname=t.pathname;else{for(var d=(t.pathname||"").split("/");d.length&&!(t.host=d.shift()););t.host||(t.host=""),t.hostname||(t.hostname=""),""!==d[0]&&d.unshift(""),d.length<2&&d.unshift(""),i.pathname=d.join("/")}if(i.search=t.search,i.query=t.query,i.host=t.host||"",i.auth=t.auth,i.hostname=t.hostname||t.host,i.port=t.port,i.pathname||i.search){var p=i.pathname||"",f=i.search||"";i.path=p+f}return i.slashes=i.slashes||t.slashes,i.href=i.format(),i}var g=i.pathname&&"/"===i.pathname.charAt(0),m=t.host||t.pathname&&"/"===t.pathname.charAt(0),y=m||g||i.host&&t.pathname,_=y,v=i.pathname&&i.pathname.split("/")||[],b=(d=t.pathname&&t.pathname.split("/")||[],i.protocol&&!We[i.protocol]);if(b&&(i.hostname="",i.port=null,i.host&&(""===v[0]?v[0]=i.host:v.unshift(i.host)),i.host="",t.protocol&&(t.hostname=null,t.port=null,t.host&&(""===d[0]?d[0]=t.host:d.unshift(t.host)),t.host=null),y=y&&(""===d[0]||""===v[0])),m)i.host=t.host||""===t.host?t.host:i.host,i.hostname=t.hostname||""===t.hostname?t.hostname:i.hostname,i.search=t.search,i.query=t.query,v=d;else if(d.length)(v=v||[]).pop(),v=v.concat(d),i.search=t.search,i.query=t.query;else if(!re(t.search))return b&&(i.hostname=i.host=v.shift(),(I=!!(i.host&&0<i.host.indexOf("@"))&&i.host.split("@"))&&(i.auth=I.shift(),i.host=i.hostname=I.shift())),i.search=t.search,i.query=t.query,ne(i.pathname)&&ne(i.search)||(i.path=(i.pathname?i.pathname:"")+(i.search?i.search:"")),i.href=i.format(),i;if(!v.length)return i.pathname=null,i.search?i.path="/"+i.search:i.path=null,i.href=i.format(),i;for(var w=v.slice(-1)[0],S=(i.host||t.host||1<v.length)&&("."===w||".."===w)||""===w,x=0,T=v.length;0<=T;T--)"."===(w=v[T])?v.splice(T,1):".."===w?(v.splice(T,1),x++):x&&(v.splice(T,1),x--);if(!y&&!_)for(;x--;)v.unshift("..");!y||""===v[0]||v[0]&&"/"===v[0].charAt(0)||v.unshift(""),S&&"/"!==v.join("/").substr(-1)&&v.push("");var I,P=""===v[0]||v[0]&&"/"===v[0].charAt(0);return b&&(i.hostname=i.host=P?"":v.length?v.shift():"",(I=!!(i.host&&0<i.host.indexOf("@"))&&i.host.split("@"))&&(i.auth=I.shift(),i.host=i.hostname=I.shift())),(y=y||i.host&&v.length)&&!P&&v.unshift(""),v.length?i.pathname=v.join("/"):(i.pathname=null,i.path=null),ne(i.pathname)&&ne(i.search)||(i.path=(i.pathname?i.pathname:"")+(i.search?i.search:"")),i.auth=t.auth||i.auth,i.slashes=i.slashes||t.slashes,i.href=i.format(),i},ue.prototype.parseHost=function(){var t=this.host,e=Be.exec(t);e&&(":"!==(e=e[0])&&(this.port=e.substr(1)),t=t.substr(0,t.length-e.length)),t&&(this.hostname=t)},(Ae=nt.ENV||(nt.ENV={}))[Ae.WEBGL_LEGACY=0]="WEBGL_LEGACY",Ae[Ae.WEBGL=1]="WEBGL",Ae[Ae.WEBGL2=2]="WEBGL2",(Ee=nt.RENDERER_TYPE||(nt.RENDERER_TYPE={}))[Ee.UNKNOWN=0]="UNKNOWN",Ee[Ee.WEBGL=1]="WEBGL",Ee[Ee.CANVAS=2]="CANVAS",(Ce=nt.BUFFER_BITS||(nt.BUFFER_BITS={}))[Ce.COLOR=16384]="COLOR",Ce[Ce.DEPTH=256]="DEPTH",Ce[Ce.STENCIL=1024]="STENCIL",(Pe=nt.BLEND_MODES||(nt.BLEND_MODES={}))[Pe.NORMAL=0]="NORMAL",Pe[Pe.ADD=1]="ADD",Pe[Pe.MULTIPLY=2]="MULTIPLY",Pe[Pe.SCREEN=3]="SCREEN",Pe[Pe.OVERLAY=4]="OVERLAY",Pe[Pe.DARKEN=5]="DARKEN",Pe[Pe.LIGHTEN=6]="LIGHTEN",Pe[Pe.COLOR_DODGE=7]="COLOR_DODGE",Pe[Pe.COLOR_BURN=8]="COLOR_BURN",Pe[Pe.HARD_LIGHT=9]="HARD_LIGHT",Pe[Pe.SOFT_LIGHT=10]="SOFT_LIGHT",Pe[Pe.DIFFERENCE=11]="DIFFERENCE",Pe[Pe.EXCLUSION=12]="EXCLUSION",Pe[Pe.HUE=13]="HUE",Pe[Pe.SATURATION=14]="SATURATION",Pe[Pe.COLOR=15]="COLOR",Pe[Pe.LUMINOSITY=16]="LUMINOSITY",Pe[Pe.NORMAL_NPM=17]="NORMAL_NPM",Pe[Pe.ADD_NPM=18]="ADD_NPM",Pe[Pe.SCREEN_NPM=19]="SCREEN_NPM",Pe[Pe.NONE=20]="NONE",Pe[Pe.SRC_OVER=0]="SRC_OVER",Pe[Pe.SRC_IN=21]="SRC_IN",Pe[Pe.SRC_OUT=22]="SRC_OUT",Pe[Pe.SRC_ATOP=23]="SRC_ATOP",Pe[Pe.DST_OVER=24]="DST_OVER",Pe[Pe.DST_IN=25]="DST_IN",Pe[Pe.DST_OUT=26]="DST_OUT",Pe[Pe.DST_ATOP=27]="DST_ATOP",Pe[Pe.ERASE=26]="ERASE",Pe[Pe.SUBTRACT=28]="SUBTRACT",Pe[Pe.XOR=29]="XOR",(Ie=nt.DRAW_MODES||(nt.DRAW_MODES={}))[Ie.POINTS=0]="POINTS",Ie[Ie.LINES=1]="LINES",Ie[Ie.LINE_LOOP=2]="LINE_LOOP",Ie[Ie.LINE_STRIP=3]="LINE_STRIP",Ie[Ie.TRIANGLES=4]="TRIANGLES",Ie[Ie.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",Ie[Ie.TRIANGLE_FAN=6]="TRIANGLE_FAN",(Te=nt.FORMATS||(nt.FORMATS={}))[Te.RGBA=6408]="RGBA",Te[Te.RGB=6407]="RGB",Te[Te.RG=33319]="RG",Te[Te.RED=6403]="RED",Te[Te.RGBA_INTEGER=36249]="RGBA_INTEGER",Te[Te.RGB_INTEGER=36248]="RGB_INTEGER",Te[Te.RG_INTEGER=33320]="RG_INTEGER",Te[Te.RED_INTEGER=36244]="RED_INTEGER",Te[Te.ALPHA=6406]="ALPHA",Te[Te.LUMINANCE=6409]="LUMINANCE",Te[Te.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",Te[Te.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",Te[Te.DEPTH_STENCIL=34041]="DEPTH_STENCIL",(xe=nt.TARGETS||(nt.TARGETS={}))[xe.TEXTURE_2D=3553]="TEXTURE_2D",xe[xe.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",xe[xe.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",xe[xe.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",xe[xe.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",xe[xe.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",xe[xe.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",xe[xe.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",xe[xe.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",(Se=nt.TYPES||(nt.TYPES={}))[Se.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",Se[Se.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",Se[Se.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",Se[Se.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",Se[Se.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",Se[Se.UNSIGNED_INT=5125]="UNSIGNED_INT",Se[Se.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",Se[Se.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",Se[Se.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",Se[Se.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",Se[Se.BYTE=5120]="BYTE",Se[Se.SHORT=5122]="SHORT",Se[Se.INT=5124]="INT",Se[Se.FLOAT=5126]="FLOAT",Se[Se.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV",Se[Se.HALF_FLOAT=36193]="HALF_FLOAT",(we=nt.SAMPLER_TYPES||(nt.SAMPLER_TYPES={}))[we.FLOAT=0]="FLOAT",we[we.INT=1]="INT",we[we.UINT=2]="UINT",(be=nt.SCALE_MODES||(nt.SCALE_MODES={}))[be.NEAREST=0]="NEAREST",be[be.LINEAR=1]="LINEAR",(ve=nt.WRAP_MODES||(nt.WRAP_MODES={}))[ve.CLAMP=33071]="CLAMP",ve[ve.REPEAT=10497]="REPEAT",ve[ve.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",(_e=nt.MIPMAP_MODES||(nt.MIPMAP_MODES={}))[_e.OFF=0]="OFF",_e[_e.POW2=1]="POW2",_e[_e.ON=2]="ON",_e[_e.ON_MANUAL=3]="ON_MANUAL",(ye=nt.ALPHA_MODES||(nt.ALPHA_MODES={}))[ye.NPM=0]="NPM",ye[ye.UNPACK=1]="UNPACK",ye[ye.PMA=2]="PMA",ye[ye.NO_PREMULTIPLIED_ALPHA=0]="NO_PREMULTIPLIED_ALPHA",ye[ye.PREMULTIPLY_ON_UPLOAD=1]="PREMULTIPLY_ON_UPLOAD",ye[ye.PREMULTIPLY_ALPHA=2]="PREMULTIPLY_ALPHA",ye[ye.PREMULTIPLIED_ALPHA=2]="PREMULTIPLIED_ALPHA",(me=nt.CLEAR_MODES||(nt.CLEAR_MODES={}))[me.NO=0]="NO",me[me.YES=1]="YES",me[me.AUTO=2]="AUTO",me[me.BLEND=0]="BLEND",me[me.CLEAR=1]="CLEAR",me[me.BLIT=2]="BLIT",(ge=nt.GC_MODES||(nt.GC_MODES={}))[ge.AUTO=0]="AUTO",ge[ge.MANUAL=1]="MANUAL",(fe=nt.PRECISION||(nt.PRECISION={})).LOW="lowp",fe.MEDIUM="mediump",fe.HIGH="highp",(pe=nt.MASK_TYPES||(nt.MASK_TYPES={}))[pe.NONE=0]="NONE",pe[pe.SCISSOR=1]="SCISSOR",pe[pe.STENCIL=2]="STENCIL",pe[pe.SPRITE=3]="SPRITE",(de=nt.MSAA_QUALITY||(nt.MSAA_QUALITY={}))[de.NONE=0]="NONE",de[de.LOW=2]="LOW",de[de.MEDIUM=4]="MEDIUM",de[de.HIGH=8]="HIGH",(ce=nt.BUFFER_TYPE||(nt.BUFFER_TYPE={}))[ce.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",ce[ce.ARRAY_BUFFER=34962]="ARRAY_BUFFER",ce[ce.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER";var He={parse:he,format:function(t){return ee(t)&&(t=Ge(t)),t instanceof ue?t.format():ue.prototype.format.call(t)},resolve:function(t,e){return Ge(t,!1,!0).resolve(e)}};Tt.RETINA_PREFIX=/@([0-9\.]+)x/;var Xe,je=Tt.FAIL_IF_MAJOR_PERFORMANCE_CAVEAT=!1,Ve="6.2.1";function Ye(t){var e;if(!je){if(-1<navigator.userAgent.toLowerCase().indexOf("chrome")){var i=["\n %c %c %c PixiJS "+Ve+" - ✰ "+t+" ✰  %c  %c  http://www.pixijs.com/  %c %c ♥%c♥%c♥ \n\n","background: #ff66a5; padding:5px 0;","background: #ff66a5; padding:5px 0;","color: #ff66a5; background: #030307; padding:5px 0;","background: #ff66a5; padding:5px 0;","background: #ffc3dc; padding:5px 0;","background: #ff66a5; padding:5px 0;","color: #ff2424; background: #fff; padding:5px 0;","color: #ff2424; background: #fff; padding:5px 0;","color: #ff2424; background: #fff; padding:5px 0;"];(e=self.console).log.apply(e,i)}else self.console&&self.console.log("PixiJS "+Ve+" - "+t+" - http://www.pixijs.com/");je=!0}}function qe(){return void 0===Xe&&(Xe=function(){var t={stencil:!0,failIfMajorPerformanceCaveat:Tt.FAIL_IF_MAJOR_PERFORMANCE_CAVEAT};try{if(!self.WebGLRenderingContext)return!1;var e=document.createElement("canvas"),i=e.getContext("webgl",t)||e.getContext("experimental-webgl",t),n=!(!i||!i.getContextAttributes().stencil);if(i){var r=i.getExtension("WEBGL_lose_context");r&&r.loseContext()}return i=null,n}catch(t){return!1}}()),Xe}var Ke={aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgreen:"#006400",darkgrey:"#a9a9a9",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkslategrey:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",goldenrod:"#daa520",gold:"#ffd700",gray:"#808080",green:"#008000",greenyellow:"#adff2f",grey:"#808080",honeydew:"#f0fff0",hotpink:"#ff69b4",indianred:"#cd5c5c",indigo:"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",lavenderblush:"#fff0f5",lavender:"#e6e6fa",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrodyellow:"#fafad2",lightgray:"#d3d3d3",lightgreen:"#90ee90",lightgrey:"#d3d3d3",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370db",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#db7093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",rebeccapurple:"#663399",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",slategrey:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32"};function $e(t,e){return void 0===e&&(e=[]),e[0]=(t>>16&255)/255,e[1]=(t>>8&255)/255,e[2]=(255&t)/255,e}function Qe(t){var e=t.toString(16);return"#"+("000000".substr(0,6-e.length)+e)}function Je(t){return"string"==typeof t&&"#"===(t=Ke[t.toLowerCase()]||t)[0]&&(t=t.substr(1)),parseInt(t,16)}function Ze(t){return(255*t[0]<<16)+(255*t[1]<<8)+(255*t[2]|0)}var ti=function(){for(var t=[],e=[],i=0;i<32;i++)e[t[i]=i]=i;t[nt.BLEND_MODES.NORMAL_NPM]=nt.BLEND_MODES.NORMAL,t[nt.BLEND_MODES.ADD_NPM]=nt.BLEND_MODES.ADD,t[nt.BLEND_MODES.SCREEN_NPM]=nt.BLEND_MODES.SCREEN,e[nt.BLEND_MODES.NORMAL]=nt.BLEND_MODES.NORMAL_NPM,e[nt.BLEND_MODES.ADD]=nt.BLEND_MODES.ADD_NPM,e[nt.BLEND_MODES.SCREEN]=nt.BLEND_MODES.SCREEN_NPM;var n=[];return n.push(e),n.push(t),n}();function ei(t,e){return ti[e?1:0][t]}function ii(t,e,i,n){return i=i||new Float32Array(4),n||void 0===n?(i[0]=t[0]*e,i[1]=t[1]*e,i[2]=t[2]*e):(i[0]=t[0],i[1]=t[1],i[2]=t[2]),i[3]=e,i}function ni(t,e){if(1===e)return(255*e<<24)+t;if(0===e)return 0;var i=t>>16&255,n=t>>8&255;return(255*e<<24)+((i=i*e+.5|0)<<16)+((n=n*e+.5|0)<<8)+((255&t)*e+.5|0)}function ri(t,e,i,n){return(i=i||new Float32Array(4))[0]=(t>>16&255)/255,i[1]=(t>>8&255)/255,i[2]=(255&t)/255,!n&&void 0!==n||(i[0]*=e,i[1]*=e,i[2]*=e),i[3]=e,i}function si(t,e){void 0===e&&(e=null);var i=6*t;if((e=e||new Uint16Array(i)).length!==i)throw new Error("Out buffer length is incorrect, got "+e.length+" and expected "+i);for(var n=0,r=0;n<i;n+=6,r+=4)e[n+0]=r+0,e[n+1]=r+1,e[n+2]=r+2,e[n+3]=r+0,e[n+4]=r+2,e[n+5]=r+3;return e}function oi(t){if(4===t.BYTES_PER_ELEMENT)return t instanceof Float32Array?"Float32Array":t instanceof Uint32Array?"Uint32Array":"Int32Array";if(2===t.BYTES_PER_ELEMENT){if(t instanceof Uint16Array)return"Uint16Array"}else if(1===t.BYTES_PER_ELEMENT&&t instanceof Uint8Array)return"Uint8Array";return null}var ai={Float32Array:Float32Array,Uint32Array:Uint32Array,Int32Array:Int32Array,Uint8Array:Uint8Array};function li(t){return t+=0===t?1:0,--t,t|=t>>>1,t|=t>>>2,t|=t>>>4,1+((t|=t>>>8)|t>>>16)}function hi(t){return!(t&t-1||!t)}function ui(t){var e=(65535<t?1:0)<<4,i=(255<(t>>>=e)?1:0)<<3;return e|=i,e|=i=(15<(t>>>=i)?1:0)<<2,(e|=i=(3<(t>>>=i)?1:0)<<1)|(t>>>=i)>>1}function ci(t,e,i){var n,r=t.length;if(!(r<=e||0===i)){var s=r-(i=r<e+i?r-e:i);for(n=e;n<s;++n)t[n]=t[n+i];t.length=s}}function di(t){return 0===t?0:t<0?-1:1}var pi=0;function fi(){return++pi}var gi={},mi={},yi=Object.create(null),_i=Object.create(null),vi=(bi.prototype.clear=function(){this.context.setTransform(1,0,0,1,0,0),this.context.clearRect(0,0,this.canvas.width,this.canvas.height)},bi.prototype.resize=function(t,e){this.canvas.width=Math.round(t*this.resolution),this.canvas.height=Math.round(e*this.resolution)},bi.prototype.destroy=function(){this.context=null,this.canvas=null},Object.defineProperty(bi.prototype,"width",{get:function(){return this.canvas.width},set:function(t){this.canvas.width=Math.round(t)},enumerable:!1,configurable:!0}),Object.defineProperty(bi.prototype,"height",{get:function(){return this.canvas.height},set:function(t){this.canvas.height=Math.round(t)},enumerable:!1,configurable:!0}),bi);function bi(t,e,i){this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"),this.resolution=i||Tt.RESOLUTION,this.resize(t,e)}function wi(t){var e,i,n,r=t.width,s=t.height,o=t.getContext("2d"),a=o.getImageData(0,0,r,s).data,l=a.length,h={top:null,left:null,right:null,bottom:null},u=null;for(e=0;e<l;e+=4)0!==a[e+3]&&(i=e/4%r,n=~~(e/4/r),null===h.top&&(h.top=n),null===h.left?h.left=i:i<h.left&&(h.left=i),null===h.right?h.right=1+i:h.right<i&&(h.right=1+i),null===h.bottom?h.bottom=n:h.bottom<n&&(h.bottom=n));return null!==h.top&&(r=h.right-h.left,s=h.bottom-h.top+1,u=o.getImageData(h.left,h.top,r,s)),{height:s,width:r,data:u}}var Si,xi=/^\s*data:(?:([\w-]+)\/([\w+.-]+))?(?:;charset=([\w-]+))?(?:;(base64))?,(.*)/i;function Ti(t,e){if(void 0===e&&(e=self.location),0===t.indexOf("data:"))return"";e=e||self.location,(Si=Si||document.createElement("a")).href=t;var i=He.parse(Si.href),n=!i.port&&""===e.port||i.port===e.port;return i.hostname===e.hostname&&n&&i.protocol===e.protocol?"":"anonymous"}function Ii(t,e){var i=Tt.RETINA_PREFIX.exec(t);return i?parseFloat(i[1]):void 0!==e?e:1}var Pi,Ci={__proto__:null,BaseTextureCache:_i,CanvasRenderTarget:vi,DATA_URI:xi,ProgramCache:mi,TextureCache:yi,clearTextureCache:function(){var t;for(t in yi)delete yi[t];for(t in _i)delete _i[t]},correctBlendMode:ei,createIndicesForQuads:si,decomposeDataUri:function(t){var e=xi.exec(t);if(e)return{mediaType:e[1]?e[1].toLowerCase():void 0,subType:e[2]?e[2].toLowerCase():void 0,charset:e[3]?e[3].toLowerCase():void 0,encoding:e[4]?e[4].toLowerCase():void 0,data:e[5]}},deprecation:function(t,e,i){if(void 0===i&&(i=3),!gi[e]){var n=(new Error).stack;void 0===n?console.warn("PixiJS Deprecation Warning: ",e+"\nDeprecated since v"+t):(n=n.split("\n").splice(i).join("\n"),console.groupCollapsed?(console.groupCollapsed("%cPixiJS Deprecation Warning: %c%s","color:#614108;background:#fffbe6","font-weight:normal;color:#614108;background:#fffbe6",e+"\nDeprecated since v"+t),console.warn(n),console.groupEnd()):(console.warn("PixiJS Deprecation Warning: ",e+"\nDeprecated since v"+t),console.warn(n))),gi[e]=!0}},destroyTextureCache:function(){var t;for(t in yi)yi[t].destroy();for(t in _i)_i[t].destroy()},determineCrossOrigin:Ti,getBufferType:oi,getResolutionOfUrl:Ii,hex2rgb:$e,hex2string:Qe,interleaveTypedArrays:function(t,e){for(var i=0,n=0,r={},s=0;s<t.length;s++)n+=e[s],i+=t[s].length;var o=new ArrayBuffer(4*i),a=null,l=0;for(s=0;s<t.length;s++){var h=e[s],u=t[s],c=oi(u);r[c]||(r[c]=new ai[c](o)),a=r[c];for(var d=0;d<u.length;d++)a[(d/h|0)*n+l+d%h]=u[d];l+=h}return new Float32Array(o)},isPow2:hi,isWebGLSupported:qe,log2:ui,nextPow2:li,premultiplyBlendMode:ti,premultiplyRgba:ii,premultiplyTint:ni,premultiplyTintToRgba:ri,removeItems:ci,rgb2hex:Ze,sayHello:Ye,sign:di,skipHello:function(){je=!0},string2hex:Je,trimCanvas:wi,uid:fi,url:He,isMobile:wt,EventEmitter:Ct,earcut:Et},Ei=2*Math.PI,Ai=180/Math.PI,Mi=Math.PI/180;(Pi=nt.SHAPES||(nt.SHAPES={}))[Pi.POLY=0]="POLY",Pi[Pi.RECT=1]="RECT",Pi[Pi.CIRC=2]="CIRC",Pi[Pi.ELIP=3]="ELIP",Pi[Pi.RREC=4]="RREC";var Bi=(Object.defineProperty(Zi.prototype,"left",{get:function(){return this.x},enumerable:!1,configurable:!0}),Object.defineProperty(Zi.prototype,"right",{get:function(){return this.x+this.width},enumerable:!1,configurable:!0}),Object.defineProperty(Zi.prototype,"top",{get:function(){return this.y},enumerable:!1,configurable:!0}),Object.defineProperty(Zi.prototype,"bottom",{get:function(){return this.y+this.height},enumerable:!1,configurable:!0}),Object.defineProperty(Zi,"EMPTY",{get:function(){return new Zi(0,0,0,0)},enumerable:!1,configurable:!0}),Zi.prototype.clone=function(){return new Zi(this.x,this.y,this.width,this.height)},Zi.prototype.copyFrom=function(t){return this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height,this},Zi.prototype.copyTo=function(t){return t.x=this.x,t.y=this.y,t.width=this.width,t.height=this.height,t},Zi.prototype.contains=function(t,e){return!(this.width<=0||this.height<=0)&&t>=this.x&&t<this.x+this.width&&e>=this.y&&e<this.y+this.height},Zi.prototype.pad=function(t,e){return void 0===t&&(t=0),void 0===e&&(e=t),this.x-=t,this.y-=e,this.width+=2*t,this.height+=2*e,this},Zi.prototype.fit=function(t){var e=Math.max(this.x,t.x),i=Math.min(this.x+this.width,t.x+t.width),n=Math.max(this.y,t.y),r=Math.min(this.y+this.height,t.y+t.height);return this.x=e,this.width=Math.max(i-e,0),this.y=n,this.height=Math.max(r-n,0),this},Zi.prototype.ceil=function(t,e){void 0===t&&(t=1),void 0===e&&(e=.001);var i=Math.ceil((this.x+this.width-e)*t)/t,n=Math.ceil((this.y+this.height-e)*t)/t;return this.x=Math.floor((this.x+e)*t)/t,this.y=Math.floor((this.y+e)*t)/t,this.width=i-this.x,this.height=n-this.y,this},Zi.prototype.enlarge=function(t){var e=Math.min(this.x,t.x),i=Math.max(this.x+this.width,t.x+t.width),n=Math.min(this.y,t.y),r=Math.max(this.y+this.height,t.y+t.height);return this.x=e,this.width=i-e,this.y=n,this.height=r-n,this},Zi),Ri=(Ji.prototype.clone=function(){return new Ji(this.x,this.y,this.radius)},Ji.prototype.contains=function(t,e){if(this.radius<=0)return!1;var i=this.radius*this.radius,n=this.x-t,r=this.y-e;return(n*=n)+(r*=r)<=i},Ji.prototype.getBounds=function(){return new Bi(this.x-this.radius,this.y-this.radius,2*this.radius,2*this.radius)},Ji),Oi=(Qi.prototype.clone=function(){return new Qi(this.x,this.y,this.width,this.height)},Qi.prototype.contains=function(t,e){if(this.width<=0||this.height<=0)return!1;var i=(t-this.x)/this.width,n=(e-this.y)/this.height;return(i*=i)+(n*=n)<=1},Qi.prototype.getBounds=function(){return new Bi(this.x-this.width,this.y-this.height,this.width,this.height)},Qi),ki=($i.prototype.clone=function(){var t=new $i(this.points.slice());return t.closeStroke=this.closeStroke,t},$i.prototype.contains=function(t,e){for(var i=!1,n=this.points.length/2,r=0,s=n-1;r<n;s=r++){var o=this.points[2*r],a=this.points[2*r+1],l=this.points[2*s],h=this.points[2*s+1];e<a!=e<h&&t<(e-a)/(h-a)*(l-o)+o&&(i=!i)}return i},$i),Di=(Ki.prototype.clone=function(){return new Ki(this.x,this.y,this.width,this.height,this.radius)},Ki.prototype.contains=function(t,e){if(this.width<=0||this.height<=0)return!1;if(t>=this.x&&t<=this.x+this.width&&e>=this.y&&e<=this.y+this.height){var i=Math.max(0,Math.min(this.radius,Math.min(this.width,this.height)/2));if(e>=this.y+i&&e<=this.y+this.height-i||t>=this.x+i&&t<=this.x+this.width-i)return!0;var n=t-(this.x+i),r=e-(this.y+i),s=i*i;if(n*n+r*r<=s)return!0;if((n=t-(this.x+this.width-i))*n+r*r<=s)return!0;if(n*n+(r=e-(this.y+this.height-i))*r<=s)return!0;if((n=t-(this.x+i))*n+r*r<=s)return!0}return!1},Ki),Fi=(qi.prototype.clone=function(){return new qi(this.x,this.y)},qi.prototype.copyFrom=function(t){return this.set(t.x,t.y),this},qi.prototype.copyTo=function(t){return t.set(this.x,this.y),t},qi.prototype.equals=function(t){return t.x===this.x&&t.y===this.y},qi.prototype.set=function(t,e){return void 0===t&&(t=0),void 0===e&&(e=t),this.x=t,this.y=e,this},qi),Ni=(Yi.prototype.clone=function(t,e){return void 0===t&&(t=this.cb),void 0===e&&(e=this.scope),new Yi(t,e,this._x,this._y)},Yi.prototype.set=function(t,e){return void 0===t&&(t=0),void 0===e&&(e=t),this._x===t&&this._y===e||(this._x=t,this._y=e,this.cb.call(this.scope)),this},Yi.prototype.copyFrom=function(t){return this._x===t.x&&this._y===t.y||(this._x=t.x,this._y=t.y,this.cb.call(this.scope)),this},Yi.prototype.copyTo=function(t){return t.set(this._x,this._y),t},Yi.prototype.equals=function(t){return t.x===this._x&&t.y===this._y},Object.defineProperty(Yi.prototype,"x",{get:function(){return this._x},set:function(t){this._x!==t&&(this._x=t,this.cb.call(this.scope))},enumerable:!1,configurable:!0}),Object.defineProperty(Yi.prototype,"y",{get:function(){return this._y},set:function(t){this._y!==t&&(this._y=t,this.cb.call(this.scope))},enumerable:!1,configurable:!0}),Yi),Li=(Vi.prototype.fromArray=function(t){this.a=t[0],this.b=t[1],this.c=t[3],this.d=t[4],this.tx=t[2],this.ty=t[5]},Vi.prototype.set=function(t,e,i,n,r,s){return this.a=t,this.b=e,this.c=i,this.d=n,this.tx=r,this.ty=s,this},Vi.prototype.toArray=function(t,e){this.array||(this.array=new Float32Array(9));var i=e||this.array;return t?(i[0]=this.a,i[1]=this.b,i[2]=0,i[3]=this.c,i[4]=this.d,i[5]=0,i[6]=this.tx,i[7]=this.ty):(i[0]=this.a,i[1]=this.c,i[2]=this.tx,i[3]=this.b,i[4]=this.d,i[5]=this.ty,i[6]=0,i[7]=0),i[8]=1,i},Vi.prototype.apply=function(t,e){e=e||new Fi;var i=t.x,n=t.y;return e.x=this.a*i+this.c*n+this.tx,e.y=this.b*i+this.d*n+this.ty,e},Vi.prototype.applyInverse=function(t,e){e=e||new Fi;var i=1/(this.a*this.d+this.c*-this.b),n=t.x,r=t.y;return e.x=this.d*i*n+-this.c*i*r+(this.ty*this.c-this.tx*this.d)*i,e.y=this.a*i*r+-this.b*i*n+(-this.ty*this.a+this.tx*this.b)*i,e},Vi.prototype.translate=function(t,e){return this.tx+=t,this.ty+=e,this},Vi.prototype.scale=function(t,e){return this.a*=t,this.d*=e,this.c*=t,this.b*=e,this.tx*=t,this.ty*=e,this},Vi.prototype.rotate=function(t){var e=Math.cos(t),i=Math.sin(t),n=this.a,r=this.c,s=this.tx;return this.a=n*e-this.b*i,this.b=n*i+this.b*e,this.c=r*e-this.d*i,this.d=r*i+this.d*e,this.tx=s*e-this.ty*i,this.ty=s*i+this.ty*e,this},Vi.prototype.append=function(t){var e=this.a,i=this.b,n=this.c,r=this.d;return this.a=t.a*e+t.b*n,this.b=t.a*i+t.b*r,this.c=t.c*e+t.d*n,this.d=t.c*i+t.d*r,this.tx=t.tx*e+t.ty*n+this.tx,this.ty=t.tx*i+t.ty*r+this.ty,this},Vi.prototype.setTransform=function(t,e,i,n,r,s,o,a,l){return this.a=Math.cos(o+l)*r,this.b=Math.sin(o+l)*r,this.c=-Math.sin(o-a)*s,this.d=Math.cos(o-a)*s,this.tx=t-(i*this.a+n*this.c),this.ty=e-(i*this.b+n*this.d),this},Vi.prototype.prepend=function(t){var e=this.tx;if(1!==t.a||0!==t.b||0!==t.c||1!==t.d){var i=this.a,n=this.c;this.a=i*t.a+this.b*t.c,this.b=i*t.b+this.b*t.d,this.c=n*t.a+this.d*t.c,this.d=n*t.b+this.d*t.d}return this.tx=e*t.a+this.ty*t.c+t.tx,this.ty=e*t.b+this.ty*t.d+t.ty,this},Vi.prototype.decompose=function(t){var e=this.a,i=this.b,n=this.c,r=this.d,s=t.pivot,o=-Math.atan2(-n,r),a=Math.atan2(i,e),l=Math.abs(o+a);return l<1e-5||Math.abs(Ei-l)<1e-5?(t.rotation=a,t.skew.x=t.skew.y=0):(t.rotation=0,t.skew.x=o,t.skew.y=a),t.scale.x=Math.sqrt(e*e+i*i),t.scale.y=Math.sqrt(n*n+r*r),t.position.x=this.tx+(s.x*e+s.y*n),t.position.y=this.ty+(s.x*i+s.y*r),t},Vi.prototype.invert=function(){var t=this.a,e=this.b,i=this.c,n=this.d,r=this.tx,s=t*n-e*i;return this.a=n/s,this.b=-e/s,this.c=-i/s,this.d=t/s,this.tx=(i*this.ty-n*r)/s,this.ty=-(t*this.ty-e*r)/s,this},Vi.prototype.identity=function(){return this.a=1,this.b=0,this.c=0,this.d=1,this.tx=0,this.ty=0,this},Vi.prototype.clone=function(){var t=new Vi;return t.a=this.a,t.b=this.b,t.c=this.c,t.d=this.d,t.tx=this.tx,t.ty=this.ty,t},Vi.prototype.copyTo=function(t){return t.a=this.a,t.b=this.b,t.c=this.c,t.d=this.d,t.tx=this.tx,t.ty=this.ty,t},Vi.prototype.copyFrom=function(t){return this.a=t.a,this.b=t.b,this.c=t.c,this.d=t.d,this.tx=t.tx,this.ty=t.ty,this},Object.defineProperty(Vi,"IDENTITY",{get:function(){return new Vi},enumerable:!1,configurable:!0}),Object.defineProperty(Vi,"TEMP_MATRIX",{get:function(){return new Vi},enumerable:!1,configurable:!0}),Vi),Ui=[1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1,0,1],zi=[0,1,1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1],Wi=[0,-1,-1,-1,0,1,1,1,0,1,1,1,0,-1,-1,-1],Gi=[1,1,0,-1,-1,-1,0,1,-1,-1,0,1,1,1,0,-1],Hi=[],Xi=[],ji=Math.sign;function Vi(t,e,i,n,r,s){void 0===t&&(t=1),void 0===e&&(e=0),void 0===i&&(i=0),void 0===n&&(n=1),void 0===r&&(r=0),void 0===s&&(s=0),this.array=null,this.a=t,this.b=e,this.c=i,this.d=n,this.tx=r,this.ty=s}function Yi(t,e,i,n){void 0===i&&(i=0),void 0===n&&(n=0),this._x=i,this._y=n,this.cb=t,this.scope=e}function qi(t,e){void 0===t&&(t=0),void 0===e&&(e=0),this.x=0,this.y=0,this.x=t,this.y=e}function Ki(t,e,i,n,r){void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),void 0===n&&(n=0),void 0===r&&(r=20),this.x=t,this.y=e,this.width=i,this.height=n,this.radius=r,this.type=nt.SHAPES.RREC}function $i(){for(var t=arguments,e=[],i=0;i<arguments.length;i++)e[i]=t[i];var n=Array.isArray(e[0])?e[0]:e;if("number"!=typeof n[0]){for(var r=[],s=0,o=n.length;s<o;s++)r.push(n[s].x,n[s].y);n=r}this.points=n,this.type=nt.SHAPES.POLY,this.closeStroke=!0}function Qi(t,e,i,n){void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),void 0===n&&(n=0),this.x=t,this.y=e,this.width=i,this.height=n,this.type=nt.SHAPES.ELIP}function Ji(t,e,i){void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),this.x=t,this.y=e,this.radius=i,this.type=nt.SHAPES.CIRC}function Zi(t,e,i,n){void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),void 0===n&&(n=0),this.x=Number(t),this.y=Number(e),this.width=Number(i),this.height=Number(n),this.type=nt.SHAPES.RECT}!function(){for(var t=0;t<16;t++){var e=[];Hi.push(e);for(var i=0;i<16;i++)for(var n=ji(Ui[t]*Ui[i]+Wi[t]*zi[i]),r=ji(zi[t]*Ui[i]+Gi[t]*zi[i]),s=ji(Ui[t]*Wi[i]+Wi[t]*Gi[i]),o=ji(zi[t]*Wi[i]+Gi[t]*Gi[i]),a=0;a<16;a++)if(Ui[a]===n&&zi[a]===r&&Wi[a]===s&&Gi[a]===o){e.push(a);break}}for(t=0;t<16;t++){var l=new Li;l.set(Ui[t],zi[t],Wi[t],Gi[t],0,0),Xi.push(l)}}();var tn={E:0,SE:1,S:2,SW:3,W:4,NW:5,N:6,NE:7,MIRROR_VERTICAL:8,MAIN_DIAGONAL:10,MIRROR_HORIZONTAL:12,REVERSE_DIAGONAL:14,uX:function(t){return Ui[t]},uY:function(t){return zi[t]},vX:function(t){return Wi[t]},vY:function(t){return Gi[t]},inv:function(t){return 8&t?15&t:7&-t},add:function(t,e){return Hi[t][e]},sub:function(t,e){return Hi[t][tn.inv(e)]},rotate180:function(t){return 4^t},isVertical:function(t){return 2==(3&t)},byDirection:function(t,e){return 2*Math.abs(t)<=Math.abs(e)?0<=e?tn.S:tn.N:2*Math.abs(e)<=Math.abs(t)?0<t?tn.E:tn.W:0<e?0<t?tn.SE:tn.SW:0<t?tn.NE:tn.NW},matrixAppendRotationInv:function(t,e,i,n){void 0===i&&(i=0),void 0===n&&(n=0);var r=Xi[tn.inv(e)];r.tx=i,r.ty=n,t.append(r)}},en=(nn.prototype.onChange=function(){this._localID++},nn.prototype.updateSkew=function(){this._cx=Math.cos(this._rotation+this.skew.y),this._sx=Math.sin(this._rotation+this.skew.y),this._cy=-Math.sin(this._rotation-this.skew.x),this._sy=Math.cos(this._rotation-this.skew.x),this._localID++},nn.prototype.updateLocalTransform=function(){var t=this.localTransform;this._localID!==this._currentLocalID&&(t.a=this._cx*this.scale.x,t.b=this._sx*this.scale.x,t.c=this._cy*this.scale.y,t.d=this._sy*this.scale.y,t.tx=this.position.x-(this.pivot.x*t.a+this.pivot.y*t.c),t.ty=this.position.y-(this.pivot.x*t.b+this.pivot.y*t.d),this._currentLocalID=this._localID,this._parentID=-1)},nn.prototype.updateTransform=function(t){var e=this.localTransform;if(this._localID!==this._currentLocalID&&(e.a=this._cx*this.scale.x,e.b=this._sx*this.scale.x,e.c=this._cy*this.scale.y,e.d=this._sy*this.scale.y,e.tx=this.position.x-(this.pivot.x*e.a+this.pivot.y*e.c),e.ty=this.position.y-(this.pivot.x*e.b+this.pivot.y*e.d),this._currentLocalID=this._localID,this._parentID=-1),this._parentID!==t._worldID){var i=t.worldTransform,n=this.worldTransform;n.a=e.a*i.a+e.b*i.c,n.b=e.a*i.b+e.b*i.d,n.c=e.c*i.a+e.d*i.c,n.d=e.c*i.b+e.d*i.d,n.tx=e.tx*i.a+e.ty*i.c+i.tx,n.ty=e.tx*i.b+e.ty*i.d+i.ty,this._parentID=t._worldID,this._worldID++}},nn.prototype.setFromMatrix=function(t){t.decompose(this),this._localID++},Object.defineProperty(nn.prototype,"rotation",{get:function(){return this._rotation},set:function(t){this._rotation!==t&&(this._rotation=t,this.updateSkew())},enumerable:!1,configurable:!0}),nn.IDENTITY=new nn,nn);function nn(){this.worldTransform=new Li,this.localTransform=new Li,this.position=new Ni(this.onChange,this,0,0),this.scale=new Ni(this.onChange,this,1,1),this.pivot=new Ni(this.onChange,this,0,0),this.skew=new Ni(this.updateSkew,this,0,0),this._rotation=0,this._cx=1,this._sx=0,this._cy=0,this._sy=1,this._localID=0,this._currentLocalID=0,this._worldID=0,this._parentID=0}Tt.SORTABLE_CHILDREN=!1;var rn=(on.prototype.isEmpty=function(){return this.minX>this.maxX||this.minY>this.maxY},on.prototype.clear=function(){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0},on.prototype.getRectangle=function(t){return this.minX>this.maxX||this.minY>this.maxY?Bi.EMPTY:((t=t||new Bi(0,0,1,1)).x=this.minX,t.y=this.minY,t.width=this.maxX-this.minX,t.height=this.maxY-this.minY,t)},on.prototype.addPoint=function(t){this.minX=Math.min(this.minX,t.x),this.maxX=Math.max(this.maxX,t.x),this.minY=Math.min(this.minY,t.y),this.maxY=Math.max(this.maxY,t.y)},on.prototype.addPointMatrix=function(t,e){var i=t.a,n=t.b,r=t.c,s=t.d,o=t.tx,a=t.ty,l=i*e.x+r*e.y+o,h=n*e.x+s*e.y+a;this.minX=Math.min(this.minX,l),this.maxX=Math.max(this.maxX,l),this.minY=Math.min(this.minY,h),this.maxY=Math.max(this.maxY,h)},on.prototype.addQuad=function(t){var e=this.minX,i=this.minY,n=this.maxX,r=this.maxY,s=t[0],o=t[1];e=s<e?s:e,i=o<i?o:i,n=n<s?s:n,r=r<o?o:r,e=(s=t[2])<e?s:e,i=(o=t[3])<i?o:i,n=n<s?s:n,r=r<o?o:r,e=(s=t[4])<e?s:e,i=(o=t[5])<i?o:i,n=n<s?s:n,r=r<o?o:r,e=(s=t[6])<e?s:e,i=(o=t[7])<i?o:i,n=n<s?s:n,r=r<o?o:r,this.minX=e,this.minY=i,this.maxX=n,this.maxY=r},on.prototype.addFrame=function(t,e,i,n,r){this.addFrameMatrix(t.worldTransform,e,i,n,r)},on.prototype.addFrameMatrix=function(t,e,i,n,r){var s=t.a,o=t.b,a=t.c,l=t.d,h=t.tx,u=t.ty,c=this.minX,d=this.minY,p=this.maxX,f=this.maxY,g=s*e+a*i+h,m=o*e+l*i+u;c=g<c?g:c,d=m<d?m:d,p=p<g?g:p,f=f<m?m:f,c=(g=s*n+a*i+h)<c?g:c,d=(m=o*n+l*i+u)<d?m:d,p=p<g?g:p,f=f<m?m:f,c=(g=s*e+a*r+h)<c?g:c,d=(m=o*e+l*r+u)<d?m:d,p=p<g?g:p,f=f<m?m:f,c=(g=s*n+a*r+h)<c?g:c,d=(m=o*n+l*r+u)<d?m:d,p=p<g?g:p,f=f<m?m:f,this.minX=c,this.minY=d,this.maxX=p,this.maxY=f},on.prototype.addVertexData=function(t,e,i){for(var n=this.minX,r=this.minY,s=this.maxX,o=this.maxY,a=e;a<i;a+=2){var l=t[a],h=t[a+1];n=l<n?l:n,r=h<r?h:r,s=s<l?l:s,o=o<h?h:o}this.minX=n,this.minY=r,this.maxX=s,this.maxY=o},on.prototype.addVertices=function(t,e,i,n){this.addVerticesMatrix(t.worldTransform,e,i,n)},on.prototype.addVerticesMatrix=function(t,e,i,n,r,s){void 0===r&&(r=0),void 0===s&&(s=r);for(var o=t.a,a=t.b,l=t.c,h=t.d,u=t.tx,c=t.ty,d=this.minX,p=this.minY,f=this.maxX,g=this.maxY,m=i;m<n;m+=2){var y=e[m],_=e[m+1],v=o*y+l*_+u,b=h*_+a*y+c;d=Math.min(d,v-r),f=Math.max(f,v+r),p=Math.min(p,b-s),g=Math.max(g,b+s)}this.minX=d,this.minY=p,this.maxX=f,this.maxY=g},on.prototype.addBounds=function(t){var e=this.minX,i=this.minY,n=this.maxX,r=this.maxY;this.minX=t.minX<e?t.minX:e,this.minY=t.minY<i?t.minY:i,this.maxX=t.maxX>n?t.maxX:n,this.maxY=t.maxY>r?t.maxY:r},on.prototype.addBoundsMask=function(t,e){var i=t.minX>e.minX?t.minX:e.minX,n=t.minY>e.minY?t.minY:e.minY,r=t.maxX<e.maxX?t.maxX:e.maxX,s=t.maxY<e.maxY?t.maxY:e.maxY;if(i<=r&&n<=s){var o=this.minX,a=this.minY,l=this.maxX,h=this.maxY;this.minX=i<o?i:o,this.minY=n<a?n:a,this.maxX=l<r?r:l,this.maxY=h<s?s:h}},on.prototype.addBoundsMatrix=function(t,e){this.addFrameMatrix(e,t.minX,t.minY,t.maxX,t.maxY)},on.prototype.addBoundsArea=function(t,e){var i=t.minX>e.x?t.minX:e.x,n=t.minY>e.y?t.minY:e.y,r=t.maxX<e.x+e.width?t.maxX:e.x+e.width,s=t.maxY<e.y+e.height?t.maxY:e.y+e.height;if(i<=r&&n<=s){var o=this.minX,a=this.minY,l=this.maxX,h=this.maxY;this.minX=i<o?i:o,this.minY=n<a?n:a,this.maxX=l<r?r:l,this.maxY=h<s?s:h}},on.prototype.pad=function(t,e){void 0===t&&(t=0),void 0===e&&(e=t),this.isEmpty()||(this.minX-=t,this.maxX+=t,this.minY-=e,this.maxY+=e)},on.prototype.addFramePad=function(t,e,i,n,r,s){t-=r,e-=s,i+=r,n+=s,this.minX=this.minX<t?this.minX:t,this.maxX=this.maxX>i?this.maxX:i,this.minY=this.minY<e?this.minY:e,this.maxY=this.maxY>n?this.maxY:n},on),sn=function(t,e){return(sn=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)};function on(){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0,this.rect=null,this.updateID=-1}function an(t,e){function i(){this.constructor=t}sn(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}var ln,hn,un,cn,dn,pn,fn,gn,mn,yn,_n,vn,bn,wn,Sn,xn,Tn,In,Pn,Cn,En,An,Mn,Bn,Rn,On,kn,Dn,Fn,Nn,Ln,Un,zn,Wn,Gn,Hn,Xn,jn,Vn,Yn,qn=(an(Qn,En=Ct),Qn.mixin=function(t){for(var e=Object.keys(t),i=0;i<e.length;++i){var n=e[i];Object.defineProperty(Qn.prototype,n,Object.getOwnPropertyDescriptor(t,n))}},Object.defineProperty(Qn.prototype,"destroyed",{get:function(){return this._destroyed},enumerable:!1,configurable:!0}),Qn.prototype._recursivePostUpdateTransform=function(){this.parent?(this.parent._recursivePostUpdateTransform(),this.transform.updateTransform(this.parent.transform)):this.transform.updateTransform(this._tempDisplayObjectParent.transform)},Qn.prototype.updateTransform=function(){this._boundsID++,this.transform.updateTransform(this.parent.transform),this.worldAlpha=this.alpha*this.parent.worldAlpha},Qn.prototype.getBounds=function(t,e){return t||(this.parent?(this._recursivePostUpdateTransform(),this.updateTransform()):(this.parent=this._tempDisplayObjectParent,this.updateTransform(),this.parent=null)),this._bounds.updateID!==this._boundsID&&(this.calculateBounds(),this._bounds.updateID=this._boundsID),e||(this._boundsRect||(this._boundsRect=new Bi),e=this._boundsRect),this._bounds.getRectangle(e)},Qn.prototype.getLocalBounds=function(t){t||(this._localBoundsRect||(this._localBoundsRect=new Bi),t=this._localBoundsRect),this._localBounds||(this._localBounds=new rn);var e=this.transform,i=this.parent;this.parent=null,this.transform=this._tempDisplayObjectParent.transform;var n=this._bounds,r=this._boundsID;this._bounds=this._localBounds;var s=this.getBounds(!1,t);return this.parent=i,this.transform=e,this._bounds=n,this._bounds.updateID+=this._boundsID-r,s},Qn.prototype.toGlobal=function(t,e,i){return void 0===i&&(i=!1),i||(this._recursivePostUpdateTransform(),this.parent?this.displayObjectUpdateTransform():(this.parent=this._tempDisplayObjectParent,this.displayObjectUpdateTransform(),this.parent=null)),this.worldTransform.apply(t,e)},Qn.prototype.toLocal=function(t,e,i,n){return e&&(t=e.toGlobal(t,i,n)),n||(this._recursivePostUpdateTransform(),this.parent?this.displayObjectUpdateTransform():(this.parent=this._tempDisplayObjectParent,this.displayObjectUpdateTransform(),this.parent=null)),this.worldTransform.applyInverse(t,i)},Qn.prototype.setParent=function(t){if(!t||!t.addChild)throw new Error("setParent: Argument must be a Container");return t.addChild(this),t},Qn.prototype.setTransform=function(t,e,i,n,r,s,o,a,l){return void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=1),void 0===n&&(n=1),void 0===r&&(r=0),void 0===s&&(s=0),void 0===o&&(o=0),void 0===a&&(a=0),void 0===l&&(l=0),this.position.x=t,this.position.y=e,this.scale.x=i||1,this.scale.y=n||1,this.rotation=r,this.skew.x=s,this.skew.y=o,this.pivot.x=a,this.pivot.y=l,this},Qn.prototype.destroy=function(t){this.parent&&this.parent.removeChild(this),this.emit("destroyed"),this.removeAllListeners(),this.transform=null,this.parent=null,this._bounds=null,this.mask=null,this.filters=null,this.filterArea=null,this.hitArea=null,this.interactive=!1,this.interactiveChildren=!1,this._destroyed=!0},Object.defineProperty(Qn.prototype,"_tempDisplayObjectParent",{get:function(){return null===this.tempDisplayObjectParent&&(this.tempDisplayObjectParent=new Kn),this.tempDisplayObjectParent},enumerable:!1,configurable:!0}),Qn.prototype.enableTempParent=function(){var t=this.parent;return this.parent=this._tempDisplayObjectParent,t},Qn.prototype.disableTempParent=function(t){this.parent=t},Object.defineProperty(Qn.prototype,"x",{get:function(){return this.position.x},set:function(t){this.transform.position.x=t},enumerable:!1,configurable:!0}),Object.defineProperty(Qn.prototype,"y",{get:function(){return this.position.y},set:function(t){this.transform.position.y=t},enumerable:!1,configurable:!0}),Object.defineProperty(Qn.prototype,"worldTransform",{get:function(){return this.transform.worldTransform},enumerable:!1,configurable:!0}),Object.defineProperty(Qn.prototype,"localTransform",{get:function(){return this.transform.localTransform},enumerable:!1,configurable:!0}),Object.defineProperty(Qn.prototype,"position",{get:function(){return this.transform.position},set:function(t){this.transform.position.copyFrom(t)},enumerable:!1,configurable:!0}),Object.defineProperty(Qn.prototype,"scale",{get:function(){return this.transform.scale},set:function(t){this.transform.scale.copyFrom(t)},enumerable:!1,configurable:!0}),Object.defineProperty(Qn.prototype,"pivot",{get:function(){return this.transform.pivot},set:function(t){this.transform.pivot.copyFrom(t)},enumerable:!1,configurable:!0}),Object.defineProperty(Qn.prototype,"skew",{get:function(){return this.transform.skew},set:function(t){this.transform.skew.copyFrom(t)},enumerable:!1,configurable:!0}),Object.defineProperty(Qn.prototype,"rotation",{get:function(){return this.transform.rotation},set:function(t){this.transform.rotation=t},enumerable:!1,configurable:!0}),Object.defineProperty(Qn.prototype,"angle",{get:function(){return this.transform.rotation*Ai},set:function(t){this.transform.rotation=t*Mi},enumerable:!1,configurable:!0}),Object.defineProperty(Qn.prototype,"zIndex",{get:function(){return this._zIndex},set:function(t){this._zIndex=t,this.parent&&(this.parent.sortDirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(Qn.prototype,"worldVisible",{get:function(){var t=this;do{if(!t.visible)return!1;t=t.parent}while(t);return!0},enumerable:!1,configurable:!0}),Object.defineProperty(Qn.prototype,"mask",{get:function(){return this._mask},set:function(t){var e;this._mask!==t&&(this._mask&&((e=this._mask.maskObject||this._mask)._maskRefCount--,0===e._maskRefCount&&(e.renderable=!0,e.isMask=!1)),this._mask=t,this._mask&&(0===(e=this._mask.maskObject||this._mask)._maskRefCount&&(e.renderable=!1,e.isMask=!0),e._maskRefCount++))},enumerable:!1,configurable:!0}),Qn),Kn=(an($n,Cn=qn),$n);function $n(){var t=null!==Cn&&Cn.apply(this,arguments)||this;return t.sortDirty=null,t}function Qn(){var t=En.call(this)||this;return t.tempDisplayObjectParent=null,t.transform=new en,t.alpha=1,t.visible=!0,t.renderable=!0,t.parent=null,t.worldAlpha=1,t._lastSortedIndex=0,t._zIndex=0,t.filterArea=null,t.filters=null,t._enabledFilters=null,t._bounds=new rn,t._localBounds=null,t._boundsID=0,t._boundsRect=null,t._localBoundsRect=null,t._mask=null,t._maskRefCount=0,t._destroyed=!1,t.isSprite=!1,t.isMask=!1,t}function Jn(t,e){return t.zIndex===e.zIndex?t._lastSortedIndex-e._lastSortedIndex:t.zIndex-e.zIndex}qn.prototype.displayObjectUpdateTransform=qn.prototype.updateTransform,(Yn=ln=ln||{})[Yn.WEBGL_LEGACY=0]="WEBGL_LEGACY",Yn[Yn.WEBGL=1]="WEBGL",Yn[Yn.WEBGL2=2]="WEBGL2",(Vn=hn=hn||{})[Vn.UNKNOWN=0]="UNKNOWN",Vn[Vn.WEBGL=1]="WEBGL",Vn[Vn.CANVAS=2]="CANVAS",(jn=un=un||{})[jn.COLOR=16384]="COLOR",jn[jn.DEPTH=256]="DEPTH",jn[jn.STENCIL=1024]="STENCIL",(Xn=cn=cn||{})[Xn.NORMAL=0]="NORMAL",Xn[Xn.ADD=1]="ADD",Xn[Xn.MULTIPLY=2]="MULTIPLY",Xn[Xn.SCREEN=3]="SCREEN",Xn[Xn.OVERLAY=4]="OVERLAY",Xn[Xn.DARKEN=5]="DARKEN",Xn[Xn.LIGHTEN=6]="LIGHTEN",Xn[Xn.COLOR_DODGE=7]="COLOR_DODGE",Xn[Xn.COLOR_BURN=8]="COLOR_BURN",Xn[Xn.HARD_LIGHT=9]="HARD_LIGHT",Xn[Xn.SOFT_LIGHT=10]="SOFT_LIGHT",Xn[Xn.DIFFERENCE=11]="DIFFERENCE",Xn[Xn.EXCLUSION=12]="EXCLUSION",Xn[Xn.HUE=13]="HUE",Xn[Xn.SATURATION=14]="SATURATION",Xn[Xn.COLOR=15]="COLOR",Xn[Xn.LUMINOSITY=16]="LUMINOSITY",Xn[Xn.NORMAL_NPM=17]="NORMAL_NPM",Xn[Xn.ADD_NPM=18]="ADD_NPM",Xn[Xn.SCREEN_NPM=19]="SCREEN_NPM",Xn[Xn.NONE=20]="NONE",Xn[Xn.SRC_OVER=0]="SRC_OVER",Xn[Xn.SRC_IN=21]="SRC_IN",Xn[Xn.SRC_OUT=22]="SRC_OUT",Xn[Xn.SRC_ATOP=23]="SRC_ATOP",Xn[Xn.DST_OVER=24]="DST_OVER",Xn[Xn.DST_IN=25]="DST_IN",Xn[Xn.DST_OUT=26]="DST_OUT",Xn[Xn.DST_ATOP=27]="DST_ATOP",Xn[Xn.ERASE=26]="ERASE",Xn[Xn.SUBTRACT=28]="SUBTRACT",Xn[Xn.XOR=29]="XOR",(Hn=dn=dn||{})[Hn.POINTS=0]="POINTS",Hn[Hn.LINES=1]="LINES",Hn[Hn.LINE_LOOP=2]="LINE_LOOP",Hn[Hn.LINE_STRIP=3]="LINE_STRIP",Hn[Hn.TRIANGLES=4]="TRIANGLES",Hn[Hn.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",Hn[Hn.TRIANGLE_FAN=6]="TRIANGLE_FAN",(Gn=pn=pn||{})[Gn.RGBA=6408]="RGBA",Gn[Gn.RGB=6407]="RGB",Gn[Gn.RG=33319]="RG",Gn[Gn.RED=6403]="RED",Gn[Gn.RGBA_INTEGER=36249]="RGBA_INTEGER",Gn[Gn.RGB_INTEGER=36248]="RGB_INTEGER",Gn[Gn.RG_INTEGER=33320]="RG_INTEGER",Gn[Gn.RED_INTEGER=36244]="RED_INTEGER",Gn[Gn.ALPHA=6406]="ALPHA",Gn[Gn.LUMINANCE=6409]="LUMINANCE",Gn[Gn.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",Gn[Gn.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",Gn[Gn.DEPTH_STENCIL=34041]="DEPTH_STENCIL",(Wn=fn=fn||{})[Wn.TEXTURE_2D=3553]="TEXTURE_2D",Wn[Wn.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",Wn[Wn.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",Wn[Wn.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",Wn[Wn.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",Wn[Wn.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",Wn[Wn.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",Wn[Wn.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",Wn[Wn.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",(zn=gn=gn||{})[zn.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",zn[zn.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",zn[zn.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",zn[zn.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",zn[zn.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",zn[zn.UNSIGNED_INT=5125]="UNSIGNED_INT",zn[zn.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",zn[zn.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",zn[zn.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",zn[zn.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",zn[zn.BYTE=5120]="BYTE",zn[zn.SHORT=5122]="SHORT",zn[zn.INT=5124]="INT",zn[zn.FLOAT=5126]="FLOAT",zn[zn.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV",zn[zn.HALF_FLOAT=36193]="HALF_FLOAT",(Un=mn=mn||{})[Un.FLOAT=0]="FLOAT",Un[Un.INT=1]="INT",Un[Un.UINT=2]="UINT",(Ln=yn=yn||{})[Ln.NEAREST=0]="NEAREST",Ln[Ln.LINEAR=1]="LINEAR",(Nn=_n=_n||{})[Nn.CLAMP=33071]="CLAMP",Nn[Nn.REPEAT=10497]="REPEAT",Nn[Nn.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",(Fn=vn=vn||{})[Fn.OFF=0]="OFF",Fn[Fn.POW2=1]="POW2",Fn[Fn.ON=2]="ON",Fn[Fn.ON_MANUAL=3]="ON_MANUAL",(Dn=bn=bn||{})[Dn.NPM=0]="NPM",Dn[Dn.UNPACK=1]="UNPACK",Dn[Dn.PMA=2]="PMA",Dn[Dn.NO_PREMULTIPLIED_ALPHA=0]="NO_PREMULTIPLIED_ALPHA",Dn[Dn.PREMULTIPLY_ON_UPLOAD=1]="PREMULTIPLY_ON_UPLOAD",Dn[Dn.PREMULTIPLY_ALPHA=2]="PREMULTIPLY_ALPHA",Dn[Dn.PREMULTIPLIED_ALPHA=2]="PREMULTIPLIED_ALPHA",(kn=wn=wn||{})[kn.NO=0]="NO",kn[kn.YES=1]="YES",kn[kn.AUTO=2]="AUTO",kn[kn.BLEND=0]="BLEND",kn[kn.CLEAR=1]="CLEAR",kn[kn.BLIT=2]="BLIT",(On=Sn=Sn||{})[On.AUTO=0]="AUTO",On[On.MANUAL=1]="MANUAL",(Rn=xn=xn||{}).LOW="lowp",Rn.MEDIUM="mediump",Rn.HIGH="highp",(Bn=Tn=Tn||{})[Bn.NONE=0]="NONE",Bn[Bn.SCISSOR=1]="SCISSOR",Bn[Bn.STENCIL=2]="STENCIL",Bn[Bn.SPRITE=3]="SPRITE",(Mn=In=In||{})[Mn.NONE=0]="NONE",Mn[Mn.LOW=2]="LOW",Mn[Mn.MEDIUM=4]="MEDIUM",Mn[Mn.HIGH=8]="HIGH",(An=Pn=Pn||{})[An.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",An[An.ARRAY_BUFFER=34962]="ARRAY_BUFFER",An[An.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER";var Zn,tr=(an(er,Zn=qn),er.prototype.onChildrenChange=function(t){},er.prototype.addChild=function(){for(var t=arguments,e=[],i=0;i<arguments.length;i++)e[i]=t[i];if(1<e.length)for(var n=0;n<e.length;n++)this.addChild(e[n]);else{var r=e[0];r.parent&&r.parent.removeChild(r),(r.parent=this).sortDirty=!0,r.transform._parentID=-1,this.children.push(r),this._boundsID++,this.onChildrenChange(this.children.length-1),this.emit("childAdded",r,this,this.children.length-1),r.emit("added",this)}return e[0]},er.prototype.addChildAt=function(t,e){if(e<0||e>this.children.length)throw new Error(t+"addChildAt: The index "+e+" supplied is out of bounds "+this.children.length);return t.parent&&t.parent.removeChild(t),(t.parent=this).sortDirty=!0,t.transform._parentID=-1,this.children.splice(e,0,t),this._boundsID++,this.onChildrenChange(e),t.emit("added",this),this.emit("childAdded",t,this,e),t},er.prototype.swapChildren=function(t,e){if(t!==e){var i=this.getChildIndex(t),n=this.getChildIndex(e);this.children[i]=e,this.children[n]=t,this.onChildrenChange(i<n?i:n)}},er.prototype.getChildIndex=function(t){var e=this.children.indexOf(t);if(-1===e)throw new Error("The supplied DisplayObject must be a child of the caller");return e},er.prototype.setChildIndex=function(t,e){if(e<0||e>=this.children.length)throw new Error("The index "+e+" supplied is out of bounds "+this.children.length);var i=this.getChildIndex(t);ci(this.children,i,1),this.children.splice(e,0,t),this.onChildrenChange(e)},er.prototype.getChildAt=function(t){if(t<0||t>=this.children.length)throw new Error("getChildAt: Index ("+t+") does not exist.");return this.children[t]},er.prototype.removeChild=function(){for(var t=arguments,e=[],i=0;i<arguments.length;i++)e[i]=t[i];if(1<e.length)for(var n=0;n<e.length;n++)this.removeChild(e[n]);else{var r=e[0],s=this.children.indexOf(r);if(-1===s)return null;r.parent=null,r.transform._parentID=-1,ci(this.children,s,1),this._boundsID++,this.onChildrenChange(s),r.emit("removed",this),this.emit("childRemoved",r,this,s)}return e[0]},er.prototype.removeChildAt=function(t){var e=this.getChildAt(t);return e.parent=null,e.transform._parentID=-1,ci(this.children,t,1),this._boundsID++,this.onChildrenChange(t),e.emit("removed",this),this.emit("childRemoved",e,this,t),e},er.prototype.removeChildren=function(t,e){void 0===t&&(t=0),void 0===e&&(e=this.children.length);var i,n=t,r=e-n;if(0<r&&r<=e){i=this.children.splice(n,r);for(var s=0;s<i.length;++s)i[s].parent=null,i[s].transform&&(i[s].transform._parentID=-1);for(this._boundsID++,this.onChildrenChange(t),s=0;s<i.length;++s)i[s].emit("removed",this),this.emit("childRemoved",i[s],this,s);return i}if(0==r&&0===this.children.length)return[];throw new RangeError("removeChildren: numeric values are outside the acceptable range.")},er.prototype.sortChildren=function(){for(var t=!1,e=0,i=this.children.length;e<i;++e){var n=this.children[e];n._lastSortedIndex=e,t||0===n.zIndex||(t=!0)}t&&1<this.children.length&&this.children.sort(Jn),this.sortDirty=!1},er.prototype.updateTransform=function(){this.sortableChildren&&this.sortDirty&&this.sortChildren(),this._boundsID++,this.transform.updateTransform(this.parent.transform),this.worldAlpha=this.alpha*this.parent.worldAlpha;for(var t=0,e=this.children.length;t<e;++t){var i=this.children[t];i.visible&&i.updateTransform()}},er.prototype.calculateBounds=function(){this._bounds.clear(),this._calculateBounds();for(var t=0;t<this.children.length;t++){var e=this.children[t];if(e.visible&&e.renderable)if(e.calculateBounds(),e._mask){var i=e._mask.maskObject||e._mask;i.calculateBounds(),this._bounds.addBoundsMask(e._bounds,i._bounds)}else e.filterArea?this._bounds.addBoundsArea(e._bounds,e.filterArea):this._bounds.addBounds(e._bounds)}this._bounds.updateID=this._boundsID},er.prototype.getLocalBounds=function(t,e){void 0===e&&(e=!1);var i=Zn.prototype.getLocalBounds.call(this,t);if(!e)for(var n=0,r=this.children.length;n<r;++n){var s=this.children[n];s.visible&&s.updateTransform()}return i},er.prototype._calculateBounds=function(){},er.prototype.render=function(t){if(this.visible&&!(this.worldAlpha<=0)&&this.renderable)if(this._mask||this.filters&&this.filters.length)this.renderAdvanced(t);else{this._render(t);for(var e=0,i=this.children.length;e<i;++e)this.children[e].render(t)}},er.prototype.renderAdvanced=function(t){var e=this.filters,i=this._mask;if(e){this._enabledFilters||(this._enabledFilters=[]);for(var n=this._enabledFilters.length=0;n<e.length;n++)e[n].enabled&&this._enabledFilters.push(e[n])}var r=e&&this._enabledFilters&&this._enabledFilters.length||i&&(!i.isMaskData||i.enabled&&(i.autoDetect||i.type!==Tn.NONE));r&&t.batch.flush(),e&&this._enabledFilters&&this._enabledFilters.length&&t.filter.push(this,this._enabledFilters),i&&t.mask.push(this,this._mask),this._render(t),n=0;for(var s=this.children.length;n<s;n++)this.children[n].render(t);r&&t.batch.flush(),i&&t.mask.pop(this),e&&this._enabledFilters&&this._enabledFilters.length&&t.filter.pop()},er.prototype._render=function(t){},er.prototype.destroy=function(t){Zn.prototype.destroy.call(this),this.sortDirty=!1;var e="boolean"==typeof t?t:t&&t.children,i=this.removeChildren(0,this.children.length);if(e)for(var n=0;n<i.length;++n)i[n].destroy(t)},Object.defineProperty(er.prototype,"width",{get:function(){return this.scale.x*this.getLocalBounds().width},set:function(t){var e=this.getLocalBounds().width;this.scale.x=0!==e?t/e:1,this._width=t},enumerable:!1,configurable:!0}),Object.defineProperty(er.prototype,"height",{get:function(){return this.scale.y*this.getLocalBounds().height},set:function(t){var e=this.getLocalBounds().height;this.scale.y=0!==e?t/e:1,this._height=t},enumerable:!1,configurable:!0}),er);function er(){var t=Zn.call(this)||this;return t.children=[],t.sortableChildren=Tt.SORTABLE_CHILDREN,t.sortDirty=!1,t}tr.prototype.containerUpdateTransform=tr.prototype.updateTransform;var ir={accessible:!1,accessibleTitle:null,accessibleHint:null,tabIndex:0,_accessibleActive:!1,_accessibleDiv:null,accessibleType:"button",accessiblePointerEvents:"auto",accessibleChildren:!0,renderId:-1};qn.mixin(ir);var nr,rr=(Object.defineProperty(sr.prototype,"isActive",{get:function(){return this._isActive},enumerable:!1,configurable:!0}),Object.defineProperty(sr.prototype,"isMobileAccessibility",{get:function(){return this._isMobileAccessibility},enumerable:!1,configurable:!0}),sr.prototype.createTouchHook=function(){var t=this,e=document.createElement("button");e.style.width="1px",e.style.height="1px",e.style.position="absolute",e.style.top="-1000px",e.style.left="-1000px",e.style.zIndex=2..toString(),e.style.backgroundColor="#FF0000",e.title="select to enable accessibility for this content",e.addEventListener("focus",function(){t._isMobileAccessibility=!0,t.activate(),t.destroyTouchHook()}),document.body.appendChild(e),this._hookDiv=e},sr.prototype.destroyTouchHook=function(){this._hookDiv&&(document.body.removeChild(this._hookDiv),this._hookDiv=null)},sr.prototype.activate=function(){var t;this._isActive||(this._isActive=!0,self.document.addEventListener("mousemove",this._onMouseMove,!0),self.removeEventListener("keydown",this._onKeyDown,!1),this.renderer.on("postrender",this.update,this),null===(t=this.renderer.view.parentNode)||void 0===t||t.appendChild(this.div))},sr.prototype.deactivate=function(){var t;this._isActive&&!this._isMobileAccessibility&&(this._isActive=!1,self.document.removeEventListener("mousemove",this._onMouseMove,!0),self.addEventListener("keydown",this._onKeyDown,!1),this.renderer.off("postrender",this.update),null===(t=this.div.parentNode)||void 0===t||t.removeChild(this.div))},sr.prototype.updateAccessibleObjects=function(t){if(t.visible&&t.accessibleChildren){t.accessible&&t.interactive&&(t._accessibleActive||this.addChild(t),t.renderId=this.renderId);var e=t.children;if(e)for(var i=0;i<e.length;i++)this.updateAccessibleObjects(e[i])}},sr.prototype.update=function(){var t=performance.now();if(!(wt.android.device&&t<this.androidUpdateCount)&&(this.androidUpdateCount=t+this.androidUpdateFrequency,this.renderer.renderingToScreen)){this.renderer._lastObjectRendered&&this.updateAccessibleObjects(this.renderer._lastObjectRendered);var e=this.renderer.view.getBoundingClientRect(),i=e.left,n=e.top,r=e.width,s=e.height,o=this.renderer,a=o.width,l=o.height,h=o.resolution,u=r/a*h,c=s/l*h,d=this.div;d.style.left=i+"px",d.style.top=n+"px",d.style.width=a+"px",d.style.height=l+"px";for(var p=0;p<this.children.length;p++){var f=this.children[p];if(f.renderId!==this.renderId)f._accessibleActive=!1,ci(this.children,p,1),this.div.removeChild(f._accessibleDiv),this.pool.push(f._accessibleDiv),f._accessibleDiv=null,p--;else{d=f._accessibleDiv;var g=f.hitArea,m=f.worldTransform;f.hitArea?(d.style.left=(m.tx+g.x*m.a)*u+"px",d.style.top=(m.ty+g.y*m.d)*c+"px",d.style.width=g.width*m.a*u+"px",d.style.height=g.height*m.d*c+"px"):(g=f.getBounds(),this.capHitArea(g),d.style.left=g.x*u+"px",d.style.top=g.y*c+"px",d.style.width=g.width*u+"px",d.style.height=g.height*c+"px",d.title!==f.accessibleTitle&&null!==f.accessibleTitle&&(d.title=f.accessibleTitle),d.getAttribute("aria-label")!==f.accessibleHint&&null!==f.accessibleHint&&d.setAttribute("aria-label",f.accessibleHint)),f.accessibleTitle===d.title&&f.tabIndex===d.tabIndex||(d.title=f.accessibleTitle,d.tabIndex=f.tabIndex,this.debug&&this.updateDebugHTML(d))}}this.renderId++}},sr.prototype.updateDebugHTML=function(t){t.innerHTML="type: "+t.type+"</br> title : "+t.title+"</br> tabIndex: "+t.tabIndex},sr.prototype.capHitArea=function(t){t.x<0&&(t.width+=t.x,t.x=0),t.y<0&&(t.height+=t.y,t.y=0);var e=this.renderer,i=e.width,n=e.height;t.x+t.width>i&&(t.width=i-t.x),t.y+t.height>n&&(t.height=n-t.y)},sr.prototype.addChild=function(t){var e=this.pool.pop();e||((e=document.createElement("button")).style.width="100px",e.style.height="100px",e.style.backgroundColor=this.debug?"rgba(255,255,255,0.5)":"transparent",e.style.position="absolute",e.style.zIndex=2..toString(),e.style.borderStyle="none",-1<navigator.userAgent.toLowerCase().indexOf("chrome")?e.setAttribute("aria-live","off"):e.setAttribute("aria-live","polite"),navigator.userAgent.match(/rv:.*Gecko\//)?e.setAttribute("aria-relevant","additions"):e.setAttribute("aria-relevant","text"),e.addEventListener("click",this._onClick.bind(this)),e.addEventListener("focus",this._onFocus.bind(this)),e.addEventListener("focusout",this._onFocusOut.bind(this))),e.style.pointerEvents=t.accessiblePointerEvents,e.type=t.accessibleType,t.accessibleTitle&&null!==t.accessibleTitle?e.title=t.accessibleTitle:t.accessibleHint&&null!==t.accessibleHint||(e.title="displayObject "+t.tabIndex),t.accessibleHint&&null!==t.accessibleHint&&e.setAttribute("aria-label",t.accessibleHint),this.debug&&this.updateDebugHTML(e),t._accessibleActive=!0,(t._accessibleDiv=e).displayObject=t,this.children.push(t),this.div.appendChild(t._accessibleDiv),t._accessibleDiv.tabIndex=t.tabIndex},sr.prototype._onClick=function(t){var e=this.renderer.plugins.interaction,i=t.target.displayObject,n=e.eventData;e.dispatchEvent(i,"click",n),e.dispatchEvent(i,"pointertap",n),e.dispatchEvent(i,"tap",n)},sr.prototype._onFocus=function(t){t.target.getAttribute("aria-live")||t.target.setAttribute("aria-live","assertive");var e=this.renderer.plugins.interaction,i=t.target.displayObject,n=e.eventData;e.dispatchEvent(i,"mouseover",n)},sr.prototype._onFocusOut=function(t){t.target.getAttribute("aria-live")||t.target.setAttribute("aria-live","polite");var e=this.renderer.plugins.interaction,i=t.target.displayObject,n=e.eventData;e.dispatchEvent(i,"mouseout",n)},sr.prototype._onKeyDown=function(t){9===t.keyCode&&this.activate()},sr.prototype._onMouseMove=function(t){0===t.movementX&&0===t.movementY||this.deactivate()},sr.prototype.destroy=function(){this.destroyTouchHook(),this.div=null,self.document.removeEventListener("mousemove",this._onMouseMove,!0),self.removeEventListener("keydown",this._onKeyDown),this.pool=null,this.children=null,this.renderer=null},sr);function sr(t){this.debug=!1,this._isActive=!1,this._isMobileAccessibility=!1,this.pool=[],this.renderId=0,this.children=[],this.androidUpdateCount=0,this.androidUpdateFrequency=500,this._hookDiv=null,(wt.tablet||wt.phone)&&this.createTouchHook();var e=document.createElement("div");e.style.width="100px",e.style.height="100px",e.style.position="absolute",e.style.top="0px",e.style.left="0px",e.style.zIndex=2..toString(),this.div=e,this.renderer=t,this._onKeyDown=this._onKeyDown.bind(this),this._onMouseMove=this._onMouseMove.bind(this),self.addEventListener("keydown",this._onKeyDown,!1)}Tt.TARGET_FPMS=.06,(nr=nt.UPDATE_PRIORITY||(nt.UPDATE_PRIORITY={}))[nr.INTERACTION=50]="INTERACTION",nr[nr.HIGH=25]="HIGH",nr[nr.NORMAL=0]="NORMAL",nr[nr.LOW=-25]="LOW",nr[nr.UTILITY=-50]="UTILITY";var or=(wr.prototype.match=function(t,e){return void 0===e&&(e=null),this.fn===t&&this.context===e},wr.prototype.emit=function(t){this.fn&&(this.context?this.fn.call(this.context,t):this.fn(t));var e=this.next;return this.once&&this.destroy(!0),this._destroyed&&(this.next=null),e},wr.prototype.connect=function(t){(this.previous=t).next&&(t.next.previous=this),this.next=t.next,t.next=this},wr.prototype.destroy=function(t){void 0===t&&(t=!1),this._destroyed=!0,this.fn=null,this.context=null,this.previous&&(this.previous.next=this.next),this.next&&(this.next.previous=this.previous);var e=this.next;return this.next=t?null:e,this.previous=null,e},wr),ar=(br.prototype._requestIfNeeded=function(){null===this._requestId&&this._head.next&&(this.lastTime=performance.now(),this._lastFrame=this.lastTime,this._requestId=requestAnimationFrame(this._tick))},br.prototype._cancelIfNeeded=function(){null!==this._requestId&&(cancelAnimationFrame(this._requestId),this._requestId=null)},br.prototype._startIfPossible=function(){this.started?this._requestIfNeeded():this.autoStart&&this.start()},br.prototype.add=function(t,e,i){return void 0===i&&(i=nt.UPDATE_PRIORITY.NORMAL),this._addListener(new or(t,e,i))},br.prototype.addOnce=function(t,e,i){return void 0===i&&(i=nt.UPDATE_PRIORITY.NORMAL),this._addListener(new or(t,e,i,!0))},br.prototype._addListener=function(t){var e=this._head.next,i=this._head;if(e){for(;e;){if(t.priority>e.priority){t.connect(i);break}e=(i=e).next}t.previous||t.connect(i)}else t.connect(i);return this._startIfPossible(),this},br.prototype.remove=function(t,e){for(var i=this._head.next;i;)i=i.match(t,e)?i.destroy():i.next;return this._head.next||this._cancelIfNeeded(),this},Object.defineProperty(br.prototype,"count",{get:function(){if(!this._head)return 0;for(var t=0,e=this._head;e=e.next;)t++;return t},enumerable:!1,configurable:!0}),br.prototype.start=function(){this.started||(this.started=!0,this._requestIfNeeded())},br.prototype.stop=function(){this.started&&(this.started=!1,this._cancelIfNeeded())},br.prototype.destroy=function(){if(!this._protected){this.stop();for(var t=this._head.next;t;)t=t.destroy(!0);this._head.destroy(),this._head=null}},br.prototype.update=function(t){var e;if(void 0===t&&(t=performance.now()),t>this.lastTime){if((e=this.elapsedMS=t-this.lastTime)>this._maxElapsedMS&&(e=this._maxElapsedMS),e*=this.speed,this._minElapsedMS){var i=t-this._lastFrame|0;if(i<this._minElapsedMS)return;this._lastFrame=t-i%this._minElapsedMS}this.deltaMS=e,this.deltaTime=this.deltaMS*Tt.TARGET_FPMS;for(var n=this._head,r=n.next;r;)r=r.emit(this.deltaTime);n.next||this._cancelIfNeeded()}else this.deltaTime=this.deltaMS=this.elapsedMS=0;this.lastTime=t},Object.defineProperty(br.prototype,"FPS",{get:function(){return 1e3/this.elapsedMS},enumerable:!1,configurable:!0}),Object.defineProperty(br.prototype,"minFPS",{get:function(){return 1e3/this._maxElapsedMS},set:function(t){var e=Math.min(this.maxFPS,t),i=Math.min(Math.max(0,e)/1e3,Tt.TARGET_FPMS);this._maxElapsedMS=1/i},enumerable:!1,configurable:!0}),Object.defineProperty(br.prototype,"maxFPS",{get:function(){return this._minElapsedMS?Math.round(1e3/this._minElapsedMS):0},set:function(t){if(0===t)this._minElapsedMS=0;else{var e=Math.max(this.minFPS,t);this._minElapsedMS=1/(e/1e3)}},enumerable:!1,configurable:!0}),Object.defineProperty(br,"shared",{get:function(){if(!br._shared){var t=br._shared=new br;t.autoStart=!0,t._protected=!0}return br._shared},enumerable:!1,configurable:!0}),Object.defineProperty(br,"system",{get:function(){if(!br._system){var t=br._system=new br;t.autoStart=!0,t._protected=!0}return br._system},enumerable:!1,configurable:!0}),br),lr=(vr.init=function(t){var e=this;t=Object.assign({autoStart:!0,sharedTicker:!1},t),Object.defineProperty(this,"ticker",{set:function(t){this._ticker&&this._ticker.remove(this.render,this),(this._ticker=t)&&t.add(this.render,this,nt.UPDATE_PRIORITY.LOW)},get:function(){return this._ticker}}),this.stop=function(){e._ticker.stop()},this.start=function(){e._ticker.start()},this._ticker=null,this.ticker=t.sharedTicker?ar.shared:new ar,t.autoStart&&this.start()},vr.destroy=function(){if(this._ticker){var t=this._ticker;this.ticker=null,t.destroy()}},vr),hr=(Object.defineProperty(_r.prototype,"pointerId",{get:function(){return this.identifier},enumerable:!1,configurable:!0}),_r.prototype.getLocalPosition=function(t,e,i){return t.worldTransform.applyInverse(i||this.global,e)},_r.prototype.copyEvent=function(t){"isPrimary"in t&&t.isPrimary&&(this.isPrimary=!0),this.button="button"in t&&t.button;var e="buttons"in t&&t.buttons;this.buttons=Number.isInteger(e)?e:"which"in t&&t.which,this.width="width"in t&&t.width,this.height="height"in t&&t.height,this.tiltX="tiltX"in t&&t.tiltX,this.tiltY="tiltY"in t&&t.tiltY,this.pointerType="pointerType"in t&&t.pointerType,this.pressure="pressure"in t&&t.pressure,this.rotationAngle="rotationAngle"in t&&t.rotationAngle,this.twist="twist"in t&&t.twist||0,this.tangentialPressure="tangentialPressure"in t&&t.tangentialPressure||0},_r.prototype.reset=function(){this.isPrimary=!1},_r),ur=function(t,e){return(ur=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},cr=(yr.prototype.stopPropagation=function(){this.stopped=!0,this.stopPropagationHint=!0,this.stopsPropagatingAt=this.currentTarget},yr.prototype.reset=function(){this.stopped=!1,this.stopsPropagatingAt=null,this.stopPropagationHint=!1,this.currentTarget=null,this.target=null},yr),dr=(mr.prototype._doSet=function(t,e){this._flags=e?this._flags|t:this._flags&~t},Object.defineProperty(mr.prototype,"pointerId",{get:function(){return this._pointerId},enumerable:!1,configurable:!0}),Object.defineProperty(mr.prototype,"flags",{get:function(){return this._flags},set:function(t){this._flags=t},enumerable:!1,configurable:!0}),Object.defineProperty(mr.prototype,"none",{get:function(){return this._flags===mr.FLAGS.NONE},enumerable:!1,configurable:!0}),Object.defineProperty(mr.prototype,"over",{get:function(){return 0!=(this._flags&mr.FLAGS.OVER)},set:function(t){this._doSet(mr.FLAGS.OVER,t)},enumerable:!1,configurable:!0}),Object.defineProperty(mr.prototype,"rightDown",{get:function(){return 0!=(this._flags&mr.FLAGS.RIGHT_DOWN)},set:function(t){this._doSet(mr.FLAGS.RIGHT_DOWN,t)},enumerable:!1,configurable:!0}),Object.defineProperty(mr.prototype,"leftDown",{get:function(){return 0!=(this._flags&mr.FLAGS.LEFT_DOWN)},set:function(t){this._doSet(mr.FLAGS.LEFT_DOWN,t)},enumerable:!1,configurable:!0}),mr.FLAGS=Object.freeze({NONE:0,OVER:1,LEFT_DOWN:2,RIGHT_DOWN:4}),mr),pr=(gr.prototype.recursiveFindHit=function(t,e,i,n,r){if(!e||!e.visible)return!1;var s=t.data.global,o=!1,a=r=e.interactive||r,l=!0;if(e.hitArea?(n&&(e.worldTransform.applyInverse(s,this._tempPoint),e.hitArea.contains(this._tempPoint.x,this._tempPoint.y)?o=!0:l=n=!1),a=!1):e._mask&&n&&(e._mask.containsPoint&&e._mask.containsPoint(s)||(n=!1)),l&&e.interactiveChildren&&e.children)for(var h=e.children,u=h.length-1;0<=u;u--){var c=h[u],d=this.recursiveFindHit(t,c,i,n,a);if(d){if(!c.parent)continue;a=!1,d&&(t.target&&(n=!1),o=!0)}}return r&&(n&&!t.target&&!e.hitArea&&e.containsPoint&&e.containsPoint(s)&&(o=!0),e.interactive&&(o&&!t.target&&(t.target=e),i&&i(t,e,!!o))),o},gr.prototype.findHit=function(t,e,i,n){this.recursiveFindHit(t,e,i,n,!1)},gr),fr={interactive:!1,interactiveChildren:!0,hitArea:null,get buttonMode(){return"pointer"===this.cursor},set buttonMode(t){t?this.cursor="pointer":"pointer"===this.cursor&&(this.cursor=null)},cursor:null,get trackedPointers(){return void 0===this._trackedPointers&&(this._trackedPointers={}),this._trackedPointers},_trackedPointers:void 0};function gr(){this._tempPoint=new Fi}function mr(t){this._pointerId=t,this._flags=mr.FLAGS.NONE}function yr(){this.stopped=!1,this.stopsPropagatingAt=null,this.stopPropagationHint=!1,this.target=null,this.currentTarget=null,this.type=null,this.data=null}function _r(){this.pressure=0,this.rotationAngle=0,this.twist=0,this.tangentialPressure=0,this.global=new Fi,this.target=null,this.originalEvent=null,this.identifier=null,this.isPrimary=!1,this.button=0,this.buttons=0,this.width=0,this.height=0,this.tiltX=0,this.tiltY=0,this.pointerType=null,this.pressure=0,this.rotationAngle=0,this.twist=0,this.tangentialPressure=0}function vr(){}function br(){var e=this;this.autoStart=!1,this.deltaTime=1,this.lastTime=-1,this.speed=1,this.started=!1,this._requestId=null,this._maxElapsedMS=100,this._minElapsedMS=0,this._protected=!1,this._lastFrame=-1,this._head=new or(null,null,1/0),this.deltaMS=1/Tt.TARGET_FPMS,this.elapsedMS=1/Tt.TARGET_FPMS,this._tick=function(t){e._requestId=null,e.started&&(e.update(t),e.started&&null===e._requestId&&e._head.next&&(e._requestId=requestAnimationFrame(e._tick)))}}function wr(t,e,i,n){void 0===e&&(e=null),void 0===i&&(i=0),void 0===n&&(n=!1),this.next=null,this.previous=null,this._destroyed=!1,this.fn=t,this.context=e,this.priority=i,this.once=n}qn.mixin(fr);var Sr,xr,Tr,Ir={target:null,data:{global:null}},Pr=(ur(xr=Ar,Tr=Sr=Ct),xr.prototype=null===Tr?Object.create(Tr):(Mr.prototype=Tr.prototype,new Mr),Object.defineProperty(Ar.prototype,"useSystemTicker",{get:function(){return this._useSystemTicker},set:function(t){(this._useSystemTicker=t)?this.addTickerListener():this.removeTickerListener()},enumerable:!1,configurable:!0}),Object.defineProperty(Ar.prototype,"lastObjectRendered",{get:function(){return this.renderer._lastObjectRendered||this._tempDisplayObject},enumerable:!1,configurable:!0}),Ar.prototype.hitTest=function(t,e){return Ir.target=null,Ir.data.global=t,e=e||this.lastObjectRendered,this.processInteractive(Ir,e,null,!0),Ir.target},Ar.prototype.setTargetElement=function(t,e){void 0===e&&(e=1),this.removeTickerListener(),this.removeEvents(),this.interactionDOMElement=t,this.resolution=e,this.addEvents(),this.addTickerListener()},Ar.prototype.addTickerListener=function(){!this.tickerAdded&&this.interactionDOMElement&&this._useSystemTicker&&(ar.system.add(this.tickerUpdate,this,nt.UPDATE_PRIORITY.INTERACTION),this.tickerAdded=!0)},Ar.prototype.removeTickerListener=function(){this.tickerAdded&&(ar.system.remove(this.tickerUpdate,this),this.tickerAdded=!1)},Ar.prototype.addEvents=function(){if(!this.eventsAdded&&this.interactionDOMElement){var t=this.interactionDOMElement.style;self.navigator.msPointerEnabled?(t.msContentZooming="none",t.msTouchAction="none"):this.supportsPointerEvents&&(t.touchAction="none"),this.supportsPointerEvents?(self.document.addEventListener("pointermove",this.onPointerMove,this._eventListenerOptions),this.interactionDOMElement.addEventListener("pointerdown",this.onPointerDown,this._eventListenerOptions),this.interactionDOMElement.addEventListener("pointerleave",this.onPointerOut,this._eventListenerOptions),this.interactionDOMElement.addEventListener("pointerover",this.onPointerOver,this._eventListenerOptions),self.addEventListener("pointercancel",this.onPointerCancel,this._eventListenerOptions),self.addEventListener("pointerup",this.onPointerUp,this._eventListenerOptions)):(self.document.addEventListener("mousemove",this.onPointerMove,this._eventListenerOptions),this.interactionDOMElement.addEventListener("mousedown",this.onPointerDown,this._eventListenerOptions),this.interactionDOMElement.addEventListener("mouseout",this.onPointerOut,this._eventListenerOptions),this.interactionDOMElement.addEventListener("mouseover",this.onPointerOver,this._eventListenerOptions),self.addEventListener("mouseup",this.onPointerUp,this._eventListenerOptions)),this.supportsTouchEvents&&(this.interactionDOMElement.addEventListener("touchstart",this.onPointerDown,this._eventListenerOptions),this.interactionDOMElement.addEventListener("touchcancel",this.onPointerCancel,this._eventListenerOptions),this.interactionDOMElement.addEventListener("touchend",this.onPointerUp,this._eventListenerOptions),this.interactionDOMElement.addEventListener("touchmove",this.onPointerMove,this._eventListenerOptions)),this.eventsAdded=!0}},Ar.prototype.removeEvents=function(){if(this.eventsAdded&&this.interactionDOMElement){var t=this.interactionDOMElement.style;self.navigator.msPointerEnabled?(t.msContentZooming="",t.msTouchAction=""):this.supportsPointerEvents&&(t.touchAction=""),this.supportsPointerEvents?(self.document.removeEventListener("pointermove",this.onPointerMove,this._eventListenerOptions),this.interactionDOMElement.removeEventListener("pointerdown",this.onPointerDown,this._eventListenerOptions),this.interactionDOMElement.removeEventListener("pointerleave",this.onPointerOut,this._eventListenerOptions),this.interactionDOMElement.removeEventListener("pointerover",this.onPointerOver,this._eventListenerOptions),self.removeEventListener("pointercancel",this.onPointerCancel,this._eventListenerOptions),self.removeEventListener("pointerup",this.onPointerUp,this._eventListenerOptions)):(self.document.removeEventListener("mousemove",this.onPointerMove,this._eventListenerOptions),this.interactionDOMElement.removeEventListener("mousedown",this.onPointerDown,this._eventListenerOptions),this.interactionDOMElement.removeEventListener("mouseout",this.onPointerOut,this._eventListenerOptions),this.interactionDOMElement.removeEventListener("mouseover",this.onPointerOver,this._eventListenerOptions),self.removeEventListener("mouseup",this.onPointerUp,this._eventListenerOptions)),this.supportsTouchEvents&&(this.interactionDOMElement.removeEventListener("touchstart",this.onPointerDown,this._eventListenerOptions),this.interactionDOMElement.removeEventListener("touchcancel",this.onPointerCancel,this._eventListenerOptions),this.interactionDOMElement.removeEventListener("touchend",this.onPointerUp,this._eventListenerOptions),this.interactionDOMElement.removeEventListener("touchmove",this.onPointerMove,this._eventListenerOptions)),this.interactionDOMElement=null,this.eventsAdded=!1}},Ar.prototype.tickerUpdate=function(t){this._deltaTime+=t,this._deltaTime<this.interactionFrequency||(this._deltaTime=0,this.update())},Ar.prototype.update=function(){if(this.interactionDOMElement)if(this._didMove)this._didMove=!1;else{for(var t in this.cursor=null,this.activeInteractionData)if(this.activeInteractionData.hasOwnProperty(t)){var e=this.activeInteractionData[t];if(e.originalEvent&&"touch"!==e.pointerType){var i=this.configureInteractionEventForDOMEvent(this.eventData,e.originalEvent,e);this.processInteractive(i,this.lastObjectRendered,this.processPointerOverOut,!0)}}this.setCursorMode(this.cursor)}},Ar.prototype.setCursorMode=function(t){t=t||"default";var e=!0;if(self.OffscreenCanvas&&this.interactionDOMElement instanceof OffscreenCanvas&&(e=!1),this.currentCursorMode!==t){this.currentCursorMode=t;var i=this.cursorStyles[t];if(i)switch(typeof i){case"string":e&&(this.interactionDOMElement.style.cursor=i);break;case"function":i(t);break;case"object":e&&Object.assign(this.interactionDOMElement.style,i)}else e&&"string"==typeof t&&!Object.prototype.hasOwnProperty.call(this.cursorStyles,t)&&(this.interactionDOMElement.style.cursor=t)}},Ar.prototype.dispatchEvent=function(t,e,i){i.stopPropagationHint&&t!==i.stopsPropagatingAt||(i.currentTarget=t,i.type=e,t.emit(e,i),t[e]&&t[e](i))},Ar.prototype.delayDispatchEvent=function(t,e,i){this.delayedEvents.push({displayObject:t,eventString:e,eventData:i})},Ar.prototype.mapPositionToPoint=function(t,e,i){var n;n=this.interactionDOMElement.parentElement?this.interactionDOMElement.getBoundingClientRect():{x:0,y:0,width:this.interactionDOMElement.width,height:this.interactionDOMElement.height,left:0,top:0};var r=1/this.resolution;t.x=(e-n.left)*(this.interactionDOMElement.width/n.width)*r,t.y=(i-n.top)*(this.interactionDOMElement.height/n.height)*r},Ar.prototype.processInteractive=function(t,e,i,n){var r=this.search.findHit(t,e,i,n),s=this.delayedEvents;if(!s.length)return r;t.stopPropagationHint=!1;var o=s.length;this.delayedEvents=[];for(var a=0;a<o;a++){var l=s[a],h=l.displayObject,u=l.eventString,c=l.eventData;c.stopsPropagatingAt===h&&(c.stopPropagationHint=!0),this.dispatchEvent(h,u,c)}return r},Ar.prototype.onPointerDown=function(t){if(!this.supportsTouchEvents||"touch"!==t.pointerType){var e=this.normalizeToPointerData(t);!this.autoPreventDefault||!e[0].isNormalized||!t.cancelable&&"cancelable"in t||t.preventDefault();for(var i=e.length,n=0;n<i;n++){var r=e[n],s=this.getInteractionDataForPointerId(r),o=this.configureInteractionEventForDOMEvent(this.eventData,r,s);if(o.data.originalEvent=t,this.processInteractive(o,this.lastObjectRendered,this.processPointerDown,!0),this.emit("pointerdown",o),"touch"===r.pointerType)this.emit("touchstart",o);else if("mouse"===r.pointerType||"pen"===r.pointerType){var a=2===r.button;this.emit(a?"rightdown":"mousedown",this.eventData)}}}},Ar.prototype.processPointerDown=function(t,e,i){var n=t.data,r=t.data.identifier;if(i)if(e.trackedPointers[r]||(e.trackedPointers[r]=new dr(r)),this.dispatchEvent(e,"pointerdown",t),"touch"===n.pointerType)this.dispatchEvent(e,"touchstart",t);else if("mouse"===n.pointerType||"pen"===n.pointerType){var s=2===n.button;s?e.trackedPointers[r].rightDown=!0:e.trackedPointers[r].leftDown=!0,this.dispatchEvent(e,s?"rightdown":"mousedown",t)}},Ar.prototype.onPointerComplete=function(t,e,i){for(var n=this.normalizeToPointerData(t),r=n.length,s=t.target!==this.interactionDOMElement?"outside":"",o=0;o<r;o++){var a=n[o],l=this.getInteractionDataForPointerId(a),h=this.configureInteractionEventForDOMEvent(this.eventData,a,l);if(h.data.originalEvent=t,this.processInteractive(h,this.lastObjectRendered,i,e||!s),this.emit(e?"pointercancel":"pointerup"+s,h),"mouse"===a.pointerType||"pen"===a.pointerType){var u=2===a.button;this.emit(u?"rightup"+s:"mouseup"+s,h)}else"touch"===a.pointerType&&(this.emit(e?"touchcancel":"touchend"+s,h),this.releaseInteractionDataForPointerId(a.pointerId))}},Ar.prototype.onPointerCancel=function(t){this.supportsTouchEvents&&"touch"===t.pointerType||this.onPointerComplete(t,!0,this.processPointerCancel)},Ar.prototype.processPointerCancel=function(t,e){var i=t.data,n=t.data.identifier;void 0!==e.trackedPointers[n]&&(delete e.trackedPointers[n],this.dispatchEvent(e,"pointercancel",t),"touch"===i.pointerType&&this.dispatchEvent(e,"touchcancel",t))},Ar.prototype.onPointerUp=function(t){this.supportsTouchEvents&&"touch"===t.pointerType||this.onPointerComplete(t,!1,this.processPointerUp)},Ar.prototype.processPointerUp=function(t,e,i){var n=t.data,r=t.data.identifier,s=e.trackedPointers[r],o="touch"===n.pointerType,a="mouse"===n.pointerType||"pen"===n.pointerType,l=!1;if(a){var h=2===n.button,u=dr.FLAGS,c=h?u.RIGHT_DOWN:u.LEFT_DOWN,d=void 0!==s&&s.flags&c;i?(this.dispatchEvent(e,h?"rightup":"mouseup",t),d&&(this.dispatchEvent(e,h?"rightclick":"click",t),l=!0)):d&&this.dispatchEvent(e,h?"rightupoutside":"mouseupoutside",t),s&&(h?s.rightDown=!1:s.leftDown=!1)}i?(this.dispatchEvent(e,"pointerup",t),o&&this.dispatchEvent(e,"touchend",t),s&&(a&&!l||this.dispatchEvent(e,"pointertap",t),o&&(this.dispatchEvent(e,"tap",t),s.over=!1))):s&&(this.dispatchEvent(e,"pointerupoutside",t),o&&this.dispatchEvent(e,"touchendoutside",t)),s&&s.none&&delete e.trackedPointers[r]},Ar.prototype.onPointerMove=function(t){if(!this.supportsTouchEvents||"touch"!==t.pointerType){var e=this.normalizeToPointerData(t);"mouse"!==e[0].pointerType&&"pen"!==e[0].pointerType||(this._didMove=!0,this.cursor=null);for(var i=e.length,n=0;n<i;n++){var r=e[n],s=this.getInteractionDataForPointerId(r),o=this.configureInteractionEventForDOMEvent(this.eventData,r,s);o.data.originalEvent=t,this.processInteractive(o,this.lastObjectRendered,this.processPointerMove,!0),this.emit("pointermove",o),"touch"===r.pointerType&&this.emit("touchmove",o),"mouse"!==r.pointerType&&"pen"!==r.pointerType||this.emit("mousemove",o)}"mouse"===e[0].pointerType&&this.setCursorMode(this.cursor)}},Ar.prototype.processPointerMove=function(t,e,i){var n=t.data,r="touch"===n.pointerType,s="mouse"===n.pointerType||"pen"===n.pointerType;s&&this.processPointerOverOut(t,e,i),this.moveWhenInside&&!i||(this.dispatchEvent(e,"pointermove",t),r&&this.dispatchEvent(e,"touchmove",t),s&&this.dispatchEvent(e,"mousemove",t))},Ar.prototype.onPointerOut=function(t){if(!this.supportsTouchEvents||"touch"!==t.pointerType){var e=this.normalizeToPointerData(t)[0];"mouse"===e.pointerType&&(this.mouseOverRenderer=!1,this.setCursorMode(null));var i=this.getInteractionDataForPointerId(e),n=this.configureInteractionEventForDOMEvent(this.eventData,e,i);n.data.originalEvent=e,this.processInteractive(n,this.lastObjectRendered,this.processPointerOverOut,!1),this.emit("pointerout",n),"mouse"===e.pointerType||"pen"===e.pointerType?this.emit("mouseout",n):this.releaseInteractionDataForPointerId(i.identifier)}},Ar.prototype.processPointerOverOut=function(t,e,i){var n=t.data,r=t.data.identifier,s="mouse"===n.pointerType||"pen"===n.pointerType,o=e.trackedPointers[r];i&&!o&&(o=e.trackedPointers[r]=new dr(r)),void 0!==o&&(i&&this.mouseOverRenderer?(o.over||(o.over=!0,this.delayDispatchEvent(e,"pointerover",t),s&&this.delayDispatchEvent(e,"mouseover",t)),s&&null===this.cursor&&(this.cursor=e.cursor)):o.over&&(o.over=!1,this.dispatchEvent(e,"pointerout",this.eventData),s&&this.dispatchEvent(e,"mouseout",t),o.none&&delete e.trackedPointers[r]))},Ar.prototype.onPointerOver=function(t){var e=this.normalizeToPointerData(t)[0],i=this.getInteractionDataForPointerId(e),n=this.configureInteractionEventForDOMEvent(this.eventData,e,i);"mouse"===(n.data.originalEvent=e).pointerType&&(this.mouseOverRenderer=!0),this.emit("pointerover",n),"mouse"!==e.pointerType&&"pen"!==e.pointerType||this.emit("mouseover",n)},Ar.prototype.getInteractionDataForPointerId=function(t){var e,i=t.pointerId;return 1===i||"mouse"===t.pointerType?e=this.mouse:this.activeInteractionData[i]?e=this.activeInteractionData[i]:((e=this.interactionDataPool.pop()||new hr).identifier=i,this.activeInteractionData[i]=e),e.copyEvent(t),e},Ar.prototype.releaseInteractionDataForPointerId=function(t){var e=this.activeInteractionData[t];e&&(delete this.activeInteractionData[t],e.reset(),this.interactionDataPool.push(e))},Ar.prototype.configureInteractionEventForDOMEvent=function(t,e,i){return t.data=i,this.mapPositionToPoint(i.global,e.clientX,e.clientY),"touch"===e.pointerType&&(e.globalX=i.global.x,e.globalY=i.global.y),i.originalEvent=e,t.reset(),t},Ar.prototype.normalizeToPointerData=function(t){var e=[];if(this.supportsTouchEvents&&t instanceof TouchEvent)for(var i=0,n=t.changedTouches.length;i<n;i++){var r=t.changedTouches[i];void 0===r.button&&(r.button=t.touches.length?1:0),void 0===r.buttons&&(r.buttons=t.touches.length?1:0),void 0===r.isPrimary&&(r.isPrimary=1===t.touches.length&&"touchstart"===t.type),void 0===r.width&&(r.width=r.radiusX||1),void 0===r.height&&(r.height=r.radiusY||1),void 0===r.tiltX&&(r.tiltX=0),void 0===r.tiltY&&(r.tiltY=0),void 0===r.pointerType&&(r.pointerType="touch"),void 0===r.pointerId&&(r.pointerId=r.identifier||0),void 0===r.pressure&&(r.pressure=r.force||.5),void 0===r.twist&&(r.twist=0),void 0===r.tangentialPressure&&(r.tangentialPressure=0),void 0===r.layerX&&(r.layerX=r.offsetX=r.clientX),void 0===r.layerY&&(r.layerY=r.offsetY=r.clientY),r.isNormalized=!0,e.push(r)}else if(!self.MouseEvent||t instanceof MouseEvent&&!(this.supportsPointerEvents&&t instanceof self.PointerEvent)){var s=t;void 0===s.isPrimary&&(s.isPrimary=!0),void 0===s.width&&(s.width=1),void 0===s.height&&(s.height=1),void 0===s.tiltX&&(s.tiltX=0),void 0===s.tiltY&&(s.tiltY=0),void 0===s.pointerType&&(s.pointerType="mouse"),void 0===s.pointerId&&(s.pointerId=1),void 0===s.pressure&&(s.pressure=.5),void 0===s.twist&&(s.twist=0),void 0===s.tangentialPressure&&(s.tangentialPressure=0),s.isNormalized=!0,e.push(s)}else e.push(t);return e},Ar.prototype.destroy=function(){this.removeEvents(),this.removeTickerListener(),this.removeAllListeners(),this.renderer=null,this.mouse=null,this.eventData=null,this.interactionDOMElement=null,this.onPointerDown=null,this.processPointerDown=null,this.onPointerUp=null,this.processPointerUp=null,this.onPointerCancel=null,this.processPointerCancel=null,this.onPointerMove=null,this.processPointerMove=null,this.onPointerOut=null,this.processPointerOverOut=null,this.onPointerOver=null,this.search=null},Ar),Cr=(Er.prototype.emit=function(t,e,i,n,r,s,o,a){if(8<arguments.length)throw new Error("max arguments reached");var l=this.name,h=this.items;this._aliasCount++;for(var u=0,c=h.length;u<c;u++)h[u][l](t,e,i,n,r,s,o,a);return h===this.items&&this._aliasCount--,this},Er.prototype.ensureNonAliasedItems=function(){0<this._aliasCount&&1<this.items.length&&(this._aliasCount=0,this.items=this.items.slice(0))},Er.prototype.add=function(t){return t[this._name]&&(this.ensureNonAliasedItems(),this.remove(t),this.items.push(t)),this},Er.prototype.remove=function(t){var e=this.items.indexOf(t);return-1!==e&&(this.ensureNonAliasedItems(),this.items.splice(e,1)),this},Er.prototype.contains=function(t){return-1!==this.items.indexOf(t)},Er.prototype.removeAll=function(){return this.ensureNonAliasedItems(),this.items.length=0,this},Er.prototype.destroy=function(){this.removeAll(),this.items=null,this._name=null},Object.defineProperty(Er.prototype,"empty",{get:function(){return 0===this.items.length},enumerable:!1,configurable:!0}),Object.defineProperty(Er.prototype,"name",{get:function(){return this._name},enumerable:!1,configurable:!0}),Er);function Er(t){this.items=[],this._name=t,this._aliasCount=0}function Ar(t,e){var i=Sr.call(this)||this;return e=e||{},i.renderer=t,i.autoPreventDefault=void 0===e.autoPreventDefault||e.autoPreventDefault,i.interactionFrequency=e.interactionFrequency||10,i.mouse=new hr,i.mouse.identifier=1,i.mouse.global.set(-999999),i.activeInteractionData={},i.activeInteractionData[1]=i.mouse,i.interactionDataPool=[],i.eventData=new cr,i.interactionDOMElement=null,i.moveWhenInside=!1,i.eventsAdded=!1,i.tickerAdded=!1,i.mouseOverRenderer=!("PointerEvent"in self),i.supportsTouchEvents="ontouchstart"in self,i.supportsPointerEvents=!!self.PointerEvent,i.onPointerUp=i.onPointerUp.bind(i),i.processPointerUp=i.processPointerUp.bind(i),i.onPointerCancel=i.onPointerCancel.bind(i),i.processPointerCancel=i.processPointerCancel.bind(i),i.onPointerDown=i.onPointerDown.bind(i),i.processPointerDown=i.processPointerDown.bind(i),i.onPointerMove=i.onPointerMove.bind(i),i.processPointerMove=i.processPointerMove.bind(i),i.onPointerOut=i.onPointerOut.bind(i),i.processPointerOverOut=i.processPointerOverOut.bind(i),i.onPointerOver=i.onPointerOver.bind(i),i.cursorStyles={default:"inherit",pointer:"pointer"},i.currentCursorMode=null,i.cursor=null,i.resolution=1,i.delayedEvents=[],i.search=new pr,i._tempDisplayObject=new Kn,i._eventListenerOptions={capture:!0,passive:!1},i._useSystemTicker=void 0===e.useSystemTicker||e.useSystemTicker,i.setTargetElement(i.renderer.view,i.renderer.resolution),i}function Mr(){this.constructor=xr}Object.defineProperties(Cr.prototype,{dispatch:{value:Cr.prototype.emit},run:{value:Cr.prototype.emit}}),Tt.PREFER_ENV=wt.any?nt.ENV.WEBGL:nt.ENV.WEBGL2,Tt.STRICT_TEXTURE_CACHE=!1;var Br=[];function Rr(t,e){if(!t)return null;var i="";if("string"==typeof t){var n=/\.(\w{3,4})(?:$|\?|#)/i.exec(t);n&&(i=n[1].toLowerCase())}for(var r=Br.length-1;0<=r;--r){var s=Br[r];if(s.test&&s.test(t,i))return new s(t,e)}throw new Error("Unrecognized source type to auto-detect Resource")}var Or=function(t,e){return(Or=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)};function kr(t,e){function i(){this.constructor=t}Or(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}var Dr,Fr,Nr,Lr,Ur,zr,Wr,Gr,Hr,Xr,jr,Vr=function(){return(Vr=Object.assign||function(t){for(var e,i=arguments,n=1,r=arguments.length;n<r;n++)for(var s in e=i[n])Object.prototype.hasOwnProperty.call(e,s)&&(t[s]=e[s]);return t}).apply(this,arguments)},Yr=(ys.prototype.bind=function(t){this.onResize.add(t),this.onUpdate.add(t),this.onError.add(t),(this._width||this._height)&&this.onResize.emit(this._width,this._height)},ys.prototype.unbind=function(t){this.onResize.remove(t),this.onUpdate.remove(t),this.onError.remove(t)},ys.prototype.resize=function(t,e){t===this._width&&e===this._height||(this._width=t,this._height=e,this.onResize.emit(t,e))},Object.defineProperty(ys.prototype,"valid",{get:function(){return!!this._width&&!!this._height},enumerable:!1,configurable:!0}),ys.prototype.update=function(){this.destroyed||this.onUpdate.emit()},ys.prototype.load=function(){return Promise.resolve(this)},Object.defineProperty(ys.prototype,"width",{get:function(){return this._width},enumerable:!1,configurable:!0}),Object.defineProperty(ys.prototype,"height",{get:function(){return this._height},enumerable:!1,configurable:!0}),ys.prototype.style=function(t,e,i){return!1},ys.prototype.dispose=function(){},ys.prototype.destroy=function(){this.destroyed||(this.destroyed=!0,this.dispose(),this.onError.removeAll(),this.onError=null,this.onResize.removeAll(),this.onResize=null,this.onUpdate.removeAll(),this.onUpdate=null)},ys.test=function(t,e){return!1},ys),qr=(kr(ms,jr=Yr),ms.prototype.upload=function(t,e,i){var n=t.gl;n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e.alphaMode===nt.ALPHA_MODES.UNPACK);var r=e.realWidth,s=e.realHeight;return i.width===r&&i.height===s?n.texSubImage2D(e.target,0,0,0,r,s,e.format,i.type,this.data):(i.width=r,i.height=s,n.texImage2D(e.target,0,i.internalFormat,r,s,0,e.format,i.type,this.data)),!0},ms.prototype.dispose=function(){this.data=null},ms.test=function(t){return t instanceof Float32Array||t instanceof Uint8Array||t instanceof Uint32Array},ms),Kr={scaleMode:nt.SCALE_MODES.NEAREST,format:nt.FORMATS.RGBA,alphaMode:nt.ALPHA_MODES.NPM},$r=(kr(gs,Xr=Ct),Object.defineProperty(gs.prototype,"realWidth",{get:function(){return Math.round(this.width*this.resolution)},enumerable:!1,configurable:!0}),Object.defineProperty(gs.prototype,"realHeight",{get:function(){return Math.round(this.height*this.resolution)},enumerable:!1,configurable:!0}),Object.defineProperty(gs.prototype,"mipmap",{get:function(){return this._mipmap},set:function(t){this._mipmap!==t&&(this._mipmap=t,this.dirtyStyleId++)},enumerable:!1,configurable:!0}),Object.defineProperty(gs.prototype,"scaleMode",{get:function(){return this._scaleMode},set:function(t){this._scaleMode!==t&&(this._scaleMode=t,this.dirtyStyleId++)},enumerable:!1,configurable:!0}),Object.defineProperty(gs.prototype,"wrapMode",{get:function(){return this._wrapMode},set:function(t){this._wrapMode!==t&&(this._wrapMode=t,this.dirtyStyleId++)},enumerable:!1,configurable:!0}),gs.prototype.setStyle=function(t,e){var i;return void 0!==t&&t!==this.scaleMode&&(this.scaleMode=t,i=!0),void 0!==e&&e!==this.mipmap&&(this.mipmap=e,i=!0),i&&this.dirtyStyleId++,this},gs.prototype.setSize=function(t,e,i){return i=i||this.resolution,this.setRealSize(t*i,e*i,i)},gs.prototype.setRealSize=function(t,e,i){return this.resolution=i||this.resolution,this.width=Math.round(t)/this.resolution,this.height=Math.round(e)/this.resolution,this._refreshPOT(),this.update(),this},gs.prototype._refreshPOT=function(){this.isPowerOfTwo=hi(this.realWidth)&&hi(this.realHeight)},gs.prototype.setResolution=function(t){var e=this.resolution;return e===t||(this.resolution=t,this.valid&&(this.width=Math.round(this.width*e)/t,this.height=Math.round(this.height*e)/t,this.emit("update",this)),this._refreshPOT()),this},gs.prototype.setResource=function(t){if(this.resource===t)return this;if(this.resource)throw new Error("Resource can be set only once");return t.bind(this),this.resource=t,this},gs.prototype.update=function(){this.valid?(this.dirtyId++,this.dirtyStyleId++,this.emit("update",this)):0<this.width&&0<this.height&&(this.valid=!0,this.emit("loaded",this),this.emit("update",this))},gs.prototype.onError=function(t){this.emit("error",this,t)},gs.prototype.destroy=function(){this.resource&&(this.resource.unbind(this),this.resource.internal&&this.resource.destroy(),this.resource=null),this.cacheId&&(delete _i[this.cacheId],delete yi[this.cacheId],this.cacheId=null),this.dispose(),gs.removeFromCache(this),this.textureCacheIds=null,this.destroyed=!0},gs.prototype.dispose=function(){this.emit("dispose",this)},gs.prototype.castToBaseTexture=function(){return this},gs.from=function(t,e,i){void 0===i&&(i=Tt.STRICT_TEXTURE_CACHE);var n="string"==typeof t,r=null;if(n)r=t;else{if(!t._pixiId){var s=e&&e.pixiIdPrefix||"pixiid";t._pixiId=s+"_"+fi()}r=t._pixiId}var o=_i[r];if(n&&i&&!o)throw new Error('The cacheId "'+r+'" does not exist in BaseTextureCache.');return o||((o=new gs(t,e)).cacheId=r,gs.addToCache(o,r)),o},gs.fromBuffer=function(t,e,i,n){t=t||new Float32Array(e*i*4);var r=new qr(t,{width:e,height:i}),s=t instanceof Float32Array?nt.TYPES.FLOAT:nt.TYPES.UNSIGNED_BYTE;return new gs(r,Object.assign(Kr,n||{width:e,height:i,type:s}))},gs.addToCache=function(t,e){e&&(-1===t.textureCacheIds.indexOf(e)&&t.textureCacheIds.push(e),_i[e]&&console.warn("BaseTexture added to the cache with an id ["+e+"] that already had an entry"),_i[e]=t)},gs.removeFromCache=function(t){if("string"==typeof t){var e=_i[t];if(e){var i=e.textureCacheIds.indexOf(t);return-1<i&&e.textureCacheIds.splice(i,1),delete _i[t],e}}else if(t&&t.textureCacheIds){for(var n=0;n<t.textureCacheIds.length;++n)delete _i[t.textureCacheIds[n]];return t.textureCacheIds.length=0,t}return null},gs._globalBatch=0,gs),Qr=(kr(fs,Hr=Yr),fs.prototype.initFromArray=function(t,e){for(var i=0;i<this.length;i++)t[i]&&(t[i].castToBaseTexture?this.addBaseTextureAt(t[i].castToBaseTexture(),i):t[i]instanceof Yr?this.addResourceAt(t[i],i):this.addResourceAt(Rr(t[i],e),i))},fs.prototype.dispose=function(){for(var t=0,e=this.length;t<e;t++)this.items[t].destroy();this.items=null,this.itemDirtyIds=null,this._load=null},fs.prototype.addResourceAt=function(t,e){if(!this.items[e])throw new Error("Index "+e+" is out of bounds");return t.valid&&!this.valid&&this.resize(t.width,t.height),this.items[e].setResource(t),this},fs.prototype.bind=function(t){if(null!==this.baseTexture)throw new Error("Only one base texture per TextureArray is allowed");Hr.prototype.bind.call(this,t);for(var e=0;e<this.length;e++)this.items[e].parentTextureArray=t,this.items[e].on("update",t.update,t)},fs.prototype.unbind=function(t){Hr.prototype.unbind.call(this,t);for(var e=0;e<this.length;e++)this.items[e].parentTextureArray=null,this.items[e].off("update",t.update,t)},fs.prototype.load=function(){var n=this;if(this._load)return this._load;var t=this.items.map(function(t){return t.resource}).filter(function(t){return t}).map(function(t){return t.load()});return this._load=Promise.all(t).then(function(){var t=n.items[0],e=t.realWidth,i=t.realHeight;return n.resize(e,i),Promise.resolve(n)}),this._load},fs),Jr=(kr(ps,Gr=Qr),ps.prototype.addBaseTextureAt=function(t,e){if(!t.resource)throw new Error("ArrayResource does not support RenderTexture");return this.addResourceAt(t.resource,e),this},ps.prototype.bind=function(t){Gr.prototype.bind.call(this,t),t.target=nt.TARGETS.TEXTURE_2D_ARRAY},ps.prototype.upload=function(t,e,i){var n=this.length,r=this.itemDirtyIds,s=this.items,o=t.gl;i.dirtyId<0&&o.texImage3D(o.TEXTURE_2D_ARRAY,0,i.internalFormat,this._width,this._height,n,0,e.format,i.type,null);for(var a=0;a<n;a++){var l=s[a];r[a]<l.dirtyId&&(r[a]=l.dirtyId,l.valid&&o.texSubImage3D(o.TEXTURE_2D_ARRAY,0,0,0,a,l.resource.width,l.resource.height,1,e.format,i.type,l.resource.source))}return!0},ps),Zr=(kr(ds,Wr=Yr),ds.crossOrigin=function(t,e,i){void 0===i&&0!==e.indexOf("data:")?t.crossOrigin=Ti(e):!1!==i&&(t.crossOrigin="string"==typeof i?i:"anonymous")},ds.prototype.upload=function(t,e,i,n){var r=t.gl,s=e.realWidth,o=e.realHeight;return n=n||this.source,r.pixelStorei(r.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e.alphaMode===nt.ALPHA_MODES.UNPACK),this.noSubImage||e.target!==r.TEXTURE_2D||i.width!==s||i.height!==o?(i.width=s,i.height=o,r.texImage2D(e.target,0,i.internalFormat,e.format,i.type,n)):r.texSubImage2D(r.TEXTURE_2D,0,0,0,e.format,i.type,n),!0},ds.prototype.update=function(){if(!this.destroyed){var t=this.source,e=t.naturalWidth||t.videoWidth||t.width,i=t.naturalHeight||t.videoHeight||t.height;this.resize(e,i),Wr.prototype.update.call(this)}},ds.prototype.dispose=function(){this.source=null},ds),ts=(kr(cs,zr=Zr),cs.test=function(t){var e=self.OffscreenCanvas;return!!(e&&t instanceof e)||self.HTMLCanvasElement&&t instanceof HTMLCanvasElement},cs),es=(kr(us,Ur=Qr),us.prototype.bind=function(t){Ur.prototype.bind.call(this,t),t.target=nt.TARGETS.TEXTURE_CUBE_MAP},us.prototype.addBaseTextureAt=function(t,e,i){if(void 0===i&&(i=this.linkBaseTexture),!this.items[e])throw new Error("Index "+e+" is out of bounds");if(!this.linkBaseTexture||t.parentTextureArray||0<Object.keys(t._glTextures).length){if(!t.resource)throw new Error("CubeResource does not support copying of renderTexture.");this.addResourceAt(t.resource,e)}else t.target=nt.TARGETS.TEXTURE_CUBE_MAP_POSITIVE_X+e,t.parentTextureArray=this.baseTexture,this.items[e]=t;return t.valid&&!this.valid&&this.resize(t.realWidth,t.realHeight),this.items[e]=t,this},us.prototype.upload=function(t,e,i){for(var n=this.itemDirtyIds,r=0;r<us.SIDES;r++){var s=this.items[r];n[r]<s.dirtyId&&(s.valid&&s.resource?(s.resource.upload(t,s,i),n[r]=s.dirtyId):n[r]<-1&&(t.gl.texImage2D(s.target,0,i.internalFormat,e.realWidth,e.realHeight,0,e.format,i.type,null),n[r]=-1))}return!0},us.test=function(t){return Array.isArray(t)&&t.length===us.SIDES},us.SIDES=6,us),is=(kr(hs,Lr=Zr),hs.prototype.load=function(t){var r=this;return this._load||(void 0!==t&&(this.createBitmap=t),this._load=new Promise(function(t,e){var i=r.source;function n(){r.destroyed||(i.onload=null,i.onerror=null,r.resize(i.width,i.height),r._load=null,r.createBitmap?t(r.process()):t(r))}r.url=i.src,i.complete&&i.src?n():(i.onload=n,i.onerror=function(t){e(t),r.onError.emit(t)})})),this._load},hs.prototype.process=function(){var e=this,i=this.source;if(null!==this._process)return this._process;if(null!==this.bitmap||!self.createImageBitmap)return Promise.resolve(this);var n=self.createImageBitmap,t=!i.crossOrigin||"anonymous"===i.crossOrigin;return this._process=fetch(i.src,{mode:t?"cors":"no-cors"}).then(function(t){return t.blob()}).then(function(t){return n(t,0,0,i.width,i.height,{premultiplyAlpha:e.alphaMode===nt.ALPHA_MODES.UNPACK?"premultiply":"none"})}).then(function(t){return e.destroyed?Promise.reject():(e.bitmap=t,e.update(),e._process=null,Promise.resolve(e))}),this._process},hs.prototype.upload=function(t,e,i){if("number"==typeof this.alphaMode&&(e.alphaMode=this.alphaMode),!this.createBitmap)return Lr.prototype.upload.call(this,t,e,i);if(!this.bitmap&&(this.process(),!this.bitmap))return!1;if(Lr.prototype.upload.call(this,t,e,i,this.bitmap),!this.preserveBitmap){var n=!0,r=e._glTextures;for(var s in r){var o=r[s];if(o!==i&&o.dirtyId!==e.dirtyId){n=!1;break}}n&&(this.bitmap.close&&this.bitmap.close(),this.bitmap=null)}return!0},hs.prototype.dispose=function(){this.source.onload=null,this.source.onerror=null,Lr.prototype.dispose.call(this),this.bitmap&&(this.bitmap.close(),this.bitmap=null),this._process=null,this._load=null},hs.test=function(t){return"string"==typeof t||t instanceof HTMLImageElement},hs),ns=(kr(ls,Nr=Zr),ls.prototype.load=function(){var e=this;return this._load||(this._load=new Promise(function(t){if(e._resolve=function(){e.resize(e.source.width,e.source.height),t(e)},ls.SVG_XML.test(e.svg.trim())){if(!btoa)throw new Error("Your browser doesn't support base64 conversions.");e.svg="data:image/svg+xml;base64,"+btoa(unescape(encodeURIComponent(e.svg)))}e._loadSvg()})),this._load},ls.prototype._loadSvg=function(){var s=this,o=new Image;Zr.crossOrigin(o,this.svg,this._crossorigin),o.src=this.svg,o.onerror=function(t){s._resolve&&(o.onerror=null,s.onError.emit(t))},o.onload=function(){if(s._resolve){var t=o.width,e=o.height;if(!t||!e)throw new Error("The SVG image must have width and height defined (in pixels), canvas API needs them.");var i=t*s.scale,n=e*s.scale;(s._overrideWidth||s._overrideHeight)&&(i=s._overrideWidth||s._overrideHeight/e*t,n=s._overrideHeight||s._overrideWidth/t*e),i=Math.round(i),n=Math.round(n);var r=s.source;r.width=i,r.height=n,r._pixiId="canvas_"+fi(),r.getContext("2d").drawImage(o,0,0,t,e,0,0,i,n),s._resolve(),s._resolve=null}}},ls.getSize=function(t){var e=ls.SVG_SIZE.exec(t),i={};return e&&(i[e[1]]=Math.round(parseFloat(e[3])),i[e[5]]=Math.round(parseFloat(e[7]))),i},ls.prototype.dispose=function(){Nr.prototype.dispose.call(this),this._resolve=null,this._crossorigin=null},ls.test=function(t,e){return"svg"===e||"string"==typeof t&&/^data:image\/svg\+xml(;(charset=utf8|utf8))?;base64/.test(t)||"string"==typeof t&&ls.SVG_XML.test(t)},ls.SVG_XML=/^(<\?xml[^?]+\?>)?\s*(<!--[^(-->)]*-->)?\s*\<svg/m,ls.SVG_SIZE=/<svg[^>]*(?:\s(width|height)=('|")(\d*(?:\.\d+)?)(?:px)?('|"))[^>]*(?:\s(width|height)=('|")(\d*(?:\.\d+)?)(?:px)?('|"))[^>]*>/i,ls),rs=(kr(as,Fr=Zr),as.prototype.update=function(t){if(!this.destroyed){var e=ar.shared.elapsedMS*this.source.playbackRate;this._msToNextUpdate=Math.floor(this._msToNextUpdate-e),(!this._updateFPS||this._msToNextUpdate<=0)&&(Fr.prototype.update.call(this),this._msToNextUpdate=this._updateFPS?Math.floor(1e3/this._updateFPS):0)}},as.prototype.load=function(){var e=this;if(this._load)return this._load;var i=this.source;return(i.readyState===i.HAVE_ENOUGH_DATA||i.readyState===i.HAVE_FUTURE_DATA)&&i.width&&i.height&&(i.complete=!0),i.addEventListener("play",this._onPlayStart.bind(this)),i.addEventListener("pause",this._onPlayStop.bind(this)),this._isSourceReady()?this._onCanPlay():(i.addEventListener("canplay",this._onCanPlay),i.addEventListener("canplaythrough",this._onCanPlay),i.addEventListener("error",this._onError,!0)),this._load=new Promise(function(t){e.valid?t(e):(e._resolve=t,i.load())}),this._load},as.prototype._onError=function(t){this.source.removeEventListener("error",this._onError,!0),this.onError.emit(t)},as.prototype._isSourcePlaying=function(){var t=this.source;return 0<t.currentTime&&!1===t.paused&&!1===t.ended&&2<t.readyState},as.prototype._isSourceReady=function(){var t=this.source;return 3===t.readyState||4===t.readyState},as.prototype._onPlayStart=function(){this.valid||this._onCanPlay(),this.autoUpdate&&!this._isConnectedToTicker&&(ar.shared.add(this.update,this),this._isConnectedToTicker=!0)},as.prototype._onPlayStop=function(){this._isConnectedToTicker&&(ar.shared.remove(this.update,this),this._isConnectedToTicker=!1)},as.prototype._onCanPlay=function(){var t=this.source;t.removeEventListener("canplay",this._onCanPlay),t.removeEventListener("canplaythrough",this._onCanPlay);var e=this.valid;this.resize(t.videoWidth,t.videoHeight),!e&&this._resolve&&(this._resolve(this),this._resolve=null),this._isSourcePlaying()?this._onPlayStart():this.autoPlay&&t.play()},as.prototype.dispose=function(){this._isConnectedToTicker&&(ar.shared.remove(this.update,this),this._isConnectedToTicker=!1);var t=this.source;t&&(t.removeEventListener("error",this._onError,!0),t.pause(),t.src="",t.load()),Fr.prototype.dispose.call(this)},Object.defineProperty(as.prototype,"autoUpdate",{get:function(){return this._autoUpdate},set:function(t){t!==this._autoUpdate&&(this._autoUpdate=t,!this._autoUpdate&&this._isConnectedToTicker?(ar.shared.remove(this.update,this),this._isConnectedToTicker=!1):this._autoUpdate&&!this._isConnectedToTicker&&this._isSourcePlaying()&&(ar.shared.add(this.update,this),this._isConnectedToTicker=!0))},enumerable:!1,configurable:!0}),Object.defineProperty(as.prototype,"updateFPS",{get:function(){return this._updateFPS},set:function(t){t!==this._updateFPS&&(this._updateFPS=t)},enumerable:!1,configurable:!0}),as.test=function(t,e){return self.HTMLVideoElement&&t instanceof HTMLVideoElement||-1<as.TYPES.indexOf(e)},as.TYPES=["mp4","m4v","webm","ogg","ogv","h264","avi","mov"],as.MIME_TYPES={ogv:"video/ogg",mov:"video/quicktime",m4v:"video/mp4"},as),ss=(kr(os,Dr=Zr),os.test=function(t){return!!self.createImageBitmap&&t instanceof ImageBitmap},os);function os(t){return Dr.call(this,t)||this}function as(t,e){var i=this;if(e=e||{},!(t instanceof HTMLVideoElement)){var n=document.createElement("video");n.setAttribute("preload","auto"),n.setAttribute("webkit-playsinline",""),n.setAttribute("playsinline",""),"string"==typeof t&&(t=[t]);var r=t[0].src||t[0];Zr.crossOrigin(n,r,e.crossorigin);for(var s=0;s<t.length;++s){var o=document.createElement("source"),a=t[s],l=a.src,h=a.mime,u=(l=l||t[s]).split("?").shift().toLowerCase(),c=u.substr(u.lastIndexOf(".")+1);h=h||as.MIME_TYPES[c]||"video/"+c,o.src=l,o.type=h,n.appendChild(o)}t=n}return(i=Fr.call(this,t)||this).noSubImage=!0,i._autoUpdate=!0,i._isConnectedToTicker=!1,i._updateFPS=e.updateFPS||0,i._msToNextUpdate=0,i.autoPlay=!1!==e.autoPlay,i._load=null,i._resolve=null,i._onCanPlay=i._onCanPlay.bind(i),i._onError=i._onError.bind(i),!1!==e.autoLoad&&i.load(),i}function ls(t,e){var i=this;return e=e||{},(i=Nr.call(this,document.createElement("canvas"))||this)._width=0,i._height=0,i.svg=t,i.scale=e.scale||1,i._overrideWidth=e.width,i._overrideHeight=e.height,i._resolve=null,i._crossorigin=e.crossorigin,i._load=null,!1!==e.autoLoad&&i.load(),i}function hs(t,e){var i=this;if(e=e||{},!(t instanceof HTMLImageElement)){var n=new Image;Zr.crossOrigin(n,t,e.crossorigin),n.src=t,t=n}return i=Lr.call(this,t)||this,!t.complete&&i._width&&i._height&&(i._width=0,i._height=0),i.url=t.src,i._process=null,i.preserveBitmap=!1,i.createBitmap=(void 0!==e.createBitmap?e.createBitmap:Tt.CREATE_IMAGE_BITMAP)&&!!self.createImageBitmap,i.alphaMode="number"==typeof e.alphaMode?e.alphaMode:null,i.bitmap=null,i._load=null,!1!==e.autoLoad&&i.load(),i}function us(t,e){var i=this,n=e||{},r=n.width,s=n.height,o=n.autoLoad,a=n.linkBaseTexture;if(t&&t.length!==us.SIDES)throw new Error("Invalid length. Got "+t.length+", expected 6");i=Ur.call(this,6,{width:r,height:s})||this;for(var l=0;l<us.SIDES;l++)i.items[l].target=nt.TARGETS.TEXTURE_CUBE_MAP_POSITIVE_X+l;return i.linkBaseTexture=!1!==a,t&&i.initFromArray(t,e),!1!==o&&i.load(),i}function cs(t){return zr.call(this,t)||this}function ds(t){var e=this,i=t,n=i.naturalWidth||i.videoWidth||i.width,r=i.naturalHeight||i.videoHeight||i.height;return(e=Wr.call(this,n,r)||this).source=t,e.noSubImage=!1,e}function ps(t,e){var i,n,r=this,s=e||{},o=s.width,a=s.height;return n=Array.isArray(t)?(i=t).length:t,r=Gr.call(this,n,{width:o,height:a})||this,i&&r.initFromArray(i,e),r}function fs(t,e){var i=this,n=e||{},r=n.width,s=n.height;(i=Hr.call(this,r,s)||this).items=[],i.itemDirtyIds=[];for(var o=0;o<t;o++){var a=new $r;i.items.push(a),i.itemDirtyIds.push(-2)}return i.length=t,i._load=null,i.baseTexture=null,i}function gs(t,e){void 0===t&&(t=null),void 0===e&&(e=null);var i=Xr.call(this)||this,n=(e=e||{}).alphaMode,r=e.mipmap,s=e.anisotropicLevel,o=e.scaleMode,a=e.width,l=e.height,h=e.wrapMode,u=e.format,c=e.type,d=e.target,p=e.resolution,f=e.resourceOptions;return!t||t instanceof Yr||((t=Rr(t,f)).internal=!0),i.resolution=p||Tt.RESOLUTION,i.width=Math.round((a||0)*i.resolution)/i.resolution,i.height=Math.round((l||0)*i.resolution)/i.resolution,i._mipmap=void 0!==r?r:Tt.MIPMAP_TEXTURES,i.anisotropicLevel=void 0!==s?s:Tt.ANISOTROPIC_LEVEL,i._wrapMode=h||Tt.WRAP_MODE,i._scaleMode=void 0!==o?o:Tt.SCALE_MODE,i.format=u||nt.FORMATS.RGBA,i.type=c||nt.TYPES.UNSIGNED_BYTE,i.target=d||nt.TARGETS.TEXTURE_2D,i.alphaMode=void 0!==n?n:nt.ALPHA_MODES.UNPACK,i.uid=fi(),i.touched=0,i.isPowerOfTwo=!1,i._refreshPOT(),i._glTextures={},i.dirtyId=0,i.dirtyStyleId=0,i.cacheId=null,i.valid=0<a&&0<l,i.textureCacheIds=[],i.destroyed=!1,i.resource=null,i._batchEnabled=0,i._batchLocation=0,i.parentTextureArray=null,i.setResource(t),i}function ms(t,e){var i=this,n=e||{},r=n.width,s=n.height;if(!r||!s)throw new Error("BufferResource width or height invalid");return(i=jr.call(this,r,s)||this).data=t,i}function ys(t,e){void 0===t&&(t=0),void 0===e&&(e=0),this._width=t,this._height=e,this.destroyed=!1,this.internal=!1,this.onResize=new Cr("setRealSize"),this.onUpdate=new Cr("update"),this.onError=new Cr("onError")}Br.push(is,ss,ts,rs,ns,qr,es,Jr);var _s,vs,bs,ws={__proto__:null,Resource:Yr,BaseImageResource:Zr,INSTALLED:Br,autoDetectResource:Rr,AbstractMultiResource:Qr,ArrayResource:Jr,BufferResource:qr,CanvasResource:ts,CubeResource:es,ImageResource:is,SVGResource:ns,VideoResource:rs,ImageBitmapResource:ss},Ss=(kr(Rs,bs=qr),Rs.prototype.upload=function(t,e,i){var n=t.gl;n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e.alphaMode===nt.ALPHA_MODES.UNPACK);var r=e.realWidth,s=e.realHeight;return i.width===r&&i.height===s?n.texSubImage2D(e.target,0,0,0,r,s,e.format,i.type,this.data):(i.width=r,i.height=s,n.texImage2D(e.target,0,i.internalFormat,r,s,0,e.format,i.type,this.data)),!0},Rs),xs=(Object.defineProperty(Bs.prototype,"colorTexture",{get:function(){return this.colorTextures[0]},enumerable:!1,configurable:!0}),Bs.prototype.addColorTexture=function(t,e){return void 0===t&&(t=0),this.colorTextures[t]=e||new $r(null,{scaleMode:nt.SCALE_MODES.NEAREST,resolution:1,mipmap:nt.MIPMAP_MODES.OFF,width:this.width,height:this.height}),this.dirtyId++,this.dirtyFormat++,this},Bs.prototype.addDepthTexture=function(t){return this.depthTexture=t||new $r(new Ss(null,{width:this.width,height:this.height}),{scaleMode:nt.SCALE_MODES.NEAREST,resolution:1,width:this.width,height:this.height,mipmap:nt.MIPMAP_MODES.OFF,format:nt.FORMATS.DEPTH_COMPONENT,type:nt.TYPES.UNSIGNED_SHORT}),this.dirtyId++,this.dirtyFormat++,this},Bs.prototype.enableDepth=function(){return this.depth=!0,this.dirtyId++,this.dirtyFormat++,this},Bs.prototype.enableStencil=function(){return this.stencil=!0,this.dirtyId++,this.dirtyFormat++,this},Bs.prototype.resize=function(t,e){if(t=Math.round(t),e=Math.round(e),t!==this.width||e!==this.height){this.width=t,this.height=e,this.dirtyId++,this.dirtySize++;for(var i=0;i<this.colorTextures.length;i++){var n=this.colorTextures[i],r=n.resolution;n.setSize(t/r,e/r)}this.depthTexture&&(r=this.depthTexture.resolution,this.depthTexture.setSize(t/r,e/r))}},Bs.prototype.dispose=function(){this.disposeRunner.emit(this,!1)},Bs.prototype.destroyDepthTexture=function(){this.depthTexture&&(this.depthTexture.destroy(),this.depthTexture=null,++this.dirtyId,++this.dirtyFormat)},Bs),Ts=(kr(Ms,vs=$r),Ms.prototype.resize=function(t,e){this.framebuffer.resize(t*this.resolution,e*this.resolution),this.setRealSize(this.framebuffer.width,this.framebuffer.height)},Ms.prototype.dispose=function(){this.framebuffer.dispose(),vs.prototype.dispose.call(this)},Ms.prototype.destroy=function(){vs.prototype.destroy.call(this),this.framebuffer.destroyDepthTexture(),this.framebuffer=null},Ms),Is=(As.prototype.set=function(t,e,i){var n=e.width,r=e.height;if(i){var s=t.width/2/n,o=t.height/2/r,a=t.x/n+s,l=t.y/r+o;i=tn.add(i,tn.NW),this.x0=a+s*tn.uX(i),this.y0=l+o*tn.uY(i),i=tn.add(i,2),this.x1=a+s*tn.uX(i),this.y1=l+o*tn.uY(i),i=tn.add(i,2),this.x2=a+s*tn.uX(i),this.y2=l+o*tn.uY(i),i=tn.add(i,2),this.x3=a+s*tn.uX(i),this.y3=l+o*tn.uY(i)}else this.x0=t.x/n,this.y0=t.y/r,this.x1=(t.x+t.width)/n,this.y1=t.y/r,this.x2=(t.x+t.width)/n,this.y2=(t.y+t.height)/r,this.x3=t.x/n,this.y3=(t.y+t.height)/r;this.uvsFloat32[0]=this.x0,this.uvsFloat32[1]=this.y0,this.uvsFloat32[2]=this.x1,this.uvsFloat32[3]=this.y1,this.uvsFloat32[4]=this.x2,this.uvsFloat32[5]=this.y2,this.uvsFloat32[6]=this.x3,this.uvsFloat32[7]=this.y3},As),Ps=new Is,Cs=(kr(Es,_s=Ct),Es.prototype.update=function(){this.baseTexture.resource&&this.baseTexture.resource.update()},Es.prototype.onBaseTextureUpdated=function(t){if(this.noFrame){if(!this.baseTexture.valid)return;this._frame.width=t.width,this._frame.height=t.height,this.valid=!0,this.updateUvs()}else this.frame=this._frame;this.emit("update",this)},Es.prototype.destroy=function(t){if(this.baseTexture){if(t){var e=this.baseTexture.resource;e&&e.url&&yi[e.url]&&Es.removeFromCache(e.url),this.baseTexture.destroy()}this.baseTexture.off("loaded",this.onBaseTextureUpdated,this),this.baseTexture.off("update",this.onBaseTextureUpdated,this),this.baseTexture=null}this._frame=null,this._uvs=null,this.trim=null,this.orig=null,this.valid=!1,Es.removeFromCache(this),this.textureCacheIds=null},Es.prototype.clone=function(){var t=this._frame.clone(),e=this._frame===this.orig?t:this.orig.clone(),i=new Es(this.baseTexture,!this.noFrame&&t,e,this.trim&&this.trim.clone(),this.rotate,this.defaultAnchor);return this.noFrame&&(i._frame=t),i},Es.prototype.updateUvs=function(){this._uvs===Ps&&(this._uvs=new Is),this._uvs.set(this._frame,this.baseTexture,this.rotate),this._updateID++},Es.from=function(t,e,i){void 0===e&&(e={}),void 0===i&&(i=Tt.STRICT_TEXTURE_CACHE);var n="string"==typeof t,r=null;if(n)r=t;else if(t instanceof $r){if(!t.cacheId){var s=e&&e.pixiIdPrefix||"pixiid";t.cacheId=s+"-"+fi(),$r.addToCache(t,t.cacheId)}r=t.cacheId}else t._pixiId||(s=e&&e.pixiIdPrefix||"pixiid",t._pixiId=s+"_"+fi()),r=t._pixiId;var o=yi[r];if(n&&i&&!o)throw new Error('The cacheId "'+r+'" does not exist in TextureCache.');return o||t instanceof $r?!o&&t instanceof $r&&(o=new Es(t),Es.addToCache(o,r)):(e.resolution||(e.resolution=Ii(t)),(o=new Es(new $r(t,e))).baseTexture.cacheId=r,$r.addToCache(o.baseTexture,r),Es.addToCache(o,r)),o},Es.fromURL=function(t,e){var i=Object.assign({autoLoad:!1},null==e?void 0:e.resourceOptions),n=Es.from(t,Object.assign({resourceOptions:i},e),!1),r=n.baseTexture.resource;return n.baseTexture.valid?Promise.resolve(n):r.load().then(function(){return Promise.resolve(n)})},Es.fromBuffer=function(t,e,i,n){return new Es($r.fromBuffer(t,e,i,n))},Es.fromLoader=function(t,e,i,n){var r=new $r(t,Object.assign({scaleMode:Tt.SCALE_MODE,resolution:Ii(e)},n)),s=r.resource;s instanceof is&&(s.url=e);var o=new Es(r);return i=i||e,$r.addToCache(o.baseTexture,i),Es.addToCache(o,i),i!==e&&($r.addToCache(o.baseTexture,e),Es.addToCache(o,e)),o.baseTexture.valid?Promise.resolve(o):new Promise(function(t){o.baseTexture.once("loaded",function(){return t(o)})})},Es.addToCache=function(t,e){e&&(-1===t.textureCacheIds.indexOf(e)&&t.textureCacheIds.push(e),yi[e]&&console.warn("Texture added to the cache with an id ["+e+"] that already had an entry"),yi[e]=t)},Es.removeFromCache=function(t){if("string"==typeof t){var e=yi[t];if(e){var i=e.textureCacheIds.indexOf(t);return-1<i&&e.textureCacheIds.splice(i,1),delete yi[t],e}}else if(t&&t.textureCacheIds){for(var n=0;n<t.textureCacheIds.length;++n)yi[t.textureCacheIds[n]]===t&&delete yi[t.textureCacheIds[n]];return t.textureCacheIds.length=0,t}return null},Object.defineProperty(Es.prototype,"resolution",{get:function(){return this.baseTexture.resolution},enumerable:!1,configurable:!0}),Object.defineProperty(Es.prototype,"frame",{get:function(){return this._frame},set:function(t){this._frame=t,this.noFrame=!1;var e=t.x,i=t.y,n=t.width,r=t.height,s=e+n>this.baseTexture.width,o=i+r>this.baseTexture.height;if(s||o){var a=s&&o?"and":"or",l="X: "+e+" + "+n+" = "+(e+n)+" > "+this.baseTexture.width,h="Y: "+i+" + "+r+" = "+(i+r)+" > "+this.baseTexture.height;throw new Error("Texture Error: frame does not fit inside the base Texture dimensions: "+l+" "+a+" "+h)}this.valid=n&&r&&this.baseTexture.valid,this.trim||this.rotate||(this.orig=t),this.valid&&this.updateUvs()},enumerable:!1,configurable:!0}),Object.defineProperty(Es.prototype,"rotate",{get:function(){return this._rotate},set:function(t){this._rotate=t,this.valid&&this.updateUvs()},enumerable:!1,configurable:!0}),Object.defineProperty(Es.prototype,"width",{get:function(){return this.orig.width},enumerable:!1,configurable:!0}),Object.defineProperty(Es.prototype,"height",{get:function(){return this.orig.height},enumerable:!1,configurable:!0}),Es.prototype.castToBaseTexture=function(){return this.baseTexture},Es);function Es(t,e,i,n,r,s){var o=_s.call(this)||this;if(o.noFrame=!1,e||(o.noFrame=!0,e=new Bi(0,0,1,1)),t instanceof Es&&(t=t.baseTexture),o.baseTexture=t,o._frame=e,o.trim=n,o.valid=!1,o._uvs=Ps,o.uvMatrix=null,o.orig=i||e,o._rotate=Number(r||0),!0===r)o._rotate=2;else if(o._rotate%2!=0)throw new Error("attempt to use diamond-shaped UVs. If you are sure, set rotation manually");return o.defaultAnchor=s?new Fi(s.x,s.y):new Fi(0,0),o._updateID=0,o.textureCacheIds=[],t.valid?o.noFrame?t.valid&&o.onBaseTextureUpdated(t):o.frame=e:t.once("loaded",o.onBaseTextureUpdated,o),o.noFrame&&t.on("update",o.onBaseTextureUpdated,o),o}function As(){this.x0=0,this.y0=0,this.x1=1,this.y1=0,this.x2=1,this.y2=1,this.x3=0,this.y3=1,this.uvsFloat32=new Float32Array(8)}function Ms(t){var e=this;return"number"==typeof t&&(t={width:arguments[0],height:arguments[1],scaleMode:arguments[2],resolution:arguments[3]}),t.width=t.width||100,t.height=t.height||100,t.multisample=void 0!==t.multisample?t.multisample:nt.MSAA_QUALITY.NONE,(e=vs.call(this,null,t)||this).mipmap=nt.MIPMAP_MODES.OFF,e.valid=!0,e.clearColor=[0,0,0,0],e.framebuffer=new xs(e.realWidth,e.realHeight).addColorTexture(0,e),e.framebuffer.multisample=t.multisample,e.maskStack=[],e.filterStack=[{}],e}function Bs(t,e){this.width=Math.round(t||100),this.height=Math.round(e||100),this.stencil=!1,this.depth=!1,this.dirtyId=0,this.dirtyFormat=0,this.dirtySize=0,this.depthTexture=null,this.colorTextures=[],this.glFramebuffers={},this.disposeRunner=new Cr("disposeFramebuffer"),this.multisample=nt.MSAA_QUALITY.NONE}function Rs(){return null!==bs&&bs.apply(this,arguments)||this}function Os(t){t.destroy=function(){},t.on=function(){},t.once=function(){},t.emit=function(){}}Cs.EMPTY=new Cs(new $r),Os(Cs.EMPTY),Os(Cs.EMPTY.baseTexture),Cs.WHITE=function(){var t=document.createElement("canvas");t.width=16,t.height=16;var e=t.getContext("2d");return e.fillStyle="white",e.fillRect(0,0,16,16),new Cs(new $r(new ts(t)))}(),Os(Cs.WHITE),Os(Cs.WHITE.baseTexture);function ks(t){this.framebuffer=t,this.stencil=null,this.dirtyId=-1,this.dirtyFormat=-1,this.dirtySize=-1,this.multisample=nt.MSAA_QUALITY.NONE,this.msaaBuffer=null,this.blitFramebuffer=null,this.mipLevel=0}var Ds,Fs,Ns,Ls=(kr(Co,Ns=Cs),Object.defineProperty(Co.prototype,"framebuffer",{get:function(){return this.baseTexture.framebuffer},enumerable:!1,configurable:!0}),Object.defineProperty(Co.prototype,"multisample",{get:function(){return this.framebuffer.multisample},set:function(t){this.framebuffer.multisample=t},enumerable:!1,configurable:!0}),Co.prototype.resize=function(t,e,i){void 0===i&&(i=!0);var n=this.baseTexture.resolution,r=Math.round(t*n)/n,s=Math.round(e*n)/n;this.valid=0<r&&0<s,this._frame.width=this.orig.width=r,this._frame.height=this.orig.height=s,i&&this.baseTexture.resize(r,s),this.updateUvs()},Co.prototype.setResolution=function(t){var e=this.baseTexture;e.resolution!==t&&(e.setResolution(t),this.resize(e.width,e.height,!1))},Co.create=function(t){for(var e=arguments,i=[],n=1;n<arguments.length;n++)i[n-1]=e[n];return"number"==typeof t&&(t={width:t,height:i[0],scaleMode:i[1],resolution:i[2]}),new Co(new Ts(t))},Co),Us=(Po.prototype.createTexture=function(t,e,i){void 0===i&&(i=nt.MSAA_QUALITY.NONE);var n=new Ts(Object.assign({width:t,height:e,resolution:1,multisample:i},this.textureOptions));return new Ls(n)},Po.prototype.getOptimalTexture=function(t,e,i,n){var r;void 0===i&&(i=1),void 0===n&&(n=nt.MSAA_QUALITY.NONE),t=Math.ceil(t*i),e=Math.ceil(e*i),this.enableFullScreen&&t===this._pixelsWidth&&e===this._pixelsHeight?r=1<n?-n:-1:(r=((65535&(t=li(t)))<<16|65535&(e=li(e)))>>>0,1<n&&(r+=4294967296*n)),this.texturePool[r]||(this.texturePool[r]=[]);var s=this.texturePool[r].pop();return(s=s||this.createTexture(t,e,n)).filterPoolKey=r,s.setResolution(i),s},Po.prototype.getFilterTexture=function(t,e,i){var n=this.getOptimalTexture(t.width,t.height,e||t.resolution,i||nt.MSAA_QUALITY.NONE);return n.filterFrame=t.filterFrame,n},Po.prototype.returnTexture=function(t){var e=t.filterPoolKey;t.filterFrame=null,this.texturePool[e].push(t)},Po.prototype.returnFilterTexture=function(t){this.returnTexture(t)},Po.prototype.clear=function(t){if(t=!1!==t)for(var e in this.texturePool){var i=this.texturePool[e];if(i)for(var n=0;n<i.length;n++)i[n].destroy(!0)}this.texturePool={}},Po.prototype.setScreenSize=function(t){if(t.width!==this._pixelsWidth||t.height!==this._pixelsHeight){for(var e in this.enableFullScreen=0<t.width&&0<t.height,this.texturePool)if(Number(e)<0){var i=this.texturePool[e];if(i)for(var n=0;n<i.length;n++)i[n].destroy(!0);this.texturePool[e]=[]}this._pixelsWidth=t.width,this._pixelsHeight=t.height}},Po.SCREEN_KEY=-1,Po),zs=(Io.prototype.destroy=function(){this.buffer=null},Io.from=function(t,e,i,n,r){return new Io(t,e,i,n,r)},Io),Ws=0,Gs=(To.prototype.update=function(t){t instanceof Array&&(t=new Float32Array(t)),this.data=t||this.data,this._updateID++},To.prototype.dispose=function(){this.disposeRunner.emit(this,!1)},To.prototype.destroy=function(){this.dispose(),this.data=null},Object.defineProperty(To.prototype,"index",{get:function(){return this.type===nt.BUFFER_TYPE.ELEMENT_ARRAY_BUFFER},set:function(t){this.type=t?nt.BUFFER_TYPE.ELEMENT_ARRAY_BUFFER:nt.BUFFER_TYPE.ARRAY_BUFFER},enumerable:!1,configurable:!0}),To.from=function(t){return t instanceof Array&&(t=new Float32Array(t)),new To(t)},To),Hs={Float32Array:Float32Array,Uint32Array:Uint32Array,Int32Array:Int32Array,Uint8Array:Uint8Array},Xs={5126:4,5123:2,5121:1},js=0,Vs={Float32Array:Float32Array,Uint32Array:Uint32Array,Int32Array:Int32Array,Uint8Array:Uint8Array,Uint16Array:Uint16Array},Ys=(xo.prototype.addAttribute=function(t,e,i,n,r,s,o,a){if(void 0===i&&(i=0),void 0===n&&(n=!1),void 0===a&&(a=!1),!e)throw new Error("You must pass a buffer when creating an attribute");e instanceof Gs||(e instanceof Array&&(e=new Float32Array(e)),e=new Gs(e));var l=t.split("|");if(1<l.length){for(var h=0;h<l.length;h++)this.addAttribute(l[h],e,i,n,r);return this}var u=this.buffers.indexOf(e);return-1===u&&(this.buffers.push(e),u=this.buffers.length-1),this.attributes[t]=new zs(u,i,n,r,s,o,a),this.instanced=this.instanced||a,this},xo.prototype.getAttribute=function(t){return this.attributes[t]},xo.prototype.getBuffer=function(t){return this.buffers[this.getAttribute(t).buffer]},xo.prototype.addIndex=function(t){return t instanceof Gs||(t instanceof Array&&(t=new Uint16Array(t)),t=new Gs(t)),t.type=nt.BUFFER_TYPE.ELEMENT_ARRAY_BUFFER,this.indexBuffer=t,-1===this.buffers.indexOf(t)&&this.buffers.push(t),this},xo.prototype.getIndex=function(){return this.indexBuffer},xo.prototype.interleave=function(){if(1===this.buffers.length||2===this.buffers.length&&this.indexBuffer)return this;var t,e=[],i=[],n=new Gs;for(t in this.attributes){var r=this.attributes[t],s=this.buffers[r.buffer];e.push(s.data),i.push(r.size*Xs[r.type]/4),r.buffer=0}for(n.data=function(t,e){for(var i=0,n=0,r={},s=0;s<t.length;s++)n+=e[s],i+=t[s].length;var o=new ArrayBuffer(4*i),a=null,l=0;for(s=0;s<t.length;s++){var h=e[s],u=t[s],c=oi(u);r[c]||(r[c]=new Hs[c](o)),a=r[c];for(var d=0;d<u.length;d++)a[(d/h|0)*n+l+d%h]=u[d];l+=h}return new Float32Array(o)}(e,i),t=0;t<this.buffers.length;t++)this.buffers[t]!==this.indexBuffer&&this.buffers[t].destroy();return this.buffers=[n],this.indexBuffer&&this.buffers.push(this.indexBuffer),this},xo.prototype.getSize=function(){for(var t in this.attributes){var e=this.attributes[t];return this.buffers[e.buffer].data.length/(e.stride/4||e.size)}return 0},xo.prototype.dispose=function(){this.disposeRunner.emit(this,!1)},xo.prototype.destroy=function(){this.dispose(),this.buffers=null,this.indexBuffer=null,this.attributes=null},xo.prototype.clone=function(){for(var t=new xo,e=0;e<this.buffers.length;e++)t.buffers[e]=new Gs(this.buffers[e].data.slice(0));for(var e in this.attributes){var i=this.attributes[e];t.attributes[e]=new zs(i.buffer,i.size,i.normalized,i.type,i.stride,i.start,i.instance)}return this.indexBuffer&&(t.indexBuffer=t.buffers[this.buffers.indexOf(this.indexBuffer)],t.indexBuffer.type=nt.BUFFER_TYPE.ELEMENT_ARRAY_BUFFER),t},xo.merge=function(t){for(var e,i=new xo,n=[],r=[],s=[],o=0;o<t.length;o++){e=t[o];for(var a=0;a<e.buffers.length;a++)r[a]=r[a]||0,r[a]+=e.buffers[a].data.length,s[a]=0}for(o=0;o<e.buffers.length;o++)n[o]=new(Vs[oi(e.buffers[o].data)])(r[o]),i.buffers[o]=new Gs(n[o]);for(o=0;o<t.length;o++)for(e=t[o],a=0;a<e.buffers.length;a++)n[a].set(e.buffers[a].data,s[a]),s[a]+=e.buffers[a].data.length;if(i.attributes=e.attributes,e.indexBuffer){i.indexBuffer=i.buffers[e.buffers.indexOf(e.indexBuffer)],i.indexBuffer.type=nt.BUFFER_TYPE.ELEMENT_ARRAY_BUFFER;var l=0,h=0,u=0,c=0;for(o=0;o<e.buffers.length;o++)if(e.buffers[o]!==e.indexBuffer){c=o;break}for(var o in e.attributes){var d=e.attributes[o];(0|d.buffer)===c&&(h+=d.size*Xs[d.type]/4)}for(o=0;o<t.length;o++){var p=t[o].indexBuffer.data;for(a=0;a<p.length;a++)i.indexBuffer.data[a+u]+=l;l+=t[o].buffers[c].data.length/h,u+=p.length}}return i},xo),qs=(kr(So,Fs=Ys),So),Ks=(kr(wo,Ds=Ys),wo.prototype.map=function(t,e){var i=0,n=0;return this.uvs[0]=i,this.uvs[1]=n,this.uvs[2]=i+e.width/t.width,this.uvs[3]=n,this.uvs[4]=i+e.width/t.width,this.uvs[5]=n+e.height/t.height,this.uvs[6]=i,this.uvs[7]=n+e.height/t.height,i=e.x,n=e.y,this.vertices[0]=i,this.vertices[1]=n,this.vertices[2]=i+e.width,this.vertices[3]=n,this.vertices[4]=i+e.width,this.vertices[5]=n+e.height,this.vertices[6]=i,this.vertices[7]=n+e.height,this.invalidate(),this},wo.prototype.invalidate=function(){return this.vertexBuffer._updateID++,this.uvBuffer._updateID++,this},wo),$s=0,Qs=(bo.prototype.update=function(){this.dirtyId++,!this.autoManage&&this.buffer&&this.buffer.update()},bo.prototype.add=function(t,e,i){if(this.ubo)throw new Error("[UniformGroup] uniform groups in ubo mode cannot be modified, or have uniform groups nested in them");this.uniforms[t]=new bo(e,i)},bo.from=function(t,e,i){return new bo(t,e,i)},bo.uboFrom=function(t,e){return new bo(t,null==e||e,!0)},bo),Js=(vo.prototype.clear=function(){this.target=null,this.filters=null,this.renderTexture=null},vo),Zs=[new Fi,new Fi,new Fi,new Fi],to=new Li,eo=(_o.prototype.push=function(t,e){for(var i,n,r=this.renderer,s=this.defaultFilterStack,o=this.statePool.pop()||new Js,a=this.renderer.renderTexture,l=e[0].resolution,h=e[0].multisample,u=e[0].padding,c=e[0].autoFit,d=null===(i=e[0].legacy)||void 0===i||i,p=1;p<e.length;p++){var f=e[p];l=Math.min(l,f.resolution),h=Math.min(h,f.multisample),u=this.useMaxPadding?Math.max(u,f.padding):u+f.padding,c=c&&f.autoFit,d=d||null===(n=f.legacy)||void 0===n||n}if(1===s.length&&(this.defaultFilterStack[0].renderTexture=a.current),s.push(o),o.resolution=l,o.multisample=h,o.legacy=d,o.target=t,o.sourceFrame.copyFrom(t.filterArea||t.getBounds(!0)),o.sourceFrame.pad(u),c){var g=this.tempRect.copyFrom(a.sourceFrame);r.projection.transform&&this.transformAABB(to.copyFrom(r.projection.transform).invert(),g),o.sourceFrame.fit(g)}this.roundFrame(o.sourceFrame,a.current?a.current.resolution:r.resolution,a.sourceFrame,a.destinationFrame,r.projection.transform),o.renderTexture=this.getOptimalFilterTexture(o.sourceFrame.width,o.sourceFrame.height,l,h),o.filters=e,o.destinationFrame.width=o.renderTexture.width,o.destinationFrame.height=o.renderTexture.height;var m=this.tempRect;m.x=0,m.y=0,m.width=o.sourceFrame.width,m.height=o.sourceFrame.height,o.renderTexture.filterFrame=o.sourceFrame,o.bindingSourceFrame.copyFrom(a.sourceFrame),o.bindingDestinationFrame.copyFrom(a.destinationFrame),o.transform=r.projection.transform,r.projection.transform=null,a.bind(o.renderTexture,o.sourceFrame,m),r.framebuffer.clear(0,0,0,0)},_o.prototype.pop=function(){var t=this.defaultFilterStack,e=t.pop(),i=e.filters;this.activeState=e;var n=this.globalUniforms.uniforms;n.outputFrame=e.sourceFrame,n.resolution=e.resolution;var r=n.inputSize,s=n.inputPixel,o=n.inputClamp;if(r[0]=e.destinationFrame.width,r[1]=e.destinationFrame.height,r[2]=1/r[0],r[3]=1/r[1],s[0]=Math.round(r[0]*e.resolution),s[1]=Math.round(r[1]*e.resolution),s[2]=1/s[0],s[3]=1/s[1],o[0]=.5*s[2],o[1]=.5*s[3],o[2]=e.sourceFrame.width*r[2]-.5*s[2],o[3]=e.sourceFrame.height*r[3]-.5*s[3],e.legacy){var a=n.filterArea;a[0]=e.destinationFrame.width,a[1]=e.destinationFrame.height,a[2]=e.sourceFrame.x,a[3]=e.sourceFrame.y,n.filterClamp=n.inputClamp}this.globalUniforms.update();var l=t[t.length-1];if(this.renderer.framebuffer.blit(),1===i.length)i[0].apply(this,e.renderTexture,l.renderTexture,nt.CLEAR_MODES.BLEND,e),this.returnFilterTexture(e.renderTexture);else{var h=e.renderTexture,u=this.getOptimalFilterTexture(h.width,h.height,e.resolution);u.filterFrame=h.filterFrame;var c=0;for(c=0;c<i.length-1;++c){1===c&&1<e.multisample&&((u=this.getOptimalFilterTexture(h.width,h.height,e.resolution)).filterFrame=h.filterFrame),i[c].apply(this,h,u,nt.CLEAR_MODES.CLEAR,e);var d=h;h=u,u=d}i[c].apply(this,h,l.renderTexture,nt.CLEAR_MODES.BLEND,e),1<c&&1<e.multisample&&this.returnFilterTexture(e.renderTexture),this.returnFilterTexture(h),this.returnFilterTexture(u)}e.clear(),this.statePool.push(e)},_o.prototype.bindAndClear=function(t,e){void 0===e&&(e=nt.CLEAR_MODES.CLEAR);var i=this.renderer,n=i.renderTexture,r=i.state;if(t===this.defaultFilterStack[this.defaultFilterStack.length-1].renderTexture?this.renderer.projection.transform=this.activeState.transform:this.renderer.projection.transform=null,t&&t.filterFrame){var s=this.tempRect;s.x=0,s.y=0,s.width=t.filterFrame.width,s.height=t.filterFrame.height,n.bind(t,t.filterFrame,s)}else t!==this.defaultFilterStack[this.defaultFilterStack.length-1].renderTexture?n.bind(t):this.renderer.renderTexture.bind(t,this.activeState.bindingSourceFrame,this.activeState.bindingDestinationFrame);var o=1&r.stateId||this.forceClear;(e===nt.CLEAR_MODES.CLEAR||e===nt.CLEAR_MODES.BLIT&&o)&&this.renderer.framebuffer.clear(0,0,0,0)},_o.prototype.applyFilter=function(t,e,i,n){var r=this.renderer;r.state.set(t.state),this.bindAndClear(i,n),t.uniforms.uSampler=e,t.uniforms.filterGlobals=this.globalUniforms,r.shader.bind(t),t.legacy=!!t.program.attributeData.aTextureCoord,t.legacy?(this.quadUv.map(e._frame,e.filterFrame),r.geometry.bind(this.quadUv),r.geometry.draw(nt.DRAW_MODES.TRIANGLES)):(r.geometry.bind(this.quad),r.geometry.draw(nt.DRAW_MODES.TRIANGLE_STRIP))},_o.prototype.calculateSpriteMatrix=function(t,e){var i=this.activeState,n=i.sourceFrame,r=i.destinationFrame,s=e._texture.orig,o=t.set(r.width,0,0,r.height,n.x,n.y),a=e.worldTransform.copyTo(Li.TEMP_MATRIX);return a.invert(),o.prepend(a),o.scale(1/s.width,1/s.height),o.translate(e.anchor.x,e.anchor.y),o},_o.prototype.destroy=function(){this.renderer=null,this.texturePool.clear(!1)},_o.prototype.getOptimalFilterTexture=function(t,e,i,n){return void 0===i&&(i=1),void 0===n&&(n=nt.MSAA_QUALITY.NONE),this.texturePool.getOptimalTexture(t,e,i,n)},_o.prototype.getFilterTexture=function(t,e,i){if("number"==typeof t){var n=t;t=e,e=n}t=t||this.activeState.renderTexture;var r=this.texturePool.getOptimalTexture(t.width,t.height,e||t.resolution,i||nt.MSAA_QUALITY.NONE);return r.filterFrame=t.filterFrame,r},_o.prototype.returnFilterTexture=function(t){this.texturePool.returnTexture(t)},_o.prototype.emptyPool=function(){this.texturePool.clear(!0)},_o.prototype.resize=function(){this.texturePool.setScreenSize(this.renderer.view)},_o.prototype.transformAABB=function(t,e){var i=Zs[0],n=Zs[1],r=Zs[2],s=Zs[3];i.set(e.left,e.top),n.set(e.left,e.bottom),r.set(e.right,e.top),s.set(e.right,e.bottom),t.apply(i,i),t.apply(n,n),t.apply(r,r),t.apply(s,s);var o=Math.min(i.x,n.x,r.x,s.x),a=Math.min(i.y,n.y,r.y,s.y),l=Math.max(i.x,n.x,r.x,s.x),h=Math.max(i.y,n.y,r.y,s.y);e.x=o,e.y=a,e.width=l-o,e.height=h-a},_o.prototype.roundFrame=function(t,e,i,n,r){if(r){var s=r.a,o=r.b,a=r.c,l=r.d;if((1e-4<Math.abs(o)||1e-4<Math.abs(a))&&(1e-4<Math.abs(s)||1e-4<Math.abs(l)))return}(r=r?to.copyFrom(r):to.identity()).translate(-i.x,-i.y).scale(n.width/i.width,n.height/i.height).translate(n.x,n.y),this.transformAABB(r,t),t.ceil(e),this.transformAABB(r.invert(),t)},_o),io=(yo.prototype.flush=function(){},yo.prototype.destroy=function(){this.renderer=null},yo.prototype.start=function(){},yo.prototype.stop=function(){this.flush()},yo.prototype.render=function(t){},yo),no=(mo.prototype.setObjectRenderer=function(t){this.currentRenderer!==t&&(this.currentRenderer.stop(),this.currentRenderer=t,this.currentRenderer.start())},mo.prototype.flush=function(){this.setObjectRenderer(this.emptyRenderer)},mo.prototype.reset=function(){this.setObjectRenderer(this.emptyRenderer)},mo.prototype.copyBoundTextures=function(t,e){for(var i=this.renderer.texture.boundTextures,n=e-1;0<=n;--n)t[n]=i[n]||null,t[n]&&(t[n]._batchLocation=n)},mo.prototype.boundArray=function(t,e,i,n){for(var r=t.elements,s=t.ids,o=t.count,a=0,l=0;l<o;l++){var h=r[l],u=h._batchLocation;if(0<=u&&u<n&&e[u]===h)s[l]=u;else for(;a<n;){var c=e[a];if(!c||c._batchEnabled!==i||c._batchLocation!==a){s[l]=a,e[h._batchLocation=a]=h;break}a++}}},mo.prototype.destroy=function(){this.renderer=null},mo),ro=0,so=(Object.defineProperty(go.prototype,"isLost",{get:function(){return!this.gl||this.gl.isContextLost()},enumerable:!1,configurable:!0}),go.prototype.contextChange=function(t){this.gl=t,this.renderer.gl=t,this.renderer.CONTEXT_UID=ro++,t.isContextLost()&&t.getExtension("WEBGL_lose_context")&&t.getExtension("WEBGL_lose_context").restoreContext()},go.prototype.initFromContext=function(t){this.gl=t,this.validateContext(t),this.renderer.gl=t,this.renderer.CONTEXT_UID=ro++,this.renderer.runners.contextChange.emit(t)},go.prototype.initFromOptions=function(t){var e=this.createContext(this.renderer.view,t);this.initFromContext(e)},go.prototype.createContext=function(t,e){var i;if(Tt.PREFER_ENV>=nt.ENV.WEBGL2&&(i=t.getContext("webgl2",e)),i)this.webGLVersion=2;else if(this.webGLVersion=1,!(i=t.getContext("webgl",e)||t.getContext("experimental-webgl",e)))throw new Error("This browser does not support WebGL. Try using the canvas renderer");return this.gl=i,this.getExtensions(),this.gl},go.prototype.getExtensions=function(){var t=this.gl,e={anisotropicFiltering:t.getExtension("EXT_texture_filter_anisotropic"),floatTextureLinear:t.getExtension("OES_texture_float_linear"),s3tc:t.getExtension("WEBGL_compressed_texture_s3tc"),s3tc_sRGB:t.getExtension("WEBGL_compressed_texture_s3tc_srgb"),etc:t.getExtension("WEBGL_compressed_texture_etc"),etc1:t.getExtension("WEBGL_compressed_texture_etc1"),pvrtc:t.getExtension("WEBGL_compressed_texture_pvrtc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),atc:t.getExtension("WEBGL_compressed_texture_atc"),astc:t.getExtension("WEBGL_compressed_texture_astc")};1===this.webGLVersion?Object.assign(this.extensions,e,{drawBuffers:t.getExtension("WEBGL_draw_buffers"),depthTexture:t.getExtension("WEBGL_depth_texture"),loseContext:t.getExtension("WEBGL_lose_context"),vertexArrayObject:t.getExtension("OES_vertex_array_object")||t.getExtension("MOZ_OES_vertex_array_object")||t.getExtension("WEBKIT_OES_vertex_array_object"),uint32ElementIndex:t.getExtension("OES_element_index_uint"),floatTexture:t.getExtension("OES_texture_float"),floatTextureLinear:t.getExtension("OES_texture_float_linear"),textureHalfFloat:t.getExtension("OES_texture_half_float"),textureHalfFloatLinear:t.getExtension("OES_texture_half_float_linear")}):2===this.webGLVersion&&Object.assign(this.extensions,e,{colorBufferFloat:t.getExtension("EXT_color_buffer_float")})},go.prototype.handleContextLost=function(t){t.preventDefault()},go.prototype.handleContextRestored=function(){this.renderer.runners.contextChange.emit(this.gl)},go.prototype.destroy=function(){var t=this.renderer.view;this.renderer=null,t.removeEventListener("webglcontextlost",this.handleContextLost),t.removeEventListener("webglcontextrestored",this.handleContextRestored),this.gl.useProgram(null),this.extensions.loseContext&&this.extensions.loseContext.loseContext()},go.prototype.postrender=function(){this.renderer.renderingToScreen&&this.gl.flush()},go.prototype.validateContext=function(t){var e=t.getContextAttributes(),i="WebGL2RenderingContext"in self&&t instanceof self.WebGL2RenderingContext;i&&(this.webGLVersion=2),e.stencil||console.warn("Provided WebGL context does not have a stencil buffer, masks may not render correctly");var n=i||!!t.getExtension("OES_element_index_uint");(this.supports.uint32Indices=n)||console.warn("Provided WebGL context does not support 32 index buffer, complex graphics may not render correctly")},go),oo=new Bi,ao=(fo.prototype.contextChange=function(){var t=this.gl=this.renderer.gl;if(this.CONTEXT_UID=this.renderer.CONTEXT_UID,this.current=this.unknownFramebuffer,this.viewport=new Bi,this.hasMRT=!0,this.writeDepthTexture=!0,this.disposeAll(!0),1===this.renderer.context.webGLVersion){var e=this.renderer.context.extensions.drawBuffers,i=this.renderer.context.extensions.depthTexture;Tt.PREFER_ENV===nt.ENV.WEBGL_LEGACY&&(i=e=null),e?t.drawBuffers=function(t){return e.drawBuffersWEBGL(t)}:(this.hasMRT=!1,t.drawBuffers=function(){}),i||(this.writeDepthTexture=!1)}else this.msaaSamples=t.getInternalformatParameter(t.RENDERBUFFER,t.RGBA8,t.SAMPLES)},fo.prototype.bind=function(t,e,i){void 0===i&&(i=0);var n=this.gl;if(t){var r=t.glFramebuffers[this.CONTEXT_UID]||this.initFramebuffer(t);this.current!==t&&(this.current=t,n.bindFramebuffer(n.FRAMEBUFFER,r.framebuffer)),r.mipLevel!==i&&(t.dirtyId++,t.dirtyFormat++,r.mipLevel=i),r.dirtyId!==t.dirtyId&&(r.dirtyId=t.dirtyId,r.dirtyFormat!==t.dirtyFormat?(r.dirtyFormat=t.dirtyFormat,r.dirtySize=t.dirtySize,this.updateFramebuffer(t,i)):r.dirtySize!==t.dirtySize&&(r.dirtySize=t.dirtySize,this.resizeFramebuffer(t)));for(var s=0;s<t.colorTextures.length;s++){var o=t.colorTextures[s];this.renderer.texture.unbind(o.parentTextureArray||o)}if(t.depthTexture&&this.renderer.texture.unbind(t.depthTexture),e){var a=e.width>>i,l=e.height>>i,h=a/e.width;this.setViewport(e.x*h,e.y*h,a,l)}else a=t.width>>i,l=t.height>>i,this.setViewport(0,0,a,l)}else this.current&&(this.current=null,n.bindFramebuffer(n.FRAMEBUFFER,null)),e?this.setViewport(e.x,e.y,e.width,e.height):this.setViewport(0,0,this.renderer.width,this.renderer.height)},fo.prototype.setViewport=function(t,e,i,n){var r=this.viewport;t=Math.round(t),e=Math.round(e),i=Math.round(i),n=Math.round(n),r.width===i&&r.height===n&&r.x===t&&r.y===e||(r.x=t,r.y=e,r.width=i,r.height=n,this.gl.viewport(t,e,i,n))},Object.defineProperty(fo.prototype,"size",{get:function(){return this.current?{x:0,y:0,width:this.current.width,height:this.current.height}:{x:0,y:0,width:this.renderer.width,height:this.renderer.height}},enumerable:!1,configurable:!0}),fo.prototype.clear=function(t,e,i,n,r){void 0===r&&(r=nt.BUFFER_BITS.COLOR|nt.BUFFER_BITS.DEPTH);var s=this.gl;s.clearColor(t,e,i,n),s.clear(r)},fo.prototype.initFramebuffer=function(t){var e=this.gl,i=new ks(e.createFramebuffer());return i.multisample=this.detectSamples(t.multisample),t.glFramebuffers[this.CONTEXT_UID]=i,this.managedFramebuffers.push(t),t.disposeRunner.add(this),i},fo.prototype.resizeFramebuffer=function(t){var e=this.gl,i=t.glFramebuffers[this.CONTEXT_UID];i.msaaBuffer&&(e.bindRenderbuffer(e.RENDERBUFFER,i.msaaBuffer),e.renderbufferStorageMultisample(e.RENDERBUFFER,i.multisample,e.RGBA8,t.width,t.height)),i.stencil&&(e.bindRenderbuffer(e.RENDERBUFFER,i.stencil),i.msaaBuffer?e.renderbufferStorageMultisample(e.RENDERBUFFER,i.multisample,e.DEPTH24_STENCIL8,t.width,t.height):e.renderbufferStorage(e.RENDERBUFFER,e.DEPTH_STENCIL,t.width,t.height));var n=t.colorTextures,r=n.length;e.drawBuffers||(r=Math.min(r,1));for(var s=0;s<r;s++){var o=n[s],a=o.parentTextureArray||o;this.renderer.texture.bind(a,0)}t.depthTexture&&this.writeDepthTexture&&this.renderer.texture.bind(t.depthTexture,0)},fo.prototype.updateFramebuffer=function(t,e){var i=this.gl,n=t.glFramebuffers[this.CONTEXT_UID],r=t.colorTextures,s=r.length;i.drawBuffers||(s=Math.min(s,1)),1<n.multisample&&this.canMultisampleFramebuffer(t)?(n.msaaBuffer=n.msaaBuffer||i.createRenderbuffer(),i.bindRenderbuffer(i.RENDERBUFFER,n.msaaBuffer),i.renderbufferStorageMultisample(i.RENDERBUFFER,n.multisample,i.RGBA8,t.width,t.height),i.framebufferRenderbuffer(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.RENDERBUFFER,n.msaaBuffer)):n.msaaBuffer&&(i.deleteRenderbuffer(n.msaaBuffer),n.msaaBuffer=null,n.blitFramebuffer&&(n.blitFramebuffer.dispose(),n.blitFramebuffer=null));for(var o=[],a=0;a<s;a++){var l=r[a],h=l.parentTextureArray||l;this.renderer.texture.bind(h,0),0===a&&n.msaaBuffer||(i.framebufferTexture2D(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0+a,l.target,h._glTextures[this.CONTEXT_UID].texture,e),o.push(i.COLOR_ATTACHMENT0+a))}if(1<o.length&&i.drawBuffers(o),t.depthTexture&&this.writeDepthTexture){var u=t.depthTexture;this.renderer.texture.bind(u,0),i.framebufferTexture2D(i.FRAMEBUFFER,i.DEPTH_ATTACHMENT,i.TEXTURE_2D,u._glTextures[this.CONTEXT_UID].texture,e)}!t.stencil&&!t.depth||t.depthTexture&&this.writeDepthTexture?n.stencil&&(i.deleteRenderbuffer(n.stencil),n.stencil=null):(n.stencil=n.stencil||i.createRenderbuffer(),i.bindRenderbuffer(i.RENDERBUFFER,n.stencil),n.msaaBuffer?i.renderbufferStorageMultisample(i.RENDERBUFFER,n.multisample,i.DEPTH24_STENCIL8,t.width,t.height):i.renderbufferStorage(i.RENDERBUFFER,i.DEPTH_STENCIL,t.width,t.height),i.framebufferRenderbuffer(i.FRAMEBUFFER,i.DEPTH_STENCIL_ATTACHMENT,i.RENDERBUFFER,n.stencil))},fo.prototype.canMultisampleFramebuffer=function(t){return 1!==this.renderer.context.webGLVersion&&t.colorTextures.length<=1&&!t.depthTexture},fo.prototype.detectSamples=function(t){var e=this.msaaSamples,i=nt.MSAA_QUALITY.NONE;if(t<=1||null===e)return i;for(var n=0;n<e.length;n++)if(e[n]<=t){i=e[n];break}return 1===i&&(i=nt.MSAA_QUALITY.NONE),i},fo.prototype.blit=function(t,e,i){var n=this.current,r=this.renderer,s=this.gl,o=this.CONTEXT_UID;if(2===r.context.webGLVersion&&n){var a=n.glFramebuffers[o];if(a){if(!t){if(!a.msaaBuffer)return;var l=n.colorTextures[0];if(!l)return;a.blitFramebuffer||(a.blitFramebuffer=new xs(n.width,n.height),a.blitFramebuffer.addColorTexture(0,l)),(t=a.blitFramebuffer).colorTextures[0]!==l&&(t.colorTextures[0]=l,t.dirtyId++,t.dirtyFormat++),t.width===n.width&&t.height===n.height||(t.width=n.width,t.height=n.height,t.dirtyId++,t.dirtySize++)}e||((e=oo).width=n.width,e.height=n.height),i=i||e;var h=e.width===i.width&&e.height===i.height;this.bind(t),s.bindFramebuffer(s.READ_FRAMEBUFFER,a.framebuffer),s.blitFramebuffer(e.x,e.y,e.width,e.height,i.x,i.y,i.width,i.height,s.COLOR_BUFFER_BIT,h?s.NEAREST:s.LINEAR)}}},fo.prototype.disposeFramebuffer=function(t,e){var i=t.glFramebuffers[this.CONTEXT_UID],n=this.gl;if(i){delete t.glFramebuffers[this.CONTEXT_UID];var r=this.managedFramebuffers.indexOf(t);0<=r&&this.managedFramebuffers.splice(r,1),t.disposeRunner.remove(this),e||(n.deleteFramebuffer(i.framebuffer),i.msaaBuffer&&n.deleteRenderbuffer(i.msaaBuffer),i.stencil&&n.deleteRenderbuffer(i.stencil)),i.blitFramebuffer&&i.blitFramebuffer.dispose()}},fo.prototype.disposeAll=function(t){var e=this.managedFramebuffers;this.managedFramebuffers=[];for(var i=0;i<e.length;i++)this.disposeFramebuffer(e[i],t)},fo.prototype.forceStencil=function(){var t=this.current;if(t){var e=t.glFramebuffers[this.CONTEXT_UID];if(e&&!e.stencil){t.stencil=!0;var i=t.width,n=t.height,r=this.gl,s=r.createRenderbuffer();r.bindRenderbuffer(r.RENDERBUFFER,s),e.msaaBuffer?r.renderbufferStorageMultisample(r.RENDERBUFFER,e.multisample,r.DEPTH24_STENCIL8,i,n):r.renderbufferStorage(r.RENDERBUFFER,r.DEPTH_STENCIL,i,n),e.stencil=s,r.framebufferRenderbuffer(r.FRAMEBUFFER,r.DEPTH_STENCIL_ATTACHMENT,r.RENDERBUFFER,s)}}},fo.prototype.reset=function(){this.current=this.unknownFramebuffer,this.viewport=new Bi},fo.prototype.destroy=function(){this.renderer=null},fo),lo={5126:4,5123:2,5121:1},ho=(po.prototype.contextChange=function(){this.disposeAll(!0);var t=this.gl=this.renderer.gl,e=this.renderer.context;if(this.CONTEXT_UID=this.renderer.CONTEXT_UID,2!==e.webGLVersion){var i=this.renderer.context.extensions.vertexArrayObject;Tt.PREFER_ENV===nt.ENV.WEBGL_LEGACY&&(i=null),i?(t.createVertexArray=function(){return i.createVertexArrayOES()},t.bindVertexArray=function(t){return i.bindVertexArrayOES(t)},t.deleteVertexArray=function(t){return i.deleteVertexArrayOES(t)}):(this.hasVao=!1,t.createVertexArray=function(){return null},t.bindVertexArray=function(){return null},t.deleteVertexArray=function(){return null})}if(2!==e.webGLVersion){var s=t.getExtension("ANGLE_instanced_arrays");s?(t.vertexAttribDivisor=function(t,e){return s.vertexAttribDivisorANGLE(t,e)},t.drawElementsInstanced=function(t,e,i,n,r){return s.drawElementsInstancedANGLE(t,e,i,n,r)},t.drawArraysInstanced=function(t,e,i,n){return s.drawArraysInstancedANGLE(t,e,i,n)}):this.hasInstance=!1}this.canUseUInt32ElementIndex=2===e.webGLVersion||!!e.extensions.uint32ElementIndex},po.prototype.bind=function(t,e){e=e||this.renderer.shader.shader;var i=this.gl,n=t.glVertexArrayObjects[this.CONTEXT_UID],r=!1;n||((this.managedGeometries[t.id]=t).disposeRunner.add(this),t.glVertexArrayObjects[this.CONTEXT_UID]=n={},r=!0);var s=n[e.program.id]||this.initGeometryVao(t,e,r);this._activeGeometry=t,this._activeVao!==s&&(this._activeVao=s,this.hasVao?i.bindVertexArray(s):this.activateVao(t,e.program)),this.updateBuffers()},po.prototype.reset=function(){this.unbind()},po.prototype.updateBuffers=function(){for(var t=this._activeGeometry,e=this.renderer.buffer,i=0;i<t.buffers.length;i++){var n=t.buffers[i];e.update(n)}},po.prototype.checkCompatibility=function(t,e){var i=t.attributes,n=e.attributeData;for(var r in n)if(!i[r])throw new Error('shader and geometry incompatible, geometry missing the "'+r+'" attribute')},po.prototype.getSignature=function(t,e){var i=t.attributes,n=e.attributeData,r=["g",t.id];for(var s in i)n[s]&&r.push(s,n[s].location);return r.join("-")},po.prototype.initGeometryVao=function(t,e,i){void 0===i&&(i=!0);var n=this.gl,r=this.CONTEXT_UID,s=this.renderer.buffer,o=e.program;o.glPrograms[r]||this.renderer.shader.generateProgram(e),this.checkCompatibility(t,o);var a=this.getSignature(t,o),l=t.glVertexArrayObjects[this.CONTEXT_UID],h=l[a];if(h)return l[o.id]=h;var u=t.buffers,c=t.attributes,d={},p={};for(var f in u)d[f]=0,p[f]=0;for(var f in c)!c[f].size&&o.attributeData[f]?c[f].size=o.attributeData[f].size:c[f].size||console.warn("PIXI Geometry attribute '"+f+"' size cannot be determined (likely the bound shader does not have the attribute)"),d[c[f].buffer]+=c[f].size*lo[c[f].type];for(var f in c){var g=c[f],m=g.size;void 0===g.stride&&(d[g.buffer]===m*lo[g.type]?g.stride=0:g.stride=d[g.buffer]),void 0===g.start&&(g.start=p[g.buffer],p[g.buffer]+=m*lo[g.type])}h=n.createVertexArray(),n.bindVertexArray(h);for(var y=0;y<u.length;y++){var _=u[y];s.bind(_),i&&_._glBuffers[r].refCount++}return this.activateVao(t,o),this._activeVao=h,l[o.id]=h,l[a]=h},po.prototype.disposeGeometry=function(t,e){var i;if(this.managedGeometries[t.id]){delete this.managedGeometries[t.id];var n=t.glVertexArrayObjects[this.CONTEXT_UID],r=this.gl,s=t.buffers,o=null===(i=this.renderer)||void 0===i?void 0:i.buffer;if(t.disposeRunner.remove(this),n){if(o)for(var a=0;a<s.length;a++){var l=s[a]._glBuffers[this.CONTEXT_UID];l&&(l.refCount--,0!==l.refCount||e||o.dispose(s[a],e))}if(!e)for(var h in n)if("g"===h[0]){var u=n[h];this._activeVao===u&&this.unbind(),r.deleteVertexArray(u)}delete t.glVertexArrayObjects[this.CONTEXT_UID]}}},po.prototype.disposeAll=function(t){for(var e=Object.keys(this.managedGeometries),i=0;i<e.length;i++)this.disposeGeometry(this.managedGeometries[e[i]],t)},po.prototype.activateVao=function(t,e){var i=this.gl,n=this.CONTEXT_UID,r=this.renderer.buffer,s=t.buffers,o=t.attributes;t.indexBuffer&&r.bind(t.indexBuffer);var a=null;for(var l in o){var h=o[l],u=s[h.buffer],c=u._glBuffers[n];if(e.attributeData[l]){a!==c&&(r.bind(u),a=c);var d=e.attributeData[l].location;if(i.enableVertexAttribArray(d),i.vertexAttribPointer(d,h.size,h.type||i.FLOAT,h.normalized,h.stride,h.start),h.instance){if(!this.hasInstance)throw new Error("geometry error, GPU Instancing is not supported on this device");i.vertexAttribDivisor(d,1)}}}},po.prototype.draw=function(t,e,i,n){var r=this.gl,s=this._activeGeometry;if(s.indexBuffer){var o=s.indexBuffer.data.BYTES_PER_ELEMENT,a=2===o?r.UNSIGNED_SHORT:r.UNSIGNED_INT;2===o||4===o&&this.canUseUInt32ElementIndex?s.instanced?r.drawElementsInstanced(t,e||s.indexBuffer.data.length,a,(i||0)*o,n||1):r.drawElements(t,e||s.indexBuffer.data.length,a,(i||0)*o):console.warn("unsupported index buffer type: uint32")}else s.instanced?r.drawArraysInstanced(t,i,e||s.getSize(),n||1):r.drawArrays(t,i,e||s.getSize());return this},po.prototype.unbind=function(){this.gl.bindVertexArray(null),this._activeVao=null,this._activeGeometry=null},po.prototype.destroy=function(){this.renderer=null},po),uo=(Object.defineProperty(co.prototype,"filter",{get:function(){return this._filters?this._filters[0]:null},set:function(t){t?this._filters?this._filters[0]=t:this._filters=[t]:this._filters=null},enumerable:!1,configurable:!0}),co.prototype.reset=function(){this.pooled&&(this.maskObject=null,this.type=nt.MASK_TYPES.NONE,this.autoDetect=!0),this._target=null,this._scissorRectLocal=null},co.prototype.copyCountersOrReset=function(t){t?(this._stencilCounter=t._stencilCounter,this._scissorCounter=t._scissorCounter,this._scissorRect=t._scissorRect):(this._stencilCounter=0,this._scissorCounter=0,this._scissorRect=null)},co);function co(t){void 0===t&&(t=null),this.type=nt.MASK_TYPES.NONE,this.autoDetect=!0,this.maskObject=t||null,this.pooled=!1,this.isMaskData=!0,this.resolution=null,this.multisample=Tt.FILTER_MULTISAMPLE,this.enabled=!0,this._filters=null,this._stencilCounter=0,this._scissorCounter=0,this._scissorRect=null,this._scissorRectLocal=null,this._target=null}function po(t){this.renderer=t,this._activeGeometry=null,this._activeVao=null,this.hasVao=!0,this.hasInstance=!0,this.canUseUInt32ElementIndex=!1,this.managedGeometries={}}function fo(t){this.renderer=t,this.managedFramebuffers=[],this.unknownFramebuffer=new xs(10,10),this.msaaSamples=null}function go(t){this.renderer=t,this.webGLVersion=1,this.extensions={},this.supports={uint32Indices:!1},this.handleContextLost=this.handleContextLost.bind(this),this.handleContextRestored=this.handleContextRestored.bind(this),t.view.addEventListener("webglcontextlost",this.handleContextLost,!1),t.view.addEventListener("webglcontextrestored",this.handleContextRestored,!1)}function mo(t){this.renderer=t,this.emptyRenderer=new io(t),this.currentRenderer=this.emptyRenderer}function yo(t){this.renderer=t}function _o(t){this.renderer=t,this.defaultFilterStack=[{}],this.texturePool=new Us,this.texturePool.setScreenSize(t.view),this.statePool=[],this.quad=new qs,this.quadUv=new Ks,this.tempRect=new Bi,this.activeState={},this.globalUniforms=new Qs({outputFrame:new Bi,inputSize:new Float32Array(4),inputPixel:new Float32Array(4),inputClamp:new Float32Array(4),resolution:1,filterArea:new Float32Array(4),filterClamp:new Float32Array(4)},!0),this.forceClear=!1,this.useMaxPadding=!1}function vo(){this.renderTexture=null,this.target=null,this.legacy=!1,this.resolution=1,this.multisample=nt.MSAA_QUALITY.NONE,this.sourceFrame=new Bi,this.destinationFrame=new Bi,this.bindingSourceFrame=new Bi,this.bindingDestinationFrame=new Bi,this.filters=[],this.transform=null}function bo(t,e,i){this.group=!0,this.syncUniforms={},this.dirtyId=0,this.id=$s++,this.static=!!e,this.ubo=!!i,t instanceof Gs?(this.buffer=t,this.buffer.type=nt.BUFFER_TYPE.UNIFORM_BUFFER,this.autoManage=!1,this.ubo=!0):(this.uniforms=t,this.ubo&&(this.buffer=new Gs(new Float32Array(1)),this.buffer.type=nt.BUFFER_TYPE.UNIFORM_BUFFER,this.autoManage=!0))}function wo(){var t=Ds.call(this)||this;return t.vertices=new Float32Array([-1,-1,1,-1,1,1,-1,1]),t.uvs=new Float32Array([0,0,1,0,1,1,0,1]),t.vertexBuffer=new Gs(t.vertices),t.uvBuffer=new Gs(t.uvs),t.addAttribute("aVertexPosition",t.vertexBuffer).addAttribute("aTextureCoord",t.uvBuffer).addIndex([0,1,2,0,2,3]),t}function So(){var t=Fs.call(this)||this;return t.addAttribute("aVertexPosition",new Float32Array([0,0,1,0,1,1,0,1])).addIndex([0,1,3,2]),t}function xo(t,e){void 0===t&&(t=[]),void 0===e&&(e={}),this.buffers=t,this.indexBuffer=null,this.attributes=e,this.glVertexArrayObjects={},this.id=js++,this.instanced=!1,this.instanceCount=1,this.disposeRunner=new Cr("disposeGeometry"),this.refCount=0}function To(t,e,i){void 0===e&&(e=!0),void 0===i&&(i=!1),this.data=t||new Float32Array(1),this._glBuffers={},this._updateID=0,this.index=i,this.static=e,this.id=Ws++,this.disposeRunner=new Cr("disposeBuffer")}function Io(t,e,i,n,r,s,o){void 0===e&&(e=0),void 0===i&&(i=!1),void 0===n&&(n=nt.TYPES.FLOAT),this.buffer=t,this.size=e,this.normalized=i,this.type=n,this.stride=r,this.start=s,this.instance=o}function Po(t){this.texturePool={},this.textureOptions=t||{},this.enableFullScreen=!1,this._pixelsWidth=0,this._pixelsHeight=0}function Co(t,e){var i=Ns.call(this,t,e)||this;return i.valid=!0,i.filterFrame=null,i.filterPoolKey=null,i.updateUvs(),i}function Eo(t,e,i){var n=t.createShader(e);return t.shaderSource(n,i),t.compileShader(n),n}function Ao(t,e){var i=t.getShaderSource(e).split("\n").map(function(t,e){return e+": "+t}),n=t.getShaderInfoLog(e),r=n.split("\n"),s={},o=r.map(function(t){return parseFloat(t.replace(/^ERROR\: 0\:([\d]+)\:.*$/,"$1"))}).filter(function(t){return!(!t||s[t]||(s[t]=!0,0))}),a=[""];o.forEach(function(t){i[t-1]="%c"+i[t-1]+"%c",a.push("background: #FF0000; color:#FFFFFF; font-size: 10px","font-size: 10px")});var l=i.join("\n");a[0]=l,console.error(n),console.groupCollapsed("click to view full shader code"),console.warn.apply(console,a),console.groupEnd()}function Mo(t){for(var e=new Array(t),i=0;i<e.length;i++)e[i]=!1;return e}function Bo(t,e){switch(t){case"float":return 0;case"vec2":return new Float32Array(2*e);case"vec3":return new Float32Array(3*e);case"vec4":return new Float32Array(4*e);case"int":case"uint":case"sampler2D":case"sampler2DArray":return 0;case"ivec2":return new Int32Array(2*e);case"ivec3":return new Int32Array(3*e);case"ivec4":return new Int32Array(4*e);case"uvec2":return new Uint32Array(2*e);case"uvec3":return new Uint32Array(3*e);case"uvec4":return new Uint32Array(4*e);case"bool":return!1;case"bvec2":return Mo(2*e);case"bvec3":return Mo(3*e);case"bvec4":return Mo(4*e);case"mat2":return new Float32Array([1,0,0,1]);case"mat3":return new Float32Array([1,0,0,0,1,0,0,0,1]);case"mat4":return new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}return null}var Ro,Oo={},ko=Oo;function Do(){if(ko===Oo||ko&&ko.isContextLost()){var t=document.createElement("canvas"),e=void 0;Tt.PREFER_ENV>=nt.ENV.WEBGL2&&(e=t.getContext("webgl2",{})),e||((e=t.getContext("webgl",{})||t.getContext("experimental-webgl",{}))?e.getExtension("WEBGL_draw_buffers"):e=null),ko=e}return ko}function Fo(t,e,i){if("precision"===t.substring(0,9))return i!==nt.PRECISION.HIGH&&"precision highp"===t.substring(0,15)?t.replace("precision highp","precision mediump"):t;var n=e;return e===nt.PRECISION.HIGH&&i!==nt.PRECISION.HIGH&&(n=nt.PRECISION.MEDIUM),"precision "+n+" float;\n"+t}var No={float:1,vec2:2,vec3:3,vec4:4,int:1,ivec2:2,ivec3:3,ivec4:4,uint:1,uvec2:2,uvec3:3,uvec4:4,bool:1,bvec2:2,bvec3:3,bvec4:4,mat2:4,mat3:9,mat4:16,sampler2D:1};function Lo(t){return No[t]}var Uo=null,zo={FLOAT:"float",FLOAT_VEC2:"vec2",FLOAT_VEC3:"vec3",FLOAT_VEC4:"vec4",INT:"int",INT_VEC2:"ivec2",INT_VEC3:"ivec3",INT_VEC4:"ivec4",UNSIGNED_INT:"uint",UNSIGNED_INT_VEC2:"uvec2",UNSIGNED_INT_VEC3:"uvec3",UNSIGNED_INT_VEC4:"uvec4",BOOL:"bool",BOOL_VEC2:"bvec2",BOOL_VEC3:"bvec3",BOOL_VEC4:"bvec4",FLOAT_MAT2:"mat2",FLOAT_MAT3:"mat3",FLOAT_MAT4:"mat4",SAMPLER_2D:"sampler2D",INT_SAMPLER_2D:"sampler2D",UNSIGNED_INT_SAMPLER_2D:"sampler2D",SAMPLER_CUBE:"samplerCube",INT_SAMPLER_CUBE:"samplerCube",UNSIGNED_INT_SAMPLER_CUBE:"samplerCube",SAMPLER_2D_ARRAY:"sampler2DArray",INT_SAMPLER_2D_ARRAY:"sampler2DArray",UNSIGNED_INT_SAMPLER_2D_ARRAY:"sampler2DArray"};function Wo(t,e){if(!Uo){var i=Object.keys(zo);Uo={};for(var n=0;n<i.length;++n){var r=i[n];Uo[t[r]]=zo[r]}}return Uo[e]}var Go,Ho=[{test:function(t){return"float"===t.type&&1===t.size},code:function(t){return'\n            if(uv["'+t+'"] !== ud["'+t+'"].value)\n            {\n                ud["'+t+'"].value = uv["'+t+'"]\n                gl.uniform1f(ud["'+t+'"].location, uv["'+t+'"])\n            }\n            '}},{test:function(t){return("sampler2D"===t.type||"samplerCube"===t.type||"sampler2DArray"===t.type)&&1===t.size&&!t.isArray},code:function(t){return't = syncData.textureCount++;\n\n            renderer.texture.bind(uv["'+t+'"], t);\n\n            if(ud["'+t+'"].value !== t)\n            {\n                ud["'+t+'"].value = t;\n                gl.uniform1i(ud["'+t+'"].location, t);\n; // eslint-disable-line max-len\n            }'}},{test:function(t,e){return"mat3"===t.type&&1===t.size&&void 0!==e.a},code:function(t){return'\n            gl.uniformMatrix3fv(ud["'+t+'"].location, false, uv["'+t+'"].toArray(true));\n            '},codeUbo:function(t){return"\n                var "+t+"_matrix = uv."+t+".toArray(true);\n\n                data[offset] = "+t+"_matrix[0];\n                data[offset+1] = "+t+"_matrix[1];\n                data[offset+2] = "+t+"_matrix[2];\n        \n                data[offset + 4] = "+t+"_matrix[3];\n                data[offset + 5] = "+t+"_matrix[4];\n                data[offset + 6] = "+t+"_matrix[5];\n        \n                data[offset + 8] = "+t+"_matrix[6];\n                data[offset + 9] = "+t+"_matrix[7];\n                data[offset + 10] = "+t+"_matrix[8];\n            "}},{test:function(t,e){return"vec2"===t.type&&1===t.size&&void 0!==e.x},code:function(t){return'\n                cv = ud["'+t+'"].value;\n                v = uv["'+t+'"];\n\n                if(cv[0] !== v.x || cv[1] !== v.y)\n                {\n                    cv[0] = v.x;\n                    cv[1] = v.y;\n                    gl.uniform2f(ud["'+t+'"].location, v.x, v.y);\n                }'},codeUbo:function(t){return"\n                v = uv."+t+";\n\n                data[offset] = v.x;\n                data[offset+1] = v.y;\n            "}},{test:function(t){return"vec2"===t.type&&1===t.size},code:function(t){return'\n                cv = ud["'+t+'"].value;\n                v = uv["'+t+'"];\n\n                if(cv[0] !== v[0] || cv[1] !== v[1])\n                {\n                    cv[0] = v[0];\n                    cv[1] = v[1];\n                    gl.uniform2f(ud["'+t+'"].location, v[0], v[1]);\n                }\n            '}},{test:function(t,e){return"vec4"===t.type&&1===t.size&&void 0!==e.width},code:function(t){return'\n                cv = ud["'+t+'"].value;\n                v = uv["'+t+'"];\n\n                if(cv[0] !== v.x || cv[1] !== v.y || cv[2] !== v.width || cv[3] !== v.height)\n                {\n                    cv[0] = v.x;\n                    cv[1] = v.y;\n                    cv[2] = v.width;\n                    cv[3] = v.height;\n                    gl.uniform4f(ud["'+t+'"].location, v.x, v.y, v.width, v.height)\n                }'},codeUbo:function(t){return"\n                    v = uv."+t+";\n\n                    data[offset] = v.x;\n                    data[offset+1] = v.y;\n                    data[offset+2] = v.width;\n                    data[offset+3] = v.height;\n                "}},{test:function(t){return"vec4"===t.type&&1===t.size},code:function(t){return'\n                cv = ud["'+t+'"].value;\n                v = uv["'+t+'"];\n\n                if(cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])\n                {\n                    cv[0] = v[0];\n                    cv[1] = v[1];\n                    cv[2] = v[2];\n                    cv[3] = v[3];\n\n                    gl.uniform4f(ud["'+t+'"].location, v[0], v[1], v[2], v[3])\n                }'}}],Xo={float:"\n    if (cv !== v)\n    {\n        cu.value = v;\n        gl.uniform1f(location, v);\n    }",vec2:"\n    if (cv[0] !== v[0] || cv[1] !== v[1])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n\n        gl.uniform2f(location, v[0], v[1])\n    }",vec3:"\n    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n        cv[2] = v[2];\n\n        gl.uniform3f(location, v[0], v[1], v[2])\n    }",vec4:"\n    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n        cv[2] = v[2];\n        cv[3] = v[3];\n\n        gl.uniform4f(location, v[0], v[1], v[2], v[3]);\n    }",int:"\n    if (cv !== v)\n    {\n        cu.value = v;\n\n        gl.uniform1i(location, v);\n    }",ivec2:"\n    if (cv[0] !== v[0] || cv[1] !== v[1])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n\n        gl.uniform2i(location, v[0], v[1]);\n    }",ivec3:"\n    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n        cv[2] = v[2];\n\n        gl.uniform3i(location, v[0], v[1], v[2]);\n    }",ivec4:"\n    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n        cv[2] = v[2];\n        cv[3] = v[3];\n\n        gl.uniform4i(location, v[0], v[1], v[2], v[3]);\n    }",uint:"\n    if (cv !== v)\n    {\n        cu.value = v;\n\n        gl.uniform1ui(location, v);\n    }",uvec2:"\n    if (cv[0] !== v[0] || cv[1] !== v[1])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n\n        gl.uniform2ui(location, v[0], v[1]);\n    }",uvec3:"\n    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n        cv[2] = v[2];\n\n        gl.uniform3ui(location, v[0], v[1], v[2]);\n    }",uvec4:"\n    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n        cv[2] = v[2];\n        cv[3] = v[3];\n\n        gl.uniform4ui(location, v[0], v[1], v[2], v[3]);\n    }",bool:"\n    if (cv !== v)\n    {\n        cu.value = v;\n        gl.uniform1i(location, v);\n    }",bvec2:"\n    if (cv[0] != v[0] || cv[1] != v[1])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n\n        gl.uniform2i(location, v[0], v[1]);\n    }",bvec3:"\n    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n        cv[2] = v[2];\n\n        gl.uniform3i(location, v[0], v[1], v[2]);\n    }",bvec4:"\n    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n        cv[2] = v[2];\n        cv[3] = v[3];\n\n        gl.uniform4i(location, v[0], v[1], v[2], v[3]);\n    }",mat2:"gl.uniformMatrix2fv(location, false, v)",mat3:"gl.uniformMatrix3fv(location, false, v)",mat4:"gl.uniformMatrix4fv(location, false, v)",sampler2D:"gl.uniform1i(location, v)",samplerCube:"gl.uniform1i(location, v)",sampler2DArray:"gl.uniform1i(location, v)"},jo={float:"gl.uniform1fv(location, v)",vec2:"gl.uniform2fv(location, v)",vec3:"gl.uniform3fv(location, v)",vec4:"gl.uniform4fv(location, v)",mat4:"gl.uniformMatrix4fv(location, false, v)",mat3:"gl.uniformMatrix3fv(location, false, v)",mat2:"gl.uniformMatrix2fv(location, false, v)",int:"gl.uniform1iv(location, v)",ivec2:"gl.uniform2iv(location, v)",ivec3:"gl.uniform3iv(location, v)",ivec4:"gl.uniform4iv(location, v)",uint:"gl.uniform1uiv(location, v)",uvec2:"gl.uniform2uiv(location, v)",uvec3:"gl.uniform3uiv(location, v)",uvec4:"gl.uniform4uiv(location, v)",bool:"gl.uniform1iv(location, v)",bvec2:"gl.uniform2iv(location, v)",bvec3:"gl.uniform3iv(location, v)",bvec4:"gl.uniform4iv(location, v)",sampler2D:"gl.uniform1iv(location, v)",samplerCube:"gl.uniform1iv(location, v)",sampler2DArray:"gl.uniform1iv(location, v)"},Vo=["precision mediump float;","void main(void){","float test = 0.1;","%forloop%","gl_FragColor = vec4(0.0);","}"].join("\n");function Yo(t){for(var e="",i=0;i<t;++i)0<i&&(e+="\nelse "),i<t-1&&(e+="if(test == "+i+".0){}");return e}function qo(t,e){if(0===t)throw new Error("Invalid value of `0` passed to `checkMaxIfStatementsInShader`");for(var i=e.createShader(e.FRAGMENT_SHADER);;){var n=Vo.replace(/%forloop%/gi,Yo(t));if(e.shaderSource(i,n),e.compileShader(i),e.getShaderParameter(i,e.COMPILE_STATUS))break;t=t/2|0}return t}var Ko,$o,Qo,Jo,Zo=0,ta={},ea=(Object.defineProperty(Ea,"defaultVertexSrc",{get:function(){return"attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void){\n   gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n   vTextureCoord = aTextureCoord;\n}\n"},enumerable:!1,configurable:!0}),Object.defineProperty(Ea,"defaultFragmentSrc",{get:function(){return"varying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\n\nvoid main(void){\n   gl_FragColor *= texture2D(uSampler, vTextureCoord);\n}"},enumerable:!1,configurable:!0}),Ea.from=function(t,e,i){var n=t+e,r=mi[n];return r||(mi[n]=r=new Ea(t,e,i)),r},Ea),ia=(Ca.prototype.checkUniformExists=function(t,e){if(e.uniforms[t])return!0;for(var i in e.uniforms){var n=e.uniforms[i];if(n.group&&this.checkUniformExists(t,n))return!0}return!1},Ca.prototype.destroy=function(){this.uniformGroup=null},Object.defineProperty(Ca.prototype,"uniforms",{get:function(){return this.uniformGroup.uniforms},enumerable:!1,configurable:!0}),Ca.from=function(t,e,i){return new Ca(ea.from(t,e),i)},Ca),na=(Object.defineProperty(Pa.prototype,"blend",{get:function(){return!!(1&this.data)},set:function(t){!!(1&this.data)!==t&&(this.data^=1)},enumerable:!1,configurable:!0}),Object.defineProperty(Pa.prototype,"offsets",{get:function(){return!!(2&this.data)},set:function(t){!!(2&this.data)!==t&&(this.data^=2)},enumerable:!1,configurable:!0}),Object.defineProperty(Pa.prototype,"culling",{get:function(){return!!(4&this.data)},set:function(t){!!(4&this.data)!==t&&(this.data^=4)},enumerable:!1,configurable:!0}),Object.defineProperty(Pa.prototype,"depthTest",{get:function(){return!!(8&this.data)},set:function(t){!!(8&this.data)!==t&&(this.data^=8)},enumerable:!1,configurable:!0}),Object.defineProperty(Pa.prototype,"depthMask",{get:function(){return!!(32&this.data)},set:function(t){!!(32&this.data)!==t&&(this.data^=32)},enumerable:!1,configurable:!0}),Object.defineProperty(Pa.prototype,"clockwiseFrontFace",{get:function(){return!!(16&this.data)},set:function(t){!!(16&this.data)!==t&&(this.data^=16)},enumerable:!1,configurable:!0}),Object.defineProperty(Pa.prototype,"blendMode",{get:function(){return this._blendMode},set:function(t){this.blend=t!==nt.BLEND_MODES.NONE,this._blendMode=t},enumerable:!1,configurable:!0}),Object.defineProperty(Pa.prototype,"polygonOffset",{get:function(){return this._polygonOffset},set:function(t){this.offsets=!!t,this._polygonOffset=t},enumerable:!1,configurable:!0}),Pa.for2d=function(){var t=new Pa;return t.depthTest=!1,t.blend=!0,t},Pa),ra=(kr(Ia,Jo=ia),Ia.prototype.apply=function(t,e,i,n,r){t.applyFilter(this,e,i,n)},Object.defineProperty(Ia.prototype,"blendMode",{get:function(){return this.state.blendMode},set:function(t){this.state.blendMode=t},enumerable:!1,configurable:!0}),Object.defineProperty(Ia.prototype,"resolution",{get:function(){return this._resolution},set:function(t){this._resolution=t},enumerable:!1,configurable:!0}),Object.defineProperty(Ia,"defaultVertexSrc",{get:function(){return"attribute vec2 aVertexPosition;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nuniform vec4 inputSize;\nuniform vec4 outputFrame;\n\nvec4 filterVertexPosition( void )\n{\n    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;\n\n    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);\n}\n\nvec2 filterTextureCoord( void )\n{\n    return aVertexPosition * (outputFrame.zw * inputSize.zw);\n}\n\nvoid main(void)\n{\n    gl_Position = filterVertexPosition();\n    vTextureCoord = filterTextureCoord();\n}\n"},enumerable:!1,configurable:!0}),Object.defineProperty(Ia,"defaultFragmentSrc",{get:function(){return"varying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\n\nvoid main(void){\n   gl_FragColor = texture2D(uSampler, vTextureCoord);\n}\n"},enumerable:!1,configurable:!0}),Ia),sa=new Li,oa=(Object.defineProperty(Ta.prototype,"texture",{get:function(){return this._texture},set:function(t){this._texture=t,this._textureID=-1},enumerable:!1,configurable:!0}),Ta.prototype.multiplyUvs=function(t,e){void 0===e&&(e=t);for(var i=this.mapCoord,n=0;n<t.length;n+=2){var r=t[n],s=t[n+1];e[n]=r*i.a+s*i.c+i.tx,e[n+1]=r*i.b+s*i.d+i.ty}return e},Ta.prototype.update=function(t){var e=this._texture;if(!e||!e.valid)return!1;if(!t&&this._textureID===e._updateID)return!1;this._textureID=e._updateID,this._updateID++;var i=e._uvs;this.mapCoord.set(i.x1-i.x0,i.y1-i.y0,i.x3-i.x0,i.y3-i.y0,i.x0,i.y0);var n=e.orig,r=e.trim;r&&(sa.set(n.width/r.width,0,0,n.height/r.height,-r.x/r.width,-r.y/r.height),this.mapCoord.append(sa));var s=e.baseTexture,o=this.uClampFrame,a=this.clampMargin/s.resolution,l=this.clampOffset;return o[0]=(e._frame.x+a+l)/s.width,o[1]=(e._frame.y+a+l)/s.height,o[2]=(e._frame.x+e._frame.width-a+l)/s.width,o[3]=(e._frame.y+e._frame.height-a+l)/s.height,this.uClampOffset[0]=l/s.realWidth,this.uClampOffset[1]=l/s.realHeight,this.isSimple=e._frame.width===s.width&&e._frame.height===s.height&&0===e.rotate,!0},Ta),aa=(kr(xa,Qo=ra),Object.defineProperty(xa.prototype,"maskSprite",{get:function(){return this._maskSprite},set:function(t){this._maskSprite=t,this._maskSprite&&(this._maskSprite.renderable=!1)},enumerable:!1,configurable:!0}),xa.prototype.apply=function(t,e,i,n){var r=this._maskSprite,s=r._texture;s.valid&&(s.uvMatrix||(s.uvMatrix=new oa(s,0)),s.uvMatrix.update(),this.uniforms.npmAlpha=s.baseTexture.alphaMode?0:1,this.uniforms.mask=s,this.uniforms.otherMatrix=t.calculateSpriteMatrix(this.maskMatrix,r).prepend(s.uvMatrix.mapCoord),this.uniforms.alpha=r.worldAlpha,this.uniforms.maskClamp=s.uvMatrix.uClampFrame,t.applyFilter(this,e,i,n))},xa),la=(Sa.prototype.setMaskStack=function(t){this.maskStack=t,this.renderer.scissor.setMaskStack(t),this.renderer.stencil.setMaskStack(t)},Sa.prototype.push=function(t,e){var i=e;if(!i.isMaskData){var n=this.maskDataPool.pop()||new uo;n.pooled=!0,n.maskObject=e,i=n}var r=0!==this.maskStack.length?this.maskStack[this.maskStack.length-1]:null;if(i.copyCountersOrReset(r),i.autoDetect&&this.detect(i),i._target=t,i.type!==nt.MASK_TYPES.SPRITE&&this.maskStack.push(i),i.enabled)switch(i.type){case nt.MASK_TYPES.SCISSOR:this.renderer.scissor.push(i);break;case nt.MASK_TYPES.STENCIL:this.renderer.stencil.push(i);break;case nt.MASK_TYPES.SPRITE:i.copyCountersOrReset(null),this.pushSpriteMask(i)}i.type===nt.MASK_TYPES.SPRITE&&this.maskStack.push(i)},Sa.prototype.pop=function(t){var e=this.maskStack.pop();if(e&&e._target===t){if(e.enabled)switch(e.type){case nt.MASK_TYPES.SCISSOR:this.renderer.scissor.pop();break;case nt.MASK_TYPES.STENCIL:this.renderer.stencil.pop(e.maskObject);break;case nt.MASK_TYPES.SPRITE:this.popSpriteMask(e)}if(e.reset(),e.pooled&&this.maskDataPool.push(e),0!==this.maskStack.length){var i=this.maskStack[this.maskStack.length-1];i.type===nt.MASK_TYPES.SPRITE&&i._filters&&(i._filters[0].maskSprite=i.maskObject)}}},Sa.prototype.detect=function(t){t.maskObject.isSprite?t.type=nt.MASK_TYPES.SPRITE:this.enableScissor&&this.renderer.scissor.testScissor(t)?t.type=nt.MASK_TYPES.SCISSOR:t.type=nt.MASK_TYPES.STENCIL},Sa.prototype.pushSpriteMask=function(t){var e,i,n=t.maskObject,r=t._target,s=t._filters;(s=s||this.alphaMaskPool[this.alphaMaskIndex])||(s=this.alphaMaskPool[this.alphaMaskIndex]=[new aa]);var o,a,l=this.renderer,h=l.renderTexture;if(h.current){var u=h.current;o=t.resolution||u.resolution,a=null!==(e=t.multisample)&&void 0!==e?e:u.multisample}else o=t.resolution||l.resolution,a=null!==(i=t.multisample)&&void 0!==i?i:l.multisample;s[0].resolution=o,s[0].multisample=a,s[0].maskSprite=n;var c=r.filterArea;r.filterArea=n.getBounds(!0),l.filter.push(r,s),r.filterArea=c,t._filters||this.alphaMaskIndex++},Sa.prototype.popSpriteMask=function(t){this.renderer.filter.pop(),t._filters?t._filters[0].maskSprite=null:(this.alphaMaskIndex--,this.alphaMaskPool[this.alphaMaskIndex][0].maskSprite=null)},Sa.prototype.destroy=function(){this.renderer=null},Sa),ha=(wa.prototype.getStackLength=function(){return this.maskStack.length},wa.prototype.setMaskStack=function(t){var e=this.renderer.gl,i=this.getStackLength();this.maskStack=t;var n=this.getStackLength();n!==i&&(0===n?e.disable(this.glConst):(e.enable(this.glConst),this._useCurrent()))},wa.prototype._useCurrent=function(){},wa.prototype.destroy=function(){this.renderer=null,this.maskStack=null},wa),ua=new Li,ca=(kr(ba,$o=ha),ba.prototype.getStackLength=function(){var t=this.maskStack[this.maskStack.length-1];return t?t._scissorCounter:0},ba.prototype.calcScissorRect=function(t){if(!t._scissorRectLocal){var e=t._scissorRect,i=t.maskObject,n=this.renderer,r=n.renderTexture;i.renderable=!0;var s=i.getBounds();this.roundFrameToPixels(s,r.current?r.current.resolution:n.resolution,r.sourceFrame,r.destinationFrame,n.projection.transform),i.renderable=!1,e&&s.fit(e),t._scissorRectLocal=s}},ba.isMatrixRotated=function(t){if(!t)return!1;var e=t.a,i=t.b,n=t.c,r=t.d;return(1e-4<Math.abs(i)||1e-4<Math.abs(n))&&(1e-4<Math.abs(e)||1e-4<Math.abs(r))},ba.prototype.testScissor=function(t){var e=t.maskObject;if(!e.isFastRect||!e.isFastRect())return!1;if(ba.isMatrixRotated(e.worldTransform))return!1;if(ba.isMatrixRotated(this.renderer.projection.transform))return!1;this.calcScissorRect(t);var i=t._scissorRectLocal;return 0<i.width&&0<i.height},ba.prototype.roundFrameToPixels=function(t,e,i,n,r){ba.isMatrixRotated(r)||((r=r?ua.copyFrom(r):ua.identity()).translate(-i.x,-i.y).scale(n.width/i.width,n.height/i.height).translate(n.x,n.y),this.renderer.filter.transformAABB(r,t),t.fit(n),t.x=Math.round(t.x*e),t.y=Math.round(t.y*e),t.width=Math.round(t.width*e),t.height=Math.round(t.height*e))},ba.prototype.push=function(t){t._scissorRectLocal||this.calcScissorRect(t);var e=this.renderer.gl;t._scissorRect||e.enable(e.SCISSOR_TEST),t._scissorCounter++,t._scissorRect=t._scissorRectLocal,this._useCurrent()},ba.prototype.pop=function(){var t=this.renderer.gl;0<this.getStackLength()?this._useCurrent():t.disable(t.SCISSOR_TEST)},ba.prototype._useCurrent=function(){var t,e=this.maskStack[this.maskStack.length-1]._scissorRect;t=this.renderer.renderTexture.current?e.y:this.renderer.height-e.height-e.y,this.renderer.gl.scissor(e.x,t,e.width,e.height)},ba),da=(kr(va,Ko=ha),va.prototype.getStackLength=function(){var t=this.maskStack[this.maskStack.length-1];return t?t._stencilCounter:0},va.prototype.push=function(t){var e=t.maskObject,i=this.renderer.gl,n=t._stencilCounter;0===n&&(this.renderer.framebuffer.forceStencil(),i.clearStencil(0),i.clear(i.STENCIL_BUFFER_BIT),i.enable(i.STENCIL_TEST)),t._stencilCounter++,i.colorMask(!1,!1,!1,!1),i.stencilFunc(i.EQUAL,n,4294967295),i.stencilOp(i.KEEP,i.KEEP,i.INCR),e.renderable=!0,e.render(this.renderer),this.renderer.batch.flush(),e.renderable=!1,this._useCurrent()},va.prototype.pop=function(t){var e=this.renderer.gl;0===this.getStackLength()?e.disable(e.STENCIL_TEST):(e.colorMask(!1,!1,!1,!1),e.stencilOp(e.KEEP,e.KEEP,e.DECR),t.renderable=!0,t.render(this.renderer),this.renderer.batch.flush(),t.renderable=!1,this._useCurrent())},va.prototype._useCurrent=function(){var t=this.renderer.gl;t.colorMask(!0,!0,!0,!0),t.stencilFunc(t.EQUAL,this.getStackLength(),4294967295),t.stencilOp(t.KEEP,t.KEEP,t.KEEP)},va),pa=(_a.prototype.update=function(t,e,i,n){this.destinationFrame=t||this.destinationFrame||this.defaultFrame,this.sourceFrame=e||this.sourceFrame||t,this.calculateProjection(this.destinationFrame,this.sourceFrame,i,n),this.transform&&this.projectionMatrix.append(this.transform);var r=this.renderer;r.globalUniforms.uniforms.projectionMatrix=this.projectionMatrix,r.globalUniforms.update(),r.shader.shader&&r.shader.syncUniformGroup(r.shader.shader.uniforms.globals)},_a.prototype.calculateProjection=function(t,e,i,n){var r=this.projectionMatrix,s=n?-1:1;r.identity(),r.a=1/e.width*2,r.d=s*(1/e.height*2),r.tx=-1-e.x*r.a,r.ty=-s-e.y*r.d},_a.prototype.setTransform=function(t){},_a.prototype.destroy=function(){this.renderer=null},_a),fa=new Bi,ga=new Bi,ma=(ya.prototype.bind=function(t,e,i){void 0===t&&(t=null);var n,r,s,o=this.renderer;(this.current=t)?(s=(n=t.baseTexture).resolution,e||(fa.width=t.frame.width,fa.height=t.frame.height,e=fa),i||(ga.x=t.frame.x,ga.y=t.frame.y,ga.width=e.width,ga.height=e.height,i=ga),r=n.framebuffer):(s=o.resolution,e||(fa.width=o.screen.width,fa.height=o.screen.height,e=fa),i||((i=fa).width=e.width,i.height=e.height));var a=this.viewportFrame;a.x=i.x*s,a.y=i.y*s,a.width=i.width*s,a.height=i.height*s,t||(a.y=o.view.height-(a.y+a.height)),a.ceil(),this.renderer.framebuffer.bind(r,a),this.renderer.projection.update(i,e,s,!r),t?this.renderer.mask.setMaskStack(n.maskStack):this.renderer.mask.setMaskStack(this.defaultMaskStack),this.sourceFrame.copyFrom(e),this.destinationFrame.copyFrom(i)},ya.prototype.clear=function(t,e){t=this.current?t||this.current.baseTexture.clearColor:t||this.clearColor;var i=this.destinationFrame,n=this.current?this.current.baseTexture:this.renderer.screen,r=i.width!==n.width||i.height!==n.height;if(r){var s=this.viewportFrame,o=s.x,a=s.y,l=s.width,h=s.height;o=Math.round(o),a=Math.round(a),l=Math.round(l),h=Math.round(h),this.renderer.gl.enable(this.renderer.gl.SCISSOR_TEST),this.renderer.gl.scissor(o,a,l,h)}this.renderer.framebuffer.clear(t[0],t[1],t[2],t[3],e),r&&this.renderer.scissor.pop()},ya.prototype.resize=function(){this.bind(null)},ya.prototype.reset=function(){this.bind(null)},ya.prototype.destroy=function(){this.renderer=null},ya);function ya(t){this.renderer=t,this.clearColor=t._backgroundColorRgba,this.defaultMaskStack=[],this.current=null,this.sourceFrame=new Bi,this.destinationFrame=new Bi,this.viewportFrame=new Bi}function _a(t){this.renderer=t,this.destinationFrame=null,this.sourceFrame=null,this.defaultFrame=null,this.projectionMatrix=new Li,this.transform=null}function va(t){var e=Ko.call(this,t)||this;return e.glConst=WebGLRenderingContext.STENCIL_TEST,e}function ba(t){var e=$o.call(this,t)||this;return e.glConst=WebGLRenderingContext.SCISSOR_TEST,e}function wa(t){this.renderer=t,this.maskStack=[],this.glConst=0}function Sa(t){this.renderer=t,this.enableScissor=!0,this.alphaMaskPool=[],this.maskDataPool=[],this.maskStack=[],this.alphaMaskIndex=0}function xa(t,e,i){var n=this,r=null;return"string"!=typeof t&&void 0===e&&void 0===i&&(r=t,i=e=t=void 0),(n=Qo.call(this,t||"attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\nuniform mat3 otherMatrix;\n\nvarying vec2 vMaskCoord;\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = aTextureCoord;\n    vMaskCoord = ( otherMatrix * vec3( aTextureCoord, 1.0)  ).xy;\n}\n",e||"varying vec2 vMaskCoord;\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform sampler2D mask;\nuniform float alpha;\nuniform float npmAlpha;\nuniform vec4 maskClamp;\n\nvoid main(void)\n{\n    float clip = step(3.5,\n        step(maskClamp.x, vMaskCoord.x) +\n        step(maskClamp.y, vMaskCoord.y) +\n        step(vMaskCoord.x, maskClamp.z) +\n        step(vMaskCoord.y, maskClamp.w));\n\n    vec4 original = texture2D(uSampler, vTextureCoord);\n    vec4 masky = texture2D(mask, vMaskCoord);\n    float alphaMul = 1.0 - npmAlpha * (1.0 - masky.a);\n\n    original *= (alphaMul * masky.r * alpha * clip);\n\n    gl_FragColor = original;\n}\n",i)||this).maskSprite=r,n.maskMatrix=new Li,n}function Ta(t,e){this._texture=t,this.mapCoord=new Li,this.uClampFrame=new Float32Array(4),this.uClampOffset=new Float32Array(2),this._textureID=-1,this._updateID=0,this.clampOffset=0,this.clampMargin=void 0===e?.5:e,this.isSimple=!1}function Ia(t,e,i){var n=this,r=ea.from(t||Ia.defaultVertexSrc,e||Ia.defaultFragmentSrc);return(n=Jo.call(this,r,i)||this).padding=0,n.resolution=Tt.FILTER_RESOLUTION,n.multisample=Tt.FILTER_MULTISAMPLE,n.enabled=!0,n.autoFit=!0,n.state=new na,n}function Pa(){this.data=0,this.blendMode=nt.BLEND_MODES.NORMAL,this.polygonOffset=0,this.blend=!0,this.depthMask=!0}function Ca(t,e){this.uniformBindCount=0,this.program=t,this.uniformGroup=e?e instanceof Qs?e:new Qs(e):new Qs({})}function Ea(t,e,i){void 0===i&&(i="pixi-shader"),this.id=Zo++,this.vertexSrc=t||Ea.defaultVertexSrc,this.fragmentSrc=e||Ea.defaultFragmentSrc,this.vertexSrc=this.vertexSrc.trim(),this.fragmentSrc=this.fragmentSrc.trim(),"#version"!==this.vertexSrc.substring(0,8)&&(i=i.replace(/\s+/g,"-"),ta[i]?(ta[i]++,i+="-"+ta[i]):ta[i]=1,this.vertexSrc="#define SHADER_NAME "+i+"\n"+this.vertexSrc,this.fragmentSrc="#define SHADER_NAME "+i+"\n"+this.fragmentSrc,this.vertexSrc=Fo(this.vertexSrc,Tt.PRECISION_VERTEX,nt.PRECISION.HIGH),this.fragmentSrc=Fo(this.fragmentSrc,Tt.PRECISION_FRAGMENT,function(){if(!Ro){Ro=nt.PRECISION.MEDIUM;var t=Do();if(t&&t.getShaderPrecisionFormat){var e=t.getShaderPrecisionFormat(t.FRAGMENT_SHADER,t.HIGH_FLOAT);Ro=e.precision?nt.PRECISION.HIGH:nt.PRECISION.MEDIUM}}return Ro}())),this.glPrograms={},this.syncUniforms=null}function Aa(t,e,i,n,r){i.buffer.update(r)}var Ma={float:"\n        data[offset] = v;\n    ",vec2:"\n        data[offset] = v[0];\n        data[offset+1] = v[1];\n    ",vec3:"\n        data[offset] = v[0];\n        data[offset+1] = v[1];\n        data[offset+2] = v[2];\n\n    ",vec4:"\n        data[offset] = v[0];\n        data[offset+1] = v[1];\n        data[offset+2] = v[2];\n        data[offset+3] = v[3];\n    ",mat2:"\n        data[offset] = v[0];\n        data[offset+1] = v[1];\n\n        data[offset+4] = v[2];\n        data[offset+5] = v[3];\n    ",mat3:"\n        data[offset] = v[0];\n        data[offset+1] = v[1];\n        data[offset+2] = v[2];\n\n        data[offset + 4] = v[3];\n        data[offset + 5] = v[4];\n        data[offset + 6] = v[5];\n\n        data[offset + 8] = v[6];\n        data[offset + 9] = v[7];\n        data[offset + 10] = v[8];\n    ",mat4:"\n        for(var i = 0; i < 16; i++)\n        {\n            data[offset + i] = v[i];\n        }\n    "},Ba={float:4,vec2:8,vec3:12,vec4:16,int:4,ivec2:8,ivec3:12,ivec4:16,uint:4,uvec2:8,uvec3:12,uvec4:16,bool:4,bvec2:8,bvec3:12,bvec4:16,mat2:32,mat3:48,mat4:64};function Ra(t){for(var e=t.map(function(t){return{data:t,offset:0,dataLen:0,dirty:0}}),i=0,n=0,r=0,s=0;s<e.length;s++){var o=e[s];if(i=Ba[o.data.type],1<o.data.size&&(i=Math.max(i,16)*o.data.size),n%(o.dataLen=i)!=0&&n<16){var a=n%i%16;n+=a,r+=a}16<n+i?(r=16*Math.ceil(r/16),o.offset=r,r+=i,n=i):(o.offset=r,n+=i,r+=i)}return{uboElements:e,size:r=16*Math.ceil(r/16)}}function Oa(t,e){var i=[];for(var n in t)e[n]&&i.push(e[n]);return i.sort(function(t,e){return t.index-e.index}),i}function ka(t,e){if(!t.autoManage)return{size:0,syncFunc:Aa};for(var i=Ra(Oa(t.uniforms,e)),n=i.uboElements,r=i.size,s=["\n    var v = null;\n    var v2 = null;\n    var cv = null;\n    var t = 0;\n    var gl = renderer.gl\n    var index = 0;\n    var data = buffer.data;\n    "],o=0;o<n.length;o++){for(var a=n[o],l=t.uniforms[a.data.name],h=a.data.name,u=!1,c=0;c<Ho.length;c++){var d=Ho[c];if(d.codeUbo&&d.test(a.data,l)){s.push("offset = "+a.offset/4+";",Ho[c].codeUbo(a.data.name,l)),u=!0;break}}if(!u)if(1<a.data.size){var p=Lo(a.data.type),f=Math.max(Ba[a.data.type]/16,1),g=p/f,m=(4-g%4)%4;s.push("\n                cv = ud."+h+".value;\n                v = uv."+h+";\n                offset = "+a.offset/4+";\n\n                t = 0;\n\n                for(var i=0; i < "+a.data.size*f+"; i++)\n                {\n                    for(var j = 0; j < "+g+"; j++)\n                    {\n                        data[offset++] = v[t++];\n                    }\n                    offset += "+m+";\n                }\n\n                ")}else{var y=Ma[a.data.type];s.push("\n                cv = ud."+h+".value;\n                v = uv."+h+";\n                offset = "+a.offset/4+";\n                "+y+";\n                ")}}return s.push("\n       renderer.buffer.update(buffer);\n    "),{size:r,syncFunc:new Function("ud","uv","renderer","syncData","buffer",s.join("\n"))}}var Da=(Fa.prototype.destroy=function(){this.uniformData=null,this.uniformGroups=null,this.uniformDirtyGroups=null,this.uniformBufferBindings=null,this.program=null},Fa);function Fa(t,e){this.program=t,this.uniformData=e,this.uniformGroups={},this.uniformDirtyGroups={},this.uniformBufferBindings={}}function Na(t,e){var i,n,r,s,o=Eo(t,t.VERTEX_SHADER,e.vertexSrc),a=Eo(t,t.FRAGMENT_SHADER,e.fragmentSrc),l=t.createProgram();if(t.attachShader(l,o),t.attachShader(l,a),t.linkProgram(l),t.getProgramParameter(l,t.LINK_STATUS)||(n=l,r=o,s=a,(i=t).getProgramParameter(n,i.LINK_STATUS)||(i.getShaderParameter(r,i.COMPILE_STATUS)||Ao(i,r),i.getShaderParameter(s,i.COMPILE_STATUS)||Ao(i,s),console.error("PixiJS Error: Could not initialize shader."),""!==i.getProgramInfoLog(n)&&console.warn("PixiJS Warning: gl.getProgramInfoLog()",i.getProgramInfoLog(n)))),e.attributeData=function(t,e){for(var i={},n=e.getProgramParameter(t,e.ACTIVE_ATTRIBUTES),r=0;r<n;r++){var s=e.getActiveAttrib(t,r);if(0!==s.name.indexOf("gl_")){var o=Wo(e,s.type),a={type:o,name:s.name,size:Lo(o),location:e.getAttribLocation(t,s.name)};i[s.name]=a}}return i}(l,t),e.uniformData=function(t,e){for(var i={},n=e.getProgramParameter(t,e.ACTIVE_UNIFORMS),r=0;r<n;r++){var s=e.getActiveUniform(t,r),o=s.name.replace(/\[.*?\]$/,""),a=!!s.name.match(/\[.*?\]$/),l=Wo(e,s.type);i[o]={name:o,index:r,type:l,size:s.size,isArray:a,value:Bo(l,s.size)}}return i}(l,t),!/^[ \t]*#[ \t]*version[ \t]+300[ \t]+es[ \t]*$/m.test(e.vertexSrc)){var h=Object.keys(e.attributeData);h.sort(function(t,e){return e<t?1:-1});for(var u=0;u<h.length;u++)e.attributeData[h[u]].location=u,t.bindAttribLocation(l,u,h[u]);t.linkProgram(l)}t.deleteShader(o),t.deleteShader(a);var c={};for(var u in e.uniformData){var d=e.uniformData[u];c[u]={location:t.getUniformLocation(l,u),value:Bo(d.type,d.size)}}return new Da(l,c)}function La(t){this.texture=t,this.width=-1,this.height=-1,this.dirtyId=-1,this.dirtyStyleId=-1,this.mipmap=!1,this.wrapMode=33071,this.type=nt.TYPES.UNSIGNED_BYTE,this.internalFormat=nt.FORMATS.RGBA,this.samplerType=0}function Ua(t){this.buffer=t||null,this.updateID=-1,this.byteLength=-1,this.refCount=0}var za,Wa,Ga=0,Ha={textureCount:0,uboCount:0},Xa=(sl.prototype.systemCheck=function(){if(!function(){if("boolean"==typeof Go)return Go;try{var t=new Function("param1","param2","param3","return param1[param2] === param3;");Go=!0===t({a:"b"},"a","b")}catch(t){Go=!1}return Go}())throw new Error("Current environment does not allow unsafe-eval, please use @pixi/unsafe-eval module to enable support.")},sl.prototype.contextChange=function(t){this.gl=t,this.reset()},sl.prototype.bind=function(t,e){t.uniforms.globals=this.renderer.globalUniforms;var i=t.program,n=i.glPrograms[this.renderer.CONTEXT_UID]||this.generateProgram(t);return this.shader=t,this.program!==i&&(this.program=i,this.gl.useProgram(n.program)),e||(Ha.textureCount=0,Ha.uboCount=0,this.syncUniformGroup(t.uniformGroup,Ha)),n},sl.prototype.setUniforms=function(t){var e=this.shader.program,i=e.glPrograms[this.renderer.CONTEXT_UID];e.syncUniforms(i.uniformData,t,this.renderer)},sl.prototype.syncUniformGroup=function(t,e){var i=this.getGlProgram();t.static&&t.dirtyId===i.uniformDirtyGroups[t.id]||(i.uniformDirtyGroups[t.id]=t.dirtyId,this.syncUniforms(t,i,e))},sl.prototype.syncUniforms=function(t,e,i){(t.syncUniforms[this.shader.program.id]||this.createSyncGroups(t))(e.uniformData,t.uniforms,this.renderer,i)},sl.prototype.createSyncGroups=function(t){var e=this.getSignature(t,this.shader.program.uniformData,"u");return this.cache[e]||(this.cache[e]=function(t,e){var i,n=["\n        var v = null;\n        var cv = null;\n        var cu = null;\n        var t = 0;\n        var gl = renderer.gl;\n    "];for(var r in t.uniforms){var s=e[r];if(s){for(var o=t.uniforms[r],a=!1,l=0;l<Ho.length;l++)if(Ho[l].test(s,o)){n.push(Ho[l].code(r,o)),a=!0;break}if(!a){var h=(1===s.size?Xo:jo)[s.type].replace("location",'ud["'+r+'"].location');n.push('\n            cu = ud["'+r+'"];\n            cv = cu.value;\n            v = uv["'+r+'"];\n            '+h+";")}}else(null===(i=t.uniforms[r])||void 0===i?void 0:i.group)&&(t.uniforms[r].ubo?n.push("\n                        renderer.shader.syncUniformBufferGroup(uv."+r+", '"+r+"');\n                    "):n.push("\n                        renderer.shader.syncUniformGroup(uv."+r+", syncData);\n                    "))}return new Function("ud","uv","renderer","syncData",n.join("\n"))}(t,this.shader.program.uniformData)),t.syncUniforms[this.shader.program.id]=this.cache[e],t.syncUniforms[this.shader.program.id]},sl.prototype.syncUniformBufferGroup=function(t,e){var i=this.getGlProgram();if(!t.static||0!==t.dirtyId||!i.uniformGroups[t.id]){t.dirtyId=0;var n=i.uniformGroups[t.id]||this.createSyncBufferGroup(t,i,e);t.buffer.update(),n(i.uniformData,t.uniforms,this.renderer,Ha,t.buffer)}this.renderer.buffer.bindBufferBase(t.buffer,i.uniformBufferBindings[e])},sl.prototype.createSyncBufferGroup=function(t,e,i){var n=this.renderer.gl;this.renderer.buffer.bind(t.buffer);var r=this.gl.getUniformBlockIndex(e.program,i);e.uniformBufferBindings[i]=this.shader.uniformBindCount,n.uniformBlockBinding(e.program,r,this.shader.uniformBindCount),this.shader.uniformBindCount++;var s=this.getSignature(t,this.shader.program.uniformData,"ubo"),o=this._uboCache[s];if(o=o||(this._uboCache[s]=ka(t,this.shader.program.uniformData)),t.autoManage){var a=new Float32Array(o.size/4);t.buffer.update(a)}return e.uniformGroups[t.id]=o.syncFunc,e.uniformGroups[t.id]},sl.prototype.getSignature=function(t,e,i){var n=t.uniforms,r=[i+"-"];for(var s in n)r.push(s),e[s]&&r.push(e[s].type);return r.join("-")},sl.prototype.getGlProgram=function(){return this.shader?this.shader.program.glPrograms[this.renderer.CONTEXT_UID]:null},sl.prototype.generateProgram=function(t){var e=this.gl,i=t.program,n=Na(e,i);return i.glPrograms[this.renderer.CONTEXT_UID]=n},sl.prototype.reset=function(){this.program=null,this.shader=null},sl.prototype.destroy=function(){this.renderer=null,this.destroyed=!0},sl),ja=(rl.prototype.contextChange=function(t){var e,i;this.gl=t,this.blendModes=(e=t,void 0===i&&(i=[]),i[nt.BLEND_MODES.NORMAL]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],i[nt.BLEND_MODES.ADD]=[e.ONE,e.ONE],i[nt.BLEND_MODES.MULTIPLY]=[e.DST_COLOR,e.ONE_MINUS_SRC_ALPHA,e.ONE,e.ONE_MINUS_SRC_ALPHA],i[nt.BLEND_MODES.SCREEN]=[e.ONE,e.ONE_MINUS_SRC_COLOR,e.ONE,e.ONE_MINUS_SRC_ALPHA],i[nt.BLEND_MODES.OVERLAY]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],i[nt.BLEND_MODES.DARKEN]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],i[nt.BLEND_MODES.LIGHTEN]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],i[nt.BLEND_MODES.COLOR_DODGE]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],i[nt.BLEND_MODES.COLOR_BURN]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],i[nt.BLEND_MODES.HARD_LIGHT]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],i[nt.BLEND_MODES.SOFT_LIGHT]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],i[nt.BLEND_MODES.DIFFERENCE]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],i[nt.BLEND_MODES.EXCLUSION]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],i[nt.BLEND_MODES.HUE]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],i[nt.BLEND_MODES.SATURATION]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],i[nt.BLEND_MODES.COLOR]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],i[nt.BLEND_MODES.LUMINOSITY]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],i[nt.BLEND_MODES.NONE]=[0,0],i[nt.BLEND_MODES.NORMAL_NPM]=[e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA,e.ONE,e.ONE_MINUS_SRC_ALPHA],i[nt.BLEND_MODES.ADD_NPM]=[e.SRC_ALPHA,e.ONE,e.ONE,e.ONE],i[nt.BLEND_MODES.SCREEN_NPM]=[e.SRC_ALPHA,e.ONE_MINUS_SRC_COLOR,e.ONE,e.ONE_MINUS_SRC_ALPHA],i[nt.BLEND_MODES.SRC_IN]=[e.DST_ALPHA,e.ZERO],i[nt.BLEND_MODES.SRC_OUT]=[e.ONE_MINUS_DST_ALPHA,e.ZERO],i[nt.BLEND_MODES.SRC_ATOP]=[e.DST_ALPHA,e.ONE_MINUS_SRC_ALPHA],i[nt.BLEND_MODES.DST_OVER]=[e.ONE_MINUS_DST_ALPHA,e.ONE],i[nt.BLEND_MODES.DST_IN]=[e.ZERO,e.SRC_ALPHA],i[nt.BLEND_MODES.DST_OUT]=[e.ZERO,e.ONE_MINUS_SRC_ALPHA],i[nt.BLEND_MODES.DST_ATOP]=[e.ONE_MINUS_DST_ALPHA,e.SRC_ALPHA],i[nt.BLEND_MODES.XOR]=[e.ONE_MINUS_DST_ALPHA,e.ONE_MINUS_SRC_ALPHA],i[nt.BLEND_MODES.SUBTRACT]=[e.ONE,e.ONE,e.ONE,e.ONE,e.FUNC_REVERSE_SUBTRACT,e.FUNC_ADD],i),this.set(this.defaultState),this.reset()},rl.prototype.set=function(t){if(t=t||this.defaultState,this.stateId!==t.data){for(var e=this.stateId^t.data,i=0;e;)1&e&&this.map[i].call(this,!!(t.data&1<<i)),e>>=1,i++;this.stateId=t.data}for(i=0;i<this.checks.length;i++)this.checks[i](this,t)},rl.prototype.forceState=function(t){t=t||this.defaultState;for(var e=0;e<this.map.length;e++)this.map[e].call(this,!!(t.data&1<<e));for(e=0;e<this.checks.length;e++)this.checks[e](this,t);this.stateId=t.data},rl.prototype.setBlend=function(t){this.updateCheck(rl.checkBlendMode,t),this.gl[t?"enable":"disable"](this.gl.BLEND)},rl.prototype.setOffset=function(t){this.updateCheck(rl.checkPolygonOffset,t),this.gl[t?"enable":"disable"](this.gl.POLYGON_OFFSET_FILL)},rl.prototype.setDepthTest=function(t){this.gl[t?"enable":"disable"](this.gl.DEPTH_TEST)},rl.prototype.setDepthMask=function(t){this.gl.depthMask(t)},rl.prototype.setCullFace=function(t){this.gl[t?"enable":"disable"](this.gl.CULL_FACE)},rl.prototype.setFrontFace=function(t){this.gl.frontFace(this.gl[t?"CW":"CCW"])},rl.prototype.setBlendMode=function(t){if(t!==this.blendMode){this.blendMode=t;var e=this.blendModes[t],i=this.gl;2===e.length?i.blendFunc(e[0],e[1]):i.blendFuncSeparate(e[0],e[1],e[2],e[3]),6===e.length?(this._blendEq=!0,i.blendEquationSeparate(e[4],e[5])):this._blendEq&&(this._blendEq=!1,i.blendEquationSeparate(i.FUNC_ADD,i.FUNC_ADD))}},rl.prototype.setPolygonOffset=function(t,e){this.gl.polygonOffset(t,e)},rl.prototype.reset=function(){this.gl.pixelStorei(this.gl.UNPACK_FLIP_Y_WEBGL,!1),this.forceState(this.defaultState),this._blendEq=!0,this.blendMode=-1,this.setBlendMode(0)},rl.prototype.updateCheck=function(t,e){var i=this.checks.indexOf(t);e&&-1===i?this.checks.push(t):e||-1===i||this.checks.splice(i,1)},rl.checkBlendMode=function(t,e){t.setBlendMode(e.blendMode)},rl.checkPolygonOffset=function(t,e){t.setPolygonOffset(1,e.polygonOffset)},rl.prototype.destroy=function(){this.gl=null},rl),Va=(nl.prototype.postrender=function(){this.renderer.renderingToScreen&&(this.count++,this.mode!==nt.GC_MODES.MANUAL&&(this.checkCount++,this.checkCount>this.checkCountMax&&(this.checkCount=0,this.run())))},nl.prototype.run=function(){for(var t=this.renderer.texture,e=t.managedTextures,i=!1,n=0;n<e.length;n++){var r=e[n];!r.framebuffer&&this.count-r.touched>this.maxIdle&&(t.destroyTexture(r,!0),i=!(e[n]=null))}if(i){var s=0;for(n=0;n<e.length;n++)null!==e[n]&&(e[s++]=e[n]);e.length=s}},nl.prototype.unload=function(t){var e=this.renderer.texture,i=t._texture;i&&!i.framebuffer&&e.destroyTexture(i);for(var n=t.children.length-1;0<=n;n--)this.unload(t.children[n])},nl.prototype.destroy=function(){this.renderer=null},nl),Ya=(il.prototype.contextChange=function(){var t,e,i,n,r,s,o,a,l,h,u,c,d,p,f,g,m,y,_,v,b,w,S,x=this.gl=this.renderer.gl;this.CONTEXT_UID=this.renderer.CONTEXT_UID,this.webGLVersion=this.renderer.context.webGLVersion,this.internalFormats=(t=x,"WebGL2RenderingContext"in self&&t instanceof self.WebGL2RenderingContext?((e={})[nt.TYPES.UNSIGNED_BYTE]=((i={})[nt.FORMATS.RGBA]=t.RGBA8,i[nt.FORMATS.RGB]=t.RGB8,i[nt.FORMATS.RG]=t.RG8,i[nt.FORMATS.RED]=t.R8,i[nt.FORMATS.RGBA_INTEGER]=t.RGBA8UI,i[nt.FORMATS.RGB_INTEGER]=t.RGB8UI,i[nt.FORMATS.RG_INTEGER]=t.RG8UI,i[nt.FORMATS.RED_INTEGER]=t.R8UI,i[nt.FORMATS.ALPHA]=t.ALPHA,i[nt.FORMATS.LUMINANCE]=t.LUMINANCE,i[nt.FORMATS.LUMINANCE_ALPHA]=t.LUMINANCE_ALPHA,i),e[nt.TYPES.BYTE]=((n={})[nt.FORMATS.RGBA]=t.RGBA8_SNORM,n[nt.FORMATS.RGB]=t.RGB8_SNORM,n[nt.FORMATS.RG]=t.RG8_SNORM,n[nt.FORMATS.RED]=t.R8_SNORM,n[nt.FORMATS.RGBA_INTEGER]=t.RGBA8I,n[nt.FORMATS.RGB_INTEGER]=t.RGB8I,n[nt.FORMATS.RG_INTEGER]=t.RG8I,n[nt.FORMATS.RED_INTEGER]=t.R8I,n),e[nt.TYPES.UNSIGNED_SHORT]=((r={})[nt.FORMATS.RGBA_INTEGER]=t.RGBA16UI,r[nt.FORMATS.RGB_INTEGER]=t.RGB16UI,r[nt.FORMATS.RG_INTEGER]=t.RG16UI,r[nt.FORMATS.RED_INTEGER]=t.R16UI,r[nt.FORMATS.DEPTH_COMPONENT]=t.DEPTH_COMPONENT16,r),e[nt.TYPES.SHORT]=((s={})[nt.FORMATS.RGBA_INTEGER]=t.RGBA16I,s[nt.FORMATS.RGB_INTEGER]=t.RGB16I,s[nt.FORMATS.RG_INTEGER]=t.RG16I,s[nt.FORMATS.RED_INTEGER]=t.R16I,s),e[nt.TYPES.UNSIGNED_INT]=((o={})[nt.FORMATS.RGBA_INTEGER]=t.RGBA32UI,o[nt.FORMATS.RGB_INTEGER]=t.RGB32UI,o[nt.FORMATS.RG_INTEGER]=t.RG32UI,o[nt.FORMATS.RED_INTEGER]=t.R32UI,o[nt.FORMATS.DEPTH_COMPONENT]=t.DEPTH_COMPONENT24,o),e[nt.TYPES.INT]=((a={})[nt.FORMATS.RGBA_INTEGER]=t.RGBA32I,a[nt.FORMATS.RGB_INTEGER]=t.RGB32I,a[nt.FORMATS.RG_INTEGER]=t.RG32I,a[nt.FORMATS.RED_INTEGER]=t.R32I,a),e[nt.TYPES.FLOAT]=((l={})[nt.FORMATS.RGBA]=t.RGBA32F,l[nt.FORMATS.RGB]=t.RGB32F,l[nt.FORMATS.RG]=t.RG32F,l[nt.FORMATS.RED]=t.R32F,l[nt.FORMATS.DEPTH_COMPONENT]=t.DEPTH_COMPONENT32F,l),e[nt.TYPES.HALF_FLOAT]=((h={})[nt.FORMATS.RGBA]=t.RGBA16F,h[nt.FORMATS.RGB]=t.RGB16F,h[nt.FORMATS.RG]=t.RG16F,h[nt.FORMATS.RED]=t.R16F,h),e[nt.TYPES.UNSIGNED_SHORT_5_6_5]=((u={})[nt.FORMATS.RGB]=t.RGB565,u),e[nt.TYPES.UNSIGNED_SHORT_4_4_4_4]=((c={})[nt.FORMATS.RGBA]=t.RGBA4,c),e[nt.TYPES.UNSIGNED_SHORT_5_5_5_1]=((d={})[nt.FORMATS.RGBA]=t.RGB5_A1,d),e[nt.TYPES.UNSIGNED_INT_2_10_10_10_REV]=((p={})[nt.FORMATS.RGBA]=t.RGB10_A2,p[nt.FORMATS.RGBA_INTEGER]=t.RGB10_A2UI,p),e[nt.TYPES.UNSIGNED_INT_10F_11F_11F_REV]=((f={})[nt.FORMATS.RGB]=t.R11F_G11F_B10F,f),e[nt.TYPES.UNSIGNED_INT_5_9_9_9_REV]=((g={})[nt.FORMATS.RGB]=t.RGB9_E5,g),e[nt.TYPES.UNSIGNED_INT_24_8]=((m={})[nt.FORMATS.DEPTH_STENCIL]=t.DEPTH24_STENCIL8,m),e[nt.TYPES.FLOAT_32_UNSIGNED_INT_24_8_REV]=((y={})[nt.FORMATS.DEPTH_STENCIL]=t.DEPTH32F_STENCIL8,y),e):((_={})[nt.TYPES.UNSIGNED_BYTE]=((v={})[nt.FORMATS.RGBA]=t.RGBA,v[nt.FORMATS.RGB]=t.RGB,v[nt.FORMATS.ALPHA]=t.ALPHA,v[nt.FORMATS.LUMINANCE]=t.LUMINANCE,v[nt.FORMATS.LUMINANCE_ALPHA]=t.LUMINANCE_ALPHA,v),_[nt.TYPES.UNSIGNED_SHORT_5_6_5]=((b={})[nt.FORMATS.RGB]=t.RGB,b),_[nt.TYPES.UNSIGNED_SHORT_4_4_4_4]=((w={})[nt.FORMATS.RGBA]=t.RGBA,w),_[nt.TYPES.UNSIGNED_SHORT_5_5_5_1]=((S={})[nt.FORMATS.RGBA]=t.RGBA,S),_));var T=x.getParameter(x.MAX_TEXTURE_IMAGE_UNITS);this.boundTextures.length=T;for(var I=0;I<T;I++)this.boundTextures[I]=null;this.emptyTextures={};var P=new La(x.createTexture());for(x.bindTexture(x.TEXTURE_2D,P.texture),x.texImage2D(x.TEXTURE_2D,0,x.RGBA,1,1,0,x.RGBA,x.UNSIGNED_BYTE,new Uint8Array(4)),this.emptyTextures[x.TEXTURE_2D]=P,this.emptyTextures[x.TEXTURE_CUBE_MAP]=new La(x.createTexture()),x.bindTexture(x.TEXTURE_CUBE_MAP,this.emptyTextures[x.TEXTURE_CUBE_MAP].texture),I=0;I<6;I++)x.texImage2D(x.TEXTURE_CUBE_MAP_POSITIVE_X+I,0,x.RGBA,1,1,0,x.RGBA,x.UNSIGNED_BYTE,null);for(x.texParameteri(x.TEXTURE_CUBE_MAP,x.TEXTURE_MAG_FILTER,x.LINEAR),x.texParameteri(x.TEXTURE_CUBE_MAP,x.TEXTURE_MIN_FILTER,x.LINEAR),I=0;I<this.boundTextures.length;I++)this.bind(null,I)},il.prototype.bind=function(t,e){void 0===e&&(e=0);var i=this.gl;if((t=null==t?void 0:t.castToBaseTexture())&&t.valid&&!t.parentTextureArray){t.touched=this.renderer.textureGC.count;var n=t._glTextures[this.CONTEXT_UID]||this.initTexture(t);this.boundTextures[e]!==t&&(this.currentLocation!==e&&(this.currentLocation=e,i.activeTexture(i.TEXTURE0+e)),i.bindTexture(t.target,n.texture)),n.dirtyId!==t.dirtyId&&(this.currentLocation!==e&&(this.currentLocation=e,i.activeTexture(i.TEXTURE0+e)),this.updateTexture(t)),this.boundTextures[e]=t}else this.currentLocation!==e&&(this.currentLocation=e,i.activeTexture(i.TEXTURE0+e)),i.bindTexture(i.TEXTURE_2D,this.emptyTextures[i.TEXTURE_2D].texture),this.boundTextures[e]=null},il.prototype.reset=function(){this._unknownBoundTextures=!0,this.hasIntegerTextures=!1,this.currentLocation=-1;for(var t=0;t<this.boundTextures.length;t++)this.boundTextures[t]=this.unknownTexture},il.prototype.unbind=function(t){var e=this.gl,i=this.boundTextures;if(this._unknownBoundTextures){this._unknownBoundTextures=!1;for(var n=0;n<i.length;n++)i[n]===this.unknownTexture&&this.bind(null,n)}for(n=0;n<i.length;n++)i[n]===t&&(this.currentLocation!==n&&(e.activeTexture(e.TEXTURE0+n),this.currentLocation=n),e.bindTexture(t.target,this.emptyTextures[t.target].texture),i[n]=null)},il.prototype.ensureSamplerType=function(t){var e=this.boundTextures,i=this.hasIntegerTextures,n=this.CONTEXT_UID;if(i)for(var r=t-1;0<=r;--r){var s=e[r];s&&s._glTextures[n].samplerType!==nt.SAMPLER_TYPES.FLOAT&&this.renderer.texture.unbind(s)}},il.prototype.initTexture=function(t){var e=new La(this.gl.createTexture());return e.dirtyId=-1,t._glTextures[this.CONTEXT_UID]=e,this.managedTextures.push(t),t.on("dispose",this.destroyTexture,this),e},il.prototype.initTextureType=function(t,e){var i,n;e.internalFormat=null!==(n=null===(i=this.internalFormats[t.type])||void 0===i?void 0:i[t.format])&&void 0!==n?n:t.format,2===this.webGLVersion&&t.type===nt.TYPES.HALF_FLOAT?e.type=this.gl.HALF_FLOAT:e.type=t.type},il.prototype.updateTexture=function(t){var e=t._glTextures[this.CONTEXT_UID];if(e){var i=this.renderer;if(this.initTextureType(t,e),t.resource&&t.resource.upload(i,t,e))e.samplerType!==nt.SAMPLER_TYPES.FLOAT&&(this.hasIntegerTextures=!0);else{var n=t.realWidth,r=t.realHeight,s=i.gl;(e.width!==n||e.height!==r||e.dirtyId<0)&&(e.width=n,e.height=r,s.texImage2D(t.target,0,e.internalFormat,n,r,0,t.format,e.type,null))}t.dirtyStyleId!==e.dirtyStyleId&&this.updateTextureStyle(t),e.dirtyId=t.dirtyId}},il.prototype.destroyTexture=function(t,e){var i=this.gl;if((t=t.castToBaseTexture())._glTextures[this.CONTEXT_UID]&&(this.unbind(t),i.deleteTexture(t._glTextures[this.CONTEXT_UID].texture),t.off("dispose",this.destroyTexture,this),delete t._glTextures[this.CONTEXT_UID],!e)){var n=this.managedTextures.indexOf(t);-1!==n&&ci(this.managedTextures,n,1)}},il.prototype.updateTextureStyle=function(t){var e=t._glTextures[this.CONTEXT_UID];e&&(t.mipmap!==nt.MIPMAP_MODES.POW2&&2===this.webGLVersion||t.isPowerOfTwo?e.mipmap=1<=t.mipmap:e.mipmap=!1,2===this.webGLVersion||t.isPowerOfTwo?e.wrapMode=t.wrapMode:e.wrapMode=nt.WRAP_MODES.CLAMP,t.resource&&t.resource.style(this.renderer,t,e)||this.setStyle(t,e),e.dirtyStyleId=t.dirtyStyleId)},il.prototype.setStyle=function(t,e){var i=this.gl;if(e.mipmap&&t.mipmap!==nt.MIPMAP_MODES.ON_MANUAL&&i.generateMipmap(t.target),i.texParameteri(t.target,i.TEXTURE_WRAP_S,e.wrapMode),i.texParameteri(t.target,i.TEXTURE_WRAP_T,e.wrapMode),e.mipmap){i.texParameteri(t.target,i.TEXTURE_MIN_FILTER,t.scaleMode===nt.SCALE_MODES.LINEAR?i.LINEAR_MIPMAP_LINEAR:i.NEAREST_MIPMAP_NEAREST);var n=this.renderer.context.extensions.anisotropicFiltering;if(n&&0<t.anisotropicLevel&&t.scaleMode===nt.SCALE_MODES.LINEAR){var r=Math.min(t.anisotropicLevel,i.getParameter(n.MAX_TEXTURE_MAX_ANISOTROPY_EXT));i.texParameterf(t.target,n.TEXTURE_MAX_ANISOTROPY_EXT,r)}}else i.texParameteri(t.target,i.TEXTURE_MIN_FILTER,t.scaleMode===nt.SCALE_MODES.LINEAR?i.LINEAR:i.NEAREST);i.texParameteri(t.target,i.TEXTURE_MAG_FILTER,t.scaleMode===nt.SCALE_MODES.LINEAR?i.LINEAR:i.NEAREST)},il.prototype.destroy=function(){this.renderer=null},il),qa={__proto__:null,FilterSystem:eo,BatchSystem:no,ContextSystem:so,FramebufferSystem:ao,GeometrySystem:ho,MaskSystem:la,ScissorSystem:ca,StencilSystem:da,ProjectionSystem:pa,RenderTextureSystem:ma,ShaderSystem:Xa,StateSystem:ja,TextureGCSystem:Va,TextureSystem:Ya},Ka=new Li,$a=(kr(el,Wa=Ct),el.prototype.initPlugins=function(t){for(var e in t)this.plugins[e]=new t[e](this)},Object.defineProperty(el.prototype,"width",{get:function(){return this.view.width},enumerable:!1,configurable:!0}),Object.defineProperty(el.prototype,"height",{get:function(){return this.view.height},enumerable:!1,configurable:!0}),el.prototype.resize=function(t,e){this.view.width=Math.round(t*this.resolution),this.view.height=Math.round(e*this.resolution);var i=this.view.width/this.resolution,n=this.view.height/this.resolution;this.screen.width=i,this.screen.height=n,this.autoDensity&&(this.view.style.width=i+"px",this.view.style.height=n+"px"),this.emit("resize",i,n)},el.prototype.generateTexture=function(t,e,i,n){void 0===e&&(e={}),"number"==typeof e&&(e={scaleMode:e,resolution:i,region:n});var r=e.region,s=function(t,e){var i={};for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e.indexOf(n)<0&&(i[n]=t[n]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(n=Object.getOwnPropertySymbols(t);r<n.length;r++)e.indexOf(n[r])<0&&(i[n[r]]=t[n[r]])}return i}(e,["region"]);0===(n=r||t.getLocalBounds(null,!0)).width&&(n.width=1),0===n.height&&(n.height=1);var o=Ls.create(Vr({width:n.width,height:n.height},s));return Ka.tx=-n.x,Ka.ty=-n.y,this.render(t,{renderTexture:o,clear:!1,transform:Ka,skipUpdateTransform:!!t.parent}),o},el.prototype.destroy=function(t){for(var e in this.plugins)this.plugins[e].destroy(),this.plugins[e]=null;t&&this.view.parentNode&&this.view.parentNode.removeChild(this.view),this.plugins=null,this.type=nt.RENDERER_TYPE.UNKNOWN,this.view=null,this.screen=null,this._tempDisplayObjectParent=null,this.options=null,this._backgroundColorRgba=null,this._backgroundColorString=null,this._lastObjectRendered=null},Object.defineProperty(el.prototype,"backgroundColor",{get:function(){return this._backgroundColor},set:function(t){this._backgroundColor=t,this._backgroundColorString=Qe(t),$e(t,this._backgroundColorRgba)},enumerable:!1,configurable:!0}),Object.defineProperty(el.prototype,"backgroundAlpha",{get:function(){return this._backgroundColorRgba[3]},set:function(t){this._backgroundColorRgba[3]=t},enumerable:!1,configurable:!0}),el),Qa=(tl.prototype.destroy=function(){this.renderer=null},tl.prototype.contextChange=function(){this.disposeAll(!0),this.gl=this.renderer.gl,this.CONTEXT_UID=this.renderer.CONTEXT_UID},tl.prototype.bind=function(t){var e=this.gl,i=this.CONTEXT_UID,n=t._glBuffers[i]||this.createGLBuffer(t);e.bindBuffer(t.type,n.buffer)},tl.prototype.bindBufferBase=function(t,e){var i=this.gl,n=this.CONTEXT_UID;if(this.boundBufferBases[e]!==t){var r=t._glBuffers[n]||this.createGLBuffer(t);this.boundBufferBases[e]=t,i.bindBufferBase(i.UNIFORM_BUFFER,e,r.buffer)}},tl.prototype.bindBufferRange=function(t,e,i){var n=this.gl,r=this.CONTEXT_UID;i=i||0;var s=t._glBuffers[r]||this.createGLBuffer(t);n.bindBufferRange(n.UNIFORM_BUFFER,e||0,s.buffer,256*i,256)},tl.prototype.update=function(t){var e=this.gl,i=this.CONTEXT_UID,n=t._glBuffers[i];if(t._updateID!==n.updateID)if(n.updateID=t._updateID,e.bindBuffer(t.type,n.buffer),n.byteLength>=t.data.byteLength)e.bufferSubData(t.type,0,t.data);else{var r=t.static?e.STATIC_DRAW:e.DYNAMIC_DRAW;n.byteLength=t.data.byteLength,e.bufferData(t.type,t.data,r)}},tl.prototype.dispose=function(t,e){if(this.managedBuffers[t.id]){delete this.managedBuffers[t.id];var i=t._glBuffers[this.CONTEXT_UID],n=this.gl;t.disposeRunner.remove(this),i&&(e||n.deleteBuffer(i.buffer),delete t._glBuffers[this.CONTEXT_UID])}},tl.prototype.disposeAll=function(t){for(var e=Object.keys(this.managedBuffers),i=0;i<e.length;i++)this.dispose(this.managedBuffers[e[i]],t)},tl.prototype.createGLBuffer=function(t){var e=this.CONTEXT_UID,i=this.gl;return t._glBuffers[e]=new Ua(i.createBuffer()),(this.managedBuffers[t.id]=t).disposeRunner.add(this),t._glBuffers[e]},tl),Ja=(kr(Za,za=$a),Za.create=function(t){if(qe())return new Za(t);throw new Error('WebGL unsupported in this browser, use "pixi.js-legacy" for fallback canvas2d support.')},Za.prototype.contextChange=function(){var t,e=this.gl;if(1===this.context.webGLVersion){var i=e.getParameter(e.FRAMEBUFFER_BINDING);e.bindFramebuffer(e.FRAMEBUFFER,null),t=e.getParameter(e.SAMPLES),e.bindFramebuffer(e.FRAMEBUFFER,i)}else i=e.getParameter(e.DRAW_FRAMEBUFFER_BINDING),e.bindFramebuffer(e.DRAW_FRAMEBUFFER,null),t=e.getParameter(e.SAMPLES),e.bindFramebuffer(e.DRAW_FRAMEBUFFER,i);t>=nt.MSAA_QUALITY.HIGH?this.multisample=nt.MSAA_QUALITY.HIGH:t>=nt.MSAA_QUALITY.MEDIUM?this.multisample=nt.MSAA_QUALITY.MEDIUM:t>=nt.MSAA_QUALITY.LOW?this.multisample=nt.MSAA_QUALITY.LOW:this.multisample=nt.MSAA_QUALITY.NONE},Za.prototype.addSystem=function(t,e){var i=new t(this);if(this[e])throw new Error('Whoops! The name "'+e+'" is already in use');for(var n in this[e]=i,this.runners)this.runners[n].add(i);return this},Za.prototype.render=function(t,e){var i,n,r,s;if(e&&(s=e instanceof Ls?(i=e,n=arguments[2],r=arguments[3],arguments[4]):(i=e.renderTexture,n=e.clear,r=e.transform,e.skipUpdateTransform)),this.renderingToScreen=!i,this.runners.prerender.emit(),this.emit("prerender"),this.projection.transform=r,!this.context.isLost){if(i||(this._lastObjectRendered=t),!s){var o=t.enableTempParent();t.updateTransform(),t.disableTempParent(o)}this.renderTexture.bind(i),this.batch.currentRenderer.start(),(void 0!==n?n:this.clearBeforeRender)&&this.renderTexture.clear(),t.render(this),this.batch.currentRenderer.flush(),i&&i.baseTexture.update(),this.runners.postrender.emit(),this.projection.transform=null,this.emit("postrender")}},Za.prototype.generateTexture=function(t,e,i,n){void 0===e&&(e={});var r=za.prototype.generateTexture.call(this,t,e,i,n);return this.framebuffer.blit(),r},Za.prototype.resize=function(t,e){za.prototype.resize.call(this,t,e),this.runners.resize.emit(this.screen.height,this.screen.width)},Za.prototype.reset=function(){return this.runners.reset.emit(),this},Za.prototype.clear=function(){this.renderTexture.bind(),this.renderTexture.clear()},Za.prototype.destroy=function(t){for(var e in this.runners.destroy.emit(),this.runners)this.runners[e].destroy();za.prototype.destroy.call(this,t),this.gl=null},Object.defineProperty(Za.prototype,"extract",{get:function(){return this.plugins.extract},enumerable:!1,configurable:!0}),Za.registerPlugin=function(t,e){(Za.__plugins=Za.__plugins||{})[t]=e},Za);function Za(t){var e=za.call(this,nt.RENDERER_TYPE.WEBGL,t)||this;return t=e.options,e.gl=null,e.CONTEXT_UID=0,e.runners={destroy:new Cr("destroy"),contextChange:new Cr("contextChange"),reset:new Cr("reset"),update:new Cr("update"),postrender:new Cr("postrender"),prerender:new Cr("prerender"),resize:new Cr("resize")},e.runners.contextChange.add(e),e.globalUniforms=new Qs({projectionMatrix:new Li},!0),e.addSystem(la,"mask").addSystem(so,"context").addSystem(ja,"state").addSystem(Xa,"shader").addSystem(Ya,"texture").addSystem(Qa,"buffer").addSystem(ho,"geometry").addSystem(ao,"framebuffer").addSystem(ca,"scissor").addSystem(da,"stencil").addSystem(pa,"projection").addSystem(Va,"textureGC").addSystem(eo,"filter").addSystem(ma,"renderTexture").addSystem(no,"batch"),e.initPlugins(Za.__plugins),e.multisample=void 0,t.context?e.context.initFromContext(t.context):e.context.initFromOptions({alpha:!!e.useContextAlpha,antialias:t.antialias,premultipliedAlpha:e.useContextAlpha&&"notMultiplied"!==e.useContextAlpha,stencil:!0,preserveDrawingBuffer:t.preserveDrawingBuffer,powerPreference:e.options.powerPreference}),e.renderingToScreen=!0,Ye(2===e.context.webGLVersion?"WebGL 2":"WebGL 1"),e.resize(e.options.width,e.options.height),e}function tl(t){this.renderer=t,this.managedBuffers={},this.boundBufferBases={}}function el(t,e){void 0===t&&(t=nt.RENDERER_TYPE.UNKNOWN);var i=Wa.call(this)||this;return e=Object.assign({},Tt.RENDER_OPTIONS,e),i.options=e,i.type=t,i.screen=new Bi(0,0,e.width,e.height),i.view=e.view||document.createElement("canvas"),i.resolution=e.resolution||Tt.RESOLUTION,i.useContextAlpha=e.useContextAlpha,i.autoDensity=!!e.autoDensity,i.preserveDrawingBuffer=e.preserveDrawingBuffer,i.clearBeforeRender=e.clearBeforeRender,i._backgroundColor=0,i._backgroundColorRgba=[0,0,0,1],i._backgroundColorString="#000000",i.backgroundColor=e.backgroundColor||i._backgroundColor,i.backgroundAlpha=e.backgroundAlpha,void 0!==e.transparent&&(i.useContextAlpha=e.transparent,i.backgroundAlpha=e.transparent?0:1),i._lastObjectRendered=null,i.plugins={},i}function il(t){this.renderer=t,this.boundTextures=[],this.currentLocation=-1,this.managedTextures=[],this._unknownBoundTextures=!1,this.unknownTexture=new $r,this.hasIntegerTextures=!1}function nl(t){this.renderer=t,this.count=0,this.checkCount=0,this.maxIdle=Tt.GC_MAX_IDLE,this.checkCountMax=Tt.GC_MAX_CHECK_COUNT,this.mode=Tt.GC_MODE}function rl(){this.gl=null,this.stateId=0,this.polygonOffset=0,this.blendMode=nt.BLEND_MODES.NONE,this._blendEq=!1,this.map=[],this.map[0]=this.setBlend,this.map[1]=this.setOffset,this.map[2]=this.setCullFace,this.map[3]=this.setDepthTest,this.map[4]=this.setFrontFace,this.map[5]=this.setDepthMask,this.checks=[],this.defaultState=new na,this.defaultState.blend=!0}function sl(t){this.destroyed=!1,this.renderer=t,this.systemCheck(),this.gl=null,this.shader=null,this.program=null,this.cache={},this._uboCache={},this.id=Ga++}function ol(t){return Ja.create(t)}function al(){this.texArray=null,this.blend=0,this.type=nt.DRAW_MODES.TRIANGLES,this.start=0,this.size=0,this.data=null}function ll(t){Object.defineProperty(xl,t,{get:function(){return ws[t]}})}var hl,ul,cl="attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n    vTextureCoord = aTextureCoord;\n}",dl="attribute vec2 aVertexPosition;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nuniform vec4 inputSize;\nuniform vec4 outputFrame;\n\nvec4 filterVertexPosition( void )\n{\n    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;\n\n    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);\n}\n\nvec2 filterTextureCoord( void )\n{\n    return aVertexPosition * (outputFrame.zw * inputSize.zw);\n}\n\nvoid main(void)\n{\n    gl_Position = filterVertexPosition();\n    vTextureCoord = filterTextureCoord();\n}\n",pl=(Ml.prototype.destroy=function(){this.renderer=null},Ml),fl=(Al.prototype.clear=function(){for(var t=0;t<this.count;t++)this.elements[t]=null;this.count=0},Al),gl=(Object.defineProperty(El.prototype,"int8View",{get:function(){return this._int8View||(this._int8View=new Int8Array(this.rawBinaryData)),this._int8View},enumerable:!1,configurable:!0}),Object.defineProperty(El.prototype,"uint8View",{get:function(){return this._uint8View||(this._uint8View=new Uint8Array(this.rawBinaryData)),this._uint8View},enumerable:!1,configurable:!0}),Object.defineProperty(El.prototype,"int16View",{get:function(){return this._int16View||(this._int16View=new Int16Array(this.rawBinaryData)),this._int16View},enumerable:!1,configurable:!0}),Object.defineProperty(El.prototype,"uint16View",{get:function(){return this._uint16View||(this._uint16View=new Uint16Array(this.rawBinaryData)),this._uint16View},enumerable:!1,configurable:!0}),Object.defineProperty(El.prototype,"int32View",{get:function(){return this._int32View||(this._int32View=new Int32Array(this.rawBinaryData)),this._int32View},enumerable:!1,configurable:!0}),El.prototype.view=function(t){return this[t+"View"]},El.prototype.destroy=function(){this.rawBinaryData=null,this._int8View=null,this._uint8View=null,this._int16View=null,this._uint16View=null,this._int32View=null,this.uint32View=null,this.float32View=null},El.sizeOf=function(t){switch(t){case"int8":case"uint8":return 1;case"int16":case"uint16":return 2;case"int32":case"uint32":case"float32":return 4;default:throw new Error(t+" isn't a valid view type")}},El),ml=(kr(Cl,ul=io),Cl.prototype.contextChange=function(){var t=this.renderer.gl;Tt.PREFER_ENV===nt.ENV.WEBGL_LEGACY?this.MAX_TEXTURES=1:(this.MAX_TEXTURES=Math.min(t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS),Tt.SPRITE_MAX_TEXTURES),this.MAX_TEXTURES=qo(this.MAX_TEXTURES,t)),this._shader=this.shaderGenerator.generateShader(this.MAX_TEXTURES);for(var e=0;e<this._packedGeometryPoolSize;e++)this._packedGeometries[e]=new this.geometryClass;this.initFlushBuffers()},Cl.prototype.initFlushBuffers=function(){for(var t=Cl._drawCallPool,e=Cl._textureArrayPool,i=this.size/4,n=Math.floor(i/this.MAX_TEXTURES)+1;t.length<i;)t.push(new al);for(;e.length<n;)e.push(new fl);for(var r=0;r<this.MAX_TEXTURES;r++)this._tempBoundTextures[r]=null},Cl.prototype.onPrerender=function(){this._flushId=0},Cl.prototype.render=function(t){t._texture.valid&&(this._vertexCount+t.vertexData.length/2>this.size&&this.flush(),this._vertexCount+=t.vertexData.length/2,this._indexCount+=t.indices.length,this._bufferedTextures[this._bufferSize]=t._texture.baseTexture,this._bufferedElements[this._bufferSize++]=t)},Cl.prototype.buildTexturesAndDrawCalls=function(){var t=this._bufferedTextures,e=this.MAX_TEXTURES,i=Cl._textureArrayPool,n=this.renderer.batch,r=this._tempBoundTextures,s=this.renderer.textureGC.count,o=++$r._globalBatch,a=0,l=i[0],h=0;n.copyBoundTextures(r,e);for(var u=0;u<this._bufferSize;++u){var c=t[u];t[u]=null,c._batchEnabled!==o&&(l.count>=e&&(n.boundArray(l,r,o,e),this.buildDrawCalls(l,h,u),h=u,l=i[++a],++o),c._batchEnabled=o,c.touched=s,l.elements[l.count++]=c)}for(0<l.count&&(n.boundArray(l,r,o,e),this.buildDrawCalls(l,h,this._bufferSize),++a,++o),u=0;u<r.length;u++)r[u]=null;$r._globalBatch=o},Cl.prototype.buildDrawCalls=function(t,e,i){var n=this._bufferedElements,r=this._attributeBuffer,s=this._indexBuffer,o=this.vertexSize,a=Cl._drawCallPool,l=this._dcIndex,h=this._aIndex,u=this._iIndex,c=a[l];c.start=this._iIndex,c.texArray=t;for(var d=e;d<i;++d){var p=n[d],f=p._texture.baseTexture,g=ti[f.alphaMode?1:0][p.blendMode];n[d]=null,e<d&&c.blend!==g&&(c.size=u-c.start,e=d,(c=a[++l]).texArray=t,c.start=u),this.packInterleavedGeometry(p,r,s,h,u),h+=p.vertexData.length/2*o,u+=p.indices.length,c.blend=g}e<i&&(c.size=u-c.start,++l),this._dcIndex=l,this._aIndex=h,this._iIndex=u},Cl.prototype.bindAndClearTexArray=function(t){for(var e=this.renderer.texture,i=0;i<t.count;i++)e.bind(t.elements[i],t.ids[i]),t.elements[i]=null;t.count=0},Cl.prototype.updateGeometry=function(){var t=this._packedGeometries,e=this._attributeBuffer,i=this._indexBuffer;Tt.CAN_UPLOAD_SAME_BUFFER?(t[this._flushId]._buffer.update(e.rawBinaryData),t[this._flushId]._indexBuffer.update(i),this.renderer.geometry.updateBuffers()):(this._packedGeometryPoolSize<=this._flushId&&(this._packedGeometryPoolSize++,t[this._flushId]=new this.geometryClass),t[this._flushId]._buffer.update(e.rawBinaryData),t[this._flushId]._indexBuffer.update(i),this.renderer.geometry.bind(t[this._flushId]),this.renderer.geometry.updateBuffers(),this._flushId++)},Cl.prototype.drawBatches=function(){for(var t=this._dcIndex,e=this.renderer,i=e.gl,n=e.state,r=Cl._drawCallPool,s=null,o=0;o<t;o++){var a=r[o],l=a.texArray,h=a.type,u=a.size,c=a.start,d=a.blend;s!==l&&(s=l,this.bindAndClearTexArray(l)),this.state.blendMode=d,n.set(this.state),i.drawElements(h,u,i.UNSIGNED_SHORT,2*c)}},Cl.prototype.flush=function(){0!==this._vertexCount&&(this._attributeBuffer=this.getAttributeBuffer(this._vertexCount),this._indexBuffer=this.getIndexBuffer(this._indexCount),this._aIndex=0,this._iIndex=0,this._dcIndex=0,this.buildTexturesAndDrawCalls(),this.updateGeometry(),this.drawBatches(),this._bufferSize=0,this._vertexCount=0,this._indexCount=0)},Cl.prototype.start=function(){this.renderer.state.set(this.state),this.renderer.texture.ensureSamplerType(this.MAX_TEXTURES),this.renderer.shader.bind(this._shader),Tt.CAN_UPLOAD_SAME_BUFFER&&this.renderer.geometry.bind(this._packedGeometries[this._flushId])},Cl.prototype.stop=function(){this.flush()},Cl.prototype.destroy=function(){for(var t=0;t<this._packedGeometryPoolSize;t++)this._packedGeometries[t]&&this._packedGeometries[t].destroy();this.renderer.off("prerender",this.onPrerender,this),this._aBuffers=null,this._iBuffers=null,this._packedGeometries=null,this._attributeBuffer=null,this._indexBuffer=null,this._shader&&(this._shader.destroy(),this._shader=null),ul.prototype.destroy.call(this)},Cl.prototype.getAttributeBuffer=function(t){var e=li(Math.ceil(t/8)),i=ui(e),n=8*e;this._aBuffers.length<=i&&(this._iBuffers.length=i+1);var r=this._aBuffers[n];return r||(this._aBuffers[n]=r=new gl(n*this.vertexSize*4)),r},Cl.prototype.getIndexBuffer=function(t){var e=li(Math.ceil(t/12)),i=ui(e),n=12*e;this._iBuffers.length<=i&&(this._iBuffers.length=i+1);var r=this._iBuffers[i];return r||(this._iBuffers[i]=r=new Uint16Array(n)),r},Cl.prototype.packInterleavedGeometry=function(t,e,i,n,r){for(var s=e.uint32View,o=e.float32View,a=n/this.vertexSize,l=t.uvs,h=t.indices,u=t.vertexData,c=t._texture.baseTexture._batchLocation,d=Math.min(t.worldAlpha,1),p=d<1&&t._texture.baseTexture.alphaMode?ni(t._tintRGB,d):t._tintRGB+(255*d<<24),f=0;f<u.length;f+=2)o[n++]=u[f],o[n++]=u[f+1],o[n++]=l[f],o[n++]=l[f+1],s[n++]=p,o[n++]=c;for(f=0;f<h.length;f++)i[r++]=a+h[f]},Cl._drawCallPool=[],Cl._textureArrayPool=[],Cl),yl=(Pl.prototype.generateShader=function(t){if(!this.programCache[t]){for(var e=new Int32Array(t),i=0;i<t;i++)e[i]=i;this.defaultGroupCache[t]=Qs.from({uSamplers:e},!0);var n=this.fragTemplate;n=(n=n.replace(/%count%/gi,""+t)).replace(/%forloop%/gi,this.generateSampleSrc(t)),this.programCache[t]=new ea(this.vertexSrc,n)}var r={tint:new Float32Array([1,1,1,1]),translationMatrix:new Li,default:this.defaultGroupCache[t]};return new ia(this.programCache[t],r)},Pl.prototype.generateSampleSrc=function(t){var e="";e+="\n",e+="\n";for(var i=0;i<t;i++)0<i&&(e+="\nelse "),i<t-1&&(e+="if(vTextureId < "+i+".5)"),e+="\n{",e+="\n\tcolor = texture2D(uSamplers["+i+"], vTextureCoord);",e+="\n}";return(e+="\n")+"\n"},Pl),_l=(kr(Il,hl=Ys),Il),vl="precision highp float;\nattribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\nattribute vec4 aColor;\nattribute float aTextureId;\n\nuniform mat3 projectionMatrix;\nuniform mat3 translationMatrix;\nuniform vec4 tint;\n\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\nvarying float vTextureId;\n\nvoid main(void){\n    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = aTextureCoord;\n    vTextureId = aTextureId;\n    vColor = aColor * tint;\n}\n",bl="varying vec2 vTextureCoord;\nvarying vec4 vColor;\nvarying float vTextureId;\nuniform sampler2D uSamplers[%count%];\n\nvoid main(void){\n    vec4 color;\n    %forloop%\n    gl_FragColor = color * vColor;\n}\n",wl=(Tl.create=function(t){var i,e=Object.assign({vertex:vl,fragment:bl,geometryClass:_l,vertexSize:6},t),n=e.vertex,r=e.fragment,s=e.vertexSize,o=e.geometryClass;return kr(a,i=ml),a;function a(t){var e=i.call(this,t)||this;return e.shaderGenerator=new yl(n,r),e.geometryClass=o,e.vertexSize=s,e}},Object.defineProperty(Tl,"defaultVertexSrc",{get:function(){return vl},enumerable:!1,configurable:!0}),Object.defineProperty(Tl,"defaultFragmentTemplate",{get:function(){return bl},enumerable:!1,configurable:!0}),Tl),Sl=wl.create(),xl={};function Tl(){}function Il(t){void 0===t&&(t=!1);var e=hl.call(this)||this;return e._buffer=new Gs(null,t,!1),e._indexBuffer=new Gs(null,t,!0),e.addAttribute("aVertexPosition",e._buffer,2,!1,nt.TYPES.FLOAT).addAttribute("aTextureCoord",e._buffer,2,!1,nt.TYPES.FLOAT).addAttribute("aColor",e._buffer,4,!0,nt.TYPES.UNSIGNED_BYTE).addAttribute("aTextureId",e._buffer,1,!0,nt.TYPES.FLOAT).addIndex(e._indexBuffer),e}function Pl(t,e){if(this.vertexSrc=t,this.fragTemplate=e,this.programCache={},this.defaultGroupCache={},e.indexOf("%count%")<0)throw new Error('Fragment template must contain "%count%".');if(e.indexOf("%forloop%")<0)throw new Error('Fragment template must contain "%forloop%".')}function Cl(t){var e=ul.call(this,t)||this;return e.shaderGenerator=null,e.geometryClass=null,e.vertexSize=null,e.state=na.for2d(),e.size=4*Tt.SPRITE_BATCH_SIZE,e._vertexCount=0,e._indexCount=0,e._bufferedElements=[],e._bufferedTextures=[],e._bufferSize=0,e._shader=null,e._packedGeometries=[],e._packedGeometryPoolSize=2,e._flushId=0,e._aBuffers={},e._iBuffers={},e.MAX_TEXTURES=1,e.renderer.on("prerender",e.onPrerender,e),t.runners.contextChange.add(e),e._dcIndex=0,e._aIndex=0,e._iIndex=0,e._attributeBuffer=null,e._indexBuffer=null,e._tempBoundTextures=[],e}function El(t){"number"==typeof t?this.rawBinaryData=new ArrayBuffer(t):t instanceof Uint8Array?this.rawBinaryData=t.buffer:this.rawBinaryData=t,this.uint32View=new Uint32Array(this.rawBinaryData),this.float32View=new Float32Array(this.rawBinaryData)}function Al(){this.elements=[],this.ids=[],this.count=0}function Ml(t){this.renderer=t}for(var Bl in ws)ll(Bl);function Rl(t){Object.defineProperty(Ol,t,{get:function(){return qa[t]}})}var Ol={};for(var Bl in qa)Rl(Bl);var kl=(Nl.registerPlugin=function(t){Nl._plugins.push(t)},Nl.prototype.render=function(){this.renderer.render(this.stage)},Object.defineProperty(Nl.prototype,"view",{get:function(){return this.renderer.view},enumerable:!1,configurable:!0}),Object.defineProperty(Nl.prototype,"screen",{get:function(){return this.renderer.screen},enumerable:!1,configurable:!0}),Nl.prototype.destroy=function(t,e){var i=this,n=Nl._plugins.slice(0);n.reverse(),n.forEach(function(t){t.destroy.call(i)}),this.stage.destroy(e),this.stage=null,this.renderer.destroy(t),this.renderer=null},Nl._plugins=[],Nl),Dl=(Fl.init=function(t){var n=this;Object.defineProperty(this,"resizeTo",{set:function(t){self.removeEventListener("resize",this.queueResize),(this._resizeTo=t)&&(self.addEventListener("resize",this.queueResize),this.resize())},get:function(){return this._resizeTo}}),this.queueResize=function(){n._resizeTo&&(n.cancelResize(),n._resizeId=requestAnimationFrame(function(){return n.resize()}))},this.cancelResize=function(){n._resizeId&&(cancelAnimationFrame(n._resizeId),n._resizeId=null)},this.resize=function(){if(n._resizeTo){var t,e;if(n.cancelResize(),n._resizeTo===self)t=self.innerWidth,e=self.innerHeight;else{var i=n._resizeTo;t=i.clientWidth,e=i.clientHeight}n.renderer.resize(t,e)}},this._resizeId=null,this._resizeTo=null,this.resizeTo=t.resizeTo||null},Fl.destroy=function(){self.removeEventListener("resize",this.queueResize),this.cancelResize(),this.cancelResize=null,this.queueResize=null,this.resizeTo=null,this.resize=null},Fl);function Fl(){}function Nl(e){var i=this;this.stage=new tr,e=Object.assign({forceCanvas:!1},e),this.renderer=ol(e),Nl._plugins.forEach(function(t){t.init.call(i,e)})}kl.registerPlugin(Dl);var Ll=new Bi,Ul=(Gl.prototype.image=function(t,e,i){var n=new Image;return n.src=this.base64(t,e,i),n},Gl.prototype.base64=function(t,e,i){return this.canvas(t).toDataURL(e,i)},Gl.prototype.canvas=function(t){var e,i,n,r=this.renderer,s=!1,o=!1;t&&(t instanceof Ls?n=t:(n=this.renderer.generateTexture(t),o=!0)),n?(e=n.baseTexture.resolution,i=n.frame,s=!1,r.renderTexture.bind(n)):(e=this.renderer.resolution,s=!0,(i=Ll).width=this.renderer.width,i.height=this.renderer.height,r.renderTexture.bind(null));var a=Math.floor(i.width*e+1e-4),l=Math.floor(i.height*e+1e-4),h=new vi(a,l,1),u=new Uint8Array(4*a*l),c=r.gl;c.readPixels(i.x*e,i.y*e,a,l,c.RGBA,c.UNSIGNED_BYTE,u);var d=h.context.getImageData(0,0,a,l);if(Gl.arrayPostDivide(u,d.data),h.context.putImageData(d,0,0),s){var p=new vi(h.width,h.height,1);p.context.scale(1,-1),p.context.drawImage(h.canvas,0,-l),h.destroy(),h=p}return o&&n.destroy(!0),h.canvas},Gl.prototype.pixels=function(t){var e,i,n,r=this.renderer,s=!1;t&&(t instanceof Ls?n=t:(n=this.renderer.generateTexture(t),s=!0)),n?(e=n.baseTexture.resolution,i=n.frame,r.renderTexture.bind(n)):(e=r.resolution,(i=Ll).width=r.width,i.height=r.height,r.renderTexture.bind(null));var o=i.width*e,a=i.height*e,l=new Uint8Array(4*o*a),h=r.gl;return h.readPixels(i.x*e,i.y*e,o,a,h.RGBA,h.UNSIGNED_BYTE,l),s&&n.destroy(!0),Gl.arrayPostDivide(l,l),l},Gl.prototype.destroy=function(){this.renderer=null},Gl.arrayPostDivide=function(t,e){for(var i=0;i<t.length;i+=4){var n=e[i+3]=t[i+3];0!==n?(e[i]=Math.round(Math.min(255*t[i]/n,255)),e[i+1]=Math.round(Math.min(255*t[i+1]/n,255)),e[i+2]=Math.round(Math.min(255*t[i+2]/n,255))):(e[i]=t[i],e[i+1]=t[i+1],e[i+2]=t[i+2])}},Gl),zl=(Wl.prototype.detach=function(){return null!==this._owner&&(this._owner.detach(this),!0)},Wl);function Wl(t,e,i){void 0===e&&(e=!1),this._fn=t,this._once=e,this._thisArg=i,this._next=this._prev=this._owner=null}function Gl(t){this.renderer=t}function Hl(t,e){return t._head?(t._tail._next=e)._prev=t._tail:t._head=e,(t._tail=e)._owner=t,e}var Xl=(jl.prototype.handlers=function(t){void 0===t&&(t=!1);var e=this._head;if(t)return!!e;for(var i=[];e;)i.push(e),e=e._next;return i},jl.prototype.has=function(t){if(!(t instanceof zl))throw new Error("MiniSignal#has(): First arg must be a SignalBinding object.");return t._owner===this},jl.prototype.dispatch=function(){for(var t=arguments,e=[],i=0;i<arguments.length;i++)e[i]=t[i];var n=this._head;if(!n)return!1;for(;n;)n._once&&this.detach(n),n._fn.apply(n._thisArg,e),n=n._next;return!0},jl.prototype.add=function(t,e){if(void 0===e&&(e=null),"function"!=typeof t)throw new Error("MiniSignal#add(): First arg must be a Function.");return Hl(this,new zl(t,!1,e))},jl.prototype.once=function(t,e){if(void 0===e&&(e=null),"function"!=typeof t)throw new Error("MiniSignal#once(): First arg must be a Function.");return Hl(this,new zl(t,!0,e))},jl.prototype.detach=function(t){if(!(t instanceof zl))throw new Error("MiniSignal#detach(): First arg must be a SignalBinding object.");return t._owner!==this||(t._prev&&(t._prev._next=t._next),t._next&&(t._next._prev=t._prev),t===this._head?(this._head=t._next,null===t._next&&(this._tail=null)):t===this._tail&&(this._tail=t._prev,this._tail._next=null),t._owner=null),this},jl.prototype.detachAll=function(){var t=this._head;if(!t)return this;for(this._head=this._tail=null;t;)t._owner=null,t=t._next;return this},jl);function jl(){this._head=this._tail=void 0}function Vl(t,e){e=e||{};for(var n={key:["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],q:{name:"queryKey",parser:/(?:^|&)([^&=]*)=?([^&]*)/g},parser:{strict:/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/,loose:/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/}},i=n.parser[e.strictMode?"strict":"loose"].exec(t),r={},s=14;s--;)r[n.key[s]]=i[s]||"";return r[n.q.name]={},r[n.key[12]].replace(n.q.parser,function(t,e,i){e&&(r[n.q.name][e]=i)}),r}var Yl,ql,Kl,$l,Ql,Jl=!(!self.XDomainRequest||"withCredentials"in new XMLHttpRequest),Zl=null;function th(){}function eh(t,e,i){e&&0===e.indexOf(".")&&(e=e.substring(1)),e&&(t[e]=i)}function ih(t){return t.toString().replace("object ","")}function nh(){}function rh(r){return function(){for(var t=arguments,e=[],i=0;i<arguments.length;i++)e[i]=t[i];if(null===r)throw new Error("Callback was already called.");var n=r;r=null,n.apply(this,e)}}function sh(t,e,i){if(this._dequeue=th,this._onLoadBinding=null,this._elementTimer=0,this._boundComplete=null,this._boundOnError=null,this._boundOnProgress=null,this._boundOnTimeout=null,this._boundXhrOnError=null,this._boundXhrOnTimeout=null,this._boundXhrOnAbort=null,this._boundXhrOnLoad=null,"string"!=typeof t||"string"!=typeof e)throw new Error("Both name and url are required for constructing a resource.");i=i||{},this._flags=0,this._setFlag(sh.STATUS_FLAGS.DATA_URL,0===e.indexOf("data:")),this.name=t,this.url=e,this.extension=this._getExtension(),this.data=null,this.crossOrigin=!0===i.crossOrigin?"anonymous":i.crossOrigin,this.timeout=i.timeout||0,this.loadType=i.loadType||this._determineLoadType(),this.xhrType=i.xhrType,this.metadata=i.metadata||{},this.error=null,this.xhr=null,this.children=[],this.type=sh.TYPE.UNKNOWN,this.progressChunk=0,this._dequeue=th,this._onLoadBinding=null,this._elementTimer=0,this._boundComplete=this.complete.bind(this),this._boundOnError=this._onError.bind(this),this._boundOnProgress=this._onProgress.bind(this),this._boundOnTimeout=this._onTimeout.bind(this),this._boundXhrOnError=this._xhrOnError.bind(this),this._boundXhrOnTimeout=this._xhrOnTimeout.bind(this),this._boundXhrOnAbort=this._xhrOnAbort.bind(this),this._boundXhrOnLoad=this._xhrOnLoad.bind(this),this.onStart=new Xl,this.onProgress=new Xl,this.onComplete=new Xl,this.onAfterMiddleware=new Xl}nt.LoaderResource=(sh.setExtensionLoadType=function(t,e){eh(sh._loadTypeMap,t,e)},sh.setExtensionXhrType=function(t,e){eh(sh._xhrTypeMap,t,e)},Object.defineProperty(sh.prototype,"isDataUrl",{get:function(){return this._hasFlag(sh.STATUS_FLAGS.DATA_URL)},enumerable:!1,configurable:!0}),Object.defineProperty(sh.prototype,"isComplete",{get:function(){return this._hasFlag(sh.STATUS_FLAGS.COMPLETE)},enumerable:!1,configurable:!0}),Object.defineProperty(sh.prototype,"isLoading",{get:function(){return this._hasFlag(sh.STATUS_FLAGS.LOADING)},enumerable:!1,configurable:!0}),sh.prototype.complete=function(){this._clearEvents(),this._finish()},sh.prototype.abort=function(t){if(!this.error){if(this.error=new Error(t),this._clearEvents(),this.xhr)this.xhr.abort();else if(this.xdr)this.xdr.abort();else if(this.data)if(this.data.src)this.data.src=sh.EMPTY_GIF;else for(;this.data.firstChild;)this.data.removeChild(this.data.firstChild);this._finish()}},sh.prototype.load=function(t){var e=this;if(!this.isLoading)if(this.isComplete)t&&setTimeout(function(){return t(e)},1);else switch(t&&this.onComplete.once(t),this._setFlag(sh.STATUS_FLAGS.LOADING,!0),this.onStart.dispatch(this),!1!==this.crossOrigin&&"string"==typeof this.crossOrigin||(this.crossOrigin=this._determineCrossOrigin(this.url)),this.loadType){case sh.LOAD_TYPE.IMAGE:this.type=sh.TYPE.IMAGE,this._loadElement("image");break;case sh.LOAD_TYPE.AUDIO:this.type=sh.TYPE.AUDIO,this._loadSourceElement("audio");break;case sh.LOAD_TYPE.VIDEO:this.type=sh.TYPE.VIDEO,this._loadSourceElement("video");break;case sh.LOAD_TYPE.XHR:default:Jl&&this.crossOrigin?this._loadXdr():this._loadXhr()}},sh.prototype._hasFlag=function(t){return 0!=(this._flags&t)},sh.prototype._setFlag=function(t,e){this._flags=e?this._flags|t:this._flags&~t},sh.prototype._clearEvents=function(){clearTimeout(this._elementTimer),this.data&&this.data.removeEventListener&&(this.data.removeEventListener("error",this._boundOnError,!1),this.data.removeEventListener("load",this._boundComplete,!1),this.data.removeEventListener("progress",this._boundOnProgress,!1),this.data.removeEventListener("canplaythrough",this._boundComplete,!1)),this.xhr&&(this.xhr.removeEventListener?(this.xhr.removeEventListener("error",this._boundXhrOnError,!1),this.xhr.removeEventListener("timeout",this._boundXhrOnTimeout,!1),this.xhr.removeEventListener("abort",this._boundXhrOnAbort,!1),this.xhr.removeEventListener("progress",this._boundOnProgress,!1),this.xhr.removeEventListener("load",this._boundXhrOnLoad,!1)):(this.xhr.onerror=null,this.xhr.ontimeout=null,this.xhr.onprogress=null,this.xhr.onload=null))},sh.prototype._finish=function(){if(this.isComplete)throw new Error("Complete called again for an already completed resource.");this._setFlag(sh.STATUS_FLAGS.COMPLETE,!0),this._setFlag(sh.STATUS_FLAGS.LOADING,!1),this.onComplete.dispatch(this)},sh.prototype._loadElement=function(t){this.metadata.loadElement?this.data=this.metadata.loadElement:"image"===t&&void 0!==self.Image?this.data=new Image:this.data=document.createElement(t),this.crossOrigin&&(this.data.crossOrigin=this.crossOrigin),this.metadata.skipSource||(this.data.src=this.url),this.data.addEventListener("error",this._boundOnError,!1),this.data.addEventListener("load",this._boundComplete,!1),this.data.addEventListener("progress",this._boundOnProgress,!1),this.timeout&&(this._elementTimer=setTimeout(this._boundOnTimeout,this.timeout))},sh.prototype._loadSourceElement=function(t){if(this.metadata.loadElement?this.data=this.metadata.loadElement:"audio"===t&&void 0!==self.Audio?this.data=new Audio:this.data=document.createElement(t),null!==this.data){if(this.crossOrigin&&(this.data.crossOrigin=this.crossOrigin),!this.metadata.skipSource)if(navigator.isCocoonJS)this.data.src=Array.isArray(this.url)?this.url[0]:this.url;else if(Array.isArray(this.url))for(var e=this.metadata.mimeType,i=0;i<this.url.length;++i)this.data.appendChild(this._createSource(t,this.url[i],Array.isArray(e)?e[i]:e));else e=this.metadata.mimeType,this.data.appendChild(this._createSource(t,this.url,Array.isArray(e)?e[0]:e));this.data.addEventListener("error",this._boundOnError,!1),this.data.addEventListener("load",this._boundComplete,!1),this.data.addEventListener("progress",this._boundOnProgress,!1),this.data.addEventListener("canplaythrough",this._boundComplete,!1),this.data.load(),this.timeout&&(this._elementTimer=setTimeout(this._boundOnTimeout,this.timeout))}else this.abort("Unsupported element: "+t)},sh.prototype._loadXhr=function(){"string"!=typeof this.xhrType&&(this.xhrType=this._determineXhrType());var t=this.xhr=new XMLHttpRequest;t.open("GET",this.url,!0),t.timeout=this.timeout,this.xhrType===sh.XHR_RESPONSE_TYPE.JSON||this.xhrType===sh.XHR_RESPONSE_TYPE.DOCUMENT?t.responseType=sh.XHR_RESPONSE_TYPE.TEXT:t.responseType=this.xhrType,t.addEventListener("error",this._boundXhrOnError,!1),t.addEventListener("timeout",this._boundXhrOnTimeout,!1),t.addEventListener("abort",this._boundXhrOnAbort,!1),t.addEventListener("progress",this._boundOnProgress,!1),t.addEventListener("load",this._boundXhrOnLoad,!1),t.send()},sh.prototype._loadXdr=function(){"string"!=typeof this.xhrType&&(this.xhrType=this._determineXhrType());var t=this.xhr=new self.XDomainRequest;t.timeout=this.timeout||5e3,t.onerror=this._boundXhrOnError,t.ontimeout=this._boundXhrOnTimeout,t.onprogress=this._boundOnProgress,t.onload=this._boundXhrOnLoad,t.open("GET",this.url,!0),setTimeout(function(){return t.send()},1)},sh.prototype._createSource=function(t,e,i){i=i||t+"/"+this._getExtension(e);var n=document.createElement("source");return n.src=e,n.type=i,n},sh.prototype._onError=function(t){this.abort("Failed to load element using: "+t.target.nodeName)},sh.prototype._onProgress=function(t){t&&t.lengthComputable&&this.onProgress.dispatch(this,t.loaded/t.total)},sh.prototype._onTimeout=function(){this.abort("Load timed out.")},sh.prototype._xhrOnError=function(){var t=this.xhr;this.abort(ih(t)+" Request failed. Status: "+t.status+', text: "'+t.statusText+'"')},sh.prototype._xhrOnTimeout=function(){var t=this.xhr;this.abort(ih(t)+" Request timed out.")},sh.prototype._xhrOnAbort=function(){var t=this.xhr;this.abort(ih(t)+" Request was aborted by the user.")},sh.prototype._xhrOnLoad=function(){var t=this.xhr,e="",i=void 0===t.status?200:t.status;if(""!==t.responseType&&"text"!==t.responseType&&void 0!==t.responseType||(e=t.responseText),0===i&&(0<e.length||t.responseType===sh.XHR_RESPONSE_TYPE.BUFFER)?i=200:1223===i&&(i=204),2==(i/100|0)){if(this.xhrType===sh.XHR_RESPONSE_TYPE.TEXT)this.data=e,this.type=sh.TYPE.TEXT;else if(this.xhrType===sh.XHR_RESPONSE_TYPE.JSON)try{this.data=JSON.parse(e),this.type=sh.TYPE.JSON}catch(t){return void this.abort("Error trying to parse loaded json: "+t)}else if(this.xhrType===sh.XHR_RESPONSE_TYPE.DOCUMENT)try{if(self.DOMParser){var n=new DOMParser;this.data=n.parseFromString(e,"text/xml")}else{var r=document.createElement("div");r.innerHTML=e,this.data=r}this.type=sh.TYPE.XML}catch(t){return void this.abort("Error trying to parse loaded xml: "+t)}else this.data=t.response||e;this.complete()}else this.abort("["+t.status+"] "+t.statusText+": "+t.responseURL)},sh.prototype._determineCrossOrigin=function(t,e){if(0===t.indexOf("data:"))return"";if(self.origin!==self.location.origin)return"anonymous";e=e||self.location,(Zl=Zl||document.createElement("a")).href=t;var i=Vl(Zl.href,{strictMode:!0}),n=!i.port&&""===e.port||i.port===e.port,r=i.protocol?i.protocol+":":"";return i.host===e.hostname&&n&&r===e.protocol?"":"anonymous"},sh.prototype._determineXhrType=function(){return sh._xhrTypeMap[this.extension]||sh.XHR_RESPONSE_TYPE.TEXT},sh.prototype._determineLoadType=function(){return sh._loadTypeMap[this.extension]||sh.LOAD_TYPE.XHR},sh.prototype._getExtension=function(t){void 0===t&&(t=this.url);var e="";if(this.isDataUrl){var i=t.indexOf("/");e=t.substring(i+1,t.indexOf(";",i))}else{var n=t.indexOf("?"),r=t.indexOf("#"),s=Math.min(-1<n?n:t.length,-1<r?r:t.length);e=(t=t.substring(0,s)).substring(t.lastIndexOf(".")+1)}return e.toLowerCase()},sh.prototype._getMimeFromXhrType=function(t){switch(t){case sh.XHR_RESPONSE_TYPE.BUFFER:return"application/octet-binary";case sh.XHR_RESPONSE_TYPE.BLOB:return"application/blob";case sh.XHR_RESPONSE_TYPE.DOCUMENT:return"application/xml";case sh.XHR_RESPONSE_TYPE.JSON:return"application/json";case sh.XHR_RESPONSE_TYPE.DEFAULT:case sh.XHR_RESPONSE_TYPE.TEXT:default:return"text/plain"}},sh),Yl=nt.LoaderResource||(nt.LoaderResource={}),(Ql=Yl.STATUS_FLAGS||(Yl.STATUS_FLAGS={}))[Ql.NONE=0]="NONE",Ql[Ql.DATA_URL=1]="DATA_URL",Ql[Ql.COMPLETE=2]="COMPLETE",Ql[Ql.LOADING=4]="LOADING",($l=Yl.TYPE||(Yl.TYPE={}))[$l.UNKNOWN=0]="UNKNOWN",$l[$l.JSON=1]="JSON",$l[$l.XML=2]="XML",$l[$l.IMAGE=3]="IMAGE",$l[$l.AUDIO=4]="AUDIO",$l[$l.VIDEO=5]="VIDEO",$l[$l.TEXT=6]="TEXT",(Kl=Yl.LOAD_TYPE||(Yl.LOAD_TYPE={}))[Kl.XHR=1]="XHR",Kl[Kl.IMAGE=2]="IMAGE",Kl[Kl.AUDIO=3]="AUDIO",Kl[Kl.VIDEO=4]="VIDEO",(ql=Yl.XHR_RESPONSE_TYPE||(Yl.XHR_RESPONSE_TYPE={})).DEFAULT="text",ql.BUFFER="arraybuffer",ql.BLOB="blob",ql.DOCUMENT="document",ql.JSON="json",ql.TEXT="text",Yl._loadTypeMap={gif:Yl.LOAD_TYPE.IMAGE,png:Yl.LOAD_TYPE.IMAGE,bmp:Yl.LOAD_TYPE.IMAGE,jpg:Yl.LOAD_TYPE.IMAGE,jpeg:Yl.LOAD_TYPE.IMAGE,tif:Yl.LOAD_TYPE.IMAGE,tiff:Yl.LOAD_TYPE.IMAGE,webp:Yl.LOAD_TYPE.IMAGE,tga:Yl.LOAD_TYPE.IMAGE,svg:Yl.LOAD_TYPE.IMAGE,"svg+xml":Yl.LOAD_TYPE.IMAGE,mp3:Yl.LOAD_TYPE.AUDIO,ogg:Yl.LOAD_TYPE.AUDIO,wav:Yl.LOAD_TYPE.AUDIO,mp4:Yl.LOAD_TYPE.VIDEO,webm:Yl.LOAD_TYPE.VIDEO},Yl._xhrTypeMap={xhtml:Yl.XHR_RESPONSE_TYPE.DOCUMENT,html:Yl.XHR_RESPONSE_TYPE.DOCUMENT,htm:Yl.XHR_RESPONSE_TYPE.DOCUMENT,xml:Yl.XHR_RESPONSE_TYPE.DOCUMENT,tmx:Yl.XHR_RESPONSE_TYPE.DOCUMENT,svg:Yl.XHR_RESPONSE_TYPE.DOCUMENT,tsx:Yl.XHR_RESPONSE_TYPE.DOCUMENT,gif:Yl.XHR_RESPONSE_TYPE.BLOB,png:Yl.XHR_RESPONSE_TYPE.BLOB,bmp:Yl.XHR_RESPONSE_TYPE.BLOB,jpg:Yl.XHR_RESPONSE_TYPE.BLOB,jpeg:Yl.XHR_RESPONSE_TYPE.BLOB,tif:Yl.XHR_RESPONSE_TYPE.BLOB,tiff:Yl.XHR_RESPONSE_TYPE.BLOB,webp:Yl.XHR_RESPONSE_TYPE.BLOB,tga:Yl.XHR_RESPONSE_TYPE.BLOB,json:Yl.XHR_RESPONSE_TYPE.JSON,text:Yl.XHR_RESPONSE_TYPE.TEXT,txt:Yl.XHR_RESPONSE_TYPE.TEXT,ttf:Yl.XHR_RESPONSE_TYPE.BUFFER,otf:Yl.XHR_RESPONSE_TYPE.BUFFER},Yl.EMPTY_GIF="data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==";function oh(t,e){this.data=t,this.callback=e}var ah=(ch.prototype._next=function(n){var r=this;return function(){for(var t=arguments,e=[],i=0;i<arguments.length;i++)e[i]=t[i];r.workers-=1,n.callback.apply(n,e),null!=e[0]&&r.error(e[0],n.data),r.workers<=r.concurrency-r.buffer&&r.unsaturated(),r.idle()&&r.drain(),r.process()}},ch.prototype.push=function(t,e){this._insert(t,!1,e)},ch.prototype.kill=function(){this.workers=0,this.drain=nh,this.started=!1,this._tasks=[]},ch.prototype.unshift=function(t,e){this._insert(t,!0,e)},ch.prototype.length=function(){return this._tasks.length},ch.prototype.running=function(){return this.workers},ch.prototype.idle=function(){return this._tasks.length+this.workers===0},ch.prototype.pause=function(){!0!==this.paused&&(this.paused=!0)},ch.prototype.resume=function(){if(!1!==this.paused){this.paused=!1;for(var t=1;t<=this.concurrency;t++)this.process()}},ch.eachSeries=function(i,n,r,s){var o=0,a=i.length;!function t(e){e||o===a?r&&r(e):s?setTimeout(function(){n(i[o++],t)},1):n(i[o++],t)}()},ch.queue=function(t,e){return new ch(t,e)},ch),lh=/(#[\w-]+)?$/,hh=(uh.prototype._add=function(t,e,i,n){if(this.loading&&(!i||!i.parentResource))throw new Error("Cannot add resources while the loader is running.");if(this.resources[t])throw new Error('Resource named "'+t+'" already exists.');if(e=this._prepareUrl(e),this.resources[t]=new nt.LoaderResource(t,e,i),"function"==typeof n&&this.resources[t].onAfterMiddleware.once(n),this.loading){for(var r=i.parentResource,s=[],o=0;o<r.children.length;++o)r.children[o].isComplete||s.push(r.children[o]);var a=r.progressChunk*(s.length+1)/(s.length+2);for(r.children.push(this.resources[t]),r.progressChunk=a,o=0;o<s.length;++o)s[o].progressChunk=a;this.resources[t].progressChunk=a}return this._queue.push(this.resources[t]),this},uh.prototype.pre=function(t){return this._beforeMiddleware.push(t),this},uh.prototype.use=function(t){return this._afterMiddleware.push(t),this},uh.prototype.reset=function(){for(var t in this.progress=0,this.loading=!1,this._queue.kill(),this._queue.pause(),this.resources){var e=this.resources[t];e._onLoadBinding&&e._onLoadBinding.detach(),e.isLoading&&e.abort("loader reset")}return this.resources={},this},uh.prototype.load=function(t){if("function"==typeof t&&this.onComplete.once(t),this.loading)return this;if(this._queue.idle())this._onStart(),this._onComplete();else{for(var e=100/this._queue._tasks.length,i=0;i<this._queue._tasks.length;++i)this._queue._tasks[i].data.progressChunk=e;this._onStart(),this._queue.resume()}return this},Object.defineProperty(uh.prototype,"concurrency",{get:function(){return this._queue.concurrency},set:function(t){this._queue.concurrency=t},enumerable:!1,configurable:!0}),uh.prototype._prepareUrl=function(t){var e,i=Vl(t,{strictMode:!0});if(e=i.protocol||!i.path||0===t.indexOf("//")?t:this.baseUrl.length&&this.baseUrl.lastIndexOf("/")!==this.baseUrl.length-1&&"/"!==t.charAt(0)?this.baseUrl+"/"+t:this.baseUrl+t,this.defaultQueryString){var n=lh.exec(e)[0];-1!==(e=e.substr(0,e.length-n.length)).indexOf("?")?e+="&"+this.defaultQueryString:e+="?"+this.defaultQueryString,e+=n}return e},uh.prototype._loadResource=function(i,t){var n=this;i._dequeue=t,ah.eachSeries(this._beforeMiddleware,function(t,e){t.call(n,i,function(){e(i.isComplete?{}:null)})},function(){i.isComplete?n._onLoad(i):(i._onLoadBinding=i.onComplete.once(n._onLoad,n),i.load())},!0)},uh.prototype._onStart=function(){this.progress=0,this.loading=!0,this.onStart.dispatch(this)},uh.prototype._onComplete=function(){this.progress=100,this.loading=!1,this.onComplete.dispatch(this,this.resources)},uh.prototype._onLoad=function(i){var n=this;i._onLoadBinding=null,this._resourcesParsing.push(i),i._dequeue(),ah.eachSeries(this._afterMiddleware,function(t,e){t.call(n,i,e)},function(){i.onAfterMiddleware.dispatch(i),n.progress=Math.min(100,n.progress+i.progressChunk),n.onProgress.dispatch(n,i),i.error?n.onError.dispatch(i.error,n,i):n.onLoad.dispatch(n,i),n._resourcesParsing.splice(n._resourcesParsing.indexOf(i),1),n._queue.idle()&&0===n._resourcesParsing.length&&n._onComplete()},!0)},uh.prototype.destroy=function(){this._protected||this.reset()},Object.defineProperty(uh,"shared",{get:function(){var t=uh._shared;return t||((t=new uh)._protected=!0,uh._shared=t),t},enumerable:!1,configurable:!0}),uh.registerPlugin=function(t){return uh._plugins.push(t),t.add&&t.add(),uh},uh._plugins=[],uh);function uh(t,e){var i=this;void 0===t&&(t=""),void 0===e&&(e=10),this._beforeMiddleware=[],this._afterMiddleware=[],this._resourcesParsing=[],this._boundLoadResource=function(t,e){return i._loadResource(t,e)},this.resources={},this.baseUrl=t,this.progress=0,this.loading=!1,this.defaultQueryString="",this._beforeMiddleware=[],this._afterMiddleware=[],this._resourcesParsing=[],this._boundLoadResource=function(t,e){return i._loadResource(t,e)},this._queue=ah.queue(this._boundLoadResource,e),this._queue.pause(),this.resources={},this.onProgress=new Xl,this.onError=new Xl,this.onLoad=new Xl,this.onStart=new Xl,this.onComplete=new Xl;for(var n=0;n<uh._plugins.length;++n){var r=uh._plugins[n],s=r.pre,o=r.use;s&&this.pre(s),o&&this.use(o)}this._protected=!1}function ch(t,e){var r=this;if(void 0===e&&(e=1),this.workers=0,this.saturated=nh,this.unsaturated=nh,this.empty=nh,this.drain=nh,this.error=nh,this.started=!1,this.paused=!1,this._tasks=[],this._insert=function(t,e,i){if(i&&"function"!=typeof i)throw new Error("task callback must be a function");if(r.started=!0,null==t&&r.idle())setTimeout(function(){return r.drain()},1);else{var n=new oh(t,"function"==typeof i?i:nh);e?r._tasks.unshift(n):r._tasks.push(n),setTimeout(r.process,1)}},this.process=function(){for(;!r.paused&&r.workers<r.concurrency&&r._tasks.length;){var t=r._tasks.shift();0===r._tasks.length&&r.empty(),r.workers+=1,r.workers===r.concurrency&&r.saturated(),r._worker(t.data,rh(r._next(t)))}},this._worker=t,0===e)throw new Error("Concurrency must not be zero");this.concurrency=e,this.buffer=e/4}hh.prototype.add=function(t,e,i,n){if(Array.isArray(t)){for(var r=0;r<t.length;++r)this.add(t[r]);return this}if("object"==typeof t&&(i=t,n=e||i.callback||i.onComplete,e=i.url,t=i.name||i.key||i.url),"string"!=typeof e&&(n=i,i=e,e=t),"string"!=typeof e)throw new Error("No url passed to add resource to loader.");return"function"==typeof i&&(n=i,i=null),this._add(t,e,i,n)};var dh,ph,fh=(_h.init=function(t){t=Object.assign({sharedLoader:!1},t),this.loader=t.sharedLoader?hh.shared:new hh},_h.destroy=function(){this.loader&&(this.loader.destroy(),this.loader=null)},_h),gh=(yh.add=function(){nt.LoaderResource.setExtensionLoadType("svg",nt.LoaderResource.LOAD_TYPE.XHR),nt.LoaderResource.setExtensionXhrType("svg",nt.LoaderResource.XHR_RESPONSE_TYPE.TEXT)},yh.use=function(e,i){if(!e.data||e.type!==nt.LoaderResource.TYPE.IMAGE&&"svg"!==e.extension)i();else{var t=e.data,n=e.url,r=e.name,s=e.metadata;Cs.fromLoader(t,n,r,s).then(function(t){e.texture=t,i()}).catch(i)}},yh),mh=self.URL||self.webkitURL;function yh(){}function _h(){}hh.registerPlugin({use:function(t,e){if(t.data){if(t.xhr&&t.xhrType===nt.LoaderResource.XHR_RESPONSE_TYPE.BLOB)if(self.Blob&&"string"!=typeof t.data){if(0===t.data.type.indexOf("image")){var i=mh.createObjectURL(t.data);return t.blob=t.data,t.data=new Image,t.data.src=i,t.type=nt.LoaderResource.TYPE.IMAGE,void(t.data.onload=function(){mh.revokeObjectURL(i),t.data.onload=null,e()})}}else{var n=t.xhr.getResponseHeader("content-type");if(n&&0===n.indexOf("image"))return t.data=new Image,t.data.src="data:"+n+";base64,"+function(t){for(var e="",i=0;i<t.length;){for(var n=[0,0,0],r=[0,0,0,0],s=0;s<n.length;++s)i<t.length?n[s]=255&t.charCodeAt(i++):n[s]=0;switch(r[0]=n[0]>>2,r[1]=(3&n[0])<<4|n[1]>>4,r[2]=(15&n[1])<<2|n[2]>>6,r[3]=63&n[2],i-(t.length-1)){case 2:r[3]=64,r[2]=64;break;case 1:r[3]=64}for(s=0;s<r.length;++s)e+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(r[s])}return e}(t.xhr.responseText),t.type=nt.LoaderResource.TYPE.IMAGE,void(t.data.onload=function(){t.data.onload=null,e()})}e()}else e()}}),hh.registerPlugin(gh),(ph=nt.INTERNAL_FORMATS||(nt.INTERNAL_FORMATS={}))[ph.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",ph[ph.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",ph[ph.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",ph[ph.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",ph[ph.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=35917]="COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT",ph[ph.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT=35918]="COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT",ph[ph.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=35919]="COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT",ph[ph.COMPRESSED_SRGB_S3TC_DXT1_EXT=35916]="COMPRESSED_SRGB_S3TC_DXT1_EXT",ph[ph.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",ph[ph.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",ph[ph.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",ph[ph.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",ph[ph.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",ph[ph.COMPRESSED_RGBA8_ETC2_EAC=37496]="COMPRESSED_RGBA8_ETC2_EAC",ph[ph.COMPRESSED_SRGB8_ETC2=37493]="COMPRESSED_SRGB8_ETC2",ph[ph.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37497]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC",ph[ph.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37494]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",ph[ph.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37495]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",ph[ph.COMPRESSED_RGB_PVRTC_4BPPV1_IMG=35840]="COMPRESSED_RGB_PVRTC_4BPPV1_IMG",ph[ph.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG=35842]="COMPRESSED_RGBA_PVRTC_4BPPV1_IMG",ph[ph.COMPRESSED_RGB_PVRTC_2BPPV1_IMG=35841]="COMPRESSED_RGB_PVRTC_2BPPV1_IMG",ph[ph.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG=35843]="COMPRESSED_RGBA_PVRTC_2BPPV1_IMG",ph[ph.COMPRESSED_RGB_ETC1_WEBGL=36196]="COMPRESSED_RGB_ETC1_WEBGL",ph[ph.COMPRESSED_RGB_ATC_WEBGL=35986]="COMPRESSED_RGB_ATC_WEBGL",ph[ph.COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL=35986]="COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL",ph[ph.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL=34798]="COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL";var vh=((dh={})[nt.INTERNAL_FORMATS.COMPRESSED_RGB_S3TC_DXT1_EXT]=.5,dh[nt.INTERNAL_FORMATS.COMPRESSED_RGBA_S3TC_DXT1_EXT]=.5,dh[nt.INTERNAL_FORMATS.COMPRESSED_RGBA_S3TC_DXT3_EXT]=1,dh[nt.INTERNAL_FORMATS.COMPRESSED_RGBA_S3TC_DXT5_EXT]=1,dh[nt.INTERNAL_FORMATS.COMPRESSED_SRGB_S3TC_DXT1_EXT]=.5,dh[nt.INTERNAL_FORMATS.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT]=.5,dh[nt.INTERNAL_FORMATS.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT]=1,dh[nt.INTERNAL_FORMATS.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT]=1,dh[nt.INTERNAL_FORMATS.COMPRESSED_R11_EAC]=.5,dh[nt.INTERNAL_FORMATS.COMPRESSED_SIGNED_R11_EAC]=.5,dh[nt.INTERNAL_FORMATS.COMPRESSED_RG11_EAC]=1,dh[nt.INTERNAL_FORMATS.COMPRESSED_SIGNED_RG11_EAC]=1,dh[nt.INTERNAL_FORMATS.COMPRESSED_RGB8_ETC2]=.5,dh[nt.INTERNAL_FORMATS.COMPRESSED_RGBA8_ETC2_EAC]=1,dh[nt.INTERNAL_FORMATS.COMPRESSED_SRGB8_ETC2]=.5,dh[nt.INTERNAL_FORMATS.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC]=1,dh[nt.INTERNAL_FORMATS.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2]=.5,dh[nt.INTERNAL_FORMATS.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2]=.5,dh[nt.INTERNAL_FORMATS.COMPRESSED_RGB_PVRTC_4BPPV1_IMG]=.5,dh[nt.INTERNAL_FORMATS.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG]=.5,dh[nt.INTERNAL_FORMATS.COMPRESSED_RGB_PVRTC_2BPPV1_IMG]=.25,dh[nt.INTERNAL_FORMATS.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG]=.25,dh[nt.INTERNAL_FORMATS.COMPRESSED_RGB_ETC1_WEBGL]=.5,dh[nt.INTERNAL_FORMATS.COMPRESSED_RGB_ATC_WEBGL]=.5,dh[nt.INTERNAL_FORMATS.COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL]=1,dh[nt.INTERNAL_FORMATS.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL]=1,dh),bh=function(t,e){return(bh=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)};function wh(t,e){function i(){this.constructor=t}bh(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}var Sh,xh,Th,Ih,Ph,Ch,Eh,Ah,Mh=(wh(Dh,Ih=qr),Dh.prototype.onBlobLoaded=function(t){},Dh.prototype.load=function(){return s=this,o=Promise,a=function(){var e,i,n,r,s,o,t,a;return i=this,n=function(t){switch(t.label){case 0:return[4,fetch(this.origin)];case 1:return[4,t.sent().blob()];case 2:return[4,t.sent().arrayBuffer()];case 3:return e=t.sent(),this.data=new Uint32Array(e),this.buffer=new gl(e),this.loaded=!0,this.onBlobLoaded(e),this.update(),[2,this]}},a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},t={next:l(0),throw:l(1),return:l(2)},"function"==typeof Symbol&&(t[Symbol.iterator]=function(){return this}),t;function l(e){return function(t){return function(e){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,s&&(o=2&e[0]?s.return:e[0]?s.throw||((o=s.return)&&o.call(s),0):s.next)&&!(o=o.call(s,e[1])).done)return o;switch(s=0,o&&(e=[2&e[0],o.value]),e[0]){case 0:case 1:o=e;break;case 4:return a.label++,{value:e[1],done:!1};case 5:a.label++,s=e[1],e=[0];continue;case 7:e=a.ops.pop(),a.trys.pop();continue;default:if(!(o=0<(o=a.trys).length&&o[o.length-1])&&(6===e[0]||2===e[0])){a=0;continue}if(3===e[0]&&(!o||e[1]>o[0]&&e[1]<o[3])){a.label=e[1];break}if(6===e[0]&&a.label<o[1]){a.label=o[1],o=e;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(e);break}o[2]&&a.ops.pop(),a.trys.pop();continue}e=n.call(i,a)}catch(t){e=[6,t],s=0}finally{r=o=0}if(5&e[0])throw e[1];return{value:e[0]?e[1]:void 0,done:!0}}([e,t])}}},new(o=o||Promise)(function(t,e){function i(t){try{r(a.next(t))}catch(t){e(t)}}function n(t){try{r(a.throw(t))}catch(t){e(t)}}function r(e){e.done?t(e.value):new o(function(t){t(e.value)}).then(i,n)}r((a=a.apply(s,[])).next())});var s,o,a},Dh),Bh=(wh(kh,Th=Mh),kh.prototype.upload=function(t,e,i){var n=t.gl;if(!t.context.extensions[this._extension])throw new Error(this._extension+" textures are not supported on the current machine");if(!this._levelBuffers)return!1;for(var r=0,s=this.levels;r<s;r++){var o=this._levelBuffers[r],a=o.levelID,l=o.levelWidth,h=o.levelHeight,u=o.levelBuffer;n.compressedTexImage2D(n.TEXTURE_2D,a,this.format,l,h,0,u)}return!0},kh.prototype.onBlobLoaded=function(){this._levelBuffers=kh._createLevelBuffers(this.buffer.uint8View,this.format,this.levels,4,4,this.width,this.height)},kh._formatToExtension=function(t){if(33776<=t&&t<=33779)return"s3tc";if(37488<=t&&t<=37497)return"etc";if(35840<=t&&t<=35843)return"pvrtc";if(36196<=t)return"etc1";if(35986<=t&&t<=34798)return"atc";throw new Error("Invalid (compressed) texture format given!")},kh._createLevelBuffers=function(t,e,i,n,r,s,o){for(var a=new Array(i),l=t.byteOffset,h=s,u=o,c=h+n-1&~(n-1),d=u+r-1&~(r-1),p=c*d*vh[e],f=0;f<i;f++)a[f]={levelID:f,levelWidth:1<i?h:c,levelHeight:1<i?u:d,levelBuffer:new Uint8Array(t.buffer,l,p)},l+=p,p=(c=(h=h>>1||1)+n-1&~(n-1))*(d=(u=u>>1||1)+r-1&~(r-1))*vh[e];return a},kh),Rh=(Oh.use=function(s,o){var t=s.data;if(s.type===nt.LoaderResource.TYPE.JSON&&t&&t.cacheID&&t.textures){for(var e=t.textures,i=void 0,n=void 0,r=0,a=e.length;r<a;r++){var l=e[r],h=l.src,u=l.format;if(u||(n=h),Oh.textureFormats[u]){i=h;break}}if(!(i=i||n))return void o(new Error("Cannot load compressed-textures in "+s.url+", make sure you provide a fallback"));if(i===s.url)return void o(new Error("URL of compressed texture cannot be the same as the manifest's URL"));var c={crossOrigin:s.crossOrigin,metadata:s.metadata.imageMetadata,parentResource:s},d=He.resolve(s.url.replace(this.baseUrl,""),i),p=t.cacheID;this.add(p,d,c,function(t){if(t.error)o(t.error);else{var e=t.texture,i=void 0===e?null:e,n=t.textures,r=void 0===n?{}:n;Object.assign(s,{texture:i,textures:r}),o()}})}else o()},Oh.add=function(){var t=document.createElement("canvas").getContext("webgl");if(t){var e={s3tc:t.getExtension("WEBGL_compressed_texture_s3tc"),s3tc_sRGB:t.getExtension("WEBGL_compressed_texture_s3tc_srgb"),etc:t.getExtension("WEBGL_compressed_texture_etc"),etc1:t.getExtension("WEBGL_compressed_texture_etc1"),pvrtc:t.getExtension("WEBGL_compressed_texture_pvrtc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),atc:t.getExtension("WEBGL_compressed_texture_atc"),astc:t.getExtension("WEBGL_compressed_texture_astc")};for(var i in Oh.textureExtensions=e,Oh.textureFormats={},e){var n=e[i];n&&Object.assign(Oh.textureFormats,Object.getPrototypeOf(n))}}},Oh);function Oh(){}function kh(t,e){var i=Th.call(this,t,e)||this;return i.format=e.format,i.levels=e.levels||1,i._width=e.width,i._height=e.height,i._extension=kh._formatToExtension(i.format),(e.levelBuffers||i.buffer)&&(i._levelBuffers=e.levelBuffers||kh._createLevelBuffers(t instanceof Uint8Array?t:i.buffer.uint8View,i.format,i.levels,4,4,i.width,i.height)),i}function Dh(t,e){void 0===e&&(e={width:1,height:1,autoLoad:!0});var i,n,r=this;return n="string"==typeof t?(i=t,new Uint8Array):(i=null,t),(r=Ih.call(this,n,e)||this).origin=i,r.buffer=n?new gl(n):null,r.origin&&!1!==e.autoLoad&&r.load(),n&&n.length&&(r.loaded=!0,r.onBlobLoaded(r.buffer.rawBinaryData)),r}function Fh(r,t,e){var s={textures:{},texture:null};return t&&t.map(function(t){return new Cs(new $r(t,Object.assign({mipmap:nt.MIPMAP_MODES.OFF,alphaMode:nt.ALPHA_MODES.NO_PREMULTIPLIED_ALPHA},e)))}).forEach(function(t,e){var i=t.baseTexture,n=r+"-"+(e+1);$r.addToCache(i,n),Cs.addToCache(t,n),0===e&&($r.addToCache(i,r),Cs.addToCache(t,r),s.texture=t),s.textures[n]=t}),s}nt.LoaderResource.setExtensionXhrType("dds",nt.LoaderResource.XHR_RESPONSE_TYPE.BUFFER),(Ah=Ph=Ph||{})[Ah.DXGI_FORMAT_UNKNOWN=0]="DXGI_FORMAT_UNKNOWN",Ah[Ah.DXGI_FORMAT_R32G32B32A32_TYPELESS=1]="DXGI_FORMAT_R32G32B32A32_TYPELESS",Ah[Ah.DXGI_FORMAT_R32G32B32A32_FLOAT=2]="DXGI_FORMAT_R32G32B32A32_FLOAT",Ah[Ah.DXGI_FORMAT_R32G32B32A32_UINT=3]="DXGI_FORMAT_R32G32B32A32_UINT",Ah[Ah.DXGI_FORMAT_R32G32B32A32_SINT=4]="DXGI_FORMAT_R32G32B32A32_SINT",Ah[Ah.DXGI_FORMAT_R32G32B32_TYPELESS=5]="DXGI_FORMAT_R32G32B32_TYPELESS",Ah[Ah.DXGI_FORMAT_R32G32B32_FLOAT=6]="DXGI_FORMAT_R32G32B32_FLOAT",Ah[Ah.DXGI_FORMAT_R32G32B32_UINT=7]="DXGI_FORMAT_R32G32B32_UINT",Ah[Ah.DXGI_FORMAT_R32G32B32_SINT=8]="DXGI_FORMAT_R32G32B32_SINT",Ah[Ah.DXGI_FORMAT_R16G16B16A16_TYPELESS=9]="DXGI_FORMAT_R16G16B16A16_TYPELESS",Ah[Ah.DXGI_FORMAT_R16G16B16A16_FLOAT=10]="DXGI_FORMAT_R16G16B16A16_FLOAT",Ah[Ah.DXGI_FORMAT_R16G16B16A16_UNORM=11]="DXGI_FORMAT_R16G16B16A16_UNORM",Ah[Ah.DXGI_FORMAT_R16G16B16A16_UINT=12]="DXGI_FORMAT_R16G16B16A16_UINT",Ah[Ah.DXGI_FORMAT_R16G16B16A16_SNORM=13]="DXGI_FORMAT_R16G16B16A16_SNORM",Ah[Ah.DXGI_FORMAT_R16G16B16A16_SINT=14]="DXGI_FORMAT_R16G16B16A16_SINT",Ah[Ah.DXGI_FORMAT_R32G32_TYPELESS=15]="DXGI_FORMAT_R32G32_TYPELESS",Ah[Ah.DXGI_FORMAT_R32G32_FLOAT=16]="DXGI_FORMAT_R32G32_FLOAT",Ah[Ah.DXGI_FORMAT_R32G32_UINT=17]="DXGI_FORMAT_R32G32_UINT",Ah[Ah.DXGI_FORMAT_R32G32_SINT=18]="DXGI_FORMAT_R32G32_SINT",Ah[Ah.DXGI_FORMAT_R32G8X24_TYPELESS=19]="DXGI_FORMAT_R32G8X24_TYPELESS",Ah[Ah.DXGI_FORMAT_D32_FLOAT_S8X24_UINT=20]="DXGI_FORMAT_D32_FLOAT_S8X24_UINT",Ah[Ah.DXGI_FORMAT_R32_FLOAT_X8X24_TYPELESS=21]="DXGI_FORMAT_R32_FLOAT_X8X24_TYPELESS",Ah[Ah.DXGI_FORMAT_X32_TYPELESS_G8X24_UINT=22]="DXGI_FORMAT_X32_TYPELESS_G8X24_UINT",Ah[Ah.DXGI_FORMAT_R10G10B10A2_TYPELESS=23]="DXGI_FORMAT_R10G10B10A2_TYPELESS",Ah[Ah.DXGI_FORMAT_R10G10B10A2_UNORM=24]="DXGI_FORMAT_R10G10B10A2_UNORM",Ah[Ah.DXGI_FORMAT_R10G10B10A2_UINT=25]="DXGI_FORMAT_R10G10B10A2_UINT",Ah[Ah.DXGI_FORMAT_R11G11B10_FLOAT=26]="DXGI_FORMAT_R11G11B10_FLOAT",Ah[Ah.DXGI_FORMAT_R8G8B8A8_TYPELESS=27]="DXGI_FORMAT_R8G8B8A8_TYPELESS",Ah[Ah.DXGI_FORMAT_R8G8B8A8_UNORM=28]="DXGI_FORMAT_R8G8B8A8_UNORM",Ah[Ah.DXGI_FORMAT_R8G8B8A8_UNORM_SRGB=29]="DXGI_FORMAT_R8G8B8A8_UNORM_SRGB",Ah[Ah.DXGI_FORMAT_R8G8B8A8_UINT=30]="DXGI_FORMAT_R8G8B8A8_UINT",Ah[Ah.DXGI_FORMAT_R8G8B8A8_SNORM=31]="DXGI_FORMAT_R8G8B8A8_SNORM",Ah[Ah.DXGI_FORMAT_R8G8B8A8_SINT=32]="DXGI_FORMAT_R8G8B8A8_SINT",Ah[Ah.DXGI_FORMAT_R16G16_TYPELESS=33]="DXGI_FORMAT_R16G16_TYPELESS",Ah[Ah.DXGI_FORMAT_R16G16_FLOAT=34]="DXGI_FORMAT_R16G16_FLOAT",Ah[Ah.DXGI_FORMAT_R16G16_UNORM=35]="DXGI_FORMAT_R16G16_UNORM",Ah[Ah.DXGI_FORMAT_R16G16_UINT=36]="DXGI_FORMAT_R16G16_UINT",Ah[Ah.DXGI_FORMAT_R16G16_SNORM=37]="DXGI_FORMAT_R16G16_SNORM",Ah[Ah.DXGI_FORMAT_R16G16_SINT=38]="DXGI_FORMAT_R16G16_SINT",Ah[Ah.DXGI_FORMAT_R32_TYPELESS=39]="DXGI_FORMAT_R32_TYPELESS",Ah[Ah.DXGI_FORMAT_D32_FLOAT=40]="DXGI_FORMAT_D32_FLOAT",Ah[Ah.DXGI_FORMAT_R32_FLOAT=41]="DXGI_FORMAT_R32_FLOAT",Ah[Ah.DXGI_FORMAT_R32_UINT=42]="DXGI_FORMAT_R32_UINT",Ah[Ah.DXGI_FORMAT_R32_SINT=43]="DXGI_FORMAT_R32_SINT",Ah[Ah.DXGI_FORMAT_R24G8_TYPELESS=44]="DXGI_FORMAT_R24G8_TYPELESS",Ah[Ah.DXGI_FORMAT_D24_UNORM_S8_UINT=45]="DXGI_FORMAT_D24_UNORM_S8_UINT",Ah[Ah.DXGI_FORMAT_R24_UNORM_X8_TYPELESS=46]="DXGI_FORMAT_R24_UNORM_X8_TYPELESS",Ah[Ah.DXGI_FORMAT_X24_TYPELESS_G8_UINT=47]="DXGI_FORMAT_X24_TYPELESS_G8_UINT",Ah[Ah.DXGI_FORMAT_R8G8_TYPELESS=48]="DXGI_FORMAT_R8G8_TYPELESS",Ah[Ah.DXGI_FORMAT_R8G8_UNORM=49]="DXGI_FORMAT_R8G8_UNORM",Ah[Ah.DXGI_FORMAT_R8G8_UINT=50]="DXGI_FORMAT_R8G8_UINT",Ah[Ah.DXGI_FORMAT_R8G8_SNORM=51]="DXGI_FORMAT_R8G8_SNORM",Ah[Ah.DXGI_FORMAT_R8G8_SINT=52]="DXGI_FORMAT_R8G8_SINT",Ah[Ah.DXGI_FORMAT_R16_TYPELESS=53]="DXGI_FORMAT_R16_TYPELESS",Ah[Ah.DXGI_FORMAT_R16_FLOAT=54]="DXGI_FORMAT_R16_FLOAT",Ah[Ah.DXGI_FORMAT_D16_UNORM=55]="DXGI_FORMAT_D16_UNORM",Ah[Ah.DXGI_FORMAT_R16_UNORM=56]="DXGI_FORMAT_R16_UNORM",Ah[Ah.DXGI_FORMAT_R16_UINT=57]="DXGI_FORMAT_R16_UINT",Ah[Ah.DXGI_FORMAT_R16_SNORM=58]="DXGI_FORMAT_R16_SNORM",Ah[Ah.DXGI_FORMAT_R16_SINT=59]="DXGI_FORMAT_R16_SINT",Ah[Ah.DXGI_FORMAT_R8_TYPELESS=60]="DXGI_FORMAT_R8_TYPELESS",Ah[Ah.DXGI_FORMAT_R8_UNORM=61]="DXGI_FORMAT_R8_UNORM",Ah[Ah.DXGI_FORMAT_R8_UINT=62]="DXGI_FORMAT_R8_UINT",Ah[Ah.DXGI_FORMAT_R8_SNORM=63]="DXGI_FORMAT_R8_SNORM",Ah[Ah.DXGI_FORMAT_R8_SINT=64]="DXGI_FORMAT_R8_SINT",Ah[Ah.DXGI_FORMAT_A8_UNORM=65]="DXGI_FORMAT_A8_UNORM",Ah[Ah.DXGI_FORMAT_R1_UNORM=66]="DXGI_FORMAT_R1_UNORM",Ah[Ah.DXGI_FORMAT_R9G9B9E5_SHAREDEXP=67]="DXGI_FORMAT_R9G9B9E5_SHAREDEXP",Ah[Ah.DXGI_FORMAT_R8G8_B8G8_UNORM=68]="DXGI_FORMAT_R8G8_B8G8_UNORM",Ah[Ah.DXGI_FORMAT_G8R8_G8B8_UNORM=69]="DXGI_FORMAT_G8R8_G8B8_UNORM",Ah[Ah.DXGI_FORMAT_BC1_TYPELESS=70]="DXGI_FORMAT_BC1_TYPELESS",Ah[Ah.DXGI_FORMAT_BC1_UNORM=71]="DXGI_FORMAT_BC1_UNORM",Ah[Ah.DXGI_FORMAT_BC1_UNORM_SRGB=72]="DXGI_FORMAT_BC1_UNORM_SRGB",Ah[Ah.DXGI_FORMAT_BC2_TYPELESS=73]="DXGI_FORMAT_BC2_TYPELESS",Ah[Ah.DXGI_FORMAT_BC2_UNORM=74]="DXGI_FORMAT_BC2_UNORM",Ah[Ah.DXGI_FORMAT_BC2_UNORM_SRGB=75]="DXGI_FORMAT_BC2_UNORM_SRGB",Ah[Ah.DXGI_FORMAT_BC3_TYPELESS=76]="DXGI_FORMAT_BC3_TYPELESS",Ah[Ah.DXGI_FORMAT_BC3_UNORM=77]="DXGI_FORMAT_BC3_UNORM",Ah[Ah.DXGI_FORMAT_BC3_UNORM_SRGB=78]="DXGI_FORMAT_BC3_UNORM_SRGB",Ah[Ah.DXGI_FORMAT_BC4_TYPELESS=79]="DXGI_FORMAT_BC4_TYPELESS",Ah[Ah.DXGI_FORMAT_BC4_UNORM=80]="DXGI_FORMAT_BC4_UNORM",Ah[Ah.DXGI_FORMAT_BC4_SNORM=81]="DXGI_FORMAT_BC4_SNORM",Ah[Ah.DXGI_FORMAT_BC5_TYPELESS=82]="DXGI_FORMAT_BC5_TYPELESS",Ah[Ah.DXGI_FORMAT_BC5_UNORM=83]="DXGI_FORMAT_BC5_UNORM",Ah[Ah.DXGI_FORMAT_BC5_SNORM=84]="DXGI_FORMAT_BC5_SNORM",Ah[Ah.DXGI_FORMAT_B5G6R5_UNORM=85]="DXGI_FORMAT_B5G6R5_UNORM",Ah[Ah.DXGI_FORMAT_B5G5R5A1_UNORM=86]="DXGI_FORMAT_B5G5R5A1_UNORM",Ah[Ah.DXGI_FORMAT_B8G8R8A8_UNORM=87]="DXGI_FORMAT_B8G8R8A8_UNORM",Ah[Ah.DXGI_FORMAT_B8G8R8X8_UNORM=88]="DXGI_FORMAT_B8G8R8X8_UNORM",Ah[Ah.DXGI_FORMAT_R10G10B10_XR_BIAS_A2_UNORM=89]="DXGI_FORMAT_R10G10B10_XR_BIAS_A2_UNORM",Ah[Ah.DXGI_FORMAT_B8G8R8A8_TYPELESS=90]="DXGI_FORMAT_B8G8R8A8_TYPELESS",Ah[Ah.DXGI_FORMAT_B8G8R8A8_UNORM_SRGB=91]="DXGI_FORMAT_B8G8R8A8_UNORM_SRGB",Ah[Ah.DXGI_FORMAT_B8G8R8X8_TYPELESS=92]="DXGI_FORMAT_B8G8R8X8_TYPELESS",Ah[Ah.DXGI_FORMAT_B8G8R8X8_UNORM_SRGB=93]="DXGI_FORMAT_B8G8R8X8_UNORM_SRGB",Ah[Ah.DXGI_FORMAT_BC6H_TYPELESS=94]="DXGI_FORMAT_BC6H_TYPELESS",Ah[Ah.DXGI_FORMAT_BC6H_UF16=95]="DXGI_FORMAT_BC6H_UF16",Ah[Ah.DXGI_FORMAT_BC6H_SF16=96]="DXGI_FORMAT_BC6H_SF16",Ah[Ah.DXGI_FORMAT_BC7_TYPELESS=97]="DXGI_FORMAT_BC7_TYPELESS",Ah[Ah.DXGI_FORMAT_BC7_UNORM=98]="DXGI_FORMAT_BC7_UNORM",Ah[Ah.DXGI_FORMAT_BC7_UNORM_SRGB=99]="DXGI_FORMAT_BC7_UNORM_SRGB",Ah[Ah.DXGI_FORMAT_AYUV=100]="DXGI_FORMAT_AYUV",Ah[Ah.DXGI_FORMAT_Y410=101]="DXGI_FORMAT_Y410",Ah[Ah.DXGI_FORMAT_Y416=102]="DXGI_FORMAT_Y416",Ah[Ah.DXGI_FORMAT_NV12=103]="DXGI_FORMAT_NV12",Ah[Ah.DXGI_FORMAT_P010=104]="DXGI_FORMAT_P010",Ah[Ah.DXGI_FORMAT_P016=105]="DXGI_FORMAT_P016",Ah[Ah.DXGI_FORMAT_420_OPAQUE=106]="DXGI_FORMAT_420_OPAQUE",Ah[Ah.DXGI_FORMAT_YUY2=107]="DXGI_FORMAT_YUY2",Ah[Ah.DXGI_FORMAT_Y210=108]="DXGI_FORMAT_Y210",Ah[Ah.DXGI_FORMAT_Y216=109]="DXGI_FORMAT_Y216",Ah[Ah.DXGI_FORMAT_NV11=110]="DXGI_FORMAT_NV11",Ah[Ah.DXGI_FORMAT_AI44=111]="DXGI_FORMAT_AI44",Ah[Ah.DXGI_FORMAT_IA44=112]="DXGI_FORMAT_IA44",Ah[Ah.DXGI_FORMAT_P8=113]="DXGI_FORMAT_P8",Ah[Ah.DXGI_FORMAT_A8P8=114]="DXGI_FORMAT_A8P8",Ah[Ah.DXGI_FORMAT_B4G4R4A4_UNORM=115]="DXGI_FORMAT_B4G4R4A4_UNORM",Ah[Ah.DXGI_FORMAT_P208=116]="DXGI_FORMAT_P208",Ah[Ah.DXGI_FORMAT_V208=117]="DXGI_FORMAT_V208",Ah[Ah.DXGI_FORMAT_V408=118]="DXGI_FORMAT_V408",Ah[Ah.DXGI_FORMAT_SAMPLER_FEEDBACK_MIN_MIP_OPAQUE=119]="DXGI_FORMAT_SAMPLER_FEEDBACK_MIN_MIP_OPAQUE",Ah[Ah.DXGI_FORMAT_SAMPLER_FEEDBACK_MIP_REGION_USED_OPAQUE=120]="DXGI_FORMAT_SAMPLER_FEEDBACK_MIP_REGION_USED_OPAQUE",Ah[Ah.DXGI_FORMAT_FORCE_UINT=121]="DXGI_FORMAT_FORCE_UINT",(Eh=Ch=Ch||{})[Eh.DDS_DIMENSION_TEXTURE1D=2]="DDS_DIMENSION_TEXTURE1D",Eh[Eh.DDS_DIMENSION_TEXTURE2D=3]="DDS_DIMENSION_TEXTURE2D",Eh[Eh.DDS_DIMENSION_TEXTURE3D=6]="DDS_DIMENSION_TEXTURE3D";var Nh,Lh,Uh,zh=((Sh={})[827611204]=nt.INTERNAL_FORMATS.COMPRESSED_RGBA_S3TC_DXT1_EXT,Sh[861165636]=nt.INTERNAL_FORMATS.COMPRESSED_RGBA_S3TC_DXT3_EXT,Sh[894720068]=nt.INTERNAL_FORMATS.COMPRESSED_RGBA_S3TC_DXT5_EXT,Sh),Wh=((xh={})[Ph.DXGI_FORMAT_BC1_TYPELESS]=nt.INTERNAL_FORMATS.COMPRESSED_RGBA_S3TC_DXT1_EXT,xh[Ph.DXGI_FORMAT_BC1_UNORM]=nt.INTERNAL_FORMATS.COMPRESSED_RGBA_S3TC_DXT1_EXT,xh[Ph.DXGI_FORMAT_BC2_TYPELESS]=nt.INTERNAL_FORMATS.COMPRESSED_RGBA_S3TC_DXT3_EXT,xh[Ph.DXGI_FORMAT_BC2_UNORM]=nt.INTERNAL_FORMATS.COMPRESSED_RGBA_S3TC_DXT3_EXT,xh[Ph.DXGI_FORMAT_BC3_TYPELESS]=nt.INTERNAL_FORMATS.COMPRESSED_RGBA_S3TC_DXT5_EXT,xh[Ph.DXGI_FORMAT_BC3_UNORM]=nt.INTERNAL_FORMATS.COMPRESSED_RGBA_S3TC_DXT5_EXT,xh[Ph.DXGI_FORMAT_BC1_UNORM_SRGB]=nt.INTERNAL_FORMATS.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT,xh[Ph.DXGI_FORMAT_BC2_UNORM_SRGB]=nt.INTERNAL_FORMATS.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT,xh[Ph.DXGI_FORMAT_BC3_UNORM_SRGB]=nt.INTERNAL_FORMATS.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT,xh),Gh=(Hh.use=function(t,e){if("dds"===t.extension&&t.data)try{Object.assign(t,Fh(t.name||t.url,Hh.parse(t.data),t.metadata))}catch(t){return void e(t)}e()},Hh.parse=function(t){var e=new Uint32Array(t);if(542327876!==e[0])throw new Error("Invalid DDS file magic word");var i=new Uint32Array(t,0,124/Uint32Array.BYTES_PER_ELEMENT),n=i[3],r=i[4],s=i[7],o=new Uint32Array(t,19*Uint32Array.BYTES_PER_ELEMENT,32/Uint32Array.BYTES_PER_ELEMENT),a=o[1];if(4&a){var l=o[2];if(808540228!==l){var h=zh[l],u=new Uint8Array(t,128);return[new Bh(u,{format:h,width:r,height:n,levels:s})]}var c=new Uint32Array(e.buffer,128,20/Uint32Array.BYTES_PER_ELEMENT),d=c[0],p=c[1],f=c[2],g=c[3],m=Wh[d];if(void 0===m)throw new Error("DDSLoader cannot parse texture data with DXGI format "+d);if(4===f)throw new Error("DDSLoader does not support cubemap textures");if(p===Ch.DDS_DIMENSION_TEXTURE3D)throw new Error("DDSLoader does not supported 3D texture data");var y=new Array;if(1===g)y.push(new Uint8Array(t,148));else{for(var _=vh[m],v=0,b=r,w=n,S=0;S<s;S++)v+=Math.max(1,b+3&-4)*Math.max(1,w+3&-4)*_,b>>>=1,w>>>=1;var x=148;for(S=0;S<g;S++)y.push(new Uint8Array(t,x,v)),x+=v}return y.map(function(t){return new Bh(t,{format:m,width:r,height:n,levels:s})})}if(64&a)throw new Error("DDSLoader does not support uncompressed texture data.");if(512&a)throw new Error("DDSLoader does not supported YUV uncompressed texture data.");if(131072&a)throw new Error("DDSLoader does not support single-channel (lumninance) texture data!");if(2&a)throw new Error("DDSLoader does not support single-channel (alpha) texture data!");throw new Error("DDSLoader failed to load a texture file due to an unknown reason!")},Hh);function Hh(){}nt.LoaderResource.setExtensionXhrType("ktx",nt.LoaderResource.XHR_RESPONSE_TYPE.BUFFER);var Xh=[171,75,84,88,32,49,49,187,13,10,26,10],jh=((Nh={})[nt.TYPES.UNSIGNED_BYTE]=1,Nh[nt.TYPES.UNSIGNED_SHORT]=2,Nh[nt.TYPES.FLOAT]=4,Nh[nt.TYPES.HALF_FLOAT]=8,Nh),Vh=((Lh={})[nt.FORMATS.RGBA]=4,Lh[nt.FORMATS.RGB]=3,Lh[nt.FORMATS.LUMINANCE]=1,Lh[nt.FORMATS.LUMINANCE_ALPHA]=2,Lh[nt.FORMATS.ALPHA]=1,Lh),Yh=((Uh={})[nt.TYPES.UNSIGNED_SHORT_4_4_4_4]=2,Uh[nt.TYPES.UNSIGNED_SHORT_5_5_5_1]=2,Uh[nt.TYPES.UNSIGNED_SHORT_5_6_5]=2,Uh),qh=($h.use=function(t,e){if("ktx"===t.extension&&t.data)try{var i=t.name||t.url;Object.assign(t,Fh(i,$h.parse(i,t.data),t.metadata))}catch(t){return void e(t)}e()},$h.parse=function(t,e){var i=new DataView(e);if(!$h.validate(t,i))return null;var n=67305985===i.getUint32(12,!0),r=i.getUint32(16,n),s=i.getUint32(24,n),o=i.getUint32(28,n),a=i.getUint32(36,n),l=i.getUint32(40,n)||1,h=i.getUint32(44,n)||1,u=i.getUint32(48,n)||1,c=i.getUint32(52,n),d=i.getUint32(56,n),p=i.getUint32(60,n);if(0===l||1!==h)throw new Error("Only 2D textures are supported");if(1!==c)throw new Error("CubeTextures are not supported by KTXLoader yet!");if(1!==u)throw new Error("WebGL does not support array textures");var f,g=a+3&-4,m=l+3&-4,y=new Array(u),_=a*l;if(0===r&&(_=g*m),void 0===(f=0!==r?jh[r]?jh[r]*Vh[s]:Yh[r]:vh[o]))throw new Error("Unable to resolve the pixel format stored in the *.ktx file!");for(var v=_*f,b=a,w=l,S=g,x=m,T=64+p,I=0;I<d;I++){for(var P=i.getUint32(T,n),C=T+4,E=0;E<u;E++){var A=y[E];(A=A||(y[E]=new Array(d)))[I]={levelID:I,levelWidth:1<d?b:S,levelHeight:1<d?w:x,levelBuffer:new Uint8Array(e,C,v)},C+=v}T=(T+=P+4)%4!=0?T+4-T%4:T,v=(S=(b=b>>1||1)+4-1&-4)*(x=(w=w>>1||1)+4-1&-4)*f}if(0!==r)throw new Error("TODO: Uncompressed");return y.map(function(t){return new Bh(null,{format:o,width:a,height:l,levels:d,levelBuffers:t})})},$h.validate=function(t,e){for(var i=0;i<Xh.length;i++)if(e.getUint8(i)!==Xh[i])return!1;return!0},$h),Kh=function(t,e){return(Kh=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)};function $h(){}function Qh(t,e){function i(){this.constructor=t}Kh(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}var Jh,Zh,tu,eu,iu=(Qh(au,Zh=tr),au.prototype.setProperties=function(t){t&&(this._properties[0]="vertices"in t||"scale"in t?!!t.vertices||!!t.scale:this._properties[0],this._properties[1]="position"in t?!!t.position:this._properties[1],this._properties[2]="rotation"in t?!!t.rotation:this._properties[2],this._properties[3]="uvs"in t?!!t.uvs:this._properties[3],this._properties[4]="tint"in t||"alpha"in t?!!t.tint||!!t.alpha:this._properties[4])},au.prototype.updateTransform=function(){this.displayObjectUpdateTransform()},Object.defineProperty(au.prototype,"tint",{get:function(){return this._tint},set:function(t){$e(this._tint=t,this.tintRgb)},enumerable:!1,configurable:!0}),au.prototype.render=function(t){var e=this;this.visible&&!(this.worldAlpha<=0)&&this.children.length&&this.renderable&&(this.baseTexture||(this.baseTexture=this.children[0]._texture.baseTexture,this.baseTexture.valid||this.baseTexture.once("update",function(){return e.onChildrenChange(0)})),t.batch.setObjectRenderer(t.plugins.particle),t.plugins.particle.render(this))},au.prototype.onChildrenChange=function(t){for(var e=Math.floor(t/this._batchSize);this._bufferUpdateIDs.length<e;)this._bufferUpdateIDs.push(0);this._bufferUpdateIDs[e]=++this._updateID},au.prototype.dispose=function(){if(this._buffers){for(var t=0;t<this._buffers.length;++t)this._buffers[t].destroy();this._buffers=null}},au.prototype.destroy=function(t){Zh.prototype.destroy.call(this,t),this.dispose(),this._properties=null,this._buffers=null,this._bufferUpdateIDs=null},au),nu=(ou.prototype.initBuffers=function(){var t=this.geometry,e=0;this.indexBuffer=new Gs(si(this.size),!0,!0),t.addIndex(this.indexBuffer);for(var i=this.dynamicStride=0;i<this.dynamicProperties.length;++i)(o=this.dynamicProperties[i]).offset=e,e+=o.size,this.dynamicStride+=o.size;var n=new ArrayBuffer(this.size*this.dynamicStride*4*4);this.dynamicData=new Float32Array(n),this.dynamicDataUint32=new Uint32Array(n),this.dynamicBuffer=new Gs(this.dynamicData,!1,!1);var r=0;for(i=this.staticStride=0;i<this.staticProperties.length;++i)(o=this.staticProperties[i]).offset=r,r+=o.size,this.staticStride+=o.size;var s=new ArrayBuffer(this.size*this.staticStride*4*4);for(this.staticData=new Float32Array(s),this.staticDataUint32=new Uint32Array(s),this.staticBuffer=new Gs(this.staticData,!0,!1),i=0;i<this.dynamicProperties.length;++i){var o=this.dynamicProperties[i];t.addAttribute(o.attributeName,this.dynamicBuffer,0,o.type===nt.TYPES.UNSIGNED_BYTE,o.type,4*this.dynamicStride,4*o.offset)}for(i=0;i<this.staticProperties.length;++i)o=this.staticProperties[i],t.addAttribute(o.attributeName,this.staticBuffer,0,o.type===nt.TYPES.UNSIGNED_BYTE,o.type,4*this.staticStride,4*o.offset)},ou.prototype.uploadDynamic=function(t,e,i){for(var n=0;n<this.dynamicProperties.length;n++){var r=this.dynamicProperties[n];r.uploadFunction(t,e,i,r.type===nt.TYPES.UNSIGNED_BYTE?this.dynamicDataUint32:this.dynamicData,this.dynamicStride,r.offset)}this.dynamicBuffer._updateID++},ou.prototype.uploadStatic=function(t,e,i){for(var n=0;n<this.staticProperties.length;n++){var r=this.staticProperties[n];r.uploadFunction(t,e,i,r.type===nt.TYPES.UNSIGNED_BYTE?this.staticDataUint32:this.staticData,this.staticStride,r.offset)}this.staticBuffer._updateID++},ou.prototype.destroy=function(){this.indexBuffer=null,this.dynamicProperties=null,this.dynamicBuffer=null,this.dynamicData=null,this.dynamicDataUint32=null,this.staticProperties=null,this.staticBuffer=null,this.staticData=null,this.staticDataUint32=null,this.geometry.destroy()},ou),ru=(Qh(su,Jh=io),su.prototype.render=function(t){var e=t.children,i=t._maxSize,n=t._batchSize,r=this.renderer,s=e.length;if(0!==s){i<s&&!t.autoResize&&(s=i);var o=t._buffers;o=o||(t._buffers=this.generateBuffers(t));var a=e[0]._texture.baseTexture;this.state.blendMode=ei(t.blendMode,a.alphaMode),r.state.set(this.state);var l=r.gl,h=t.worldTransform.copyTo(this.tempMatrix);h.prepend(r.globalUniforms.uniforms.projectionMatrix),this.shader.uniforms.translationMatrix=h.toArray(!0),this.shader.uniforms.uColor=ii(t.tintRgb,t.worldAlpha,this.shader.uniforms.uColor,a.alphaMode),this.shader.uniforms.uSampler=a,this.renderer.shader.bind(this.shader);for(var u=!1,c=0,d=0;c<s;c+=n,d+=1){var p=s-c;n<p&&(p=n),d>=o.length&&o.push(this._generateOneMoreBuffer(t));var f=o[d];f.uploadDynamic(e,c,p);var g=t._bufferUpdateIDs[d]||0;(u=u||f._updateID<g)&&(f._updateID=t._updateID,f.uploadStatic(e,c,p)),r.geometry.bind(f.geometry),l.drawElements(l.TRIANGLES,6*p,l.UNSIGNED_SHORT,0)}}},su.prototype.generateBuffers=function(t){for(var e=[],i=t._maxSize,n=t._batchSize,r=t._properties,s=0;s<i;s+=n)e.push(new nu(this.properties,r,n));return e},su.prototype._generateOneMoreBuffer=function(t){var e=t._batchSize,i=t._properties;return new nu(this.properties,i,e)},su.prototype.uploadVertices=function(t,e,i,n,r,s){for(var o=0,a=0,l=0,h=0,u=0;u<i;++u){var c=t[e+u],d=c._texture,p=c.scale.x,f=c.scale.y,g=d.trim,m=d.orig;g?(o=(a=g.x-c.anchor.x*m.width)+g.width,l=(h=g.y-c.anchor.y*m.height)+g.height):(o=m.width*(1-c.anchor.x),a=m.width*-c.anchor.x,l=m.height*(1-c.anchor.y),h=m.height*-c.anchor.y),n[s]=a*p,n[s+1]=h*f,n[s+r]=o*p,n[s+r+1]=h*f,n[s+2*r]=o*p,n[s+2*r+1]=l*f,n[s+3*r]=a*p,n[s+3*r+1]=l*f,s+=4*r}},su.prototype.uploadPosition=function(t,e,i,n,r,s){for(var o=0;o<i;o++){var a=t[e+o].position;n[s]=a.x,n[s+1]=a.y,n[s+r]=a.x,n[s+r+1]=a.y,n[s+2*r]=a.x,n[s+2*r+1]=a.y,n[s+3*r]=a.x,n[s+3*r+1]=a.y,s+=4*r}},su.prototype.uploadRotation=function(t,e,i,n,r,s){for(var o=0;o<i;o++){var a=t[e+o].rotation;n[s]=a,n[s+r]=a,n[s+2*r]=a,n[s+3*r]=a,s+=4*r}},su.prototype.uploadUvs=function(t,e,i,n,r,s){for(var o=0;o<i;++o){var a=t[e+o]._texture._uvs;a?(n[s]=a.x0,n[s+1]=a.y0,n[s+r]=a.x1,n[s+r+1]=a.y1,n[s+2*r]=a.x2,n[s+2*r+1]=a.y2,n[s+3*r]=a.x3,n[s+3*r+1]=a.y3):(n[s]=0,n[s+1]=0,n[s+r]=0,n[s+r+1]=0,n[s+2*r]=0,n[s+2*r+1]=0,n[s+3*r]=0,n[s+3*r+1]=0),s+=4*r}},su.prototype.uploadTint=function(t,e,i,n,r,s){for(var o=0;o<i;++o){var a=t[e+o],l=0<a._texture.baseTexture.alphaMode,h=a.alpha,u=h<1&&l?ni(a._tintRGB,h):a._tintRGB+(255*h<<24);n[s]=u,n[s+r]=u,n[s+2*r]=u,n[s+3*r]=u,s+=4*r}},su.prototype.destroy=function(){Jh.prototype.destroy.call(this),this.shader&&(this.shader.destroy(),this.shader=null),this.tempMatrix=null},su);function su(t){var e=Jh.call(this,t)||this;return e.shader=null,e.properties=null,e.tempMatrix=new Li,e.properties=[{attributeName:"aVertexPosition",size:2,uploadFunction:e.uploadVertices,offset:0},{attributeName:"aPositionCoord",size:2,uploadFunction:e.uploadPosition,offset:0},{attributeName:"aRotation",size:1,uploadFunction:e.uploadRotation,offset:0},{attributeName:"aTextureCoord",size:2,uploadFunction:e.uploadUvs,offset:0},{attributeName:"aColor",size:1,type:nt.TYPES.UNSIGNED_BYTE,uploadFunction:e.uploadTint,offset:0}],e.shader=ia.from("attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\nattribute vec4 aColor;\n\nattribute vec2 aPositionCoord;\nattribute float aRotation;\n\nuniform mat3 translationMatrix;\nuniform vec4 uColor;\n\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\n\nvoid main(void){\n    float x = (aVertexPosition.x) * cos(aRotation) - (aVertexPosition.y) * sin(aRotation);\n    float y = (aVertexPosition.x) * sin(aRotation) + (aVertexPosition.y) * cos(aRotation);\n\n    vec2 v = vec2(x, y);\n    v = v + aPositionCoord;\n\n    gl_Position = vec4((translationMatrix * vec3(v, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = aTextureCoord;\n    vColor = aColor * uColor;\n}\n","varying vec2 vTextureCoord;\nvarying vec4 vColor;\n\nuniform sampler2D uSampler;\n\nvoid main(void){\n    vec4 color = texture2D(uSampler, vTextureCoord) * vColor;\n    gl_FragColor = color;\n}",{}),e.state=na.for2d(),e}function ou(t,e,i){this.geometry=new Ys,this.indexBuffer=null,this.size=i,this.dynamicProperties=[],this.staticProperties=[];for(var n=0;n<t.length;++n){var r=t[n];r={attributeName:r.attributeName,size:r.size,uploadFunction:r.uploadFunction,type:r.type||nt.TYPES.FLOAT,offset:r.offset},e[n]?this.dynamicProperties.push(r):this.staticProperties.push(r)}this.staticStride=0,this.staticBuffer=null,this.staticData=null,this.staticDataUint32=null,this.dynamicStride=0,this.dynamicBuffer=null,this.dynamicData=null,this.dynamicDataUint32=null,this._updateID=0,this.initBuffers()}function au(t,e,i,n){void 0===t&&(t=1500),void 0===i&&(i=16384),void 0===n&&(n=!1);var r=Zh.call(this)||this;return 16384<i&&(i=16384),r._properties=[!1,!0,!1,!1,!1],r._maxSize=t,r._batchSize=i,r._buffers=null,r._bufferUpdateIDs=[],r._updateID=0,r.interactiveChildren=!1,r.blendMode=nt.BLEND_MODES.NORMAL,r.autoResize=n,r.roundPixels=!0,r.baseTexture=null,r.setProperties(e),r._tint=0,r.tintRgb=new Float32Array(4),r.tint=16777215,r}(eu=nt.LINE_JOIN||(nt.LINE_JOIN={})).MITER="miter",eu.BEVEL="bevel",eu.ROUND="round",(tu=nt.LINE_CAP||(nt.LINE_CAP={})).BUTT="butt",tu.ROUND="round",tu.SQUARE="square";var lu={adaptive:!0,maxLength:10,minSegments:8,maxSegments:2048,epsilon:1e-4,_segmentsCount:function(t,e){if(void 0===e&&(e=20),!this.adaptive||!t||isNaN(t))return e;var i=Math.ceil(t/this.maxLength);return i<this.minSegments?i=this.minSegments:i>this.maxSegments&&(i=this.maxSegments),i}},hu=(cu.prototype.clone=function(){var t=new cu;return t.color=this.color,t.alpha=this.alpha,t.texture=this.texture,t.matrix=this.matrix,t.visible=this.visible,t},cu.prototype.reset=function(){this.color=16777215,this.alpha=1,this.texture=Cs.WHITE,this.matrix=null,this.visible=!1},cu.prototype.destroy=function(){this.texture=null,this.matrix=null},cu),uu=function(t,e){return(uu=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)};function cu(){this.color=16777215,this.alpha=1,this.texture=Cs.WHITE,this.matrix=null,this.visible=!1,this.reset()}function du(t,e){function i(){this.constructor=t}uu(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}var pu={build:function(t){t.points=t.shape.points.slice()},triangulate:function(t,e){var i=t.points,n=t.holes,r=e.points,s=e.indices;if(6<=i.length){for(var o=[],a=0;a<n.length;a++){var l=n[a];o.push(i.length/2),i=i.concat(l.points)}var h=Et(i,o,2);if(!h)return;var u=r.length/2;for(a=0;a<h.length;a+=3)s.push(h[a]+u),s.push(h[a+1]+u),s.push(h[a+2]+u);for(a=0;a<i.length;a++)r.push(i[a])}}},fu={build:function(t){var e,i,n=t.shape,r=t.points,s=n.x,o=n.y;if(r.length=0,t.type===nt.SHAPES.CIRC)e=n.radius,i=n.radius;else{var a=t.shape;e=a.width,i=a.height}if(0!==e&&0!==i){var l=Math.floor(30*Math.sqrt(n.radius))||Math.floor(15*Math.sqrt(e+i));l/=2.3;for(var h=2*Math.PI/l,u=0;u<l-.5;u++)r.push(s+Math.sin(-h*u)*e,o+Math.cos(-h*u)*i);r.push(r[0],r[1])}},triangulate:function(t,e){var i=t.points,n=e.points,r=e.indices,s=n.length/2,o=s,a=t.shape,l=t.matrix,h=a.x,u=a.y;n.push(t.matrix?l.a*h+l.c*u+l.tx:h,t.matrix?l.b*h+l.d*u+l.ty:u);for(var c=0;c<i.length;c+=2)n.push(i[c],i[c+1]),r.push(s++,o,s)}},gu={build:function(t){var e=t.shape,i=e.x,n=e.y,r=e.width,s=e.height,o=t.points;o.length=0,o.push(i,n,i+r,n,i+r,n+s,i,n+s)},triangulate:function(t,e){var i=t.points,n=e.points,r=n.length/2;n.push(i[0],i[1],i[2],i[3],i[6],i[7],i[4],i[5]),e.indices.push(r,1+r,2+r,1+r,2+r,3+r)}};function mu(t,e,i){return t+(e-t)*i}function yu(t,e,i,n,r,s,o){void 0===o&&(o=[]);for(var a=o,l=0,h=0,u=0,c=0,d=0,p=0,f=0,g=0;f<=20;++f)l=mu(t,i,g=f/20),h=mu(e,n,g),u=mu(i,r,g),c=mu(n,s,g),d=mu(l,u,g),p=mu(h,c,g),0===f&&a[a.length-2]===d&&a[a.length-1]===p||a.push(d,p);return a}var _u={build:function(t){var e=t.shape,i=t.points,n=e.x,r=e.y,s=e.width,o=e.height,a=Math.max(0,Math.min(e.radius,Math.min(s,o)/2));i.length=0,a?(yu(n,r+a,n,r,n+a,r,i),yu(n+s-a,r,n+s,r,n+s,r+a,i),yu(n+s,r+o-a,n+s,r+o,n+s-a,r+o,i),yu(n+a,r+o,n,r+o,n,r+o-a,i)):i.push(n,r,n+s,r,n+s,r+o,n,r+o)},triangulate:function(t,e){for(var i=t.points,n=e.points,r=e.indices,s=n.length/2,o=Et(i,null,2),a=0,l=o.length;a<l;a+=3)r.push(o[a]+s),r.push(o[a+1]+s),r.push(o[a+2]+s);for(a=0,l=i.length;a<l;a++)n.push(i[a],i[++a])}};function vu(t,e,i,n,r,s,o,a){var l,h;h=o?(l=n,-i):(l=-n,i);var u=t-i*r+l,c=e-n*r+h,d=t+i*s+l,p=e+n*s+h;return a.push(u,c),a.push(d,p),2}function bu(t,e,i,n,r,s,o,a){var l=i-t,h=n-e,u=Math.atan2(l,h),c=Math.atan2(r-t,s-e);a&&u<c?u+=2*Math.PI:!a&&c<u&&(c+=2*Math.PI);var d=u,p=c-u,f=Math.abs(p),g=Math.sqrt(l*l+h*h),m=1+(15*f*Math.sqrt(g)/Math.PI>>0),y=p/m;if(d+=y,a){o.push(t,e),o.push(i,n);for(var _=1,v=d;_<m;_++,v+=y)o.push(t,e),o.push(t+Math.sin(v)*g,e+Math.cos(v)*g);o.push(t,e),o.push(r,s)}else{for(o.push(i,n),o.push(t,e),_=1,v=d;_<m;_++,v+=y)o.push(t+Math.sin(v)*g,e+Math.cos(v)*g),o.push(t,e);o.push(r,s),o.push(t,e)}return 2*m}function wu(t,e){t.lineStyle.native?function(t,e){var i=0,n=t.shape,r=t.points||n.points,s=n.type!==nt.SHAPES.POLY||n.closeStroke;if(0!==r.length){var o=e.points,a=e.indices,l=r.length/2,h=o.length/2,u=h;for(o.push(r[0],r[1]),i=1;i<l;i++)o.push(r[2*i],r[2*i+1]),a.push(u,u+1),u++;s&&a.push(u,h)}}(t,e):function(t,e){var i=t.shape,n=t.points||i.points.slice(),r=e.closePointEps;if(0!==n.length){var s=t.lineStyle,o=new Fi(n[0],n[1]),a=new Fi(n[n.length-2],n[n.length-1]),l=i.type!==nt.SHAPES.POLY||i.closeStroke,h=Math.abs(o.x-a.x)<r&&Math.abs(o.y-a.y)<r;if(l){n=n.slice(),h&&(n.pop(),n.pop(),a.set(n[n.length-2],n[n.length-1]));var u=.5*(o.x+a.x),c=.5*(a.y+o.y);n.unshift(u,c),n.push(u,c)}var d=e.points,p=n.length/2,f=n.length,g=d.length/2,m=s.width/2,y=m*m,_=s.miterLimit*s.miterLimit,v=n[0],b=n[1],w=n[2],S=n[3],x=0,T=0,I=-(b-S),P=v-w,C=0,E=0,A=Math.sqrt(I*I+P*P);I/=A,P/=A,I*=m,P*=m;var M=s.alignment,B=2*(1-M),R=2*M;l||(s.cap===nt.LINE_CAP.ROUND?f+=bu(v-I*(B-R)*.5,b-P*(B-R)*.5,v-I*B,b-P*B,v+I*R,b+P*R,d,!0)+2:s.cap===nt.LINE_CAP.SQUARE&&(f+=vu(v,b,I,P,B,R,!0,d))),d.push(v-I*B,b-P*B),d.push(v+I*R,b+P*R);for(var O=1;O<p-1;++O){v=n[2*(O-1)],b=n[2*(O-1)+1],w=n[2*O],S=n[2*O+1],x=n[2*(O+1)],T=n[2*(O+1)+1],I=-(b-S),P=v-w,I/=A=Math.sqrt(I*I+P*P),P/=A,I*=m,P*=m,C=-(S-T),E=w-x,C/=A=Math.sqrt(C*C+E*E),E/=A,C*=m,E*=m;var k=w-v,D=b-S,F=w-x,N=T-S,L=D*F-N*k,U=L<0;if(Math.abs(L)<.1)d.push(w-I*B,S-P*B),d.push(w+I*R,S+P*R);else{var z=(-I+v)*(-P+S)-(-I+w)*(-P+b),W=(-C+x)*(-E+S)-(-C+w)*(-E+T),G=(k*W-F*z)/L,H=(N*z-D*W)/L,X=(G-w)*(G-w)+(H-S)*(H-S),j=w+(G-w)*B,V=S+(H-S)*B,Y=w-(G-w)*R,q=S-(H-S)*R,K=U?B:R;X<=Math.min(k*k+D*D,F*F+N*N)+K*K*y?s.join===nt.LINE_JOIN.BEVEL||_<X/y?(U?(d.push(j,V),d.push(w+I*R,S+P*R),d.push(j,V),d.push(w+C*R,S+E*R)):(d.push(w-I*B,S-P*B),d.push(Y,q),d.push(w-C*B,S-E*B),d.push(Y,q)),f+=2):s.join===nt.LINE_JOIN.ROUND?U?(d.push(j,V),d.push(w+I*R,S+P*R),f+=bu(w,S,w+I*R,S+P*R,w+C*R,S+E*R,d,!0)+4,d.push(j,V),d.push(w+C*R,S+E*R)):(d.push(w-I*B,S-P*B),d.push(Y,q),f+=bu(w,S,w-I*B,S-P*B,w-C*B,S-E*B,d,!1)+4,d.push(w-C*B,S-E*B),d.push(Y,q)):(d.push(j,V),d.push(Y,q)):(d.push(w-I*B,S-P*B),d.push(w+I*R,S+P*R),s.join===nt.LINE_JOIN.BEVEL||_<X/y||(s.join===nt.LINE_JOIN.ROUND?f+=U?bu(w,S,w+I*R,S+P*R,w+C*R,S+E*R,d,!0)+2:bu(w,S,w-I*B,S-P*B,w-C*B,S-E*B,d,!1)+2:(U?(d.push(Y,q),d.push(Y,q)):(d.push(j,V),d.push(j,V)),f+=2)),d.push(w-C*B,S-E*B),d.push(w+C*R,S+E*R),f+=2)}}v=n[2*(p-2)],b=n[2*(p-2)+1],w=n[2*(p-1)],I=-(b-(S=n[2*(p-1)+1])),P=v-w,I/=A=Math.sqrt(I*I+P*P),P/=A,I*=m,P*=m,d.push(w-I*B,S-P*B),d.push(w+I*R,S+P*R),l||(s.cap===nt.LINE_CAP.ROUND?f+=bu(w-I*(B-R)*.5,S-P*(B-R)*.5,w-I*B,S-P*B,w+I*R,S+P*R,d,!1)+2:s.cap===nt.LINE_CAP.SQUARE&&(f+=vu(w,S,I,P,B,R,!1,d)));var $=e.indices,Q=lu.epsilon*lu.epsilon;for(O=g;O<f+g-2;++O)v=d[2*O],b=d[2*O+1],w=d[2*(O+1)],S=d[2*(O+1)+1],x=d[2*(O+2)],T=d[2*(O+2)+1],Math.abs(v*(S-T)+w*(T-b)+x*(b-S))<Q||$.push(O,O+1,O+2)}}(t,e)}var Su,xu=(Ou.curveTo=function(t,e,i,n,r,s){var o=s[s.length-2],a=s[s.length-1]-e,l=o-t,h=n-e,u=i-t,c=Math.abs(a*u-l*h);if(c<1e-8||0===r)return s[s.length-2]===t&&s[s.length-1]===e||s.push(t,e),null;var d=a*a+l*l,p=h*h+u*u,f=a*h+l*u,g=r*Math.sqrt(d)/c,m=r*Math.sqrt(p)/c,y=g*f/d,_=m*f/p,v=g*u+m*l,b=g*h+m*a,w=l*(m+y),S=a*(m+y),x=u*(g+_),T=h*(g+_);return{cx:v+t,cy:b+e,radius:r,startAngle:Math.atan2(S-b,w-v),endAngle:Math.atan2(T-b,x-v),anticlockwise:u*a<l*h}},Ou.arc=function(t,e,i,n,r,s,o,a,l){for(var h=o-s,u=lu._segmentsCount(Math.abs(h)*r,40*Math.ceil(Math.abs(h)/Ei)),c=h/(2*u),d=2*c,p=Math.cos(c),f=Math.sin(c),g=u-1,m=g%1/g,y=0;y<=g;++y){var _=c+s+d*(y+m*y),v=Math.cos(_),b=-Math.sin(_);l.push((p*v+f*b)*r+i,(p*-b+f*v)*r+n)}},Ou),Tu=(Ru.curveLength=function(t,e,i,n,r,s,o,a){for(var l=0,h=0,u=0,c=0,d=0,p=0,f=0,g=0,m=0,y=0,_=0,v=t,b=e,w=1;w<=10;++w)y=v-(g=(f=(p=(d=1-(h=w/10))*d)*d)*t+3*p*h*i+3*d*(u=h*h)*r+(c=u*h)*o),_=b-(m=f*e+3*p*h*n+3*d*u*s+c*a),v=g,b=m,l+=Math.sqrt(y*y+_*_);return l},Ru.curveTo=function(t,e,i,n,r,s,o){var a=o[o.length-2],l=o[o.length-1];o.length-=2;var h=lu._segmentsCount(Ru.curveLength(a,l,t,e,i,n,r,s)),u=0,c=0,d=0,p=0,f=0;o.push(a,l);for(var g=1,m=0;g<=h;++g)d=(c=(u=1-(m=g/h))*u)*u,f=(p=m*m)*m,o.push(d*a+3*c*m*t+3*u*p*i+f*r,d*l+3*c*m*e+3*u*p*n+f*s)},Ru),Iu=(Bu.curveLength=function(t,e,i,n,r,s){var o=t-2*i+r,a=e-2*n+s,l=2*i-2*t,h=2*n-2*e,u=4*(o*o+a*a),c=4*(o*l+a*h),d=l*l+h*h,p=2*Math.sqrt(u+c+d),f=Math.sqrt(u),g=2*u*f,m=2*Math.sqrt(d),y=c/f;return(g*p+f*c*(p-m)+(4*d*u-c*c)*Math.log((2*f+y+p)/(y+m)))/(4*g)},Bu.curveTo=function(t,e,i,n,r){for(var s=r[r.length-2],o=r[r.length-1],a=lu._segmentsCount(Bu.curveLength(s,o,t,e,i,n)),l=0,h=0,u=1;u<=a;++u){var c=u/a;l=s+(t-s)*c,h=o+(e-o)*c,r.push(l+(t+(i-t)*c-l)*c,h+(e+(n-e)*c-h)*c)}},Bu),Pu=(Mu.prototype.begin=function(t,e,i){this.reset(),this.style=t,this.start=e,this.attribStart=i},Mu.prototype.end=function(t,e){this.attribSize=e-this.attribStart,this.size=t-this.start},Mu.prototype.reset=function(){this.style=null,this.size=0,this.start=0,this.attribStart=0,this.attribSize=0},Mu),Cu=((Su={})[nt.SHAPES.POLY]=pu,Su[nt.SHAPES.CIRC]=fu,Su[nt.SHAPES.ELIP]=fu,Su[nt.SHAPES.RECT]=gu,Su[nt.SHAPES.RREC]=_u,Su),Eu=[],Au=[];function Mu(){this.reset()}function Bu(){}function Ru(){}function Ou(){}function ku(t){for(var e=t.points,i=0,n=0;n<e.length-2;n+=2)i+=(e[n+2]-e[n])*(e[n+3]+e[n+1]);return 0<i}var Du,Fu,Nu,Lu,Uu,zu,Wu,Gu=(ac.prototype.clone=function(){return new ac(this.shape,this.fillStyle,this.lineStyle,this.matrix)},ac.prototype.destroy=function(){this.shape=null,this.holes.length=0,this.holes=null,this.points.length=0,this.points=null,this.lineStyle=null,this.fillStyle=null},ac),Hu=new Fi,Xu=new rn,ju=(du(oc,zu=_l),Object.defineProperty(oc.prototype,"bounds",{get:function(){return this.boundsDirty!==this.dirty&&(this.boundsDirty=this.dirty,this.calculateBounds()),this._bounds},enumerable:!1,configurable:!0}),oc.prototype.invalidate=function(){this.boundsDirty=-1,this.dirty++,this.batchDirty++,this.shapeIndex=0,this.points.length=0,this.colors.length=0,this.uvs.length=0,this.indices.length=0;for(var t=this.textureIds.length=0;t<this.drawCalls.length;t++)this.drawCalls[t].texArray.clear(),Au.push(this.drawCalls[t]);for(t=this.drawCalls.length=0;t<this.batches.length;t++){var e=this.batches[t];e.reset(),Eu.push(e)}this.batches.length=0},oc.prototype.clear=function(){return 0<this.graphicsData.length&&(this.invalidate(),this.clearDirty++,this.graphicsData.length=0),this},oc.prototype.drawShape=function(t,e,i,n){void 0===e&&(e=null),void 0===i&&(i=null),void 0===n&&(n=null);var r=new Gu(t,e,i,n);return this.graphicsData.push(r),this.dirty++,this},oc.prototype.drawHole=function(t,e){if(void 0===e&&(e=null),!this.graphicsData.length)return null;var i=new Gu(t,null,null,e),n=this.graphicsData[this.graphicsData.length-1];return i.lineStyle=n.lineStyle,n.holes.push(i),this.dirty++,this},oc.prototype.destroy=function(){zu.prototype.destroy.call(this);for(var t=0;t<this.graphicsData.length;++t)this.graphicsData[t].destroy();this.points.length=0,this.points=null,this.colors.length=0,this.colors=null,this.uvs.length=0,this.uvs=null,this.indices.length=0,this.indices=null,this.indexBuffer.destroy(),this.indexBuffer=null,this.graphicsData.length=0,this.graphicsData=null,this.drawCalls.length=0,this.drawCalls=null,this.batches.length=0,this.batches=null,this._bounds=null},oc.prototype.containsPoint=function(t){for(var e=this.graphicsData,i=0;i<e.length;++i){var n=e[i];if(n.fillStyle.visible&&n.shape&&(n.matrix?n.matrix.applyInverse(t,Hu):Hu.copyFrom(t),n.shape.contains(Hu.x,Hu.y))){var r=!1;if(n.holes)for(var s=0;s<n.holes.length;s++)if(n.holes[s].shape.contains(Hu.x,Hu.y)){r=!0;break}if(!r)return!0}}return!1},oc.prototype.updateBatches=function(t){if(this.graphicsData.length){if(this.validateBatching()){this.cacheDirty=this.dirty;var e=this.uvs,i=this.graphicsData,n=null,r=null;0<this.batches.length&&(r=(n=this.batches[this.batches.length-1]).style);for(var s=this.shapeIndex;s<i.length;s++){this.shapeIndex++;var o=i[s],a=o.fillStyle,l=o.lineStyle;Cu[o.type].build(o),o.matrix&&this.transformPoints(o.points,o.matrix);for(var h=0;h<2;h++){var u=0===h?a:l;if(u.visible){var c=u.texture.baseTexture,d=this.indices.length,p=this.points.length/2;c.wrapMode=nt.WRAP_MODES.REPEAT,0===h?this.processFill(o):this.processLine(o);var f=this.points.length/2-p;0!=f&&(n&&!this._compareStyles(r,u)&&(n.end(d,p),n=null),n||((n=Eu.pop()||new Pu).begin(u,d,p),this.batches.push(n),r=u),this.addUvs(this.points,e,u.texture,p,f,u.matrix))}}}var g=this.indices.length,m=this.points.length/2;if(n&&n.end(g,m),0!==this.batches.length){if(this.indicesUint16&&this.indices.length===this.indicesUint16.length)this.indicesUint16.set(this.indices);else{var y=65535<m&&t;this.indicesUint16=y?new Uint32Array(this.indices):new Uint16Array(this.indices)}this.batchable=this.isBatchable(),this.batchable?this.packBatches():this.buildDrawCalls()}else this.batchable=!0}}else this.batchable=!0},oc.prototype._compareStyles=function(t,e){return!(!t||!e)&&t.texture.baseTexture===e.texture.baseTexture&&t.color+t.alpha===e.color+e.alpha&&!!t.native==!!e.native},oc.prototype.validateBatching=function(){if(this.dirty===this.cacheDirty||!this.graphicsData.length)return!1;for(var t=0,e=this.graphicsData.length;t<e;t++){var i=this.graphicsData[t],n=i.fillStyle,r=i.lineStyle;if(n&&!n.texture.baseTexture.valid)return!1;if(r&&!r.texture.baseTexture.valid)return!1}return!0},oc.prototype.packBatches=function(){this.batchDirty++,this.uvsFloat32=new Float32Array(this.uvs);for(var t=this.batches,e=0,i=t.length;e<i;e++)for(var n=t[e],r=0;r<n.size;r++){var s=n.start+r;this.indicesUint16[s]=this.indicesUint16[s]-n.attribStart}},oc.prototype.isBatchable=function(){if(131070<this.points.length)return!1;for(var t=this.batches,e=0;e<t.length;e++)if(t[e].style.native)return!1;return this.points.length<2*oc.BATCHABLE_SIZE},oc.prototype.buildDrawCalls=function(){for(var t=++$r._globalBatch,e=0;e<this.drawCalls.length;e++)this.drawCalls[e].texArray.clear(),Au.push(this.drawCalls[e]);this.drawCalls.length=0;var i=this.colors,n=this.textureIds,r=Au.pop();r||((r=new al).texArray=new fl),r.texArray.count=0,r.start=0,r.size=0,r.type=nt.DRAW_MODES.TRIANGLES;var s=0,o=null,a=0,l=!1,h=nt.DRAW_MODES.TRIANGLES,u=0;for(this.drawCalls.push(r),e=0;e<this.batches.length;e++){var c=this.batches[e],d=c.style,p=d.texture.baseTexture;l!==!!d.native&&(h=(l=!!d.native)?nt.DRAW_MODES.LINES:nt.DRAW_MODES.TRIANGLES,o=null,s=8,t++),o!==p&&(o=p)._batchEnabled!==t&&(8===s&&(t++,(s=0)<r.size&&((r=Au.pop())||((r=new al).texArray=new fl),this.drawCalls.push(r)),r.start=u,r.size=0,r.texArray.count=0,r.type=h),p.touched=1,p._batchEnabled=t,p._batchLocation=s,p.wrapMode=nt.WRAP_MODES.REPEAT,r.texArray.elements[r.texArray.count++]=p,s++),r.size+=c.size,u+=c.size,a=p._batchLocation,this.addColors(i,d.color,d.alpha,c.attribSize,c.attribStart),this.addTextureIds(n,a,c.attribSize,c.attribStart)}$r._globalBatch=t,this.packAttributes()},oc.prototype.packAttributes=function(){for(var t=this.points,e=this.uvs,i=this.colors,n=this.textureIds,r=new ArrayBuffer(3*t.length*4),s=new Float32Array(r),o=new Uint32Array(r),a=0,l=0;l<t.length/2;l++)s[a++]=t[2*l],s[a++]=t[2*l+1],s[a++]=e[2*l],s[a++]=e[2*l+1],o[a++]=i[l],s[a++]=n[l];this._buffer.update(r),this._indexBuffer.update(this.indicesUint16)},oc.prototype.processFill=function(t){t.holes.length?(this.processHoles(t.holes),pu.triangulate(t,this)):Cu[t.type].triangulate(t,this)},oc.prototype.processLine=function(t){wu(t,this);for(var e=0;e<t.holes.length;e++)wu(t.holes[e],this)},oc.prototype.processHoles=function(t){for(var e=0;e<t.length;e++){var i=t[e];Cu[i.type].build(i),i.matrix&&this.transformPoints(i.points,i.matrix)}},oc.prototype.calculateBounds=function(){var t=this._bounds,e=Xu,i=Li.IDENTITY;this._bounds.clear(),e.clear();for(var n=0;n<this.graphicsData.length;n++){var r=this.graphicsData[n],s=r.shape,o=r.type,a=r.lineStyle,l=r.matrix||Li.IDENTITY,h=0;if(a&&a.visible){var u=a.alignment;h=a.width,o===nt.SHAPES.POLY?ku(s)?h*=1-u:h*=u:h*=Math.max(0,u)}if(i!==l&&(e.isEmpty()||(t.addBoundsMatrix(e,i),e.clear()),i=l),o===nt.SHAPES.RECT||o===nt.SHAPES.RREC){var c=s;e.addFramePad(c.x,c.y,c.x+c.width,c.y+c.height,h,h)}else if(o===nt.SHAPES.CIRC){var d=s;e.addFramePad(d.x,d.y,d.x,d.y,d.radius+h,d.radius+h)}else if(o===nt.SHAPES.ELIP){var p=s;e.addFramePad(p.x,p.y,p.x,p.y,p.width+h,p.height+h)}else{var f=s;t.addVerticesMatrix(i,f.points,0,f.points.length,h,h)}}e.isEmpty()||t.addBoundsMatrix(e,i),t.pad(this.boundsPadding,this.boundsPadding)},oc.prototype.transformPoints=function(t,e){for(var i=0;i<t.length/2;i++){var n=t[2*i],r=t[2*i+1];t[2*i]=e.a*n+e.c*r+e.tx,t[2*i+1]=e.b*n+e.d*r+e.ty}},oc.prototype.addColors=function(t,e,i,n,r){void 0===r&&(r=0);var s=ni((e>>16)+(65280&e)+((255&e)<<16),i);t.length=Math.max(t.length,r+n);for(var o=0;o<n;o++)t[r+o]=s},oc.prototype.addTextureIds=function(t,e,i,n){void 0===n&&(n=0),t.length=Math.max(t.length,n+i);for(var r=0;r<i;r++)t[n+r]=e},oc.prototype.addUvs=function(t,e,i,n,r,s){void 0===s&&(s=null);for(var o=0,a=e.length,l=i.frame;o<r;){var h=t[2*(n+o)],u=t[2*(n+o)+1];if(s){var c=s.a*h+s.c*u+s.tx;u=s.b*h+s.d*u+s.ty,h=c}o++,e.push(h/l.width,u/l.height)}var d=i.baseTexture;(l.width<d.width||l.height<d.height)&&this.adjustUvs(e,i,a,r)},oc.prototype.adjustUvs=function(t,e,i,n){for(var r=e.baseTexture,s=i+2*n,o=e.frame,a=o.width/r.width,l=o.height/r.height,h=o.x/o.width,u=o.y/o.height,c=Math.floor(t[i]+1e-6),d=Math.floor(t[i+1]+1e-6),p=i+2;p<s;p+=2)c=Math.min(c,Math.floor(t[p]+1e-6)),d=Math.min(d,Math.floor(t[p+1]+1e-6));for(h-=c,u-=d,p=i;p<s;p+=2)t[p]=(t[p]+h)*a,t[p+1]=(t[p+1]+u)*l},oc.BATCHABLE_SIZE=100,oc),Vu=(du(sc,Uu=hu),sc.prototype.clone=function(){var t=new sc;return t.color=this.color,t.alpha=this.alpha,t.texture=this.texture,t.matrix=this.matrix,t.visible=this.visible,t.width=this.width,t.alignment=this.alignment,t.native=this.native,t.cap=this.cap,t.join=this.join,t.miterLimit=this.miterLimit,t},sc.prototype.reset=function(){Uu.prototype.reset.call(this),this.color=0,this.alignment=.5,this.width=0,this.native=!1},sc),Yu=new Float32Array(3),qu={},Ku=(du(rc,Lu=tr),Object.defineProperty(rc.prototype,"geometry",{get:function(){return this._geometry},enumerable:!1,configurable:!0}),rc.prototype.clone=function(){return this.finishPoly(),new rc(this._geometry)},Object.defineProperty(rc.prototype,"blendMode",{get:function(){return this.state.blendMode},set:function(t){this.state.blendMode=t},enumerable:!1,configurable:!0}),Object.defineProperty(rc.prototype,"tint",{get:function(){return this._tint},set:function(t){this._tint=t},enumerable:!1,configurable:!0}),Object.defineProperty(rc.prototype,"fill",{get:function(){return this._fillStyle},enumerable:!1,configurable:!0}),Object.defineProperty(rc.prototype,"line",{get:function(){return this._lineStyle},enumerable:!1,configurable:!0}),rc.prototype.lineStyle=function(t,e,i,n,r){return void 0===t&&(t=null),void 0===e&&(e=0),void 0===i&&(i=1),void 0===n&&(n=.5),void 0===r&&(r=!1),"number"==typeof t&&(t={width:t,color:e,alpha:i,alignment:n,native:r}),this.lineTextureStyle(t)},rc.prototype.lineTextureStyle=function(t){t=Object.assign({width:0,texture:Cs.WHITE,color:t&&t.texture?16777215:0,alpha:1,matrix:null,alignment:.5,native:!1,cap:nt.LINE_CAP.BUTT,join:nt.LINE_JOIN.MITER,miterLimit:10},t),this.currentPath&&this.startPoly();var e=0<t.width&&0<t.alpha;return e?(t.matrix&&(t.matrix=t.matrix.clone(),t.matrix.invert()),Object.assign(this._lineStyle,{visible:e},t)):this._lineStyle.reset(),this},rc.prototype.startPoly=function(){if(this.currentPath){var t=this.currentPath.points,e=this.currentPath.points.length;2<e&&(this.drawShape(this.currentPath),this.currentPath=new ki,this.currentPath.closeStroke=!1,this.currentPath.points.push(t[e-2],t[e-1]))}else this.currentPath=new ki,this.currentPath.closeStroke=!1},rc.prototype.finishPoly=function(){this.currentPath&&(2<this.currentPath.points.length?(this.drawShape(this.currentPath),this.currentPath=null):this.currentPath.points.length=0)},rc.prototype.moveTo=function(t,e){return this.startPoly(),this.currentPath.points[0]=t,this.currentPath.points[1]=e,this},rc.prototype.lineTo=function(t,e){this.currentPath||this.moveTo(0,0);var i=this.currentPath.points,n=i[i.length-2],r=i[i.length-1];return n===t&&r===e||i.push(t,e),this},rc.prototype._initCurve=function(t,e){void 0===t&&(t=0),void 0===e&&(e=0),this.currentPath?0===this.currentPath.points.length&&(this.currentPath.points=[t,e]):this.moveTo(t,e)},rc.prototype.quadraticCurveTo=function(t,e,i,n){this._initCurve();var r=this.currentPath.points;return 0===r.length&&this.moveTo(0,0),Iu.curveTo(t,e,i,n,r),this},rc.prototype.bezierCurveTo=function(t,e,i,n,r,s){return this._initCurve(),Tu.curveTo(t,e,i,n,r,s,this.currentPath.points),this},rc.prototype.arcTo=function(t,e,i,n,r){this._initCurve(t,e);var s=this.currentPath.points,o=xu.curveTo(t,e,i,n,r,s);if(o){var a=o.cx,l=o.cy,h=o.radius,u=o.startAngle,c=o.endAngle,d=o.anticlockwise;this.arc(a,l,h,u,c,d)}return this},rc.prototype.arc=function(t,e,i,n,r,s){if(void 0===s&&(s=!1),n===r)return this;if(!s&&r<=n?r+=Ei:s&&n<=r&&(n+=Ei),0==r-n)return this;var o=t+Math.cos(n)*i,a=e+Math.sin(n)*i,l=this._geometry.closePointEps,h=this.currentPath?this.currentPath.points:null;if(h){var u=Math.abs(h[h.length-2]-o),c=Math.abs(h[h.length-1]-a);u<l&&c<l||h.push(o,a)}else this.moveTo(o,a),h=this.currentPath.points;return xu.arc(o,a,t,e,i,n,r,s,h),this},rc.prototype.beginFill=function(t,e){return void 0===t&&(t=0),void 0===e&&(e=1),this.beginTextureFill({texture:Cs.WHITE,color:t,alpha:e})},rc.prototype.beginTextureFill=function(t){t=Object.assign({texture:Cs.WHITE,color:16777215,alpha:1,matrix:null},t),this.currentPath&&this.startPoly();var e=0<t.alpha;return e?(t.matrix&&(t.matrix=t.matrix.clone(),t.matrix.invert()),Object.assign(this._fillStyle,{visible:e},t)):this._fillStyle.reset(),this},rc.prototype.endFill=function(){return this.finishPoly(),this._fillStyle.reset(),this},rc.prototype.drawRect=function(t,e,i,n){return this.drawShape(new Bi(t,e,i,n))},rc.prototype.drawRoundedRect=function(t,e,i,n,r){return this.drawShape(new Di(t,e,i,n,r))},rc.prototype.drawCircle=function(t,e,i){return this.drawShape(new Ri(t,e,i))},rc.prototype.drawEllipse=function(t,e,i,n){return this.drawShape(new Oi(t,e,i,n))},rc.prototype.drawPolygon=function(){for(var t,e=arguments,i=[],n=0;n<arguments.length;n++)i[n]=e[n];var r=!0,s=i[0];t=s.points?(r=s.closeStroke,s.points):Array.isArray(i[0])?i[0]:i;var o=new ki(t);return o.closeStroke=r,this.drawShape(o),this},rc.prototype.drawShape=function(t){return this._holeMode?this._geometry.drawHole(t,this._matrix):this._geometry.drawShape(t,this._fillStyle.clone(),this._lineStyle.clone(),this._matrix),this},rc.prototype.clear=function(){return this._geometry.clear(),this._lineStyle.reset(),this._fillStyle.reset(),this._boundsID++,this._matrix=null,this._holeMode=!1,this.currentPath=null,this},rc.prototype.isFastRect=function(){var t=this._geometry.graphicsData;return!(1!==t.length||t[0].shape.type!==nt.SHAPES.RECT||t[0].holes.length||t[0].lineStyle.visible&&t[0].lineStyle.width)},rc.prototype._render=function(t){this.finishPoly();var e=this._geometry,i=t.context.supports.uint32Indices;e.updateBatches(i),e.batchable?(this.batchDirty!==e.batchDirty&&this._populateBatches(),this._renderBatched(t)):(t.batch.flush(),this._renderDirect(t))},rc.prototype._populateBatches=function(){var t=this._geometry,e=this.blendMode,i=t.batches.length;this.batchTint=-1,this._transformID=-1,this.batchDirty=t.batchDirty,this.batches.length=i,this.vertexData=new Float32Array(t.points);for(var n=0;n<i;n++){var r=t.batches[n],s=r.style.color,o=new Float32Array(this.vertexData.buffer,4*r.attribStart*2,2*r.attribSize),a=new Float32Array(t.uvsFloat32.buffer,4*r.attribStart*2,2*r.attribSize),l={vertexData:o,blendMode:e,indices:new Uint16Array(t.indicesUint16.buffer,2*r.start,r.size),uvs:a,_batchRGB:$e(s),_tintRGB:s,_texture:r.style.texture,alpha:r.style.alpha,worldAlpha:1};this.batches[n]=l}},rc.prototype._renderBatched=function(t){if(this.batches.length){t.batch.setObjectRenderer(t.plugins[this.pluginName]),this.calculateVertices(),this.calculateTints();for(var e=0,i=this.batches.length;e<i;e++){var n=this.batches[e];n.worldAlpha=this.worldAlpha*n.alpha,t.plugins[this.pluginName].render(n)}}},rc.prototype._renderDirect=function(t){var e=this._resolveDirectShader(t),i=this._geometry,n=this.tint,r=this.worldAlpha,s=e.uniforms,o=i.drawCalls;s.translationMatrix=this.transform.worldTransform,s.tint[0]=(n>>16&255)/255*r,s.tint[1]=(n>>8&255)/255*r,s.tint[2]=(255&n)/255*r,s.tint[3]=r,t.shader.bind(e),t.geometry.bind(i,e),t.state.set(this.state);for(var a=0,l=o.length;a<l;a++)this._renderDrawCallDirect(t,i.drawCalls[a])},rc.prototype._renderDrawCallDirect=function(t,e){for(var i=e.texArray,n=e.type,r=e.size,s=e.start,o=i.count,a=0;a<o;a++)t.texture.bind(i.elements[a],a);t.geometry.draw(n,r,s)},rc.prototype._resolveDirectShader=function(t){var e=this.shader,i=this.pluginName;if(!e){if(!qu[i]){for(var n=t.plugins.batch.MAX_TEXTURES,r=new Int32Array(n),s=0;s<n;s++)r[s]=s;var o={tint:new Float32Array([1,1,1,1]),translationMatrix:new Li,default:Qs.from({uSamplers:r},!0)},a=t.plugins[i]._shader.program;qu[i]=new ia(a,o)}e=qu[i]}return e},rc.prototype._calculateBounds=function(){this.finishPoly();var t=this._geometry;if(t.graphicsData.length){var e=t.bounds,i=e.minX,n=e.minY,r=e.maxX,s=e.maxY;this._bounds.addFrame(this.transform,i,n,r,s)}},rc.prototype.containsPoint=function(t){return this.worldTransform.applyInverse(t,rc._TEMP_POINT),this._geometry.containsPoint(rc._TEMP_POINT)},rc.prototype.calculateTints=function(){if(this.batchTint!==this.tint){this.batchTint=this.tint;for(var t=$e(this.tint,Yu),e=0;e<this.batches.length;e++){var i=this.batches[e],n=i._batchRGB,r=(t[0]*n[0]*255<<16)+(t[1]*n[1]*255<<8)+(0|t[2]*n[2]*255);i._tintRGB=(r>>16)+(65280&r)+((255&r)<<16)}}},rc.prototype.calculateVertices=function(){var t=this.transform._worldID;if(this._transformID!==t){this._transformID=t;for(var e=this.transform.worldTransform,i=e.a,n=e.b,r=e.c,s=e.d,o=e.tx,a=e.ty,l=this._geometry.points,h=this.vertexData,u=0,c=0;c<l.length;c+=2){var d=l[c],p=l[c+1];h[u++]=i*d+r*p+o,h[u++]=s*p+n*d+a}}},rc.prototype.closePath=function(){var t=this.currentPath;return t&&(t.closeStroke=!0,this.finishPoly()),this},rc.prototype.setMatrix=function(t){return this._matrix=t,this},rc.prototype.beginHole=function(){return this.finishPoly(),this._holeMode=!0,this},rc.prototype.endHole=function(){return this.finishPoly(),this._holeMode=!1,this},rc.prototype.destroy=function(t){this._geometry.refCount--,0===this._geometry.refCount&&this._geometry.dispose(),this._matrix=null,this.currentPath=null,this._lineStyle.destroy(),this._lineStyle=null,this._fillStyle.destroy(),this._fillStyle=null,this._geometry=null,this.shader=null,this.vertexData=null,this.batches.length=0,this.batches=null,Lu.prototype.destroy.call(this,t)},rc._TEMP_POINT=new Fi,rc),$u={buildPoly:pu,buildCircle:fu,buildRectangle:gu,buildRoundedRectangle:_u,buildLine:wu,ArcUtils:xu,BezierUtils:Tu,QuadraticUtils:Iu,BatchPart:Pu,FILL_COMMANDS:Cu,BATCH_POOL:Eu,DRAW_CALL_POOL:Au},Qu=function(t,e){return(Qu=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},Ju=new Fi,Zu=new Uint16Array([0,1,2,0,2,3]),tc=(Qu(Fu=ic,Nu=Du=tr),Fu.prototype=null===Nu?Object.create(Nu):(nc.prototype=Nu.prototype,new nc),ic.prototype._onTextureUpdate=function(){this._textureID=-1,this._textureTrimmedID=-1,this._cachedTint=16777215,this._width&&(this.scale.x=di(this.scale.x)*this._width/this._texture.orig.width),this._height&&(this.scale.y=di(this.scale.y)*this._height/this._texture.orig.height)},ic.prototype._onAnchorUpdate=function(){this._transformID=-1,this._transformTrimmedID=-1},ic.prototype.calculateVertices=function(){var t=this._texture;if(this._transformID!==this.transform._worldID||this._textureID!==t._updateID){this._textureID!==t._updateID&&(this.uvs=this._texture._uvs.uvsFloat32),this._transformID=this.transform._worldID,this._textureID=t._updateID;var e=this.transform.worldTransform,i=e.a,n=e.b,r=e.c,s=e.d,o=e.tx,a=e.ty,l=this.vertexData,h=t.trim,u=t.orig,c=this._anchor,d=0,p=0,f=0,g=0;if(f=h?(d=(p=h.x-c._x*u.width)+h.width,(g=h.y-c._y*u.height)+h.height):(d=(p=-c._x*u.width)+u.width,(g=-c._y*u.height)+u.height),l[0]=i*p+r*g+o,l[1]=s*g+n*p+a,l[2]=i*d+r*g+o,l[3]=s*g+n*d+a,l[4]=i*d+r*f+o,l[5]=s*f+n*d+a,l[6]=i*p+r*f+o,l[7]=s*f+n*p+a,this._roundPixels)for(var m=Tt.RESOLUTION,y=0;y<l.length;++y)l[y]=Math.round((l[y]*m|0)/m)}},ic.prototype.calculateTrimmedVertices=function(){if(this.vertexTrimmedData){if(this._transformTrimmedID===this.transform._worldID&&this._textureTrimmedID===this._texture._updateID)return}else this.vertexTrimmedData=new Float32Array(8);this._transformTrimmedID=this.transform._worldID,this._textureTrimmedID=this._texture._updateID;var t=this._texture,e=this.vertexTrimmedData,i=t.orig,n=this._anchor,r=this.transform.worldTransform,s=r.a,o=r.b,a=r.c,l=r.d,h=r.tx,u=r.ty,c=-n._x*i.width,d=c+i.width,p=-n._y*i.height,f=p+i.height;e[0]=s*c+a*p+h,e[1]=l*p+o*c+u,e[2]=s*d+a*p+h,e[3]=l*p+o*d+u,e[4]=s*d+a*f+h,e[5]=l*f+o*d+u,e[6]=s*c+a*f+h,e[7]=l*f+o*c+u},ic.prototype._render=function(t){this.calculateVertices(),t.batch.setObjectRenderer(t.plugins[this.pluginName]),t.plugins[this.pluginName].render(this)},ic.prototype._calculateBounds=function(){var t=this._texture.trim,e=this._texture.orig;!t||t.width===e.width&&t.height===e.height?(this.calculateVertices(),this._bounds.addQuad(this.vertexData)):(this.calculateTrimmedVertices(),this._bounds.addQuad(this.vertexTrimmedData))},ic.prototype.getLocalBounds=function(t){return 0===this.children.length?(this._bounds.minX=this._texture.orig.width*-this._anchor._x,this._bounds.minY=this._texture.orig.height*-this._anchor._y,this._bounds.maxX=this._texture.orig.width*(1-this._anchor._x),this._bounds.maxY=this._texture.orig.height*(1-this._anchor._y),t||(this._localBoundsRect||(this._localBoundsRect=new Bi),t=this._localBoundsRect),this._bounds.getRectangle(t)):Du.prototype.getLocalBounds.call(this,t)},ic.prototype.containsPoint=function(t){this.worldTransform.applyInverse(t,Ju);var e=this._texture.orig.width,i=this._texture.orig.height,n=-e*this.anchor.x,r=0;return Ju.x>=n&&Ju.x<n+e&&(r=-i*this.anchor.y,Ju.y>=r&&Ju.y<r+i)},ic.prototype.destroy=function(t){if(Du.prototype.destroy.call(this,t),this._texture.off("update",this._onTextureUpdate,this),this._anchor=null,"boolean"==typeof t?t:t&&t.texture){var e="boolean"==typeof t?t:t&&t.baseTexture;this._texture.destroy(!!e)}this._texture=null},ic.from=function(t,e){return new ic(t instanceof Cs?t:Cs.from(t,e))},Object.defineProperty(ic.prototype,"roundPixels",{get:function(){return this._roundPixels},set:function(t){this._roundPixels!==t&&(this._transformID=-1),this._roundPixels=t},enumerable:!1,configurable:!0}),Object.defineProperty(ic.prototype,"width",{get:function(){return Math.abs(this.scale.x)*this._texture.orig.width},set:function(t){var e=di(this.scale.x)||1;this.scale.x=e*t/this._texture.orig.width,this._width=t},enumerable:!1,configurable:!0}),Object.defineProperty(ic.prototype,"height",{get:function(){return Math.abs(this.scale.y)*this._texture.orig.height},set:function(t){var e=di(this.scale.y)||1;this.scale.y=e*t/this._texture.orig.height,this._height=t},enumerable:!1,configurable:!0}),Object.defineProperty(ic.prototype,"anchor",{get:function(){return this._anchor},set:function(t){this._anchor.copyFrom(t)},enumerable:!1,configurable:!0}),Object.defineProperty(ic.prototype,"tint",{get:function(){return this._tint},set:function(t){this._tint=t,this._tintRGB=(t>>16)+(65280&t)+((255&t)<<16)},enumerable:!1,configurable:!0}),Object.defineProperty(ic.prototype,"texture",{get:function(){return this._texture},set:function(t){this._texture!==t&&(this._texture&&this._texture.off("update",this._onTextureUpdate,this),this._texture=t||Cs.EMPTY,this._cachedTint=16777215,this._textureID=-1,this._textureTrimmedID=-1,t&&(t.baseTexture.valid?this._onTextureUpdate():t.once("update",this._onTextureUpdate,this)))},enumerable:!1,configurable:!0}),ic),ec=function(t,e){return(ec=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)};function ic(t){var e=Du.call(this)||this;return e._anchor=new Ni(e._onAnchorUpdate,e,t?t.defaultAnchor.x:0,t?t.defaultAnchor.y:0),e._texture=null,e._width=0,e._height=0,e._tint=null,e._tintRGB=null,e.tint=16777215,e.blendMode=nt.BLEND_MODES.NORMAL,e._cachedTint=16777215,e.uvs=null,e.texture=t||Cs.EMPTY,e.vertexData=new Float32Array(8),e.vertexTrimmedData=null,e._transformID=-1,e._textureID=-1,e._transformTrimmedID=-1,e._textureTrimmedID=-1,e.indices=Zu,e.pluginName="batch",e.isSprite=!0,e._roundPixels=Tt.ROUND_PIXELS,e}function nc(){this.constructor=Fu}function rc(t){void 0===t&&(t=null);var e=Lu.call(this)||this;return e.shader=null,e.pluginName="batch",e.currentPath=null,e.batches=[],e.batchTint=-1,e.batchDirty=-1,e.vertexData=null,e._fillStyle=new hu,e._lineStyle=new Vu,e._matrix=null,e._holeMode=!1,e.state=na.for2d(),e._geometry=t||new ju,e._geometry.refCount++,e._transformID=-1,e.tint=16777215,e.blendMode=nt.BLEND_MODES.NORMAL,e}function sc(){var t=null!==Uu&&Uu.apply(this,arguments)||this;return t.width=0,t.alignment=.5,t.native=!1,t.cap=nt.LINE_CAP.BUTT,t.join=nt.LINE_JOIN.MITER,t.miterLimit=10,t}function oc(){var t=zu.call(this)||this;return t.closePointEps=1e-4,t.boundsPadding=0,t.uvsFloat32=null,t.indicesUint16=null,t.batchable=!1,t.points=[],t.colors=[],t.uvs=[],t.indices=[],t.textureIds=[],t.graphicsData=[],t.drawCalls=[],t.batchDirty=-1,t.batches=[],t.dirty=0,t.cacheDirty=-1,t.clearDirty=0,t.shapeIndex=0,t._bounds=new rn,t.boundsDirty=-1,t}function ac(t,e,i,n){void 0===e&&(e=null),void 0===i&&(i=null),void 0===n&&(n=null),this.points=[],this.holes=[],this.shape=t,this.lineStyle=i,this.fillStyle=e,this.matrix=n,this.type=t.type}(Wu=nt.TEXT_GRADIENT||(nt.TEXT_GRADIENT={}))[Wu.LINEAR_VERTICAL=0]="LINEAR_VERTICAL";var lc={align:"left",breakWords:!(Wu[Wu.LINEAR_HORIZONTAL=1]="LINEAR_HORIZONTAL"),dropShadow:!1,dropShadowAlpha:1,dropShadowAngle:Math.PI/6,dropShadowBlur:0,dropShadowColor:"black",dropShadowDistance:5,fill:"black",fillGradientType:nt.TEXT_GRADIENT.LINEAR_VERTICAL,fillGradientStops:[],fontFamily:"Arial",fontSize:26,fontStyle:"normal",fontVariant:"normal",fontWeight:"normal",letterSpacing:0,lineHeight:0,lineJoin:"miter",miterLimit:10,padding:0,stroke:"black",strokeThickness:0,textBaseline:"alphabetic",trim:!1,whiteSpace:"pre",wordWrap:!1,wordWrapWidth:100,leading:0},hc=["serif","sans-serif","monospace","cursive","fantasy","system-ui"],uc=(cc.prototype.clone=function(){var t={};return fc(t,this,lc),new cc(t)},cc.prototype.reset=function(){fc(this,lc,lc)},Object.defineProperty(cc.prototype,"align",{get:function(){return this._align},set:function(t){this._align!==t&&(this._align=t,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(cc.prototype,"breakWords",{get:function(){return this._breakWords},set:function(t){this._breakWords!==t&&(this._breakWords=t,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(cc.prototype,"dropShadow",{get:function(){return this._dropShadow},set:function(t){this._dropShadow!==t&&(this._dropShadow=t,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(cc.prototype,"dropShadowAlpha",{get:function(){return this._dropShadowAlpha},set:function(t){this._dropShadowAlpha!==t&&(this._dropShadowAlpha=t,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(cc.prototype,"dropShadowAngle",{get:function(){return this._dropShadowAngle},set:function(t){this._dropShadowAngle!==t&&(this._dropShadowAngle=t,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(cc.prototype,"dropShadowBlur",{get:function(){return this._dropShadowBlur},set:function(t){this._dropShadowBlur!==t&&(this._dropShadowBlur=t,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(cc.prototype,"dropShadowColor",{get:function(){return this._dropShadowColor},set:function(t){var e=pc(t);this._dropShadowColor!==e&&(this._dropShadowColor=e,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(cc.prototype,"dropShadowDistance",{get:function(){return this._dropShadowDistance},set:function(t){this._dropShadowDistance!==t&&(this._dropShadowDistance=t,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(cc.prototype,"fill",{get:function(){return this._fill},set:function(t){var e=pc(t);this._fill!==e&&(this._fill=e,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(cc.prototype,"fillGradientType",{get:function(){return this._fillGradientType},set:function(t){this._fillGradientType!==t&&(this._fillGradientType=t,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(cc.prototype,"fillGradientStops",{get:function(){return this._fillGradientStops},set:function(t){!function(t,e){if(!Array.isArray(t)||!Array.isArray(e))return 0;if(t.length!==e.length)return 0;for(var i=0;i<t.length;++i)if(t[i]!==e[i])return 0;return 1}(this._fillGradientStops,t)&&(this._fillGradientStops=t,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(cc.prototype,"fontFamily",{get:function(){return this._fontFamily},set:function(t){this.fontFamily!==t&&(this._fontFamily=t,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(cc.prototype,"fontSize",{get:function(){return this._fontSize},set:function(t){this._fontSize!==t&&(this._fontSize=t,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(cc.prototype,"fontStyle",{get:function(){return this._fontStyle},set:function(t){this._fontStyle!==t&&(this._fontStyle=t,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(cc.prototype,"fontVariant",{get:function(){return this._fontVariant},set:function(t){this._fontVariant!==t&&(this._fontVariant=t,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(cc.prototype,"fontWeight",{get:function(){return this._fontWeight},set:function(t){this._fontWeight!==t&&(this._fontWeight=t,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(cc.prototype,"letterSpacing",{get:function(){return this._letterSpacing},set:function(t){this._letterSpacing!==t&&(this._letterSpacing=t,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(cc.prototype,"lineHeight",{get:function(){return this._lineHeight},set:function(t){this._lineHeight!==t&&(this._lineHeight=t,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(cc.prototype,"leading",{get:function(){return this._leading},set:function(t){this._leading!==t&&(this._leading=t,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(cc.prototype,"lineJoin",{get:function(){return this._lineJoin},set:function(t){this._lineJoin!==t&&(this._lineJoin=t,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(cc.prototype,"miterLimit",{get:function(){return this._miterLimit},set:function(t){this._miterLimit!==t&&(this._miterLimit=t,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(cc.prototype,"padding",{get:function(){return this._padding},set:function(t){this._padding!==t&&(this._padding=t,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(cc.prototype,"stroke",{get:function(){return this._stroke},set:function(t){var e=pc(t);this._stroke!==e&&(this._stroke=e,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(cc.prototype,"strokeThickness",{get:function(){return this._strokeThickness},set:function(t){this._strokeThickness!==t&&(this._strokeThickness=t,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(cc.prototype,"textBaseline",{get:function(){return this._textBaseline},set:function(t){this._textBaseline!==t&&(this._textBaseline=t,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(cc.prototype,"trim",{get:function(){return this._trim},set:function(t){this._trim!==t&&(this._trim=t,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(cc.prototype,"whiteSpace",{get:function(){return this._whiteSpace},set:function(t){this._whiteSpace!==t&&(this._whiteSpace=t,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(cc.prototype,"wordWrap",{get:function(){return this._wordWrap},set:function(t){this._wordWrap!==t&&(this._wordWrap=t,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(cc.prototype,"wordWrapWidth",{get:function(){return this._wordWrapWidth},set:function(t){this._wordWrapWidth!==t&&(this._wordWrapWidth=t,this.styleID++)},enumerable:!1,configurable:!0}),cc.prototype.toFontString=function(){var t="number"==typeof this.fontSize?this.fontSize+"px":this.fontSize,e=this.fontFamily;Array.isArray(this.fontFamily)||(e=this.fontFamily.split(","));for(var i=e.length-1;0<=i;i--){var n=e[i].trim();!/([\"\'])[^\'\"]+\1/.test(n)&&hc.indexOf(n)<0&&(n='"'+n+'"'),e[i]=n}return this.fontStyle+" "+this.fontVariant+" "+this.fontWeight+" "+t+" "+e.join(",")},cc);function cc(t){this.styleID=0,this.reset(),fc(this,t,t)}function dc(t){return"number"==typeof t?Qe(t):("string"==typeof t&&0===t.indexOf("0x")&&(t=t.replace("0x","#")),t)}function pc(t){if(Array.isArray(t)){for(var e=0;e<t.length;++e)t[e]=dc(t[e]);return t}return dc(t)}function fc(t,e,i){for(var n in i)Array.isArray(e[n])?t[n]=e[n].slice():t[n]=e[n]}var gc=(yc.measureText=function(t,e,i,n){void 0===n&&(n=yc._canvas),i=null==i?e.wordWrap:i;var r=e.toFontString(),s=yc.measureFont(r);0===s.fontSize&&(s.fontSize=e.fontSize,s.ascent=e.fontSize);var o=n.getContext("2d");o.font=r;for(var a=(i?yc.wordWrap(t,e,n):t).split(/(?:\r\n|\r|\n)/),l=new Array(a.length),h=0,u=0;u<a.length;u++){var c=o.measureText(a[u]).width+(a[u].length-1)*e.letterSpacing;l[u]=c,h=Math.max(h,c)}var d=h+e.strokeThickness;e.dropShadow&&(d+=e.dropShadowDistance);var p=e.lineHeight||s.fontSize+e.strokeThickness,f=Math.max(p,s.fontSize+e.strokeThickness)+(a.length-1)*(p+e.leading);return e.dropShadow&&(f+=e.dropShadowDistance),new yc(t,e,d,f,a,l,p+e.leading,h,s)},yc.wordWrap=function(t,e,i){void 0===i&&(i=yc._canvas);for(var n=i.getContext("2d"),r=0,s="",o="",a=Object.create(null),l=e.letterSpacing,h=e.whiteSpace,u=yc.collapseSpaces(h),c=yc.collapseNewlines(h),d=!u,p=e.wordWrapWidth+l,f=yc.tokenize(t),g=0;g<f.length;g++){var m=f[g];if(yc.isNewline(m)){if(!c){o+=yc.addLine(s),d=!u,s="",r=0;continue}m=" "}if(u){var y=yc.isBreakingSpace(m),_=yc.isBreakingSpace(s[s.length-1]);if(y&&_)continue}var v=yc.getFromCache(m,l,a,n);if(p<v)if(""!==s&&(o+=yc.addLine(s),s="",r=0),yc.canBreakWords(m,e.breakWords))for(var b=yc.wordWrapSplit(m),w=0;w<b.length;w++){for(var S=b[w],x=1;b[w+x];){var T=b[w+x],I=S[S.length-1];if(yc.canBreakChars(I,T,m,w,e.breakWords))break;S+=T,x++}w+=S.length-1;var P=yc.getFromCache(S,l,a,n);p<P+r&&(o+=yc.addLine(s),d=!1,s="",r=0),s+=S,r+=P}else{0<s.length&&(o+=yc.addLine(s),s="",r=0);var C=g===f.length-1;o+=yc.addLine(m,!C),d=!1,s="",r=0}else p<v+r&&(d=!1,o+=yc.addLine(s),s="",r=0),(0<s.length||!yc.isBreakingSpace(m)||d)&&(s+=m,r+=v)}return o+yc.addLine(s,!1)},yc.addLine=function(t,e){return void 0===e&&(e=!0),t=yc.trimRight(t),e?t+"\n":t},yc.getFromCache=function(t,e,i,n){var r=i[t];if("number"!=typeof r){var s=t.length*e;r=n.measureText(t).width+s,i[t]=r}return r},yc.collapseSpaces=function(t){return"normal"===t||"pre-line"===t},yc.collapseNewlines=function(t){return"normal"===t},yc.trimRight=function(t){if("string"!=typeof t)return"";for(var e=t.length-1;0<=e;e--){var i=t[e];if(!yc.isBreakingSpace(i))break;t=t.slice(0,-1)}return t},yc.isNewline=function(t){return"string"==typeof t&&0<=yc._newlines.indexOf(t.charCodeAt(0))},yc.isBreakingSpace=function(t,e){return"string"==typeof t&&0<=yc._breakingSpaces.indexOf(t.charCodeAt(0))},yc.tokenize=function(t){var e=[],i="";if("string"!=typeof t)return e;for(var n=0;n<t.length;n++){var r=t[n],s=t[n+1];yc.isBreakingSpace(r,s)||yc.isNewline(r)?(""!==i&&(e.push(i),i=""),e.push(r)):i+=r}return""!==i&&e.push(i),e},yc.canBreakWords=function(t,e){return e},yc.canBreakChars=function(t,e,i,n,r){return!0},yc.wordWrapSplit=function(t){return t.split("")},yc.measureFont=function(t){if(yc._fonts[t])return yc._fonts[t];var e={ascent:0,descent:0,fontSize:0},i=yc._canvas,n=yc._context;n.font=t;var r=yc.METRICS_STRING+yc.BASELINE_SYMBOL,s=Math.ceil(n.measureText(r).width),o=Math.ceil(n.measureText(yc.BASELINE_SYMBOL).width),a=Math.ceil(yc.HEIGHT_MULTIPLIER*o);o=o*yc.BASELINE_MULTIPLIER|0,i.width=s,i.height=a,n.fillStyle="#f00",n.fillRect(0,0,s,a),n.font=t,n.textBaseline="alphabetic",n.fillStyle="#000",n.fillText(r,0,o);var l=n.getImageData(0,0,s,a).data,h=l.length,u=4*s,c=0,d=0,p=!1;for(c=0;c<o;++c){for(var f=0;f<u;f+=4)if(255!==l[d+f]){p=!0;break}if(p)break;d+=u}for(e.ascent=o-c,d=h-u,p=!1,c=a;o<c;--c){for(f=0;f<u;f+=4)if(255!==l[d+f]){p=!0;break}if(p)break;d-=u}return e.descent=c-o,e.fontSize=e.ascent+e.descent,yc._fonts[t]=e},yc.clearMetrics=function(t){void 0===t&&(t=""),t?delete yc._fonts[t]:yc._fonts={}},yc),mc=function(){try{var t=new OffscreenCanvas(0,0),e=t.getContext("2d");return e&&e.measureText?t:document.createElement("canvas")}catch(t){return document.createElement("canvas")}}();function yc(t,e,i,n,r,s,o,a,l){this.text=t,this.style=e,this.width=i,this.height=n,this.lines=r,this.lineWidths=s,this.lineHeight=o,this.maxLineWidth=a,this.fontProperties=l}mc.width=mc.height=10,gc._canvas=mc,gc._context=mc.getContext("2d"),gc._fonts={},gc.METRICS_STRING="|ÉqÅ",gc.BASELINE_SYMBOL="M",gc.BASELINE_MULTIPLIER=1.4,gc.HEIGHT_MULTIPLIER=2,gc._newlines=[10,13];var _c,vc,bc,wc={texture:!0,children:!(gc._breakingSpaces=[9,32,8192,8193,8194,8195,8196,8197,8198,8200,8201,8202,8287,12288]),baseTexture:!0},Sc=(ec(vc=xc,bc=_c=tc),vc.prototype=null===bc?Object.create(bc):(Tc.prototype=bc.prototype,new Tc),xc.prototype.updateText=function(t){var e=this._style;if(this.localStyleID!==e.styleID&&(this.dirty=!0,this.localStyleID=e.styleID),this.dirty||!t){this._font=this._style.toFontString();var i,n,r=this.context,s=gc.measureText(this._text||" ",this._style,this._style.wordWrap,this.canvas),o=s.width,a=s.height,l=s.lines,h=s.lineHeight,u=s.lineWidths,c=s.maxLineWidth,d=s.fontProperties;this.canvas.width=Math.ceil(Math.ceil(Math.max(1,o)+2*e.padding)*this._resolution),this.canvas.height=Math.ceil(Math.ceil(Math.max(1,a)+2*e.padding)*this._resolution),r.scale(this._resolution,this._resolution),r.clearRect(0,0,this.canvas.width,this.canvas.height),r.font=this._font,r.lineWidth=e.strokeThickness,r.textBaseline=e.textBaseline,r.lineJoin=e.lineJoin,r.miterLimit=e.miterLimit;for(var p=e.dropShadow?2:1,f=0;f<p;++f){var g=e.dropShadow&&0===f,m=g?Math.ceil(Math.max(1,a)+2*e.padding):0,y=m*this._resolution;if(g){r.fillStyle="black",r.strokeStyle="black";var _=e.dropShadowColor,v=$e("number"==typeof _?_:Je(_));r.shadowColor="rgba("+255*v[0]+","+255*v[1]+","+255*v[2]+","+e.dropShadowAlpha+")",r.shadowBlur=e.dropShadowBlur,r.shadowOffsetX=Math.cos(e.dropShadowAngle)*e.dropShadowDistance,r.shadowOffsetY=Math.sin(e.dropShadowAngle)*e.dropShadowDistance+y}else r.fillStyle=this._generateFillStyle(e,l,s),r.strokeStyle=e.stroke,r.shadowColor="black",r.shadowBlur=0,r.shadowOffsetX=0,r.shadowOffsetY=0;var b=(h-d.fontSize)/2;(!xc.nextLineHeightBehavior||h-d.fontSize<0)&&(b=0);for(var w=0;w<l.length;w++)i=e.strokeThickness/2,n=e.strokeThickness/2+w*h+d.ascent+b,"right"===e.align?i+=c-u[w]:"center"===e.align&&(i+=(c-u[w])/2),e.stroke&&e.strokeThickness&&this.drawLetterSpacing(l[w],i+e.padding,n+e.padding-m,!0),e.fill&&this.drawLetterSpacing(l[w],i+e.padding,n+e.padding-m)}this.updateTexture()}},xc.prototype.drawLetterSpacing=function(t,e,i,n){void 0===n&&(n=!1);var r=this._style.letterSpacing,s="letterSpacing"in CanvasRenderingContext2D.prototype||"textLetterSpacing"in CanvasRenderingContext2D.prototype;if(0===r||s)return s&&(this.context.letterSpacing=r,this.context.textLetterSpacing=r),void(n?this.context.strokeText(t,e,i):this.context.fillText(t,e,i));for(var o=e,a=Array.from?Array.from(t):t.split(""),l=this.context.measureText(t).width,h=0,u=0;u<a.length;++u){var c=a[u];n?this.context.strokeText(c,o,i):this.context.fillText(c,o,i),o+=l-(h=this.context.measureText(t.substring(u+1)).width)+r,l=h}},xc.prototype.updateTexture=function(){var t=this.canvas;if(this._style.trim){var e=wi(t);e.data&&(t.width=e.width,t.height=e.height,this.context.putImageData(e.data,0,0))}var i=this._texture,n=this._style,r=n.trim?0:n.padding,s=i.baseTexture;i.trim.width=i._frame.width=t.width/this._resolution,i.trim.height=i._frame.height=t.height/this._resolution,i.trim.x=-r,i.trim.y=-r,i.orig.width=i._frame.width-2*r,i.orig.height=i._frame.height-2*r,this._onTextureUpdate(),s.setRealSize(t.width,t.height,this._resolution),i.updateUvs(),this._recursivePostUpdateTransform(),this.dirty=!1},xc.prototype._render=function(t){this._autoResolution&&this._resolution!==t.resolution&&(this._resolution=t.resolution,this.dirty=!0),this.updateText(!0),_c.prototype._render.call(this,t)},xc.prototype.getLocalBounds=function(t){return this.updateText(!0),_c.prototype.getLocalBounds.call(this,t)},xc.prototype._calculateBounds=function(){this.updateText(!0),this.calculateVertices(),this._bounds.addQuad(this.vertexData)},xc.prototype._generateFillStyle=function(t,e,i){var n,r=t.fill;if(!Array.isArray(r))return r;if(1===r.length)return r[0];var s=t.dropShadow?t.dropShadowDistance:0,o=t.padding||0,a=this.canvas.width/this._resolution-s-2*o,l=this.canvas.height/this._resolution-s-2*o,h=r.slice(),u=t.fillGradientStops.slice();if(!u.length)for(var c=h.length+1,d=1;d<c;++d)u.push(d/c);if(h.unshift(r[0]),u.unshift(0),h.push(r[r.length-1]),u.push(1),t.fillGradientType===nt.TEXT_GRADIENT.LINEAR_VERTICAL){n=this.context.createLinearGradient(a/2,o,a/2,l+o);var p=i.fontProperties.fontSize+t.strokeThickness;for(d=0;d<e.length;d++){var f=i.lineHeight*(d-1)+p,g=i.lineHeight*d,m=g;0<d&&g<f&&(m=(g+f)/2);var y=g+p,_=i.lineHeight*(d+1),v=y;d+1<e.length&&_<y&&(v=(y+_)/2);for(var b=(v-m)/l,w=0;w<h.length;w++){var S;S="number"==typeof u[w]?u[w]:w/h.length;var x=Math.min(1,Math.max(0,m/l+S*b));x=Number(x.toFixed(5)),n.addColorStop(x,h[w])}}}else{n=this.context.createLinearGradient(o,l/2,a+o,l/2);var T=h.length+1,I=1;for(d=0;d<h.length;d++){var P;P="number"==typeof u[d]?u[d]:I/T,n.addColorStop(P,h[d]),I++}}return n},xc.prototype.destroy=function(t){"boolean"==typeof t&&(t={children:t}),t=Object.assign({},wc,t),_c.prototype.destroy.call(this,t),this._ownCanvas&&(this.canvas.height=this.canvas.width=0),this.context=null,this.canvas=null,this._style=null},Object.defineProperty(xc.prototype,"width",{get:function(){return this.updateText(!0),Math.abs(this.scale.x)*this._texture.orig.width},set:function(t){this.updateText(!0);var e=di(this.scale.x)||1;this.scale.x=e*t/this._texture.orig.width,this._width=t},enumerable:!1,configurable:!0}),Object.defineProperty(xc.prototype,"height",{get:function(){return this.updateText(!0),Math.abs(this.scale.y)*this._texture.orig.height},set:function(t){this.updateText(!0);var e=di(this.scale.y)||1;this.scale.y=e*t/this._texture.orig.height,this._height=t},enumerable:!1,configurable:!0}),Object.defineProperty(xc.prototype,"style",{get:function(){return this._style},set:function(t){t=t||{},this._style=t instanceof uc?t:new uc(t),this.localStyleID=-1,this.dirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(xc.prototype,"text",{get:function(){return this._text},set:function(t){t=String(null==t?"":t),this._text!==t&&(this._text=t,this.dirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(xc.prototype,"resolution",{get:function(){return this._resolution},set:function(t){this._autoResolution=!1,this._resolution!==t&&(this._resolution=t,this.dirty=!0)},enumerable:!1,configurable:!0}),xc.nextLineHeightBehavior=!1,xc);function xc(t,e,i){var n=this,r=!1;i||(i=document.createElement("canvas"),r=!0),i.width=3,i.height=3;var s=Cs.from(i);return s.orig=new Bi,s.trim=new Bi,(n=_c.call(this,s)||this)._ownCanvas=r,n.canvas=i,n.context=n.canvas.getContext("2d"),n._resolution=Tt.RESOLUTION,n._autoResolution=!0,n._text=null,n._style=null,n._styleListener=null,n._font="",n.text=t,n.style=e,n.localStyleID=-1,n}function Tc(){this.constructor=vc}Tt.UPLOADS_PER_FRAME=4;var Ic=function(t,e){return(Ic=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},Pc=(Cc.prototype.beginFrame=function(){this.itemsLeft=this.maxItemsPerFrame},Cc.prototype.allowedToUpload=function(){return 0<this.itemsLeft--},Cc);function Cc(t){this.maxItemsPerFrame=t,this.itemsLeft=0}function Ec(t,e){var i=!1;if(t&&t._textures&&t._textures.length)for(var n=0;n<t._textures.length;n++)if(t._textures[n]instanceof Cs){var r=t._textures[n].baseTexture;-1===e.indexOf(r)&&(e.push(r),i=!0)}return i}function Ac(t,e){if(t.baseTexture instanceof $r){var i=t.baseTexture;return-1===e.indexOf(i)&&e.push(i),!0}return!1}function Mc(t,e){if(t._texture&&t._texture instanceof Cs){var i=t._texture.baseTexture;return-1===e.indexOf(i)&&e.push(i),!0}return!1}function Bc(t,e){return e instanceof Sc&&(e.updateText(!0),!0)}function Rc(t,e){if(e instanceof uc){var i=e.toFontString();return gc.measureFont(i),!0}return!1}function Oc(t,e){if(t instanceof Sc){-1===e.indexOf(t.style)&&e.push(t.style),-1===e.indexOf(t)&&e.push(t);var i=t._texture.baseTexture;return-1===e.indexOf(i)&&e.push(i),!0}return!1}function kc(t,e){return t instanceof uc&&(-1===e.indexOf(t)&&e.push(t),!0)}var Dc=(Fc.prototype.upload=function(t,e){"function"==typeof t&&(e=t,t=null),t&&this.add(t),this.queue.length?(e&&this.completes.push(e),this.ticking||(this.ticking=!0,ar.system.addOnce(this.tick,this,nt.UPDATE_PRIORITY.UTILITY))):e&&e()},Fc.prototype.tick=function(){setTimeout(this.delayedTick,0)},Fc.prototype.prepareItems=function(){for(this.limiter.beginFrame();this.queue.length&&this.limiter.allowedToUpload();){var t=this.queue[0],e=!1;if(t&&!t._destroyed)for(var i=0,n=this.uploadHooks.length;i<n;i++)if(this.uploadHooks[i](this.uploadHookHelper,t)){this.queue.shift(),e=!0;break}e||this.queue.shift()}if(this.queue.length)ar.system.addOnce(this.tick,this,nt.UPDATE_PRIORITY.UTILITY);else{this.ticking=!1;var r=this.completes.slice(0);for(i=this.completes.length=0,n=r.length;i<n;i++)r[i]()}},Fc.prototype.registerFindHook=function(t){return t&&this.addHooks.push(t),this},Fc.prototype.registerUploadHook=function(t){return t&&this.uploadHooks.push(t),this},Fc.prototype.add=function(t){for(var e=0,i=this.addHooks.length;e<i&&!this.addHooks[e](t,this.queue);e++);if(t instanceof tr)for(e=t.children.length-1;0<=e;e--)this.add(t.children[e]);return this},Fc.prototype.destroy=function(){this.ticking&&ar.system.remove(this.tick,this),this.ticking=!1,this.addHooks=null,this.uploadHooks=null,this.renderer=null,this.completes=null,this.queue=null,this.limiter=null,this.uploadHookHelper=null},Fc);function Fc(t){var e=this;this.limiter=new Pc(Tt.UPLOADS_PER_FRAME),this.renderer=t,this.uploadHookHelper=null,this.queue=[],this.addHooks=[],this.uploadHooks=[],this.completes=[],this.ticking=!1,this.delayedTick=function(){e.queue&&e.prepareItems()},this.registerFindHook(Oc),this.registerFindHook(kc),this.registerFindHook(Ec),this.registerFindHook(Ac),this.registerFindHook(Mc),this.registerUploadHook(Bc),this.registerUploadHook(Rc)}function Nc(t,e){return e instanceof $r&&(e._glTextures[t.CONTEXT_UID]||t.texture.bind(e),!0)}function Lc(t,e){if(!(e instanceof Ku))return!1;var i=e.geometry;e.finishPoly(),i.updateBatches();for(var n=i.batches,r=0;r<n.length;r++){var s=n[r].style.texture;s&&Nc(t,s.baseTexture)}return i.batchable||t.geometry.bind(i,e._resolveDirectShader(t)),!0}function Uc(t,e){return t instanceof Ku&&(e.push(t),!0)}var zc,Wc,Gc,Hc=(Ic(Wc=Qc,Gc=zc=Dc),Wc.prototype=null===Gc?Object.create(Gc):(Jc.prototype=Gc.prototype,new Jc),Qc),Xc=($c.prototype.beginFrame=function(){this.frameStart=Date.now()},$c.prototype.allowedToUpload=function(){return Date.now()-this.frameStart<this.maxMilliseconds},$c),jc=(Kc.prototype._updateResolution=function(t){void 0===t&&(t=null);var e=this.data.meta.scale,i=Ii(t,null);return null===i&&(i=void 0!==e?parseFloat(e):1),1!==i&&this.baseTexture.setResolution(i),i},Kc.prototype.parse=function(t){this._batchIndex=0,this._callback=t,this._frameKeys.length<=Kc.BATCH_SIZE?(this._processFrames(0),this._processAnimations(),this._parseComplete()):this._nextBatch()},Kc.prototype._processFrames=function(t){for(var e=t,i=Kc.BATCH_SIZE;e-t<i&&e<this._frameKeys.length;){var n=this._frameKeys[e],r=this._frames[n],s=r.frame;if(s){var o,a=null,l=!1!==r.trimmed&&r.sourceSize?r.sourceSize:r.frame,h=new Bi(0,0,Math.floor(l.w)/this.resolution,Math.floor(l.h)/this.resolution);o=r.rotated?new Bi(Math.floor(s.x)/this.resolution,Math.floor(s.y)/this.resolution,Math.floor(s.h)/this.resolution,Math.floor(s.w)/this.resolution):new Bi(Math.floor(s.x)/this.resolution,Math.floor(s.y)/this.resolution,Math.floor(s.w)/this.resolution,Math.floor(s.h)/this.resolution),!1!==r.trimmed&&r.spriteSourceSize&&(a=new Bi(Math.floor(r.spriteSourceSize.x)/this.resolution,Math.floor(r.spriteSourceSize.y)/this.resolution,Math.floor(s.w)/this.resolution,Math.floor(s.h)/this.resolution)),this.textures[n]=new Cs(this.baseTexture,o,h,a,r.rotated?2:0,r.anchor),Cs.addToCache(this.textures[n],n)}e++}},Kc.prototype._processAnimations=function(){var t=this.data.animations||{};for(var e in t){this.animations[e]=[];for(var i=0;i<t[e].length;i++){var n=t[e][i];this.animations[e].push(this.textures[n])}}},Kc.prototype._parseComplete=function(){var t=this._callback;this._callback=null,this._batchIndex=0,t.call(this,this.textures)},Kc.prototype._nextBatch=function(){var t=this;this._processFrames(this._batchIndex*Kc.BATCH_SIZE),this._batchIndex++,setTimeout(function(){t._batchIndex*Kc.BATCH_SIZE<t._frameKeys.length?t._nextBatch():(t._processAnimations(),t._parseComplete())},0)},Kc.prototype.destroy=function(t){var e;for(var i in void 0===t&&(t=!1),this.textures)this.textures[i].destroy();this._frames=null,this._frameKeys=null,this.data=null,this.textures=null,t&&(null===(e=this._texture)||void 0===e||e.destroy(),this.baseTexture.destroy()),this._texture=null,this.baseTexture=null},Kc.BATCH_SIZE=1e3,Kc),Vc=(qc.use=function(r,i){var t,e,s=this,n=r.name+"_image";if(r.data&&r.type===nt.LoaderResource.TYPE.JSON&&r.data.frames&&!s.resources[n]){var o=null===(e=null===(t=r.data)||void 0===t?void 0:t.meta)||void 0===e?void 0:e.related_multi_packs;if(Array.isArray(o))for(var a=function(t){if("string"!=typeof t)return"continue";var e=t.replace(".json",""),i=He.resolve(r.url.replace(s.baseUrl,""),t);if(s.resources[e]||Object.values(s.resources).some(function(t){return He.format(He.parse(t.url))===i}))return"continue";var n={crossOrigin:r.crossOrigin,loadType:nt.LoaderResource.LOAD_TYPE.XHR,xhrType:nt.LoaderResource.XHR_RESPONSE_TYPE.JSON,parentResource:r,metadata:r.metadata};s.add(e,i,n)},l=0,h=o;l<h.length;l++)a(h[l]);var u={crossOrigin:r.crossOrigin,metadata:r.metadata.imageMetadata,parentResource:r},c=qc.getResourcePath(r,s.baseUrl);s.add(n,c,u,function(t){if(t.error)i(t.error);else{var e=new jc(t.texture,r.data,r.url);e.parse(function(){r.spritesheet=e,r.textures=e.textures,i()})}})}else i()},qc.getResourcePath=function(t,e){return t.isDataUrl?t.data.meta.image:He.resolve(t.url.replace(e,""),t.data.meta.image)},qc),Yc=function(t,e){return(Yc=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)};function qc(){}function Kc(t,e,i){void 0===i&&(i=null),this._texture=t instanceof Cs?t:null,this.baseTexture=t instanceof $r?t:this._texture.baseTexture,this.textures={},this.animations={},this.data=e;var n=this.baseTexture.resource;this.resolution=this._updateResolution(i||(n?n.url:null)),this._frames=this.data.frames,this._frameKeys=Object.keys(this._frames),this._batchIndex=0,this._callback=null}function $c(t){this.maxMilliseconds=t,this.frameStart=0}function Qc(t){var e=zc.call(this,t)||this;return e.uploadHookHelper=e.renderer,e.registerFindHook(Uc),e.registerUploadHook(Nc),e.registerUploadHook(Lc),e}function Jc(){this.constructor=Wc}function Zc(t,e){function i(){this.constructor=t}Yc(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}var td,ed,id=new Fi,nd=(Zc(hd,ed=tc),Object.defineProperty(hd.prototype,"clampMargin",{get:function(){return this.uvMatrix.clampMargin},set:function(t){this.uvMatrix.clampMargin=t,this.uvMatrix.update(!0)},enumerable:!1,configurable:!0}),Object.defineProperty(hd.prototype,"tileScale",{get:function(){return this.tileTransform.scale},set:function(t){this.tileTransform.scale.copyFrom(t)},enumerable:!1,configurable:!0}),Object.defineProperty(hd.prototype,"tilePosition",{get:function(){return this.tileTransform.position},set:function(t){this.tileTransform.position.copyFrom(t)},enumerable:!1,configurable:!0}),hd.prototype._onTextureUpdate=function(){this.uvMatrix&&(this.uvMatrix.texture=this._texture),this._cachedTint=16777215},hd.prototype._render=function(t){var e=this._texture;e&&e.valid&&(this.tileTransform.updateLocalTransform(),this.uvMatrix.update(),t.batch.setObjectRenderer(t.plugins[this.pluginName]),t.plugins[this.pluginName].render(this))},hd.prototype._calculateBounds=function(){var t=this._width*-this._anchor._x,e=this._height*-this._anchor._y,i=this._width*(1-this._anchor._x),n=this._height*(1-this._anchor._y);this._bounds.addFrame(this.transform,t,e,i,n)},hd.prototype.getLocalBounds=function(t){return 0===this.children.length?(this._bounds.minX=this._width*-this._anchor._x,this._bounds.minY=this._height*-this._anchor._y,this._bounds.maxX=this._width*(1-this._anchor._x),this._bounds.maxY=this._height*(1-this._anchor._y),t||(this._localBoundsRect||(this._localBoundsRect=new Bi),t=this._localBoundsRect),this._bounds.getRectangle(t)):ed.prototype.getLocalBounds.call(this,t)},hd.prototype.containsPoint=function(t){this.worldTransform.applyInverse(t,id);var e=this._width,i=this._height,n=-e*this.anchor._x;if(id.x>=n&&id.x<n+e){var r=-i*this.anchor._y;if(id.y>=r&&id.y<r+i)return!0}return!1},hd.prototype.destroy=function(t){ed.prototype.destroy.call(this,t),this.tileTransform=null,this.uvMatrix=null},hd.from=function(t,e){return new hd(t instanceof Cs?t:Cs.from(t,e),e.width,e.height)},Object.defineProperty(hd.prototype,"width",{get:function(){return this._width},set:function(t){this._width=t},enumerable:!1,configurable:!0}),Object.defineProperty(hd.prototype,"height",{get:function(){return this._height},set:function(t){this._height=t},enumerable:!1,configurable:!0}),hd),rd="#version 100\n#define SHADER_NAME Tiling-Sprite-100\n\nprecision lowp float;\n\nattribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\nuniform mat3 translationMatrix;\nuniform mat3 uTransform;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = (uTransform * vec3(aTextureCoord, 1.0)).xy;\n}\n",sd=new Li,od=(Zc(ld,td=io),ld.prototype.contextChange=function(){var t=this.renderer,e={globals:t.globalUniforms};this.simpleShader=ia.from(rd,"#version 100\n#define SHADER_NAME Tiling-Sprite-Simple-100\n\nprecision lowp float;\n\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform vec4 uColor;\n\nvoid main(void)\n{\n    vec4 texSample = texture2D(uSampler, vTextureCoord);\n    gl_FragColor = texSample * uColor;\n}\n",e),this.shader=1<t.context.webGLVersion?ia.from("#version 300 es\n#define SHADER_NAME Tiling-Sprite-300\n\nprecision lowp float;\n\nin vec2 aVertexPosition;\nin vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\nuniform mat3 translationMatrix;\nuniform mat3 uTransform;\n\nout vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = (uTransform * vec3(aTextureCoord, 1.0)).xy;\n}\n","#version 300 es\n#define SHADER_NAME Tiling-Sprite-100\n\nprecision lowp float;\n\nin vec2 vTextureCoord;\n\nout vec4 fragmentColor;\n\nuniform sampler2D uSampler;\nuniform vec4 uColor;\nuniform mat3 uMapCoord;\nuniform vec4 uClampFrame;\nuniform vec2 uClampOffset;\n\nvoid main(void)\n{\n    vec2 coord = vTextureCoord + ceil(uClampOffset - vTextureCoord);\n    coord = (uMapCoord * vec3(coord, 1.0)).xy;\n    vec2 unclamped = coord;\n    coord = clamp(coord, uClampFrame.xy, uClampFrame.zw);\n\n    vec4 texSample = texture(uSampler, coord, unclamped == coord ? 0.0f : -32.0f);// lod-bias very negative to force lod 0\n\n    fragmentColor = texSample * uColor;\n}\n",e):ia.from(rd,"#version 100\n#ifdef GL_EXT_shader_texture_lod\n    #extension GL_EXT_shader_texture_lod : enable\n#endif\n#define SHADER_NAME Tiling-Sprite-100\n\nprecision lowp float;\n\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform vec4 uColor;\nuniform mat3 uMapCoord;\nuniform vec4 uClampFrame;\nuniform vec2 uClampOffset;\n\nvoid main(void)\n{\n    vec2 coord = vTextureCoord + ceil(uClampOffset - vTextureCoord);\n    coord = (uMapCoord * vec3(coord, 1.0)).xy;\n    vec2 unclamped = coord;\n    coord = clamp(coord, uClampFrame.xy, uClampFrame.zw);\n\n    #ifdef GL_EXT_shader_texture_lod\n        vec4 texSample = unclamped == coord\n            ? texture2D(uSampler, coord) \n            : texture2DLodEXT(uSampler, coord, 0);\n    #else\n        vec4 texSample = texture2D(uSampler, coord);\n    #endif\n\n    gl_FragColor = texSample * uColor;\n}\n",e)},ld.prototype.render=function(t){var e=this.renderer,i=this.quad,n=i.vertices;n[0]=n[6]=t._width*-t.anchor.x,n[1]=n[3]=t._height*-t.anchor.y,n[2]=n[4]=t._width*(1-t.anchor.x),n[5]=n[7]=t._height*(1-t.anchor.y);var r=t.uvRespectAnchor?t.anchor.x:0,s=t.uvRespectAnchor?t.anchor.y:0;(n=i.uvs)[0]=n[6]=-r,n[1]=n[3]=-s,n[2]=n[4]=1-r,n[5]=n[7]=1-s,i.invalidate();var o=t._texture,a=o.baseTexture,l=t.tileTransform.localTransform,h=t.uvMatrix,u=a.isPowerOfTwo&&o.frame.width===a.width&&o.frame.height===a.height;u&&(a._glTextures[e.CONTEXT_UID]?u=a.wrapMode!==nt.WRAP_MODES.CLAMP:a.wrapMode===nt.WRAP_MODES.CLAMP&&(a.wrapMode=nt.WRAP_MODES.REPEAT));var c=u?this.simpleShader:this.shader,d=o.width,p=o.height,f=t._width,g=t._height;sd.set(l.a*d/f,l.b*d/g,l.c*p/f,l.d*p/g,l.tx/f,l.ty/g),sd.invert(),u?sd.prepend(h.mapCoord):(c.uniforms.uMapCoord=h.mapCoord.toArray(!0),c.uniforms.uClampFrame=h.uClampFrame,c.uniforms.uClampOffset=h.uClampOffset),c.uniforms.uTransform=sd.toArray(!0),c.uniforms.uColor=ri(t.tint,t.worldAlpha,c.uniforms.uColor,a.alphaMode),c.uniforms.translationMatrix=t.transform.worldTransform.toArray(!0),c.uniforms.uSampler=o,e.shader.bind(c),e.geometry.bind(i),this.state.blendMode=ei(t.blendMode,a.alphaMode),e.state.set(this.state),e.geometry.draw(this.renderer.gl.TRIANGLES,6,0)},ld),ad=function(t,e){return(ad=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)};function ld(t){var e=td.call(this,t)||this;return t.runners.contextChange.add(e),e.quad=new Ks,e.state=na.for2d(),e}function hd(t,e,i){void 0===e&&(e=100),void 0===i&&(i=100);var n=ed.call(this,t)||this;return n.tileTransform=new en,n._width=e,n._height=i,n.uvMatrix=n.texture.uvMatrix||new oa(t),n.pluginName="tilingSprite",n.uvRespectAnchor=!1,n}function ud(t,e){function i(){this.constructor=t}ad(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}function cd(){this.info=[],this.common=[],this.page=[],this.char=[],this.kerning=[],this.distanceField=[]}var dd,pd,fd,gd=(Rd.prototype.update=function(t){if(t||this._bufferUpdateId!==this.uvBuffer._updateID||this._textureUpdateId!==this.uvMatrix._updateID){this._bufferUpdateId=this.uvBuffer._updateID,this._textureUpdateId=this.uvMatrix._updateID;var e=this.uvBuffer.data;this.data&&this.data.length===e.length||(this.data=new Float32Array(e.length)),this.uvMatrix.multiplyUvs(e,this.data),this._updateID++}},Rd),md=new Fi,yd=new ki,_d=(ud(Bd,fd=tr),Object.defineProperty(Bd.prototype,"geometry",{get:function(){return this._geometry},set:function(t){this._geometry!==t&&(this._geometry&&(this._geometry.refCount--,0===this._geometry.refCount&&this._geometry.dispose()),this._geometry=t,this._geometry&&this._geometry.refCount++,this.vertexDirty=-1)},enumerable:!1,configurable:!0}),Object.defineProperty(Bd.prototype,"uvBuffer",{get:function(){return this.geometry.buffers[1]},enumerable:!1,configurable:!0}),Object.defineProperty(Bd.prototype,"verticesBuffer",{get:function(){return this.geometry.buffers[0]},enumerable:!1,configurable:!0}),Object.defineProperty(Bd.prototype,"material",{get:function(){return this.shader},set:function(t){this.shader=t},enumerable:!1,configurable:!0}),Object.defineProperty(Bd.prototype,"blendMode",{get:function(){return this.state.blendMode},set:function(t){this.state.blendMode=t},enumerable:!1,configurable:!0}),Object.defineProperty(Bd.prototype,"roundPixels",{get:function(){return this._roundPixels},set:function(t){this._roundPixels!==t&&(this._transformID=-1),this._roundPixels=t},enumerable:!1,configurable:!0}),Object.defineProperty(Bd.prototype,"tint",{get:function(){return"tint"in this.shader?this.shader.tint:null},set:function(t){this.shader.tint=t},enumerable:!1,configurable:!0}),Object.defineProperty(Bd.prototype,"texture",{get:function(){return"texture"in this.shader?this.shader.texture:null},set:function(t){this.shader.texture=t},enumerable:!1,configurable:!0}),Bd.prototype._render=function(t){var e=this.geometry.buffers[0].data;this.shader.batchable&&this.drawMode===nt.DRAW_MODES.TRIANGLES&&e.length<2*Bd.BATCHABLE_SIZE?this._renderToBatch(t):this._renderDefault(t)},Bd.prototype._renderDefault=function(t){var e=this.shader;e.alpha=this.worldAlpha,e.update&&e.update(),t.batch.flush(),e.uniforms.translationMatrix=this.transform.worldTransform.toArray(!0),t.shader.bind(e),t.state.set(this.state),t.geometry.bind(this.geometry,e),t.geometry.draw(this.drawMode,this.size,this.start,this.geometry.instanceCount)},Bd.prototype._renderToBatch=function(t){var e=this.geometry,i=this.shader;i.uvMatrix&&(i.uvMatrix.update(),this.calculateUvs()),this.calculateVertices(),this.indices=e.indexBuffer.data,this._tintRGB=i._tintRGB,this._texture=i.texture;var n=this.material.pluginName;t.batch.setObjectRenderer(t.plugins[n]),t.plugins[n].render(this)},Bd.prototype.calculateVertices=function(){var t=this.geometry.buffers[0],e=t.data,i=t._updateID;if(i!==this.vertexDirty||this._transformID!==this.transform._worldID){this._transformID=this.transform._worldID,this.vertexData.length!==e.length&&(this.vertexData=new Float32Array(e.length));for(var n=this.transform.worldTransform,r=n.a,s=n.b,o=n.c,a=n.d,l=n.tx,h=n.ty,u=this.vertexData,c=0;c<u.length/2;c++){var d=e[2*c],p=e[2*c+1];u[2*c]=r*d+o*p+l,u[2*c+1]=s*d+a*p+h}if(this._roundPixels){var f=Tt.RESOLUTION;for(c=0;c<u.length;++c)u[c]=Math.round((u[c]*f|0)/f)}this.vertexDirty=i}},Bd.prototype.calculateUvs=function(){var t=this.geometry.buffers[1],e=this.shader;e.uvMatrix.isSimple?this.uvs=t.data:(this.batchUvs||(this.batchUvs=new gd(t,e.uvMatrix)),this.batchUvs.update(),this.uvs=this.batchUvs.data)},Bd.prototype._calculateBounds=function(){this.calculateVertices(),this._bounds.addVertexData(this.vertexData,0,this.vertexData.length)},Bd.prototype.containsPoint=function(t){if(!this.getBounds().contains(t.x,t.y))return!1;this.worldTransform.applyInverse(t,md);for(var e=this.geometry.getBuffer("aVertexPosition").data,i=yd.points,n=this.geometry.getIndex().data,r=n.length,s=4===this.drawMode?3:1,o=0;o+2<r;o+=s){var a=2*n[o],l=2*n[o+1],h=2*n[o+2];if(i[0]=e[a],i[1]=e[1+a],i[2]=e[l],i[3]=e[1+l],i[4]=e[h],i[5]=e[1+h],yd.contains(md.x,md.y))return!0}return!1},Bd.prototype.destroy=function(t){fd.prototype.destroy.call(this,t),this._cachedTexture&&(this._cachedTexture.destroy(),this._cachedTexture=null),this.geometry=null,this.shader=null,this.state=null,this.uvs=null,this.indices=null,this.vertexData=null},Bd.BATCHABLE_SIZE=100,Bd),vd=(ud(Md,pd=ia),Object.defineProperty(Md.prototype,"texture",{get:function(){return this.uniforms.uSampler},set:function(t){this.uniforms.uSampler!==t&&(this.uniforms.uSampler=t,this.uvMatrix.texture=t)},enumerable:!1,configurable:!0}),Object.defineProperty(Md.prototype,"alpha",{get:function(){return this._alpha},set:function(t){t!==this._alpha&&(this._alpha=t,this._colorDirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(Md.prototype,"tint",{get:function(){return this._tint},set:function(t){t!==this._tint&&(this._tint=t,this._tintRGB=(t>>16)+(65280&t)+((255&t)<<16),this._colorDirty=!0)},enumerable:!1,configurable:!0}),Md.prototype.update=function(){if(this._colorDirty){this._colorDirty=!1;var t=this.texture.baseTexture;ri(this._tint,this._alpha,this.uniforms.uColor,t.alphaMode)}this.uvMatrix.update()&&(this.uniforms.uTextureMatrix=this.uvMatrix.mapCoord)},Md),bd=(ud(Ad,dd=Ys),Object.defineProperty(Ad.prototype,"vertexDirtyId",{get:function(){return this.buffers[0]._updateID},enumerable:!1,configurable:!0}),Ad),wd=function(t,e){return(wd=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},Sd=(Ed.test=function(t){return"string"==typeof t&&0===t.indexOf("info face=")},Ed.parse=function(t){var e=t.match(/^[a-z]+\s+.+$/gm),i={info:[],common:[],page:[],char:[],chars:[],kerning:[],kernings:[],distanceField:[]};for(var n in e){var r=e[n].match(/^[a-z]+/gm)[0],s=e[n].match(/[a-zA-Z]+=([^\s"']+|"([^"]*)")/gm),o={};for(var a in s){var l=s[a].split("="),h=l[0],u=l[1].replace(/"/gm,""),c=parseFloat(u),d=isNaN(c)?u:c;o[h]=d}i[r].push(o)}var p=new cd;return i.info.forEach(function(t){return p.info.push({face:t.face,size:parseInt(t.size,10)})}),i.common.forEach(function(t){return p.common.push({lineHeight:parseInt(t.lineHeight,10)})}),i.page.forEach(function(t){return p.page.push({id:parseInt(t.id,10),file:t.file})}),i.char.forEach(function(t){return p.char.push({id:parseInt(t.id,10),page:parseInt(t.page,10),x:parseInt(t.x,10),y:parseInt(t.y,10),width:parseInt(t.width,10),height:parseInt(t.height,10),xoffset:parseInt(t.xoffset,10),yoffset:parseInt(t.yoffset,10),xadvance:parseInt(t.xadvance,10)})}),i.kerning.forEach(function(t){return p.kerning.push({first:parseInt(t.first,10),second:parseInt(t.second,10),amount:parseInt(t.amount,10)})}),i.distanceField.forEach(function(t){return p.distanceField.push({distanceRange:parseInt(t.distanceRange,10),fieldType:t.fieldType})}),p},Ed),xd=(Cd.test=function(t){return t instanceof XMLDocument&&t.getElementsByTagName("page").length&&null!==t.getElementsByTagName("info")[0].getAttribute("face")},Cd.parse=function(t){for(var e=new cd,i=t.getElementsByTagName("info"),n=t.getElementsByTagName("common"),r=t.getElementsByTagName("page"),s=t.getElementsByTagName("char"),o=t.getElementsByTagName("kerning"),a=t.getElementsByTagName("distanceField"),l=0;l<i.length;l++)e.info.push({face:i[l].getAttribute("face"),size:parseInt(i[l].getAttribute("size"),10)});for(l=0;l<n.length;l++)e.common.push({lineHeight:parseInt(n[l].getAttribute("lineHeight"),10)});for(l=0;l<r.length;l++)e.page.push({id:parseInt(r[l].getAttribute("id"),10)||0,file:r[l].getAttribute("file")});for(l=0;l<s.length;l++){var h=s[l];e.char.push({id:parseInt(h.getAttribute("id"),10),page:parseInt(h.getAttribute("page"),10)||0,x:parseInt(h.getAttribute("x"),10),y:parseInt(h.getAttribute("y"),10),width:parseInt(h.getAttribute("width"),10),height:parseInt(h.getAttribute("height"),10),xoffset:parseInt(h.getAttribute("xoffset"),10),yoffset:parseInt(h.getAttribute("yoffset"),10),xadvance:parseInt(h.getAttribute("xadvance"),10)})}for(l=0;l<o.length;l++)e.kerning.push({first:parseInt(o[l].getAttribute("first"),10),second:parseInt(o[l].getAttribute("second"),10),amount:parseInt(o[l].getAttribute("amount"),10)});for(l=0;l<a.length;l++)e.distanceField.push({fieldType:a[l].getAttribute("fieldType"),distanceRange:parseInt(a[l].getAttribute("distanceRange"),10)});return e},Cd),Td=(Pd.test=function(t){if("string"==typeof t&&-1<t.indexOf("<font>")){var e=(new self.DOMParser).parseFromString(t,"text/xml");return xd.test(e)}return!1},Pd.parse=function(t){var e=(new self.DOMParser).parseFromString(t,"text/xml");return xd.parse(e)},Pd),Id=[Sd,xd,Td];function Pd(){}function Cd(){}function Ed(){}function Ad(t,e,i){var n=dd.call(this)||this,r=new Gs(t),s=new Gs(e,!0),o=new Gs(i,!0,!0);return n.addAttribute("aVertexPosition",r,2,!1,nt.TYPES.FLOAT).addAttribute("aTextureCoord",s,2,!1,nt.TYPES.FLOAT).addIndex(o),n._updateId=-1,n}function Md(t,e){var i=this,n={uSampler:t,alpha:1,uTextureMatrix:Li.IDENTITY,uColor:new Float32Array([1,1,1,1])};return(e=Object.assign({tint:16777215,alpha:1,pluginName:"batch"},e)).uniforms&&Object.assign(n,e.uniforms),(i=pd.call(this,e.program||ea.from("attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\nuniform mat3 translationMatrix;\nuniform mat3 uTextureMatrix;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = (uTextureMatrix * vec3(aTextureCoord, 1.0)).xy;\n}\n","varying vec2 vTextureCoord;\nuniform vec4 uColor;\n\nuniform sampler2D uSampler;\n\nvoid main(void)\n{\n    gl_FragColor = texture2D(uSampler, vTextureCoord) * uColor;\n}\n"),n)||this)._colorDirty=!1,i.uvMatrix=new oa(t),i.batchable=void 0===e.program,i.pluginName=e.pluginName,i.tint=e.tint,i.alpha=e.alpha,i}function Bd(t,e,i,n){void 0===n&&(n=nt.DRAW_MODES.TRIANGLES);var r=fd.call(this)||this;return r.geometry=t,r.shader=e,r.state=i||na.for2d(),r.drawMode=n,r.start=0,r.size=0,r.uvs=null,r.indices=null,r.vertexData=new Float32Array(1),r.vertexDirty=-1,r._transformID=-1,r._roundPixels=Tt.ROUND_PIXELS,r.batchUvs=null,r}function Rd(t,e){this.uvBuffer=t,this.uvMatrix=e,this.data=null,this._bufferUpdateId=-1,this._textureUpdateId=-1,this._updateID=0}function Od(t){for(var e=0;e<Id.length;e++)if(Id[e].test(t))return Id[e];return null}function kd(t,e,i,n,r,s,o){var a=i.text,l=i.fontProperties;e.translate(n,r),e.scale(s,s);var h=o.strokeThickness/2,u=-o.strokeThickness/2;e.font=o.toFontString(),e.lineWidth=o.strokeThickness,e.textBaseline=o.textBaseline,e.lineJoin=o.lineJoin,e.miterLimit=o.miterLimit,e.fillStyle=function(t,e,i,n,r,s){var o,a=i.fill;if(!Array.isArray(a))return a;if(1===a.length)return a[0];var l=i.dropShadow?i.dropShadowDistance:0,h=i.padding||0,u=t.width/n-l-2*h,c=t.height/n-l-2*h,d=a.slice(),p=i.fillGradientStops.slice();if(!p.length)for(var f=d.length+1,g=1;g<f;++g)p.push(g/f);if(d.unshift(a[0]),p.unshift(0),d.push(a[a.length-1]),p.push(1),i.fillGradientType===nt.TEXT_GRADIENT.LINEAR_VERTICAL){o=e.createLinearGradient(u/2,h,u/2,c+h);var m=0,y=(s.fontProperties.fontSize+i.strokeThickness)/c;for(g=0;g<r.length;g++)for(var _=s.lineHeight*g,v=0;v<d.length;v++){var b=_/c+("number"==typeof p[v]?p[v]:v/d.length)*y,w=Math.max(m,b);w=Math.min(w,1),o.addColorStop(w,d[v]),m=w}}else{o=e.createLinearGradient(h,c/2,u+h,c/2);var S=d.length+1,x=1;for(g=0;g<d.length;g++){var T;T="number"==typeof p[g]?p[g]:x/S,o.addColorStop(T,d[g]),x++}}return o}(t,e,o,s,[a],i),e.strokeStyle=o.stroke;var c=o.dropShadowColor,d=$e("number"==typeof c?c:Je(c));o.dropShadow?(e.shadowColor="rgba("+255*d[0]+","+255*d[1]+","+255*d[2]+","+o.dropShadowAlpha+")",e.shadowBlur=o.dropShadowBlur,e.shadowOffsetX=Math.cos(o.dropShadowAngle)*o.dropShadowDistance,e.shadowOffsetY=Math.sin(o.dropShadowAngle)*o.dropShadowDistance):(e.shadowColor="black",e.shadowBlur=0,e.shadowOffsetX=0,e.shadowOffsetY=0),o.stroke&&o.strokeThickness&&e.strokeText(a,h,u+i.lineHeight-l.descent),o.fill&&e.fillText(a,h,u+i.lineHeight-l.descent),e.setTransform(1,0,0,1,0,0),e.fillStyle="rgba(0, 0, 0, 0)"}function Dd(t){return Array.from?Array.from(t):t.split("")}function Fd(t){return t.codePointAt?t.codePointAt(0):t.charCodeAt(0)}var Nd,Ld,Ud,zd,Wd,Gd,Hd=(np.prototype.destroy=function(){for(var t in this.chars)this.chars[t].texture.destroy(),this.chars[t].texture=null;for(var t in this.pageTextures)this._ownsTextures&&this.pageTextures[t].destroy(!0),this.pageTextures[t]=null;this.chars=null,this.pageTextures=null},np.install=function(t,e,i){var n;if(t instanceof cd)n=t;else{var r=Od(t);if(!r)throw new Error("Unrecognized data format for font.");n=r.parse(t)}e instanceof Cs&&(e=[e]);var s=new np(n,e,i);return np.available[s.font]=s},np.uninstall=function(t){var e=np.available[t];if(!e)throw new Error("No font found named '"+t+"'");e.destroy(),delete np.available[t]},np.from=function(t,e,i){if(!t)throw new Error("[BitmapFont] Property `name` is required.");var n=Object.assign({},np.defaultOptions,i),r=n.chars,s=n.padding,o=n.resolution,a=n.textureWidth,l=n.textureHeight,h=function(t){"string"==typeof t&&(t=[t]);for(var e=[],i=0,n=t.length;i<n;i++){var r=t[i];if(Array.isArray(r)){if(2!==r.length)throw new Error("[BitmapFont]: Invalid character range length, expecting 2 got "+r.length+".");var s=r[0].charCodeAt(0),o=r[1].charCodeAt(0);if(o<s)throw new Error("[BitmapFont]: Invalid character range.");for(var a=s,l=o;a<=l;a++)e.push(String.fromCharCode(a))}else e.push.apply(e,Dd(r))}if(0===e.length)throw new Error("[BitmapFont]: Empty set when resolving characters.");return e}(r),u=e instanceof uc?e:new uc(e),c=a,d=new cd;d.info[0]={face:u.fontFamily,size:u.fontSize},d.common[0]={lineHeight:u.fontSize};for(var p,f,g,m=0,y=0,_=0,v=[],b=0;b<h.length;b++){p||((p=document.createElement("canvas")).width=a,p.height=l,f=p.getContext("2d"),g=new $r(p,{resolution:o}),v.push(new Cs(g)),d.page.push({id:v.length-1,file:""}));var w=gc.measureText(h[b],u,!1,p),S=w.width,x=Math.ceil(w.height),T=Math.ceil(("italic"===u.fontStyle?2:1)*S);if(l-x*o<=y){if(0===y)throw new Error("[BitmapFont] textureHeight "+l+"px is too small for "+u.fontSize+"px fonts");--b,g=f=p=null,_=m=y=0}else if(_=Math.max(x+w.fontProperties.descent,_),c<=T*o+m)--b,y+=_*o,y=Math.ceil(y),_=m=0;else{kd(p,f,w,m,y,o,u);var I=Fd(w.text);d.char.push({id:I,page:v.length-1,x:m/o,y:y/o,width:T,height:x,xoffset:0,yoffset:0,xadvance:Math.ceil(S-(u.dropShadow?u.dropShadowDistance:0)-(u.stroke?u.strokeThickness:0))}),m+=(T+2*s)*o,m=Math.ceil(m)}}b=0;for(var P=h.length;b<P;b++)for(var C=h[b],E=0;E<P;E++){var A=h[E],M=f.measureText(C).width,B=f.measureText(A).width,R=f.measureText(C+A).width-(M+B);R&&d.kerning.push({first:Fd(C),second:Fd(A),amount:R})}var O=new np(d,v,!0);return void 0!==np.available[t]&&np.uninstall(t),np.available[t]=O},np.ALPHA=[["a","z"],["A","Z"]," "],np.NUMERIC=[["0","9"]],np.ALPHANUMERIC=[["a","z"],["A","Z"],["0","9"]," "],np.ASCII=[[" ","~"]],np.defaultOptions={resolution:1,textureWidth:512,textureHeight:512,padding:4,chars:np.ALPHANUMERIC},np.available={},np),Xd=[],jd=[],Vd=[],Yd=(wd(Wd=ep,Gd=zd=tr),Wd.prototype=null===Gd?Object.create(Gd):(ip.prototype=Gd.prototype,new ip),ep.prototype.updateText=function(){for(var t,e=Hd.available[this._fontName],i=this._fontSize/e.size,n=new Fi,r=[],s=[],o=[],a=Dd(this._text.replace(/(?:\r\n|\r)/g,"\n")||" "),l=this._maxWidth*e.size/this._fontSize,h="none"===e.distanceFieldType?Xd:jd,u=null,c=0,d=0,p=0,f=-1,g=0,m=0,y=0,_=0,v=0;v<a.length;v++){var b=Fd(z=a[v]);if(/(?:\s)/.test(z)&&(f=v,g=c,_++),"\r"!==z&&"\n"!==z){var w=e.chars[b];if(w){u&&w.kerning[u]&&(n.x+=w.kerning[u]);var S=Vd.pop()||{texture:Cs.EMPTY,line:0,charCode:0,prevSpaces:0,position:new Fi};S.texture=w.texture,S.line=p,S.charCode=b,S.position.x=n.x+w.xOffset+this._letterSpacing/2,S.position.y=n.y+w.yOffset,S.prevSpaces=_,r.push(S),c=S.position.x+w.texture.orig.width,n.x+=w.xAdvance+this._letterSpacing,y=Math.max(y,w.yOffset+w.texture.height),u=b,-1!==f&&0<l&&n.x>l&&(ci(r,1+f-++m,1+v-f),v=f,f=-1,s.push(g),o.push(0<r.length?r[r.length-1].prevSpaces:0),d=Math.max(d,g),p++,n.x=0,n.y+=e.lineHeight,u=null,_=0)}}else s.push(c),o.push(-1),d=Math.max(d,c),++p,++m,n.x=0,n.y+=e.lineHeight,u=null,_=0}var x=a[a.length-1];"\r"!==x&&"\n"!==x&&(/(?:\s)/.test(x)&&(c=g),s.push(c),d=Math.max(d,c),o.push(-1));var T=[];for(v=0;v<=p;v++){var I=0;"right"===this._align?I=d-s[v]:"center"===this._align?I=(d-s[v])/2:"justify"===this._align&&(I=o[v]<0?0:(d-s[v])/o[v]),T.push(I)}var P=r.length,C={},E=[],A=this._activePagesMeshData;for(v=0;v<A.length;v++)h.push(A[v]);for(v=0;v<P;v++){var M=(G=r[v].texture).baseTexture.uid;if(!C[M]){if(!(K=h.pop())){var B=new bd,R=void 0,O=void 0;O="none"===e.distanceFieldType?(R=new vd(Cs.EMPTY),nt.BLEND_MODES.NORMAL):(R=new vd(Cs.EMPTY,{program:ea.from("// Mesh material default fragment\r\nattribute vec2 aVertexPosition;\r\nattribute vec2 aTextureCoord;\r\n\r\nuniform mat3 projectionMatrix;\r\nuniform mat3 translationMatrix;\r\nuniform mat3 uTextureMatrix;\r\n\r\nvarying vec2 vTextureCoord;\r\n\r\nvoid main(void)\r\n{\r\n    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\r\n\r\n    vTextureCoord = (uTextureMatrix * vec3(aTextureCoord, 1.0)).xy;\r\n}\r\n","// Pixi texture info\r\nvarying vec2 vTextureCoord;\r\nuniform sampler2D uSampler;\r\n\r\n// Tint\r\nuniform vec4 uColor;\r\n\r\n// on 2D applications fwidth is screenScale / glyphAtlasScale * distanceFieldRange\r\nuniform float uFWidth;\r\n\r\nvoid main(void) {\r\n\r\n  // To stack MSDF and SDF we need a non-pre-multiplied-alpha texture.\r\n  vec4 texColor = texture2D(uSampler, vTextureCoord);\r\n\r\n  // MSDF\r\n  float median = texColor.r + texColor.g + texColor.b -\r\n                  min(texColor.r, min(texColor.g, texColor.b)) -\r\n                  max(texColor.r, max(texColor.g, texColor.b));\r\n  // SDF\r\n  median = min(median, texColor.a);\r\n\r\n  float screenPxDistance = uFWidth * (median - 0.5);\r\n  float alpha = clamp(screenPxDistance + 0.5, 0.0, 1.0);\r\n\r\n  // NPM Textures, NPM outputs\r\n  gl_FragColor = vec4(uColor.rgb, uColor.a * alpha);\r\n\r\n}\r\n"),uniforms:{uFWidth:0}}),nt.BLEND_MODES.NORMAL_NPM);var k=new _d(B,R);k.blendMode=O,K={index:0,indexCount:0,vertexCount:0,uvsCount:0,total:0,mesh:k,vertices:null,uvs:null,indices:null}}K.index=0,K.indexCount=0,K.vertexCount=0,K.uvsCount=0,K.total=0;var D=this._textureCache;D[M]=D[M]||new Cs(G.baseTexture),K.mesh.texture=D[M],K.mesh.tint=this._tint,E.push(K),C[M]=K}C[M].total++}for(v=0;v<A.length;v++)-1===E.indexOf(A[v])&&this.removeChild(A[v].mesh);for(v=0;v<E.length;v++)E[v].mesh.parent!==this&&this.addChild(E[v].mesh);for(var v in this._activePagesMeshData=E,C){var F=(K=C[v]).total;if(!((null===(t=K.indices)||void 0===t?void 0:t.length)>6*F)||K.vertices.length<2*_d.BATCHABLE_SIZE)K.vertices=new Float32Array(8*F),K.uvs=new Float32Array(8*F),K.indices=new Uint16Array(6*F);else for(var N=K.total,L=K.vertices,U=4*N*2;U<L.length;U++)L[U]=0;K.mesh.size=6*F}for(v=0;v<P;v++){var z,W=(z=r[v]).position.x+T[z.line]*("justify"===this._align?z.prevSpaces:1);this._roundPixels&&(W=Math.round(W));var G,H=W*i,X=z.position.y*i,j=C[(G=z.texture).baseTexture.uid],V=G.frame,Y=G._uvs,q=j.index++;j.indices[6*q+0]=0+4*q,j.indices[6*q+1]=1+4*q,j.indices[6*q+2]=2+4*q,j.indices[6*q+3]=0+4*q,j.indices[6*q+4]=2+4*q,j.indices[6*q+5]=3+4*q,j.vertices[8*q+0]=H,j.vertices[8*q+1]=X,j.vertices[8*q+2]=H+V.width*i,j.vertices[8*q+3]=X,j.vertices[8*q+4]=H+V.width*i,j.vertices[8*q+5]=X+V.height*i,j.vertices[8*q+6]=H,j.vertices[8*q+7]=X+V.height*i,j.uvs[8*q+0]=Y.x0,j.uvs[8*q+1]=Y.y0,j.uvs[8*q+2]=Y.x1,j.uvs[8*q+3]=Y.y1,j.uvs[8*q+4]=Y.x2,j.uvs[8*q+5]=Y.y2,j.uvs[8*q+6]=Y.x3,j.uvs[8*q+7]=Y.y3}for(var v in this._textWidth=d*i,this._textHeight=(n.y+e.lineHeight)*i,C){var K=C[v];if(0!==this.anchor.x||0!==this.anchor.y)for(var $=0,Q=this._textWidth*this.anchor.x,J=this._textHeight*this.anchor.y,Z=0;Z<K.total;Z++)K.vertices[$++]-=Q,K.vertices[$++]-=J,K.vertices[$++]-=Q,K.vertices[$++]-=J,K.vertices[$++]-=Q,K.vertices[$++]-=J,K.vertices[$++]-=Q,K.vertices[$++]-=J;this._maxLineHeight=y*i;var tt=K.mesh.geometry.getBuffer("aVertexPosition"),et=K.mesh.geometry.getBuffer("aTextureCoord"),it=K.mesh.geometry.getIndex();tt.data=K.vertices,et.data=K.uvs,it.data=K.indices,tt.update(),et.update(),it.update()}for(v=0;v<r.length;v++)Vd.push(r[v])},ep.prototype.updateTransform=function(){this.validate(),this.containerUpdateTransform()},ep.prototype._render=function(t){var e=Hd.available[this._fontName],i=e.distanceFieldRange,n=e.distanceFieldType,r=e.size;if("none"!==n)for(var s=this.worldTransform,o=s.a,a=s.b,l=s.c,h=s.d,u=Math.sqrt(o*o+a*a),c=Math.sqrt(l*l+h*h),d=(Math.abs(u)+Math.abs(c))/2,p=this._fontSize/r,f=0,g=this._activePagesMeshData;f<g.length;f++)g[f].mesh.shader.uniforms.uFWidth=d*i*p*t.resolution;zd.prototype._render.call(this,t)},ep.prototype.getLocalBounds=function(){return this.validate(),zd.prototype.getLocalBounds.call(this)},ep.prototype.validate=function(){this.dirty&&(this.updateText(),this.dirty=!1)},Object.defineProperty(ep.prototype,"tint",{get:function(){return this._tint},set:function(t){if(this._tint!==t){this._tint=t;for(var e=0;e<this._activePagesMeshData.length;e++)this._activePagesMeshData[e].mesh.tint=t}},enumerable:!1,configurable:!0}),Object.defineProperty(ep.prototype,"align",{get:function(){return this._align},set:function(t){this._align!==t&&(this._align=t,this.dirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(ep.prototype,"fontName",{get:function(){return this._fontName},set:function(t){if(!Hd.available[t])throw new Error('Missing BitmapFont "'+t+'"');this._fontName!==t&&(this._fontName=t,this.dirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(ep.prototype,"fontSize",{get:function(){return this._fontSize},set:function(t){this._fontSize!==t&&(this._fontSize=t,this.dirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(ep.prototype,"anchor",{get:function(){return this._anchor},set:function(t){"number"==typeof t?this._anchor.set(t):this._anchor.copyFrom(t)},enumerable:!1,configurable:!0}),Object.defineProperty(ep.prototype,"text",{get:function(){return this._text},set:function(t){t=String(null==t?"":t),this._text!==t&&(this._text=t,this.dirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(ep.prototype,"maxWidth",{get:function(){return this._maxWidth},set:function(t){this._maxWidth!==t&&(this._maxWidth=t,this.dirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(ep.prototype,"maxLineHeight",{get:function(){return this.validate(),this._maxLineHeight},enumerable:!1,configurable:!0}),Object.defineProperty(ep.prototype,"textWidth",{get:function(){return this.validate(),this._textWidth},enumerable:!1,configurable:!0}),Object.defineProperty(ep.prototype,"letterSpacing",{get:function(){return this._letterSpacing},set:function(t){this._letterSpacing!==t&&(this._letterSpacing=t,this.dirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(ep.prototype,"roundPixels",{get:function(){return this._roundPixels},set:function(t){t!==this._roundPixels&&(this._roundPixels=t,this.dirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(ep.prototype,"textHeight",{get:function(){return this.validate(),this._textHeight},enumerable:!1,configurable:!0}),ep.prototype.destroy=function(t){var e=this._textureCache;for(var i in e)e[i].destroy(),delete e[i];this._textureCache=null,zd.prototype.destroy.call(this,t)},ep.styleDefaults={align:"left",tint:16777215,maxWidth:0,letterSpacing:0},ep),qd=(tp.add=function(){nt.LoaderResource.setExtensionXhrType("fnt",nt.LoaderResource.XHR_RESPONSE_TYPE.TEXT)},tp.use=function(e,i){var t=Od(e.data);if(t)for(var n=tp.getBaseUrl(this,e),r=t.parse(e.data),s={},o=function(t){s[t.metadata.pageFile]=t.texture,Object.keys(s).length===r.page.length&&(e.bitmapFont=Hd.install(r,s,!0),i())},a=0;a<r.page.length;++a){var l=r.page[a].file,h=n+l,u=!1;for(var c in this.resources){var d=this.resources[c];if(d.url===h){d.metadata.pageFile=l,d.texture?o(d):d.onAfterMiddleware.add(o),u=!0;break}}if(!u){var p={crossOrigin:e.crossOrigin,loadType:nt.LoaderResource.LOAD_TYPE.IMAGE,metadata:Object.assign({pageFile:l},e.metadata.imageMetadata),parentResource:e};this.add(h,p,o)}}else i()},tp.getBaseUrl=function(t,e){var i=e.isDataUrl?"":tp.dirname(e.url);return e.isDataUrl&&("."===i&&(i=""),t.baseUrl&&i&&"/"===t.baseUrl.charAt(t.baseUrl.length-1)&&(i+="/")),(i=i.replace(t.baseUrl,""))&&"/"!==i.charAt(i.length-1)&&(i+="/"),i},tp.dirname=function(t){var e=t.replace(/\\/g,"/").replace(/\/$/,"").replace(/\/[^\/]*$/,"");return e===t?".":""===e?"/":e},tp),Kd=function(t,e){return(Kd=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},$d=(Kd(Ld=Jd,Ud=Nd=ra),Ld.prototype=null===Ud?Object.create(Ud):(Zd.prototype=Ud.prototype,new Zd),Object.defineProperty(Jd.prototype,"alpha",{get:function(){return this.uniforms.uAlpha},set:function(t){this.uniforms.uAlpha=t},enumerable:!1,configurable:!0}),Jd),Qd=function(t,e){return(Qd=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)};function Jd(t){void 0===t&&(t=1);var e=Nd.call(this,cl,"varying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform float uAlpha;\n\nvoid main(void)\n{\n   gl_FragColor = texture2D(uSampler, vTextureCoord) * uAlpha;\n}\n",{uAlpha:1})||this;return e.alpha=t,e}function Zd(){this.constructor=Ld}function tp(){}function ep(t,e){void 0===e&&(e={});var i=zd.call(this)||this;i._tint=16777215;var n=Object.assign({},ep.styleDefaults,e),r=n.align,s=n.tint,o=n.maxWidth,a=n.letterSpacing,l=n.fontName,h=n.fontSize;if(!Hd.available[l])throw new Error('Missing BitmapFont "'+l+'"');return i._activePagesMeshData=[],i._textWidth=0,i._textHeight=0,i._align=r,i._tint=s,i._fontName=l,i._fontSize=h||Hd.available[l].size,i._text=t,i._maxWidth=o,i._maxLineHeight=0,i._letterSpacing=a,i._anchor=new Ni(function(){i.dirty=!0},i,0,0),i._roundPixels=Tt.ROUND_PIXELS,i.dirty=!0,i._textureCache={},i}function ip(){this.constructor=Wd}function np(t,e,i){var n,r,s=t.info[0],o=t.common[0],a=t.page[0],l=t.distanceField[0],h=Ii(a.file),u={};this._ownsTextures=i,this.font=s.face,this.size=s.size,this.lineHeight=o.lineHeight/h,this.chars={},this.pageTextures=u;for(var c=0;c<t.page.length;c++){var d=t.page[c],p=d.id,f=d.file;u[p]=e instanceof Array?e[c]:e[f],(null==l?void 0:l.fieldType)&&"none"!==l.fieldType&&(u[p].baseTexture.alphaMode=nt.ALPHA_MODES.NO_PREMULTIPLIED_ALPHA)}for(c=0;c<t.char.length;c++){var g=t.char[c],m=(p=g.id,g.page),y=t.char[c],_=y.x,v=y.y,b=y.width,w=y.height,S=y.xoffset,x=y.yoffset,T=y.xadvance;v/=h,b/=h,w/=h,S/=h,x/=h,T/=h;var I=new Bi((_/=h)+u[m].frame.x/h,v+u[m].frame.y/h,b,w);this.chars[p]={xOffset:S,yOffset:x,xAdvance:T,kerning:{},texture:new Cs(u[m].baseTexture,I),page:m}}for(c=0;c<t.kerning.length;c++){var P=t.kerning[c],C=P.first,E=P.second,A=P.amount;C/=h,E/=h,A/=h,this.chars[E]&&(this.chars[E].kerning[C]=A)}this.distanceFieldRange=null==l?void 0:l.distanceRange,this.distanceFieldType=null!==(r=null===(n=null==l?void 0:l.fieldType)||void 0===n?void 0:n.toLowerCase())&&void 0!==r?r:"none"}function rp(t,e){function i(){this.constructor=t}Qd(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}var sp,op,ap,lp,hp,up,cp,dp,pp,fp,gp,mp,yp,_p,vp,bp,wp,Sp,xp,Tp,Ip,Pp,Cp,Ep,Ap,Mp,Bp,Rp,Op,kp,Dp,Fp,Np,Lp,Up,zp,Wp,Gp,Hp={5:[.153388,.221461,.250301],7:[.071303,.131514,.189879,.214607],9:[.028532,.067234,.124009,.179044,.20236],11:[.0093,.028002,.065984,.121703,.175713,.198596],13:[.002406,.009255,.027867,.065666,.121117,.174868,.197641],15:[489e-6,.002403,.009246,.02784,.065602,.120999,.174697,.197448]},Xp=["varying vec2 vBlurTexCoords[%size%];","uniform sampler2D uSampler;","void main(void)","{","    gl_FragColor = vec4(0.0);","    %blur%","}"].join("\n");(Gp=sp=sp||{})[Gp.WEBGL_LEGACY=0]="WEBGL_LEGACY",Gp[Gp.WEBGL=1]="WEBGL",Gp[Gp.WEBGL2=2]="WEBGL2",(Wp=op=op||{})[Wp.UNKNOWN=0]="UNKNOWN",Wp[Wp.WEBGL=1]="WEBGL",Wp[Wp.CANVAS=2]="CANVAS",(zp=ap=ap||{})[zp.COLOR=16384]="COLOR",zp[zp.DEPTH=256]="DEPTH",zp[zp.STENCIL=1024]="STENCIL",(Up=lp=lp||{})[Up.NORMAL=0]="NORMAL",Up[Up.ADD=1]="ADD",Up[Up.MULTIPLY=2]="MULTIPLY",Up[Up.SCREEN=3]="SCREEN",Up[Up.OVERLAY=4]="OVERLAY",Up[Up.DARKEN=5]="DARKEN",Up[Up.LIGHTEN=6]="LIGHTEN",Up[Up.COLOR_DODGE=7]="COLOR_DODGE",Up[Up.COLOR_BURN=8]="COLOR_BURN",Up[Up.HARD_LIGHT=9]="HARD_LIGHT",Up[Up.SOFT_LIGHT=10]="SOFT_LIGHT",Up[Up.DIFFERENCE=11]="DIFFERENCE",Up[Up.EXCLUSION=12]="EXCLUSION",Up[Up.HUE=13]="HUE",Up[Up.SATURATION=14]="SATURATION",Up[Up.COLOR=15]="COLOR",Up[Up.LUMINOSITY=16]="LUMINOSITY",Up[Up.NORMAL_NPM=17]="NORMAL_NPM",Up[Up.ADD_NPM=18]="ADD_NPM",Up[Up.SCREEN_NPM=19]="SCREEN_NPM",Up[Up.NONE=20]="NONE",Up[Up.SRC_OVER=0]="SRC_OVER",Up[Up.SRC_IN=21]="SRC_IN",Up[Up.SRC_OUT=22]="SRC_OUT",Up[Up.SRC_ATOP=23]="SRC_ATOP",Up[Up.DST_OVER=24]="DST_OVER",Up[Up.DST_IN=25]="DST_IN",Up[Up.DST_OUT=26]="DST_OUT",Up[Up.DST_ATOP=27]="DST_ATOP",Up[Up.ERASE=26]="ERASE",Up[Up.SUBTRACT=28]="SUBTRACT",Up[Up.XOR=29]="XOR",(Lp=hp=hp||{})[Lp.POINTS=0]="POINTS",Lp[Lp.LINES=1]="LINES",Lp[Lp.LINE_LOOP=2]="LINE_LOOP",Lp[Lp.LINE_STRIP=3]="LINE_STRIP",Lp[Lp.TRIANGLES=4]="TRIANGLES",Lp[Lp.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",Lp[Lp.TRIANGLE_FAN=6]="TRIANGLE_FAN",(Np=up=up||{})[Np.RGBA=6408]="RGBA",Np[Np.RGB=6407]="RGB",Np[Np.RG=33319]="RG",Np[Np.RED=6403]="RED",Np[Np.RGBA_INTEGER=36249]="RGBA_INTEGER",Np[Np.RGB_INTEGER=36248]="RGB_INTEGER",Np[Np.RG_INTEGER=33320]="RG_INTEGER",Np[Np.RED_INTEGER=36244]="RED_INTEGER",Np[Np.ALPHA=6406]="ALPHA",Np[Np.LUMINANCE=6409]="LUMINANCE",Np[Np.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",Np[Np.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",Np[Np.DEPTH_STENCIL=34041]="DEPTH_STENCIL",(Fp=cp=cp||{})[Fp.TEXTURE_2D=3553]="TEXTURE_2D",Fp[Fp.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",Fp[Fp.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",Fp[Fp.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",Fp[Fp.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",Fp[Fp.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",Fp[Fp.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",Fp[Fp.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",Fp[Fp.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",(Dp=dp=dp||{})[Dp.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",Dp[Dp.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",Dp[Dp.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",Dp[Dp.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",Dp[Dp.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",Dp[Dp.UNSIGNED_INT=5125]="UNSIGNED_INT",Dp[Dp.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",Dp[Dp.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",Dp[Dp.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",Dp[Dp.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",Dp[Dp.BYTE=5120]="BYTE",Dp[Dp.SHORT=5122]="SHORT",Dp[Dp.INT=5124]="INT",Dp[Dp.FLOAT=5126]="FLOAT",Dp[Dp.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV",Dp[Dp.HALF_FLOAT=36193]="HALF_FLOAT",(kp=pp=pp||{})[kp.FLOAT=0]="FLOAT",kp[kp.INT=1]="INT",kp[kp.UINT=2]="UINT",(Op=fp=fp||{})[Op.NEAREST=0]="NEAREST",Op[Op.LINEAR=1]="LINEAR",(Rp=gp=gp||{})[Rp.CLAMP=33071]="CLAMP",Rp[Rp.REPEAT=10497]="REPEAT",Rp[Rp.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",(Bp=mp=mp||{})[Bp.OFF=0]="OFF",Bp[Bp.POW2=1]="POW2",Bp[Bp.ON=2]="ON",Bp[Bp.ON_MANUAL=3]="ON_MANUAL",(Mp=yp=yp||{})[Mp.NPM=0]="NPM",Mp[Mp.UNPACK=1]="UNPACK",Mp[Mp.PMA=2]="PMA",Mp[Mp.NO_PREMULTIPLIED_ALPHA=0]="NO_PREMULTIPLIED_ALPHA",Mp[Mp.PREMULTIPLY_ON_UPLOAD=1]="PREMULTIPLY_ON_UPLOAD",Mp[Mp.PREMULTIPLY_ALPHA=2]="PREMULTIPLY_ALPHA",Mp[Mp.PREMULTIPLIED_ALPHA=2]="PREMULTIPLIED_ALPHA",(Ap=_p=_p||{})[Ap.NO=0]="NO",Ap[Ap.YES=1]="YES",Ap[Ap.AUTO=2]="AUTO",Ap[Ap.BLEND=0]="BLEND",Ap[Ap.CLEAR=1]="CLEAR",Ap[Ap.BLIT=2]="BLIT",(Ep=vp=vp||{})[Ep.AUTO=0]="AUTO",Ep[Ep.MANUAL=1]="MANUAL",(Cp=bp=bp||{}).LOW="lowp",Cp.MEDIUM="mediump",Cp.HIGH="highp",(Pp=wp=wp||{})[Pp.NONE=0]="NONE",Pp[Pp.SCISSOR=1]="SCISSOR",Pp[Pp.STENCIL=2]="STENCIL",Pp[Pp.SPRITE=3]="SPRITE",(Ip=Sp=Sp||{})[Ip.NONE=0]="NONE",Ip[Ip.LOW=2]="LOW",Ip[Ip.MEDIUM=4]="MEDIUM",Ip[Ip.HIGH=8]="HIGH",(Tp=xp=xp||{})[Tp.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",Tp[Tp.ARRAY_BUFFER=34962]="ARRAY_BUFFER",Tp[Tp.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER";var jp,Vp,Yp,qp,Kp,$p=(rp(rf,Kp=ra),rf.prototype.apply=function(t,e,i,n){if(i?this.horizontal?this.uniforms.strength=1/i.width*(i.width/e.width):this.uniforms.strength=1/i.height*(i.height/e.height):this.horizontal?this.uniforms.strength=1/t.renderer.width*(t.renderer.width/e.width):this.uniforms.strength=1/t.renderer.height*(t.renderer.height/e.height),this.uniforms.strength*=this.strength,this.uniforms.strength/=this.passes,1===this.passes)t.applyFilter(this,e,i,n);else{var r=t.getFilterTexture(),s=t.renderer,o=e,a=r;this.state.blend=!1,t.applyFilter(this,o,a,_p.CLEAR);for(var l=1;l<this.passes-1;l++){t.bindAndClear(o,_p.BLIT);var h=this.uniforms.uSampler=a;a=o,o=h,s.shader.bind(this),s.geometry.draw(5)}this.state.blend=!0,t.applyFilter(this,a,i,n),t.returnFilterTexture(r)}},Object.defineProperty(rf.prototype,"blur",{get:function(){return this.strength},set:function(t){this.padding=1+2*Math.abs(t),this.strength=t},enumerable:!1,configurable:!0}),Object.defineProperty(rf.prototype,"quality",{get:function(){return this._quality},set:function(t){this._quality=t,this.passes=t},enumerable:!1,configurable:!0}),rf),Qp=(rp(nf,qp=ra),nf.prototype.apply=function(t,e,i,n){var r=Math.abs(this.blurXFilter.strength),s=Math.abs(this.blurYFilter.strength);if(r&&s){var o=t.getFilterTexture();this.blurXFilter.apply(t,e,o,_p.CLEAR),this.blurYFilter.apply(t,o,i,n),t.returnFilterTexture(o)}else s?this.blurYFilter.apply(t,e,i,n):this.blurXFilter.apply(t,e,i,n)},nf.prototype.updatePadding=function(){this._repeatEdgePixels?this.padding=0:this.padding=2*Math.max(Math.abs(this.blurXFilter.strength),Math.abs(this.blurYFilter.strength))},Object.defineProperty(nf.prototype,"blur",{get:function(){return this.blurXFilter.blur},set:function(t){this.blurXFilter.blur=this.blurYFilter.blur=t,this.updatePadding()},enumerable:!1,configurable:!0}),Object.defineProperty(nf.prototype,"quality",{get:function(){return this.blurXFilter.quality},set:function(t){this.blurXFilter.quality=this.blurYFilter.quality=t},enumerable:!1,configurable:!0}),Object.defineProperty(nf.prototype,"blurX",{get:function(){return this.blurXFilter.blur},set:function(t){this.blurXFilter.blur=t,this.updatePadding()},enumerable:!1,configurable:!0}),Object.defineProperty(nf.prototype,"blurY",{get:function(){return this.blurYFilter.blur},set:function(t){this.blurYFilter.blur=t,this.updatePadding()},enumerable:!1,configurable:!0}),Object.defineProperty(nf.prototype,"blendMode",{get:function(){return this.blurYFilter.blendMode},set:function(t){this.blurYFilter.blendMode=t},enumerable:!1,configurable:!0}),Object.defineProperty(nf.prototype,"repeatEdgePixels",{get:function(){return this._repeatEdgePixels},set:function(t){this._repeatEdgePixels=t,this.updatePadding()},enumerable:!1,configurable:!0}),nf),Jp=function(t,e){return(Jp=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},Zp=(Jp(Vp=tf,Yp=jp=ra),Vp.prototype=null===Yp?Object.create(Yp):(ef.prototype=Yp.prototype,new ef),tf.prototype._loadMatrix=function(t,e){void 0===e&&(e=!1);var i=t;e&&(this._multiply(i,this.uniforms.m,t),i=this._colorMatrix(i)),this.uniforms.m=i},tf.prototype._multiply=function(t,e,i){return t[0]=e[0]*i[0]+e[1]*i[5]+e[2]*i[10]+e[3]*i[15],t[1]=e[0]*i[1]+e[1]*i[6]+e[2]*i[11]+e[3]*i[16],t[2]=e[0]*i[2]+e[1]*i[7]+e[2]*i[12]+e[3]*i[17],t[3]=e[0]*i[3]+e[1]*i[8]+e[2]*i[13]+e[3]*i[18],t[4]=e[0]*i[4]+e[1]*i[9]+e[2]*i[14]+e[3]*i[19]+e[4],t[5]=e[5]*i[0]+e[6]*i[5]+e[7]*i[10]+e[8]*i[15],t[6]=e[5]*i[1]+e[6]*i[6]+e[7]*i[11]+e[8]*i[16],t[7]=e[5]*i[2]+e[6]*i[7]+e[7]*i[12]+e[8]*i[17],t[8]=e[5]*i[3]+e[6]*i[8]+e[7]*i[13]+e[8]*i[18],t[9]=e[5]*i[4]+e[6]*i[9]+e[7]*i[14]+e[8]*i[19]+e[9],t[10]=e[10]*i[0]+e[11]*i[5]+e[12]*i[10]+e[13]*i[15],t[11]=e[10]*i[1]+e[11]*i[6]+e[12]*i[11]+e[13]*i[16],t[12]=e[10]*i[2]+e[11]*i[7]+e[12]*i[12]+e[13]*i[17],t[13]=e[10]*i[3]+e[11]*i[8]+e[12]*i[13]+e[13]*i[18],t[14]=e[10]*i[4]+e[11]*i[9]+e[12]*i[14]+e[13]*i[19]+e[14],t[15]=e[15]*i[0]+e[16]*i[5]+e[17]*i[10]+e[18]*i[15],t[16]=e[15]*i[1]+e[16]*i[6]+e[17]*i[11]+e[18]*i[16],t[17]=e[15]*i[2]+e[16]*i[7]+e[17]*i[12]+e[18]*i[17],t[18]=e[15]*i[3]+e[16]*i[8]+e[17]*i[13]+e[18]*i[18],t[19]=e[15]*i[4]+e[16]*i[9]+e[17]*i[14]+e[18]*i[19]+e[19],t},tf.prototype._colorMatrix=function(t){var e=new Float32Array(t);return e[4]/=255,e[9]/=255,e[14]/=255,e[19]/=255,e},tf.prototype.brightness=function(t,e){var i=[t,0,0,0,0,0,t,0,0,0,0,0,t,0,0,0,0,0,1,0];this._loadMatrix(i,e)},tf.prototype.tint=function(t,e){var i=[(t>>16&255)/255,0,0,0,0,0,(t>>8&255)/255,0,0,0,0,0,(255&t)/255,0,0,0,0,0,1,0];this._loadMatrix(i,e)},tf.prototype.greyscale=function(t,e){var i=[t,t,t,0,0,t,t,t,0,0,t,t,t,0,0,0,0,0,1,0];this._loadMatrix(i,e)},tf.prototype.blackAndWhite=function(t){this._loadMatrix([.3,.6,.1,0,0,.3,.6,.1,0,0,.3,.6,.1,0,0,0,0,0,1,0],t)},tf.prototype.hue=function(t,e){t=(t||0)/180*Math.PI;var i=Math.cos(t),n=Math.sin(t),r=(0,Math.sqrt)(1/3),s=[i+1/3*(1-i),1/3*(1-i)-r*n,1/3*(1-i)+r*n,0,0,1/3*(1-i)+r*n,i+1/3*(1-i),1/3*(1-i)-r*n,0,0,1/3*(1-i)-r*n,1/3*(1-i)+r*n,i+1/3*(1-i),0,0,0,0,0,1,0];this._loadMatrix(s,e)},tf.prototype.contrast=function(t,e){var i=(t||0)+1,n=-.5*(i-1),r=[i,0,0,0,n,0,i,0,0,n,0,0,i,0,n,0,0,0,1,0];this._loadMatrix(r,e)},tf.prototype.saturate=function(t,e){void 0===t&&(t=0);var i=2*t/3+1,n=-.5*(i-1),r=[i,n,n,0,0,n,i,n,0,0,n,n,i,0,0,0,0,0,1,0];this._loadMatrix(r,e)},tf.prototype.desaturate=function(){this.saturate(-1)},tf.prototype.negative=function(t){this._loadMatrix([-1,0,0,1,0,0,-1,0,1,0,0,0,-1,1,0,0,0,0,1,0],t)},tf.prototype.sepia=function(t){this._loadMatrix([.393,.7689999,.18899999,0,0,.349,.6859999,.16799999,0,0,.272,.5339999,.13099999,0,0,0,0,0,1,0],t)},tf.prototype.technicolor=function(t){this._loadMatrix([1.9125277891456083,-.8545344976951645,-.09155508482755585,0,11.793603434377337,-.3087833385928097,1.7658908555458428,-.10601743074722245,0,-70.35205161461398,-.231103377548616,-.7501899197440212,1.847597816108189,0,30.950940869491138,0,0,0,1,0],t)},tf.prototype.polaroid=function(t){this._loadMatrix([1.438,-.062,-.062,0,0,-.122,1.378,-.122,0,0,-.016,-.016,1.483,0,0,0,0,0,1,0],t)},tf.prototype.toBGR=function(t){this._loadMatrix([0,0,1,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,1,0],t)},tf.prototype.kodachrome=function(t){this._loadMatrix([1.1285582396593525,-.3967382283601348,-.03992559172921793,0,63.72958762196502,-.16404339962244616,1.0835251566291304,-.05498805115633132,0,24.732407896706203,-.16786010706155763,-.5603416277695248,1.6014850761964943,0,35.62982807460946,0,0,0,1,0],t)},tf.prototype.browni=function(t){this._loadMatrix([.5997023498159715,.34553243048391263,-.2708298674538042,0,47.43192855600873,-.037703249837783157,.8609577587992641,.15059552388459913,0,-36.96841498319127,.24113635128153335,-.07441037908422492,.44972182064877153,0,-7.562075277591283,0,0,0,1,0],t)},tf.prototype.vintage=function(t){this._loadMatrix([.6279345635605994,.3202183420819367,-.03965408211312453,0,9.651285835294123,.02578397704808868,.6441188644374771,.03259127616149294,0,7.462829176470591,.0466055556782719,-.0851232987247891,.5241648018700465,0,5.159190588235296,0,0,0,1,0],t)},tf.prototype.colorTone=function(t,e,i,n,r){var s=((i=i||16770432)>>16&255)/255,o=(i>>8&255)/255,a=(255&i)/255,l=((n=n||3375104)>>16&255)/255,h=(n>>8&255)/255,u=(255&n)/255,c=[.3,.59,.11,0,0,s,o,a,t=t||.2,0,l,h,u,e=e||.15,0,s-l,o-h,a-u,0,0];this._loadMatrix(c,r)},tf.prototype.night=function(t,e){var i=[-2*(t=t||.1),-t,0,0,0,-t,0,t,0,0,0,t,2*t,0,0,0,0,0,1,0];this._loadMatrix(i,e)},tf.prototype.predator=function(t,e){var i=[11.224130630493164*t,-4.794486999511719*t,-2.8746118545532227*t,0*t,.40342438220977783*t,-3.6330697536468506*t,9.193157196044922*t,-2.951810836791992*t,0*t,-1.316135048866272*t,-3.2184197902679443*t,-4.2375030517578125*t,7.476448059082031*t,0*t,.8044459223747253*t,0,0,0,1,0];this._loadMatrix(i,e)},tf.prototype.lsd=function(t){this._loadMatrix([2,-.4,.5,0,0,-.5,2,-.4,0,0,-.4,-.5,3,0,0,0,0,0,1,0],t)},tf.prototype.reset=function(){this._loadMatrix([1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0],!1)},Object.defineProperty(tf.prototype,"matrix",{get:function(){return this.uniforms.m},set:function(t){this.uniforms.m=t},enumerable:!1,configurable:!0}),Object.defineProperty(tf.prototype,"alpha",{get:function(){return this.uniforms.uAlpha},set:function(t){this.uniforms.uAlpha=t},enumerable:!1,configurable:!0}),tf);function tf(){var t=this,e={m:new Float32Array([1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0]),uAlpha:1};return(t=jp.call(this,dl,"varying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform float m[20];\nuniform float uAlpha;\n\nvoid main(void)\n{\n    vec4 c = texture2D(uSampler, vTextureCoord);\n\n    if (uAlpha == 0.0) {\n        gl_FragColor = c;\n        return;\n    }\n\n    // Un-premultiply alpha before applying the color matrix. See issue #3539.\n    if (c.a > 0.0) {\n      c.rgb /= c.a;\n    }\n\n    vec4 result;\n\n    result.r = (m[0] * c.r);\n        result.r += (m[1] * c.g);\n        result.r += (m[2] * c.b);\n        result.r += (m[3] * c.a);\n        result.r += m[4];\n\n    result.g = (m[5] * c.r);\n        result.g += (m[6] * c.g);\n        result.g += (m[7] * c.b);\n        result.g += (m[8] * c.a);\n        result.g += m[9];\n\n    result.b = (m[10] * c.r);\n       result.b += (m[11] * c.g);\n       result.b += (m[12] * c.b);\n       result.b += (m[13] * c.a);\n       result.b += m[14];\n\n    result.a = (m[15] * c.r);\n       result.a += (m[16] * c.g);\n       result.a += (m[17] * c.b);\n       result.a += (m[18] * c.a);\n       result.a += m[19];\n\n    vec3 rgb = mix(c.rgb, result.rgb, uAlpha);\n\n    // Premultiply alpha again.\n    rgb *= result.a;\n\n    gl_FragColor = vec4(rgb, result.a);\n}\n",e)||this).alpha=1,t}function ef(){this.constructor=Vp}function nf(t,e,i,n){void 0===t&&(t=8),void 0===e&&(e=4),void 0===i&&(i=Tt.FILTER_RESOLUTION),void 0===n&&(n=5);var r=qp.call(this)||this;return r.blurXFilter=new $p(!0,t,e,i,n),r.blurYFilter=new $p(!1,t,e,i,n),r.resolution=i,r.quality=e,r.blur=t,r.repeatEdgePixels=!1,r}function rf(t,e,i,n,r){void 0===e&&(e=8),void 0===i&&(i=4),void 0===n&&(n=Tt.FILTER_RESOLUTION),void 0===r&&(r=5);var s=this,o=function(t,e){var i,n=Math.ceil(t/2),r="\n    attribute vec2 aVertexPosition;\n\n    uniform mat3 projectionMatrix;\n\n    uniform float strength;\n\n    varying vec2 vBlurTexCoords[%size%];\n\n    uniform vec4 inputSize;\n    uniform vec4 outputFrame;\n\n    vec4 filterVertexPosition( void )\n    {\n        vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;\n\n        return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);\n    }\n\n    vec2 filterTextureCoord( void )\n    {\n        return aVertexPosition * (outputFrame.zw * inputSize.zw);\n    }\n\n    void main(void)\n    {\n        gl_Position = filterVertexPosition();\n\n        vec2 textureCoord = filterTextureCoord();\n        %blur%\n    }",s="";i=e?"vBlurTexCoords[%index%] =  textureCoord + vec2(%sampleIndex% * strength, 0.0);":"vBlurTexCoords[%index%] =  textureCoord + vec2(0.0, %sampleIndex% * strength);";for(var o=0;o<t;o++){var a=i.replace("%index%",o.toString());s+=a=a.replace("%sampleIndex%",o-(n-1)+".0"),s+="\n"}return(r=r.replace("%blur%",s)).replace("%size%",t.toString())}(r,t),a=function(t){for(var e,i=Hp[t],n=i.length,r=Xp,s="",o=0;o<t;o++){var a="gl_FragColor += texture2D(uSampler, vBlurTexCoords[%index%]) * %value%;".replace("%index%",o.toString());n<=(e=o)&&(e=t-o-1),s+=a=a.replace("%value%",i[e].toString()),s+="\n"}return(r=r.replace("%blur%",s)).replace("%size%",t.toString())}(r);return(s=Kp.call(this,o,a)||this).horizontal=t,s.resolution=n,s._quality=0,s.quality=i,s.blur=e,s}Zp.prototype.grayscale=Zp.prototype.greyscale;var sf,of,af,lf,hf,uf,cf,df,pf,ff,gf,mf,yf,_f,vf,bf,wf,Sf,xf,Tf,If,Pf,Cf,Ef,Af,Mf,Bf,Rf,Of,kf,Df,Ff,Nf,Lf,Uf,zf,Wf,Gf,Hf,Xf,jf,Vf,Yf,qf,Kf,$f,Qf,Jf=function(t,e){return(Jf=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},Zf=(Jf(Bf=lg,Rf=Mf=ra),Bf.prototype=null===Rf?Object.create(Rf):(hg.prototype=Rf.prototype,new hg),lg.prototype.apply=function(t,e,i,n){this.uniforms.filterMatrix=t.calculateSpriteMatrix(this.maskMatrix,this.maskSprite),this.uniforms.scale.x=this.scale.x,this.uniforms.scale.y=this.scale.y;var r=this.maskSprite.worldTransform,s=Math.sqrt(r.a*r.a+r.b*r.b),o=Math.sqrt(r.c*r.c+r.d*r.d);0!==s&&0!==o&&(this.uniforms.rotation[0]=r.a/s,this.uniforms.rotation[1]=r.b/s,this.uniforms.rotation[2]=r.c/o,this.uniforms.rotation[3]=r.d/o),t.applyFilter(this,e,i,n)},Object.defineProperty(lg.prototype,"map",{get:function(){return this.uniforms.mapSampler},set:function(t){this.uniforms.mapSampler=t},enumerable:!1,configurable:!0}),lg),tg=function(t,e){return(tg=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},eg=(tg(Ef=og,Af=Cf=ra),Ef.prototype=null===Af?Object.create(Af):(ag.prototype=Af.prototype,new ag),og),ig=function(t,e){return(ig=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},ng=(ig(If=rg,Pf=Tf=ra),If.prototype=null===Pf?Object.create(Pf):(sg.prototype=Pf.prototype,new sg),Object.defineProperty(rg.prototype,"noise",{get:function(){return this.uniforms.uNoise},set:function(t){this.uniforms.uNoise=t},enumerable:!1,configurable:!0}),Object.defineProperty(rg.prototype,"seed",{get:function(){return this.uniforms.uSeed},set:function(t){this.uniforms.uSeed=t},enumerable:!1,configurable:!0}),rg);function rg(t,e){void 0===t&&(t=.5),void 0===e&&(e=Math.random());var i=Tf.call(this,dl,"precision highp float;\n\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\n\nuniform float uNoise;\nuniform float uSeed;\nuniform sampler2D uSampler;\n\nfloat rand(vec2 co)\n{\n    return fract(sin(dot(co.xy, vec2(12.9898, 78.233))) * 43758.5453);\n}\n\nvoid main()\n{\n    vec4 color = texture2D(uSampler, vTextureCoord);\n    float randomValue = rand(gl_FragCoord.xy * uSeed);\n    float diff = (randomValue - 0.5) * uNoise;\n\n    // Un-premultiply alpha before applying the color matrix. See issue #3539.\n    if (color.a > 0.0) {\n        color.rgb /= color.a;\n    }\n\n    color.r += diff;\n    color.g += diff;\n    color.b += diff;\n\n    // Premultiply alpha again.\n    color.rgb *= color.a;\n\n    gl_FragColor = color;\n}\n",{uNoise:0,uSeed:0})||this;return i.noise=t,i.seed=e,i}function sg(){this.constructor=If}function og(){return Cf.call(this,"\nattribute vec2 aVertexPosition;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 v_rgbNW;\nvarying vec2 v_rgbNE;\nvarying vec2 v_rgbSW;\nvarying vec2 v_rgbSE;\nvarying vec2 v_rgbM;\n\nvarying vec2 vFragCoord;\n\nuniform vec4 inputSize;\nuniform vec4 outputFrame;\n\nvec4 filterVertexPosition( void )\n{\n    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;\n\n    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);\n}\n\nvoid texcoords(vec2 fragCoord, vec2 inverseVP,\n               out vec2 v_rgbNW, out vec2 v_rgbNE,\n               out vec2 v_rgbSW, out vec2 v_rgbSE,\n               out vec2 v_rgbM) {\n    v_rgbNW = (fragCoord + vec2(-1.0, -1.0)) * inverseVP;\n    v_rgbNE = (fragCoord + vec2(1.0, -1.0)) * inverseVP;\n    v_rgbSW = (fragCoord + vec2(-1.0, 1.0)) * inverseVP;\n    v_rgbSE = (fragCoord + vec2(1.0, 1.0)) * inverseVP;\n    v_rgbM = vec2(fragCoord * inverseVP);\n}\n\nvoid main(void) {\n\n   gl_Position = filterVertexPosition();\n\n   vFragCoord = aVertexPosition * outputFrame.zw;\n\n   texcoords(vFragCoord, inputSize.zw, v_rgbNW, v_rgbNE, v_rgbSW, v_rgbSE, v_rgbM);\n}\n",'varying vec2 v_rgbNW;\nvarying vec2 v_rgbNE;\nvarying vec2 v_rgbSW;\nvarying vec2 v_rgbSE;\nvarying vec2 v_rgbM;\n\nvarying vec2 vFragCoord;\nuniform sampler2D uSampler;\nuniform highp vec4 inputSize;\n\n\n/**\n Basic FXAA implementation based on the code on geeks3d.com with the\n modification that the texture2DLod stuff was removed since it\'s\n unsupported by WebGL.\n\n --\n\n From:\n https://github.com/mitsuhiko/webgl-meincraft\n\n Copyright (c) 2011 by Armin Ronacher.\n\n Some rights reserved.\n\n Redistribution and use in source and binary forms, with or without\n modification, are permitted provided that the following conditions are\n met:\n\n * Redistributions of source code must retain the above copyright\n notice, this list of conditions and the following disclaimer.\n\n * Redistributions in binary form must reproduce the above\n copyright notice, this list of conditions and the following\n disclaimer in the documentation and/or other materials provided\n with the distribution.\n\n * The names of the contributors may not be used to endorse or\n promote products derived from this software without specific\n prior written permission.\n\n THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS\n "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT\n LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR\n A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT\n OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,\n SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT\n LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,\n DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY\n THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\n (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE\n OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n */\n\n#ifndef FXAA_REDUCE_MIN\n#define FXAA_REDUCE_MIN   (1.0/ 128.0)\n#endif\n#ifndef FXAA_REDUCE_MUL\n#define FXAA_REDUCE_MUL   (1.0 / 8.0)\n#endif\n#ifndef FXAA_SPAN_MAX\n#define FXAA_SPAN_MAX     8.0\n#endif\n\n//optimized version for mobile, where dependent\n//texture reads can be a bottleneck\nvec4 fxaa(sampler2D tex, vec2 fragCoord, vec2 inverseVP,\n          vec2 v_rgbNW, vec2 v_rgbNE,\n          vec2 v_rgbSW, vec2 v_rgbSE,\n          vec2 v_rgbM) {\n    vec4 color;\n    vec3 rgbNW = texture2D(tex, v_rgbNW).xyz;\n    vec3 rgbNE = texture2D(tex, v_rgbNE).xyz;\n    vec3 rgbSW = texture2D(tex, v_rgbSW).xyz;\n    vec3 rgbSE = texture2D(tex, v_rgbSE).xyz;\n    vec4 texColor = texture2D(tex, v_rgbM);\n    vec3 rgbM  = texColor.xyz;\n    vec3 luma = vec3(0.299, 0.587, 0.114);\n    float lumaNW = dot(rgbNW, luma);\n    float lumaNE = dot(rgbNE, luma);\n    float lumaSW = dot(rgbSW, luma);\n    float lumaSE = dot(rgbSE, luma);\n    float lumaM  = dot(rgbM,  luma);\n    float lumaMin = min(lumaM, min(min(lumaNW, lumaNE), min(lumaSW, lumaSE)));\n    float lumaMax = max(lumaM, max(max(lumaNW, lumaNE), max(lumaSW, lumaSE)));\n\n    mediump vec2 dir;\n    dir.x = -((lumaNW + lumaNE) - (lumaSW + lumaSE));\n    dir.y =  ((lumaNW + lumaSW) - (lumaNE + lumaSE));\n\n    float dirReduce = max((lumaNW + lumaNE + lumaSW + lumaSE) *\n                          (0.25 * FXAA_REDUCE_MUL), FXAA_REDUCE_MIN);\n\n    float rcpDirMin = 1.0 / (min(abs(dir.x), abs(dir.y)) + dirReduce);\n    dir = min(vec2(FXAA_SPAN_MAX, FXAA_SPAN_MAX),\n              max(vec2(-FXAA_SPAN_MAX, -FXAA_SPAN_MAX),\n                  dir * rcpDirMin)) * inverseVP;\n\n    vec3 rgbA = 0.5 * (\n                       texture2D(tex, fragCoord * inverseVP + dir * (1.0 / 3.0 - 0.5)).xyz +\n                       texture2D(tex, fragCoord * inverseVP + dir * (2.0 / 3.0 - 0.5)).xyz);\n    vec3 rgbB = rgbA * 0.5 + 0.25 * (\n                                     texture2D(tex, fragCoord * inverseVP + dir * -0.5).xyz +\n                                     texture2D(tex, fragCoord * inverseVP + dir * 0.5).xyz);\n\n    float lumaB = dot(rgbB, luma);\n    if ((lumaB < lumaMin) || (lumaB > lumaMax))\n        color = vec4(rgbA, texColor.a);\n    else\n        color = vec4(rgbB, texColor.a);\n    return color;\n}\n\nvoid main() {\n\n      vec4 color;\n\n      color = fxaa(uSampler, vFragCoord, inputSize.zw, v_rgbNW, v_rgbNE, v_rgbSW, v_rgbSE, v_rgbM);\n\n      gl_FragColor = color;\n}\n')||this}function ag(){this.constructor=Ef}function lg(t,e){var i=this,n=new Li;return t.renderable=!1,(i=Mf.call(this,"attribute vec2 aVertexPosition;\n\nuniform mat3 projectionMatrix;\nuniform mat3 filterMatrix;\n\nvarying vec2 vTextureCoord;\nvarying vec2 vFilterCoord;\n\nuniform vec4 inputSize;\nuniform vec4 outputFrame;\n\nvec4 filterVertexPosition( void )\n{\n    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;\n\n    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);\n}\n\nvec2 filterTextureCoord( void )\n{\n    return aVertexPosition * (outputFrame.zw * inputSize.zw);\n}\n\nvoid main(void)\n{\n\tgl_Position = filterVertexPosition();\n\tvTextureCoord = filterTextureCoord();\n\tvFilterCoord = ( filterMatrix * vec3( vTextureCoord, 1.0)  ).xy;\n}\n","varying vec2 vFilterCoord;\nvarying vec2 vTextureCoord;\n\nuniform vec2 scale;\nuniform mat2 rotation;\nuniform sampler2D uSampler;\nuniform sampler2D mapSampler;\n\nuniform highp vec4 inputSize;\nuniform vec4 inputClamp;\n\nvoid main(void)\n{\n  vec4 map =  texture2D(mapSampler, vFilterCoord);\n\n  map -= 0.5;\n  map.xy = scale * inputSize.zw * (rotation * map.xy);\n\n  gl_FragColor = texture2D(uSampler, clamp(vec2(vTextureCoord.x + map.x, vTextureCoord.y + map.y), inputClamp.xy, inputClamp.zw));\n}\n",{mapSampler:t._texture,filterMatrix:n,scale:{x:1,y:1},rotation:new Float32Array([1,0,0,1])})||this).maskSprite=t,i.maskMatrix=n,null==e&&(e=20),i.scale=new Fi(e,e),i}function hg(){this.constructor=Bf}(Qf=sf=sf||{})[Qf.WEBGL_LEGACY=0]="WEBGL_LEGACY",Qf[Qf.WEBGL=1]="WEBGL",Qf[Qf.WEBGL2=2]="WEBGL2",($f=of=of||{})[$f.UNKNOWN=0]="UNKNOWN",$f[$f.WEBGL=1]="WEBGL",$f[$f.CANVAS=2]="CANVAS",(Kf=af=af||{})[Kf.COLOR=16384]="COLOR",Kf[Kf.DEPTH=256]="DEPTH",Kf[Kf.STENCIL=1024]="STENCIL",(qf=lf=lf||{})[qf.NORMAL=0]="NORMAL",qf[qf.ADD=1]="ADD",qf[qf.MULTIPLY=2]="MULTIPLY",qf[qf.SCREEN=3]="SCREEN",qf[qf.OVERLAY=4]="OVERLAY",qf[qf.DARKEN=5]="DARKEN",qf[qf.LIGHTEN=6]="LIGHTEN",qf[qf.COLOR_DODGE=7]="COLOR_DODGE",qf[qf.COLOR_BURN=8]="COLOR_BURN",qf[qf.HARD_LIGHT=9]="HARD_LIGHT",qf[qf.SOFT_LIGHT=10]="SOFT_LIGHT",qf[qf.DIFFERENCE=11]="DIFFERENCE",qf[qf.EXCLUSION=12]="EXCLUSION",qf[qf.HUE=13]="HUE",qf[qf.SATURATION=14]="SATURATION",qf[qf.COLOR=15]="COLOR",qf[qf.LUMINOSITY=16]="LUMINOSITY",qf[qf.NORMAL_NPM=17]="NORMAL_NPM",qf[qf.ADD_NPM=18]="ADD_NPM",qf[qf.SCREEN_NPM=19]="SCREEN_NPM",qf[qf.NONE=20]="NONE",qf[qf.SRC_OVER=0]="SRC_OVER",qf[qf.SRC_IN=21]="SRC_IN",qf[qf.SRC_OUT=22]="SRC_OUT",qf[qf.SRC_ATOP=23]="SRC_ATOP",qf[qf.DST_OVER=24]="DST_OVER",qf[qf.DST_IN=25]="DST_IN",qf[qf.DST_OUT=26]="DST_OUT",qf[qf.DST_ATOP=27]="DST_ATOP",qf[qf.ERASE=26]="ERASE",qf[qf.SUBTRACT=28]="SUBTRACT",qf[qf.XOR=29]="XOR",(Yf=hf=hf||{})[Yf.POINTS=0]="POINTS",Yf[Yf.LINES=1]="LINES",Yf[Yf.LINE_LOOP=2]="LINE_LOOP",Yf[Yf.LINE_STRIP=3]="LINE_STRIP",Yf[Yf.TRIANGLES=4]="TRIANGLES",Yf[Yf.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",Yf[Yf.TRIANGLE_FAN=6]="TRIANGLE_FAN",(Vf=uf=uf||{})[Vf.RGBA=6408]="RGBA",Vf[Vf.RGB=6407]="RGB",Vf[Vf.RG=33319]="RG",Vf[Vf.RED=6403]="RED",Vf[Vf.RGBA_INTEGER=36249]="RGBA_INTEGER",Vf[Vf.RGB_INTEGER=36248]="RGB_INTEGER",Vf[Vf.RG_INTEGER=33320]="RG_INTEGER",Vf[Vf.RED_INTEGER=36244]="RED_INTEGER",Vf[Vf.ALPHA=6406]="ALPHA",Vf[Vf.LUMINANCE=6409]="LUMINANCE",Vf[Vf.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",Vf[Vf.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",Vf[Vf.DEPTH_STENCIL=34041]="DEPTH_STENCIL",(jf=cf=cf||{})[jf.TEXTURE_2D=3553]="TEXTURE_2D",jf[jf.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",jf[jf.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",jf[jf.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",jf[jf.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",jf[jf.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",jf[jf.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",jf[jf.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",jf[jf.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",(Xf=df=df||{})[Xf.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",Xf[Xf.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",Xf[Xf.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",Xf[Xf.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",Xf[Xf.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",Xf[Xf.UNSIGNED_INT=5125]="UNSIGNED_INT",Xf[Xf.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",Xf[Xf.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",Xf[Xf.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",Xf[Xf.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",Xf[Xf.BYTE=5120]="BYTE",Xf[Xf.SHORT=5122]="SHORT",Xf[Xf.INT=5124]="INT",Xf[Xf.FLOAT=5126]="FLOAT",Xf[Xf.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV",Xf[Xf.HALF_FLOAT=36193]="HALF_FLOAT",(Hf=pf=pf||{})[Hf.FLOAT=0]="FLOAT",Hf[Hf.INT=1]="INT",Hf[Hf.UINT=2]="UINT",(Gf=ff=ff||{})[Gf.NEAREST=0]="NEAREST",Gf[Gf.LINEAR=1]="LINEAR",(Wf=gf=gf||{})[Wf.CLAMP=33071]="CLAMP",Wf[Wf.REPEAT=10497]="REPEAT",Wf[Wf.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",(zf=mf=mf||{})[zf.OFF=0]="OFF",zf[zf.POW2=1]="POW2",zf[zf.ON=2]="ON",zf[zf.ON_MANUAL=3]="ON_MANUAL",(Uf=yf=yf||{})[Uf.NPM=0]="NPM",Uf[Uf.UNPACK=1]="UNPACK",Uf[Uf.PMA=2]="PMA",Uf[Uf.NO_PREMULTIPLIED_ALPHA=0]="NO_PREMULTIPLIED_ALPHA",Uf[Uf.PREMULTIPLY_ON_UPLOAD=1]="PREMULTIPLY_ON_UPLOAD",Uf[Uf.PREMULTIPLY_ALPHA=2]="PREMULTIPLY_ALPHA",Uf[Uf.PREMULTIPLIED_ALPHA=2]="PREMULTIPLIED_ALPHA",(Lf=_f=_f||{})[Lf.NO=0]="NO",Lf[Lf.YES=1]="YES",Lf[Lf.AUTO=2]="AUTO",Lf[Lf.BLEND=0]="BLEND",Lf[Lf.CLEAR=1]="CLEAR",Lf[Lf.BLIT=2]="BLIT",(Nf=vf=vf||{})[Nf.AUTO=0]="AUTO",Nf[Nf.MANUAL=1]="MANUAL",(Ff=bf=bf||{}).LOW="lowp",Ff.MEDIUM="mediump",Ff.HIGH="highp",(Df=wf=wf||{})[Df.NONE=0]="NONE",Df[Df.SCISSOR=1]="SCISSOR",Df[Df.STENCIL=2]="STENCIL",Df[Df.SPRITE=3]="SPRITE",(kf=Sf=Sf||{})[kf.NONE=0]="NONE",kf[kf.LOW=2]="LOW",kf[kf.MEDIUM=4]="MEDIUM",kf[kf.HIGH=8]="HIGH",(Of=xf=xf||{})[Of.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",Of[Of.ARRAY_BUFFER=34962]="ARRAY_BUFFER",Of[Of.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER";var ug=new Li;qn.prototype._cacheAsBitmap=!1,qn.prototype._cacheData=null,qn.prototype._cacheAsBitmapResolution=null,qn.prototype._cacheAsBitmapMultisample=Sf.NONE;function cg(){this.textureCacheId=null,this.originalRender=null,this.originalRenderCanvas=null,this.originalCalculateBounds=null,this.originalGetLocalBounds=null,this.originalUpdateTransform=null,this.originalDestroy=null,this.originalMask=null,this.originalFilterArea=null,this.originalContainsPoint=null,this.sprite=null}Object.defineProperties(qn.prototype,{cacheAsBitmapResolution:{get:function(){return this._cacheAsBitmapResolution},set:function(t){t!==this._cacheAsBitmapResolution&&(this._cacheAsBitmapResolution=t,this.cacheAsBitmap&&(this.cacheAsBitmap=!1,this.cacheAsBitmap=!0))}},cacheAsBitmapMultisample:{get:function(){return this._cacheAsBitmapMultisample},set:function(t){t!==this._cacheAsBitmapMultisample&&(this._cacheAsBitmapMultisample=t,this.cacheAsBitmap&&(this.cacheAsBitmap=!1,this.cacheAsBitmap=!0))}},cacheAsBitmap:{get:function(){return this._cacheAsBitmap},set:function(t){var e;this._cacheAsBitmap!==t&&((this._cacheAsBitmap=t)?(this._cacheData||(this._cacheData=new cg),(e=this._cacheData).originalRender=this.render,e.originalRenderCanvas=this.renderCanvas,e.originalUpdateTransform=this.updateTransform,e.originalCalculateBounds=this.calculateBounds,e.originalGetLocalBounds=this.getLocalBounds,e.originalDestroy=this.destroy,e.originalContainsPoint=this.containsPoint,e.originalMask=this._mask,e.originalFilterArea=this.filterArea,this.render=this._renderCached,this.renderCanvas=this._renderCachedCanvas,this.destroy=this._cacheAsBitmapDestroy):((e=this._cacheData).sprite&&this._destroyCachedDisplayObject(),this.render=e.originalRender,this.renderCanvas=e.originalRenderCanvas,this.calculateBounds=e.originalCalculateBounds,this.getLocalBounds=e.originalGetLocalBounds,this.destroy=e.originalDestroy,this.updateTransform=e.originalUpdateTransform,this.containsPoint=e.originalContainsPoint,this._mask=e.originalMask,this.filterArea=e.originalFilterArea))}}}),qn.prototype._renderCached=function(t){!this.visible||this.worldAlpha<=0||!this.renderable||(this._initCachedDisplayObject(t),this._cacheData.sprite.transform._worldID=this.transform._worldID,this._cacheData.sprite.worldAlpha=this.worldAlpha,this._cacheData.sprite._render(t))},qn.prototype._initCachedDisplayObject=function(t){var e;if(!this._cacheData||!this._cacheData.sprite){var i=this.alpha;this.alpha=1,t.batch.flush();var n=this.getLocalBounds(null,!0).clone();if(this.filters&&this.filters.length){var r=this.filters[0].padding;n.pad(r)}n.ceil(Tt.RESOLUTION);var s=t.renderTexture.current,o=t.renderTexture.sourceFrame.clone(),a=t.renderTexture.destinationFrame.clone(),l=t.projection.transform,h=Ls.create({width:n.width,height:n.height,resolution:this.cacheAsBitmapResolution||t.resolution,multisample:null!==(e=this.cacheAsBitmapMultisample)&&void 0!==e?e:t.multisample}),u="cacheAsBitmap_"+fi();this._cacheData.textureCacheId=u,$r.addToCache(h.baseTexture,u),Cs.addToCache(h,u);var c=this.transform.localTransform.copyTo(ug).invert().translate(-n.x,-n.y);this.render=this._cacheData.originalRender,t.render(this,{renderTexture:h,clear:!0,transform:c,skipUpdateTransform:!1}),t.framebuffer.blit(),t.projection.transform=l,t.renderTexture.bind(s,o,a),this.render=this._renderCached,this.updateTransform=this.displayObjectUpdateTransform,this.calculateBounds=this._calculateCachedBounds,this.getLocalBounds=this._getCachedLocalBounds,this._mask=null,this.filterArea=null,this.alpha=i;var d=new tc(h);d.transform.worldTransform=this.transform.worldTransform,d.anchor.x=-n.x/n.width,d.anchor.y=-n.y/n.height,d.alpha=i,d._bounds=this._bounds,this._cacheData.sprite=d,this.transform._parentID=-1,this.parent?this.updateTransform():(this.enableTempParent(),this.updateTransform(),this.disableTempParent(null)),this.containsPoint=d.containsPoint.bind(d)}},qn.prototype._renderCachedCanvas=function(t){!this.visible||this.worldAlpha<=0||!this.renderable||(this._initCachedDisplayObjectCanvas(t),this._cacheData.sprite.worldAlpha=this.worldAlpha,this._cacheData.sprite._renderCanvas(t))},qn.prototype._initCachedDisplayObjectCanvas=function(t){if(!this._cacheData||!this._cacheData.sprite){var e=this.getLocalBounds(null,!0),i=this.alpha;this.alpha=1;var n=t.context,r=t._projTransform;e.ceil(Tt.RESOLUTION);var s=Ls.create({width:e.width,height:e.height}),o="cacheAsBitmap_"+fi();this._cacheData.textureCacheId=o,$r.addToCache(s.baseTexture,o),Cs.addToCache(s,o);var a=ug;this.transform.localTransform.copyTo(a),a.invert(),a.tx-=e.x,a.ty-=e.y,this.renderCanvas=this._cacheData.originalRenderCanvas,t.render(this,{renderTexture:s,clear:!0,transform:a,skipUpdateTransform:!1}),t.context=n,t._projTransform=r,this.renderCanvas=this._renderCachedCanvas,this.updateTransform=this.displayObjectUpdateTransform,this.calculateBounds=this._calculateCachedBounds,this.getLocalBounds=this._getCachedLocalBounds,this._mask=null,this.filterArea=null,this.alpha=i;var l=new tc(s);l.transform.worldTransform=this.transform.worldTransform,l.anchor.x=-e.x/e.width,l.anchor.y=-e.y/e.height,l.alpha=i,l._bounds=this._bounds,this._cacheData.sprite=l,this.transform._parentID=-1,this.parent?this.updateTransform():(this.parent=t._tempDisplayObjectParent,this.updateTransform(),this.parent=null),this.containsPoint=l.containsPoint.bind(l)}},qn.prototype._calculateCachedBounds=function(){this._bounds.clear(),this._cacheData.sprite.transform._worldID=this.transform._worldID,this._cacheData.sprite._calculateBounds(),this._bounds.updateID=this._boundsID},qn.prototype._getCachedLocalBounds=function(){return this._cacheData.sprite.getLocalBounds(null)},qn.prototype._destroyCachedDisplayObject=function(){this._cacheData.sprite._texture.destroy(!0),this._cacheData.sprite=null,$r.removeFromCache(this._cacheData.textureCacheId),Cs.removeFromCache(this._cacheData.textureCacheId),this._cacheData.textureCacheId=null},qn.prototype._cacheAsBitmapDestroy=function(t){this.cacheAsBitmap=!1,this.destroy(t)},qn.prototype.name=null,tr.prototype.getChildByName=function(t,e){for(var i=0,n=this.children.length;i<n;i++)if(this.children[i].name===t)return this.children[i];if(e)for(i=0,n=this.children.length;i<n;i++)if(this.children[i].getChildByName){var r=this.children[i].getChildByName(t,!0);if(r)return r}return null},qn.prototype.getGlobalPosition=function(t,e){return void 0===t&&(t=new Fi),void 0===e&&(e=!1),this.parent?this.parent.toGlobal(this.position,t,e):(t.x=this.position.x,t.y=this.position.y),t};var dg=function(t,e){return(dg=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)};function pg(t,e){function i(){this.constructor=t}dg(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}var fg,gg,mg,yg,_g,vg,bg,wg,Sg,xg=(pg(Lg,Sg=bd),Lg.prototype.build=function(){for(var t=this.segWidth*this.segHeight,e=[],i=[],n=[],r=this.segWidth-1,s=this.segHeight-1,o=this.width/r,a=this.height/s,l=0;l<t;l++){var h=l%this.segWidth,u=l/this.segWidth|0;e.push(h*o,u*a),i.push(h/r,u/s)}var c=r*s;for(l=0;l<c;l++){var d=l%r,p=l/r|0,f=p*this.segWidth+d,g=p*this.segWidth+d+1,m=(1+p)*this.segWidth+d,y=(1+p)*this.segWidth+d+1;n.push(f,g,m,g,y,m)}this.buffers[0].data=new Float32Array(e),this.buffers[1].data=new Float32Array(i),this.indexBuffer.data=new Uint16Array(n),this.buffers[0].update(),this.buffers[1].update(),this.indexBuffer.update()},Lg),Tg=(pg(Ng,wg=bd),Object.defineProperty(Ng.prototype,"width",{get:function(){return this._width},enumerable:!1,configurable:!0}),Ng.prototype.build=function(){var t=this.points;if(t){var e=this.getBuffer("aVertexPosition"),i=this.getBuffer("aTextureCoord"),n=this.getIndex();if(!(t.length<1)){e.data.length/4!==t.length&&(e.data=new Float32Array(4*t.length),i.data=new Float32Array(4*t.length),n.data=new Uint16Array(6*(t.length-1)));var r=i.data,s=n.data;r[0]=0,r[1]=0,r[2]=0,r[3]=1;for(var o=0,a=t[0],l=this._width*this.textureScale,h=t.length,u=0;u<h;u++){var c=4*u;if(0<this.textureScale){var d=a.x-t[u].x,p=a.y-t[u].y,f=Math.sqrt(d*d+p*p);a=t[u],o+=f/l}else o=u/(h-1);r[c]=o,r[c+1]=0,r[c+2]=o,r[c+3]=1}var g=0;for(u=0;u<h-1;u++)c=2*u,s[g++]=c,s[g++]=c+1,s[g++]=c+2,s[g++]=c+2,s[g++]=c+1,s[g++]=c+3;i.update(),n.update(),this.updateVertices()}}},Ng.prototype.updateVertices=function(){var t=this.points;if(!(t.length<1)){for(var e,i=t[0],n=0,r=0,s=this.buffers[0].data,o=t.length,a=0;a<o;a++){var l=t[a],h=4*a;r=-((e=a<t.length-1?t[a+1]:l).x-i.x),n=e.y-i.y;var u=Math.sqrt(n*n+r*r),c=0<this.textureScale?this.textureScale*this._width/2:this._width/2;n/=u,r/=u,n*=c,r*=c,s[h]=l.x+n,s[1+h]=l.y+r,s[2+h]=l.x-n,s[3+h]=l.y-r,i=l}this.buffers[0].update()}},Ng.prototype.update=function(){0<this.textureScale?this.build():this.updateVertices()},Ng),Ig=(pg(Fg,bg=_d),Fg.prototype._render=function(t){var e=this.geometry;!this.autoUpdate&&e._width===this.shader.texture.height||(e._width=this.shader.texture.height,e.update()),bg.prototype._render.call(this,t)},Fg),Pg=(pg(Dg,vg=_d),Dg.prototype.textureUpdated=function(){this._textureID=this.shader.texture._updateID;var t=this.geometry,e=this.shader.texture,i=e.width,n=e.height;!this.autoResize||t.width===i&&t.height===n||(t.width=this.shader.texture.width,t.height=this.shader.texture.height,t.build())},Object.defineProperty(Dg.prototype,"texture",{get:function(){return this.shader.texture},set:function(t){this.shader.texture!==t&&(this.shader.texture=t,this._textureID=-1,t.baseTexture.valid?this.textureUpdated():t.once("update",this.textureUpdated,this))},enumerable:!1,configurable:!0}),Dg.prototype._render=function(t){this._textureID!==this.shader.texture._updateID&&this.textureUpdated(),vg.prototype._render.call(this,t)},Dg.prototype.destroy=function(t){this.shader.texture.off("update",this.textureUpdated,this),vg.prototype.destroy.call(this,t)},Dg),Cg=(pg(kg,_g=_d),Object.defineProperty(kg.prototype,"vertices",{get:function(){return this.geometry.getBuffer("aVertexPosition").data},set:function(t){this.geometry.getBuffer("aVertexPosition").data=t},enumerable:!1,configurable:!0}),kg.prototype._render=function(t){this.autoUpdate&&this.geometry.getBuffer("aVertexPosition").update(),_g.prototype._render.call(this,t)},kg),Eg=(pg(Og,yg=Pg),Og.prototype.textureUpdated=function(){this._textureID=this.shader.texture._updateID,this._refresh()},Object.defineProperty(Og.prototype,"vertices",{get:function(){return this.geometry.getBuffer("aVertexPosition").data},set:function(t){this.geometry.getBuffer("aVertexPosition").data=t},enumerable:!1,configurable:!0}),Og.prototype.updateHorizontalVertices=function(){var t=this.vertices,e=this._getMinScale();t[9]=t[11]=t[13]=t[15]=this._topHeight*e,t[17]=t[19]=t[21]=t[23]=this._height-this._bottomHeight*e,t[25]=t[27]=t[29]=t[31]=this._height},Og.prototype.updateVerticalVertices=function(){var t=this.vertices,e=this._getMinScale();t[2]=t[10]=t[18]=t[26]=this._leftWidth*e,t[4]=t[12]=t[20]=t[28]=this._width-this._rightWidth*e,t[6]=t[14]=t[22]=t[30]=this._width},Og.prototype._getMinScale=function(){var t=this._leftWidth+this._rightWidth,e=this._width>t?1:this._width/t,i=this._topHeight+this._bottomHeight,n=this._height>i?1:this._height/i;return Math.min(e,n)},Object.defineProperty(Og.prototype,"width",{get:function(){return this._width},set:function(t){this._width=t,this._refresh()},enumerable:!1,configurable:!0}),Object.defineProperty(Og.prototype,"height",{get:function(){return this._height},set:function(t){this._height=t,this._refresh()},enumerable:!1,configurable:!0}),Object.defineProperty(Og.prototype,"leftWidth",{get:function(){return this._leftWidth},set:function(t){this._leftWidth=t,this._refresh()},enumerable:!1,configurable:!0}),Object.defineProperty(Og.prototype,"rightWidth",{get:function(){return this._rightWidth},set:function(t){this._rightWidth=t,this._refresh()},enumerable:!1,configurable:!0}),Object.defineProperty(Og.prototype,"topHeight",{get:function(){return this._topHeight},set:function(t){this._topHeight=t,this._refresh()},enumerable:!1,configurable:!0}),Object.defineProperty(Og.prototype,"bottomHeight",{get:function(){return this._bottomHeight},set:function(t){this._bottomHeight=t,this._refresh()},enumerable:!1,configurable:!0}),Og.prototype._refresh=function(){var t=this.texture,e=this.geometry.buffers[1].data;this._origWidth=t.orig.width,this._origHeight=t.orig.height;var i=1/this._origWidth,n=1/this._origHeight;e[0]=e[8]=e[16]=e[24]=0,e[1]=e[3]=e[5]=e[7]=0,e[6]=e[14]=e[22]=e[30]=1,e[25]=e[27]=e[29]=e[31]=1,e[2]=e[10]=e[18]=e[26]=i*this._leftWidth,e[4]=e[12]=e[20]=e[28]=1-i*this._rightWidth,e[9]=e[11]=e[13]=e[15]=n*this._topHeight,e[17]=e[19]=e[21]=e[23]=1-n*this._bottomHeight,this.updateHorizontalVertices(),this.updateVerticalVertices(),this.geometry.buffers[0].update(),this.geometry.buffers[1].update()},Og),Ag=function(t,e){return(Ag=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},Mg=(Ag(gg=Bg,mg=fg=tc),gg.prototype=null===mg?Object.create(mg):(Rg.prototype=mg.prototype,new Rg),Bg.prototype.stop=function(){this._playing&&(this._playing=!1,this._autoUpdate&&this._isConnectedToTicker&&(ar.shared.remove(this.update,this),this._isConnectedToTicker=!1))},Bg.prototype.play=function(){this._playing||(this._playing=!0,this._autoUpdate&&!this._isConnectedToTicker&&(ar.shared.add(this.update,this,nt.UPDATE_PRIORITY.HIGH),this._isConnectedToTicker=!0))},Bg.prototype.gotoAndStop=function(t){this.stop();var e=this.currentFrame;this._currentTime=t,e!==this.currentFrame&&this.updateTexture()},Bg.prototype.gotoAndPlay=function(t){var e=this.currentFrame;this._currentTime=t,e!==this.currentFrame&&this.updateTexture(),this.play()},Bg.prototype.update=function(t){if(this._playing){var e=this.animationSpeed*t,i=this.currentFrame;if(null!==this._durations){var n=this._currentTime%1*this._durations[this.currentFrame];for(n+=e/60*1e3;n<0;)this._currentTime--,n+=this._durations[this.currentFrame];var r=Math.sign(this.animationSpeed*t);for(this._currentTime=Math.floor(this._currentTime);n>=this._durations[this.currentFrame];)n-=this._durations[this.currentFrame]*r,this._currentTime+=r;this._currentTime+=n/this._durations[this.currentFrame]}else this._currentTime+=e;this._currentTime<0&&!this.loop?(this.gotoAndStop(0),this.onComplete&&this.onComplete()):this._currentTime>=this._textures.length&&!this.loop?(this.gotoAndStop(this._textures.length-1),this.onComplete&&this.onComplete()):i!==this.currentFrame&&(this.loop&&this.onLoop&&(0<this.animationSpeed&&this.currentFrame<i?this.onLoop():this.animationSpeed<0&&this.currentFrame>i&&this.onLoop()),this.updateTexture())}},Bg.prototype.updateTexture=function(){var t=this.currentFrame;this._previousFrame!==t&&(this._previousFrame=t,this._texture=this._textures[t],this._textureID=-1,this._textureTrimmedID=-1,this._cachedTint=16777215,this.uvs=this._texture._uvs.uvsFloat32,this.updateAnchor&&this._anchor.copyFrom(this._texture.defaultAnchor),this.onFrameChange&&this.onFrameChange(this.currentFrame))},Bg.prototype.destroy=function(t){this.stop(),fg.prototype.destroy.call(this,t),this.onComplete=null,this.onFrameChange=null,this.onLoop=null},Bg.fromFrames=function(t){for(var e=[],i=0;i<t.length;++i)e.push(Cs.from(t[i]));return new Bg(e)},Bg.fromImages=function(t){for(var e=[],i=0;i<t.length;++i)e.push(Cs.from(t[i]));return new Bg(e)},Object.defineProperty(Bg.prototype,"totalFrames",{get:function(){return this._textures.length},enumerable:!1,configurable:!0}),Object.defineProperty(Bg.prototype,"textures",{get:function(){return this._textures},set:function(t){if(t[0]instanceof Cs)this._textures=t,this._durations=null;else{this._textures=[],this._durations=[];for(var e=0;e<t.length;e++)this._textures.push(t[e].texture),this._durations.push(t[e].time)}this._previousFrame=null,this.gotoAndStop(0),this.updateTexture()},enumerable:!1,configurable:!0}),Object.defineProperty(Bg.prototype,"currentFrame",{get:function(){var t=Math.floor(this._currentTime)%this._textures.length;return t<0&&(t+=this._textures.length),t},enumerable:!1,configurable:!0}),Object.defineProperty(Bg.prototype,"playing",{get:function(){return this._playing},enumerable:!1,configurable:!0}),Object.defineProperty(Bg.prototype,"autoUpdate",{get:function(){return this._autoUpdate},set:function(t){t!==this._autoUpdate&&(this._autoUpdate=t,!this._autoUpdate&&this._isConnectedToTicker?(ar.shared.remove(this.update,this),this._isConnectedToTicker=!1):this._autoUpdate&&!this._isConnectedToTicker&&this._playing&&(ar.shared.add(this.update,this),this._isConnectedToTicker=!0))},enumerable:!1,configurable:!0}),Bg);function Bg(t,e){void 0===e&&(e=!0);var i=fg.call(this,t[0]instanceof Cs?t[0]:t[0].texture)||this;return i._textures=null,i._durations=null,i._autoUpdate=e,i._isConnectedToTicker=!1,i.animationSpeed=1,i.loop=!0,i.updateAnchor=!1,i.onComplete=null,i.onFrameChange=null,i.onLoop=null,i._currentTime=0,i._playing=!1,i._previousFrame=null,i.textures=t,i}function Rg(){this.constructor=gg}function Og(t,e,i,n,r){void 0===e&&(e=10),void 0===i&&(i=10),void 0===n&&(n=10),void 0===r&&(r=10);var s=yg.call(this,Cs.WHITE,4,4)||this;return s._origWidth=t.orig.width,s._origHeight=t.orig.height,s._width=s._origWidth,s._height=s._origHeight,s._leftWidth=e,s._rightWidth=n,s._topHeight=i,s._bottomHeight=r,s.texture=t,s}function kg(t,e,i,n,r){void 0===t&&(t=Cs.EMPTY);var s=this,o=new bd(e,i,n);o.getBuffer("aVertexPosition").static=!1;var a=new vd(t);return(s=_g.call(this,o,a,null,r)||this).autoUpdate=!0,s}function Dg(t,e,i){var n=this,r=new xg(t.width,t.height,e,i),s=new vd(Cs.WHITE);return(n=vg.call(this,r,s)||this).texture=t,n.autoResize=!0,n}function Fg(t,e,i){void 0===i&&(i=0);var n=this,r=new Tg(t.height,e,i),s=new vd(t);return 0<i&&(t.baseTexture.wrapMode=nt.WRAP_MODES.REPEAT),(n=bg.call(this,r,s)||this).autoUpdate=!0,n}function Ng(t,e,i){void 0===t&&(t=200),void 0===i&&(i=0);var n=wg.call(this,new Float32Array(4*e.length),new Float32Array(4*e.length),new Uint16Array(6*(e.length-1)))||this;return n.points=e,n._width=t,n.textureScale=i,n.build(),n}function Lg(t,e,i,n){void 0===t&&(t=100),void 0===e&&(e=100),void 0===i&&(i=10),void 0===n&&(n=10);var r=Sg.call(this)||this;return r.segWidth=i,r.segHeight=n,r.width=t,r.height=e,r.build(),r}Ja.registerPlugin("accessibility",rr),Ja.registerPlugin("extract",Ul),Ja.registerPlugin("interaction",Pr),Ja.registerPlugin("particle",ru),Ja.registerPlugin("prepare",Hc),Ja.registerPlugin("batch",Sl),Ja.registerPlugin("tilingSprite",od),hh.registerPlugin(qd),hh.registerPlugin(Rh),hh.registerPlugin(Gh),hh.registerPlugin(qh),hh.registerPlugin(Vc),kl.registerPlugin(lr),kl.registerPlugin(fh);var Ug={AlphaFilter:$d,BlurFilter:Qp,BlurFilterPass:$p,ColorMatrixFilter:Zp,DisplacementFilter:Zf,FXAAFilter:eg,NoiseFilter:ng},zg=function(t,e){return(zg=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},Wg=(Gg.prototype.pushMask=function(t){var e=this.renderer,i=t.maskObject||t;e.context.save();var n=this._foundShapes;if(this.recursiveFindShapes(i,n),0<n.length){var r=e.context;r.beginPath();for(var s=0;s<n.length;s++){var o=n[s],a=o.transform.worldTransform;this.renderer.setContextTransform(a),this.renderGraphicsShape(o)}n.length=0,r.clip()}},Gg.prototype.recursiveFindShapes=function(t,e){t.geometry&&t.geometry.graphicsData&&e.push(t);var i=t.children;if(i)for(var n=0;n<i.length;n++)this.recursiveFindShapes(i[n],e)},Gg.prototype.renderGraphicsShape=function(t){t.finishPoly();var e=this.renderer.context,i=t.geometry.graphicsData,n=i.length;if(0!==n)for(var r=0;r<n;r++){var s=i[r],o=s.shape;if(o.type===nt.SHAPES.POLY){var a=o.points,l=s.holes,h=void 0,u=void 0,c=void 0,d=void 0;e.moveTo(a[0],a[1]);for(var p=1;p<a.length/2;p++)e.lineTo(a[2*p],a[2*p+1]);if(0<l.length){for(c=a[h=0],d=a[1],p=2;p+2<a.length;p+=2)h+=(a[p]-c)*(a[p+3]-d)-(a[p+2]-c)*(a[p+1]-d);for(var f=0;f<l.length;f++)if(a=l[f].shape.points){for(c=a[u=0],d=a[1],p=2;p+2<a.length;p+=2)u+=(a[p]-c)*(a[p+3]-d)-(a[p+2]-c)*(a[p+1]-d);if(u*h<0)for(e.moveTo(a[0],a[1]),p=2;p<a.length;p+=2)e.lineTo(a[p],a[p+1]);else for(e.moveTo(a[a.length-2],a[a.length-1]),p=a.length-4;0<=p;p-=2)e.lineTo(a[p],a[p+1]);l[f].shape.closeStroke&&e.closePath()}}a[0]===a[a.length-2]&&a[1]===a[a.length-1]&&e.closePath()}else if(o.type===nt.SHAPES.RECT)e.rect(o.x,o.y,o.width,o.height),e.closePath();else if(o.type===nt.SHAPES.CIRC)e.arc(o.x,o.y,o.radius,0,2*Math.PI),e.closePath();else if(o.type===nt.SHAPES.ELIP){var g=2*o.width,m=2*o.height,y=o.x-g/2,_=o.y-m/2,v=g/2*.5522848,b=m/2*.5522848,w=y+g,S=_+m,x=y+g/2,T=_+m/2;e.moveTo(y,T),e.bezierCurveTo(y,T-b,x-v,_,x,_),e.bezierCurveTo(x+v,_,w,T-b,w,T),e.bezierCurveTo(w,T+b,x+v,S,x,S),e.bezierCurveTo(x-v,S,y,T+b,y,T),e.closePath()}else if(o.type===nt.SHAPES.RREC){var I=o.x,P=o.y,C=o.width,E=o.height,A=o.radius,M=Math.min(C,E)/2;A=M<A?M:A,e.moveTo(I,P+A),e.lineTo(I,P+E-A),e.quadraticCurveTo(I,P+E,I+A,P+E),e.lineTo(I+C-A,P+E),e.quadraticCurveTo(I+C,P+E,I+C,P+E-A),e.lineTo(I+C,P+A),e.quadraticCurveTo(I+C,P,I+C-A,P),e.lineTo(I+A,P),e.quadraticCurveTo(I,P,I,P+A),e.closePath()}}},Gg.prototype.popMask=function(t){t.context.restore(),t.invalidateBlendMode()},Gg.prototype.destroy=function(){},Gg);function Gg(t){this._foundShapes=[],this.renderer=t}function Hg(t){var e=document.createElement("canvas");e.width=6,e.height=1;var i=e.getContext("2d");return i.fillStyle=t,i.fillRect(0,0,6,1),e}function Xg(){if("undefined"==typeof document)return!1;var t=Hg("#ff00ff"),e=Hg("#ffff00"),i=document.createElement("canvas");i.width=6,i.height=1;var n=i.getContext("2d");n.globalCompositeOperation="multiply",n.drawImage(t,0,0),n.drawImage(e,2,0);var r=n.getImageData(2,0,1,1);if(!r)return!1;var s=r.data;return 255===s[0]&&0===s[1]&&0===s[2]}var jg,Vg,Yg,qg=new Li,Kg=(zg(Vg=Qg,Yg=jg=$a),Vg.prototype=null===Yg?Object.create(Yg):(Jg.prototype=Yg.prototype,new Jg),Qg.prototype.render=function(t,e){if(this.view){var i,n,r,s;e&&(s=e instanceof Ls||e instanceof Ts?(i=e,n=arguments[2],r=arguments[3],arguments[4]):(i=e.renderTexture,n=e.clear,r=e.transform,e.skipUpdateTransform)),this.renderingToScreen=!i,this.emit("prerender");var o=this.resolution;i?((i=i.castToBaseTexture())._canvasRenderTarget||(i._canvasRenderTarget=new vi(i.width,i.height,i.resolution),i.resource=new ts(i._canvasRenderTarget.canvas),i.valid=!0),this.context=i._canvasRenderTarget.context,this.resolution=i._canvasRenderTarget.resolution):this.context=this.rootContext;var a=this.context;if(this._projTransform=r||null,i||(this._lastObjectRendered=t),!s){var l=t.enableTempParent();t.updateTransform(),t.disableTempParent(l)}if(a.save(),a.setTransform(1,0,0,1,0,0),a.globalAlpha=1,this._activeBlendMode=nt.BLEND_MODES.NORMAL,this._outerBlend=!1,a.globalCompositeOperation=this.blendModes[nt.BLEND_MODES.NORMAL],void 0!==n?n:this.clearBeforeRender)if(this.renderingToScreen)a.clearRect(0,0,this.width,this.height),0<this.backgroundAlpha&&(a.globalAlpha=this.useContextAlpha?this.backgroundAlpha:1,a.fillStyle=this._backgroundColorString,a.fillRect(0,0,this.width,this.height),a.globalAlpha=1);else{(i=i)._canvasRenderTarget.clear();var h=i.clearColor;0<h[3]&&(a.globalAlpha=this.useContextAlpha?h[3]:1,a.fillStyle=Qe(Ze(h)),a.fillRect(0,0,i.realWidth,i.realHeight),a.globalAlpha=1)}var u=this.context;this.context=a,t.renderCanvas(this),this.context=u,a.restore(),this.resolution=o,this._projTransform=null,this.emit("postrender")}},Qg.prototype.setContextTransform=function(t,e,i){var n=t,r=this._projTransform,s=this.resolution;i=i||s,r&&((n=qg).copyFrom(t),n.prepend(r)),e?this.context.setTransform(n.a*i,n.b*i,n.c*i,n.d*i,n.tx*s|0,n.ty*s|0):this.context.setTransform(n.a*i,n.b*i,n.c*i,n.d*i,n.tx*s,n.ty*s)},Qg.prototype.clear=function(t,e){void 0===t&&(t=this._backgroundColorString),void 0===e&&(e=this.backgroundAlpha);var i=this.context;i.clearRect(0,0,this.width,this.height),t&&(i.globalAlpha=this.useContextAlpha?e:1,i.fillStyle=t,i.fillRect(0,0,this.width,this.height),i.globalAlpha=1)},Qg.prototype.setBlendMode=function(t,e){var i=t===nt.BLEND_MODES.SRC_IN||t===nt.BLEND_MODES.SRC_OUT||t===nt.BLEND_MODES.DST_IN||t===nt.BLEND_MODES.DST_ATOP;!e&&i&&(t=nt.BLEND_MODES.NORMAL),this._activeBlendMode!==t&&(this._activeBlendMode=t,this._outerBlend=i,this.context.globalCompositeOperation=this.blendModes[t])},Qg.prototype.destroy=function(t){jg.prototype.destroy.call(this,t),this.context=null,this.refresh=!0,this.maskManager.destroy(),this.maskManager=null,this.smoothProperty=null},Qg.prototype.resize=function(t,e){jg.prototype.resize.call(this,t,e),this.smoothProperty&&(this.rootContext[this.smoothProperty]=Tt.SCALE_MODE===nt.SCALE_MODES.LINEAR)},Qg.prototype.invalidateBlendMode=function(){this._activeBlendMode=this.blendModes.indexOf(this.context.globalCompositeOperation)},Qg.registerPlugin=function(t,e){(Qg.__plugins=Qg.__plugins||{})[t]=e},Qg),$g={canvas:null,getTintedCanvas:function(t,e){var i=t.texture,n="#"+("00000"+(0|(e=$g.roundColor(e))).toString(16)).substr(-6);i.tintCache=i.tintCache||{};var r,s=i.tintCache[n];if(s){if(s.tintId===i._updateID)return i.tintCache[n];r=i.tintCache[n]}else r=document.createElement("canvas");if($g.tintMethod(i,e,r),r.tintId=i._updateID,$g.convertTintToImage){var o=new Image;o.src=r.toDataURL(),i.tintCache[n]=o}else i.tintCache[n]=r;return r},getTintedPattern:function(t,e){var i="#"+("00000"+(0|(e=$g.roundColor(e))).toString(16)).substr(-6);t.patternCache=t.patternCache||{};var n=t.patternCache[i];return n&&n.tintId===t._updateID||($g.canvas||($g.canvas=document.createElement("canvas")),$g.tintMethod(t,e,$g.canvas),(n=$g.canvas.getContext("2d").createPattern($g.canvas,"repeat")).tintId=t._updateID,t.patternCache[i]=n),n},tintWithMultiply:function(t,e,i){var n=i.getContext("2d"),r=t._frame.clone(),s=t.baseTexture.resolution;r.x*=s,r.y*=s,r.width*=s,r.height*=s,i.width=Math.ceil(r.width),i.height=Math.ceil(r.height),n.save(),n.fillStyle="#"+("00000"+(0|e).toString(16)).substr(-6),n.fillRect(0,0,r.width,r.height),n.globalCompositeOperation="multiply";var o=t.baseTexture.getDrawableSource();n.drawImage(o,r.x,r.y,r.width,r.height,0,0,r.width,r.height),n.globalCompositeOperation="destination-atop",n.drawImage(o,r.x,r.y,r.width,r.height,0,0,r.width,r.height),n.restore()},tintWithOverlay:function(t,e,i){var n=i.getContext("2d"),r=t._frame.clone(),s=t.baseTexture.resolution;r.x*=s,r.y*=s,r.width*=s,r.height*=s,i.width=Math.ceil(r.width),i.height=Math.ceil(r.height),n.save(),n.globalCompositeOperation="copy",n.fillStyle="#"+("00000"+(0|e).toString(16)).substr(-6),n.fillRect(0,0,r.width,r.height),n.globalCompositeOperation="destination-atop",n.drawImage(t.baseTexture.getDrawableSource(),r.x,r.y,r.width,r.height,0,0,r.width,r.height),n.restore()},tintWithPerPixel:function(t,e,i){var n=i.getContext("2d"),r=t._frame.clone(),s=t.baseTexture.resolution;r.x*=s,r.y*=s,r.width*=s,r.height*=s,i.width=Math.ceil(r.width),i.height=Math.ceil(r.height),n.save(),n.globalCompositeOperation="copy",n.drawImage(t.baseTexture.getDrawableSource(),r.x,r.y,r.width,r.height,0,0,r.width,r.height),n.restore();for(var o=$e(e),a=o[0],l=o[1],h=o[2],u=n.getImageData(0,0,r.width,r.height),c=u.data,d=0;d<c.length;d+=4)c[d+0]*=a,c[d+1]*=l,c[d+2]*=h;n.putImageData(u,0,0)},roundColor:function(t){var e=$g.cacheStepsPerColorChannel,i=$e(t);return i[0]=Math.min(255,i[0]/e*e),i[1]=Math.min(255,i[1]/e*e),i[2]=Math.min(255,i[2]/e*e),Ze(i)},cacheStepsPerColorChannel:8,convertTintToImage:!1,canUseMultiply:Xg(),tintMethod:null};function Qg(t){var e,i=jg.call(this,nt.RENDERER_TYPE.CANVAS,t)||this;if(i.refresh=!0,i.maskManager=new Wg(i),i.smoothProperty="imageSmoothingEnabled",i.blendModes=(void 0===e&&(e=[]),Xg()?(e[nt.BLEND_MODES.NORMAL]="source-over",e[nt.BLEND_MODES.ADD]="lighter",e[nt.BLEND_MODES.MULTIPLY]="multiply",e[nt.BLEND_MODES.SCREEN]="screen",e[nt.BLEND_MODES.OVERLAY]="overlay",e[nt.BLEND_MODES.DARKEN]="darken",e[nt.BLEND_MODES.LIGHTEN]="lighten",e[nt.BLEND_MODES.COLOR_DODGE]="color-dodge",e[nt.BLEND_MODES.COLOR_BURN]="color-burn",e[nt.BLEND_MODES.HARD_LIGHT]="hard-light",e[nt.BLEND_MODES.SOFT_LIGHT]="soft-light",e[nt.BLEND_MODES.DIFFERENCE]="difference",e[nt.BLEND_MODES.EXCLUSION]="exclusion",e[nt.BLEND_MODES.HUE]="hue",e[nt.BLEND_MODES.SATURATION]="saturate",e[nt.BLEND_MODES.COLOR]="color",e[nt.BLEND_MODES.LUMINOSITY]="luminosity"):(e[nt.BLEND_MODES.NORMAL]="source-over",e[nt.BLEND_MODES.ADD]="lighter",e[nt.BLEND_MODES.MULTIPLY]="source-over",e[nt.BLEND_MODES.SCREEN]="source-over",e[nt.BLEND_MODES.OVERLAY]="source-over",e[nt.BLEND_MODES.DARKEN]="source-over",e[nt.BLEND_MODES.LIGHTEN]="source-over",e[nt.BLEND_MODES.COLOR_DODGE]="source-over",e[nt.BLEND_MODES.COLOR_BURN]="source-over",e[nt.BLEND_MODES.HARD_LIGHT]="source-over",e[nt.BLEND_MODES.SOFT_LIGHT]="source-over",e[nt.BLEND_MODES.DIFFERENCE]="source-over",e[nt.BLEND_MODES.EXCLUSION]="source-over",e[nt.BLEND_MODES.HUE]="source-over",e[nt.BLEND_MODES.SATURATION]="source-over",e[nt.BLEND_MODES.COLOR]="source-over",e[nt.BLEND_MODES.LUMINOSITY]="source-over"),e[nt.BLEND_MODES.NORMAL_NPM]=e[nt.BLEND_MODES.NORMAL],e[nt.BLEND_MODES.ADD_NPM]=e[nt.BLEND_MODES.ADD],e[nt.BLEND_MODES.SCREEN_NPM]=e[nt.BLEND_MODES.SCREEN],e[nt.BLEND_MODES.SRC_IN]="source-in",e[nt.BLEND_MODES.SRC_OUT]="source-out",e[nt.BLEND_MODES.SRC_ATOP]="source-atop",e[nt.BLEND_MODES.DST_OVER]="destination-over",e[nt.BLEND_MODES.DST_IN]="destination-in",e[nt.BLEND_MODES.DST_OUT]="destination-out",e[nt.BLEND_MODES.DST_ATOP]="destination-atop",e[nt.BLEND_MODES.XOR]="xor",e[nt.BLEND_MODES.SUBTRACT]="source-over",e),i.renderingToScreen=!1,i._activeBlendMode=null,i._projTransform=null,i._outerBlend=!1,i.rootContext=i.view.getContext("2d",{alpha:i.useContextAlpha}),i.context=i.rootContext,!i.rootContext.imageSmoothingEnabled){var n=i.rootContext;n.webkitImageSmoothingEnabled?i.smoothProperty="webkitImageSmoothingEnabled":n.mozImageSmoothingEnabled?i.smoothProperty="mozImageSmoothingEnabled":n.oImageSmoothingEnabled?i.smoothProperty="oImageSmoothingEnabled":n.msImageSmoothingEnabled&&(i.smoothProperty="msImageSmoothingEnabled")}return i.initPlugins(Qg.__plugins),Ye("Canvas"),i.resize(i.options.width,i.options.height),i}function Jg(){this.constructor=Vg}$g.tintMethod=$g.canUseMultiply?$g.tintWithMultiply:$g.tintWithPerPixel;var Zg=Ja.create;Ja.create=function(t){if(!t||!t.forceCanvas)try{return Zg(t)}catch(t){}return new Kg(t)},$r.prototype.getDrawableSource=function(){var t=this.resource;return t?t.bitmap||t.source:null},Ts.prototype._canvasRenderTarget=null,Cs.prototype.patternCache=null,Cs.prototype.tintCache=null;var tm="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function em(t,e,i){return t(i={path:e,exports:{},require:function(t,e){return function(){throw new Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}(null==e&&i.path)}},i.exports),i.exports}var im=em(function(t){var n=Object.prototype.hasOwnProperty,f="~";function i(){}function a(t,e,i){this.fn=t,this.context=e,this.once=i||!1}function r(t,e,i,n,r){if("function"!=typeof i)throw new TypeError("The listener must be a function");var s=new a(i,n||t,r),o=f?f+e:e;return t._events[o]?t._events[o].fn?t._events[o]=[t._events[o],s]:t._events[o].push(s):(t._events[o]=s,t._eventsCount++),t}function h(t,e){0==--t._eventsCount?t._events=new i:delete t._events[e]}function e(){this._events=new i,this._eventsCount=0}Object.create&&(i.prototype=Object.create(null),(new i).__proto__||(f=!1)),e.prototype.eventNames=function(){var t,e,i=[];if(0===this._eventsCount)return i;for(e in t=this._events)n.call(t,e)&&i.push(f?e.slice(1):e);return Object.getOwnPropertySymbols?i.concat(Object.getOwnPropertySymbols(t)):i},e.prototype.listeners=function(t){var e=f?f+t:t,i=this._events[e];if(!i)return[];if(i.fn)return[i.fn];for(var n=0,r=i.length,s=new Array(r);n<r;n++)s[n]=i[n].fn;return s},e.prototype.listenerCount=function(t){var e=f?f+t:t,i=this._events[e];return i?i.fn?1:i.length:0},e.prototype.emit=function(t,e,i,n,r,s){var o=arguments,a=f?f+t:t;if(!this._events[a])return!1;var l,h,u=this._events[a],c=arguments.length;if(u.fn){switch(u.once&&this.removeListener(t,u.fn,void 0,!0),c){case 1:return u.fn.call(u.context),!0;case 2:return u.fn.call(u.context,e),!0;case 3:return u.fn.call(u.context,e,i),!0;case 4:return u.fn.call(u.context,e,i,n),!0;case 5:return u.fn.call(u.context,e,i,n,r),!0;case 6:return u.fn.call(u.context,e,i,n,r,s),!0}for(h=1,l=new Array(c-1);h<c;h++)l[h-1]=o[h];u.fn.apply(u.context,l)}else{var d,p=u.length;for(h=0;h<p;h++)switch(u[h].once&&this.removeListener(t,u[h].fn,void 0,!0),c){case 1:u[h].fn.call(u[h].context);break;case 2:u[h].fn.call(u[h].context,e);break;case 3:u[h].fn.call(u[h].context,e,i);break;case 4:u[h].fn.call(u[h].context,e,i,n);break;default:if(!l)for(d=1,l=new Array(c-1);d<c;d++)l[d-1]=o[d];u[h].fn.apply(u[h].context,l)}}return!0},e.prototype.on=function(t,e,i){return r(this,t,e,i,!1)},e.prototype.once=function(t,e,i){return r(this,t,e,i,!0)},e.prototype.removeListener=function(t,e,i,n){var r=f?f+t:t;if(!this._events[r])return this;if(!e)return h(this,r),this;var s=this._events[r];if(s.fn)s.fn!==e||n&&!s.once||i&&s.context!==i||h(this,r);else{for(var o=0,a=[],l=s.length;o<l;o++)(s[o].fn!==e||n&&!s[o].once||i&&s[o].context!==i)&&a.push(s[o]);a.length?this._events[r]=1===a.length?a[0]:a:h(this,r)}return this},e.prototype.removeAllListeners=function(t){var e;return t?(e=f?f+t:t,this._events[e]&&h(this,e)):(this._events=new i,this._eventsCount=0),this},e.prototype.off=e.prototype.removeListener,e.prototype.addListener=e.prototype.on,e.prefixed=f,e.EventEmitter=e,t.exports=e}),nm=em(function(C,E){!function(t){var e=E&&!E.nodeType&&E,i=C&&!C.nodeType&&C,n="object"==typeof tm&&tm;n.global!==n&&n.window!==n&&n.self!==n||(t=n);var r,s,y=2147483647,_=36,v=26,o=38,a=700,l=/^xn--/,h=/[^\x20-\x7E]/,u=/[\x2E\u3002\uFF0E\uFF61]/g,c={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},d=_-1,b=Math.floor,w=String.fromCharCode;function S(t){throw RangeError(c[t])}function p(t,e){for(var i=t.length,n=[];i--;)n[i]=e(t[i]);return n}function f(t,e){var i=t.split("@"),n="";return 1<i.length&&(n=i[0]+"@",t=i[1]),n+p((t=t.replace(u,".")).split("."),e).join(".")}function x(t){for(var e,i,n=[],r=0,s=t.length;r<s;)55296<=(e=t.charCodeAt(r++))&&e<=56319&&r<s?56320==(64512&(i=t.charCodeAt(r++)))?n.push(((1023&e)<<10)+(1023&i)+65536):(n.push(e),r--):n.push(e);return n}function T(t){return p(t,function(t){var e="";return 65535<t&&(e+=w((t-=65536)>>>10&1023|55296),t=56320|1023&t),e+w(t)}).join("")}function I(t,e){return t+22+75*(t<26)-((0!=e)<<5)}function P(t,e,i){var n=0;for(t=i?b(t/a):t>>1,t+=b(t/e);d*v>>1<t;n+=_)t=b(t/d);return b(n+(d+1)*t/(t+o))}function g(t){var e,i,n,r,s,o,a,l,h,u,c,d=[],p=t.length,f=0,g=128,m=72;for((i=t.lastIndexOf("-"))<0&&(i=0),n=0;n<i;++n)128<=t.charCodeAt(n)&&S("not-basic"),d.push(t.charCodeAt(n));for(r=0<i?i+1:0;r<p;){for(s=f,o=1,a=_;p<=r&&S("invalid-input"),((l=(c=t.charCodeAt(r++))-48<10?c-22:c-65<26?c-65:c-97<26?c-97:_)>=_||l>b((y-f)/o))&&S("overflow"),f+=l*o,!(l<(h=a<=m?1:m+v<=a?v:a-m));a+=_)o>b(y/(u=_-h))&&S("overflow"),o*=u;m=P(f-s,e=d.length+1,0==s),b(f/e)>y-g&&S("overflow"),g+=b(f/e),f%=e,d.splice(f++,0,g)}return T(d)}function m(t){var e,i,n,r,s,o,a,l,h,u,c,d,p,f,g,m=[];for(d=(t=x(t)).length,e=128,s=72,o=i=0;o<d;++o)(c=t[o])<128&&m.push(w(c));for(n=r=m.length,r&&m.push("-");n<d;){for(a=y,o=0;o<d;++o)(c=t[o])>=e&&c<a&&(a=c);for(a-e>b((y-i)/(p=n+1))&&S("overflow"),i+=(a-e)*p,e=a,o=0;o<d;++o)if((c=t[o])<e&&++i>y&&S("overflow"),c==e){for(l=i,h=_;!(l<(u=h<=s?1:s+v<=h?v:h-s));h+=_)g=l-u,f=_-u,m.push(w(I(u+g%f,0))),l=b(g/f);m.push(w(I(l,0))),s=P(i,p,n==r),i=0,++n}++i,++e}return m.join("")}if(r={version:"1.3.2",ucs2:{decode:x,encode:T},decode:g,encode:m,toASCII:function(t){return f(t,function(t){return h.test(t)?"xn--"+m(t):t})},toUnicode:function(t){return f(t,function(t){return l.test(t)?g(t.slice(4).toLowerCase()):t})}},e&&i)if(C.exports==e)i.exports=r;else for(s in r)r.hasOwnProperty(s)&&(e[s]=r[s]);else t.punycode=r}(tm)}),rm=function(t){return"string"==typeof t},sm=function(t){return"object"==typeof t&&null!==t},om=function(t){return null===t},am=function(t){return null==t};function lm(t,e,i,n){e=e||"&",i=i||"=";var r={};if("string"!=typeof t||0===t.length)return r;var s=/\+/g;t=t.split(e);var o=1e3;n&&"number"==typeof n.maxKeys&&(o=n.maxKeys);var a,l,h=t.length;0<o&&o<h&&(h=o);for(var u=0;u<h;++u){var c,d,p,f,g=t[u].replace(s,"%20"),m=g.indexOf(i);d=0<=m?(c=g.substr(0,m),g.substr(m+1)):(c=g,""),p=decodeURIComponent(c),f=decodeURIComponent(d),a=r,l=p,Object.prototype.hasOwnProperty.call(a,l)?Array.isArray(r[p])?r[p].push(f):r[p]=[r[p],f]:r[p]=f}return r}function hm(t){switch(typeof t){case"string":return t;case"boolean":return t?"true":"false";case"number":return isFinite(t)?t:"";default:return""}}function um(i,n,r,t){return n=n||"&",r=r||"=",null===i&&(i=void 0),"object"==typeof i?Object.keys(i).map(function(t){var e=encodeURIComponent(hm(t))+r;return Array.isArray(i[t])?i[t].map(function(t){return e+encodeURIComponent(hm(t))}).join(n):e+encodeURIComponent(hm(i[t]))}).join(n):t?encodeURIComponent(hm(t))+r+encodeURIComponent(hm(i)):""}var cm=em(function(t,e){e.decode=e.parse=lm,e.encode=e.stringify=um}),dm=Pm;function pm(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}var fm=/^([a-z0-9.+-]+:)/i,gm=/:[0-9]*$/,mm=/^(\/\/?(?!\/)[^\?\s]*)(\?[^\s]*)?$/,ym=["{","}","|","\\","^","`"].concat(["<",">",'"',"`"," ","\r","\n","\t"]),_m=["'"].concat(ym),vm=["%","/","?",";","#"].concat(_m),bm=["/","?","#"],wm=/^[+a-z0-9A-Z_-]{0,63}$/,Sm=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,xm={javascript:!0,"javascript:":!0},Tm={javascript:!0,"javascript:":!0},Im={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0};function Pm(t,e,i){if(t&&sm(t)&&t instanceof pm)return t;var n=new pm;return n.parse(t,e,i),n}pm.prototype.parse=function(t,e,i){if(!rm(t))throw new TypeError("Parameter 'url' must be a string, not "+typeof t);var n=t.indexOf("?"),r=-1!==n&&n<t.indexOf("#")?"?":"#",s=t.split(r);s[0]=s[0].replace(/\\/g,"/");var o=t=s.join(r);if(o=o.trim(),!i&&1===t.split("#").length){var a=mm.exec(o);if(a)return this.path=o,this.href=o,this.pathname=a[1],a[2]?(this.search=a[2],this.query=e?cm.parse(this.search.substr(1)):this.search.substr(1)):e&&(this.search="",this.query={}),this}var l=fm.exec(o);if(l){var h=(l=l[0]).toLowerCase();this.protocol=h,o=o.substr(l.length)}if(i||l||o.match(/^\/\/[^@\/]+@[^@\/]+/)){var u="//"===o.substr(0,2);!u||l&&Tm[l]||(o=o.substr(2),this.slashes=!0)}if(!Tm[l]&&(u||l&&!Im[l])){for(var c,d,p=-1,f=0;f<bm.length;f++)-1!==(g=o.indexOf(bm[f]))&&(-1===p||g<p)&&(p=g);for(-1!==(d=-1===p?o.lastIndexOf("@"):o.lastIndexOf("@",p))&&(c=o.slice(0,d),o=o.slice(d+1),this.auth=decodeURIComponent(c)),p=-1,f=0;f<vm.length;f++){var g;-1!==(g=o.indexOf(vm[f]))&&(-1===p||g<p)&&(p=g)}-1===p&&(p=o.length),this.host=o.slice(0,p),o=o.slice(p),this.parseHost(),this.hostname=this.hostname||"";var m="["===this.hostname[0]&&"]"===this.hostname[this.hostname.length-1];if(!m)for(var y=this.hostname.split(/\./),_=(f=0,y.length);f<_;f++){var v=y[f];if(v&&!v.match(wm)){for(var b="",w=0,S=v.length;w<S;w++)127<v.charCodeAt(w)?b+="x":b+=v[w];if(!b.match(wm)){var x=y.slice(0,f),T=y.slice(f+1),I=v.match(Sm);I&&(x.push(I[1]),T.unshift(I[2])),T.length&&(o="/"+T.join(".")+o),this.hostname=x.join(".");break}}}255<this.hostname.length?this.hostname="":this.hostname=this.hostname.toLowerCase(),m||(this.hostname=nm.toASCII(this.hostname));var P=this.port?":"+this.port:"",C=this.hostname||"";this.host=C+P,this.href+=this.host,m&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),"/"!==o[0]&&(o="/"+o))}if(!xm[h])for(f=0,_=_m.length;f<_;f++){var E=_m[f];if(-1!==o.indexOf(E)){var A=encodeURIComponent(E);A===E&&(A=escape(E)),o=o.split(E).join(A)}}var M=o.indexOf("#");-1!==M&&(this.hash=o.substr(M),o=o.slice(0,M));var B=o.indexOf("?");if(-1!==B?(this.search=o.substr(B),this.query=o.substr(B+1),e&&(this.query=cm.parse(this.query)),o=o.slice(0,B)):e&&(this.search="",this.query={}),o&&(this.pathname=o),Im[h]&&this.hostname&&!this.pathname&&(this.pathname="/"),this.pathname||this.search){P=this.pathname||"";var R=this.search||"";this.path=P+R}return this.href=this.format(),this},pm.prototype.format=function(){var t=this.auth||"";t&&(t=(t=encodeURIComponent(t)).replace(/%3A/i,":"),t+="@");var e=this.protocol||"",i=this.pathname||"",n=this.hash||"",r=!1,s="";this.host?r=t+this.host:this.hostname&&(r=t+(-1===this.hostname.indexOf(":")?this.hostname:"["+this.hostname+"]"),this.port&&(r+=":"+this.port)),this.query&&sm(this.query)&&Object.keys(this.query).length&&(s=cm.stringify(this.query));var o=this.search||s&&"?"+s||"";return e&&":"!==e.substr(-1)&&(e+=":"),this.slashes||(!e||Im[e])&&!1!==r?(r="//"+(r||""),i&&"/"!==i.charAt(0)&&(i="/"+i)):r=r||"",n&&"#"!==n.charAt(0)&&(n="#"+n),o&&"?"!==o.charAt(0)&&(o="?"+o),e+r+(i=i.replace(/[?#]/g,function(t){return encodeURIComponent(t)}))+(o=o.replace("#","%23"))+n},pm.prototype.resolve=function(t){return this.resolveObject(Pm(t,!1,!0)).format()},pm.prototype.resolveObject=function(t){if(rm(t)){var e=new pm;e.parse(t,!1,!0),t=e}for(var i=new pm,n=Object.keys(this),r=0;r<n.length;r++){var s=n[r];i[s]=this[s]}if(i.hash=t.hash,""===t.href)return i.href=i.format(),i;if(t.slashes&&!t.protocol){for(var o=Object.keys(t),a=0;a<o.length;a++){var l=o[a];"protocol"!==l&&(i[l]=t[l])}return Im[i.protocol]&&i.hostname&&!i.pathname&&(i.path=i.pathname="/"),i.href=i.format(),i}if(t.protocol&&t.protocol!==i.protocol){if(!Im[t.protocol]){for(var h=Object.keys(t),u=0;u<h.length;u++){var c=h[u];i[c]=t[c]}return i.href=i.format(),i}if(i.protocol=t.protocol,t.host||Tm[t.protocol])i.pathname=t.pathname;else{for(var d=(t.pathname||"").split("/");d.length&&!(t.host=d.shift()););t.host||(t.host=""),t.hostname||(t.hostname=""),""!==d[0]&&d.unshift(""),d.length<2&&d.unshift(""),i.pathname=d.join("/")}if(i.search=t.search,i.query=t.query,i.host=t.host||"",i.auth=t.auth,i.hostname=t.hostname||t.host,i.port=t.port,i.pathname||i.search){var p=i.pathname||"",f=i.search||"";i.path=p+f}return i.slashes=i.slashes||t.slashes,i.href=i.format(),i}var g=i.pathname&&"/"===i.pathname.charAt(0),m=t.host||t.pathname&&"/"===t.pathname.charAt(0),y=m||g||i.host&&t.pathname,_=y,v=i.pathname&&i.pathname.split("/")||[],b=(d=t.pathname&&t.pathname.split("/")||[],i.protocol&&!Im[i.protocol]);if(b&&(i.hostname="",i.port=null,i.host&&(""===v[0]?v[0]=i.host:v.unshift(i.host)),i.host="",t.protocol&&(t.hostname=null,t.port=null,t.host&&(""===d[0]?d[0]=t.host:d.unshift(t.host)),t.host=null),y=y&&(""===d[0]||""===v[0])),m)i.host=t.host||""===t.host?t.host:i.host,i.hostname=t.hostname||""===t.hostname?t.hostname:i.hostname,i.search=t.search,i.query=t.query,v=d;else if(d.length)(v=v||[]).pop(),v=v.concat(d),i.search=t.search,i.query=t.query;else if(!am(t.search))return b&&(i.hostname=i.host=v.shift(),(I=!!(i.host&&0<i.host.indexOf("@"))&&i.host.split("@"))&&(i.auth=I.shift(),i.host=i.hostname=I.shift())),i.search=t.search,i.query=t.query,om(i.pathname)&&om(i.search)||(i.path=(i.pathname?i.pathname:"")+(i.search?i.search:"")),i.href=i.format(),i;if(!v.length)return i.pathname=null,i.search?i.path="/"+i.search:i.path=null,i.href=i.format(),i;for(var w=v.slice(-1)[0],S=(i.host||t.host||1<v.length)&&("."===w||".."===w)||""===w,x=0,T=v.length;0<=T;T--)"."===(w=v[T])?v.splice(T,1):".."===w?(v.splice(T,1),x++):x&&(v.splice(T,1),x--);if(!y&&!_)for(;x--;)v.unshift("..");!y||""===v[0]||v[0]&&"/"===v[0].charAt(0)||v.unshift(""),S&&"/"!==v.join("/").substr(-1)&&v.push("");var I,P=""===v[0]||v[0]&&"/"===v[0].charAt(0);return b&&(i.hostname=i.host=P?"":v.length?v.shift():"",(I=!!(i.host&&0<i.host.indexOf("@"))&&i.host.split("@"))&&(i.auth=I.shift(),i.host=i.hostname=I.shift())),(y=y||i.host&&v.length)&&!P&&v.unshift(""),v.length?i.pathname=v.join("/"):(i.pathname=null,i.path=null),om(i.pathname)&&om(i.search)||(i.path=(i.pathname?i.pathname:"")+(i.search?i.search:"")),i.auth=t.auth||i.auth,i.slashes=i.slashes||t.slashes,i.href=i.format(),i},pm.prototype.parseHost=function(){var t=this.host,e=gm.exec(t);e&&(":"!==(e=e[0])&&(this.port=e.substr(1)),t=t.substr(0,t.length-e.length)),t&&(this.hostname=t)};var Cm={parse:dm,format:function(t){return rm(t)&&(t=Pm(t)),t instanceof pm?t.format():pm.prototype.format.call(t)},resolve:function(t,e){return Pm(t,!1,!0).resolve(e)}};Tt.RETINA_PREFIX=/@([0-9\.]+)x/;var Em,Am=Tt.FAIL_IF_MAJOR_PERFORMANCE_CAVEAT=!1,Mm=function(){for(var t=[],e=[],i=0;i<32;i++)e[t[i]=i]=i;t[nt.BLEND_MODES.NORMAL_NPM]=nt.BLEND_MODES.NORMAL,t[nt.BLEND_MODES.ADD_NPM]=nt.BLEND_MODES.ADD,t[nt.BLEND_MODES.SCREEN_NPM]=nt.BLEND_MODES.SCREEN,e[nt.BLEND_MODES.NORMAL]=nt.BLEND_MODES.NORMAL_NPM,e[nt.BLEND_MODES.ADD]=nt.BLEND_MODES.ADD_NPM,e[nt.BLEND_MODES.SCREEN]=nt.BLEND_MODES.SCREEN_NPM;var n=[];return n.push(e),n.push(t),n}();function Bm(t){if(4===t.BYTES_PER_ELEMENT)return t instanceof Float32Array?"Float32Array":t instanceof Uint32Array?"Uint32Array":"Int32Array";if(2===t.BYTES_PER_ELEMENT){if(t instanceof Uint16Array)return"Uint16Array"}else if(1===t.BYTES_PER_ELEMENT&&t instanceof Uint8Array)return"Uint8Array";return null}function Rm(t){return t+=0===t?1:0,--t,t|=t>>>1,t|=t>>>2,t|=t>>>4,1+((t|=t>>>8)|t>>>16)}function Om(t){return!(t&t-1||!t)}function km(t){var e=(65535<t?1:0)<<4,i=(255<(t>>>=e)?1:0)<<3;return e|=i,e|=i=(15<(t>>>=i)?1:0)<<2,(e|=i=(3<(t>>>=i)?1:0)<<1)|(t>>>=i)>>1}var Dm=0;function Fm(){return++Dm}var Nm={};function Lm(t,e,i){if(void 0===i&&(i=3),!Nm[e]){var n=(new Error).stack;void 0===n?console.warn("PixiJS Deprecation Warning: ",e+"\nDeprecated since v"+t):(n=n.split("\n").splice(i).join("\n"),console.groupCollapsed?(console.groupCollapsed("%cPixiJS Deprecation Warning: %c%s","color:#614108;background:#fffbe6","font-weight:normal;color:#614108;background:#fffbe6",e+"\nDeprecated since v"+t),console.warn(n),console.groupEnd()):(console.warn("PixiJS Deprecation Warning: ",e+"\nDeprecated since v"+t),console.warn(n))),Nm[e]=!0}}var Um,zm={},Wm=Object.create(null),Gm=Object.create(null);function Hm(t,e){var i=Tt.RETINA_PREFIX.exec(t);return i?parseFloat(i[1]):void 0!==e?e:1}function Xm(t,e,i){this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"),this.resolution=i||Tt.RESOLUTION,this.resize(t,e)}Xm.prototype.clear=function(){this.context.setTransform(1,0,0,1,0,0),this.context.clearRect(0,0,this.canvas.width,this.canvas.height)},Xm.prototype.resize=function(t,e){this.canvas.width=Math.round(t*this.resolution),this.canvas.height=Math.round(e*this.resolution)},Xm.prototype.destroy=function(){this.context=null,this.canvas=null},Object.defineProperty(Xm.prototype,"width",{get:function(){return this.canvas.width},set:function(t){this.canvas.width=Math.round(t)},enumerable:!1,configurable:!0}),Object.defineProperty(Xm.prototype,"height",{get:function(){return this.canvas.height},set:function(t){this.canvas.height=Math.round(t)},enumerable:!1,configurable:!0});var jm,Vm,Ym=(qm.prototype.emit=function(t,e,i,n,r,s,o,a){if(8<arguments.length)throw new Error("max arguments reached");var l=this.name,h=this.items;this._aliasCount++;for(var u=0,c=h.length;u<c;u++)h[u][l](t,e,i,n,r,s,o,a);return h===this.items&&this._aliasCount--,this},qm.prototype.ensureNonAliasedItems=function(){0<this._aliasCount&&1<this.items.length&&(this._aliasCount=0,this.items=this.items.slice(0))},qm.prototype.add=function(t){return t[this._name]&&(this.ensureNonAliasedItems(),this.remove(t),this.items.push(t)),this},qm.prototype.remove=function(t){var e=this.items.indexOf(t);return-1!==e&&(this.ensureNonAliasedItems(),this.items.splice(e,1)),this},qm.prototype.contains=function(t){return-1!==this.items.indexOf(t)},qm.prototype.removeAll=function(){return this.ensureNonAliasedItems(),this.items.length=0,this},qm.prototype.destroy=function(){this.removeAll(),this.items=null,this._name=null},Object.defineProperty(qm.prototype,"empty",{get:function(){return 0===this.items.length},enumerable:!1,configurable:!0}),Object.defineProperty(qm.prototype,"name",{get:function(){return this._name},enumerable:!1,configurable:!0}),qm);function qm(t){this.items=[],this._name=t,this._aliasCount=0}Object.defineProperties(Ym.prototype,{dispatch:{value:Ym.prototype.emit},run:{value:Ym.prototype.emit}}),Tt.TARGET_FPMS=.06,(Vm=jm=jm||{})[Vm.INTERACTION=50]="INTERACTION",Vm[Vm.HIGH=25]="HIGH",Vm[Vm.NORMAL=0]="NORMAL",Vm[Vm.LOW=-25]="LOW",Vm[Vm.UTILITY=-50]="UTILITY";var Km,$m,Qm=(ey.prototype.match=function(t,e){return void 0===e&&(e=null),this.fn===t&&this.context===e},ey.prototype.emit=function(t){this.fn&&(this.context?this.fn.call(this.context,t):this.fn(t));var e=this.next;return this.once&&this.destroy(!0),this._destroyed&&(this.next=null),e},ey.prototype.connect=function(t){(this.previous=t).next&&(t.next.previous=this),this.next=t.next,t.next=this},ey.prototype.destroy=function(t){void 0===t&&(t=!1),this._destroyed=!0,this.fn=null,this.context=null,this.previous&&(this.previous.next=this.next),this.next&&(this.next.previous=this.previous);var e=this.next;return this.next=t?null:e,this.previous=null,e},ey),Jm=(ty.prototype._requestIfNeeded=function(){null===this._requestId&&this._head.next&&(this.lastTime=performance.now(),this._lastFrame=this.lastTime,this._requestId=requestAnimationFrame(this._tick))},ty.prototype._cancelIfNeeded=function(){null!==this._requestId&&(cancelAnimationFrame(this._requestId),this._requestId=null)},ty.prototype._startIfPossible=function(){this.started?this._requestIfNeeded():this.autoStart&&this.start()},ty.prototype.add=function(t,e,i){return void 0===i&&(i=jm.NORMAL),this._addListener(new Qm(t,e,i))},ty.prototype.addOnce=function(t,e,i){return void 0===i&&(i=jm.NORMAL),this._addListener(new Qm(t,e,i,!0))},ty.prototype._addListener=function(t){var e=this._head.next,i=this._head;if(e){for(;e;){if(t.priority>e.priority){t.connect(i);break}e=(i=e).next}t.previous||t.connect(i)}else t.connect(i);return this._startIfPossible(),this},ty.prototype.remove=function(t,e){for(var i=this._head.next;i;)i=i.match(t,e)?i.destroy():i.next;return this._head.next||this._cancelIfNeeded(),this},Object.defineProperty(ty.prototype,"count",{get:function(){if(!this._head)return 0;for(var t=0,e=this._head;e=e.next;)t++;return t},enumerable:!1,configurable:!0}),ty.prototype.start=function(){this.started||(this.started=!0,this._requestIfNeeded())},ty.prototype.stop=function(){this.started&&(this.started=!1,this._cancelIfNeeded())},ty.prototype.destroy=function(){if(!this._protected){this.stop();for(var t=this._head.next;t;)t=t.destroy(!0);this._head.destroy(),this._head=null}},ty.prototype.update=function(t){var e;if(void 0===t&&(t=performance.now()),t>this.lastTime){if((e=this.elapsedMS=t-this.lastTime)>this._maxElapsedMS&&(e=this._maxElapsedMS),e*=this.speed,this._minElapsedMS){var i=t-this._lastFrame|0;if(i<this._minElapsedMS)return;this._lastFrame=t-i%this._minElapsedMS}this.deltaMS=e,this.deltaTime=this.deltaMS*Tt.TARGET_FPMS;for(var n=this._head,r=n.next;r;)r=r.emit(this.deltaTime);n.next||this._cancelIfNeeded()}else this.deltaTime=this.deltaMS=this.elapsedMS=0;this.lastTime=t},Object.defineProperty(ty.prototype,"FPS",{get:function(){return 1e3/this.elapsedMS},enumerable:!1,configurable:!0}),Object.defineProperty(ty.prototype,"minFPS",{get:function(){return 1e3/this._maxElapsedMS},set:function(t){var e=Math.min(this.maxFPS,t),i=Math.min(Math.max(0,e)/1e3,Tt.TARGET_FPMS);this._maxElapsedMS=1/i},enumerable:!1,configurable:!0}),Object.defineProperty(ty.prototype,"maxFPS",{get:function(){return this._minElapsedMS?Math.round(1e3/this._minElapsedMS):0},set:function(t){if(0===t)this._minElapsedMS=0;else{var e=Math.max(this.minFPS,t);this._minElapsedMS=1/(e/1e3)}},enumerable:!1,configurable:!0}),Object.defineProperty(ty,"shared",{get:function(){if(!ty._shared){var t=ty._shared=new ty;t.autoStart=!0,t._protected=!0}return ty._shared},enumerable:!1,configurable:!0}),Object.defineProperty(ty,"system",{get:function(){if(!ty._system){var t=ty._system=new ty;t.autoStart=!0,t._protected=!0}return ty._system},enumerable:!1,configurable:!0}),ty),Zm=2*Math.PI;function ty(){var e=this;this.autoStart=!1,this.deltaTime=1,this.lastTime=-1,this.speed=1,this.started=!1,this._requestId=null,this._maxElapsedMS=100,this._minElapsedMS=0,this._protected=!1,this._lastFrame=-1,this._head=new Qm(null,null,1/0),this.deltaMS=1/Tt.TARGET_FPMS,this.elapsedMS=1/Tt.TARGET_FPMS,this._tick=function(t){e._requestId=null,e.started&&(e.update(t),e.started&&null===e._requestId&&e._head.next&&(e._requestId=requestAnimationFrame(e._tick)))}}function ey(t,e,i,n){void 0===e&&(e=null),void 0===i&&(i=0),void 0===n&&(n=!1),this.next=null,this.previous=null,this._destroyed=!1,this.fn=t,this.context=e,this.priority=i,this.once=n}($m=Km=Km||{})[$m.POLY=0]="POLY",$m[$m.RECT=1]="RECT",$m[$m.CIRC=2]="CIRC",$m[$m.ELIP=3]="ELIP",$m[$m.RREC=4]="RREC";var iy=(Object.defineProperty(my.prototype,"left",{get:function(){return this.x},enumerable:!1,configurable:!0}),Object.defineProperty(my.prototype,"right",{get:function(){return this.x+this.width},enumerable:!1,configurable:!0}),Object.defineProperty(my.prototype,"top",{get:function(){return this.y},enumerable:!1,configurable:!0}),Object.defineProperty(my.prototype,"bottom",{get:function(){return this.y+this.height},enumerable:!1,configurable:!0}),Object.defineProperty(my,"EMPTY",{get:function(){return new my(0,0,0,0)},enumerable:!1,configurable:!0}),my.prototype.clone=function(){return new my(this.x,this.y,this.width,this.height)},my.prototype.copyFrom=function(t){return this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height,this},my.prototype.copyTo=function(t){return t.x=this.x,t.y=this.y,t.width=this.width,t.height=this.height,t},my.prototype.contains=function(t,e){return!(this.width<=0||this.height<=0)&&t>=this.x&&t<this.x+this.width&&e>=this.y&&e<this.y+this.height},my.prototype.pad=function(t,e){return void 0===t&&(t=0),void 0===e&&(e=t),this.x-=t,this.y-=e,this.width+=2*t,this.height+=2*e,this},my.prototype.fit=function(t){var e=Math.max(this.x,t.x),i=Math.min(this.x+this.width,t.x+t.width),n=Math.max(this.y,t.y),r=Math.min(this.y+this.height,t.y+t.height);return this.x=e,this.width=Math.max(i-e,0),this.y=n,this.height=Math.max(r-n,0),this},my.prototype.ceil=function(t,e){void 0===t&&(t=1),void 0===e&&(e=.001);var i=Math.ceil((this.x+this.width-e)*t)/t,n=Math.ceil((this.y+this.height-e)*t)/t;return this.x=Math.floor((this.x+e)*t)/t,this.y=Math.floor((this.y+e)*t)/t,this.width=i-this.x,this.height=n-this.y,this},my.prototype.enlarge=function(t){var e=Math.min(this.x,t.x),i=Math.max(this.x+this.width,t.x+t.width),n=Math.min(this.y,t.y),r=Math.max(this.y+this.height,t.y+t.height);return this.x=e,this.width=i-e,this.y=n,this.height=r-n,this},my.prototype.toString=function(){return"[@pixi/math:Rectangle x="+this.x+" y="+this.y+" width="+this.width+" height="+this.height+"]"},my),ny=(gy.prototype.clone=function(){return new gy(this.x,this.y)},gy.prototype.copyFrom=function(t){return this.set(t.x,t.y),this},gy.prototype.copyTo=function(t){return t.set(this.x,this.y),t},gy.prototype.equals=function(t){return t.x===this.x&&t.y===this.y},gy.prototype.set=function(t,e){return void 0===t&&(t=0),void 0===e&&(e=t),this.x=t,this.y=e,this},gy.prototype.toString=function(){return"[@pixi/math:Point x="+this.x+" y="+this.y+"]"},gy),ry=(fy.prototype.clone=function(t,e){return void 0===t&&(t=this.cb),void 0===e&&(e=this.scope),new fy(t,e,this._x,this._y)},fy.prototype.set=function(t,e){return void 0===t&&(t=0),void 0===e&&(e=t),this._x===t&&this._y===e||(this._x=t,this._y=e,this.cb.call(this.scope)),this},fy.prototype.copyFrom=function(t){return this._x===t.x&&this._y===t.y||(this._x=t.x,this._y=t.y,this.cb.call(this.scope)),this},fy.prototype.copyTo=function(t){return t.set(this._x,this._y),t},fy.prototype.equals=function(t){return t.x===this._x&&t.y===this._y},fy.prototype.toString=function(){return"[@pixi/math:ObservablePoint x=0 y=0 scope="+this.scope+"]"},Object.defineProperty(fy.prototype,"x",{get:function(){return this._x},set:function(t){this._x!==t&&(this._x=t,this.cb.call(this.scope))},enumerable:!1,configurable:!0}),Object.defineProperty(fy.prototype,"y",{get:function(){return this._y},set:function(t){this._y!==t&&(this._y=t,this.cb.call(this.scope))},enumerable:!1,configurable:!0}),fy),sy=(py.prototype.fromArray=function(t){this.a=t[0],this.b=t[1],this.c=t[3],this.d=t[4],this.tx=t[2],this.ty=t[5]},py.prototype.set=function(t,e,i,n,r,s){return this.a=t,this.b=e,this.c=i,this.d=n,this.tx=r,this.ty=s,this},py.prototype.toArray=function(t,e){this.array||(this.array=new Float32Array(9));var i=e||this.array;return t?(i[0]=this.a,i[1]=this.b,i[2]=0,i[3]=this.c,i[4]=this.d,i[5]=0,i[6]=this.tx,i[7]=this.ty):(i[0]=this.a,i[1]=this.c,i[2]=this.tx,i[3]=this.b,i[4]=this.d,i[5]=this.ty,i[6]=0,i[7]=0),i[8]=1,i},py.prototype.apply=function(t,e){e=e||new ny;var i=t.x,n=t.y;return e.x=this.a*i+this.c*n+this.tx,e.y=this.b*i+this.d*n+this.ty,e},py.prototype.applyInverse=function(t,e){e=e||new ny;var i=1/(this.a*this.d+this.c*-this.b),n=t.x,r=t.y;return e.x=this.d*i*n+-this.c*i*r+(this.ty*this.c-this.tx*this.d)*i,e.y=this.a*i*r+-this.b*i*n+(-this.ty*this.a+this.tx*this.b)*i,e},py.prototype.translate=function(t,e){return this.tx+=t,this.ty+=e,this},py.prototype.scale=function(t,e){return this.a*=t,this.d*=e,this.c*=t,this.b*=e,this.tx*=t,this.ty*=e,this},py.prototype.rotate=function(t){var e=Math.cos(t),i=Math.sin(t),n=this.a,r=this.c,s=this.tx;return this.a=n*e-this.b*i,this.b=n*i+this.b*e,this.c=r*e-this.d*i,this.d=r*i+this.d*e,this.tx=s*e-this.ty*i,this.ty=s*i+this.ty*e,this},py.prototype.append=function(t){var e=this.a,i=this.b,n=this.c,r=this.d;return this.a=t.a*e+t.b*n,this.b=t.a*i+t.b*r,this.c=t.c*e+t.d*n,this.d=t.c*i+t.d*r,this.tx=t.tx*e+t.ty*n+this.tx,this.ty=t.tx*i+t.ty*r+this.ty,this},py.prototype.setTransform=function(t,e,i,n,r,s,o,a,l){return this.a=Math.cos(o+l)*r,this.b=Math.sin(o+l)*r,this.c=-Math.sin(o-a)*s,this.d=Math.cos(o-a)*s,this.tx=t-(i*this.a+n*this.c),this.ty=e-(i*this.b+n*this.d),this},py.prototype.prepend=function(t){var e=this.tx;if(1!==t.a||0!==t.b||0!==t.c||1!==t.d){var i=this.a,n=this.c;this.a=i*t.a+this.b*t.c,this.b=i*t.b+this.b*t.d,this.c=n*t.a+this.d*t.c,this.d=n*t.b+this.d*t.d}return this.tx=e*t.a+this.ty*t.c+t.tx,this.ty=e*t.b+this.ty*t.d+t.ty,this},py.prototype.decompose=function(t){var e=this.a,i=this.b,n=this.c,r=this.d,s=t.pivot,o=-Math.atan2(-n,r),a=Math.atan2(i,e),l=Math.abs(o+a);return l<1e-5||Math.abs(Zm-l)<1e-5?(t.rotation=a,t.skew.x=t.skew.y=0):(t.rotation=0,t.skew.x=o,t.skew.y=a),t.scale.x=Math.sqrt(e*e+i*i),t.scale.y=Math.sqrt(n*n+r*r),t.position.x=this.tx+(s.x*e+s.y*n),t.position.y=this.ty+(s.x*i+s.y*r),t},py.prototype.invert=function(){var t=this.a,e=this.b,i=this.c,n=this.d,r=this.tx,s=t*n-e*i;return this.a=n/s,this.b=-e/s,this.c=-i/s,this.d=t/s,this.tx=(i*this.ty-n*r)/s,this.ty=-(t*this.ty-e*r)/s,this},py.prototype.identity=function(){return this.a=1,this.b=0,this.c=0,this.d=1,this.tx=0,this.ty=0,this},py.prototype.clone=function(){var t=new py;return t.a=this.a,t.b=this.b,t.c=this.c,t.d=this.d,t.tx=this.tx,t.ty=this.ty,t},py.prototype.copyTo=function(t){return t.a=this.a,t.b=this.b,t.c=this.c,t.d=this.d,t.tx=this.tx,t.ty=this.ty,t},py.prototype.copyFrom=function(t){return this.a=t.a,this.b=t.b,this.c=t.c,this.d=t.d,this.tx=t.tx,this.ty=t.ty,this},py.prototype.toString=function(){return"[@pixi/math:Matrix a="+this.a+" b="+this.b+" c="+this.c+" d="+this.d+" tx="+this.tx+" ty="+this.ty+"]"},Object.defineProperty(py,"IDENTITY",{get:function(){return new py},enumerable:!1,configurable:!0}),Object.defineProperty(py,"TEMP_MATRIX",{get:function(){return new py},enumerable:!1,configurable:!0}),py),oy=[1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1,0,1],ay=[0,1,1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1],ly=[0,-1,-1,-1,0,1,1,1,0,1,1,1,0,-1,-1,-1],hy=[1,1,0,-1,-1,-1,0,1,-1,-1,0,1,1,1,0,-1],uy=[],cy=[],dy=Math.sign;function py(t,e,i,n,r,s){void 0===t&&(t=1),void 0===e&&(e=0),void 0===i&&(i=0),void 0===n&&(n=1),void 0===r&&(r=0),void 0===s&&(s=0),this.array=null,this.a=t,this.b=e,this.c=i,this.d=n,this.tx=r,this.ty=s}function fy(t,e,i,n){void 0===i&&(i=0),void 0===n&&(n=0),this._x=i,this._y=n,this.cb=t,this.scope=e}function gy(t,e){void 0===t&&(t=0),void 0===e&&(e=0),this.x=0,this.y=0,this.x=t,this.y=e}function my(t,e,i,n){void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),void 0===n&&(n=0),this.x=Number(t),this.y=Number(e),this.width=Number(i),this.height=Number(n),this.type=Km.RECT}!function(){for(var t=0;t<16;t++){var e=[];uy.push(e);for(var i=0;i<16;i++)for(var n=dy(oy[t]*oy[i]+ly[t]*ay[i]),r=dy(ay[t]*oy[i]+hy[t]*ay[i]),s=dy(oy[t]*ly[i]+ly[t]*hy[i]),o=dy(ay[t]*ly[i]+hy[t]*hy[i]),a=0;a<16;a++)if(oy[a]===n&&ay[a]===r&&ly[a]===s&&hy[a]===o){e.push(a);break}}for(t=0;t<16;t++){var l=new sy;l.set(oy[t],ay[t],ly[t],hy[t],0,0),cy.push(l)}}();var yy={E:0,SE:1,S:2,SW:3,W:4,NW:5,N:6,NE:7,MIRROR_VERTICAL:8,MAIN_DIAGONAL:10,MIRROR_HORIZONTAL:12,REVERSE_DIAGONAL:14,uX:function(t){return oy[t]},uY:function(t){return ay[t]},vX:function(t){return ly[t]},vY:function(t){return hy[t]},inv:function(t){return 8&t?15&t:7&-t},add:function(t,e){return uy[t][e]},sub:function(t,e){return uy[t][yy.inv(e)]},rotate180:function(t){return 4^t},isVertical:function(t){return 2==(3&t)},byDirection:function(t,e){return 2*Math.abs(t)<=Math.abs(e)?0<=e?yy.S:yy.N:2*Math.abs(e)<=Math.abs(t)?0<t?yy.E:yy.W:0<e?0<t?yy.SE:yy.SW:0<t?yy.NE:yy.NW},matrixAppendRotationInv:function(t,e,i,n){void 0===i&&(i=0),void 0===n&&(n=0);var r=cy[yy.inv(e)];r.tx=i,r.ty=n,t.append(r)}};function _y(){this.worldTransform=new sy,this.localTransform=new sy,this.position=new ry(this.onChange,this,0,0),this.scale=new ry(this.onChange,this,1,1),this.pivot=new ry(this.onChange,this,0,0),this.skew=new ry(this.updateSkew,this,0,0),this._rotation=0,this._cx=1,this._sx=0,this._cy=0,this._sy=1,this._localID=0,this._currentLocalID=0,this._worldID=0,this._parentID=0}_y.prototype.onChange=function(){this._localID++},_y.prototype.updateSkew=function(){this._cx=Math.cos(this._rotation+this.skew.y),this._sx=Math.sin(this._rotation+this.skew.y),this._cy=-Math.sin(this._rotation-this.skew.x),this._sy=Math.cos(this._rotation-this.skew.x),this._localID++},_y.prototype.toString=function(){return"[@pixi/math:Transform position=("+this.position.x+", "+this.position.y+") rotation="+this.rotation+" scale=("+this.scale.x+", "+this.scale.y+") skew=("+this.skew.x+", "+this.skew.y+") ]"},_y.prototype.updateLocalTransform=function(){var t=this.localTransform;this._localID!==this._currentLocalID&&(t.a=this._cx*this.scale.x,t.b=this._sx*this.scale.x,t.c=this._cy*this.scale.y,t.d=this._sy*this.scale.y,t.tx=this.position.x-(this.pivot.x*t.a+this.pivot.y*t.c),t.ty=this.position.y-(this.pivot.x*t.b+this.pivot.y*t.d),this._currentLocalID=this._localID,this._parentID=-1)},_y.prototype.updateTransform=function(t){var e=this.localTransform;if(this._localID!==this._currentLocalID&&(e.a=this._cx*this.scale.x,e.b=this._sx*this.scale.x,e.c=this._cy*this.scale.y,e.d=this._sy*this.scale.y,e.tx=this.position.x-(this.pivot.x*e.a+this.pivot.y*e.c),e.ty=this.position.y-(this.pivot.x*e.b+this.pivot.y*e.d),this._currentLocalID=this._localID,this._parentID=-1),this._parentID!==t._worldID){var i=t.worldTransform,n=this.worldTransform;n.a=e.a*i.a+e.b*i.c,n.b=e.a*i.b+e.b*i.d,n.c=e.c*i.a+e.d*i.c,n.d=e.c*i.b+e.d*i.d,n.tx=e.tx*i.a+e.ty*i.c+i.tx,n.ty=e.tx*i.b+e.ty*i.d+i.ty,this._parentID=t._worldID,this._worldID++}},_y.prototype.setFromMatrix=function(t){t.decompose(this),this._localID++},Object.defineProperty(_y.prototype,"rotation",{get:function(){return this._rotation},set:function(t){this._rotation!==t&&(this._rotation=t,this.updateSkew())},enumerable:!1,configurable:!0}),_y.IDENTITY=new _y,Tt.PREFER_ENV=wt.any?nt.ENV.WEBGL:nt.ENV.WEBGL2,Tt.STRICT_TEXTURE_CACHE=!1;var vy=[];function by(t,e){if(!t)return null;var i="";if("string"==typeof t){var n=/\.(\w{3,4})(?:$|\?|#)/i.exec(t);n&&(i=n[1].toLowerCase())}for(var r=vy.length-1;0<=r;--r){var s=vy[r];if(s.test&&s.test(t,i))return new s(t,e)}throw new Error("Unrecognized source type to auto-detect Resource")}var wy=function(t,e){return(wy=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)};function Sy(t,e){function i(){this.constructor=t}wy(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}var xy,Ty,Iy,Py,Cy,Ey,Ay,My,By,Ry,Oy,ky=function(){return(ky=Object.assign||function(t){for(var e,i=arguments,n=1,r=arguments.length;n<r;n++)for(var s in e=i[n])Object.prototype.hasOwnProperty.call(e,s)&&(t[s]=e[s]);return t}).apply(this,arguments)},Dy=(s_.prototype.bind=function(t){this.onResize.add(t),this.onUpdate.add(t),this.onError.add(t),(this._width||this._height)&&this.onResize.emit(this._width,this._height)},s_.prototype.unbind=function(t){this.onResize.remove(t),this.onUpdate.remove(t),this.onError.remove(t)},s_.prototype.resize=function(t,e){t===this._width&&e===this._height||(this._width=t,this._height=e,this.onResize.emit(t,e))},Object.defineProperty(s_.prototype,"valid",{get:function(){return!!this._width&&!!this._height},enumerable:!1,configurable:!0}),s_.prototype.update=function(){this.destroyed||this.onUpdate.emit()},s_.prototype.load=function(){return Promise.resolve(this)},Object.defineProperty(s_.prototype,"width",{get:function(){return this._width},enumerable:!1,configurable:!0}),Object.defineProperty(s_.prototype,"height",{get:function(){return this._height},enumerable:!1,configurable:!0}),s_.prototype.style=function(t,e,i){return!1},s_.prototype.dispose=function(){},s_.prototype.destroy=function(){this.destroyed||(this.destroyed=!0,this.dispose(),this.onError.removeAll(),this.onError=null,this.onResize.removeAll(),this.onResize=null,this.onUpdate.removeAll(),this.onUpdate=null)},s_.test=function(t,e){return!1},s_),Fy=(Sy(r_,Oy=Dy),r_.prototype.upload=function(t,e,i){var n=t.gl;n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e.alphaMode===nt.ALPHA_MODES.UNPACK);var r=e.realWidth,s=e.realHeight;return i.width===r&&i.height===s?n.texSubImage2D(e.target,0,0,0,r,s,e.format,i.type,this.data):(i.width=r,i.height=s,n.texImage2D(e.target,0,i.internalFormat,r,s,0,e.format,i.type,this.data)),!0},r_.prototype.dispose=function(){this.data=null},r_.test=function(t){return t instanceof Float32Array||t instanceof Uint8Array||t instanceof Uint32Array},r_),Ny={scaleMode:nt.SCALE_MODES.NEAREST,format:nt.FORMATS.RGBA,alphaMode:nt.ALPHA_MODES.NPM},Ly=(Sy(n_,Ry=im),Object.defineProperty(n_.prototype,"realWidth",{get:function(){return Math.round(this.width*this.resolution)},enumerable:!1,configurable:!0}),Object.defineProperty(n_.prototype,"realHeight",{get:function(){return Math.round(this.height*this.resolution)},enumerable:!1,configurable:!0}),Object.defineProperty(n_.prototype,"mipmap",{get:function(){return this._mipmap},set:function(t){this._mipmap!==t&&(this._mipmap=t,this.dirtyStyleId++)},enumerable:!1,configurable:!0}),Object.defineProperty(n_.prototype,"scaleMode",{get:function(){return this._scaleMode},set:function(t){this._scaleMode!==t&&(this._scaleMode=t,this.dirtyStyleId++)},enumerable:!1,configurable:!0}),Object.defineProperty(n_.prototype,"wrapMode",{get:function(){return this._wrapMode},set:function(t){this._wrapMode!==t&&(this._wrapMode=t,this.dirtyStyleId++)},enumerable:!1,configurable:!0}),n_.prototype.setStyle=function(t,e){var i;return void 0!==t&&t!==this.scaleMode&&(this.scaleMode=t,i=!0),void 0!==e&&e!==this.mipmap&&(this.mipmap=e,i=!0),i&&this.dirtyStyleId++,this},n_.prototype.setSize=function(t,e,i){return i=i||this.resolution,this.setRealSize(t*i,e*i,i)},n_.prototype.setRealSize=function(t,e,i){return this.resolution=i||this.resolution,this.width=Math.round(t)/this.resolution,this.height=Math.round(e)/this.resolution,this._refreshPOT(),this.update(),this},n_.prototype._refreshPOT=function(){this.isPowerOfTwo=Om(this.realWidth)&&Om(this.realHeight)},n_.prototype.setResolution=function(t){var e=this.resolution;return e===t||(this.resolution=t,this.valid&&(this.width=Math.round(this.width*e)/t,this.height=Math.round(this.height*e)/t,this.emit("update",this)),this._refreshPOT()),this},n_.prototype.setResource=function(t){if(this.resource===t)return this;if(this.resource)throw new Error("Resource can be set only once");return t.bind(this),this.resource=t,this},n_.prototype.update=function(){this.valid?(this.dirtyId++,this.dirtyStyleId++,this.emit("update",this)):0<this.width&&0<this.height&&(this.valid=!0,this.emit("loaded",this),this.emit("update",this))},n_.prototype.onError=function(t){this.emit("error",this,t)},n_.prototype.destroy=function(){this.resource&&(this.resource.unbind(this),this.resource.internal&&this.resource.destroy(),this.resource=null),this.cacheId&&(delete Gm[this.cacheId],delete Wm[this.cacheId],this.cacheId=null),this.dispose(),n_.removeFromCache(this),this.textureCacheIds=null,this.destroyed=!0},n_.prototype.dispose=function(){this.emit("dispose",this)},n_.prototype.castToBaseTexture=function(){return this},n_.from=function(t,e,i){void 0===i&&(i=Tt.STRICT_TEXTURE_CACHE);var n="string"==typeof t,r=null;if(n)r=t;else{if(!t._pixiId){var s=e&&e.pixiIdPrefix||"pixiid";t._pixiId=s+"_"+Fm()}r=t._pixiId}var o=Gm[r];if(n&&i&&!o)throw new Error('The cacheId "'+r+'" does not exist in BaseTextureCache.');return o||((o=new n_(t,e)).cacheId=r,n_.addToCache(o,r)),o},n_.fromBuffer=function(t,e,i,n){t=t||new Float32Array(e*i*4);var r=new Fy(t,{width:e,height:i}),s=t instanceof Float32Array?nt.TYPES.FLOAT:nt.TYPES.UNSIGNED_BYTE;return new n_(r,Object.assign(Ny,n||{width:e,height:i,type:s}))},n_.addToCache=function(t,e){e&&(-1===t.textureCacheIds.indexOf(e)&&t.textureCacheIds.push(e),Gm[e]&&console.warn("BaseTexture added to the cache with an id ["+e+"] that already had an entry"),Gm[e]=t)},n_.removeFromCache=function(t){if("string"==typeof t){var e=Gm[t];if(e){var i=e.textureCacheIds.indexOf(t);return-1<i&&e.textureCacheIds.splice(i,1),delete Gm[t],e}}else if(t&&t.textureCacheIds){for(var n=0;n<t.textureCacheIds.length;++n)delete Gm[t.textureCacheIds[n]];return t.textureCacheIds.length=0,t}return null},n_._globalBatch=0,n_),Uy=(Sy(i_,By=Dy),i_.prototype.initFromArray=function(t,e){for(var i=0;i<this.length;i++)t[i]&&(t[i].castToBaseTexture?this.addBaseTextureAt(t[i].castToBaseTexture(),i):t[i]instanceof Dy?this.addResourceAt(t[i],i):this.addResourceAt(by(t[i],e),i))},i_.prototype.dispose=function(){for(var t=0,e=this.length;t<e;t++)this.items[t].destroy();this.items=null,this.itemDirtyIds=null,this._load=null},i_.prototype.addResourceAt=function(t,e){if(!this.items[e])throw new Error("Index "+e+" is out of bounds");return t.valid&&!this.valid&&this.resize(t.width,t.height),this.items[e].setResource(t),this},i_.prototype.bind=function(t){if(null!==this.baseTexture)throw new Error("Only one base texture per TextureArray is allowed");By.prototype.bind.call(this,t);for(var e=0;e<this.length;e++)this.items[e].parentTextureArray=t,this.items[e].on("update",t.update,t)},i_.prototype.unbind=function(t){By.prototype.unbind.call(this,t);for(var e=0;e<this.length;e++)this.items[e].parentTextureArray=null,this.items[e].off("update",t.update,t)},i_.prototype.load=function(){var n=this;if(this._load)return this._load;var t=this.items.map(function(t){return t.resource}).filter(function(t){return t}).map(function(t){return t.load()});return this._load=Promise.all(t).then(function(){var t=n.items[0],e=t.realWidth,i=t.realHeight;return n.resize(e,i),Promise.resolve(n)}),this._load},i_),zy=(Sy(e_,My=Uy),e_.prototype.addBaseTextureAt=function(t,e){if(!t.resource)throw new Error("ArrayResource does not support RenderTexture");return this.addResourceAt(t.resource,e),this},e_.prototype.bind=function(t){My.prototype.bind.call(this,t),t.target=nt.TARGETS.TEXTURE_2D_ARRAY},e_.prototype.upload=function(t,e,i){var n=this.length,r=this.itemDirtyIds,s=this.items,o=t.gl;i.dirtyId<0&&o.texImage3D(o.TEXTURE_2D_ARRAY,0,i.internalFormat,this._width,this._height,n,0,e.format,i.type,null);for(var a=0;a<n;a++){var l=s[a];r[a]<l.dirtyId&&(r[a]=l.dirtyId,l.valid&&o.texSubImage3D(o.TEXTURE_2D_ARRAY,0,0,0,a,l.resource.width,l.resource.height,1,e.format,i.type,l.resource.source))}return!0},e_),Wy=(Sy(t_,Ay=Dy),t_.crossOrigin=function(t,e,i){void 0===i&&0!==e.indexOf("data:")?t.crossOrigin=function(t,e){if(void 0===e&&(e=self.location),0===t.indexOf("data:"))return"";e=e||self.location,(Um=Um||document.createElement("a")).href=t;var i=Cm.parse(Um.href),n=!i.port&&""===e.port||i.port===e.port;return i.hostname===e.hostname&&n&&i.protocol===e.protocol?"":"anonymous"}(e):!1!==i&&(t.crossOrigin="string"==typeof i?i:"anonymous")},t_.prototype.upload=function(t,e,i,n){var r=t.gl,s=e.realWidth,o=e.realHeight;return n=n||this.source,r.pixelStorei(r.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e.alphaMode===nt.ALPHA_MODES.UNPACK),this.noSubImage||e.target!==r.TEXTURE_2D||i.width!==s||i.height!==o?(i.width=s,i.height=o,r.texImage2D(e.target,0,i.internalFormat,e.format,i.type,n)):r.texSubImage2D(r.TEXTURE_2D,0,0,0,e.format,i.type,n),!0},t_.prototype.update=function(){if(!this.destroyed){var t=this.source,e=t.naturalWidth||t.videoWidth||t.width,i=t.naturalHeight||t.videoHeight||t.height;this.resize(e,i),Ay.prototype.update.call(this)}},t_.prototype.dispose=function(){this.source=null},t_),Gy=(Sy(Zy,Ey=Wy),Zy.test=function(t){var e=self.OffscreenCanvas;return!!(e&&t instanceof e)||self.HTMLCanvasElement&&t instanceof HTMLCanvasElement},Zy),Hy=(Sy(Jy,Cy=Uy),Jy.prototype.bind=function(t){Cy.prototype.bind.call(this,t),t.target=nt.TARGETS.TEXTURE_CUBE_MAP},Jy.prototype.addBaseTextureAt=function(t,e,i){if(void 0===i&&(i=this.linkBaseTexture),!this.items[e])throw new Error("Index "+e+" is out of bounds");if(!this.linkBaseTexture||t.parentTextureArray||0<Object.keys(t._glTextures).length){if(!t.resource)throw new Error("CubeResource does not support copying of renderTexture.");this.addResourceAt(t.resource,e)}else t.target=nt.TARGETS.TEXTURE_CUBE_MAP_POSITIVE_X+e,t.parentTextureArray=this.baseTexture,this.items[e]=t;return t.valid&&!this.valid&&this.resize(t.realWidth,t.realHeight),this.items[e]=t,this},Jy.prototype.upload=function(t,e,i){for(var n=this.itemDirtyIds,r=0;r<Jy.SIDES;r++){var s=this.items[r];n[r]<s.dirtyId&&(s.valid&&s.resource?(s.resource.upload(t,s,i),n[r]=s.dirtyId):n[r]<-1&&(t.gl.texImage2D(s.target,0,i.internalFormat,e.realWidth,e.realHeight,0,e.format,i.type,null),n[r]=-1))}return!0},Jy.test=function(t){return Array.isArray(t)&&t.length===Jy.SIDES},Jy.SIDES=6,Jy),Xy=(Sy(Qy,Py=Wy),Qy.prototype.load=function(t){var r=this;return this._load||(void 0!==t&&(this.createBitmap=t),this._load=new Promise(function(t,e){var i=r.source;function n(){r.destroyed||(i.onload=null,i.onerror=null,r.resize(i.width,i.height),r._load=null,r.createBitmap?t(r.process()):t(r))}r.url=i.src,i.complete&&i.src?n():(i.onload=n,i.onerror=function(t){e(t),r.onError.emit(t)})})),this._load},Qy.prototype.process=function(){var e=this,i=this.source;if(null!==this._process)return this._process;if(null!==this.bitmap||!self.createImageBitmap)return Promise.resolve(this);var n=self.createImageBitmap,t=!i.crossOrigin||"anonymous"===i.crossOrigin;return this._process=fetch(i.src,{mode:t?"cors":"no-cors"}).then(function(t){return t.blob()}).then(function(t){return n(t,0,0,i.width,i.height,{premultiplyAlpha:e.alphaMode===nt.ALPHA_MODES.UNPACK?"premultiply":"none"})}).then(function(t){return e.destroyed?Promise.reject():(e.bitmap=t,e.update(),e._process=null,Promise.resolve(e))}),this._process},Qy.prototype.upload=function(t,e,i){if("number"==typeof this.alphaMode&&(e.alphaMode=this.alphaMode),!this.createBitmap)return Py.prototype.upload.call(this,t,e,i);if(!this.bitmap&&(this.process(),!this.bitmap))return!1;if(Py.prototype.upload.call(this,t,e,i,this.bitmap),!this.preserveBitmap){var n=!0,r=e._glTextures;for(var s in r){var o=r[s];if(o!==i&&o.dirtyId!==e.dirtyId){n=!1;break}}n&&(this.bitmap.close&&this.bitmap.close(),this.bitmap=null)}return!0},Qy.prototype.dispose=function(){this.source.onload=null,this.source.onerror=null,Py.prototype.dispose.call(this),this.bitmap&&(this.bitmap.close(),this.bitmap=null),this._process=null,this._load=null},Qy.test=function(t){return"string"==typeof t||t instanceof HTMLImageElement},Qy),jy=(Sy($y,Iy=Wy),$y.prototype.load=function(){var e=this;return this._load||(this._load=new Promise(function(t){if(e._resolve=function(){e.resize(e.source.width,e.source.height),t(e)},$y.SVG_XML.test(e.svg.trim())){if(!btoa)throw new Error("Your browser doesn't support base64 conversions.");e.svg="data:image/svg+xml;base64,"+btoa(unescape(encodeURIComponent(e.svg)))}e._loadSvg()})),this._load},$y.prototype._loadSvg=function(){var s=this,o=new Image;Wy.crossOrigin(o,this.svg,this._crossorigin),o.src=this.svg,o.onerror=function(t){s._resolve&&(o.onerror=null,s.onError.emit(t))},o.onload=function(){if(s._resolve){var t=o.width,e=o.height;if(!t||!e)throw new Error("The SVG image must have width and height defined (in pixels), canvas API needs them.");var i=t*s.scale,n=e*s.scale;(s._overrideWidth||s._overrideHeight)&&(i=s._overrideWidth||s._overrideHeight/e*t,n=s._overrideHeight||s._overrideWidth/t*e),i=Math.round(i),n=Math.round(n);var r=s.source;r.width=i,r.height=n,r._pixiId="canvas_"+Fm(),r.getContext("2d").drawImage(o,0,0,t,e,0,0,i,n),s._resolve(),s._resolve=null}}},$y.getSize=function(t){var e=$y.SVG_SIZE.exec(t),i={};return e&&(i[e[1]]=Math.round(parseFloat(e[3])),i[e[5]]=Math.round(parseFloat(e[7]))),i},$y.prototype.dispose=function(){Iy.prototype.dispose.call(this),this._resolve=null,this._crossorigin=null},$y.test=function(t,e){return"svg"===e||"string"==typeof t&&/^data:image\/svg\+xml(;(charset=utf8|utf8))?;base64/.test(t)||"string"==typeof t&&$y.SVG_XML.test(t)},$y.SVG_XML=/^(<\?xml[^?]+\?>)?\s*(<!--[^(-->)]*-->)?\s*\<svg/m,$y.SVG_SIZE=/<svg[^>]*(?:\s(width|height)=('|")(\d*(?:\.\d+)?)(?:px)?('|"))[^>]*(?:\s(width|height)=('|")(\d*(?:\.\d+)?)(?:px)?('|"))[^>]*>/i,$y),Vy=(Sy(Ky,Ty=Wy),Ky.prototype.update=function(t){if(!this.destroyed){var e=Jm.shared.elapsedMS*this.source.playbackRate;this._msToNextUpdate=Math.floor(this._msToNextUpdate-e),(!this._updateFPS||this._msToNextUpdate<=0)&&(Ty.prototype.update.call(this),this._msToNextUpdate=this._updateFPS?Math.floor(1e3/this._updateFPS):0)}},Ky.prototype.load=function(){var e=this;if(this._load)return this._load;var i=this.source;return(i.readyState===i.HAVE_ENOUGH_DATA||i.readyState===i.HAVE_FUTURE_DATA)&&i.width&&i.height&&(i.complete=!0),i.addEventListener("play",this._onPlayStart.bind(this)),i.addEventListener("pause",this._onPlayStop.bind(this)),this._isSourceReady()?this._onCanPlay():(i.addEventListener("canplay",this._onCanPlay),i.addEventListener("canplaythrough",this._onCanPlay),i.addEventListener("error",this._onError,!0)),this._load=new Promise(function(t){e.valid?t(e):(e._resolve=t,i.load())}),this._load},Ky.prototype._onError=function(t){this.source.removeEventListener("error",this._onError,!0),this.onError.emit(t)},Ky.prototype._isSourcePlaying=function(){var t=this.source;return 0<t.currentTime&&!1===t.paused&&!1===t.ended&&2<t.readyState},Ky.prototype._isSourceReady=function(){var t=this.source;return 3===t.readyState||4===t.readyState},Ky.prototype._onPlayStart=function(){this.valid||this._onCanPlay(),this.autoUpdate&&!this._isConnectedToTicker&&(Jm.shared.add(this.update,this),this._isConnectedToTicker=!0)},Ky.prototype._onPlayStop=function(){this._isConnectedToTicker&&(Jm.shared.remove(this.update,this),this._isConnectedToTicker=!1)},Ky.prototype._onCanPlay=function(){var t=this.source;t.removeEventListener("canplay",this._onCanPlay),t.removeEventListener("canplaythrough",this._onCanPlay);var e=this.valid;this.resize(t.videoWidth,t.videoHeight),!e&&this._resolve&&(this._resolve(this),this._resolve=null),this._isSourcePlaying()?this._onPlayStart():this.autoPlay&&t.play()},Ky.prototype.dispose=function(){this._isConnectedToTicker&&(Jm.shared.remove(this.update,this),this._isConnectedToTicker=!1);var t=this.source;t&&(t.removeEventListener("error",this._onError,!0),t.pause(),t.src="",t.load()),Ty.prototype.dispose.call(this)},Object.defineProperty(Ky.prototype,"autoUpdate",{get:function(){return this._autoUpdate},set:function(t){t!==this._autoUpdate&&(this._autoUpdate=t,!this._autoUpdate&&this._isConnectedToTicker?(Jm.shared.remove(this.update,this),this._isConnectedToTicker=!1):this._autoUpdate&&!this._isConnectedToTicker&&this._isSourcePlaying()&&(Jm.shared.add(this.update,this),this._isConnectedToTicker=!0))},enumerable:!1,configurable:!0}),Object.defineProperty(Ky.prototype,"updateFPS",{get:function(){return this._updateFPS},set:function(t){t!==this._updateFPS&&(this._updateFPS=t)},enumerable:!1,configurable:!0}),Ky.test=function(t,e){return self.HTMLVideoElement&&t instanceof HTMLVideoElement||-1<Ky.TYPES.indexOf(e)},Ky.TYPES=["mp4","m4v","webm","ogg","ogv","h264","avi","mov"],Ky.MIME_TYPES={ogv:"video/ogg",mov:"video/quicktime",m4v:"video/mp4"},Ky),Yy=(Sy(qy,xy=Wy),qy.test=function(t){return!!self.createImageBitmap&&t instanceof ImageBitmap},qy);function qy(t){return xy.call(this,t)||this}function Ky(t,e){var i=this;if(e=e||{},!(t instanceof HTMLVideoElement)){var n=document.createElement("video");n.setAttribute("preload","auto"),n.setAttribute("webkit-playsinline",""),n.setAttribute("playsinline",""),"string"==typeof t&&(t=[t]);var r=t[0].src||t[0];Wy.crossOrigin(n,r,e.crossorigin);for(var s=0;s<t.length;++s){var o=document.createElement("source"),a=t[s],l=a.src,h=a.mime,u=(l=l||t[s]).split("?").shift().toLowerCase(),c=u.substr(u.lastIndexOf(".")+1);h=h||Ky.MIME_TYPES[c]||"video/"+c,o.src=l,o.type=h,n.appendChild(o)}t=n}return(i=Ty.call(this,t)||this).noSubImage=!0,i._autoUpdate=!0,i._isConnectedToTicker=!1,i._updateFPS=e.updateFPS||0,i._msToNextUpdate=0,i.autoPlay=!1!==e.autoPlay,i._load=null,i._resolve=null,i._onCanPlay=i._onCanPlay.bind(i),i._onError=i._onError.bind(i),!1!==e.autoLoad&&i.load(),i}function $y(t,e){var i=this;return e=e||{},(i=Iy.call(this,document.createElement("canvas"))||this)._width=0,i._height=0,i.svg=t,i.scale=e.scale||1,i._overrideWidth=e.width,i._overrideHeight=e.height,i._resolve=null,i._crossorigin=e.crossorigin,i._load=null,!1!==e.autoLoad&&i.load(),i}function Qy(t,e){var i=this;if(e=e||{},!(t instanceof HTMLImageElement)){var n=new Image;Wy.crossOrigin(n,t,e.crossorigin),n.src=t,t=n}return i=Py.call(this,t)||this,!t.complete&&i._width&&i._height&&(i._width=0,i._height=0),i.url=t.src,i._process=null,i.preserveBitmap=!1,i.createBitmap=(void 0!==e.createBitmap?e.createBitmap:Tt.CREATE_IMAGE_BITMAP)&&!!self.createImageBitmap,i.alphaMode="number"==typeof e.alphaMode?e.alphaMode:null,i.bitmap=null,i._load=null,!1!==e.autoLoad&&i.load(),i}function Jy(t,e){var i=this,n=e||{},r=n.width,s=n.height,o=n.autoLoad,a=n.linkBaseTexture;if(t&&t.length!==Jy.SIDES)throw new Error("Invalid length. Got "+t.length+", expected 6");i=Cy.call(this,6,{width:r,height:s})||this;for(var l=0;l<Jy.SIDES;l++)i.items[l].target=nt.TARGETS.TEXTURE_CUBE_MAP_POSITIVE_X+l;return i.linkBaseTexture=!1!==a,t&&i.initFromArray(t,e),!1!==o&&i.load(),i}function Zy(t){return Ey.call(this,t)||this}function t_(t){var e=this,i=t,n=i.naturalWidth||i.videoWidth||i.width,r=i.naturalHeight||i.videoHeight||i.height;return(e=Ay.call(this,n,r)||this).source=t,e.noSubImage=!1,e}function e_(t,e){var i,n,r=this,s=e||{},o=s.width,a=s.height;return n=Array.isArray(t)?(i=t).length:t,r=My.call(this,n,{width:o,height:a})||this,i&&r.initFromArray(i,e),r}function i_(t,e){var i=this,n=e||{},r=n.width,s=n.height;(i=By.call(this,r,s)||this).items=[],i.itemDirtyIds=[];for(var o=0;o<t;o++){var a=new Ly;i.items.push(a),i.itemDirtyIds.push(-2)}return i.length=t,i._load=null,i.baseTexture=null,i}function n_(t,e){void 0===t&&(t=null),void 0===e&&(e=null);var i=Ry.call(this)||this,n=(e=e||{}).alphaMode,r=e.mipmap,s=e.anisotropicLevel,o=e.scaleMode,a=e.width,l=e.height,h=e.wrapMode,u=e.format,c=e.type,d=e.target,p=e.resolution,f=e.resourceOptions;return!t||t instanceof Dy||((t=by(t,f)).internal=!0),i.resolution=p||Tt.RESOLUTION,i.width=Math.round((a||0)*i.resolution)/i.resolution,i.height=Math.round((l||0)*i.resolution)/i.resolution,i._mipmap=void 0!==r?r:Tt.MIPMAP_TEXTURES,i.anisotropicLevel=void 0!==s?s:Tt.ANISOTROPIC_LEVEL,i._wrapMode=h||Tt.WRAP_MODE,i._scaleMode=void 0!==o?o:Tt.SCALE_MODE,i.format=u||nt.FORMATS.RGBA,i.type=c||nt.TYPES.UNSIGNED_BYTE,i.target=d||nt.TARGETS.TEXTURE_2D,i.alphaMode=void 0!==n?n:nt.ALPHA_MODES.UNPACK,i.uid=Fm(),i.touched=0,i.isPowerOfTwo=!1,i._refreshPOT(),i._glTextures={},i.dirtyId=0,i.dirtyStyleId=0,i.cacheId=null,i.valid=0<a&&0<l,i.textureCacheIds=[],i.destroyed=!1,i.resource=null,i._batchEnabled=0,i._batchLocation=0,i.parentTextureArray=null,i.setResource(t),i}function r_(t,e){var i=this,n=e||{},r=n.width,s=n.height;if(!r||!s)throw new Error("BufferResource width or height invalid");return(i=Oy.call(this,r,s)||this).data=t,i}function s_(t,e){void 0===t&&(t=0),void 0===e&&(e=0),this._width=t,this._height=e,this.destroyed=!1,this.internal=!1,this.onResize=new Ym("setRealSize"),this.onUpdate=new Ym("update"),this.onError=new Ym("onError")}vy.push(Xy,Yy,Gy,Vy,jy,Fy,Hy,zy);var o_,a_,l_,h_={__proto__:null,Resource:Dy,BaseImageResource:Wy,INSTALLED:vy,autoDetectResource:by,AbstractMultiResource:Uy,ArrayResource:zy,BufferResource:Fy,CanvasResource:Gy,CubeResource:Hy,ImageResource:Xy,SVGResource:jy,VideoResource:Vy,ImageBitmapResource:Yy},u_=(Sy(b_,l_=Fy),b_.prototype.upload=function(t,e,i){var n=t.gl;n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e.alphaMode===nt.ALPHA_MODES.UNPACK);var r=e.realWidth,s=e.realHeight;return i.width===r&&i.height===s?n.texSubImage2D(e.target,0,0,0,r,s,e.format,i.type,this.data):(i.width=r,i.height=s,n.texImage2D(e.target,0,i.internalFormat,r,s,0,e.format,i.type,this.data)),!0},b_),c_=(Object.defineProperty(v_.prototype,"colorTexture",{get:function(){return this.colorTextures[0]},enumerable:!1,configurable:!0}),v_.prototype.addColorTexture=function(t,e){return void 0===t&&(t=0),this.colorTextures[t]=e||new Ly(null,{scaleMode:nt.SCALE_MODES.NEAREST,resolution:1,mipmap:nt.MIPMAP_MODES.OFF,width:this.width,height:this.height}),this.dirtyId++,this.dirtyFormat++,this},v_.prototype.addDepthTexture=function(t){return this.depthTexture=t||new Ly(new u_(null,{width:this.width,height:this.height}),{scaleMode:nt.SCALE_MODES.NEAREST,resolution:1,width:this.width,height:this.height,mipmap:nt.MIPMAP_MODES.OFF,format:nt.FORMATS.DEPTH_COMPONENT,type:nt.TYPES.UNSIGNED_SHORT}),this.dirtyId++,this.dirtyFormat++,this},v_.prototype.enableDepth=function(){return this.depth=!0,this.dirtyId++,this.dirtyFormat++,this},v_.prototype.enableStencil=function(){return this.stencil=!0,this.dirtyId++,this.dirtyFormat++,this},v_.prototype.resize=function(t,e){if(t=Math.round(t),e=Math.round(e),t!==this.width||e!==this.height){this.width=t,this.height=e,this.dirtyId++,this.dirtySize++;for(var i=0;i<this.colorTextures.length;i++){var n=this.colorTextures[i],r=n.resolution;n.setSize(t/r,e/r)}this.depthTexture&&(r=this.depthTexture.resolution,this.depthTexture.setSize(t/r,e/r))}},v_.prototype.dispose=function(){this.disposeRunner.emit(this,!1)},v_.prototype.destroyDepthTexture=function(){this.depthTexture&&(this.depthTexture.destroy(),this.depthTexture=null,++this.dirtyId,++this.dirtyFormat)},v_),d_=(Sy(__,a_=Ly),__.prototype.resize=function(t,e){this.framebuffer.resize(t*this.resolution,e*this.resolution),this.setRealSize(this.framebuffer.width,this.framebuffer.height)},__.prototype.dispose=function(){this.framebuffer.dispose(),a_.prototype.dispose.call(this)},__.prototype.destroy=function(){a_.prototype.destroy.call(this),this.framebuffer.destroyDepthTexture(),this.framebuffer=null},__),p_=(y_.prototype.set=function(t,e,i){var n=e.width,r=e.height;if(i){var s=t.width/2/n,o=t.height/2/r,a=t.x/n+s,l=t.y/r+o;i=yy.add(i,yy.NW),this.x0=a+s*yy.uX(i),this.y0=l+o*yy.uY(i),i=yy.add(i,2),this.x1=a+s*yy.uX(i),this.y1=l+o*yy.uY(i),i=yy.add(i,2),this.x2=a+s*yy.uX(i),this.y2=l+o*yy.uY(i),i=yy.add(i,2),this.x3=a+s*yy.uX(i),this.y3=l+o*yy.uY(i)}else this.x0=t.x/n,this.y0=t.y/r,this.x1=(t.x+t.width)/n,this.y1=t.y/r,this.x2=(t.x+t.width)/n,this.y2=(t.y+t.height)/r,this.x3=t.x/n,this.y3=(t.y+t.height)/r;this.uvsFloat32[0]=this.x0,this.uvsFloat32[1]=this.y0,this.uvsFloat32[2]=this.x1,this.uvsFloat32[3]=this.y1,this.uvsFloat32[4]=this.x2,this.uvsFloat32[5]=this.y2,this.uvsFloat32[6]=this.x3,this.uvsFloat32[7]=this.y3},y_.prototype.toString=function(){return"[@pixi/core:TextureUvs x0="+this.x0+" y0="+this.y0+" x1="+this.x1+" y1="+this.y1+" x2="+this.x2+" y2="+this.y2+" x3="+this.x3+" y3="+this.y3+"]"},y_),f_=new p_,g_=(Sy(m_,o_=im),m_.prototype.update=function(){this.baseTexture.resource&&this.baseTexture.resource.update()},m_.prototype.onBaseTextureUpdated=function(t){if(this.noFrame){if(!this.baseTexture.valid)return;this._frame.width=t.width,this._frame.height=t.height,this.valid=!0,this.updateUvs()}else this.frame=this._frame;this.emit("update",this)},m_.prototype.destroy=function(t){if(this.baseTexture){if(t){var e=this.baseTexture.resource;e&&e.url&&Wm[e.url]&&m_.removeFromCache(e.url),this.baseTexture.destroy()}this.baseTexture.off("loaded",this.onBaseTextureUpdated,this),this.baseTexture.off("update",this.onBaseTextureUpdated,this),this.baseTexture=null}this._frame=null,this._uvs=null,this.trim=null,this.orig=null,this.valid=!1,m_.removeFromCache(this),this.textureCacheIds=null},m_.prototype.clone=function(){var t=this._frame.clone(),e=this._frame===this.orig?t:this.orig.clone(),i=new m_(this.baseTexture,!this.noFrame&&t,e,this.trim&&this.trim.clone(),this.rotate,this.defaultAnchor);return this.noFrame&&(i._frame=t),i},m_.prototype.updateUvs=function(){this._uvs===f_&&(this._uvs=new p_),this._uvs.set(this._frame,this.baseTexture,this.rotate),this._updateID++},m_.from=function(t,e,i){void 0===e&&(e={}),void 0===i&&(i=Tt.STRICT_TEXTURE_CACHE);var n="string"==typeof t,r=null;if(n)r=t;else if(t instanceof Ly){if(!t.cacheId){var s=e&&e.pixiIdPrefix||"pixiid";t.cacheId=s+"-"+Fm(),Ly.addToCache(t,t.cacheId)}r=t.cacheId}else t._pixiId||(s=e&&e.pixiIdPrefix||"pixiid",t._pixiId=s+"_"+Fm()),r=t._pixiId;var o=Wm[r];if(n&&i&&!o)throw new Error('The cacheId "'+r+'" does not exist in TextureCache.');return o||t instanceof Ly?!o&&t instanceof Ly&&(o=new m_(t),m_.addToCache(o,r)):(e.resolution||(e.resolution=Hm(t)),(o=new m_(new Ly(t,e))).baseTexture.cacheId=r,Ly.addToCache(o.baseTexture,r),m_.addToCache(o,r)),o},m_.fromURL=function(t,e){var i=Object.assign({autoLoad:!1},null==e?void 0:e.resourceOptions),n=m_.from(t,Object.assign({resourceOptions:i},e),!1),r=n.baseTexture.resource;return n.baseTexture.valid?Promise.resolve(n):r.load().then(function(){return Promise.resolve(n)})},m_.fromBuffer=function(t,e,i,n){return new m_(Ly.fromBuffer(t,e,i,n))},m_.fromLoader=function(t,e,i,n){var r=new Ly(t,Object.assign({scaleMode:Tt.SCALE_MODE,resolution:Hm(e)},n)),s=r.resource;s instanceof Xy&&(s.url=e);var o=new m_(r);return i=i||e,Ly.addToCache(o.baseTexture,i),m_.addToCache(o,i),i!==e&&(Ly.addToCache(o.baseTexture,e),m_.addToCache(o,e)),o.baseTexture.valid?Promise.resolve(o):new Promise(function(t){o.baseTexture.once("loaded",function(){return t(o)})})},m_.addToCache=function(t,e){e&&(-1===t.textureCacheIds.indexOf(e)&&t.textureCacheIds.push(e),Wm[e]&&console.warn("Texture added to the cache with an id ["+e+"] that already had an entry"),Wm[e]=t)},m_.removeFromCache=function(t){if("string"==typeof t){var e=Wm[t];if(e){var i=e.textureCacheIds.indexOf(t);return-1<i&&e.textureCacheIds.splice(i,1),delete Wm[t],e}}else if(t&&t.textureCacheIds){for(var n=0;n<t.textureCacheIds.length;++n)Wm[t.textureCacheIds[n]]===t&&delete Wm[t.textureCacheIds[n]];return t.textureCacheIds.length=0,t}return null},Object.defineProperty(m_.prototype,"resolution",{get:function(){return this.baseTexture.resolution},enumerable:!1,configurable:!0}),Object.defineProperty(m_.prototype,"frame",{get:function(){return this._frame},set:function(t){this._frame=t,this.noFrame=!1;var e=t.x,i=t.y,n=t.width,r=t.height,s=e+n>this.baseTexture.width,o=i+r>this.baseTexture.height;if(s||o){var a=s&&o?"and":"or",l="X: "+e+" + "+n+" = "+(e+n)+" > "+this.baseTexture.width,h="Y: "+i+" + "+r+" = "+(i+r)+" > "+this.baseTexture.height;throw new Error("Texture Error: frame does not fit inside the base Texture dimensions: "+l+" "+a+" "+h)}this.valid=n&&r&&this.baseTexture.valid,this.trim||this.rotate||(this.orig=t),this.valid&&this.updateUvs()},enumerable:!1,configurable:!0}),Object.defineProperty(m_.prototype,"rotate",{get:function(){return this._rotate},set:function(t){this._rotate=t,this.valid&&this.updateUvs()},enumerable:!1,configurable:!0}),Object.defineProperty(m_.prototype,"width",{get:function(){return this.orig.width},enumerable:!1,configurable:!0}),Object.defineProperty(m_.prototype,"height",{get:function(){return this.orig.height},enumerable:!1,configurable:!0}),m_.prototype.castToBaseTexture=function(){return this.baseTexture},m_);function m_(t,e,i,n,r,s){var o=o_.call(this)||this;if(o.noFrame=!1,e||(o.noFrame=!0,e=new iy(0,0,1,1)),t instanceof m_&&(t=t.baseTexture),o.baseTexture=t,o._frame=e,o.trim=n,o.valid=!1,o._uvs=f_,o.uvMatrix=null,o.orig=i||e,o._rotate=Number(r||0),!0===r)o._rotate=2;else if(o._rotate%2!=0)throw new Error("attempt to use diamond-shaped UVs. If you are sure, set rotation manually");return o.defaultAnchor=s?new ny(s.x,s.y):new ny(0,0),o._updateID=0,o.textureCacheIds=[],t.valid?o.noFrame?t.valid&&o.onBaseTextureUpdated(t):o.frame=e:t.once("loaded",o.onBaseTextureUpdated,o),o.noFrame&&t.on("update",o.onBaseTextureUpdated,o),o}function y_(){this.x0=0,this.y0=0,this.x1=1,this.y1=0,this.x2=1,this.y2=1,this.x3=0,this.y3=1,this.uvsFloat32=new Float32Array(8)}function __(t){var e=this;return"number"==typeof t&&(t={width:arguments[0],height:arguments[1],scaleMode:arguments[2],resolution:arguments[3]}),t.width=t.width||100,t.height=t.height||100,t.multisample=void 0!==t.multisample?t.multisample:nt.MSAA_QUALITY.NONE,(e=a_.call(this,null,t)||this).mipmap=nt.MIPMAP_MODES.OFF,e.valid=!0,e.clearColor=[0,0,0,0],e.framebuffer=new c_(e.realWidth,e.realHeight).addColorTexture(0,e),e.framebuffer.multisample=t.multisample,e.maskStack=[],e.filterStack=[{}],e}function v_(t,e){this.width=Math.round(t||100),this.height=Math.round(e||100),this.stencil=!1,this.depth=!1,this.dirtyId=0,this.dirtyFormat=0,this.dirtySize=0,this.depthTexture=null,this.colorTextures=[],this.glFramebuffers={},this.disposeRunner=new Ym("disposeFramebuffer"),this.multisample=nt.MSAA_QUALITY.NONE}function b_(){return null!==l_&&l_.apply(this,arguments)||this}function w_(t){t.destroy=function(){},t.on=function(){},t.once=function(){},t.emit=function(){}}g_.EMPTY=new g_(new Ly),w_(g_.EMPTY),w_(g_.EMPTY.baseTexture),g_.WHITE=function(){var t=document.createElement("canvas");t.width=16,t.height=16;var e=t.getContext("2d");return e.fillStyle="white",e.fillRect(0,0,16,16),new g_(new Ly(new Gy(t)))}(),w_(g_.WHITE),w_(g_.WHITE.baseTexture);function S_(t){this.framebuffer=t,this.stencil=null,this.dirtyId=-1,this.dirtyFormat=-1,this.dirtySize=-1,this.multisample=nt.MSAA_QUALITY.NONE,this.msaaBuffer=null,this.blitFramebuffer=null,this.mipLevel=0}var x_,T_,I_,P_=(Sy(fv,I_=g_),Object.defineProperty(fv.prototype,"framebuffer",{get:function(){return this.baseTexture.framebuffer},enumerable:!1,configurable:!0}),Object.defineProperty(fv.prototype,"multisample",{get:function(){return this.framebuffer.multisample},set:function(t){this.framebuffer.multisample=t},enumerable:!1,configurable:!0}),fv.prototype.resize=function(t,e,i){void 0===i&&(i=!0);var n=this.baseTexture.resolution,r=Math.round(t*n)/n,s=Math.round(e*n)/n;this.valid=0<r&&0<s,this._frame.width=this.orig.width=r,this._frame.height=this.orig.height=s,i&&this.baseTexture.resize(r,s),this.updateUvs()},fv.prototype.setResolution=function(t){var e=this.baseTexture;e.resolution!==t&&(e.setResolution(t),this.resize(e.width,e.height,!1))},fv.create=function(t){for(var e=arguments,i=[],n=1;n<arguments.length;n++)i[n-1]=e[n];return"number"==typeof t&&(Lm("6.0.0","Arguments (width, height, scaleMode, resolution) have been deprecated."),t={width:t,height:i[0],scaleMode:i[1],resolution:i[2]}),new fv(new d_(t))},fv),C_=(pv.prototype.createTexture=function(t,e,i){void 0===i&&(i=nt.MSAA_QUALITY.NONE);var n=new d_(Object.assign({width:t,height:e,resolution:1,multisample:i},this.textureOptions));return new P_(n)},pv.prototype.getOptimalTexture=function(t,e,i,n){var r;void 0===i&&(i=1),void 0===n&&(n=nt.MSAA_QUALITY.NONE),t=Math.ceil(t*i),e=Math.ceil(e*i),this.enableFullScreen&&t===this._pixelsWidth&&e===this._pixelsHeight?r=1<n?-n:-1:(r=((65535&(t=Rm(t)))<<16|65535&(e=Rm(e)))>>>0,1<n&&(r+=4294967296*n)),this.texturePool[r]||(this.texturePool[r]=[]);var s=this.texturePool[r].pop();return(s=s||this.createTexture(t,e,n)).filterPoolKey=r,s.setResolution(i),s},pv.prototype.getFilterTexture=function(t,e,i){var n=this.getOptimalTexture(t.width,t.height,e||t.resolution,i||nt.MSAA_QUALITY.NONE);return n.filterFrame=t.filterFrame,n},pv.prototype.returnTexture=function(t){var e=t.filterPoolKey;t.filterFrame=null,this.texturePool[e].push(t)},pv.prototype.returnFilterTexture=function(t){this.returnTexture(t)},pv.prototype.clear=function(t){if(t=!1!==t)for(var e in this.texturePool){var i=this.texturePool[e];if(i)for(var n=0;n<i.length;n++)i[n].destroy(!0)}this.texturePool={}},pv.prototype.setScreenSize=function(t){if(t.width!==this._pixelsWidth||t.height!==this._pixelsHeight){for(var e in this.enableFullScreen=0<t.width&&0<t.height,this.texturePool)if(Number(e)<0){var i=this.texturePool[e];if(i)for(var n=0;n<i.length;n++)i[n].destroy(!0);this.texturePool[e]=[]}this._pixelsWidth=t.width,this._pixelsHeight=t.height}},pv.SCREEN_KEY=-1,pv),E_=(dv.prototype.destroy=function(){this.buffer=null},dv.from=function(t,e,i,n,r){return new dv(t,e,i,n,r)},dv),A_=0,M_=(cv.prototype.update=function(t){t instanceof Array&&(t=new Float32Array(t)),this.data=t||this.data,this._updateID++},cv.prototype.dispose=function(){this.disposeRunner.emit(this,!1)},cv.prototype.destroy=function(){this.dispose(),this.data=null},Object.defineProperty(cv.prototype,"index",{get:function(){return this.type===nt.BUFFER_TYPE.ELEMENT_ARRAY_BUFFER},set:function(t){this.type=t?nt.BUFFER_TYPE.ELEMENT_ARRAY_BUFFER:nt.BUFFER_TYPE.ARRAY_BUFFER},enumerable:!1,configurable:!0}),cv.from=function(t){return t instanceof Array&&(t=new Float32Array(t)),new cv(t)},cv),B_={Float32Array:Float32Array,Uint32Array:Uint32Array,Int32Array:Int32Array,Uint8Array:Uint8Array},R_={5126:4,5123:2,5121:1},O_=0,k_={Float32Array:Float32Array,Uint32Array:Uint32Array,Int32Array:Int32Array,Uint8Array:Uint8Array,Uint16Array:Uint16Array},D_=(uv.prototype.addAttribute=function(t,e,i,n,r,s,o,a){if(void 0===i&&(i=0),void 0===n&&(n=!1),void 0===a&&(a=!1),!e)throw new Error("You must pass a buffer when creating an attribute");e instanceof M_||(e instanceof Array&&(e=new Float32Array(e)),e=new M_(e));var l=t.split("|");if(1<l.length){for(var h=0;h<l.length;h++)this.addAttribute(l[h],e,i,n,r);return this}var u=this.buffers.indexOf(e);return-1===u&&(this.buffers.push(e),u=this.buffers.length-1),this.attributes[t]=new E_(u,i,n,r,s,o,a),this.instanced=this.instanced||a,this},uv.prototype.getAttribute=function(t){return this.attributes[t]},uv.prototype.getBuffer=function(t){return this.buffers[this.getAttribute(t).buffer]},uv.prototype.addIndex=function(t){return t instanceof M_||(t instanceof Array&&(t=new Uint16Array(t)),t=new M_(t)),t.type=nt.BUFFER_TYPE.ELEMENT_ARRAY_BUFFER,this.indexBuffer=t,-1===this.buffers.indexOf(t)&&this.buffers.push(t),this},uv.prototype.getIndex=function(){return this.indexBuffer},uv.prototype.interleave=function(){if(1===this.buffers.length||2===this.buffers.length&&this.indexBuffer)return this;var t,e=[],i=[],n=new M_;for(t in this.attributes){var r=this.attributes[t],s=this.buffers[r.buffer];e.push(s.data),i.push(r.size*R_[r.type]/4),r.buffer=0}for(n.data=function(t,e){for(var i=0,n=0,r={},s=0;s<t.length;s++)n+=e[s],i+=t[s].length;var o=new ArrayBuffer(4*i),a=null,l=0;for(s=0;s<t.length;s++){var h=e[s],u=t[s],c=Bm(u);r[c]||(r[c]=new B_[c](o)),a=r[c];for(var d=0;d<u.length;d++)a[(d/h|0)*n+l+d%h]=u[d];l+=h}return new Float32Array(o)}(e,i),t=0;t<this.buffers.length;t++)this.buffers[t]!==this.indexBuffer&&this.buffers[t].destroy();return this.buffers=[n],this.indexBuffer&&this.buffers.push(this.indexBuffer),this},uv.prototype.getSize=function(){for(var t in this.attributes){var e=this.attributes[t];return this.buffers[e.buffer].data.length/(e.stride/4||e.size)}return 0},uv.prototype.dispose=function(){this.disposeRunner.emit(this,!1)},uv.prototype.destroy=function(){this.dispose(),this.buffers=null,this.indexBuffer=null,this.attributes=null},uv.prototype.clone=function(){for(var t=new uv,e=0;e<this.buffers.length;e++)t.buffers[e]=new M_(this.buffers[e].data.slice(0));for(var e in this.attributes){var i=this.attributes[e];t.attributes[e]=new E_(i.buffer,i.size,i.normalized,i.type,i.stride,i.start,i.instance)}return this.indexBuffer&&(t.indexBuffer=t.buffers[this.buffers.indexOf(this.indexBuffer)],t.indexBuffer.type=nt.BUFFER_TYPE.ELEMENT_ARRAY_BUFFER),t},uv.merge=function(t){for(var e,i=new uv,n=[],r=[],s=[],o=0;o<t.length;o++){e=t[o];for(var a=0;a<e.buffers.length;a++)r[a]=r[a]||0,r[a]+=e.buffers[a].data.length,s[a]=0}for(o=0;o<e.buffers.length;o++)n[o]=new(k_[Bm(e.buffers[o].data)])(r[o]),i.buffers[o]=new M_(n[o]);for(o=0;o<t.length;o++)for(e=t[o],a=0;a<e.buffers.length;a++)n[a].set(e.buffers[a].data,s[a]),s[a]+=e.buffers[a].data.length;if(i.attributes=e.attributes,e.indexBuffer){i.indexBuffer=i.buffers[e.buffers.indexOf(e.indexBuffer)],i.indexBuffer.type=nt.BUFFER_TYPE.ELEMENT_ARRAY_BUFFER;var l=0,h=0,u=0,c=0;for(o=0;o<e.buffers.length;o++)if(e.buffers[o]!==e.indexBuffer){c=o;break}for(var o in e.attributes){var d=e.attributes[o];(0|d.buffer)===c&&(h+=d.size*R_[d.type]/4)}for(o=0;o<t.length;o++){var p=t[o].indexBuffer.data;for(a=0;a<p.length;a++)i.indexBuffer.data[a+u]+=l;l+=t[o].buffers[c].data.length/h,u+=p.length}}return i},uv),F_=(Sy(hv,T_=D_),hv),N_=(Sy(lv,x_=D_),lv.prototype.map=function(t,e){var i=0,n=0;return this.uvs[0]=i,this.uvs[1]=n,this.uvs[2]=i+e.width/t.width,this.uvs[3]=n,this.uvs[4]=i+e.width/t.width,this.uvs[5]=n+e.height/t.height,this.uvs[6]=i,this.uvs[7]=n+e.height/t.height,i=e.x,n=e.y,this.vertices[0]=i,this.vertices[1]=n,this.vertices[2]=i+e.width,this.vertices[3]=n,this.vertices[4]=i+e.width,this.vertices[5]=n+e.height,this.vertices[6]=i,this.vertices[7]=n+e.height,this.invalidate(),this},lv.prototype.invalidate=function(){return this.vertexBuffer._updateID++,this.uvBuffer._updateID++,this},lv),L_=0,U_=(av.prototype.update=function(){this.dirtyId++,!this.autoManage&&this.buffer&&this.buffer.update()},av.prototype.add=function(t,e,i){if(this.ubo)throw new Error("[UniformGroup] uniform groups in ubo mode cannot be modified, or have uniform groups nested in them");this.uniforms[t]=new av(e,i)},av.from=function(t,e,i){return new av(t,e,i)},av.uboFrom=function(t,e){return new av(t,null==e||e,!0)},av),z_=(ov.prototype.clear=function(){this.target=null,this.filters=null,this.renderTexture=null},ov),W_=[new ny,new ny,new ny,new ny],G_=new sy,H_=(sv.prototype.push=function(t,e){for(var i,n,r=this.renderer,s=this.defaultFilterStack,o=this.statePool.pop()||new z_,a=this.renderer.renderTexture,l=e[0].resolution,h=e[0].multisample,u=e[0].padding,c=e[0].autoFit,d=null===(i=e[0].legacy)||void 0===i||i,p=1;p<e.length;p++){var f=e[p];l=Math.min(l,f.resolution),h=Math.min(h,f.multisample),u=this.useMaxPadding?Math.max(u,f.padding):u+f.padding,c=c&&f.autoFit,d=d||null===(n=f.legacy)||void 0===n||n}if(1===s.length&&(this.defaultFilterStack[0].renderTexture=a.current),s.push(o),o.resolution=l,o.multisample=h,o.legacy=d,o.target=t,o.sourceFrame.copyFrom(t.filterArea||t.getBounds(!0)),o.sourceFrame.pad(u),c){var g=this.tempRect.copyFrom(a.sourceFrame);r.projection.transform&&this.transformAABB(G_.copyFrom(r.projection.transform).invert(),g),o.sourceFrame.fit(g)}this.roundFrame(o.sourceFrame,a.current?a.current.resolution:r.resolution,a.sourceFrame,a.destinationFrame,r.projection.transform),o.renderTexture=this.getOptimalFilterTexture(o.sourceFrame.width,o.sourceFrame.height,l,h),o.filters=e,o.destinationFrame.width=o.renderTexture.width,o.destinationFrame.height=o.renderTexture.height;var m=this.tempRect;m.x=0,m.y=0,m.width=o.sourceFrame.width,m.height=o.sourceFrame.height,o.renderTexture.filterFrame=o.sourceFrame,o.bindingSourceFrame.copyFrom(a.sourceFrame),o.bindingDestinationFrame.copyFrom(a.destinationFrame),o.transform=r.projection.transform,r.projection.transform=null,a.bind(o.renderTexture,o.sourceFrame,m),r.framebuffer.clear(0,0,0,0)},sv.prototype.pop=function(){var t=this.defaultFilterStack,e=t.pop(),i=e.filters;this.activeState=e;var n=this.globalUniforms.uniforms;n.outputFrame=e.sourceFrame,n.resolution=e.resolution;var r=n.inputSize,s=n.inputPixel,o=n.inputClamp;if(r[0]=e.destinationFrame.width,r[1]=e.destinationFrame.height,r[2]=1/r[0],r[3]=1/r[1],s[0]=Math.round(r[0]*e.resolution),s[1]=Math.round(r[1]*e.resolution),s[2]=1/s[0],s[3]=1/s[1],o[0]=.5*s[2],o[1]=.5*s[3],o[2]=e.sourceFrame.width*r[2]-.5*s[2],o[3]=e.sourceFrame.height*r[3]-.5*s[3],e.legacy){var a=n.filterArea;a[0]=e.destinationFrame.width,a[1]=e.destinationFrame.height,a[2]=e.sourceFrame.x,a[3]=e.sourceFrame.y,n.filterClamp=n.inputClamp}this.globalUniforms.update();var l=t[t.length-1];if(this.renderer.framebuffer.blit(),1===i.length)i[0].apply(this,e.renderTexture,l.renderTexture,nt.CLEAR_MODES.BLEND,e),this.returnFilterTexture(e.renderTexture);else{var h=e.renderTexture,u=this.getOptimalFilterTexture(h.width,h.height,e.resolution);u.filterFrame=h.filterFrame;var c=0;for(c=0;c<i.length-1;++c){1===c&&1<e.multisample&&((u=this.getOptimalFilterTexture(h.width,h.height,e.resolution)).filterFrame=h.filterFrame),i[c].apply(this,h,u,nt.CLEAR_MODES.CLEAR,e);var d=h;h=u,u=d}i[c].apply(this,h,l.renderTexture,nt.CLEAR_MODES.BLEND,e),1<c&&1<e.multisample&&this.returnFilterTexture(e.renderTexture),this.returnFilterTexture(h),this.returnFilterTexture(u)}e.clear(),this.statePool.push(e)},sv.prototype.bindAndClear=function(t,e){void 0===e&&(e=nt.CLEAR_MODES.CLEAR);var i=this.renderer,n=i.renderTexture,r=i.state;if(t===this.defaultFilterStack[this.defaultFilterStack.length-1].renderTexture?this.renderer.projection.transform=this.activeState.transform:this.renderer.projection.transform=null,t&&t.filterFrame){var s=this.tempRect;s.x=0,s.y=0,s.width=t.filterFrame.width,s.height=t.filterFrame.height,n.bind(t,t.filterFrame,s)}else t!==this.defaultFilterStack[this.defaultFilterStack.length-1].renderTexture?n.bind(t):this.renderer.renderTexture.bind(t,this.activeState.bindingSourceFrame,this.activeState.bindingDestinationFrame);var o=1&r.stateId||this.forceClear;(e===nt.CLEAR_MODES.CLEAR||e===nt.CLEAR_MODES.BLIT&&o)&&this.renderer.framebuffer.clear(0,0,0,0)},sv.prototype.applyFilter=function(t,e,i,n){var r=this.renderer;r.state.set(t.state),this.bindAndClear(i,n),t.uniforms.uSampler=e,t.uniforms.filterGlobals=this.globalUniforms,r.shader.bind(t),t.legacy=!!t.program.attributeData.aTextureCoord,t.legacy?(this.quadUv.map(e._frame,e.filterFrame),r.geometry.bind(this.quadUv),r.geometry.draw(nt.DRAW_MODES.TRIANGLES)):(r.geometry.bind(this.quad),r.geometry.draw(nt.DRAW_MODES.TRIANGLE_STRIP))},sv.prototype.calculateSpriteMatrix=function(t,e){var i=this.activeState,n=i.sourceFrame,r=i.destinationFrame,s=e._texture.orig,o=t.set(r.width,0,0,r.height,n.x,n.y),a=e.worldTransform.copyTo(sy.TEMP_MATRIX);return a.invert(),o.prepend(a),o.scale(1/s.width,1/s.height),o.translate(e.anchor.x,e.anchor.y),o},sv.prototype.destroy=function(){this.renderer=null,this.texturePool.clear(!1)},sv.prototype.getOptimalFilterTexture=function(t,e,i,n){return void 0===i&&(i=1),void 0===n&&(n=nt.MSAA_QUALITY.NONE),this.texturePool.getOptimalTexture(t,e,i,n)},sv.prototype.getFilterTexture=function(t,e,i){if("number"==typeof t){var n=t;t=e,e=n}t=t||this.activeState.renderTexture;var r=this.texturePool.getOptimalTexture(t.width,t.height,e||t.resolution,i||nt.MSAA_QUALITY.NONE);return r.filterFrame=t.filterFrame,r},sv.prototype.returnFilterTexture=function(t){this.texturePool.returnTexture(t)},sv.prototype.emptyPool=function(){this.texturePool.clear(!0)},sv.prototype.resize=function(){this.texturePool.setScreenSize(this.renderer.view)},sv.prototype.transformAABB=function(t,e){var i=W_[0],n=W_[1],r=W_[2],s=W_[3];i.set(e.left,e.top),n.set(e.left,e.bottom),r.set(e.right,e.top),s.set(e.right,e.bottom),t.apply(i,i),t.apply(n,n),t.apply(r,r),t.apply(s,s);var o=Math.min(i.x,n.x,r.x,s.x),a=Math.min(i.y,n.y,r.y,s.y),l=Math.max(i.x,n.x,r.x,s.x),h=Math.max(i.y,n.y,r.y,s.y);e.x=o,e.y=a,e.width=l-o,e.height=h-a},sv.prototype.roundFrame=function(t,e,i,n,r){if(r){var s=r.a,o=r.b,a=r.c,l=r.d;if((1e-4<Math.abs(o)||1e-4<Math.abs(a))&&(1e-4<Math.abs(s)||1e-4<Math.abs(l)))return}(r=r?G_.copyFrom(r):G_.identity()).translate(-i.x,-i.y).scale(n.width/i.width,n.height/i.height).translate(n.x,n.y),this.transformAABB(r,t),t.ceil(e),this.transformAABB(r.invert(),t)},sv),X_=(rv.prototype.flush=function(){},rv.prototype.destroy=function(){this.renderer=null},rv.prototype.start=function(){},rv.prototype.stop=function(){this.flush()},rv.prototype.render=function(t){},rv),j_=(nv.prototype.setObjectRenderer=function(t){this.currentRenderer!==t&&(this.currentRenderer.stop(),this.currentRenderer=t,this.currentRenderer.start())},nv.prototype.flush=function(){this.setObjectRenderer(this.emptyRenderer)},nv.prototype.reset=function(){this.setObjectRenderer(this.emptyRenderer)},nv.prototype.copyBoundTextures=function(t,e){for(var i=this.renderer.texture.boundTextures,n=e-1;0<=n;--n)t[n]=i[n]||null,t[n]&&(t[n]._batchLocation=n)},nv.prototype.boundArray=function(t,e,i,n){for(var r=t.elements,s=t.ids,o=t.count,a=0,l=0;l<o;l++){var h=r[l],u=h._batchLocation;if(0<=u&&u<n&&e[u]===h)s[l]=u;else for(;a<n;){var c=e[a];if(!c||c._batchEnabled!==i||c._batchLocation!==a){s[l]=a,e[h._batchLocation=a]=h;break}a++}}},nv.prototype.destroy=function(){this.renderer=null},nv),V_=0,Y_=(Object.defineProperty(iv.prototype,"isLost",{get:function(){return!this.gl||this.gl.isContextLost()},enumerable:!1,configurable:!0}),iv.prototype.contextChange=function(t){this.gl=t,this.renderer.gl=t,this.renderer.CONTEXT_UID=V_++,t.isContextLost()&&t.getExtension("WEBGL_lose_context")&&t.getExtension("WEBGL_lose_context").restoreContext()},iv.prototype.initFromContext=function(t){this.gl=t,this.validateContext(t),this.renderer.gl=t,this.renderer.CONTEXT_UID=V_++,this.renderer.runners.contextChange.emit(t)},iv.prototype.initFromOptions=function(t){var e=this.createContext(this.renderer.view,t);this.initFromContext(e)},iv.prototype.createContext=function(t,e){var i;if(Tt.PREFER_ENV>=nt.ENV.WEBGL2&&(i=t.getContext("webgl2",e)),i)this.webGLVersion=2;else if(this.webGLVersion=1,!(i=t.getContext("webgl",e)||t.getContext("experimental-webgl",e)))throw new Error("This browser does not support WebGL. Try using the canvas renderer");return this.gl=i,this.getExtensions(),this.gl},iv.prototype.getExtensions=function(){var t=this.gl,e={anisotropicFiltering:t.getExtension("EXT_texture_filter_anisotropic"),floatTextureLinear:t.getExtension("OES_texture_float_linear"),s3tc:t.getExtension("WEBGL_compressed_texture_s3tc"),s3tc_sRGB:t.getExtension("WEBGL_compressed_texture_s3tc_srgb"),etc:t.getExtension("WEBGL_compressed_texture_etc"),etc1:t.getExtension("WEBGL_compressed_texture_etc1"),pvrtc:t.getExtension("WEBGL_compressed_texture_pvrtc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),atc:t.getExtension("WEBGL_compressed_texture_atc"),astc:t.getExtension("WEBGL_compressed_texture_astc")};1===this.webGLVersion?Object.assign(this.extensions,e,{drawBuffers:t.getExtension("WEBGL_draw_buffers"),depthTexture:t.getExtension("WEBGL_depth_texture"),loseContext:t.getExtension("WEBGL_lose_context"),vertexArrayObject:t.getExtension("OES_vertex_array_object")||t.getExtension("MOZ_OES_vertex_array_object")||t.getExtension("WEBKIT_OES_vertex_array_object"),uint32ElementIndex:t.getExtension("OES_element_index_uint"),floatTexture:t.getExtension("OES_texture_float"),floatTextureLinear:t.getExtension("OES_texture_float_linear"),textureHalfFloat:t.getExtension("OES_texture_half_float"),textureHalfFloatLinear:t.getExtension("OES_texture_half_float_linear")}):2===this.webGLVersion&&Object.assign(this.extensions,e,{colorBufferFloat:t.getExtension("EXT_color_buffer_float")})},iv.prototype.handleContextLost=function(t){t.preventDefault()},iv.prototype.handleContextRestored=function(){this.renderer.runners.contextChange.emit(this.gl)},iv.prototype.destroy=function(){var t=this.renderer.view;this.renderer=null,t.removeEventListener("webglcontextlost",this.handleContextLost),t.removeEventListener("webglcontextrestored",this.handleContextRestored),this.gl.useProgram(null),this.extensions.loseContext&&this.extensions.loseContext.loseContext()},iv.prototype.postrender=function(){this.renderer.renderingToScreen&&this.gl.flush()},iv.prototype.validateContext=function(t){var e=t.getContextAttributes(),i="WebGL2RenderingContext"in self&&t instanceof self.WebGL2RenderingContext;i&&(this.webGLVersion=2),e.stencil||console.warn("Provided WebGL context does not have a stencil buffer, masks may not render correctly");var n=i||!!t.getExtension("OES_element_index_uint");(this.supports.uint32Indices=n)||console.warn("Provided WebGL context does not support 32 index buffer, complex graphics may not render correctly")},iv),q_=new iy,K_=(ev.prototype.contextChange=function(){var t=this.gl=this.renderer.gl;if(this.CONTEXT_UID=this.renderer.CONTEXT_UID,this.current=this.unknownFramebuffer,this.viewport=new iy,this.hasMRT=!0,this.writeDepthTexture=!0,this.disposeAll(!0),1===this.renderer.context.webGLVersion){var e=this.renderer.context.extensions.drawBuffers,i=this.renderer.context.extensions.depthTexture;Tt.PREFER_ENV===nt.ENV.WEBGL_LEGACY&&(i=e=null),e?t.drawBuffers=function(t){return e.drawBuffersWEBGL(t)}:(this.hasMRT=!1,t.drawBuffers=function(){}),i||(this.writeDepthTexture=!1)}else this.msaaSamples=t.getInternalformatParameter(t.RENDERBUFFER,t.RGBA8,t.SAMPLES)},ev.prototype.bind=function(t,e,i){void 0===i&&(i=0);var n=this.gl;if(t){var r=t.glFramebuffers[this.CONTEXT_UID]||this.initFramebuffer(t);this.current!==t&&(this.current=t,n.bindFramebuffer(n.FRAMEBUFFER,r.framebuffer)),r.mipLevel!==i&&(t.dirtyId++,t.dirtyFormat++,r.mipLevel=i),r.dirtyId!==t.dirtyId&&(r.dirtyId=t.dirtyId,r.dirtyFormat!==t.dirtyFormat?(r.dirtyFormat=t.dirtyFormat,r.dirtySize=t.dirtySize,this.updateFramebuffer(t,i)):r.dirtySize!==t.dirtySize&&(r.dirtySize=t.dirtySize,this.resizeFramebuffer(t)));for(var s=0;s<t.colorTextures.length;s++){var o=t.colorTextures[s];this.renderer.texture.unbind(o.parentTextureArray||o)}if(t.depthTexture&&this.renderer.texture.unbind(t.depthTexture),e){var a=e.width>>i,l=e.height>>i,h=a/e.width;this.setViewport(e.x*h,e.y*h,a,l)}else a=t.width>>i,l=t.height>>i,this.setViewport(0,0,a,l)}else this.current&&(this.current=null,n.bindFramebuffer(n.FRAMEBUFFER,null)),e?this.setViewport(e.x,e.y,e.width,e.height):this.setViewport(0,0,this.renderer.width,this.renderer.height)},ev.prototype.setViewport=function(t,e,i,n){var r=this.viewport;t=Math.round(t),e=Math.round(e),i=Math.round(i),n=Math.round(n),r.width===i&&r.height===n&&r.x===t&&r.y===e||(r.x=t,r.y=e,r.width=i,r.height=n,this.gl.viewport(t,e,i,n))},Object.defineProperty(ev.prototype,"size",{get:function(){return this.current?{x:0,y:0,width:this.current.width,height:this.current.height}:{x:0,y:0,width:this.renderer.width,height:this.renderer.height}},enumerable:!1,configurable:!0}),ev.prototype.clear=function(t,e,i,n,r){void 0===r&&(r=nt.BUFFER_BITS.COLOR|nt.BUFFER_BITS.DEPTH);var s=this.gl;s.clearColor(t,e,i,n),s.clear(r)},ev.prototype.initFramebuffer=function(t){var e=this.gl,i=new S_(e.createFramebuffer());return i.multisample=this.detectSamples(t.multisample),t.glFramebuffers[this.CONTEXT_UID]=i,this.managedFramebuffers.push(t),t.disposeRunner.add(this),i},ev.prototype.resizeFramebuffer=function(t){var e=this.gl,i=t.glFramebuffers[this.CONTEXT_UID];i.msaaBuffer&&(e.bindRenderbuffer(e.RENDERBUFFER,i.msaaBuffer),e.renderbufferStorageMultisample(e.RENDERBUFFER,i.multisample,e.RGBA8,t.width,t.height)),i.stencil&&(e.bindRenderbuffer(e.RENDERBUFFER,i.stencil),i.msaaBuffer?e.renderbufferStorageMultisample(e.RENDERBUFFER,i.multisample,e.DEPTH24_STENCIL8,t.width,t.height):e.renderbufferStorage(e.RENDERBUFFER,e.DEPTH_STENCIL,t.width,t.height));var n=t.colorTextures,r=n.length;e.drawBuffers||(r=Math.min(r,1));for(var s=0;s<r;s++){var o=n[s],a=o.parentTextureArray||o;this.renderer.texture.bind(a,0)}t.depthTexture&&this.writeDepthTexture&&this.renderer.texture.bind(t.depthTexture,0)},ev.prototype.updateFramebuffer=function(t,e){var i=this.gl,n=t.glFramebuffers[this.CONTEXT_UID],r=t.colorTextures,s=r.length;i.drawBuffers||(s=Math.min(s,1)),1<n.multisample&&this.canMultisampleFramebuffer(t)?(n.msaaBuffer=n.msaaBuffer||i.createRenderbuffer(),i.bindRenderbuffer(i.RENDERBUFFER,n.msaaBuffer),i.renderbufferStorageMultisample(i.RENDERBUFFER,n.multisample,i.RGBA8,t.width,t.height),i.framebufferRenderbuffer(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.RENDERBUFFER,n.msaaBuffer)):n.msaaBuffer&&(i.deleteRenderbuffer(n.msaaBuffer),n.msaaBuffer=null,n.blitFramebuffer&&(n.blitFramebuffer.dispose(),n.blitFramebuffer=null));for(var o=[],a=0;a<s;a++){var l=r[a],h=l.parentTextureArray||l;this.renderer.texture.bind(h,0),0===a&&n.msaaBuffer||(i.framebufferTexture2D(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0+a,l.target,h._glTextures[this.CONTEXT_UID].texture,e),o.push(i.COLOR_ATTACHMENT0+a))}if(1<o.length&&i.drawBuffers(o),t.depthTexture&&this.writeDepthTexture){var u=t.depthTexture;this.renderer.texture.bind(u,0),i.framebufferTexture2D(i.FRAMEBUFFER,i.DEPTH_ATTACHMENT,i.TEXTURE_2D,u._glTextures[this.CONTEXT_UID].texture,e)}!t.stencil&&!t.depth||t.depthTexture&&this.writeDepthTexture?n.stencil&&(i.deleteRenderbuffer(n.stencil),n.stencil=null):(n.stencil=n.stencil||i.createRenderbuffer(),i.bindRenderbuffer(i.RENDERBUFFER,n.stencil),n.msaaBuffer?i.renderbufferStorageMultisample(i.RENDERBUFFER,n.multisample,i.DEPTH24_STENCIL8,t.width,t.height):i.renderbufferStorage(i.RENDERBUFFER,i.DEPTH_STENCIL,t.width,t.height),i.framebufferRenderbuffer(i.FRAMEBUFFER,i.DEPTH_STENCIL_ATTACHMENT,i.RENDERBUFFER,n.stencil))},ev.prototype.canMultisampleFramebuffer=function(t){return 1!==this.renderer.context.webGLVersion&&t.colorTextures.length<=1&&!t.depthTexture},ev.prototype.detectSamples=function(t){var e=this.msaaSamples,i=nt.MSAA_QUALITY.NONE;if(t<=1||null===e)return i;for(var n=0;n<e.length;n++)if(e[n]<=t){i=e[n];break}return 1===i&&(i=nt.MSAA_QUALITY.NONE),i},ev.prototype.blit=function(t,e,i){var n=this.current,r=this.renderer,s=this.gl,o=this.CONTEXT_UID;if(2===r.context.webGLVersion&&n){var a=n.glFramebuffers[o];if(a){if(!t){if(!a.msaaBuffer)return;var l=n.colorTextures[0];if(!l)return;a.blitFramebuffer||(a.blitFramebuffer=new c_(n.width,n.height),a.blitFramebuffer.addColorTexture(0,l)),(t=a.blitFramebuffer).colorTextures[0]!==l&&(t.colorTextures[0]=l,t.dirtyId++,t.dirtyFormat++),t.width===n.width&&t.height===n.height||(t.width=n.width,t.height=n.height,t.dirtyId++,t.dirtySize++)}e||((e=q_).width=n.width,e.height=n.height),i=i||e;var h=e.width===i.width&&e.height===i.height;this.bind(t),s.bindFramebuffer(s.READ_FRAMEBUFFER,a.framebuffer),s.blitFramebuffer(e.x,e.y,e.width,e.height,i.x,i.y,i.width,i.height,s.COLOR_BUFFER_BIT,h?s.NEAREST:s.LINEAR)}}},ev.prototype.disposeFramebuffer=function(t,e){var i=t.glFramebuffers[this.CONTEXT_UID],n=this.gl;if(i){delete t.glFramebuffers[this.CONTEXT_UID];var r=this.managedFramebuffers.indexOf(t);0<=r&&this.managedFramebuffers.splice(r,1),t.disposeRunner.remove(this),e||(n.deleteFramebuffer(i.framebuffer),i.msaaBuffer&&n.deleteRenderbuffer(i.msaaBuffer),i.stencil&&n.deleteRenderbuffer(i.stencil)),i.blitFramebuffer&&i.blitFramebuffer.dispose()}},ev.prototype.disposeAll=function(t){var e=this.managedFramebuffers;this.managedFramebuffers=[];for(var i=0;i<e.length;i++)this.disposeFramebuffer(e[i],t)},ev.prototype.forceStencil=function(){var t=this.current;if(t){var e=t.glFramebuffers[this.CONTEXT_UID];if(e&&!e.stencil){t.stencil=!0;var i=t.width,n=t.height,r=this.gl,s=r.createRenderbuffer();r.bindRenderbuffer(r.RENDERBUFFER,s),e.msaaBuffer?r.renderbufferStorageMultisample(r.RENDERBUFFER,e.multisample,r.DEPTH24_STENCIL8,i,n):r.renderbufferStorage(r.RENDERBUFFER,r.DEPTH_STENCIL,i,n),e.stencil=s,r.framebufferRenderbuffer(r.FRAMEBUFFER,r.DEPTH_STENCIL_ATTACHMENT,r.RENDERBUFFER,s)}}},ev.prototype.reset=function(){this.current=this.unknownFramebuffer,this.viewport=new iy},ev.prototype.destroy=function(){this.renderer=null},ev),$_={5126:4,5123:2,5121:1},Q_=(tv.prototype.contextChange=function(){this.disposeAll(!0);var t=this.gl=this.renderer.gl,e=this.renderer.context;if(this.CONTEXT_UID=this.renderer.CONTEXT_UID,2!==e.webGLVersion){var i=this.renderer.context.extensions.vertexArrayObject;Tt.PREFER_ENV===nt.ENV.WEBGL_LEGACY&&(i=null),i?(t.createVertexArray=function(){return i.createVertexArrayOES()},t.bindVertexArray=function(t){return i.bindVertexArrayOES(t)},t.deleteVertexArray=function(t){return i.deleteVertexArrayOES(t)}):(this.hasVao=!1,t.createVertexArray=function(){return null},t.bindVertexArray=function(){return null},t.deleteVertexArray=function(){return null})}if(2!==e.webGLVersion){var s=t.getExtension("ANGLE_instanced_arrays");s?(t.vertexAttribDivisor=function(t,e){return s.vertexAttribDivisorANGLE(t,e)},t.drawElementsInstanced=function(t,e,i,n,r){return s.drawElementsInstancedANGLE(t,e,i,n,r)},t.drawArraysInstanced=function(t,e,i,n){return s.drawArraysInstancedANGLE(t,e,i,n)}):this.hasInstance=!1}this.canUseUInt32ElementIndex=2===e.webGLVersion||!!e.extensions.uint32ElementIndex},tv.prototype.bind=function(t,e){e=e||this.renderer.shader.shader;var i=this.gl,n=t.glVertexArrayObjects[this.CONTEXT_UID],r=!1;n||((this.managedGeometries[t.id]=t).disposeRunner.add(this),t.glVertexArrayObjects[this.CONTEXT_UID]=n={},r=!0);var s=n[e.program.id]||this.initGeometryVao(t,e,r);this._activeGeometry=t,this._activeVao!==s&&(this._activeVao=s,this.hasVao?i.bindVertexArray(s):this.activateVao(t,e.program)),this.updateBuffers()},tv.prototype.reset=function(){this.unbind()},tv.prototype.updateBuffers=function(){for(var t=this._activeGeometry,e=this.renderer.buffer,i=0;i<t.buffers.length;i++){var n=t.buffers[i];e.update(n)}},tv.prototype.checkCompatibility=function(t,e){var i=t.attributes,n=e.attributeData;for(var r in n)if(!i[r])throw new Error('shader and geometry incompatible, geometry missing the "'+r+'" attribute')},tv.prototype.getSignature=function(t,e){var i=t.attributes,n=e.attributeData,r=["g",t.id];for(var s in i)n[s]&&r.push(s,n[s].location);return r.join("-")},tv.prototype.initGeometryVao=function(t,e,i){void 0===i&&(i=!0);var n=this.gl,r=this.CONTEXT_UID,s=this.renderer.buffer,o=e.program;o.glPrograms[r]||this.renderer.shader.generateProgram(e),this.checkCompatibility(t,o);var a=this.getSignature(t,o),l=t.glVertexArrayObjects[this.CONTEXT_UID],h=l[a];if(h)return l[o.id]=h;var u=t.buffers,c=t.attributes,d={},p={};for(var f in u)d[f]=0,p[f]=0;for(var f in c)!c[f].size&&o.attributeData[f]?c[f].size=o.attributeData[f].size:c[f].size||console.warn("PIXI Geometry attribute '"+f+"' size cannot be determined (likely the bound shader does not have the attribute)"),d[c[f].buffer]+=c[f].size*$_[c[f].type];for(var f in c){var g=c[f],m=g.size;void 0===g.stride&&(d[g.buffer]===m*$_[g.type]?g.stride=0:g.stride=d[g.buffer]),void 0===g.start&&(g.start=p[g.buffer],p[g.buffer]+=m*$_[g.type])}h=n.createVertexArray(),n.bindVertexArray(h);for(var y=0;y<u.length;y++){var _=u[y];s.bind(_),i&&_._glBuffers[r].refCount++}return this.activateVao(t,o),this._activeVao=h,l[o.id]=h,l[a]=h},tv.prototype.disposeGeometry=function(t,e){var i;if(this.managedGeometries[t.id]){delete this.managedGeometries[t.id];var n=t.glVertexArrayObjects[this.CONTEXT_UID],r=this.gl,s=t.buffers,o=null===(i=this.renderer)||void 0===i?void 0:i.buffer;if(t.disposeRunner.remove(this),n){if(o)for(var a=0;a<s.length;a++){var l=s[a]._glBuffers[this.CONTEXT_UID];l&&(l.refCount--,0!==l.refCount||e||o.dispose(s[a],e))}if(!e)for(var h in n)if("g"===h[0]){var u=n[h];this._activeVao===u&&this.unbind(),r.deleteVertexArray(u)}delete t.glVertexArrayObjects[this.CONTEXT_UID]}}},tv.prototype.disposeAll=function(t){for(var e=Object.keys(this.managedGeometries),i=0;i<e.length;i++)this.disposeGeometry(this.managedGeometries[e[i]],t)},tv.prototype.activateVao=function(t,e){var i=this.gl,n=this.CONTEXT_UID,r=this.renderer.buffer,s=t.buffers,o=t.attributes;t.indexBuffer&&r.bind(t.indexBuffer);var a=null;for(var l in o){var h=o[l],u=s[h.buffer],c=u._glBuffers[n];if(e.attributeData[l]){a!==c&&(r.bind(u),a=c);var d=e.attributeData[l].location;if(i.enableVertexAttribArray(d),i.vertexAttribPointer(d,h.size,h.type||i.FLOAT,h.normalized,h.stride,h.start),h.instance){if(!this.hasInstance)throw new Error("geometry error, GPU Instancing is not supported on this device");i.vertexAttribDivisor(d,1)}}}},tv.prototype.draw=function(t,e,i,n){var r=this.gl,s=this._activeGeometry;if(s.indexBuffer){var o=s.indexBuffer.data.BYTES_PER_ELEMENT,a=2===o?r.UNSIGNED_SHORT:r.UNSIGNED_INT;2===o||4===o&&this.canUseUInt32ElementIndex?s.instanced?r.drawElementsInstanced(t,e||s.indexBuffer.data.length,a,(i||0)*o,n||1):r.drawElements(t,e||s.indexBuffer.data.length,a,(i||0)*o):console.warn("unsupported index buffer type: uint32")}else s.instanced?r.drawArraysInstanced(t,i,e||s.getSize(),n||1):r.drawArrays(t,i,e||s.getSize());return this},tv.prototype.unbind=function(){this.gl.bindVertexArray(null),this._activeVao=null,this._activeGeometry=null},tv.prototype.destroy=function(){this.renderer=null},tv),J_=(Object.defineProperty(Z_.prototype,"filter",{get:function(){return this._filters?this._filters[0]:null},set:function(t){t?this._filters?this._filters[0]=t:this._filters=[t]:this._filters=null},enumerable:!1,configurable:!0}),Z_.prototype.reset=function(){this.pooled&&(this.maskObject=null,this.type=nt.MASK_TYPES.NONE,this.autoDetect=!0),this._target=null,this._scissorRectLocal=null},Z_.prototype.copyCountersOrReset=function(t){t?(this._stencilCounter=t._stencilCounter,this._scissorCounter=t._scissorCounter,this._scissorRect=t._scissorRect):(this._stencilCounter=0,this._scissorCounter=0,this._scissorRect=null)},Z_);function Z_(t){void 0===t&&(t=null),this.type=nt.MASK_TYPES.NONE,this.autoDetect=!0,this.maskObject=t||null,this.pooled=!1,this.isMaskData=!0,this.resolution=null,this.multisample=Tt.FILTER_MULTISAMPLE,this.enabled=!0,this._filters=null,this._stencilCounter=0,this._scissorCounter=0,this._scissorRect=null,this._scissorRectLocal=null,this._target=null}function tv(t){this.renderer=t,this._activeGeometry=null,this._activeVao=null,this.hasVao=!0,this.hasInstance=!0,this.canUseUInt32ElementIndex=!1,this.managedGeometries={}}function ev(t){this.renderer=t,this.managedFramebuffers=[],this.unknownFramebuffer=new c_(10,10),this.msaaSamples=null}function iv(t){this.renderer=t,this.webGLVersion=1,this.extensions={},this.supports={uint32Indices:!1},this.handleContextLost=this.handleContextLost.bind(this),this.handleContextRestored=this.handleContextRestored.bind(this),t.view.addEventListener("webglcontextlost",this.handleContextLost,!1),t.view.addEventListener("webglcontextrestored",this.handleContextRestored,!1)}function nv(t){this.renderer=t,this.emptyRenderer=new X_(t),this.currentRenderer=this.emptyRenderer}function rv(t){this.renderer=t}function sv(t){this.renderer=t,this.defaultFilterStack=[{}],this.texturePool=new C_,this.texturePool.setScreenSize(t.view),this.statePool=[],this.quad=new F_,this.quadUv=new N_,this.tempRect=new iy,this.activeState={},this.globalUniforms=new U_({outputFrame:new iy,inputSize:new Float32Array(4),inputPixel:new Float32Array(4),inputClamp:new Float32Array(4),resolution:1,filterArea:new Float32Array(4),filterClamp:new Float32Array(4)},!0),this.forceClear=!1,this.useMaxPadding=!1}function ov(){this.renderTexture=null,this.target=null,this.legacy=!1,this.resolution=1,this.multisample=nt.MSAA_QUALITY.NONE,this.sourceFrame=new iy,this.destinationFrame=new iy,this.bindingSourceFrame=new iy,this.bindingDestinationFrame=new iy,this.filters=[],this.transform=null}function av(t,e,i){this.group=!0,this.syncUniforms={},this.dirtyId=0,this.id=L_++,this.static=!!e,this.ubo=!!i,t instanceof M_?(this.buffer=t,this.buffer.type=nt.BUFFER_TYPE.UNIFORM_BUFFER,this.autoManage=!1,this.ubo=!0):(this.uniforms=t,this.ubo&&(this.buffer=new M_(new Float32Array(1)),this.buffer.type=nt.BUFFER_TYPE.UNIFORM_BUFFER,this.autoManage=!0))}function lv(){var t=x_.call(this)||this;return t.vertices=new Float32Array([-1,-1,1,-1,1,1,-1,1]),t.uvs=new Float32Array([0,0,1,0,1,1,0,1]),t.vertexBuffer=new M_(t.vertices),t.uvBuffer=new M_(t.uvs),t.addAttribute("aVertexPosition",t.vertexBuffer).addAttribute("aTextureCoord",t.uvBuffer).addIndex([0,1,2,0,2,3]),t}function hv(){var t=T_.call(this)||this;return t.addAttribute("aVertexPosition",new Float32Array([0,0,1,0,1,1,0,1])).addIndex([0,1,3,2]),t}function uv(t,e){void 0===t&&(t=[]),void 0===e&&(e={}),this.buffers=t,this.indexBuffer=null,this.attributes=e,this.glVertexArrayObjects={},this.id=O_++,this.instanced=!1,this.instanceCount=1,this.disposeRunner=new Ym("disposeGeometry"),this.refCount=0}function cv(t,e,i){void 0===e&&(e=!0),void 0===i&&(i=!1),this.data=t||new Float32Array(1),this._glBuffers={},this._updateID=0,this.index=i,this.static=e,this.id=A_++,this.disposeRunner=new Ym("disposeBuffer")}function dv(t,e,i,n,r,s,o){void 0===e&&(e=0),void 0===i&&(i=!1),void 0===n&&(n=nt.TYPES.FLOAT),this.buffer=t,this.size=e,this.normalized=i,this.type=n,this.stride=r,this.start=s,this.instance=o}function pv(t){this.texturePool={},this.textureOptions=t||{},this.enableFullScreen=!1,this._pixelsWidth=0,this._pixelsHeight=0}function fv(t,e){var i=I_.call(this,t,e)||this;return i.valid=!0,i.filterFrame=null,i.filterPoolKey=null,i.updateUvs(),i}function gv(t,e,i){var n=t.createShader(e);return t.shaderSource(n,i),t.compileShader(n),n}function mv(t,e){var i=t.getShaderSource(e).split("\n").map(function(t,e){return e+": "+t}),n=t.getShaderInfoLog(e),r=n.split("\n"),s={},o=r.map(function(t){return parseFloat(t.replace(/^ERROR\: 0\:([\d]+)\:.*$/,"$1"))}).filter(function(t){return!(!t||s[t]||(s[t]=!0,0))}),a=[""];o.forEach(function(t){i[t-1]="%c"+i[t-1]+"%c",a.push("background: #FF0000; color:#FFFFFF; font-size: 10px","font-size: 10px")});var l=i.join("\n");a[0]=l,console.error(n),console.groupCollapsed("click to view full shader code"),console.warn.apply(console,a),console.groupEnd()}function yv(t){for(var e=new Array(t),i=0;i<e.length;i++)e[i]=!1;return e}function _v(t,e){switch(t){case"float":return 0;case"vec2":return new Float32Array(2*e);case"vec3":return new Float32Array(3*e);case"vec4":return new Float32Array(4*e);case"int":case"uint":case"sampler2D":case"sampler2DArray":return 0;case"ivec2":return new Int32Array(2*e);case"ivec3":return new Int32Array(3*e);case"ivec4":return new Int32Array(4*e);case"uvec2":return new Uint32Array(2*e);case"uvec3":return new Uint32Array(3*e);case"uvec4":return new Uint32Array(4*e);case"bool":return!1;case"bvec2":return yv(2*e);case"bvec3":return yv(3*e);case"bvec4":return yv(4*e);case"mat2":return new Float32Array([1,0,0,1]);case"mat3":return new Float32Array([1,0,0,0,1,0,0,0,1]);case"mat4":return new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}return null}var vv,bv={},wv=bv;function Sv(t,e,i){if("precision"===t.substring(0,9))return i!==nt.PRECISION.HIGH&&"precision highp"===t.substring(0,15)?t.replace("precision highp","precision mediump"):t;var n=e;return e===nt.PRECISION.HIGH&&i!==nt.PRECISION.HIGH&&(n=nt.PRECISION.MEDIUM),"precision "+n+" float;\n"+t}var xv={float:1,vec2:2,vec3:3,vec4:4,int:1,ivec2:2,ivec3:3,ivec4:4,uint:1,uvec2:2,uvec3:3,uvec4:4,bool:1,bvec2:2,bvec3:3,bvec4:4,mat2:4,mat3:9,mat4:16,sampler2D:1};function Tv(t){return xv[t]}var Iv=null,Pv={FLOAT:"float",FLOAT_VEC2:"vec2",FLOAT_VEC3:"vec3",FLOAT_VEC4:"vec4",INT:"int",INT_VEC2:"ivec2",INT_VEC3:"ivec3",INT_VEC4:"ivec4",UNSIGNED_INT:"uint",UNSIGNED_INT_VEC2:"uvec2",UNSIGNED_INT_VEC3:"uvec3",UNSIGNED_INT_VEC4:"uvec4",BOOL:"bool",BOOL_VEC2:"bvec2",BOOL_VEC3:"bvec3",BOOL_VEC4:"bvec4",FLOAT_MAT2:"mat2",FLOAT_MAT3:"mat3",FLOAT_MAT4:"mat4",SAMPLER_2D:"sampler2D",INT_SAMPLER_2D:"sampler2D",UNSIGNED_INT_SAMPLER_2D:"sampler2D",SAMPLER_CUBE:"samplerCube",INT_SAMPLER_CUBE:"samplerCube",UNSIGNED_INT_SAMPLER_CUBE:"samplerCube",SAMPLER_2D_ARRAY:"sampler2DArray",INT_SAMPLER_2D_ARRAY:"sampler2DArray",UNSIGNED_INT_SAMPLER_2D_ARRAY:"sampler2DArray"};function Cv(t,e){if(!Iv){var i=Object.keys(Pv);Iv={};for(var n=0;n<i.length;++n){var r=i[n];Iv[t[r]]=Pv[r]}}return Iv[e]}var Ev,Av=[{test:function(t){return"float"===t.type&&1===t.size},code:function(t){return'\n            if(uv["'+t+'"] !== ud["'+t+'"].value)\n            {\n                ud["'+t+'"].value = uv["'+t+'"]\n                gl.uniform1f(ud["'+t+'"].location, uv["'+t+'"])\n            }\n            '}},{test:function(t){return("sampler2D"===t.type||"samplerCube"===t.type||"sampler2DArray"===t.type)&&1===t.size&&!t.isArray},code:function(t){return't = syncData.textureCount++;\n\n            renderer.texture.bind(uv["'+t+'"], t);\n\n            if(ud["'+t+'"].value !== t)\n            {\n                ud["'+t+'"].value = t;\n                gl.uniform1i(ud["'+t+'"].location, t);\n; // eslint-disable-line max-len\n            }'}},{test:function(t,e){return"mat3"===t.type&&1===t.size&&void 0!==e.a},code:function(t){return'\n            gl.uniformMatrix3fv(ud["'+t+'"].location, false, uv["'+t+'"].toArray(true));\n            '},codeUbo:function(t){return"\n                var "+t+"_matrix = uv."+t+".toArray(true);\n\n                data[offset] = "+t+"_matrix[0];\n                data[offset+1] = "+t+"_matrix[1];\n                data[offset+2] = "+t+"_matrix[2];\n        \n                data[offset + 4] = "+t+"_matrix[3];\n                data[offset + 5] = "+t+"_matrix[4];\n                data[offset + 6] = "+t+"_matrix[5];\n        \n                data[offset + 8] = "+t+"_matrix[6];\n                data[offset + 9] = "+t+"_matrix[7];\n                data[offset + 10] = "+t+"_matrix[8];\n            "}},{test:function(t,e){return"vec2"===t.type&&1===t.size&&void 0!==e.x},code:function(t){return'\n                cv = ud["'+t+'"].value;\n                v = uv["'+t+'"];\n\n                if(cv[0] !== v.x || cv[1] !== v.y)\n                {\n                    cv[0] = v.x;\n                    cv[1] = v.y;\n                    gl.uniform2f(ud["'+t+'"].location, v.x, v.y);\n                }'},codeUbo:function(t){return"\n                v = uv."+t+";\n\n                data[offset] = v.x;\n                data[offset+1] = v.y;\n            "}},{test:function(t){return"vec2"===t.type&&1===t.size},code:function(t){return'\n                cv = ud["'+t+'"].value;\n                v = uv["'+t+'"];\n\n                if(cv[0] !== v[0] || cv[1] !== v[1])\n                {\n                    cv[0] = v[0];\n                    cv[1] = v[1];\n                    gl.uniform2f(ud["'+t+'"].location, v[0], v[1]);\n                }\n            '}},{test:function(t,e){return"vec4"===t.type&&1===t.size&&void 0!==e.width},code:function(t){return'\n                cv = ud["'+t+'"].value;\n                v = uv["'+t+'"];\n\n                if(cv[0] !== v.x || cv[1] !== v.y || cv[2] !== v.width || cv[3] !== v.height)\n                {\n                    cv[0] = v.x;\n                    cv[1] = v.y;\n                    cv[2] = v.width;\n                    cv[3] = v.height;\n                    gl.uniform4f(ud["'+t+'"].location, v.x, v.y, v.width, v.height)\n                }'},codeUbo:function(t){return"\n                    v = uv."+t+";\n\n                    data[offset] = v.x;\n                    data[offset+1] = v.y;\n                    data[offset+2] = v.width;\n                    data[offset+3] = v.height;\n                "}},{test:function(t){return"vec4"===t.type&&1===t.size},code:function(t){return'\n                cv = ud["'+t+'"].value;\n                v = uv["'+t+'"];\n\n                if(cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])\n                {\n                    cv[0] = v[0];\n                    cv[1] = v[1];\n                    cv[2] = v[2];\n                    cv[3] = v[3];\n\n                    gl.uniform4f(ud["'+t+'"].location, v[0], v[1], v[2], v[3])\n                }'}}],Mv={float:"\n    if (cv !== v)\n    {\n        cu.value = v;\n        gl.uniform1f(location, v);\n    }",vec2:"\n    if (cv[0] !== v[0] || cv[1] !== v[1])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n\n        gl.uniform2f(location, v[0], v[1])\n    }",vec3:"\n    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n        cv[2] = v[2];\n\n        gl.uniform3f(location, v[0], v[1], v[2])\n    }",vec4:"\n    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n        cv[2] = v[2];\n        cv[3] = v[3];\n\n        gl.uniform4f(location, v[0], v[1], v[2], v[3]);\n    }",int:"\n    if (cv !== v)\n    {\n        cu.value = v;\n\n        gl.uniform1i(location, v);\n    }",ivec2:"\n    if (cv[0] !== v[0] || cv[1] !== v[1])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n\n        gl.uniform2i(location, v[0], v[1]);\n    }",ivec3:"\n    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n        cv[2] = v[2];\n\n        gl.uniform3i(location, v[0], v[1], v[2]);\n    }",ivec4:"\n    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n        cv[2] = v[2];\n        cv[3] = v[3];\n\n        gl.uniform4i(location, v[0], v[1], v[2], v[3]);\n    }",uint:"\n    if (cv !== v)\n    {\n        cu.value = v;\n\n        gl.uniform1ui(location, v);\n    }",uvec2:"\n    if (cv[0] !== v[0] || cv[1] !== v[1])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n\n        gl.uniform2ui(location, v[0], v[1]);\n    }",uvec3:"\n    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n        cv[2] = v[2];\n\n        gl.uniform3ui(location, v[0], v[1], v[2]);\n    }",uvec4:"\n    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n        cv[2] = v[2];\n        cv[3] = v[3];\n\n        gl.uniform4ui(location, v[0], v[1], v[2], v[3]);\n    }",bool:"\n    if (cv !== v)\n    {\n        cu.value = v;\n        gl.uniform1i(location, v);\n    }",bvec2:"\n    if (cv[0] != v[0] || cv[1] != v[1])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n\n        gl.uniform2i(location, v[0], v[1]);\n    }",bvec3:"\n    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n        cv[2] = v[2];\n\n        gl.uniform3i(location, v[0], v[1], v[2]);\n    }",bvec4:"\n    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n        cv[2] = v[2];\n        cv[3] = v[3];\n\n        gl.uniform4i(location, v[0], v[1], v[2], v[3]);\n    }",mat2:"gl.uniformMatrix2fv(location, false, v)",mat3:"gl.uniformMatrix3fv(location, false, v)",mat4:"gl.uniformMatrix4fv(location, false, v)",sampler2D:"gl.uniform1i(location, v)",samplerCube:"gl.uniform1i(location, v)",sampler2DArray:"gl.uniform1i(location, v)"},Bv={float:"gl.uniform1fv(location, v)",vec2:"gl.uniform2fv(location, v)",vec3:"gl.uniform3fv(location, v)",vec4:"gl.uniform4fv(location, v)",mat4:"gl.uniformMatrix4fv(location, false, v)",mat3:"gl.uniformMatrix3fv(location, false, v)",mat2:"gl.uniformMatrix2fv(location, false, v)",int:"gl.uniform1iv(location, v)",ivec2:"gl.uniform2iv(location, v)",ivec3:"gl.uniform3iv(location, v)",ivec4:"gl.uniform4iv(location, v)",uint:"gl.uniform1uiv(location, v)",uvec2:"gl.uniform2uiv(location, v)",uvec3:"gl.uniform3uiv(location, v)",uvec4:"gl.uniform4uiv(location, v)",bool:"gl.uniform1iv(location, v)",bvec2:"gl.uniform2iv(location, v)",bvec3:"gl.uniform3iv(location, v)",bvec4:"gl.uniform4iv(location, v)",sampler2D:"gl.uniform1iv(location, v)",samplerCube:"gl.uniform1iv(location, v)",sampler2DArray:"gl.uniform1iv(location, v)"},Rv=["precision mediump float;","void main(void){","float test = 0.1;","%forloop%","gl_FragColor = vec4(0.0);","}"].join("\n");function Ov(t){for(var e="",i=0;i<t;++i)0<i&&(e+="\nelse "),i<t-1&&(e+="if(test == "+i+".0){}");return e}var kv,Dv,Fv,Nv,Lv=0,Uv={},zv=(Object.defineProperty(pb,"defaultVertexSrc",{get:function(){return"attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void){\n   gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n   vTextureCoord = aTextureCoord;\n}\n"},enumerable:!1,configurable:!0}),Object.defineProperty(pb,"defaultFragmentSrc",{get:function(){return"varying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\n\nvoid main(void){\n   gl_FragColor *= texture2D(uSampler, vTextureCoord);\n}"},enumerable:!1,configurable:!0}),pb.from=function(t,e,i){var n=t+e,r=zm[n];return r||(zm[n]=r=new pb(t,e,i)),r},pb),Wv=(db.prototype.checkUniformExists=function(t,e){if(e.uniforms[t])return!0;for(var i in e.uniforms){var n=e.uniforms[i];if(n.group&&this.checkUniformExists(t,n))return!0}return!1},db.prototype.destroy=function(){this.uniformGroup=null},Object.defineProperty(db.prototype,"uniforms",{get:function(){return this.uniformGroup.uniforms},enumerable:!1,configurable:!0}),db.from=function(t,e,i){return new db(zv.from(t,e),i)},db),Gv=(Object.defineProperty(cb.prototype,"blend",{get:function(){return!!(1&this.data)},set:function(t){!!(1&this.data)!==t&&(this.data^=1)},enumerable:!1,configurable:!0}),Object.defineProperty(cb.prototype,"offsets",{get:function(){return!!(2&this.data)},set:function(t){!!(2&this.data)!==t&&(this.data^=2)},enumerable:!1,configurable:!0}),Object.defineProperty(cb.prototype,"culling",{get:function(){return!!(4&this.data)},set:function(t){!!(4&this.data)!==t&&(this.data^=4)},enumerable:!1,configurable:!0}),Object.defineProperty(cb.prototype,"depthTest",{get:function(){return!!(8&this.data)},set:function(t){!!(8&this.data)!==t&&(this.data^=8)},enumerable:!1,configurable:!0}),Object.defineProperty(cb.prototype,"depthMask",{get:function(){return!!(32&this.data)},set:function(t){!!(32&this.data)!==t&&(this.data^=32)},enumerable:!1,configurable:!0}),Object.defineProperty(cb.prototype,"clockwiseFrontFace",{get:function(){return!!(16&this.data)},set:function(t){!!(16&this.data)!==t&&(this.data^=16)},enumerable:!1,configurable:!0}),Object.defineProperty(cb.prototype,"blendMode",{get:function(){return this._blendMode},set:function(t){this.blend=t!==nt.BLEND_MODES.NONE,this._blendMode=t},enumerable:!1,configurable:!0}),Object.defineProperty(cb.prototype,"polygonOffset",{get:function(){return this._polygonOffset},set:function(t){this.offsets=!!t,this._polygonOffset=t},enumerable:!1,configurable:!0}),cb.prototype.toString=function(){return"[@pixi/core:State blendMode="+this.blendMode+" clockwiseFrontFace="+this.clockwiseFrontFace+" culling="+this.culling+" depthMask="+this.depthMask+" polygonOffset="+this.polygonOffset+"]"},cb.for2d=function(){var t=new cb;return t.depthTest=!1,t.blend=!0,t},cb),Hv=(Sy(ub,Nv=Wv),ub.prototype.apply=function(t,e,i,n,r){t.applyFilter(this,e,i,n)},Object.defineProperty(ub.prototype,"blendMode",{get:function(){return this.state.blendMode},set:function(t){this.state.blendMode=t},enumerable:!1,configurable:!0}),Object.defineProperty(ub.prototype,"resolution",{get:function(){return this._resolution},set:function(t){this._resolution=t},enumerable:!1,configurable:!0}),Object.defineProperty(ub,"defaultVertexSrc",{get:function(){return"attribute vec2 aVertexPosition;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nuniform vec4 inputSize;\nuniform vec4 outputFrame;\n\nvec4 filterVertexPosition( void )\n{\n    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;\n\n    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);\n}\n\nvec2 filterTextureCoord( void )\n{\n    return aVertexPosition * (outputFrame.zw * inputSize.zw);\n}\n\nvoid main(void)\n{\n    gl_Position = filterVertexPosition();\n    vTextureCoord = filterTextureCoord();\n}\n"},enumerable:!1,configurable:!0}),Object.defineProperty(ub,"defaultFragmentSrc",{get:function(){return"varying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\n\nvoid main(void){\n   gl_FragColor = texture2D(uSampler, vTextureCoord);\n}\n"},enumerable:!1,configurable:!0}),ub),Xv=new sy,jv=(Object.defineProperty(hb.prototype,"texture",{get:function(){return this._texture},set:function(t){this._texture=t,this._textureID=-1},enumerable:!1,configurable:!0}),hb.prototype.multiplyUvs=function(t,e){void 0===e&&(e=t);for(var i=this.mapCoord,n=0;n<t.length;n+=2){var r=t[n],s=t[n+1];e[n]=r*i.a+s*i.c+i.tx,e[n+1]=r*i.b+s*i.d+i.ty}return e},hb.prototype.update=function(t){var e=this._texture;if(!e||!e.valid)return!1;if(!t&&this._textureID===e._updateID)return!1;this._textureID=e._updateID,this._updateID++;var i=e._uvs;this.mapCoord.set(i.x1-i.x0,i.y1-i.y0,i.x3-i.x0,i.y3-i.y0,i.x0,i.y0);var n=e.orig,r=e.trim;r&&(Xv.set(n.width/r.width,0,0,n.height/r.height,-r.x/r.width,-r.y/r.height),this.mapCoord.append(Xv));var s=e.baseTexture,o=this.uClampFrame,a=this.clampMargin/s.resolution,l=this.clampOffset;return o[0]=(e._frame.x+a+l)/s.width,o[1]=(e._frame.y+a+l)/s.height,o[2]=(e._frame.x+e._frame.width-a+l)/s.width,o[3]=(e._frame.y+e._frame.height-a+l)/s.height,this.uClampOffset[0]=l/s.realWidth,this.uClampOffset[1]=l/s.realHeight,this.isSimple=e._frame.width===s.width&&e._frame.height===s.height&&0===e.rotate,!0},hb),Vv=(Sy(lb,Fv=Hv),Object.defineProperty(lb.prototype,"maskSprite",{get:function(){return this._maskSprite},set:function(t){this._maskSprite=t,this._maskSprite&&(this._maskSprite.renderable=!1)},enumerable:!1,configurable:!0}),lb.prototype.apply=function(t,e,i,n){var r=this._maskSprite,s=r._texture;s.valid&&(s.uvMatrix||(s.uvMatrix=new jv(s,0)),s.uvMatrix.update(),this.uniforms.npmAlpha=s.baseTexture.alphaMode?0:1,this.uniforms.mask=s,this.uniforms.otherMatrix=t.calculateSpriteMatrix(this.maskMatrix,r).prepend(s.uvMatrix.mapCoord),this.uniforms.alpha=r.worldAlpha,this.uniforms.maskClamp=s.uvMatrix.uClampFrame,t.applyFilter(this,e,i,n))},lb),Yv=(ab.prototype.setMaskStack=function(t){this.maskStack=t,this.renderer.scissor.setMaskStack(t),this.renderer.stencil.setMaskStack(t)},ab.prototype.push=function(t,e){var i=e;if(!i.isMaskData){var n=this.maskDataPool.pop()||new J_;n.pooled=!0,n.maskObject=e,i=n}var r=0!==this.maskStack.length?this.maskStack[this.maskStack.length-1]:null;if(i.copyCountersOrReset(r),i.autoDetect&&this.detect(i),i._target=t,i.type!==nt.MASK_TYPES.SPRITE&&this.maskStack.push(i),i.enabled)switch(i.type){case nt.MASK_TYPES.SCISSOR:this.renderer.scissor.push(i);break;case nt.MASK_TYPES.STENCIL:this.renderer.stencil.push(i);break;case nt.MASK_TYPES.SPRITE:i.copyCountersOrReset(null),this.pushSpriteMask(i)}i.type===nt.MASK_TYPES.SPRITE&&this.maskStack.push(i)},ab.prototype.pop=function(t){var e=this.maskStack.pop();if(e&&e._target===t){if(e.enabled)switch(e.type){case nt.MASK_TYPES.SCISSOR:this.renderer.scissor.pop();break;case nt.MASK_TYPES.STENCIL:this.renderer.stencil.pop(e.maskObject);break;case nt.MASK_TYPES.SPRITE:this.popSpriteMask(e)}if(e.reset(),e.pooled&&this.maskDataPool.push(e),0!==this.maskStack.length){var i=this.maskStack[this.maskStack.length-1];i.type===nt.MASK_TYPES.SPRITE&&i._filters&&(i._filters[0].maskSprite=i.maskObject)}}},ab.prototype.detect=function(t){t.maskObject.isSprite?t.type=nt.MASK_TYPES.SPRITE:this.enableScissor&&this.renderer.scissor.testScissor(t)?t.type=nt.MASK_TYPES.SCISSOR:t.type=nt.MASK_TYPES.STENCIL},ab.prototype.pushSpriteMask=function(t){var e,i,n=t.maskObject,r=t._target,s=t._filters;(s=s||this.alphaMaskPool[this.alphaMaskIndex])||(s=this.alphaMaskPool[this.alphaMaskIndex]=[new Vv]);var o,a,l=this.renderer,h=l.renderTexture;if(h.current){var u=h.current;o=t.resolution||u.resolution,a=null!==(e=t.multisample)&&void 0!==e?e:u.multisample}else o=t.resolution||l.resolution,a=null!==(i=t.multisample)&&void 0!==i?i:l.multisample;s[0].resolution=o,s[0].multisample=a,s[0].maskSprite=n;var c=r.filterArea;r.filterArea=n.getBounds(!0),l.filter.push(r,s),r.filterArea=c,t._filters||this.alphaMaskIndex++},ab.prototype.popSpriteMask=function(t){this.renderer.filter.pop(),t._filters?t._filters[0].maskSprite=null:(this.alphaMaskIndex--,this.alphaMaskPool[this.alphaMaskIndex][0].maskSprite=null)},ab.prototype.destroy=function(){this.renderer=null},ab),qv=(ob.prototype.getStackLength=function(){return this.maskStack.length},ob.prototype.setMaskStack=function(t){var e=this.renderer.gl,i=this.getStackLength();this.maskStack=t;var n=this.getStackLength();n!==i&&(0===n?e.disable(this.glConst):(e.enable(this.glConst),this._useCurrent()))},ob.prototype._useCurrent=function(){},ob.prototype.destroy=function(){this.renderer=null,this.maskStack=null},ob),Kv=new sy,$v=(Sy(sb,Dv=qv),sb.prototype.getStackLength=function(){var t=this.maskStack[this.maskStack.length-1];return t?t._scissorCounter:0},sb.prototype.calcScissorRect=function(t){if(!t._scissorRectLocal){var e=t._scissorRect,i=t.maskObject,n=this.renderer,r=n.renderTexture;i.renderable=!0;var s=i.getBounds();this.roundFrameToPixels(s,r.current?r.current.resolution:n.resolution,r.sourceFrame,r.destinationFrame,n.projection.transform),i.renderable=!1,e&&s.fit(e),t._scissorRectLocal=s}},sb.isMatrixRotated=function(t){if(!t)return!1;var e=t.a,i=t.b,n=t.c,r=t.d;return(1e-4<Math.abs(i)||1e-4<Math.abs(n))&&(1e-4<Math.abs(e)||1e-4<Math.abs(r))},sb.prototype.testScissor=function(t){var e=t.maskObject;if(!e.isFastRect||!e.isFastRect())return!1;if(sb.isMatrixRotated(e.worldTransform))return!1;if(sb.isMatrixRotated(this.renderer.projection.transform))return!1;this.calcScissorRect(t);var i=t._scissorRectLocal;return 0<i.width&&0<i.height},sb.prototype.roundFrameToPixels=function(t,e,i,n,r){sb.isMatrixRotated(r)||((r=r?Kv.copyFrom(r):Kv.identity()).translate(-i.x,-i.y).scale(n.width/i.width,n.height/i.height).translate(n.x,n.y),this.renderer.filter.transformAABB(r,t),t.fit(n),t.x=Math.round(t.x*e),t.y=Math.round(t.y*e),t.width=Math.round(t.width*e),t.height=Math.round(t.height*e))},sb.prototype.push=function(t){t._scissorRectLocal||this.calcScissorRect(t);var e=this.renderer.gl;t._scissorRect||e.enable(e.SCISSOR_TEST),t._scissorCounter++,t._scissorRect=t._scissorRectLocal,this._useCurrent()},sb.prototype.pop=function(){var t=this.renderer.gl;0<this.getStackLength()?this._useCurrent():t.disable(t.SCISSOR_TEST)},sb.prototype._useCurrent=function(){var t,e=this.maskStack[this.maskStack.length-1]._scissorRect;t=this.renderer.renderTexture.current?e.y:this.renderer.height-e.height-e.y,this.renderer.gl.scissor(e.x,t,e.width,e.height)},sb),Qv=(Sy(rb,kv=qv),rb.prototype.getStackLength=function(){var t=this.maskStack[this.maskStack.length-1];return t?t._stencilCounter:0},rb.prototype.push=function(t){var e=t.maskObject,i=this.renderer.gl,n=t._stencilCounter;0===n&&(this.renderer.framebuffer.forceStencil(),i.clearStencil(0),i.clear(i.STENCIL_BUFFER_BIT),i.enable(i.STENCIL_TEST)),t._stencilCounter++,i.colorMask(!1,!1,!1,!1),i.stencilFunc(i.EQUAL,n,4294967295),i.stencilOp(i.KEEP,i.KEEP,i.INCR),e.renderable=!0,e.render(this.renderer),this.renderer.batch.flush(),e.renderable=!1,this._useCurrent()},rb.prototype.pop=function(t){var e=this.renderer.gl;0===this.getStackLength()?e.disable(e.STENCIL_TEST):(e.colorMask(!1,!1,!1,!1),e.stencilOp(e.KEEP,e.KEEP,e.DECR),t.renderable=!0,t.render(this.renderer),this.renderer.batch.flush(),t.renderable=!1,this._useCurrent())},rb.prototype._useCurrent=function(){var t=this.renderer.gl;t.colorMask(!0,!0,!0,!0),t.stencilFunc(t.EQUAL,this.getStackLength(),4294967295),t.stencilOp(t.KEEP,t.KEEP,t.KEEP)},rb),Jv=(nb.prototype.update=function(t,e,i,n){this.destinationFrame=t||this.destinationFrame||this.defaultFrame,this.sourceFrame=e||this.sourceFrame||t,this.calculateProjection(this.destinationFrame,this.sourceFrame,i,n),this.transform&&this.projectionMatrix.append(this.transform);var r=this.renderer;r.globalUniforms.uniforms.projectionMatrix=this.projectionMatrix,r.globalUniforms.update(),r.shader.shader&&r.shader.syncUniformGroup(r.shader.shader.uniforms.globals)},nb.prototype.calculateProjection=function(t,e,i,n){var r=this.projectionMatrix,s=n?-1:1;r.identity(),r.a=1/e.width*2,r.d=s*(1/e.height*2),r.tx=-1-e.x*r.a,r.ty=-s-e.y*r.d},nb.prototype.setTransform=function(t){},nb.prototype.destroy=function(){this.renderer=null},nb),Zv=new iy,tb=new iy,eb=(ib.prototype.bind=function(t,e,i){void 0===t&&(t=null);var n,r,s,o=this.renderer;(this.current=t)?(s=(n=t.baseTexture).resolution,e||(Zv.width=t.frame.width,Zv.height=t.frame.height,e=Zv),i||(tb.x=t.frame.x,tb.y=t.frame.y,tb.width=e.width,tb.height=e.height,i=tb),r=n.framebuffer):(s=o.resolution,e||(Zv.width=o.screen.width,Zv.height=o.screen.height,e=Zv),i||((i=Zv).width=e.width,i.height=e.height));var a=this.viewportFrame;a.x=i.x*s,a.y=i.y*s,a.width=i.width*s,a.height=i.height*s,t||(a.y=o.view.height-(a.y+a.height)),a.ceil(),this.renderer.framebuffer.bind(r,a),this.renderer.projection.update(i,e,s,!r),t?this.renderer.mask.setMaskStack(n.maskStack):this.renderer.mask.setMaskStack(this.defaultMaskStack),this.sourceFrame.copyFrom(e),this.destinationFrame.copyFrom(i)},ib.prototype.clear=function(t,e){t=this.current?t||this.current.baseTexture.clearColor:t||this.clearColor;var i=this.destinationFrame,n=this.current?this.current.baseTexture:this.renderer.screen,r=i.width!==n.width||i.height!==n.height;if(r){var s=this.viewportFrame,o=s.x,a=s.y,l=s.width,h=s.height;o=Math.round(o),a=Math.round(a),l=Math.round(l),h=Math.round(h),this.renderer.gl.enable(this.renderer.gl.SCISSOR_TEST),this.renderer.gl.scissor(o,a,l,h)}this.renderer.framebuffer.clear(t[0],t[1],t[2],t[3],e),r&&this.renderer.scissor.pop()},ib.prototype.resize=function(){this.bind(null)},ib.prototype.reset=function(){this.bind(null)},ib.prototype.destroy=function(){this.renderer=null},ib);function ib(t){this.renderer=t,this.clearColor=t._backgroundColorRgba,this.defaultMaskStack=[],this.current=null,this.sourceFrame=new iy,this.destinationFrame=new iy,this.viewportFrame=new iy}function nb(t){this.renderer=t,this.destinationFrame=null,this.sourceFrame=null,this.defaultFrame=null,this.projectionMatrix=new sy,this.transform=null}function rb(t){var e=kv.call(this,t)||this;return e.glConst=WebGLRenderingContext.STENCIL_TEST,e}function sb(t){var e=Dv.call(this,t)||this;return e.glConst=WebGLRenderingContext.SCISSOR_TEST,e}function ob(t){this.renderer=t,this.maskStack=[],this.glConst=0}function ab(t){this.renderer=t,this.enableScissor=!0,this.alphaMaskPool=[],this.maskDataPool=[],this.maskStack=[],this.alphaMaskIndex=0}function lb(t,e,i){var n=this,r=null;return"string"!=typeof t&&void 0===e&&void 0===i&&(r=t,i=e=t=void 0),(n=Fv.call(this,t||"attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\nuniform mat3 otherMatrix;\n\nvarying vec2 vMaskCoord;\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = aTextureCoord;\n    vMaskCoord = ( otherMatrix * vec3( aTextureCoord, 1.0)  ).xy;\n}\n",e||"varying vec2 vMaskCoord;\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform sampler2D mask;\nuniform float alpha;\nuniform float npmAlpha;\nuniform vec4 maskClamp;\n\nvoid main(void)\n{\n    float clip = step(3.5,\n        step(maskClamp.x, vMaskCoord.x) +\n        step(maskClamp.y, vMaskCoord.y) +\n        step(vMaskCoord.x, maskClamp.z) +\n        step(vMaskCoord.y, maskClamp.w));\n\n    vec4 original = texture2D(uSampler, vTextureCoord);\n    vec4 masky = texture2D(mask, vMaskCoord);\n    float alphaMul = 1.0 - npmAlpha * (1.0 - masky.a);\n\n    original *= (alphaMul * masky.r * alpha * clip);\n\n    gl_FragColor = original;\n}\n",i)||this).maskSprite=r,n.maskMatrix=new sy,n}function hb(t,e){this._texture=t,this.mapCoord=new sy,this.uClampFrame=new Float32Array(4),this.uClampOffset=new Float32Array(2),this._textureID=-1,this._updateID=0,this.clampOffset=0,this.clampMargin=void 0===e?.5:e,this.isSimple=!1}function ub(t,e,i){var n=this,r=zv.from(t||ub.defaultVertexSrc,e||ub.defaultFragmentSrc);return(n=Nv.call(this,r,i)||this).padding=0,n.resolution=Tt.FILTER_RESOLUTION,n.multisample=Tt.FILTER_MULTISAMPLE,n.enabled=!0,n.autoFit=!0,n.state=new Gv,n}function cb(){this.data=0,this.blendMode=nt.BLEND_MODES.NORMAL,this.polygonOffset=0,this.blend=!0,this.depthMask=!0}function db(t,e){this.uniformBindCount=0,this.program=t,this.uniformGroup=e?e instanceof U_?e:new U_(e):new U_({})}function pb(t,e,i){void 0===i&&(i="pixi-shader"),this.id=Lv++,this.vertexSrc=t||pb.defaultVertexSrc,this.fragmentSrc=e||pb.defaultFragmentSrc,this.vertexSrc=this.vertexSrc.trim(),this.fragmentSrc=this.fragmentSrc.trim(),"#version"!==this.vertexSrc.substring(0,8)&&(i=i.replace(/\s+/g,"-"),Uv[i]?(Uv[i]++,i+="-"+Uv[i]):Uv[i]=1,this.vertexSrc="#define SHADER_NAME "+i+"\n"+this.vertexSrc,this.fragmentSrc="#define SHADER_NAME "+i+"\n"+this.fragmentSrc,this.vertexSrc=Sv(this.vertexSrc,Tt.PRECISION_VERTEX,nt.PRECISION.HIGH),this.fragmentSrc=Sv(this.fragmentSrc,Tt.PRECISION_FRAGMENT,function(){if(!vv){vv=nt.PRECISION.MEDIUM;var t=function(){if(wv===bv||wv&&wv.isContextLost()){var t=document.createElement("canvas"),e=void 0;Tt.PREFER_ENV>=nt.ENV.WEBGL2&&(e=t.getContext("webgl2",{})),e||((e=t.getContext("webgl",{})||t.getContext("experimental-webgl",{}))?e.getExtension("WEBGL_draw_buffers"):e=null),wv=e}return wv}();if(t&&t.getShaderPrecisionFormat){var e=t.getShaderPrecisionFormat(t.FRAGMENT_SHADER,t.HIGH_FLOAT);vv=e.precision?nt.PRECISION.HIGH:nt.PRECISION.MEDIUM}}return vv}())),this.glPrograms={},this.syncUniforms=null}function fb(t,e,i,n,r){i.buffer.update(r)}var gb={float:"\n        data[offset] = v;\n    ",vec2:"\n        data[offset] = v[0];\n        data[offset+1] = v[1];\n    ",vec3:"\n        data[offset] = v[0];\n        data[offset+1] = v[1];\n        data[offset+2] = v[2];\n\n    ",vec4:"\n        data[offset] = v[0];\n        data[offset+1] = v[1];\n        data[offset+2] = v[2];\n        data[offset+3] = v[3];\n    ",mat2:"\n        data[offset] = v[0];\n        data[offset+1] = v[1];\n\n        data[offset+4] = v[2];\n        data[offset+5] = v[3];\n    ",mat3:"\n        data[offset] = v[0];\n        data[offset+1] = v[1];\n        data[offset+2] = v[2];\n\n        data[offset + 4] = v[3];\n        data[offset + 5] = v[4];\n        data[offset + 6] = v[5];\n\n        data[offset + 8] = v[6];\n        data[offset + 9] = v[7];\n        data[offset + 10] = v[8];\n    ",mat4:"\n        for(var i = 0; i < 16; i++)\n        {\n            data[offset + i] = v[i];\n        }\n    "},mb={float:4,vec2:8,vec3:12,vec4:16,int:4,ivec2:8,ivec3:12,ivec4:16,uint:4,uvec2:8,uvec3:12,uvec4:16,bool:4,bvec2:8,bvec3:12,bvec4:16,mat2:32,mat3:48,mat4:64},yb=(_b.prototype.destroy=function(){this.uniformData=null,this.uniformGroups=null,this.uniformDirtyGroups=null,this.uniformBufferBindings=null,this.program=null},_b);function _b(t,e){this.program=t,this.uniformData=e,this.uniformGroups={},this.uniformDirtyGroups={},this.uniformBufferBindings={}}function vb(t){this.texture=t,this.width=-1,this.height=-1,this.dirtyId=-1,this.dirtyStyleId=-1,this.mipmap=!1,this.wrapMode=33071,this.type=nt.TYPES.UNSIGNED_BYTE,this.internalFormat=nt.FORMATS.RGBA,this.samplerType=0}function bb(t){this.buffer=t||null,this.updateID=-1,this.byteLength=-1,this.refCount=0}function wb(t){Object.defineProperty(Xb,t,{get:function(){return Lm("6.0.0","PIXI.systems."+t+" has moved to PIXI."+t),h_[t]}})}var Sb,xb,Tb,Ib,Pb=0,Cb={textureCount:0,uboCount:0},Eb=(nw.prototype.systemCheck=function(){if(!function(){if("boolean"==typeof Ev)return Ev;try{var t=new Function("param1","param2","param3","return param1[param2] === param3;");Ev=!0===t({a:"b"},"a","b")}catch(t){Ev=!1}return Ev}())throw new Error("Current environment does not allow unsafe-eval, please use @pixi/unsafe-eval module to enable support.")},nw.prototype.contextChange=function(t){this.gl=t,this.reset()},nw.prototype.bind=function(t,e){t.uniforms.globals=this.renderer.globalUniforms;var i=t.program,n=i.glPrograms[this.renderer.CONTEXT_UID]||this.generateProgram(t);return this.shader=t,this.program!==i&&(this.program=i,this.gl.useProgram(n.program)),e||(Cb.textureCount=0,Cb.uboCount=0,this.syncUniformGroup(t.uniformGroup,Cb)),n},nw.prototype.setUniforms=function(t){var e=this.shader.program,i=e.glPrograms[this.renderer.CONTEXT_UID];e.syncUniforms(i.uniformData,t,this.renderer)},nw.prototype.syncUniformGroup=function(t,e){var i=this.getGlProgram();t.static&&t.dirtyId===i.uniformDirtyGroups[t.id]||(i.uniformDirtyGroups[t.id]=t.dirtyId,this.syncUniforms(t,i,e))},nw.prototype.syncUniforms=function(t,e,i){(t.syncUniforms[this.shader.program.id]||this.createSyncGroups(t))(e.uniformData,t.uniforms,this.renderer,i)},nw.prototype.createSyncGroups=function(t){var e=this.getSignature(t,this.shader.program.uniformData,"u");return this.cache[e]||(this.cache[e]=function(t,e){var i,n=["\n        var v = null;\n        var cv = null;\n        var cu = null;\n        var t = 0;\n        var gl = renderer.gl;\n    "];for(var r in t.uniforms){var s=e[r];if(s){for(var o=t.uniforms[r],a=!1,l=0;l<Av.length;l++)if(Av[l].test(s,o)){n.push(Av[l].code(r,o)),a=!0;break}if(!a){var h=(1===s.size?Mv:Bv)[s.type].replace("location",'ud["'+r+'"].location');n.push('\n            cu = ud["'+r+'"];\n            cv = cu.value;\n            v = uv["'+r+'"];\n            '+h+";")}}else(null===(i=t.uniforms[r])||void 0===i?void 0:i.group)&&(t.uniforms[r].ubo?n.push("\n                        renderer.shader.syncUniformBufferGroup(uv."+r+", '"+r+"');\n                    "):n.push("\n                        renderer.shader.syncUniformGroup(uv."+r+", syncData);\n                    "))}return new Function("ud","uv","renderer","syncData",n.join("\n"))}(t,this.shader.program.uniformData)),t.syncUniforms[this.shader.program.id]=this.cache[e],t.syncUniforms[this.shader.program.id]},nw.prototype.syncUniformBufferGroup=function(t,e){var i=this.getGlProgram();if(!t.static||0!==t.dirtyId||!i.uniformGroups[t.id]){t.dirtyId=0;var n=i.uniformGroups[t.id]||this.createSyncBufferGroup(t,i,e);t.buffer.update(),n(i.uniformData,t.uniforms,this.renderer,Cb,t.buffer)}this.renderer.buffer.bindBufferBase(t.buffer,i.uniformBufferBindings[e])},nw.prototype.createSyncBufferGroup=function(t,e,i){var n=this.renderer.gl;this.renderer.buffer.bind(t.buffer);var r=this.gl.getUniformBlockIndex(e.program,i);e.uniformBufferBindings[i]=this.shader.uniformBindCount,n.uniformBlockBinding(e.program,r,this.shader.uniformBindCount),this.shader.uniformBindCount++;var s=this.getSignature(t,this.shader.program.uniformData,"ubo"),o=this._uboCache[s];if(o=o||(this._uboCache[s]=function(a,l){if(!a.autoManage)return{size:0,syncFunc:fb};for(var t=function(){for(var t=function(t,e){var i=[];for(var n in t)e[n]&&i.push(e[n]);return i.sort(function(t,e){return t.index-e.index}),i}(a.uniforms,l).map(function(t){return{data:t,offset:0,dataLen:0,dirty:0}}),e=0,i=0,n=0,r=0;r<t.length;r++){var s=t[r];if(e=mb[s.data.type],1<s.data.size&&(e=Math.max(e,16)*s.data.size),i%(s.dataLen=e)!=0&&i<16){var o=i%e%16;i+=o,n+=o}16<i+e?(n=16*Math.ceil(n/16),s.offset=n,n+=e,i=e):(s.offset=n,i+=e,n+=e)}return{uboElements:t,size:n=16*Math.ceil(n/16)}}(),e=t.uboElements,i=t.size,n=["\n    var v = null;\n    var v2 = null;\n    var cv = null;\n    var t = 0;\n    var gl = renderer.gl\n    var index = 0;\n    var data = buffer.data;\n    "],r=0;r<e.length;r++){for(var s=e[r],o=a.uniforms[s.data.name],h=s.data.name,u=!1,c=0;c<Av.length;c++){var d=Av[c];if(d.codeUbo&&d.test(s.data,o)){n.push("offset = "+s.offset/4+";",Av[c].codeUbo(s.data.name,o)),u=!0;break}}if(!u)if(1<s.data.size){var p=Tv(s.data.type),f=Math.max(mb[s.data.type]/16,1),g=p/f,m=(4-g%4)%4;n.push("\n                cv = ud."+h+".value;\n                v = uv."+h+";\n                offset = "+s.offset/4+";\n\n                t = 0;\n\n                for(var i=0; i < "+s.data.size*f+"; i++)\n                {\n                    for(var j = 0; j < "+g+"; j++)\n                    {\n                        data[offset++] = v[t++];\n                    }\n                    offset += "+m+";\n                }\n\n                ")}else{var y=gb[s.data.type];n.push("\n                cv = ud."+h+".value;\n                v = uv."+h+";\n                offset = "+s.offset/4+";\n                "+y+";\n                ")}}return n.push("\n       renderer.buffer.update(buffer);\n    "),{size:i,syncFunc:new Function("ud","uv","renderer","syncData","buffer",n.join("\n"))}}(t,this.shader.program.uniformData)),t.autoManage){var a=new Float32Array(o.size/4);t.buffer.update(a)}return e.uniformGroups[t.id]=o.syncFunc,e.uniformGroups[t.id]},nw.prototype.getSignature=function(t,e,i){var n=t.uniforms,r=[i+"-"];for(var s in n)r.push(s),e[s]&&r.push(e[s].type);return r.join("-")},nw.prototype.getGlProgram=function(){return this.shader?this.shader.program.glPrograms[this.renderer.CONTEXT_UID]:null},nw.prototype.generateProgram=function(t){var e=this.gl,i=t.program,n=function(t,e){var i,n,r,s,o=gv(t,t.VERTEX_SHADER,e.vertexSrc),a=gv(t,t.FRAGMENT_SHADER,e.fragmentSrc),l=t.createProgram();if(t.attachShader(l,o),t.attachShader(l,a),t.linkProgram(l),t.getProgramParameter(l,t.LINK_STATUS)||(n=l,r=o,s=a,(i=t).getProgramParameter(n,i.LINK_STATUS)||(i.getShaderParameter(r,i.COMPILE_STATUS)||mv(i,r),i.getShaderParameter(s,i.COMPILE_STATUS)||mv(i,s),console.error("PixiJS Error: Could not initialize shader."),""!==i.getProgramInfoLog(n)&&console.warn("PixiJS Warning: gl.getProgramInfoLog()",i.getProgramInfoLog(n)))),e.attributeData=function(t,e){for(var i={},n=e.getProgramParameter(t,e.ACTIVE_ATTRIBUTES),r=0;r<n;r++){var s=e.getActiveAttrib(t,r);if(0!==s.name.indexOf("gl_")){var o=Cv(e,s.type),a={type:o,name:s.name,size:Tv(o),location:e.getAttribLocation(t,s.name)};i[s.name]=a}}return i}(l,t),e.uniformData=function(t,e){for(var i={},n=e.getProgramParameter(t,e.ACTIVE_UNIFORMS),r=0;r<n;r++){var s=e.getActiveUniform(t,r),o=s.name.replace(/\[.*?\]$/,""),a=!!s.name.match(/\[.*?\]$/),l=Cv(e,s.type);i[o]={name:o,index:r,type:l,size:s.size,isArray:a,value:_v(l,s.size)}}return i}(l,t),!/^[ \t]*#[ \t]*version[ \t]+300[ \t]+es[ \t]*$/m.test(e.vertexSrc)){var h=Object.keys(e.attributeData);h.sort(function(t,e){return e<t?1:-1});for(var u=0;u<h.length;u++)e.attributeData[h[u]].location=u,t.bindAttribLocation(l,u,h[u]);t.linkProgram(l)}t.deleteShader(o),t.deleteShader(a);var c={};for(var u in e.uniformData){var d=e.uniformData[u];c[u]={location:t.getUniformLocation(l,u),value:_v(d.type,d.size)}}return new yb(l,c)}(e,i);return i.glPrograms[this.renderer.CONTEXT_UID]=n},nw.prototype.reset=function(){this.program=null,this.shader=null},nw.prototype.destroy=function(){this.renderer=null,this.destroyed=!0},nw),Ab=(iw.prototype.contextChange=function(t){var e,i;this.gl=t,this.blendModes=(e=t,void 0===i&&(i=[]),i[nt.BLEND_MODES.NORMAL]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],i[nt.BLEND_MODES.ADD]=[e.ONE,e.ONE],i[nt.BLEND_MODES.MULTIPLY]=[e.DST_COLOR,e.ONE_MINUS_SRC_ALPHA,e.ONE,e.ONE_MINUS_SRC_ALPHA],i[nt.BLEND_MODES.SCREEN]=[e.ONE,e.ONE_MINUS_SRC_COLOR,e.ONE,e.ONE_MINUS_SRC_ALPHA],i[nt.BLEND_MODES.OVERLAY]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],i[nt.BLEND_MODES.DARKEN]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],i[nt.BLEND_MODES.LIGHTEN]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],i[nt.BLEND_MODES.COLOR_DODGE]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],i[nt.BLEND_MODES.COLOR_BURN]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],i[nt.BLEND_MODES.HARD_LIGHT]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],i[nt.BLEND_MODES.SOFT_LIGHT]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],i[nt.BLEND_MODES.DIFFERENCE]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],i[nt.BLEND_MODES.EXCLUSION]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],i[nt.BLEND_MODES.HUE]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],i[nt.BLEND_MODES.SATURATION]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],i[nt.BLEND_MODES.COLOR]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],i[nt.BLEND_MODES.LUMINOSITY]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],i[nt.BLEND_MODES.NONE]=[0,0],i[nt.BLEND_MODES.NORMAL_NPM]=[e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA,e.ONE,e.ONE_MINUS_SRC_ALPHA],i[nt.BLEND_MODES.ADD_NPM]=[e.SRC_ALPHA,e.ONE,e.ONE,e.ONE],i[nt.BLEND_MODES.SCREEN_NPM]=[e.SRC_ALPHA,e.ONE_MINUS_SRC_COLOR,e.ONE,e.ONE_MINUS_SRC_ALPHA],i[nt.BLEND_MODES.SRC_IN]=[e.DST_ALPHA,e.ZERO],i[nt.BLEND_MODES.SRC_OUT]=[e.ONE_MINUS_DST_ALPHA,e.ZERO],i[nt.BLEND_MODES.SRC_ATOP]=[e.DST_ALPHA,e.ONE_MINUS_SRC_ALPHA],i[nt.BLEND_MODES.DST_OVER]=[e.ONE_MINUS_DST_ALPHA,e.ONE],i[nt.BLEND_MODES.DST_IN]=[e.ZERO,e.SRC_ALPHA],i[nt.BLEND_MODES.DST_OUT]=[e.ZERO,e.ONE_MINUS_SRC_ALPHA],i[nt.BLEND_MODES.DST_ATOP]=[e.ONE_MINUS_DST_ALPHA,e.SRC_ALPHA],i[nt.BLEND_MODES.XOR]=[e.ONE_MINUS_DST_ALPHA,e.ONE_MINUS_SRC_ALPHA],i[nt.BLEND_MODES.SUBTRACT]=[e.ONE,e.ONE,e.ONE,e.ONE,e.FUNC_REVERSE_SUBTRACT,e.FUNC_ADD],i),this.set(this.defaultState),this.reset()},iw.prototype.set=function(t){if(t=t||this.defaultState,this.stateId!==t.data){for(var e=this.stateId^t.data,i=0;e;)1&e&&this.map[i].call(this,!!(t.data&1<<i)),e>>=1,i++;this.stateId=t.data}for(i=0;i<this.checks.length;i++)this.checks[i](this,t)},iw.prototype.forceState=function(t){t=t||this.defaultState;for(var e=0;e<this.map.length;e++)this.map[e].call(this,!!(t.data&1<<e));for(e=0;e<this.checks.length;e++)this.checks[e](this,t);this.stateId=t.data},iw.prototype.setBlend=function(t){this.updateCheck(iw.checkBlendMode,t),this.gl[t?"enable":"disable"](this.gl.BLEND)},iw.prototype.setOffset=function(t){this.updateCheck(iw.checkPolygonOffset,t),this.gl[t?"enable":"disable"](this.gl.POLYGON_OFFSET_FILL)},iw.prototype.setDepthTest=function(t){this.gl[t?"enable":"disable"](this.gl.DEPTH_TEST)},iw.prototype.setDepthMask=function(t){this.gl.depthMask(t)},iw.prototype.setCullFace=function(t){this.gl[t?"enable":"disable"](this.gl.CULL_FACE)},iw.prototype.setFrontFace=function(t){this.gl.frontFace(this.gl[t?"CW":"CCW"])},iw.prototype.setBlendMode=function(t){if(t!==this.blendMode){this.blendMode=t;var e=this.blendModes[t],i=this.gl;2===e.length?i.blendFunc(e[0],e[1]):i.blendFuncSeparate(e[0],e[1],e[2],e[3]),6===e.length?(this._blendEq=!0,i.blendEquationSeparate(e[4],e[5])):this._blendEq&&(this._blendEq=!1,i.blendEquationSeparate(i.FUNC_ADD,i.FUNC_ADD))}},iw.prototype.setPolygonOffset=function(t,e){this.gl.polygonOffset(t,e)},iw.prototype.reset=function(){this.gl.pixelStorei(this.gl.UNPACK_FLIP_Y_WEBGL,!1),this.forceState(this.defaultState),this._blendEq=!0,this.blendMode=-1,this.setBlendMode(0)},iw.prototype.updateCheck=function(t,e){var i=this.checks.indexOf(t);e&&-1===i?this.checks.push(t):e||-1===i||this.checks.splice(i,1)},iw.checkBlendMode=function(t,e){t.setBlendMode(e.blendMode)},iw.checkPolygonOffset=function(t,e){t.setPolygonOffset(1,e.polygonOffset)},iw.prototype.destroy=function(){this.gl=null},iw),Mb=(ew.prototype.postrender=function(){this.renderer.renderingToScreen&&(this.count++,this.mode!==nt.GC_MODES.MANUAL&&(this.checkCount++,this.checkCount>this.checkCountMax&&(this.checkCount=0,this.run())))},ew.prototype.run=function(){for(var t=this.renderer.texture,e=t.managedTextures,i=!1,n=0;n<e.length;n++){var r=e[n];!r.framebuffer&&this.count-r.touched>this.maxIdle&&(t.destroyTexture(r,!0),i=!(e[n]=null))}if(i){var s=0;for(n=0;n<e.length;n++)null!==e[n]&&(e[s++]=e[n]);e.length=s}},ew.prototype.unload=function(t){var e=this.renderer.texture,i=t._texture;i&&!i.framebuffer&&e.destroyTexture(i);for(var n=t.children.length-1;0<=n;n--)this.unload(t.children[n])},ew.prototype.destroy=function(){this.renderer=null},ew),Bb=(tw.prototype.contextChange=function(){var t,e,i,n,r,s,o,a,l,h,u,c,d,p,f,g,m,y,_,v,b,w,S,x=this.gl=this.renderer.gl;this.CONTEXT_UID=this.renderer.CONTEXT_UID,this.webGLVersion=this.renderer.context.webGLVersion,this.internalFormats=(t=x,"WebGL2RenderingContext"in self&&t instanceof self.WebGL2RenderingContext?((e={})[nt.TYPES.UNSIGNED_BYTE]=((i={})[nt.FORMATS.RGBA]=t.RGBA8,i[nt.FORMATS.RGB]=t.RGB8,i[nt.FORMATS.RG]=t.RG8,i[nt.FORMATS.RED]=t.R8,i[nt.FORMATS.RGBA_INTEGER]=t.RGBA8UI,i[nt.FORMATS.RGB_INTEGER]=t.RGB8UI,i[nt.FORMATS.RG_INTEGER]=t.RG8UI,i[nt.FORMATS.RED_INTEGER]=t.R8UI,i[nt.FORMATS.ALPHA]=t.ALPHA,i[nt.FORMATS.LUMINANCE]=t.LUMINANCE,i[nt.FORMATS.LUMINANCE_ALPHA]=t.LUMINANCE_ALPHA,i),e[nt.TYPES.BYTE]=((n={})[nt.FORMATS.RGBA]=t.RGBA8_SNORM,n[nt.FORMATS.RGB]=t.RGB8_SNORM,n[nt.FORMATS.RG]=t.RG8_SNORM,n[nt.FORMATS.RED]=t.R8_SNORM,n[nt.FORMATS.RGBA_INTEGER]=t.RGBA8I,n[nt.FORMATS.RGB_INTEGER]=t.RGB8I,n[nt.FORMATS.RG_INTEGER]=t.RG8I,n[nt.FORMATS.RED_INTEGER]=t.R8I,n),e[nt.TYPES.UNSIGNED_SHORT]=((r={})[nt.FORMATS.RGBA_INTEGER]=t.RGBA16UI,r[nt.FORMATS.RGB_INTEGER]=t.RGB16UI,r[nt.FORMATS.RG_INTEGER]=t.RG16UI,r[nt.FORMATS.RED_INTEGER]=t.R16UI,r[nt.FORMATS.DEPTH_COMPONENT]=t.DEPTH_COMPONENT16,r),e[nt.TYPES.SHORT]=((s={})[nt.FORMATS.RGBA_INTEGER]=t.RGBA16I,s[nt.FORMATS.RGB_INTEGER]=t.RGB16I,s[nt.FORMATS.RG_INTEGER]=t.RG16I,s[nt.FORMATS.RED_INTEGER]=t.R16I,s),e[nt.TYPES.UNSIGNED_INT]=((o={})[nt.FORMATS.RGBA_INTEGER]=t.RGBA32UI,o[nt.FORMATS.RGB_INTEGER]=t.RGB32UI,o[nt.FORMATS.RG_INTEGER]=t.RG32UI,o[nt.FORMATS.RED_INTEGER]=t.R32UI,o[nt.FORMATS.DEPTH_COMPONENT]=t.DEPTH_COMPONENT24,o),e[nt.TYPES.INT]=((a={})[nt.FORMATS.RGBA_INTEGER]=t.RGBA32I,a[nt.FORMATS.RGB_INTEGER]=t.RGB32I,a[nt.FORMATS.RG_INTEGER]=t.RG32I,a[nt.FORMATS.RED_INTEGER]=t.R32I,a),e[nt.TYPES.FLOAT]=((l={})[nt.FORMATS.RGBA]=t.RGBA32F,l[nt.FORMATS.RGB]=t.RGB32F,l[nt.FORMATS.RG]=t.RG32F,l[nt.FORMATS.RED]=t.R32F,l[nt.FORMATS.DEPTH_COMPONENT]=t.DEPTH_COMPONENT32F,l),e[nt.TYPES.HALF_FLOAT]=((h={})[nt.FORMATS.RGBA]=t.RGBA16F,h[nt.FORMATS.RGB]=t.RGB16F,h[nt.FORMATS.RG]=t.RG16F,h[nt.FORMATS.RED]=t.R16F,h),e[nt.TYPES.UNSIGNED_SHORT_5_6_5]=((u={})[nt.FORMATS.RGB]=t.RGB565,u),e[nt.TYPES.UNSIGNED_SHORT_4_4_4_4]=((c={})[nt.FORMATS.RGBA]=t.RGBA4,c),e[nt.TYPES.UNSIGNED_SHORT_5_5_5_1]=((d={})[nt.FORMATS.RGBA]=t.RGB5_A1,d),e[nt.TYPES.UNSIGNED_INT_2_10_10_10_REV]=((p={})[nt.FORMATS.RGBA]=t.RGB10_A2,p[nt.FORMATS.RGBA_INTEGER]=t.RGB10_A2UI,p),e[nt.TYPES.UNSIGNED_INT_10F_11F_11F_REV]=((f={})[nt.FORMATS.RGB]=t.R11F_G11F_B10F,f),e[nt.TYPES.UNSIGNED_INT_5_9_9_9_REV]=((g={})[nt.FORMATS.RGB]=t.RGB9_E5,g),e[nt.TYPES.UNSIGNED_INT_24_8]=((m={})[nt.FORMATS.DEPTH_STENCIL]=t.DEPTH24_STENCIL8,m),e[nt.TYPES.FLOAT_32_UNSIGNED_INT_24_8_REV]=((y={})[nt.FORMATS.DEPTH_STENCIL]=t.DEPTH32F_STENCIL8,y),e):((_={})[nt.TYPES.UNSIGNED_BYTE]=((v={})[nt.FORMATS.RGBA]=t.RGBA,v[nt.FORMATS.RGB]=t.RGB,v[nt.FORMATS.ALPHA]=t.ALPHA,v[nt.FORMATS.LUMINANCE]=t.LUMINANCE,v[nt.FORMATS.LUMINANCE_ALPHA]=t.LUMINANCE_ALPHA,v),_[nt.TYPES.UNSIGNED_SHORT_5_6_5]=((b={})[nt.FORMATS.RGB]=t.RGB,b),_[nt.TYPES.UNSIGNED_SHORT_4_4_4_4]=((w={})[nt.FORMATS.RGBA]=t.RGBA,w),_[nt.TYPES.UNSIGNED_SHORT_5_5_5_1]=((S={})[nt.FORMATS.RGBA]=t.RGBA,S),_));var T=x.getParameter(x.MAX_TEXTURE_IMAGE_UNITS);this.boundTextures.length=T;for(var I=0;I<T;I++)this.boundTextures[I]=null;this.emptyTextures={};var P=new vb(x.createTexture());for(x.bindTexture(x.TEXTURE_2D,P.texture),x.texImage2D(x.TEXTURE_2D,0,x.RGBA,1,1,0,x.RGBA,x.UNSIGNED_BYTE,new Uint8Array(4)),this.emptyTextures[x.TEXTURE_2D]=P,this.emptyTextures[x.TEXTURE_CUBE_MAP]=new vb(x.createTexture()),x.bindTexture(x.TEXTURE_CUBE_MAP,this.emptyTextures[x.TEXTURE_CUBE_MAP].texture),I=0;I<6;I++)x.texImage2D(x.TEXTURE_CUBE_MAP_POSITIVE_X+I,0,x.RGBA,1,1,0,x.RGBA,x.UNSIGNED_BYTE,null);for(x.texParameteri(x.TEXTURE_CUBE_MAP,x.TEXTURE_MAG_FILTER,x.LINEAR),x.texParameteri(x.TEXTURE_CUBE_MAP,x.TEXTURE_MIN_FILTER,x.LINEAR),I=0;I<this.boundTextures.length;I++)this.bind(null,I)},tw.prototype.bind=function(t,e){void 0===e&&(e=0);var i=this.gl;if((t=null==t?void 0:t.castToBaseTexture())&&t.valid&&!t.parentTextureArray){t.touched=this.renderer.textureGC.count;var n=t._glTextures[this.CONTEXT_UID]||this.initTexture(t);this.boundTextures[e]!==t&&(this.currentLocation!==e&&(this.currentLocation=e,i.activeTexture(i.TEXTURE0+e)),i.bindTexture(t.target,n.texture)),n.dirtyId!==t.dirtyId&&(this.currentLocation!==e&&(this.currentLocation=e,i.activeTexture(i.TEXTURE0+e)),this.updateTexture(t)),this.boundTextures[e]=t}else this.currentLocation!==e&&(this.currentLocation=e,i.activeTexture(i.TEXTURE0+e)),i.bindTexture(i.TEXTURE_2D,this.emptyTextures[i.TEXTURE_2D].texture),this.boundTextures[e]=null},tw.prototype.reset=function(){this._unknownBoundTextures=!0,this.hasIntegerTextures=!1,this.currentLocation=-1;for(var t=0;t<this.boundTextures.length;t++)this.boundTextures[t]=this.unknownTexture},tw.prototype.unbind=function(t){var e=this.gl,i=this.boundTextures;if(this._unknownBoundTextures){this._unknownBoundTextures=!1;for(var n=0;n<i.length;n++)i[n]===this.unknownTexture&&this.bind(null,n)}for(n=0;n<i.length;n++)i[n]===t&&(this.currentLocation!==n&&(e.activeTexture(e.TEXTURE0+n),this.currentLocation=n),e.bindTexture(t.target,this.emptyTextures[t.target].texture),i[n]=null)},tw.prototype.ensureSamplerType=function(t){var e=this.boundTextures,i=this.hasIntegerTextures,n=this.CONTEXT_UID;if(i)for(var r=t-1;0<=r;--r){var s=e[r];s&&s._glTextures[n].samplerType!==nt.SAMPLER_TYPES.FLOAT&&this.renderer.texture.unbind(s)}},tw.prototype.initTexture=function(t){var e=new vb(this.gl.createTexture());return e.dirtyId=-1,t._glTextures[this.CONTEXT_UID]=e,this.managedTextures.push(t),t.on("dispose",this.destroyTexture,this),e},tw.prototype.initTextureType=function(t,e){var i,n;e.internalFormat=null!==(n=null===(i=this.internalFormats[t.type])||void 0===i?void 0:i[t.format])&&void 0!==n?n:t.format,2===this.webGLVersion&&t.type===nt.TYPES.HALF_FLOAT?e.type=this.gl.HALF_FLOAT:e.type=t.type},tw.prototype.updateTexture=function(t){var e=t._glTextures[this.CONTEXT_UID];if(e){var i=this.renderer;if(this.initTextureType(t,e),t.resource&&t.resource.upload(i,t,e))e.samplerType!==nt.SAMPLER_TYPES.FLOAT&&(this.hasIntegerTextures=!0);else{var n=t.realWidth,r=t.realHeight,s=i.gl;(e.width!==n||e.height!==r||e.dirtyId<0)&&(e.width=n,e.height=r,s.texImage2D(t.target,0,e.internalFormat,n,r,0,t.format,e.type,null))}t.dirtyStyleId!==e.dirtyStyleId&&this.updateTextureStyle(t),e.dirtyId=t.dirtyId}},tw.prototype.destroyTexture=function(t,e){var i=this.gl;if((t=t.castToBaseTexture())._glTextures[this.CONTEXT_UID]&&(this.unbind(t),i.deleteTexture(t._glTextures[this.CONTEXT_UID].texture),t.off("dispose",this.destroyTexture,this),delete t._glTextures[this.CONTEXT_UID],!e)){var n=this.managedTextures.indexOf(t);-1!==n&&function(t,e,i){var n,r=t.length;if(!(r<=e||0===i)){var s=r-(i=r<e+i?r-e:i);for(n=e;n<s;++n)t[n]=t[n+i];t.length=s}}(this.managedTextures,n,1)}},tw.prototype.updateTextureStyle=function(t){var e=t._glTextures[this.CONTEXT_UID];e&&(t.mipmap!==nt.MIPMAP_MODES.POW2&&2===this.webGLVersion||t.isPowerOfTwo?e.mipmap=1<=t.mipmap:e.mipmap=!1,2===this.webGLVersion||t.isPowerOfTwo?e.wrapMode=t.wrapMode:e.wrapMode=nt.WRAP_MODES.CLAMP,t.resource&&t.resource.style(this.renderer,t,e)||this.setStyle(t,e),e.dirtyStyleId=t.dirtyStyleId)},tw.prototype.setStyle=function(t,e){var i=this.gl;if(e.mipmap&&t.mipmap!==nt.MIPMAP_MODES.ON_MANUAL&&i.generateMipmap(t.target),i.texParameteri(t.target,i.TEXTURE_WRAP_S,e.wrapMode),i.texParameteri(t.target,i.TEXTURE_WRAP_T,e.wrapMode),e.mipmap){i.texParameteri(t.target,i.TEXTURE_MIN_FILTER,t.scaleMode===nt.SCALE_MODES.LINEAR?i.LINEAR_MIPMAP_LINEAR:i.NEAREST_MIPMAP_NEAREST);var n=this.renderer.context.extensions.anisotropicFiltering;if(n&&0<t.anisotropicLevel&&t.scaleMode===nt.SCALE_MODES.LINEAR){var r=Math.min(t.anisotropicLevel,i.getParameter(n.MAX_TEXTURE_MAX_ANISOTROPY_EXT));i.texParameterf(t.target,n.TEXTURE_MAX_ANISOTROPY_EXT,r)}}else i.texParameteri(t.target,i.TEXTURE_MIN_FILTER,t.scaleMode===nt.SCALE_MODES.LINEAR?i.LINEAR:i.NEAREST);i.texParameteri(t.target,i.TEXTURE_MAG_FILTER,t.scaleMode===nt.SCALE_MODES.LINEAR?i.LINEAR:i.NEAREST)},tw.prototype.destroy=function(){this.renderer=null},tw),Rb={__proto__:null,FilterSystem:H_,BatchSystem:j_,ContextSystem:Y_,FramebufferSystem:K_,GeometrySystem:Q_,MaskSystem:Yv,ScissorSystem:$v,StencilSystem:Qv,ProjectionSystem:Jv,RenderTextureSystem:eb,ShaderSystem:Eb,StateSystem:Ab,TextureGCSystem:Mb,TextureSystem:Bb},Ob=new sy,kb=(Sy(Zb,Ib=im),Zb.prototype.initPlugins=function(t){for(var e in t)this.plugins[e]=new t[e](this)},Object.defineProperty(Zb.prototype,"width",{get:function(){return this.view.width},enumerable:!1,configurable:!0}),Object.defineProperty(Zb.prototype,"height",{get:function(){return this.view.height},enumerable:!1,configurable:!0}),Zb.prototype.resize=function(t,e){this.view.width=Math.round(t*this.resolution),this.view.height=Math.round(e*this.resolution);var i=this.view.width/this.resolution,n=this.view.height/this.resolution;this.screen.width=i,this.screen.height=n,this.autoDensity&&(this.view.style.width=i+"px",this.view.style.height=n+"px"),this.emit("resize",i,n)},Zb.prototype.generateTexture=function(t,e,i,n){void 0===e&&(e={}),"number"==typeof e&&(Lm("6.1.0","generateTexture options (scaleMode, resolution, region) are now object options."),e={scaleMode:e,resolution:i,region:n});var r=e.region,s=function(t,e){var i={};for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e.indexOf(n)<0&&(i[n]=t[n]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(n=Object.getOwnPropertySymbols(t);r<n.length;r++)e.indexOf(n[r])<0&&(i[n[r]]=t[n[r]])}return i}(e,["region"]);0===(n=r||t.getLocalBounds(null,!0)).width&&(n.width=1),0===n.height&&(n.height=1);var o=P_.create(ky({width:n.width,height:n.height},s));return Ob.tx=-n.x,Ob.ty=-n.y,this.render(t,{renderTexture:o,clear:!1,transform:Ob,skipUpdateTransform:!!t.parent}),o},Zb.prototype.destroy=function(t){for(var e in this.plugins)this.plugins[e].destroy(),this.plugins[e]=null;t&&this.view.parentNode&&this.view.parentNode.removeChild(this.view),this.plugins=null,this.type=nt.RENDERER_TYPE.UNKNOWN,this.view=null,this.screen=null,this._tempDisplayObjectParent=null,this.options=null,this._backgroundColorRgba=null,this._backgroundColorString=null,this._lastObjectRendered=null},Object.defineProperty(Zb.prototype,"backgroundColor",{get:function(){return this._backgroundColor},set:function(t){var e,i,n;this._backgroundColor=t,this._backgroundColorString=(e=t.toString(16),"#"+(e="000000".substr(0,6-e.length)+e)),i=t,void 0===(n=this._backgroundColorRgba)&&(n=[]),n[0]=(i>>16&255)/255,n[1]=(i>>8&255)/255,n[2]=(255&i)/255},enumerable:!1,configurable:!0}),Object.defineProperty(Zb.prototype,"backgroundAlpha",{get:function(){return this._backgroundColorRgba[3]},set:function(t){this._backgroundColorRgba[3]=t},enumerable:!1,configurable:!0}),Zb),Db=(Jb.prototype.destroy=function(){this.renderer=null},Jb.prototype.contextChange=function(){this.disposeAll(!0),this.gl=this.renderer.gl,this.CONTEXT_UID=this.renderer.CONTEXT_UID},Jb.prototype.bind=function(t){var e=this.gl,i=this.CONTEXT_UID,n=t._glBuffers[i]||this.createGLBuffer(t);e.bindBuffer(t.type,n.buffer)},Jb.prototype.bindBufferBase=function(t,e){var i=this.gl,n=this.CONTEXT_UID;if(this.boundBufferBases[e]!==t){var r=t._glBuffers[n]||this.createGLBuffer(t);this.boundBufferBases[e]=t,i.bindBufferBase(i.UNIFORM_BUFFER,e,r.buffer)}},Jb.prototype.bindBufferRange=function(t,e,i){var n=this.gl,r=this.CONTEXT_UID;i=i||0;var s=t._glBuffers[r]||this.createGLBuffer(t);n.bindBufferRange(n.UNIFORM_BUFFER,e||0,s.buffer,256*i,256)},Jb.prototype.update=function(t){var e=this.gl,i=this.CONTEXT_UID,n=t._glBuffers[i];if(t._updateID!==n.updateID)if(n.updateID=t._updateID,e.bindBuffer(t.type,n.buffer),n.byteLength>=t.data.byteLength)e.bufferSubData(t.type,0,t.data);else{var r=t.static?e.STATIC_DRAW:e.DYNAMIC_DRAW;n.byteLength=t.data.byteLength,e.bufferData(t.type,t.data,r)}},Jb.prototype.dispose=function(t,e){if(this.managedBuffers[t.id]){delete this.managedBuffers[t.id];var i=t._glBuffers[this.CONTEXT_UID],n=this.gl;t.disposeRunner.remove(this),i&&(e||n.deleteBuffer(i.buffer),delete t._glBuffers[this.CONTEXT_UID])}},Jb.prototype.disposeAll=function(t){for(var e=Object.keys(this.managedBuffers),i=0;i<e.length;i++)this.dispose(this.managedBuffers[e[i]],t)},Jb.prototype.createGLBuffer=function(t){var e=this.CONTEXT_UID,i=this.gl;return t._glBuffers[e]=new bb(i.createBuffer()),(this.managedBuffers[t.id]=t).disposeRunner.add(this),t._glBuffers[e]},Jb),Fb=(Sy(Qb,Tb=kb),Qb.create=function(t){if(void 0===Em&&(Em=function(){var t={stencil:!0,failIfMajorPerformanceCaveat:Tt.FAIL_IF_MAJOR_PERFORMANCE_CAVEAT};try{if(!self.WebGLRenderingContext)return!1;var e=document.createElement("canvas"),i=e.getContext("webgl",t)||e.getContext("experimental-webgl",t),n=!(!i||!i.getContextAttributes().stencil);if(i){var r=i.getExtension("WEBGL_lose_context");r&&r.loseContext()}return i=null,n}catch(t){return!1}}()),Em)return new Qb(t);throw new Error('WebGL unsupported in this browser, use "pixi.js-legacy" for fallback canvas2d support.')},Qb.prototype.contextChange=function(){var t,e=this.gl;if(1===this.context.webGLVersion){var i=e.getParameter(e.FRAMEBUFFER_BINDING);e.bindFramebuffer(e.FRAMEBUFFER,null),t=e.getParameter(e.SAMPLES),e.bindFramebuffer(e.FRAMEBUFFER,i)}else i=e.getParameter(e.DRAW_FRAMEBUFFER_BINDING),e.bindFramebuffer(e.DRAW_FRAMEBUFFER,null),t=e.getParameter(e.SAMPLES),e.bindFramebuffer(e.DRAW_FRAMEBUFFER,i);t>=nt.MSAA_QUALITY.HIGH?this.multisample=nt.MSAA_QUALITY.HIGH:t>=nt.MSAA_QUALITY.MEDIUM?this.multisample=nt.MSAA_QUALITY.MEDIUM:t>=nt.MSAA_QUALITY.LOW?this.multisample=nt.MSAA_QUALITY.LOW:this.multisample=nt.MSAA_QUALITY.NONE},Qb.prototype.addSystem=function(t,e){var i=new t(this);if(this[e])throw new Error('Whoops! The name "'+e+'" is already in use');for(var n in this[e]=i,this.runners)this.runners[n].add(i);return this},Qb.prototype.render=function(t,e){var i,n,r,s;if(e&&(s=e instanceof P_?(Lm("6.0.0","Renderer#render arguments changed, use options instead."),i=e,n=arguments[2],r=arguments[3],arguments[4]):(i=e.renderTexture,n=e.clear,r=e.transform,e.skipUpdateTransform)),this.renderingToScreen=!i,this.runners.prerender.emit(),this.emit("prerender"),this.projection.transform=r,!this.context.isLost){if(i||(this._lastObjectRendered=t),!s){var o=t.enableTempParent();t.updateTransform(),t.disableTempParent(o)}this.renderTexture.bind(i),this.batch.currentRenderer.start(),(void 0!==n?n:this.clearBeforeRender)&&this.renderTexture.clear(),t.render(this),this.batch.currentRenderer.flush(),i&&i.baseTexture.update(),this.runners.postrender.emit(),this.projection.transform=null,this.emit("postrender")}},Qb.prototype.generateTexture=function(t,e,i,n){void 0===e&&(e={});var r=Tb.prototype.generateTexture.call(this,t,e,i,n);return this.framebuffer.blit(),r},Qb.prototype.resize=function(t,e){Tb.prototype.resize.call(this,t,e),this.runners.resize.emit(this.screen.height,this.screen.width)},Qb.prototype.reset=function(){return this.runners.reset.emit(),this},Qb.prototype.clear=function(){this.renderTexture.bind(),this.renderTexture.clear()},Qb.prototype.destroy=function(t){for(var e in this.runners.destroy.emit(),this.runners)this.runners[e].destroy();Tb.prototype.destroy.call(this,t),this.gl=null},Object.defineProperty(Qb.prototype,"extract",{get:function(){return Lm("6.0.0","Renderer#extract has been deprecated, please use Renderer#plugins.extract instead."),this.plugins.extract},enumerable:!1,configurable:!0}),Qb.registerPlugin=function(t,e){(Qb.__plugins=Qb.__plugins||{})[t]=e},function(){this.texArray=null,this.blend=0,this.type=nt.DRAW_MODES.TRIANGLES,this.start=0,this.size=0,this.data=null}),Nb=($b.prototype.clear=function(){for(var t=0;t<this.count;t++)this.elements[t]=null;this.count=0},$b),Lb=(Object.defineProperty(Kb.prototype,"int8View",{get:function(){return this._int8View||(this._int8View=new Int8Array(this.rawBinaryData)),this._int8View},enumerable:!1,configurable:!0}),Object.defineProperty(Kb.prototype,"uint8View",{get:function(){return this._uint8View||(this._uint8View=new Uint8Array(this.rawBinaryData)),this._uint8View},enumerable:!1,configurable:!0}),Object.defineProperty(Kb.prototype,"int16View",{get:function(){return this._int16View||(this._int16View=new Int16Array(this.rawBinaryData)),this._int16View},enumerable:!1,configurable:!0}),Object.defineProperty(Kb.prototype,"uint16View",{get:function(){return this._uint16View||(this._uint16View=new Uint16Array(this.rawBinaryData)),this._uint16View},enumerable:!1,configurable:!0}),Object.defineProperty(Kb.prototype,"int32View",{get:function(){return this._int32View||(this._int32View=new Int32Array(this.rawBinaryData)),this._int32View},enumerable:!1,configurable:!0}),Kb.prototype.view=function(t){return this[t+"View"]},Kb.prototype.destroy=function(){this.rawBinaryData=null,this._int8View=null,this._uint8View=null,this._int16View=null,this._uint16View=null,this._int32View=null,this.uint32View=null,this.float32View=null},Kb.sizeOf=function(t){switch(t){case"int8":case"uint8":return 1;case"int16":case"uint16":return 2;case"int32":case"uint32":case"float32":return 4;default:throw new Error(t+" isn't a valid view type")}},Kb),Ub=(Sy(qb,xb=X_),qb.prototype.contextChange=function(){var t=this.renderer.gl;Tt.PREFER_ENV===nt.ENV.WEBGL_LEGACY?this.MAX_TEXTURES=1:(this.MAX_TEXTURES=Math.min(t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS),Tt.SPRITE_MAX_TEXTURES),this.MAX_TEXTURES=function(t,e){if(0===t)throw new Error("Invalid value of `0` passed to `checkMaxIfStatementsInShader`");for(var i=e.createShader(e.FRAGMENT_SHADER);;){var n=Rv.replace(/%forloop%/gi,Ov(t));if(e.shaderSource(i,n),e.compileShader(i),e.getShaderParameter(i,e.COMPILE_STATUS))break;t=t/2|0}return t}(this.MAX_TEXTURES,t)),this._shader=this.shaderGenerator.generateShader(this.MAX_TEXTURES);for(var e=0;e<this._packedGeometryPoolSize;e++)this._packedGeometries[e]=new this.geometryClass;this.initFlushBuffers()},qb.prototype.initFlushBuffers=function(){for(var t=qb._drawCallPool,e=qb._textureArrayPool,i=this.size/4,n=Math.floor(i/this.MAX_TEXTURES)+1;t.length<i;)t.push(new Fb);for(;e.length<n;)e.push(new Nb);for(var r=0;r<this.MAX_TEXTURES;r++)this._tempBoundTextures[r]=null},qb.prototype.onPrerender=function(){this._flushId=0},qb.prototype.render=function(t){t._texture.valid&&(this._vertexCount+t.vertexData.length/2>this.size&&this.flush(),this._vertexCount+=t.vertexData.length/2,this._indexCount+=t.indices.length,this._bufferedTextures[this._bufferSize]=t._texture.baseTexture,this._bufferedElements[this._bufferSize++]=t)},qb.prototype.buildTexturesAndDrawCalls=function(){var t=this._bufferedTextures,e=this.MAX_TEXTURES,i=qb._textureArrayPool,n=this.renderer.batch,r=this._tempBoundTextures,s=this.renderer.textureGC.count,o=++Ly._globalBatch,a=0,l=i[0],h=0;n.copyBoundTextures(r,e);for(var u=0;u<this._bufferSize;++u){var c=t[u];t[u]=null,c._batchEnabled!==o&&(l.count>=e&&(n.boundArray(l,r,o,e),this.buildDrawCalls(l,h,u),h=u,l=i[++a],++o),c._batchEnabled=o,c.touched=s,l.elements[l.count++]=c)}for(0<l.count&&(n.boundArray(l,r,o,e),this.buildDrawCalls(l,h,this._bufferSize),++a,++o),u=0;u<r.length;u++)r[u]=null;Ly._globalBatch=o},qb.prototype.buildDrawCalls=function(t,e,i){var n=this._bufferedElements,r=this._attributeBuffer,s=this._indexBuffer,o=this.vertexSize,a=qb._drawCallPool,l=this._dcIndex,h=this._aIndex,u=this._iIndex,c=a[l];c.start=this._iIndex,c.texArray=t;for(var d=e;d<i;++d){var p=n[d],f=p._texture.baseTexture,g=Mm[f.alphaMode?1:0][p.blendMode];n[d]=null,e<d&&c.blend!==g&&(c.size=u-c.start,e=d,(c=a[++l]).texArray=t,c.start=u),this.packInterleavedGeometry(p,r,s,h,u),h+=p.vertexData.length/2*o,u+=p.indices.length,c.blend=g}e<i&&(c.size=u-c.start,++l),this._dcIndex=l,this._aIndex=h,this._iIndex=u},qb.prototype.bindAndClearTexArray=function(t){for(var e=this.renderer.texture,i=0;i<t.count;i++)e.bind(t.elements[i],t.ids[i]),t.elements[i]=null;t.count=0},qb.prototype.updateGeometry=function(){var t=this._packedGeometries,e=this._attributeBuffer,i=this._indexBuffer;Tt.CAN_UPLOAD_SAME_BUFFER?(t[this._flushId]._buffer.update(e.rawBinaryData),t[this._flushId]._indexBuffer.update(i),this.renderer.geometry.updateBuffers()):(this._packedGeometryPoolSize<=this._flushId&&(this._packedGeometryPoolSize++,t[this._flushId]=new this.geometryClass),t[this._flushId]._buffer.update(e.rawBinaryData),t[this._flushId]._indexBuffer.update(i),this.renderer.geometry.bind(t[this._flushId]),this.renderer.geometry.updateBuffers(),this._flushId++)},qb.prototype.drawBatches=function(){for(var t=this._dcIndex,e=this.renderer,i=e.gl,n=e.state,r=qb._drawCallPool,s=null,o=0;o<t;o++){var a=r[o],l=a.texArray,h=a.type,u=a.size,c=a.start,d=a.blend;s!==l&&(s=l,this.bindAndClearTexArray(l)),this.state.blendMode=d,n.set(this.state),i.drawElements(h,u,i.UNSIGNED_SHORT,2*c)}},qb.prototype.flush=function(){0!==this._vertexCount&&(this._attributeBuffer=this.getAttributeBuffer(this._vertexCount),this._indexBuffer=this.getIndexBuffer(this._indexCount),this._aIndex=0,this._iIndex=0,this._dcIndex=0,this.buildTexturesAndDrawCalls(),this.updateGeometry(),this.drawBatches(),this._bufferSize=0,this._vertexCount=0,this._indexCount=0)},qb.prototype.start=function(){this.renderer.state.set(this.state),this.renderer.texture.ensureSamplerType(this.MAX_TEXTURES),this.renderer.shader.bind(this._shader),Tt.CAN_UPLOAD_SAME_BUFFER&&this.renderer.geometry.bind(this._packedGeometries[this._flushId])},qb.prototype.stop=function(){this.flush()},qb.prototype.destroy=function(){for(var t=0;t<this._packedGeometryPoolSize;t++)this._packedGeometries[t]&&this._packedGeometries[t].destroy();this.renderer.off("prerender",this.onPrerender,this),this._aBuffers=null,this._iBuffers=null,this._packedGeometries=null,this._attributeBuffer=null,this._indexBuffer=null,this._shader&&(this._shader.destroy(),this._shader=null),xb.prototype.destroy.call(this)},qb.prototype.getAttributeBuffer=function(t){var e=Rm(Math.ceil(t/8)),i=km(e),n=8*e;this._aBuffers.length<=i&&(this._iBuffers.length=i+1);var r=this._aBuffers[n];return r||(this._aBuffers[n]=r=new Lb(n*this.vertexSize*4)),r},qb.prototype.getIndexBuffer=function(t){var e=Rm(Math.ceil(t/12)),i=km(e),n=12*e;this._iBuffers.length<=i&&(this._iBuffers.length=i+1);var r=this._iBuffers[i];return r||(this._iBuffers[i]=r=new Uint16Array(n)),r},qb.prototype.packInterleavedGeometry=function(t,e,i,n,r){for(var s=e.uint32View,o=e.float32View,a=n/this.vertexSize,l=t.uvs,h=t.indices,u=t.vertexData,c=t._texture.baseTexture._batchLocation,d=Math.min(t.worldAlpha,1),p=d<1&&t._texture.baseTexture.alphaMode?function(t){if(1===d)return(255*d<<24)+t;if(0===d)return 0;var e=t>>16&255,i=t>>8&255;return(255*d<<24)+((e=e*d+.5|0)<<16)+((i=i*d+.5|0)<<8)+((255&t)*d+.5|0)}(t._tintRGB):t._tintRGB+(255*d<<24),f=0;f<u.length;f+=2)o[n++]=u[f],o[n++]=u[f+1],o[n++]=l[f],o[n++]=l[f+1],s[n++]=p,o[n++]=c;for(f=0;f<h.length;f++)i[r++]=a+h[f]},qb._drawCallPool=[],qb._textureArrayPool=[],qb),zb=(Yb.prototype.generateShader=function(t){if(!this.programCache[t]){for(var e=new Int32Array(t),i=0;i<t;i++)e[i]=i;this.defaultGroupCache[t]=U_.from({uSamplers:e},!0);var n=this.fragTemplate;n=(n=n.replace(/%count%/gi,""+t)).replace(/%forloop%/gi,this.generateSampleSrc(t)),this.programCache[t]=new zv(this.vertexSrc,n)}var r={tint:new Float32Array([1,1,1,1]),translationMatrix:new sy,default:this.defaultGroupCache[t]};return new Wv(this.programCache[t],r)},Yb.prototype.generateSampleSrc=function(t){var e="";e+="\n",e+="\n";for(var i=0;i<t;i++)0<i&&(e+="\nelse "),i<t-1&&(e+="if(vTextureId < "+i+".5)"),e+="\n{",e+="\n\tcolor = texture2D(uSamplers["+i+"], vTextureCoord);",e+="\n}";return(e+="\n")+"\n"},Yb),Wb=(Sy(Vb,Sb=D_),Vb),Gb="precision highp float;\nattribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\nattribute vec4 aColor;\nattribute float aTextureId;\n\nuniform mat3 projectionMatrix;\nuniform mat3 translationMatrix;\nuniform vec4 tint;\n\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\nvarying float vTextureId;\n\nvoid main(void){\n    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = aTextureCoord;\n    vTextureId = aTextureId;\n    vColor = aColor * tint;\n}\n",Hb="varying vec2 vTextureCoord;\nvarying vec4 vColor;\nvarying float vTextureId;\nuniform sampler2D uSamplers[%count%];\n\nvoid main(void){\n    vec4 color;\n    %forloop%\n    gl_FragColor = color * vColor;\n}\n",Xb=((jb.create=function(t){var i,e=Object.assign({vertex:Gb,fragment:Hb,geometryClass:Wb,vertexSize:6},t),n=e.vertex,r=e.fragment,s=e.vertexSize,o=e.geometryClass;return Sy(a,i=Ub),a;function a(t){var e=i.call(this,t)||this;return e.shaderGenerator=new zb(n,r),e.geometryClass=o,e.vertexSize=s,e}},Object.defineProperty(jb,"defaultVertexSrc",{get:function(){return Gb},enumerable:!1,configurable:!0}),Object.defineProperty(jb,"defaultFragmentTemplate",{get:function(){return Hb},enumerable:!1,configurable:!0}),jb).create(),{});function jb(){}function Vb(t){void 0===t&&(t=!1);var e=Sb.call(this)||this;return e._buffer=new M_(null,t,!1),e._indexBuffer=new M_(null,t,!0),e.addAttribute("aVertexPosition",e._buffer,2,!1,nt.TYPES.FLOAT).addAttribute("aTextureCoord",e._buffer,2,!1,nt.TYPES.FLOAT).addAttribute("aColor",e._buffer,4,!0,nt.TYPES.UNSIGNED_BYTE).addAttribute("aTextureId",e._buffer,1,!0,nt.TYPES.FLOAT).addIndex(e._indexBuffer),e}function Yb(t,e){if(this.vertexSrc=t,this.fragTemplate=e,this.programCache={},this.defaultGroupCache={},e.indexOf("%count%")<0)throw new Error('Fragment template must contain "%count%".');if(e.indexOf("%forloop%")<0)throw new Error('Fragment template must contain "%forloop%".')}function qb(t){var e=xb.call(this,t)||this;return e.shaderGenerator=null,e.geometryClass=null,e.vertexSize=null,e.state=Gv.for2d(),e.size=4*Tt.SPRITE_BATCH_SIZE,e._vertexCount=0,e._indexCount=0,e._bufferedElements=[],e._bufferedTextures=[],e._bufferSize=0,e._shader=null,e._packedGeometries=[],e._packedGeometryPoolSize=2,e._flushId=0,e._aBuffers={},e._iBuffers={},e.MAX_TEXTURES=1,e.renderer.on("prerender",e.onPrerender,e),t.runners.contextChange.add(e),e._dcIndex=0,e._aIndex=0,e._iIndex=0,e._attributeBuffer=null,e._indexBuffer=null,e._tempBoundTextures=[],e}function Kb(t){"number"==typeof t?this.rawBinaryData=new ArrayBuffer(t):t instanceof Uint8Array?this.rawBinaryData=t.buffer:this.rawBinaryData=t,this.uint32View=new Uint32Array(this.rawBinaryData),this.float32View=new Float32Array(this.rawBinaryData)}function $b(){this.elements=[],this.ids=[],this.count=0}function Qb(t){var e=Tb.call(this,nt.RENDERER_TYPE.WEBGL,t)||this;return t=e.options,e.gl=null,e.CONTEXT_UID=0,e.runners={destroy:new Ym("destroy"),contextChange:new Ym("contextChange"),reset:new Ym("reset"),update:new Ym("update"),postrender:new Ym("postrender"),prerender:new Ym("prerender"),resize:new Ym("resize")},e.runners.contextChange.add(e),e.globalUniforms=new U_({projectionMatrix:new sy},!0),e.addSystem(Yv,"mask").addSystem(Y_,"context").addSystem(Ab,"state").addSystem(Eb,"shader").addSystem(Bb,"texture").addSystem(Db,"buffer").addSystem(Q_,"geometry").addSystem(K_,"framebuffer").addSystem($v,"scissor").addSystem(Qv,"stencil").addSystem(Jv,"projection").addSystem(Mb,"textureGC").addSystem(H_,"filter").addSystem(eb,"renderTexture").addSystem(j_,"batch"),e.initPlugins(Qb.__plugins),e.multisample=void 0,t.context?e.context.initFromContext(t.context):e.context.initFromOptions({alpha:!!e.useContextAlpha,antialias:t.antialias,premultipliedAlpha:e.useContextAlpha&&"notMultiplied"!==e.useContextAlpha,stencil:!0,preserveDrawingBuffer:t.preserveDrawingBuffer,powerPreference:e.options.powerPreference}),e.renderingToScreen=!0,function(t){var e;if(!Am){if(-1<navigator.userAgent.toLowerCase().indexOf("chrome")){var i=["\n %c %c %c PixiJS 6.2.1 - ✰ "+t+" ✰  %c  %c  http://www.pixijs.com/  %c %c ♥%c♥%c♥ \n\n","background: #ff66a5; padding:5px 0;","background: #ff66a5; padding:5px 0;","color: #ff66a5; background: #030307; padding:5px 0;","background: #ff66a5; padding:5px 0;","background: #ffc3dc; padding:5px 0;","background: #ff66a5; padding:5px 0;","color: #ff2424; background: #fff; padding:5px 0;","color: #ff2424; background: #fff; padding:5px 0;","color: #ff2424; background: #fff; padding:5px 0;"];(e=self.console).log.apply(e,i)}else self.console&&self.console.log("PixiJS 6.2.1 - "+t+" - http://www.pixijs.com/");Am=!0}}(2===e.context.webGLVersion?"WebGL 2":"WebGL 1"),e.resize(e.options.width,e.options.height),e}function Jb(t){this.renderer=t,this.managedBuffers={},this.boundBufferBases={}}function Zb(t,e){void 0===t&&(t=nt.RENDERER_TYPE.UNKNOWN);var i=Ib.call(this)||this;return e=Object.assign({},Tt.RENDER_OPTIONS,e),i.options=e,i.type=t,i.screen=new iy(0,0,e.width,e.height),i.view=e.view||document.createElement("canvas"),i.resolution=e.resolution||Tt.RESOLUTION,i.useContextAlpha=e.useContextAlpha,i.autoDensity=!!e.autoDensity,i.preserveDrawingBuffer=e.preserveDrawingBuffer,i.clearBeforeRender=e.clearBeforeRender,i._backgroundColor=0,i._backgroundColorRgba=[0,0,0,1],i._backgroundColorString="#000000",i.backgroundColor=e.backgroundColor||i._backgroundColor,i.backgroundAlpha=e.backgroundAlpha,void 0!==e.transparent&&(Lm("6.0.0","Option transparent is deprecated, please use backgroundAlpha instead."),i.useContextAlpha=e.transparent,i.backgroundAlpha=e.transparent?0:1),i._lastObjectRendered=null,i.plugins={},i}function tw(t){this.renderer=t,this.boundTextures=[],this.currentLocation=-1,this.managedTextures=[],this._unknownBoundTextures=!1,this.unknownTexture=new Ly,this.hasIntegerTextures=!1}function ew(t){this.renderer=t,this.count=0,this.checkCount=0,this.maxIdle=Tt.GC_MAX_IDLE,this.checkCountMax=Tt.GC_MAX_CHECK_COUNT,this.mode=Tt.GC_MODE}function iw(){this.gl=null,this.stateId=0,this.polygonOffset=0,this.blendMode=nt.BLEND_MODES.NONE,this._blendEq=!1,this.map=[],this.map[0]=this.setBlend,this.map[1]=this.setOffset,this.map[2]=this.setCullFace,this.map[3]=this.setDepthTest,this.map[4]=this.setFrontFace,this.map[5]=this.setDepthMask,this.checks=[],this.defaultState=new Gv,this.defaultState.blend=!0}function nw(t){this.destroyed=!1,this.renderer=t,this.systemCheck(),this.gl=null,this.shader=null,this.program=null,this.cache={},this._uboCache={},this.id=Pb++}for(var rw in h_)wb(rw);function sw(t){Object.defineProperty(ow,t,{get:function(){return Lm("6.0.0","PIXI.resources."+t+" has moved to PIXI."+t),Rb[t]}})}var ow={};for(var rw in Rb)sw(rw);var aw=(lw.prototype.render=function(t){var e=this.renderer,i=t.worldTransform;e.context.globalAlpha=t.worldAlpha,e.setBlendMode(t.blendMode),e.setContextTransform(i,t.roundPixels),t.drawMode!==nt.DRAW_MODES.TRIANGLES?this._renderTriangleMesh(t):this._renderTriangles(t)},lw.prototype._renderTriangleMesh=function(t){for(var e=t.geometry.buffers[0].data.length,i=0;i<e-2;i++){var n=2*i;this._renderDrawTriangle(t,n,2+n,4+n)}},lw.prototype._renderTriangles=function(t){for(var e=t.geometry.getIndex().data,i=e.length,n=0;n<i;n+=3){var r=2*e[n],s=2*e[n+1],o=2*e[n+2];this._renderDrawTriangle(t,r,s,o)}},lw.prototype._renderDrawTriangle=function(t,e,i,n){var r=this.renderer.context,s=t.geometry.buffers[0].data,o=t.uvs,a=t.texture;if(a.valid){var l=16777215!==t.tint,h=a.baseTexture,u=h.width,c=h.height;l&&t._cachedTint!==t.tint&&(t._cachedTint=t.tint,t._cachedTexture=t._cachedTexture||new g_(h),t._tintedCanvas=$g.getTintedCanvas({texture:t._cachedTexture},t.tint));var d=l?t._tintedCanvas:h.getDrawableSource(),p=o[e]*h.width,f=o[i]*h.width,g=o[n]*h.width,m=o[e+1]*h.height,y=o[i+1]*h.height,_=o[n+1]*h.height,v=s[e],b=s[i],w=s[n],S=s[e+1],x=s[i+1],T=s[n+1],I=t.canvasPadding/this.renderer.resolution;if(0<I){var P=t.worldTransform,C=P.a,E=P.b,A=P.c,M=P.d,B=(v+b+w)/3,R=(S+x+T)/3,O=v-B,k=S-R,D=C*O+A*k,F=E*O+M*k,N=Math.sqrt(D*D+F*F),L=1+I/N;v=B+O*L,S=R+k*L,D=C*(O=b-B)+A*(k=x-R),F=E*O+M*k,b=B+O*(L=1+I/(N=Math.sqrt(D*D+F*F))),x=R+k*L,D=C*(O=w-B)+A*(k=T-R),F=E*O+M*k,w=B+O*(L=1+I/(N=Math.sqrt(D*D+F*F))),T=R+k*L}r.save(),r.beginPath(),r.moveTo(v,S),r.lineTo(b,x),r.lineTo(w,T),r.closePath(),r.clip();var U=p*y+m*g+f*_-y*g-m*f-p*_,z=v*y+m*w+b*_-y*w-m*b-v*_,W=p*b+v*g+f*w-b*g-v*f-p*w,G=p*y*w+m*b*g+v*f*_-v*y*g-m*f*w-p*b*_,H=S*y+m*T+x*_-y*T-m*x-S*_,X=p*x+S*g+f*T-x*g-S*f-p*T,j=p*y*T+m*x*g+S*f*_-S*y*g-m*f*T-p*x*_;r.transform(z/U,H/U,W/U,X/U,G/U,j/U),r.drawImage(d,0,0,u*h.resolution,c*h.resolution,0,0,u,c),r.restore(),this.renderer.invalidateBlendMode()}},lw.prototype.renderMeshFlat=function(t){var e=this.renderer.context,i=t.geometry.getBuffer("aVertexPosition").data,n=i.length/2;e.beginPath();for(var r=1;r<n-2;++r){var s=2*r,o=i[s],a=i[1+s],l=i[2+s],h=i[3+s],u=i[4+s],c=i[5+s];e.moveTo(o,a),e.lineTo(l,h),e.lineTo(u,c)}e.fillStyle="#FF0000",e.fill(),e.closePath()},lw.prototype.destroy=function(){this.renderer=null},lw);function lw(t){this.renderer=t}Tt.MESH_CANVAS_PADDING=0,vd.prototype._renderCanvas=function(t,e){t.plugins.mesh.render(e)},Eg.prototype._cachedTint=16777215,Eg.prototype._tintedCanvas=null,Eg.prototype._canvasUvs=null;var hw=!(Eg.prototype._renderCanvas=function(t){var e=t.context,i=this.worldTransform,n=16777215!==this.tint,r=this.texture;if(r.valid){n&&this._cachedTint!==this.tint&&(this._cachedTint=this.tint,this._tintedCanvas=$g.getTintedCanvas(this,this.tint));var s=n?this._tintedCanvas:r.baseTexture.getDrawableSource();this._canvasUvs||(this._canvasUvs=[0,0,0,0,0,0,0,0]);var o=this.vertices,a=this._canvasUvs,l=n?0:r.frame.x,h=n?0:r.frame.y,u=l+r.frame.width,c=h+r.frame.height;a[0]=l,a[1]=l+this._leftWidth,a[2]=u-this._rightWidth,a[3]=u,a[4]=h,a[5]=h+this._topHeight,a[6]=c-this._bottomHeight,a[7]=c;for(var d=0;d<8;d++)a[d]*=r.baseTexture.resolution;e.globalAlpha=this.worldAlpha,t.setBlendMode(this.blendMode),t.setContextTransform(i,this.roundPixels);for(var p=0;p<3;p++)for(var f=0;f<3;f++){var g=2*f+8*p,m=Math.max(1,a[f+1]-a[f]),y=Math.max(1,a[p+5]-a[p+4]),_=Math.max(1,o[10+g]-o[g]),v=Math.max(1,o[11+g]-o[1+g]);e.drawImage(s,a[f],a[p+4],m,y,o[g],o[1+g],_,v)}}});_d.prototype._cachedTint=16777215,_d.prototype._tintedCanvas=null,_d.prototype._cachedTexture=null,_d.prototype._renderCanvas=function(t){this.shader.uvMatrix&&(this.shader.uvMatrix.update(),this.calculateUvs()),this.material._renderCanvas?this.material._renderCanvas(t,this):hw||(hw=!0,self.console&&console.warn("Mesh with custom shaders are not supported in CanvasRenderer."))},_d.prototype._canvasPadding=null,Object.defineProperty(_d.prototype,"canvasPadding",{get:function(){return null!==this._canvasPadding?this._canvasPadding:Tt.MESH_CANVAS_PADDING},set:function(t){this._canvasPadding=t}}),Cg.prototype._renderCanvas=function(t){this.autoUpdate&&this.geometry.getBuffer("aVertexPosition").update(),this.shader.update&&this.shader.update(),this.calculateUvs(),this.material._renderCanvas(t,this)},Ig.prototype._renderCanvas=function(t){!this.autoUpdate&&this.geometry._width===this.shader.texture.height||(this.geometry._width=this.shader.texture.height,this.geometry.update()),this.shader.update&&this.shader.update(),this.calculateUvs(),this.material._renderCanvas(t,this)};var uw,cw=(gw.offsetPolygon=function(t,e){var i=[],n=t.length;e=gw.isPolygonClockwise(t)?e:-1*e;for(var r=0;r<n;r+=2){var s=r-2;s<0&&(s+=n);var o=(r+2)%n,a=t[r]-t[s],l=t[r+1]-t[s+1],h=Math.sqrt(a*a+l*l);a/=h,l/=h;var u=-(l*=e),c=a*=e,d=[t[s]+u,t[s+1]+c],p=[t[r]+u,t[r+1]+c],f=t[o]-t[r],g=t[1+o]-t[r+1];f/=h=Math.sqrt(f*f+g*g),g/=h;var m=-(g*=e),y=f*=e,_=[t[r]+m,t[r+1]+y],v=[t[o]+m,t[1+o]+y],b=gw.findIntersection(d[0],d[1],p[0],p[1],_[0],_[1],v[0],v[1]);b&&i.push.apply(i,b)}return i},gw.findIntersection=function(t,e,i,n,r,s,o,a){var l=(a-s)*(i-t)-(o-r)*(n-e),h=(o-r)*(e-s)-(a-s)*(t-r);if(0==l)return 0==h&&0==(i-t)*(e-s)-(n-e)*(t-r)?[(t+i)/2,(e+n)/2]:null;var u=h/l;return[t+u*(i-t),e+u*(n-e)]},gw.isPolygonClockwise=function(t){for(var e=0,i=0;i<t.length-2;i+=2)e+=(t[i+2]-t[i])*(t[i+3]+t[i+1]);return 0<e},gw),dw=(fw.prototype._calcCanvasStyle=function(t,e){var i;return t.texture&&t.texture.baseTexture!==Cs.WHITE.baseTexture?t.texture.valid?(i=$g.getTintedPattern(t.texture,e),this.setPatternTransform(i,t.matrix||Li.IDENTITY)):i="#808080":i="#"+("00000"+(0|e).toString(16)).substr(-6),i},fw.prototype.render=function(t){var e=this.renderer,i=e.context,n=t.worldAlpha,r=t.transform.worldTransform;e.setContextTransform(r),e.setBlendMode(t.blendMode);for(var s,o,a=t.geometry.graphicsData,l=(t.tint>>16&255)/255,h=(t.tint>>8&255)/255,u=(255&t.tint)/255,c=0;c<a.length;c++){var d=a[c],p=d.shape,f=d.fillStyle,g=d.lineStyle,m=0|d.fillStyle.color,y=0|d.lineStyle.color;if(d.matrix&&e.setContextTransform(r.copyTo(this._tempMatrix).append(d.matrix)),f.visible){var _=((m>>16&255)/255*l*255<<16)+((m>>8&255)/255*h*255<<8)+(255&m)/255*u*255;s=this._calcCanvasStyle(f,_)}if(g.visible){var v=((y>>16&255)/255*l*255<<16)+((y>>8&255)/255*h*255<<8)+(255&y)/255*u*255;o=this._calcCanvasStyle(g,v)}if(i.lineWidth=g.width,i.lineCap=g.cap,i.lineJoin=g.join,i.miterLimit=g.miterLimit,d.type===nt.SHAPES.POLY){i.beginPath();var b=(A=p).points,w=d.holes,S=void 0,x=void 0,T=void 0,I=void 0,P=void 0;i.moveTo(b[0],b[1]);for(var C=2;C<b.length;C+=2)i.lineTo(b[C],b[C+1]);if(A.closeStroke&&i.closePath(),0<w.length){for(P=[],T=b[S=0],I=b[1],C=2;C+2<b.length;C+=2)S+=(b[C]-T)*(b[C+3]-I)-(b[C+2]-T)*(b[C+1]-I);for(var E=0;E<w.length;E++)if(b=w[E].shape.points){for(T=b[x=0],I=b[1],C=2;C+2<b.length;C+=2)x+=(b[C]-T)*(b[C+3]-I)-(b[C+2]-T)*(b[C+1]-I);if(x*S<0)for(i.moveTo(b[0],b[1]),C=2;C<b.length;C+=2)i.lineTo(b[C],b[C+1]);else for(i.moveTo(b[b.length-2],b[b.length-1]),C=b.length-4;0<=C;C-=2)i.lineTo(b[C],b[C+1]);w[E].shape.closeStroke&&i.closePath(),P[E]=x*S<0}}f.visible&&(i.globalAlpha=f.alpha*n,i.fillStyle=s,i.fill()),g.visible&&this.paintPolygonStroke(A,g,o,w,P,n,i)}else if(d.type===nt.SHAPES.RECT){var A=p;if(f.visible&&(i.globalAlpha=f.alpha*n,i.fillStyle=s,i.fillRect(A.x,A.y,A.width,A.height)),g.visible){var M=g.width*(.5-(1-g.alignment)),B=A.width+2*M,R=A.height+2*M;i.globalAlpha=g.alpha*n,i.strokeStyle=o,i.strokeRect(A.x-M,A.y-M,B,R)}}else if(d.type===nt.SHAPES.CIRC)A=p,i.beginPath(),i.arc(A.x,A.y,A.radius,0,2*Math.PI),i.closePath(),f.visible&&(i.globalAlpha=f.alpha*n,i.fillStyle=s,i.fill()),g.visible&&(.5!==g.alignment&&(M=g.width*(.5-(1-g.alignment)),i.beginPath(),i.arc(A.x,A.y,A.radius+M,0,2*Math.PI),i.closePath()),i.globalAlpha=g.alpha*n,i.strokeStyle=o,i.stroke());else if(d.type===nt.SHAPES.ELIP){if(A=p,(H=1===g.alignment)||this.paintEllipse(A,f,g,s,n,i),g.visible){if(.5!==g.alignment){M=g.width*(.5-(1-g.alignment));var O=2*(A.width+M),k=2*(A.height+M),D=A.x-O/2,F=A.y-k/2,N=O/2*.5522848,L=k/2*.5522848,U=D+O,z=F+k,W=D+O/2,G=F+k/2;i.beginPath(),i.moveTo(D,G),i.bezierCurveTo(D,G-L,W-N,F,W,F),i.bezierCurveTo(W+N,F,U,G-L,U,G),i.bezierCurveTo(U,G+L,W+N,z,W,z),i.bezierCurveTo(W-N,z,D,G+L,D,G),i.closePath()}i.globalAlpha=g.alpha*n,i.strokeStyle=o,i.stroke()}H&&this.paintEllipse(A,f,g,s,n,i)}else if(d.type===nt.SHAPES.RREC){var H;if(A=p,(H=1===g.alignment)||this.paintRoundedRectangle(A,f,g,s,n,i),g.visible){if(.5!==g.alignment){B=A.width,R=A.height,M=g.width*(.5-(1-g.alignment));var X=A.x-M,j=A.y-M,V=A.width+2*M,Y=A.height+2*M,q=M*(1<=g.alignment?Math.min(V/B,Y/R):Math.min(B/V,R/Y)),K=A.radius+q,$=Math.min(V,Y)/2;K=$<K?$:K,i.beginPath(),i.moveTo(X,j+K),i.lineTo(X,j+Y-K),i.quadraticCurveTo(X,j+Y,X+K,j+Y),i.lineTo(X+V-K,j+Y),i.quadraticCurveTo(X+V,j+Y,X+V,j+Y-K),i.lineTo(X+V,j+K),i.quadraticCurveTo(X+V,j,X+V-K,j),i.lineTo(X+K,j),i.quadraticCurveTo(X,j,X,j+K),i.closePath()}i.globalAlpha=g.alpha*n,i.strokeStyle=o,i.stroke()}H&&this.paintRoundedRectangle(A,f,g,s,n,i)}}},fw.prototype.paintPolygonStroke=function(t,e,i,n,r,s,o){if(.5!==e.alignment){var a=e.width*(.5-(1-e.alignment)),l=cw.offsetPolygon(t.points,a),h=void 0;o.beginPath(),o.moveTo(l[0],l[1]);for(var u=2;u<l.length;u+=2)o.lineTo(l[u],l[u+1]);t.closeStroke&&o.closePath();for(var c=0;c<n.length;c++){if(h=n[c].shape.points,l=cw.offsetPolygon(h,a),r[c])for(o.moveTo(l[0],l[1]),u=2;u<l.length;u+=2)o.lineTo(l[u],l[u+1]);else for(o.moveTo(l[l.length-2],l[l.length-1]),u=l.length-4;0<=u;u-=2)o.lineTo(l[u],l[u+1]);n[c].shape.closeStroke&&o.closePath()}}o.globalAlpha=e.alpha*s,o.strokeStyle=i,o.stroke()},fw.prototype.paintEllipse=function(t,e,i,n,r,s){var o=2*t.width,a=2*t.height,l=t.x-o/2,h=t.y-a/2,u=o/2*.5522848,c=a/2*.5522848,d=l+o,p=h+a,f=l+o/2,g=h+a/2;s.beginPath(),s.moveTo(l,g),s.bezierCurveTo(l,g-c,f-u,h,f,h),s.bezierCurveTo(f+u,h,d,g-c,d,g),s.bezierCurveTo(d,g+c,f+u,p,f,p),s.bezierCurveTo(f-u,p,l,g+c,l,g),s.closePath(),0===i.alignment&&s.clip(),e.visible&&(s.globalAlpha=e.alpha*r,s.fillStyle=n,s.fill())},fw.prototype.paintRoundedRectangle=function(t,e,i,n,r,s){var o=t.x,a=t.y,l=t.width,h=t.height,u=t.radius,c=Math.min(l,h)/2;u=c<u?c:u,s.beginPath(),s.moveTo(o,a+u),s.lineTo(o,a+h-u),s.quadraticCurveTo(o,a+h,o+u,a+h),s.lineTo(o+l-u,a+h),s.quadraticCurveTo(o+l,a+h,o+l,a+h-u),s.lineTo(o+l,a+u),s.quadraticCurveTo(o+l,a,o+l-u,a),s.lineTo(o+u,a),s.quadraticCurveTo(o,a,o,a+u),s.closePath(),0===i.alignment&&s.clip(),e.visible&&(s.globalAlpha=e.alpha*r,s.fillStyle=n,s.fill())},fw.prototype.setPatternTransform=function(t,e){if(!1!==this._svgMatrix){if(!this._svgMatrix){var i=document.createElementNS("http://www.w3.org/2000/svg","svg");if(i&&i.createSVGMatrix&&(this._svgMatrix=i.createSVGMatrix()),!this._svgMatrix||!t.setTransform)return void(this._svgMatrix=!1)}this._svgMatrix.a=e.a,this._svgMatrix.b=e.b,this._svgMatrix.c=e.c,this._svgMatrix.d=e.d,this._svgMatrix.e=e.tx,this._svgMatrix.f=e.ty,t.setTransform(this._svgMatrix.inverse())}},fw.prototype.destroy=function(){this.renderer=null,this._svgMatrix=null,this._tempMatrix=null},fw),pw=new Li;function fw(t){this._svgMatrix=null,this._tempMatrix=new Li,this.renderer=t}function gw(){}Ku.prototype.generateCanvasTexture=function(t,e){void 0===e&&(e=1);var i=this.getLocalBounds(),n=Ls.create({width:i.width,height:i.height,scaleMode:t,resolution:e});uw=uw||new Kg,this.transform.updateLocalTransform(),this.transform.localTransform.copyTo(pw),pw.invert(),pw.tx-=i.x,pw.ty-=i.y,uw.render(this,{renderTexture:n,clear:!0,transform:pw});var r=Cs.from(n.baseTexture._canvasRenderTarget.canvas,{scaleMode:t});return r.baseTexture.setResolution(e),r},Ku.prototype.cachedGraphicsData=[],Ku.prototype._renderCanvas=function(t){!0!==this.isMask&&(this.finishPoly(),t.plugins.graphics.render(this))};var mw=new Li,yw=(_w.prototype.render=function(t){var e=t._texture,i=this.renderer,n=i.context;if(e.valid){var r=e._frame.width,s=e._frame.height,o=t.transform.worldTransform,a=0,l=0,h=e.baseTexture.getDrawableSource();if(!(e.orig.width<=0||e.orig.height<=0)&&e.valid&&h){i.setBlendMode(t.blendMode,!0),i.context.globalAlpha=t.worldAlpha;var u=e.baseTexture.scaleMode===nt.SCALE_MODES.LINEAR;i.smoothProperty&&i.context[i.smoothProperty]!==u&&(n[i.smoothProperty]=u),l=e.trim?(a=e.trim.width/2+e.trim.x-t.anchor.x*e.orig.width,e.trim.height/2+e.trim.y-t.anchor.y*e.orig.height):(a=(.5-t.anchor.x)*e.orig.width,(.5-t.anchor.y)*e.orig.height),e.rotate&&(o.copyTo(mw),o=mw,tn.matrixAppendRotationInv(o,e.rotate,a,l),l=a=0),a-=r/2,l-=s/2,i.setContextTransform(o,t.roundPixels,1),t.roundPixels&&(a|=0,l|=0);var c=e.baseTexture.resolution,d=i._outerBlend;d&&(n.save(),n.beginPath(),n.rect(a*i.resolution,l*i.resolution,r*i.resolution,s*i.resolution),n.clip()),16777215!==t.tint?(t._cachedTint===t.tint&&t._tintedCanvas.tintId===t._texture._updateID||(t._cachedTint=t.tint,t._tintedCanvas=$g.getTintedCanvas(t,t.tint)),n.drawImage(t._tintedCanvas,0,0,Math.floor(r*c),Math.floor(s*c),Math.floor(a*i.resolution),Math.floor(l*i.resolution),Math.floor(r*i.resolution),Math.floor(s*i.resolution))):n.drawImage(h,e._frame.x*c,e._frame.y*c,Math.floor(r*c),Math.floor(s*c),Math.floor(a*i.resolution),Math.floor(l*i.resolution),Math.floor(r*i.resolution),Math.floor(s*i.resolution)),d&&n.restore(),i.setBlendMode(nt.BLEND_MODES.NORMAL)}}},_w.prototype.destroy=function(){this.renderer=null},_w);function _w(t){this.renderer=t}tc.prototype._tintedCanvas=null,tc.prototype._renderCanvas=function(t){t.plugins.sprite.render(this)};var vw=new Bi,bw=(Sw.prototype.image=function(t,e,i){var n=new Image;return n.src=this.base64(t,e,i),n},Sw.prototype.base64=function(t,e,i){return this.canvas(t).toDataURL(e,i)},Sw.prototype.canvas=function(t){var e,i,n,r,s=this.renderer;t&&(r=t instanceof Ls?t:s.generateTexture(t)),r?(e=r.baseTexture._canvasRenderTarget.context,i=r.baseTexture._canvasRenderTarget.resolution,n=r.frame):(e=s.rootContext,i=s.resolution,(n=vw).width=this.renderer.width,n.height=this.renderer.height);var o=Math.floor(n.width*i+1e-4),a=Math.floor(n.height*i+1e-4),l=new vi(o,a,1),h=e.getImageData(n.x*i,n.y*i,o,a);return l.context.putImageData(h,0,0),l.canvas},Sw.prototype.pixels=function(t){var e,i,n,r,s=this.renderer;t&&(r=t instanceof Ls?t:s.generateTexture(t)),r?(e=r.baseTexture._canvasRenderTarget.context,i=r.baseTexture._canvasRenderTarget.resolution,n=r.frame):(e=s.rootContext,i=s.resolution,(n=vw).width=s.width,n.height=s.height);var o=n.x*i,a=n.y*i,l=n.width*i,h=n.height*i;return e.getImageData(o,a,l,h).data},Sw.prototype.destroy=function(){this.renderer=null},Sw),ww=function(t,e){return(ww=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)};function Sw(t){this.renderer=t}function xw(t,e){var i=t;if(e instanceof $r){var n=e.source,r=0===n.width?i.canvas.width:Math.min(i.canvas.width,n.width),s=0===n.height?i.canvas.height:Math.min(i.canvas.height,n.height);return i.ctx.drawImage(n,0,0,r,s,0,0,i.canvas.width,i.canvas.height),!0}return!1}var Tw,Iw,Pw,Cw=(ww(Iw=Bw,Pw=Tw=Dc),Iw.prototype=null===Pw?Object.create(Pw):(Rw.prototype=Pw.prototype,new Rw),Bw.prototype.destroy=function(){Tw.prototype.destroy.call(this),this.ctx=null,this.canvas=null},Bw),Ew=new Li,Aw=new Li,Mw=[new Fi,new Fi,new Fi,new Fi];function Bw(t){var e=Tw.call(this,t)||this;return(e.uploadHookHelper=e).canvas=document.createElement("canvas"),e.canvas.width=16,e.canvas.height=16,e.ctx=e.canvas.getContext("2d"),e.registerUploadHook(xw),e}function Rw(){this.constructor=Iw}return nd.prototype._renderCanvas=function(t){var e=this._texture;if(e.baseTexture.valid){var i=t.context,n=this.worldTransform,r=e.baseTexture,s=r.getDrawableSource(),o=r.resolution;if(this._textureID!==this._texture._updateID||this._cachedTint!==this.tint){this._textureID=this._texture._updateID;var a=new vi(e._frame.width,e._frame.height,o);16777215!==this.tint?(this._tintedCanvas=$g.getTintedCanvas(this,this.tint),a.context.drawImage(this._tintedCanvas,0,0)):a.context.drawImage(s,-e._frame.x*o,-e._frame.y*o),this._cachedTint=this.tint,this._canvasPattern=a.context.createPattern(a.canvas,"repeat")}i.globalAlpha=this.worldAlpha,t.setBlendMode(this.blendMode),this.tileTransform.updateLocalTransform();var l=this.tileTransform.localTransform,h=this._width,u=this._height;Ew.identity(),Aw.copyFrom(l),this.uvRespectAnchor||Aw.translate(-this.anchor.x*h,-this.anchor.y*u),Ew.prepend(Aw),Ew.prepend(n),t.setContextTransform(Ew),i.fillStyle=this._canvasPattern;var c=this.anchor.x*-h,d=this.anchor.y*-u;Mw[0].set(c,d),Mw[1].set(c+h,d),Mw[2].set(c+h,d+u),Mw[3].set(c,d+u);for(var p=0;p<4;p++)Aw.applyInverse(Mw[p],Mw[p]);for(i.beginPath(),i.moveTo(Mw[0].x,Mw[0].y),p=1;p<4;p++)i.lineTo(Mw[p].x,Mw[p].y);i.closePath(),i.fill()}},iu.prototype.renderCanvas=function(t){if(this.visible&&!(this.worldAlpha<=0)&&this.children.length&&this.renderable){var e=t.context,i=this.worldTransform,n=!0,r=0,s=0,o=0,a=0;t.setBlendMode(this.blendMode),e.globalAlpha=this.worldAlpha,this.displayObjectUpdateTransform();for(var l=0;l<this.children.length;++l){var h=this.children[l];if(h.visible&&h._texture.valid){var u=h._texture.frame;if(e.globalAlpha=this.worldAlpha*h.alpha,h.rotation%(2*Math.PI)==0)n&&(t.setContextTransform(i,!1,1),n=!1),r=h.anchor.x*(-u.width*h.scale.x)+h.position.x+.5,s=h.anchor.y*(-u.height*h.scale.y)+h.position.y+.5,o=u.width*h.scale.x,a=u.height*h.scale.y;else{n=n||!0,h.displayObjectUpdateTransform();var c=h.worldTransform;t.setContextTransform(c,this.roundPixels,1),r=h.anchor.x*-u.width+.5,s=h.anchor.y*-u.height+.5,o=u.width,a=u.height}var d=h._texture.baseTexture.resolution;e.drawImage(h._texture.baseTexture.getDrawableSource(),u.x*d,u.y*d,u.width*d,u.height*d,r*t.resolution,s*t.resolution,o*t.resolution,a*t.resolution)}}}},tr.prototype._renderCanvas=function(t){},tr.prototype.renderCanvas=function(t){if(this.visible&&!(this.worldAlpha<=0)&&this.renderable){this._mask&&t.maskManager.pushMask(this._mask),this._renderCanvas(t);for(var e=0,i=this.children.length;e<i;++e)this.children[e].renderCanvas(t);this._mask&&t.maskManager.popMask(t)}},qn.prototype.renderCanvas=function(t){},Sc.prototype._renderCanvas=function(t){this._autoResolution&&this._resolution!==t.resolution&&(this._resolution=t.resolution,this.dirty=!0),this.updateText(!0),tc.prototype._renderCanvas.call(this,t)},Kg.registerPlugin("accessibility",rr),Kg.registerPlugin("extract",bw),Kg.registerPlugin("graphics",dw),Kg.registerPlugin("interaction",Pr),Kg.registerPlugin("mesh",aw),Kg.registerPlugin("prepare",Cw),Kg.registerPlugin("sprite",yw),nt.AbstractBatchRenderer=ml,nt.AbstractMultiResource=Qr,nt.AbstractRenderer=$a,nt.AccessibilityManager=rr,nt.AnimatedSprite=Mg,nt.AppLoaderPlugin=fh,nt.Application=kl,nt.ArrayResource=Jr,nt.Attribute=zs,nt.BaseImageResource=Zr,nt.BasePrepare=Dc,nt.BaseRenderTexture=Ts,nt.BaseTexture=$r,nt.BatchDrawCall=al,nt.BatchGeometry=_l,nt.BatchPluginFactory=wl,nt.BatchRenderer=Sl,nt.BatchShaderGenerator=yl,nt.BatchSystem=no,nt.BatchTextureArray=fl,nt.BitmapFont=Hd,nt.BitmapFontData=cd,nt.BitmapFontLoader=qd,nt.BitmapText=Yd,nt.BlobResource=Mh,nt.Bounds=rn,nt.Buffer=Gs,nt.BufferResource=qr,nt.CanvasExtract=bw,nt.CanvasGraphicsRenderer=dw,nt.CanvasMeshRenderer=aw,nt.CanvasPrepare=Cw,nt.CanvasRenderer=Kg,nt.CanvasResource=ts,nt.CanvasSpriteRenderer=yw,nt.Circle=Ri,nt.CompressedTextureLoader=Rh,nt.CompressedTextureResource=Bh,nt.Container=tr,nt.ContextSystem=so,nt.CountLimiter=Pc,nt.CubeResource=es,nt.DDSLoader=Gh,nt.DEG_TO_RAD=Mi,nt.DisplayObject=qn,nt.Ellipse=Oi,nt.Extract=Ul,nt.FORMATS_TO_COMPONENTS=Vh,nt.FillStyle=hu,nt.Filter=ra,nt.FilterState=Js,nt.FilterSystem=eo,nt.Framebuffer=xs,nt.FramebufferSystem=ao,nt.GLFramebuffer=ks,nt.GLProgram=Da,nt.GLTexture=La,nt.GRAPHICS_CURVES=lu,nt.Geometry=Ys,nt.GeometrySystem=ho,nt.Graphics=Ku,nt.GraphicsData=Gu,nt.GraphicsGeometry=ju,nt.IGLUniformData=function(){},nt.INSTALLED=Br,nt.INTERNAL_FORMAT_TO_BYTES_PER_PIXEL=vh,nt.ImageBitmapResource=ss,nt.ImageResource=is,nt.InteractionData=hr,nt.InteractionEvent=cr,nt.InteractionManager=Pr,nt.InteractionTrackingData=dr,nt.KTXLoader=qh,nt.LineStyle=Vu,nt.Loader=hh,nt.MaskData=uo,nt.MaskSystem=la,nt.Matrix=Li,nt.Mesh=_d,nt.MeshBatchUvs=gd,nt.MeshGeometry=bd,nt.MeshMaterial=vd,nt.NineSlicePlane=Eg,nt.ObjectRenderer=io,nt.ObservablePoint=Ni,nt.PI_2=Ei,nt.ParticleContainer=iu,nt.ParticleRenderer=ru,nt.PlaneGeometry=xg,nt.Point=Fi,nt.Polygon=ki,nt.Prepare=Hc,nt.Program=ea,nt.ProjectionSystem=pa,nt.Quad=qs,nt.QuadUv=Ks,nt.RAD_TO_DEG=Ai,nt.Rectangle=Bi,nt.RenderTexture=Ls,nt.RenderTexturePool=Us,nt.RenderTextureSystem=ma,nt.Renderer=Ja,nt.Resource=Yr,nt.RopeGeometry=Tg,nt.RoundedRectangle=Di,nt.Runner=Cr,nt.SVGResource=ns,nt.ScissorSystem=ca,nt.Shader=ia,nt.ShaderSystem=Xa,nt.SimpleMesh=Cg,nt.SimplePlane=Pg,nt.SimpleRope=Ig,nt.Sprite=tc,nt.SpriteMaskFilter=aa,nt.Spritesheet=jc,nt.SpritesheetLoader=Vc,nt.State=na,nt.StateSystem=ja,nt.StencilSystem=da,nt.System=pl,nt.TYPES_TO_BYTES_PER_COMPONENT=jh,nt.TYPES_TO_BYTES_PER_PIXEL=Yh,nt.TemporaryDisplayObject=Kn,nt.Text=Sc,nt.TextMetrics=gc,nt.TextStyle=uc,nt.Texture=Cs,nt.TextureGCSystem=Va,nt.TextureLoader=gh,nt.TextureMatrix=oa,nt.TextureSystem=Ya,nt.TextureUvs=Is,nt.Ticker=ar,nt.TickerPlugin=lr,nt.TilingSprite=nd,nt.TilingSpriteRenderer=od,nt.TimeLimiter=Xc,nt.Transform=en,nt.UniformGroup=Qs,nt.VERSION="6.2.1",nt.VideoResource=rs,nt.ViewableBuffer=gl,nt.accessibleTarget=ir,nt.autoDetectRenderer=ol,nt.autoDetectResource=Rr,nt.canvasUtils=$g,nt.checkMaxIfStatementsInShader=qo,nt.createUBOElements=Ra,nt.defaultFilterVertex=dl,nt.defaultVertex=cl,nt.filters=Ug,nt.generateProgram=Na,nt.generateUniformBufferSync=ka,nt.getTestContext=Do,nt.getUBOData=Oa,nt.graphicsUtils=$u,nt.groupD8=tn,nt.interactiveTarget=fr,nt.isMobile=wt,nt.resources=xl,nt.settings=Tt,nt.systems=Ol,nt.uniformParsers=Ho,nt.utils=Ci,nt}({});this.PIXI=this.PIXI||{},this.PIXI.sound=function(i,s,l,f){"use strict";var t;function g(){return t}var n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)};function e(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function i(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}var m=function(){return(m=Object.assign||function(t){for(var e,i=1,n=arguments.length;i<n;i++)for(var r in e=arguments[i])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t}).apply(this,arguments)},a=["mp3","ogg","oga","opus","mpeg","wav","m4a","aiff","wma","mid","caf"],c={};function r(t){var n=m({m4a:"audio/mp4",oga:"audio/ogg",opus:'audio/ogg; codecs="opus"',caf:'audio/x-caf; codecs="opus"'},t||{}),r=document.createElement("audio"),s={},o=/^no$/;a.forEach(function(t){var e=r.canPlayType("audio/"+t).replace(o,""),i=n[t]?r.canPlayType(n[t]).replace(o,""):"";s[t]=!!e||!!i}),Object.assign(c,s)}r();var d=/\.(\{([^\}]+)\})(\?.*)?$/;function o(t){var e=d,i="string"==typeof t?t:t.url;if(!e.test(i))return i;for(var n=e.exec(i),r=n[2].split(","),s=r[r.length-1],o=0,a=r.length;o<a;o++){var l=r[o];if(c[l]){s=l;break}}var h=i.replace(n[1],s);if("string"!=typeof t){var u=t;u.extension=s,u.url=h}return h}var h,u,p,y,_,v,b,w,S,x,T,I,P=(ct.add=function(){ct.setLegacy(g().useLegacy)},ct.setLegacy=function(t){var e=a;t?e.forEach(function(t){i.LoaderResource.setExtensionXhrType(t,i.LoaderResource.XHR_RESPONSE_TYPE.DEFAULT),i.LoaderResource.setExtensionLoadType(t,i.LoaderResource.LOAD_TYPE.AUDIO)}):e.forEach(function(t){i.LoaderResource.setExtensionXhrType(t,i.LoaderResource.XHR_RESPONSE_TYPE.BUFFER),i.LoaderResource.setExtensionLoadType(t,i.LoaderResource.LOAD_TYPE.XHR)})},ct.pre=function(t,e){o(t),e()},ct.use=function(t,e){t.data&&-1<a.indexOf(t.extension)?t.sound=g().add(t.name,{loaded:e,preload:!0,url:t.url,source:t.data}):e()},ct),C=0,E=(e(ut,I=s.EventEmitter),ut.prototype.set=function(t,e){if(void 0===this[t])throw new Error("Property with name "+t+" does not exist.");switch(t){case"speed":this.speed=e;break;case"volume":this.volume=e;break;case"paused":this.paused=e;break;case"loop":this.loop=e;break;case"muted":this.muted=e}return this},Object.defineProperty(ut.prototype,"progress",{get:function(){return this._source.currentTime/this._duration},enumerable:!1,configurable:!0}),Object.defineProperty(ut.prototype,"paused",{get:function(){return this._paused},set:function(t){this._paused=t,this.refreshPaused()},enumerable:!1,configurable:!0}),ut.prototype._onPlay=function(){this._playing=!0},ut.prototype._onPause=function(){this._playing=!1},ut.prototype.init=function(t){this._playing=!1,this._duration=t.source.duration;var e=this._source=t.source.cloneNode(!1);e.src=t.parent.url,e.onplay=this._onPlay.bind(this),e.onpause=this._onPause.bind(this),t.context.on("refresh",this.refresh,this),t.context.on("refreshPaused",this.refreshPaused,this),this._media=t},ut.prototype._internalStop=function(){this._source&&this._playing&&(this._source.onended=null,this._source.pause())},ut.prototype.stop=function(){this._internalStop(),this._source&&this.emit("stop")},Object.defineProperty(ut.prototype,"speed",{get:function(){return this._speed},set:function(t){this._speed=t,this.refresh()},enumerable:!1,configurable:!0}),Object.defineProperty(ut.prototype,"volume",{get:function(){return this._volume},set:function(t){this._volume=t,this.refresh()},enumerable:!1,configurable:!0}),Object.defineProperty(ut.prototype,"loop",{get:function(){return this._loop},set:function(t){this._loop=t,this.refresh()},enumerable:!1,configurable:!0}),Object.defineProperty(ut.prototype,"muted",{get:function(){return this._muted},set:function(t){this._muted=t,this.refresh()},enumerable:!1,configurable:!0}),ut.prototype.refresh=function(){var t=this._media.context,e=this._media.parent;this._source.loop=this._loop||e.loop;var i=t.volume*(t.muted?0:1),n=e.volume*(e.muted?0:1),r=this._volume*(this._muted?0:1);this._source.volume=r*i*n,this._source.playbackRate=this._speed*t.speed*e.speed},ut.prototype.refreshPaused=function(){var t=this._media.context,e=this._media.parent,i=this._paused||e.paused||t.paused;i!==this._pausedReal&&((this._pausedReal=i)?(this._internalStop(),this.emit("paused")):(this.emit("resumed"),this.play({start:this._source.currentTime,end:this._end,volume:this._volume,speed:this._speed,loop:this._loop})),this.emit("pause",i))},ut.prototype.play=function(t){var e=this,i=t.start,n=t.end,r=t.speed,s=t.loop,o=t.volume,a=t.muted;this._speed=r,this._volume=o,this._loop=!!s,this._muted=a,this.refresh(),this.loop&&null!==n&&(this.loop=!1),this._start=i,this._end=n||this._duration,this._start=Math.max(0,this._start-ut.PADDING),this._end=Math.min(this._end+ut.PADDING,this._duration),this._source.onloadedmetadata=function(){e._source&&(e._source.currentTime=i,e._source.onloadedmetadata=null,e.emit("progress",i,e._duration),l.Ticker.shared.add(e._onUpdate,e))},this._source.onended=this._onComplete.bind(this),this._source.play(),this.emit("start")},ut.prototype._onUpdate=function(){this.emit("progress",this.progress,this._duration),this._source.currentTime>=this._end&&!this._source.loop&&this._onComplete()},ut.prototype._onComplete=function(){l.Ticker.shared.remove(this._onUpdate,this),this._internalStop(),this.emit("progress",1,this._duration),this.emit("end",this)},ut.prototype.destroy=function(){l.Ticker.shared.remove(this._onUpdate,this),this.removeAllListeners();var t=this._source;t&&(t.onended=null,t.onplay=null,t.onpause=null,this._internalStop()),this._source=null,this._speed=1,this._volume=1,this._loop=!1,this._end=null,this._start=0,this._duration=0,this._playing=!1,this._pausedReal=!1,this._paused=!1,this._muted=!1,this._media&&(this._media.context.off("refresh",this.refresh,this),this._media.context.off("refreshPaused",this.refreshPaused,this),this._media=null)},ut.prototype.toString=function(){return"[HTMLAudioInstance id="+this.id+"]"},ut.PADDING=.1,ut),A=(e(ht,T=s.EventEmitter),ht.prototype.init=function(t){this.parent=t,this._source=t.options.source||new Audio,t.url&&(this._source.src=t.url)},ht.prototype.create=function(){return new E(this)},Object.defineProperty(ht.prototype,"isPlayable",{get:function(){return!!this._source&&4===this._source.readyState},enumerable:!1,configurable:!0}),Object.defineProperty(ht.prototype,"duration",{get:function(){return this._source.duration},enumerable:!1,configurable:!0}),Object.defineProperty(ht.prototype,"context",{get:function(){return this.parent.context},enumerable:!1,configurable:!0}),Object.defineProperty(ht.prototype,"filters",{get:function(){return null},set:function(t){},enumerable:!1,configurable:!0}),ht.prototype.destroy=function(){this.removeAllListeners(),this.parent=null,this._source&&(this._source.src="",this._source.load(),this._source=null)},Object.defineProperty(ht.prototype,"source",{get:function(){return this._source},enumerable:!1,configurable:!0}),ht.prototype.load=function(e){var i=this._source,n=this.parent;if(4!==i.readyState)if(n.url){i.src=n.url;var t=function(){o(),n.isLoaded=!0;var t=n.autoPlayStart();e&&e(null,n,t)},r=function(){o(),e&&e(new Error("Sound loading has been aborted"))},s=function(){o();var t="Failed to load audio element (code: "+i.error.code+")";e&&e(new Error(t))},o=function(){i.removeEventListener("canplaythrough",t),i.removeEventListener("load",t),i.removeEventListener("abort",r),i.removeEventListener("error",s)};i.addEventListener("canplaythrough",t,!1),i.addEventListener("load",t,!1),i.addEventListener("abort",r,!1),i.addEventListener("error",s,!1),i.load()}else e(new Error("sound.url or sound.source must be set"));else{n.isLoaded=!0;var a=n.autoPlayStart();e&&setTimeout(function(){e(null,n,a)},0)}},ht),M=(lt.prototype.play=function(t){return this.parent.play({complete:t,speed:this.speed||this.parent.speed,end:this.end,start:this.start,loop:this.loop})},lt.prototype.destroy=function(){this.parent=null},lt),B=(at.setParamValue=function(t,e){if(t.setValueAtTime){var i=g().context;t.setValueAtTime(e,i.audioContext.currentTime)}else t.value=e;return e},at),R=0,O=(e(ot,x=s.EventEmitter),ot.prototype.set=function(t,e){if(void 0===this[t])throw new Error("Property with name "+t+" does not exist.");switch(t){case"speed":this.speed=e;break;case"volume":this.volume=e;break;case"muted":this.muted=e;break;case"loop":this.loop=e;break;case"paused":this.paused=e}return this},ot.prototype.stop=function(){this._source&&(this._internalStop(),this.emit("stop"))},Object.defineProperty(ot.prototype,"speed",{get:function(){return this._speed},set:function(t){this._speed=t,this.refresh(),this._update(!0)},enumerable:!1,configurable:!0}),Object.defineProperty(ot.prototype,"volume",{get:function(){return this._volume},set:function(t){this._volume=t,this.refresh()},enumerable:!1,configurable:!0}),Object.defineProperty(ot.prototype,"muted",{get:function(){return this._muted},set:function(t){this._muted=t,this.refresh()},enumerable:!1,configurable:!0}),Object.defineProperty(ot.prototype,"loop",{get:function(){return this._loop},set:function(t){this._loop=t,this.refresh()},enumerable:!1,configurable:!0}),ot.prototype.refresh=function(){if(this._source){var t=this._media.context,e=this._media.parent;this._source.loop=this._loop||e.loop;var i=t.volume*(t.muted?0:1),n=e.volume*(e.muted?0:1),r=this._volume*(this._muted?0:1);B.setParamValue(this._gain.gain,r*n*i),B.setParamValue(this._source.playbackRate,this._speed*e.speed*t.speed)}},ot.prototype.refreshPaused=function(){var t=this._media.context,e=this._media.parent,i=this._paused||e.paused||t.paused;i!==this._pausedReal&&((this._pausedReal=i)?(this._internalStop(),this.emit("paused")):(this.emit("resumed"),this.play({start:this._elapsed%this._duration,end:this._end,speed:this._speed,loop:this._loop,volume:this._volume})),this.emit("pause",i))},ot.prototype.play=function(t){var e=t.start,i=t.end,n=t.speed,r=t.loop,s=t.volume,o=t.muted;this._paused=!1;var a=this._media.nodes.cloneBufferSource(),l=a.source,h=a.gain;this._source=l,this._gain=h,this._speed=n,this._volume=s,this._loop=!!r,this._muted=o,this.refresh();var u=this._source.buffer.duration;this._duration=u,this._end=i,this._lastUpdate=this._now(),this._elapsed=e,this._source.onended=this._onComplete.bind(this),this._loop?(this._source.loopEnd=i,this._source.loopStart=e,this._source.start(0,e)):i?this._source.start(0,e,i-e):this._source.start(0,e),this.emit("start"),this._update(!0),this.enableTicker(!0)},ot.prototype.enableTicker=function(t){l.Ticker.shared.remove(this._updateListener,this),t&&l.Ticker.shared.add(this._updateListener,this)},Object.defineProperty(ot.prototype,"progress",{get:function(){return this._progress},enumerable:!1,configurable:!0}),Object.defineProperty(ot.prototype,"paused",{get:function(){return this._paused},set:function(t){this._paused=t,this.refreshPaused()},enumerable:!1,configurable:!0}),ot.prototype.destroy=function(){this.removeAllListeners(),this._internalStop(),this._gain&&(this._gain.disconnect(),this._gain=null),this._media&&(this._media.context.events.off("refresh",this.refresh,this),this._media.context.events.off("refreshPaused",this.refreshPaused,this),this._media=null),this._end=null,this._speed=1,this._volume=1,this._loop=!1,this._elapsed=0,this._duration=0,this._paused=!1,this._muted=!1,this._pausedReal=!1},ot.prototype.toString=function(){return"[WebAudioInstance id="+this.id+"]"},ot.prototype._now=function(){return this._media.context.audioContext.currentTime},ot.prototype._updateListener=function(){this._update()},ot.prototype._update=function(t){if(void 0===t&&(t=!1),this._source){var e=this._now(),i=e-this._lastUpdate;if(0<i||t){var n=this._source.playbackRate.value;this._elapsed+=i*n,this._lastUpdate=e;var r=this._duration,s=void 0;if(this._source.loopStart){var o=this._source.loopEnd-this._source.loopStart;s=(this._source.loopStart+this._elapsed%o)/r}else s=this._elapsed%r/r;this._progress=s,this.emit("progress",this._progress,r)}}},ot.prototype.init=function(t){(this._media=t).context.events.on("refresh",this.refresh,this),t.context.events.on("refreshPaused",this.refreshPaused,this)},ot.prototype._internalStop=function(){if(this._source){this.enableTicker(!1),this._source.onended=null,this._source.stop(0),this._source.disconnect();try{this._source.buffer=null}catch(t){}this._source=null}},ot.prototype._onComplete=function(){if(this._source){this.enableTicker(!1),this._source.onended=null,this._source.disconnect();try{this._source.buffer=null}catch(t){}}this._source=null,this._progress=1,this.emit("progress",1,this._duration),this.emit("end",this)},ot),k=(Object.defineProperty(st.prototype,"destination",{get:function(){return this._input},enumerable:!1,configurable:!0}),Object.defineProperty(st.prototype,"filters",{get:function(){return this._filters},set:function(t){var e=this;if(this._filters&&(this._filters.forEach(function(t){t&&t.disconnect()}),this._filters=null,this._input.connect(this._output)),t&&t.length){this._filters=t.slice(0),this._input.disconnect();var i=null;t.forEach(function(t){null===i?e._input.connect(t.destination):i.connect(t.destination),i=t}),i.connect(this._output)}},enumerable:!1,configurable:!0}),st.prototype.destroy=function(){this.filters=null,this._input=null,this._output=null},st),D=(e(rt,S=k),Object.defineProperty(rt.prototype,"script",{get:function(){return this._script||(this._script=this.context.audioContext.createScriptProcessor(rt.BUFFER_SIZE),this._script.connect(this.context.destination)),this._script},enumerable:!1,configurable:!0}),rt.prototype.destroy=function(){S.prototype.destroy.call(this),this.bufferSource.disconnect(),this._script&&this._script.disconnect(),this.gain.disconnect(),this.analyser.disconnect(),this.bufferSource=null,this._script=null,this.gain=null,this.analyser=null,this.context=null},rt.prototype.cloneBufferSource=function(){var t=this.bufferSource,e=this.context.audioContext.createBufferSource();e.buffer=t.buffer,B.setParamValue(e.playbackRate,t.playbackRate.value),e.loop=t.loop;var i=this.context.audioContext.createGain();return e.connect(i),i.connect(this.destination),{source:e,gain:i}},Object.defineProperty(rt.prototype,"bufferSize",{get:function(){return this.script.bufferSize},enumerable:!1,configurable:!0}),rt.BUFFER_SIZE=0,rt),F=(nt.prototype.init=function(t){this.parent=t,this._nodes=new D(this.context),this._source=this._nodes.bufferSource,this.source=t.options.source},nt.prototype.destroy=function(){this.parent=null,this._nodes.destroy(),this._nodes=null;try{this._source.buffer=null}catch(t){}this._source=null,this.source=null},nt.prototype.create=function(){return new O(this)},Object.defineProperty(nt.prototype,"context",{get:function(){return this.parent.context},enumerable:!1,configurable:!0}),Object.defineProperty(nt.prototype,"isPlayable",{get:function(){return!!this._source&&!!this._source.buffer},enumerable:!1,configurable:!0}),Object.defineProperty(nt.prototype,"filters",{get:function(){return this._nodes.filters},set:function(t){this._nodes.filters=t},enumerable:!1,configurable:!0}),Object.defineProperty(nt.prototype,"duration",{get:function(){return this._source.buffer.duration},enumerable:!1,configurable:!0}),Object.defineProperty(nt.prototype,"buffer",{get:function(){return this._source.buffer},set:function(t){this._source.buffer=t},enumerable:!1,configurable:!0}),Object.defineProperty(nt.prototype,"nodes",{get:function(){return this._nodes},enumerable:!1,configurable:!0}),nt.prototype.load=function(t){this.source?this._decode(this.source,t):this.parent.url?this._loadUrl(t):t&&t(new Error("sound.url or sound.source must be set"))},nt.prototype._loadUrl=function(t){var e=this,i=new XMLHttpRequest,n=this.parent.url;i.open("GET",n,!0),i.responseType="arraybuffer",i.onload=function(){e.source=i.response,e._decode(i.response,t)},i.send()},nt.prototype._decode=function(t,n){var r=this;this.parent.context.decode(t,function(t,e){if(t)n&&n(t);else{r.parent.isLoaded=!0,r.buffer=e;var i=r.parent.autoPlayStart();n&&n(null,r.parent,i)}})},nt),N=(it.from=function(t){var e={};return"string"==typeof t?e.url=t:t instanceof ArrayBuffer||t instanceof HTMLAudioElement?e.source=t:e=t,(e=m({autoPlay:!1,singleInstance:!1,url:null,source:null,preload:!1,volume:1,speed:1,complete:null,loaded:null,loop:!1},e)).url&&(e.url=o(e.url)),Object.freeze(e),new it(g().useLegacy?new A:new F,e)},Object.defineProperty(it.prototype,"context",{get:function(){return g().context},enumerable:!1,configurable:!0}),it.prototype.pause=function(){return this.isPlaying=!1,this.paused=!0,this},it.prototype.resume=function(){return this.isPlaying=0<this._instances.length,this.paused=!1,this},Object.defineProperty(it.prototype,"paused",{get:function(){return this._paused},set:function(t){this._paused=t,this.refreshPaused()},enumerable:!1,configurable:!0}),Object.defineProperty(it.prototype,"speed",{get:function(){return this._speed},set:function(t){this._speed=t,this.refresh()},enumerable:!1,configurable:!0}),Object.defineProperty(it.prototype,"filters",{get:function(){return this.media.filters},set:function(t){this.media.filters=t},enumerable:!1,configurable:!0}),it.prototype.addSprites=function(t,e){if("object"==typeof t){var i={};for(var n in t)i[n]=this.addSprites(n,t[n]);return i}var r=new M(this,e);return this._sprites[t]=r},it.prototype.destroy=function(){this._removeInstances(),this.removeSprites(),this.media.destroy(),this.media=null,this._sprites=null,this._instances=null},it.prototype.removeSprites=function(t){if(t){var e=this._sprites[t];void 0!==e&&(e.destroy(),delete this._sprites[t])}else for(var i in this._sprites)this.removeSprites(i);return this},Object.defineProperty(it.prototype,"isPlayable",{get:function(){return this.isLoaded&&this.media&&this.media.isPlayable},enumerable:!1,configurable:!0}),it.prototype.stop=function(){if(!this.isPlayable)return this.autoPlay=!1,this._autoPlayOptions=null,this;this.isPlaying=!1;for(var t=this._instances.length-1;0<=t;t--)this._instances[t].stop();return this},it.prototype.play=function(t,e){var s,i=this;if("string"==typeof t?s={sprite:r=t,loop:this.loop,complete:e}:"function"==typeof t?(s={}).complete=t:s=t,(s=m({complete:null,loaded:null,sprite:null,end:null,start:0,volume:1,speed:1,muted:!1,loop:!1},s||{})).sprite){var n=s.sprite,r=this._sprites[n];s.start=r.start+(s.start||0),s.end=r.end,s.speed=r.speed||1,s.loop=r.loop||s.loop,delete s.sprite}if(s.offset&&(s.start=s.offset),!this.isLoaded)return new Promise(function(n,r){i.autoPlay=!0,i._autoPlayOptions=s,i._preload(function(t,e,i){t?r(t):(s.loaded&&s.loaded(t,e,i),n(i))})});this.singleInstance&&this._removeInstances();var o=this._createInstance();return this._instances.push(o),this.isPlaying=!0,o.once("end",function(){s.complete&&s.complete(i),i._onComplete(o)}),o.once("stop",function(){i._onComplete(o)}),o.play(s),o},it.prototype.refresh=function(){for(var t=this._instances.length,e=0;e<t;e++)this._instances[e].refresh()},it.prototype.refreshPaused=function(){for(var t=this._instances.length,e=0;e<t;e++)this._instances[e].refreshPaused()},Object.defineProperty(it.prototype,"volume",{get:function(){return this._volume},set:function(t){this._volume=t,this.refresh()},enumerable:!1,configurable:!0}),Object.defineProperty(it.prototype,"muted",{get:function(){return this._muted},set:function(t){this._muted=t,this.refresh()},enumerable:!1,configurable:!0}),Object.defineProperty(it.prototype,"loop",{get:function(){return this._loop},set:function(t){this._loop=t,this.refresh()},enumerable:!1,configurable:!0}),it.prototype._preload=function(t){this.media.load(t)},Object.defineProperty(it.prototype,"instances",{get:function(){return this._instances},enumerable:!1,configurable:!0}),Object.defineProperty(it.prototype,"sprites",{get:function(){return this._sprites},enumerable:!1,configurable:!0}),Object.defineProperty(it.prototype,"duration",{get:function(){return this.media.duration},enumerable:!1,configurable:!0}),it.prototype.autoPlayStart=function(){var t;return this.autoPlay&&(t=this.play(this._autoPlayOptions)),t},it.prototype._removeInstances=function(){for(var t=this._instances.length-1;0<=t;t--)this._poolInstance(this._instances[t]);this._instances.length=0},it.prototype._onComplete=function(t){if(this._instances){var e=this._instances.indexOf(t);-1<e&&this._instances.splice(e,1),this.isPlaying=0<this._instances.length}this._poolInstance(t)},it.prototype._createInstance=function(){if(0<it._pool.length){var t=it._pool.pop();return t.init(this.media),t}return this.media.create()},it.prototype._poolInstance=function(t){t.destroy(),it._pool.indexOf(t)<0&&it._pool.push(t)},it._pool=[],it),L=(e(et,w=s.EventEmitter),et.prototype.refresh=function(){this.emit("refresh")},et.prototype.refreshPaused=function(){this.emit("refreshPaused")},Object.defineProperty(et.prototype,"filters",{get:function(){return null},set:function(t){},enumerable:!1,configurable:!0}),Object.defineProperty(et.prototype,"audioContext",{get:function(){return null},enumerable:!1,configurable:!0}),et.prototype.toggleMute=function(){return this.muted=!this.muted,this.refresh(),this.muted},et.prototype.togglePause=function(){return this.paused=!this.paused,this.refreshPaused(),this.paused},et.prototype.destroy=function(){this.removeAllListeners()},et),U=(e(tt,b=k),tt.prototype._unlock=function(){this._unlocked||(this.playEmptySound(),"running"===this._ctx.state&&(document.removeEventListener("mousedown",this._unlock,!0),document.removeEventListener("touchend",this._unlock,!0),document.removeEventListener("touchstart",this._unlock,!0),this._unlocked=!0))},tt.prototype.playEmptySound=function(){var t=this._ctx.createBufferSource();t.buffer=this._ctx.createBuffer(1,1,22050),t.connect(this._ctx.destination),t.start(0,0,0),"suspended"===t.context.state&&t.context.resume()},Object.defineProperty(tt,"AudioContext",{get:function(){var t=window;return t.AudioContext||t.webkitAudioContext||null},enumerable:!1,configurable:!0}),Object.defineProperty(tt,"OfflineAudioContext",{get:function(){var t=window;return t.OfflineAudioContext||t.webkitOfflineAudioContext||null},enumerable:!1,configurable:!0}),tt.prototype.destroy=function(){b.prototype.destroy.call(this);var t=this._ctx;void 0!==t.close&&t.close(),this.events.removeAllListeners(),this.analyser.disconnect(),this.compressor.disconnect(),this.analyser=null,this.compressor=null,this.events=null,this._offlineCtx=null,this._ctx=null},Object.defineProperty(tt.prototype,"audioContext",{get:function(){return this._ctx},enumerable:!1,configurable:!0}),Object.defineProperty(tt.prototype,"offlineContext",{get:function(){return this._offlineCtx},enumerable:!1,configurable:!0}),Object.defineProperty(tt.prototype,"paused",{get:function(){return this._paused},set:function(t){t&&"running"===this._ctx.state?this._ctx.suspend():t||"suspended"!==this._ctx.state||this._ctx.resume(),this._paused=t},enumerable:!1,configurable:!0}),tt.prototype.refresh=function(){this.events.emit("refresh")},tt.prototype.refreshPaused=function(){this.events.emit("refreshPaused")},tt.prototype.toggleMute=function(){return this.muted=!this.muted,this.refresh(),this.muted},tt.prototype.togglePause=function(){return this.paused=!this.paused,this.refreshPaused(),this._paused},tt.prototype.decode=function(t,e){function i(t){e(new Error(t.message||"Unable to decode file"))}var n=this._offlineCtx.decodeAudioData(t,function(t){e(null,t)},i);n&&n.catch(i)},tt),z=(Z.prototype.init=function(){return this.supported&&(this._webAudioContext=new U),this._htmlAudioContext=new L,this._sounds={},this.useLegacy=!this.supported,this},Object.defineProperty(Z.prototype,"context",{get:function(){return this._context},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"filtersAll",{get:function(){return this.useLegacy?[]:this._context.filters},set:function(t){this.useLegacy||(this._context.filters=t)},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"supported",{get:function(){return null!==U.AudioContext},enumerable:!1,configurable:!0}),Z.prototype.add=function(t,e){if("object"==typeof t){var i={};for(var n in t){var r=this._getOptions(t[n],e);i[n]=this.add(n,r)}return i}if(e instanceof N)return this._sounds[t]=e;var s=this._getOptions(e),o=N.from(s);return this._sounds[t]=o},Z.prototype._getOptions=function(t,e){var i;return i="string"==typeof t?{url:t}:t instanceof ArrayBuffer||t instanceof HTMLAudioElement?{source:t}:t,m(m({},i),e||{})},Object.defineProperty(Z.prototype,"useLegacy",{get:function(){return this._useLegacy},set:function(t){P.setLegacy(t),this._useLegacy=t,this._context=!t&&this.supported?this._webAudioContext:this._htmlAudioContext},enumerable:!1,configurable:!0}),Z.prototype.remove=function(t){return this.exists(t,!0),this._sounds[t].destroy(),delete this._sounds[t],this},Object.defineProperty(Z.prototype,"volumeAll",{get:function(){return this._context.volume},set:function(t){this._context.volume=t,this._context.refresh()},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"speedAll",{get:function(){return this._context.speed},set:function(t){this._context.speed=t,this._context.refresh()},enumerable:!1,configurable:!0}),Z.prototype.togglePauseAll=function(){return this._context.togglePause()},Z.prototype.pauseAll=function(){return this._context.paused=!0,this._context.refreshPaused(),this},Z.prototype.resumeAll=function(){return this._context.paused=!1,this._context.refreshPaused(),this},Z.prototype.toggleMuteAll=function(){return this._context.toggleMute()},Z.prototype.muteAll=function(){return this._context.muted=!0,this._context.refresh(),this},Z.prototype.unmuteAll=function(){return this._context.muted=!1,this._context.refresh(),this},Z.prototype.removeAll=function(){for(var t in this._sounds)this._sounds[t].destroy(),delete this._sounds[t];return this},Z.prototype.stopAll=function(){for(var t in this._sounds)this._sounds[t].stop();return this},Z.prototype.exists=function(t,e){return void 0===e&&(e=!1),!!this._sounds[t]},Z.prototype.find=function(t){return this.exists(t,!0),this._sounds[t]},Z.prototype.play=function(t,e){return this.find(t).play(e)},Z.prototype.stop=function(t){return this.find(t).stop()},Z.prototype.pause=function(t){return this.find(t).pause()},Z.prototype.resume=function(t){return this.find(t).resume()},Z.prototype.volume=function(t,e){var i=this.find(t);return void 0!==e&&(i.volume=e),i.volume},Z.prototype.speed=function(t,e){var i=this.find(t);return void 0!==e&&(i.speed=e),i.speed},Z.prototype.duration=function(t){return this.find(t).duration},Z.prototype.close=function(){return this.removeAll(),this._sounds=null,this._webAudioContext&&(this._webAudioContext.destroy(),this._webAudioContext=null),this._htmlAudioContext&&(this._htmlAudioContext.destroy(),this._htmlAudioContext=null),this._context=null,this},Z),W={HTMLAudioContext:L,HTMLAudioMedia:A,HTMLAudioInstance:E},G=(J.prototype.init=function(t,e){this.destination=t,this.source=e||t},J.prototype.connect=function(t){this.source.connect(t)},J.prototype.disconnect=function(){this.source.disconnect()},J.prototype.destroy=function(){this.disconnect(),this.destination=null,this.source=null},J),H={Filter:G,EqualizerFilter:(v=G,e(Q,v),Q.prototype.setGain=function(t,e){if(void 0===e&&(e=0),!this.bandsMap[t])throw new Error("No band found for frequency "+t);B.setParamValue(this.bandsMap[t].gain,e)},Q.prototype.getGain=function(t){if(!this.bandsMap[t])throw new Error("No band found for frequency "+t);return this.bandsMap[t].gain.value},Object.defineProperty(Q.prototype,"f32",{get:function(){return this.getGain(Q.F32)},set:function(t){this.setGain(Q.F32,t)},enumerable:!1,configurable:!0}),Object.defineProperty(Q.prototype,"f64",{get:function(){return this.getGain(Q.F64)},set:function(t){this.setGain(Q.F64,t)},enumerable:!1,configurable:!0}),Object.defineProperty(Q.prototype,"f125",{get:function(){return this.getGain(Q.F125)},set:function(t){this.setGain(Q.F125,t)},enumerable:!1,configurable:!0}),Object.defineProperty(Q.prototype,"f250",{get:function(){return this.getGain(Q.F250)},set:function(t){this.setGain(Q.F250,t)},enumerable:!1,configurable:!0}),Object.defineProperty(Q.prototype,"f500",{get:function(){return this.getGain(Q.F500)},set:function(t){this.setGain(Q.F500,t)},enumerable:!1,configurable:!0}),Object.defineProperty(Q.prototype,"f1k",{get:function(){return this.getGain(Q.F1K)},set:function(t){this.setGain(Q.F1K,t)},enumerable:!1,configurable:!0}),Object.defineProperty(Q.prototype,"f2k",{get:function(){return this.getGain(Q.F2K)},set:function(t){this.setGain(Q.F2K,t)},enumerable:!1,configurable:!0}),Object.defineProperty(Q.prototype,"f4k",{get:function(){return this.getGain(Q.F4K)},set:function(t){this.setGain(Q.F4K,t)},enumerable:!1,configurable:!0}),Object.defineProperty(Q.prototype,"f8k",{get:function(){return this.getGain(Q.F8K)},set:function(t){this.setGain(Q.F8K,t)},enumerable:!1,configurable:!0}),Object.defineProperty(Q.prototype,"f16k",{get:function(){return this.getGain(Q.F16K)},set:function(t){this.setGain(Q.F16K,t)},enumerable:!1,configurable:!0}),Q.prototype.reset=function(){this.bands.forEach(function(t){B.setParamValue(t.gain,0)})},Q.prototype.destroy=function(){this.bands.forEach(function(t){t.disconnect()}),this.bands=null,this.bandsMap=null},Q.F32=32,Q.F64=64,Q.F125=125,Q.F250=250,Q.F500=500,Q.F1K=1e3,Q.F2K=2e3,Q.F4K=4e3,Q.F8K=8e3,Q.F16K=16e3,Q),DistortionFilter:(_=G,e($,_),Object.defineProperty($.prototype,"amount",{get:function(){return this._amount},set:function(t){t*=1e3,this._amount=t;for(var e,i=new Float32Array(44100),n=Math.PI/180,r=0;r<44100;++r)e=2*r/44100-1,i[r]=(3+t)*e*20*n/(Math.PI+t*Math.abs(e));this._distortion.curve=i,this._distortion.oversample="4x"},enumerable:!1,configurable:!0}),$.prototype.destroy=function(){this._distortion=null,_.prototype.destroy.call(this)},$),StereoFilter:(y=G,e(K,y),Object.defineProperty(K.prototype,"pan",{get:function(){return this._pan},set:function(t){this._pan=t,this._stereo?B.setParamValue(this._stereo.pan,t):this._panner.setPosition(t,0,1-Math.abs(t))},enumerable:!1,configurable:!0}),K.prototype.destroy=function(){y.prototype.destroy.call(this),this._stereo=null,this._panner=null},K),ReverbFilter:(p=G,e(q,p),q.prototype._clamp=function(t,e,i){return Math.min(i,Math.max(e,t))},Object.defineProperty(q.prototype,"seconds",{get:function(){return this._seconds},set:function(t){this._seconds=this._clamp(t,1,50),this._rebuild()},enumerable:!1,configurable:!0}),Object.defineProperty(q.prototype,"decay",{get:function(){return this._decay},set:function(t){this._decay=this._clamp(t,0,100),this._rebuild()},enumerable:!1,configurable:!0}),Object.defineProperty(q.prototype,"reverse",{get:function(){return this._reverse},set:function(t){this._reverse=t,this._rebuild()},enumerable:!1,configurable:!0}),q.prototype._rebuild=function(){for(var t,e=g().context.audioContext,i=e.sampleRate,n=i*this._seconds,r=e.createBuffer(2,n,i),s=r.getChannelData(0),o=r.getChannelData(1),a=0;a<n;a++)t=this._reverse?n-a:a,s[a]=(2*Math.random()-1)*Math.pow(1-t/n,this._decay),o[a]=(2*Math.random()-1)*Math.pow(1-t/n,this._decay);var l=g().context.audioContext.createConvolver();l.buffer=r,this.init(l)},q),MonoFilter:(u=G,e(Y,u),Y.prototype.destroy=function(){this._merger.disconnect(),this._merger=null,u.prototype.destroy.call(this)},Y),TelephoneFilter:(h=G,e(V,h),V)},X={WebAudioMedia:F,WebAudioInstance:O,WebAudioNodes:D,WebAudioContext:U,WebAudioUtils:B},j=0;function V(){if(!g().useLegacy){var t=g().context.audioContext,e=t.createBiquadFilter(),i=t.createBiquadFilter(),n=t.createBiquadFilter(),r=t.createBiquadFilter();return e.type="lowpass",B.setParamValue(e.frequency,2e3),i.type="lowpass",B.setParamValue(i.frequency,2e3),n.type="highpass",B.setParamValue(n.frequency,500),r.type="highpass",B.setParamValue(r.frequency,500),e.connect(i),i.connect(n),n.connect(r),h.call(this,e,r)||this}h.call(this,null)}function Y(){var t=this;if(!g().useLegacy){var e=g().context.audioContext,i=e.createChannelSplitter(),n=e.createChannelMerger();return n.connect(i),(t=u.call(this,n,i)||this)._merger=n,t}t=u.call(this,null)||this}function q(t,e,i){void 0===t&&(t=3),void 0===e&&(e=2),void 0===i&&(i=!1);var n=this;if(!g().useLegacy)return(n=p.call(this,null)||this)._seconds=n._clamp(t,1,50),n._decay=n._clamp(e,0,100),n._reverse=i,n._rebuild(),n;n=p.call(this,null)||this}function K(t){void 0===t&&(t=0);var e=this;if(!g().useLegacy){var i,n,r,s=g().context.audioContext;return r=s.createStereoPanner?i=s.createStereoPanner():((n=s.createPanner()).panningModel="equalpower",n),(e=y.call(this,r)||this)._stereo=i,e._panner=n,e.pan=t,e}e=y.call(this,null)||this}function $(t){void 0===t&&(t=0);var e=this;if(!g().useLegacy){var i=g().context.audioContext.createWaveShaper();return(e=_.call(this,i)||this)._distortion=i,e.amount=t,e}e=_.call(this,null)||this}function Q(t,e,i,n,r,s,o,a,l,h){void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),void 0===n&&(n=0),void 0===r&&(r=0),void 0===s&&(s=0),void 0===o&&(o=0),void 0===a&&(a=0),void 0===l&&(l=0),void 0===h&&(h=0);var u=this;if(!g().useLegacy){var c=[{f:Q.F32,type:"lowshelf",gain:t},{f:Q.F64,type:"peaking",gain:e},{f:Q.F125,type:"peaking",gain:i},{f:Q.F250,type:"peaking",gain:n},{f:Q.F500,type:"peaking",gain:r},{f:Q.F1K,type:"peaking",gain:s},{f:Q.F2K,type:"peaking",gain:o},{f:Q.F4K,type:"peaking",gain:a},{f:Q.F8K,type:"peaking",gain:l},{f:Q.F16K,type:"highshelf",gain:h}].map(function(t){var e=g().context.audioContext.createBiquadFilter();return e.type=t.type,B.setParamValue(e.Q,1),e.frequency.value=t.f,B.setParamValue(e.gain,t.gain),e});(u=v.call(this,c[0],c[c.length-1])||this).bands=c,u.bandsMap={};for(var d=0;d<u.bands.length;d++){var p=u.bands[d];0<d&&u.bands[d-1].connect(p),u.bandsMap[p.frequency.value]=p}return u}u=v.call(this,null)||this}function J(t,e){this.init(t,e)}function Z(){this.init()}function tt(){var t=this,e=window,i=new tt.AudioContext,n=i.createDynamicsCompressor(),r=i.createAnalyser();return r.connect(n),n.connect(i.destination),(t=b.call(this,r,n)||this)._ctx=i,t._offlineCtx=new tt.OfflineAudioContext(1,2,e.OfflineAudioContext?i.sampleRate:44100),t._unlocked=!1,t.compressor=n,t.analyser=r,t.events=new s.EventEmitter,t.volume=1,t.speed=1,t.muted=!1,t.paused=!1,"running"!==i.state&&(t._unlock(),t._unlock=t._unlock.bind(t),document.addEventListener("mousedown",t._unlock,!0),document.addEventListener("touchstart",t._unlock,!0),document.addEventListener("touchend",t._unlock,!0)),t}function et(){var t=null!==w&&w.apply(this,arguments)||this;return t.speed=1,t.muted=!1,t.volume=1,t.paused=!1,t}function it(t,e){this.media=t,this.options=e,this._instances=[],this._sprites={},this.media.init(this);var i=e.complete;this._autoPlayOptions=i?{complete:i}:null,this.isLoaded=!1,this.isPlaying=!1,this.autoPlay=e.autoPlay,this.singleInstance=e.singleInstance,this.preload=e.preload||this.autoPlay,this.url=e.url,this.speed=e.speed,this.volume=e.volume,this.loop=e.loop,e.sprites&&this.addSprites(e.sprites),this.preload&&this._preload(e.loaded)}function nt(){}function rt(t){var e=this,i=t.audioContext,n=i.createBufferSource(),r=i.createGain(),s=i.createAnalyser();return n.connect(s),s.connect(r),r.connect(t.destination),(e=S.call(this,s,r)||this).context=t,e.bufferSource=n,e.gain=r,e.analyser=s,e}function st(t,e){this._output=e,this._input=t}function ot(t){var e=x.call(this)||this;return e.id=R++,e._media=null,e._paused=!1,e._muted=!1,e._elapsed=0,e.init(t),e}function at(){}function lt(t,e){this.parent=t,Object.assign(this,e),this.duration=this.end-this.start}function ht(){return null!==T&&T.apply(this,arguments)||this}function ut(t){var e=I.call(this)||this;return e.id=C++,e.init(t),e}function ct(){}var dt,pt={playOnce:function(t,e){var i="alias"+j++;return g().add(i,{url:t,preload:!0,autoPlay:!0,loaded:function(t){t&&(g().remove(i),e&&e(t))},complete:function(){g().remove(i),e&&e(null)}}),i},render:function(t,e){var i=document.createElement("canvas");e=m({width:512,height:128,fill:"black"},e||{}),i.width=e.width,i.height=e.height;var n=f.BaseTexture.from(i);if(!(t.media instanceof F))return n;var r=t.media,s=i.getContext("2d");s.fillStyle=e.fill;for(var o=r.buffer.getChannelData(0),a=Math.ceil(o.length/e.width),l=e.height/2,h=0;h<e.width;h++){for(var u=1,c=-1,d=0;d<a;d++){var p=o[h*a+d];p<u&&(u=p),c<p&&(c=p)}s.fillRect(h,(1+u)*l,1,Math.max(1,(c-u)*l))}return n},resolveUrl:o,sineTone:function(t,e){void 0===t&&(t=200),void 0===e&&(e=1);var i=N.from({singleInstance:!0});if(!(i.media instanceof F))return i;for(var n=i.media,r=i.context.audioContext.createBuffer(1,48e3*e,48e3),s=r.getChannelData(0),o=0;o<s.length;o++){var a=t*(o/r.sampleRate)*Math.PI;s[o]=2*Math.sin(a)}return n.buffer=r,i.isLoaded=!0,i},supported:c,extensions:a,validateFormats:r},ft=(dt=new z,t=dt);return i.Loader.registerPlugin(P),Object.defineProperties(ft,{Filterable:{get:function(){return k}},filters:{get:function(){return H}},htmlaudio:{get:function(){return W}},Sound:{get:function(){return N}},SoundLoader:{get:function(){return P}},SoundLibrary:{get:function(){return z}},SoundSprite:{get:function(){return M}},utils:{get:function(){return pt}},webaudio:{get:function(){return X}},sound:{get:function(){return ft}}}),ft}(PIXI,PIXI.utils,PIXI,PIXI),function(t,u){"use strict";function i(){return Ko.__string_rec(this,"")}var N,q={},T=T||{};function e(t,e){var i=Object.create(t);for(var n in e)i[n]=e[n];return e.toString!==Object.prototype.toString&&(i.toString=e.toString),i}function S(){}(q.Analytics=S).__name__="Analytics",S.init=function(){if(S.enabled){if("localhost"==window.document.location.hostname||"127.0.0.1"==window.document.location.hostname)return console.log("FloatingSpaceCities/Analytics.hx:20:","game is running locally"),void(B.enableCheats=!0);jsFunctions.loadJS("https://www.googletagmanager.com/gtag/js?id=UA-48290579-2",function(){S.ready=!0,jsFunctions.initGA(),S.sendEvent("game","playVersion",null,"VERSION1.1",!0),S.sendEvent("game","playOnSite",null,window.location.hostname,!0);for(var t=0,e=S.capturedErrors;t<e.length;){var i=e[t];++t,jsFunctions.gaSendError(i)}S.capturedErrors=[]}),S.useAltEarlyGame=!0,S.didABTest=!1,S.useAltEarlyGame&&(B.earlyGameFix1=!0,B.earlyGameFix2=!0)}},S.sendErrorEvent=function(t){3<S.errorsReported||(S.errorsReported++,S.ready?jsFunctions.gaSendError(t):S.capturedErrors.push(t))},S.sendEventFirebase=function(t,e,i){if(S.enabledFirebase)try{MediationTest.logFirebase(t,e,i)}catch(t){}},S.sendEvent=function(t,e,i,n,r){null==r&&(r=!1),null==n&&(n=""),S.ready&&jsFunctions.gaSendEvent(t,e,n,i,r)},S.update=function(t){1800<(S.sessionTime+=t/60)&&!S.reportedLongPlaytime&&(Rr.getItem("lptReported",function(t,e){null==t&&"reported"!=e&&Rr.setItem("lptReported","reported",function(){S.sendEvent("playtime",S.didABTest?S.useAltEarlyGame?"altEarlyGame":"standardEarlyGame":"noABTest")})}),S.reportedLongPlaytime=!0)};var R=function(t){this.extraFormat="",this.isPaused=!1,this.playSecondMusicOnceLoaded=!1,this.music1EverFinished=!1,this.music4=null,this.music3=null,this.music2=null;var e=this;(R.instance=this).game=t,this.music1=PIXI.sound.Sound.from({url:"audio/BTFE_BackgroundMusic_1.{"+this.extraFormat+"ogg,mp3}",preload:!0,singleInstance:!0,loaded:function(){O.musicOn&&(e.music1.volume=e.musicVolume(),e.music1.play(Uh(e,e.firstMusicCompleteCallback)),e.isPaused&&e.music1.pause())}}),this.music2=null,O.musicOn&&this.loadSecondMusic(),this.buildSound=PIXI.sound.Sound.from({url:"audio/BTFE_BuildingBuild.{ogg,mp3}",preload:!0}),this.buildingClickSound=PIXI.sound.Sound.from({url:"audio/BTFE_BuildingClick.{ogg,mp3}",preload:!0}),this.buildingUpgradeSound=PIXI.sound.Sound.from({url:"audio/BTFE_BuildingUpgrade.{ogg,mp3}",preload:!0}),this.buttonSound=PIXI.sound.Sound.from({url:"audio/BTFE_Button.{ogg,mp3}",preload:!0}),this.buttonFailSound=PIXI.sound.Sound.from({url:"audio/BTFE_ButtonFail.{ogg,mp3}",preload:!0}),this.followCitizenSound=PIXI.sound.Sound.from({url:"audio/BTFE_Follow.{ogg,mp3}",preload:!0}),this.decorateSound=PIXI.sound.Sound.from({url:"audio/BTFE_Decorate.{ogg,mp3}",preload:!0}),this.changeVitalBuildingSound=PIXI.sound.Sound.from({url:"audio/BTFE_ChangeVitalBuilding.{ogg,mp3}",preload:!0}),this.music=this.music1};(q.Audio=R).__name__="Audio",R.get=function(){return R.instance},R.prototype={loadSecondMusic:function(){var t=this;this.music2=PIXI.sound.Sound.from({url:"audio/BTFE_BackgroundMusic_2.{"+this.extraFormat+"ogg,mp3}",preload:!0,singleInstance:!1,loaded:function(){O.musicOn&&t.music==t.music1&&!t.music.isPlaying&&!t.music.paused&&t.playSecondMusicOnceLoaded&&(t.music=t.music2,t.music.volume=t.musicVolume(),t.music2.play(Uh(t,t.startNextMusic)),t.isPaused&&t.music2.pause(),t.playSecondMusicOnceLoaded=!1)}})},loadThirdMusic:function(){this.music3=PIXI.sound.Sound.from({url:"audio/BTFE_BackgroundMusic_3.{"+this.extraFormat+"ogg,mp3}",preload:!0,singleInstance:!1})},loadFourthMusic:function(){this.music4=PIXI.sound.Sound.from({url:"audio/BTFE_BackgroundMusic_4.{"+this.extraFormat+"ogg,mp3}",preload:!0,singleInstance:!1})},startNextMusic:function(){if(null!=this.music2&&this.music2.isLoaded||null!=this.music3&&this.music3.isLoaded||null!=this.music4&&this.music4.isLoaded){var t=[];null!=this.music2&&this.music2.isLoaded&&t.push(this.music2),null!=this.music3&&this.music3.isLoaded?t.push(this.music3):null==this.music3&&this.loadThirdMusic(),null!=this.music4&&this.music4.isLoaded?t.push(this.music4):null!=this.music3&&this.music3.isLoaded&&null==this.music4&&this.loadFourthMusic(),1<t.length&&null!=this.music&&at.remove(t,this.music);var e=il.fromArray(t);this.music=e,this.music.volume=this.musicVolume(),this.music.play(Uh(this,this.startNextMusic)),this.isPaused&&this.music.pause()}else this.playSecondMusicOnceLoaded=!0},firstMusicCompleteCallback:function(t){O.musicOn&&(this.music1EverFinished=!0,this.startNextMusic())},changeMusicEnabledness:function(t){O.musicOn=t,O.save(),O.musicOn?(this.music.isPlaying||(this.music1EverFinished?this.startNextMusic():this.music1.isLoaded&&(this.music1.volume=this.musicVolume(),this.music1.play(Uh(this,this.firstMusicCompleteCallback)))),null==this.music2&&this.loadSecondMusic()):this.music.isPlaying&&this.music.stop()},changeSoundEnabledness:function(t){O.soundOn=t,O.save()},pauseMusic:function(){null!=this.music&&this.music.isPlaying&&!this.music.paused&&this.music.pause(),this.isPaused=!0},resumeMusic:function(){null!=this.music&&this.music.paused&&O.musicOn&&this.music.resume(),this.isPaused=!1},playSound:function(t){O.soundOn&&t.isLoaded&&(t.volume=this.soundVolume(),t.play({}))},musicVolume:function(){return O.musicVolume*O.musicVolume},soundVolume:function(){return O.soundVolume*O.soundVolume},setVolumeLevels:function(){null!=this.music&&(this.music.volume=this.musicVolume())},__class__:R};function L(t,e,i,n,r,s,o,a,l,h,u){null==u&&(u=0),null==h&&(h=0),null==l&&(l=0),null==a&&(a=0),null==o&&(o=0),null==s&&(s=0),null==r&&(r=0),null==n&&(n=0),null==i&&(i=0),null==e&&(e=0),null==t&&(t=0),this.set_food(i),this.wood=t,this.stone=e,this.machineParts=n,this.refinedMetal=s,this.computerChips=o,this.cacao=a,this.chocolate=l,this.graphene=h,this.rocketFuel=u,this.knowledge=r}var d=T.BuilderType={__ename__:"BuilderType",__constructs__:["Building","Decoration","WorldResource","MoveWorldResource","FloatingPlatform","Bridge"],Building:(N=function(t,e){return{_hx_index:0,buildingType:t,buildingInfo:e,__enum__:"BuilderType",toString:i}},N.__params__=["buildingType","buildingInfo"],N),Decoration:(N=function(t){return{_hx_index:1,decorationInfo:t,__enum__:"BuilderType",toString:i}},N.__params__=["decorationInfo"],N),WorldResource:(N=function(t){return{_hx_index:2,resourceInfo:t,__enum__:"BuilderType",toString:i}},N.__params__=["resourceInfo"],N),MoveWorldResource:(N=function(t){return{_hx_index:3,worldResource:t,__enum__:"BuilderType",toString:i}},N.__params__=["worldResource"],N),FloatingPlatform:{_hx_index:4,__enum__:"BuilderType",toString:i},Bridge:(N=function(t){return{_hx_index:5,bridgeInfo:t,__enum__:"BuilderType",toString:i}},N.__params__=["bridgeInfo"],N)},st=T.BuildPossibility={__ename__:"BuildPossibility",__constructs__:["BuildingInWorld","BuildingPositionImpossible","WorldNotAllowed","BuildingOK"],BuildingInWorld:{_hx_index:0,__enum__:"BuildPossibility",toString:i},BuildingPositionImpossible:{_hx_index:1,__enum__:"BuildPossibility",toString:i},WorldNotAllowed:{_hx_index:2,__enum__:"BuildPossibility",toString:i},BuildingOK:{_hx_index:3,__enum__:"BuildPossibility",toString:i}};(q.Materials=L).__name__="Materials",L.fromBuildingInfo=function(t){var e=new L;null!=t.food&&e.set_food(t.food),null!=t.wood&&(e.wood=t.wood),null!=t.stone&&(e.stone=t.stone),null!=t.machineParts&&(e.machineParts=t.machineParts),null!=t.refinedMetal&&(e.refinedMetal=t.refinedMetal),null!=t.computerChips&&(e.computerChips=t.computerChips),null!=t.cacao&&(e.cacao=t.cacao),null!=t.chocolate&&(e.chocolate=t.chocolate),null!=t.graphene&&(e.graphene=t.graphene),null!=t.rocketFuel&&(e.rocketFuel=t.rocketFuel);for(var i=0,n=ct.modMaterials;i<n.length;){var r=n[i];++i;var s=r.variableName;null!=t[s]&&(e[s]=t[s])}return null!=t.knowledge&&(e.knowledge=t.knowledge),e},L.fromBuildingUpgradesInfo=function(t){var e=new L;null!=t.food&&e.set_food(t.food),null!=t.wood&&(e.wood=t.wood),null!=t.stone&&(e.stone=t.stone),null!=t.machineParts&&(e.machineParts=t.machineParts),null!=t.refinedMetal&&(e.refinedMetal=t.refinedMetal),null!=t.computerChips&&(e.computerChips=t.computerChips),null!=t.cacao&&(e.cacao=t.cacao),null!=t.chocolate&&(e.chocolate=t.chocolate),null!=t.graphene&&(e.graphene=t.graphene),null!=t.rocketFuel&&(e.rocketFuel=t.rocketFuel);for(var i=0,n=ct.modMaterials;i<n.length;){var r=n[i];++i;var s=r.variableName;null!=t[s]&&(e[s]=t[s])}return null!=t.knowledge&&(e.knowledge=t.knowledge),e},L.fromCityUpgradesInfo=function(t){var e=new L;null!=t.food&&e.set_food(t.food),null!=t.wood&&(e.wood=t.wood),null!=t.stone&&(e.stone=t.stone),null!=t.machineParts&&(e.machineParts=t.machineParts),null!=t.refinedMetal&&(e.refinedMetal=t.refinedMetal),null!=t.computerChips&&(e.computerChips=t.computerChips),null!=t.cacao&&(e.cacao=t.cacao),null!=t.chocolate&&(e.chocolate=t.chocolate),null!=t.graphene&&(e.graphene=t.graphene),null!=t.rocketFuel&&(e.rocketFuel=t.rocketFuel);for(var i=0,n=ct.modMaterials;i<n.length;){var r=n[i];++i;var s=r.variableName;null!=t[s]&&(e[s]=t[s])}return null!=t.knowledge&&(e.knowledge=t.knowledge),e},L.fromPoliciesInfo=function(t){var e=new L;null!=t.food&&e.set_food(t.food),null!=t.wood&&(e.wood=t.wood),null!=t.stone&&(e.stone=t.stone),null!=t.machineParts&&(e.machineParts=t.machineParts),null!=t.refinedMetal&&(e.refinedMetal=t.refinedMetal),null!=t.computerChips&&(e.computerChips=t.computerChips),null!=t.cacao&&(e.cacao=t.cacao),null!=t.chocolate&&(e.chocolate=t.chocolate),null!=t.graphene&&(e.graphene=t.graphene),null!=t.rocketFuel&&(e.rocketFuel=t.rocketFuel);for(var i=0,n=ct.modMaterials;i<n.length;){var r=n[i];++i;var s=r.variableName;null!=t[s]&&(e[s]=t[s])}return null!=t.knowledge&&(e.knowledge=t.knowledge),e},L.fromDecorationInfo=function(t){var e=new L;null!=t.food&&e.set_food(t.food),null!=t.wood&&(e.wood=t.wood),null!=t.stone&&(e.stone=t.stone),null!=t.machineParts&&(e.machineParts=t.machineParts),null!=t.refinedMetal&&(e.refinedMetal=t.refinedMetal),null!=t.computerChips&&(e.computerChips=t.computerChips),null!=t.cacao&&(e.cacao=t.cacao),null!=t.chocolate&&(e.chocolate=t.chocolate),null!=t.graphene&&(e.graphene=t.graphene),null!=t.rocketFuel&&(e.rocketFuel=t.rocketFuel);for(var i=0,n=ct.modMaterials;i<n.length;){var r=n[i];++i;var s=r.variableName;null!=t[s]&&(e[s]=t[s])}return null!=t.knowledge&&(e.knowledge=t.knowledge),e},L.fromWorldResourceInfo=function(t){var e=new L;null!=t.food&&e.set_food(t.food),null!=t.wood&&(e.wood=t.wood),null!=t.stone&&(e.stone=t.stone),null!=t.machineParts&&(e.machineParts=t.machineParts),null!=t.refinedMetal&&(e.refinedMetal=t.refinedMetal),null!=t.computerChips&&(e.computerChips=t.computerChips),null!=t.cacao&&(e.cacao=t.cacao),null!=t.chocolate&&(e.chocolate=t.chocolate),null!=t.graphene&&(e.graphene=t.graphene),null!=t.rocketFuel&&(e.rocketFuel=t.rocketFuel);for(var i=0,n=ct.modMaterials;i<n.length;){var r=n[i];++i;var s=r.variableName;null!=t[s]&&(e[s]=t[s])}return null!=t.knowledge&&(e.knowledge=t.knowledge),e},L.fromBridgeInfo=function(t){var e=new L;null!=t.food&&e.set_food(t.food),null!=t.wood&&(e.wood=t.wood),null!=t.stone&&(e.stone=t.stone),null!=t.machineParts&&(e.machineParts=t.machineParts),null!=t.refinedMetal&&(e.refinedMetal=t.refinedMetal),null!=t.computerChips&&(e.computerChips=t.computerChips),null!=t.cacao&&(e.cacao=t.cacao),null!=t.chocolate&&(e.chocolate=t.chocolate),null!=t.graphene&&(e.graphene=t.graphene),null!=t.rocketFuel&&(e.rocketFuel=t.rocketFuel);for(var i=0,n=ct.modMaterials;i<n.length;){var r=n[i];++i;var s=r.variableName;null!=t[s]&&(e[s]=t[s])}return null!=t.knowledge&&(e.knowledge=t.knowledge),e},L.fromStoryMaterials=function(t){var e=new L;null!=t.food&&e.set_food(t.food),null!=t.wood&&(e.wood=t.wood),null!=t.stone&&(e.stone=t.stone),null!=t.machineParts&&(e.machineParts=t.machineParts),null!=t.refinedMetal&&(e.refinedMetal=t.refinedMetal),null!=t.computerChips&&(e.computerChips=t.computerChips),null!=t.cacao&&(e.cacao=t.cacao),null!=t.chocolate&&(e.chocolate=t.chocolate),null!=t.graphene&&(e.graphene=t.graphene),null!=t.rocketFuel&&(e.rocketFuel=t.rocketFuel);for(var i=0,n=ct.modMaterials;i<n.length;){var r=n[i];++i;var s=r.variableName;null!=t[s]&&(e[s]=t[s])}return null!=t.knowledge&&(e.knowledge=t.knowledge),e},L.prototype={set_food:function(t){this.food=t;var e=this.cacao+this.chocolate;if(t<e){var i=Math.min(this.cacao,e-t);this.cacao-=i,e-=i;var n=Math.min(this.chocolate,e-t);this.chocolate-=n,e-=n}return t},canAfford:function(t){if(t.food>this.food)return!1;if(t.wood>this.wood)return!1;if(t.stone>this.stone)return!1;if(t.machineParts>this.machineParts)return!1;if(t.refinedMetal>this.refinedMetal)return!1;if(t.computerChips>this.computerChips)return!1;if(t.cacao>this.cacao)return!1;if(t.chocolate>this.chocolate)return!1;if(t.graphene>this.graphene)return!1;if(t.rocketFuel>this.rocketFuel)return!1;for(var e=0,i=ct.modMaterials;e<i.length;){var n=i[e];++e;var r=n.variableName;if(t[r]>this[r])return!1}return!(t.knowledge>this.knowledge)},canAffordNumber:function(t){var e=1e9;if(t.food>this.food)return 0;0<t.food&&(s=Math.floor(this.food/t.food))<e&&(e=s);if(t.wood>this.wood)return 0;0<t.wood&&(s=Math.floor(this.wood/t.wood))<e&&(e=s);if(t.stone>this.stone)return 0;0<t.stone&&(s=Math.floor(this.stone/t.stone))<e&&(e=s);if(t.machineParts>this.machineParts)return 0;0<t.machineParts&&(s=Math.floor(this.machineParts/t.machineParts))<e&&(e=s);if(t.refinedMetal>this.refinedMetal)return 0;0<t.refinedMetal&&(s=Math.floor(this.refinedMetal/t.refinedMetal))<e&&(e=s);if(t.computerChips>this.computerChips)return 0;0<t.computerChips&&(s=Math.floor(this.computerChips/t.computerChips))<e&&(e=s);if(t.cacao>this.cacao)return 0;0<t.cacao&&(s=Math.floor(this.cacao/t.cacao))<e&&(e=s);if(t.chocolate>this.chocolate)return 0;0<t.chocolate&&(s=Math.floor(this.chocolate/t.chocolate))<e&&(e=s);if(t.graphene>this.graphene)return 0;0<t.graphene&&(s=Math.floor(this.graphene/t.graphene))<e&&(e=s);if(t.rocketFuel>this.rocketFuel)return 0;0<t.rocketFuel&&(s=Math.floor(this.rocketFuel/t.rocketFuel))<e&&(e=s);for(var i=0,n=ct.modMaterials;i<n.length;){var r=n[i];++i;var s,o=r.variableName;if(t[o]>this[o])return 0;if(0<t[o])(s=Math.floor(this[o]/t[o]))<e&&(e=s)}if(t.knowledge>this.knowledge)return 0;0<t.knowledge&&(s=Math.floor(this.knowledge/t.knowledge))<e&&(e=s);return e},remove:function(t){(e=this).set_food(e.food-t.food),this.wood-=t.wood,this.stone-=t.stone,this.machineParts-=t.machineParts,this.refinedMetal-=t.refinedMetal,this.computerChips-=t.computerChips,this.cacao-=t.cacao,this.chocolate-=t.chocolate,this.graphene-=t.graphene,this.rocketFuel-=t.rocketFuel;for(var e=0,i=ct.modMaterials;e<i.length;){var n=i[e];++e;var r=n.variableName;this[r]-=t[r]}this.knowledge-=t.knowledge},add:function(t){if(null!=t){(e=this).set_food(e.food+t.food),this.wood+=t.wood,this.stone+=t.stone,this.machineParts+=t.machineParts,this.refinedMetal+=t.refinedMetal,this.computerChips+=t.computerChips,this.cacao+=t.cacao,this.chocolate+=t.chocolate,this.graphene+=t.graphene,this.rocketFuel+=t.rocketFuel;for(var e=0,i=ct.modMaterials;e<i.length;){var n=i[e];++e;var r=n.variableName;this[r]+=t[r]}this.knowledge+=t.knowledge}},multiply:function(t){(e=this).set_food(e.food*t),this.wood*=t,this.stone*=t,this.machineParts*=t,this.refinedMetal*=t,this.computerChips*=t,this.cacao*=t,this.chocolate*=t,this.graphene*=t,this.rocketFuel*=t;for(var e=0,i=ct.modMaterials;e<i.length;){var n=i[e];++e,this[n.variableName]*=t}this.knowledge*=t},roundAll:function(){this.set_food(Math.round(this.food)),this.wood=Math.round(this.wood),this.stone=Math.round(this.stone),this.machineParts=Math.round(this.machineParts),this.refinedMetal=Math.round(this.refinedMetal),this.computerChips=Math.round(this.computerChips),this.cacao=Math.round(this.cacao),this.chocolate=Math.round(this.chocolate),this.graphene=Math.round(this.graphene),this.rocketFuel=Math.round(this.rocketFuel);for(var t=0,e=ct.modMaterials;t<e.length;){var i=e[t];++t;var n=i.variableName;this[n]=Math.round(this[n])}this.knowledge=Math.round(this.knowledge)},addToProduction:function(t){var e=ct.findMaterialIndex("food");t.materialProduction[e][0]+=this.food;e=ct.findMaterialIndex("wood");t.materialProduction[e][0]+=this.wood;e=ct.findMaterialIndex("stone");t.materialProduction[e][0]+=this.stone;e=ct.findMaterialIndex("machineParts");t.materialProduction[e][0]+=this.machineParts;e=ct.findMaterialIndex("refinedMetal");t.materialProduction[e][0]+=this.refinedMetal;e=ct.findMaterialIndex("computerChips");t.materialProduction[e][0]+=this.computerChips;e=ct.findMaterialIndex("cacao");t.materialProduction[e][0]+=this.cacao;e=ct.findMaterialIndex("chocolate");t.materialProduction[e][0]+=this.chocolate;e=ct.findMaterialIndex("graphene");t.materialProduction[e][0]+=this.graphene;e=ct.findMaterialIndex("rocketFuel");t.materialProduction[e][0]+=this.rocketFuel;for(var i=0,n=ct.modMaterials;i<n.length;){var r=n[i];++i;var s=r.variableName;e=ct.findMaterialIndex(s);t.materialProduction[e][0]+=this[s]}e=ct.findMaterialIndex("knowledge");t.materialProduction[e][0]+=this.knowledge},addToConsumption:function(t){var e=ct.findMaterialIndex("food");t.materialUsed[e][0]+=this.food;e=ct.findMaterialIndex("wood");t.materialUsed[e][0]+=this.wood;e=ct.findMaterialIndex("stone");t.materialUsed[e][0]+=this.stone;e=ct.findMaterialIndex("machineParts");t.materialUsed[e][0]+=this.machineParts;e=ct.findMaterialIndex("refinedMetal");t.materialUsed[e][0]+=this.refinedMetal;e=ct.findMaterialIndex("computerChips");t.materialUsed[e][0]+=this.computerChips;e=ct.findMaterialIndex("cacao");t.materialUsed[e][0]+=this.cacao;e=ct.findMaterialIndex("chocolate");t.materialUsed[e][0]+=this.chocolate;e=ct.findMaterialIndex("graphene");t.materialUsed[e][0]+=this.graphene;e=ct.findMaterialIndex("rocketFuel");t.materialUsed[e][0]+=this.rocketFuel;for(var i=0,n=ct.modMaterials;i<n.length;){var r=n[i];++i;var s=r.variableName;e=ct.findMaterialIndex(s);t.materialUsed[e][0]+=this[s]}e=ct.findMaterialIndex("knowledge");t.materialUsed[e][0]+=this.knowledge},any:function(){if(0<this.food)return!0;if(0<this.wood)return!0;if(0<this.stone)return!0;if(0<this.machineParts)return!0;if(0<this.refinedMetal)return!0;if(0<this.computerChips)return!0;if(0<this.cacao)return!0;if(0<this.chocolate)return!0;if(0<this.graphene)return!0;if(0<this.rocketFuel)return!0;for(var t=0,e=ct.modMaterials;t<e.length;){var i=e[t];if(++t,0<this[i.variableName])return!0}return 0<this.knowledge},anyMaterialDifferent:function(t){if(this.food!=t.food)return!0;if(this.wood!=t.wood)return!0;if(this.stone!=t.stone)return!0;if(this.machineParts!=t.machineParts)return!0;if(this.refinedMetal!=t.refinedMetal)return!0;if(this.computerChips!=t.computerChips)return!0;if(this.cacao!=t.cacao)return!0;if(this.chocolate!=t.chocolate)return!0;if(this.graphene!=t.graphene)return!0;if(this.rocketFuel!=t.rocketFuel)return!0;for(var e=0,i=ct.modMaterials;e<i.length;){var n=i[e];++e;var r=n.variableName;if(this[r]!=t[r])return!0}return this.knowledge!=t.knowledge},copy:function(){var t=new L;return t.add(this),t},save:function(t,e){null==e&&(e=!0),this.saveBasics(t,e);var i=ct.modMaterials.length;if(t.size+4>t.bytes.length){var n=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+4))),t.bytes.blit(0,n,0,t.size)}t.bytes.setInt32(t.size,i),t.size+=4;for(var r=0,s=ct.modMaterials;r<s.length;){var o=s[r];++r,t.addString(o.variableName);i=this[o.variableName];if(t.size+8>t.bytes.length){n=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+8))),t.bytes.blit(0,n,0,t.size)}t.bytes.setDouble(t.size,i),t.size+=8}},load:function(t,e){if(this.loadBasics(t,e),31<=t.version){var i=t.bytes.getInt32(t.readStart);t.readStart+=4;for(var n=0,r=i;n<r;){n++;var s=t.readString(),o=t.bytes.getDouble(t.readStart);t.readStart+=8;var a=o;this[s]=a}}},saveBasics:function(t,e){null==e&&(e=!0),e&&t.addString(L.saveDefinition);var i=this.wood;if(t.size+8>t.bytes.length){var n=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+8))),t.bytes.blit(0,n,0,t.size)}t.bytes.setDouble(t.size,i),t.size+=8;i=this.stone;if(t.size+8>t.bytes.length){n=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+8))),t.bytes.blit(0,n,0,t.size)}t.bytes.setDouble(t.size,i),t.size+=8;i=this.food;if(t.size+8>t.bytes.length){n=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+8))),t.bytes.blit(0,n,0,t.size)}t.bytes.setDouble(t.size,i),t.size+=8;i=this.machineParts;if(t.size+8>t.bytes.length){n=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+8))),t.bytes.blit(0,n,0,t.size)}t.bytes.setDouble(t.size,i),t.size+=8;i=this.knowledge;if(t.size+8>t.bytes.length){n=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+8))),t.bytes.blit(0,n,0,t.size)}t.bytes.setDouble(t.size,i),t.size+=8;i=this.refinedMetal;if(t.size+8>t.bytes.length){n=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+8))),t.bytes.blit(0,n,0,t.size)}t.bytes.setDouble(t.size,i),t.size+=8;i=this.computerChips;if(t.size+8>t.bytes.length){n=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+8))),t.bytes.blit(0,n,0,t.size)}t.bytes.setDouble(t.size,i),t.size+=8;i=this.graphene;if(t.size+8>t.bytes.length){n=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+8))),t.bytes.blit(0,n,0,t.size)}t.bytes.setDouble(t.size,i),t.size+=8;i=this.rocketFuel;if(t.size+8>t.bytes.length){n=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+8))),t.bytes.blit(0,n,0,t.size)}t.bytes.setDouble(t.size,i),t.size+=8;i=this.cacao;if(t.size+8>t.bytes.length){n=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+8))),t.bytes.blit(0,n,0,t.size)}t.bytes.setDouble(t.size,i),t.size+=8;i=this.chocolate;if(t.size+8>t.bytes.length){n=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+8))),t.bytes.blit(0,n,0,t.size)}t.bytes.setDouble(t.size,i),t.size+=8},loadBasics:function(t,e){null==e&&(e=t.readString());var i=Dr.makeLoadMap(e,t);Object.prototype.hasOwnProperty.call(i.h,"wood")&&(this.wood=i.h.wood),Object.prototype.hasOwnProperty.call(i.h,"stone")&&(this.stone=i.h.stone),Object.prototype.hasOwnProperty.call(i.h,"food")&&this.set_food(i.h.food),Object.prototype.hasOwnProperty.call(i.h,"machineParts")&&(this.machineParts=i.h.machineParts),Object.prototype.hasOwnProperty.call(i.h,"knowledge")&&(this.knowledge=i.h.knowledge),Object.prototype.hasOwnProperty.call(i.h,"refinedMetal")&&(this.refinedMetal=i.h.refinedMetal),Object.prototype.hasOwnProperty.call(i.h,"computerChips")&&(this.computerChips=i.h.computerChips),Object.prototype.hasOwnProperty.call(i.h,"graphene")&&(this.graphene=i.h.graphene),Object.prototype.hasOwnProperty.call(i.h,"rocketFuel")&&(this.rocketFuel=i.h.rocketFuel),Object.prototype.hasOwnProperty.call(i.h,"cacao")&&(this.cacao=i.h.cacao),Object.prototype.hasOwnProperty.call(i.h,"chocolate")&&(this.chocolate=i.h.chocolate)},__class__:L};function U(t,e,i,n,r,s){switch(this.buildablePositionsDisplayCacheValid=!1,this.lastBuilt=-1,this.fixedSprite=null,this.fixedToPos=null,this.fixedToWorld=null,this.wasMouseHandled=!0,this.extraSprites=[],this.isLimitedToNumber=-1,this.isLimitedToOnePerNCitizens=0,this.isLimitedBuilding=!1,this.isUniqueBuilding=!1,this.city=t,this.builderType=i,this.decorationAppearance=n,this.decorationAppearanceColor=s,this.mirrored=r,i._hx_index){case 0:var o=i.buildingInfo,a=i.buildingType;-1!=o.specialInfo.indexOf("has_multi_decor_spec")?this.sprite=dt.makeSprite(lt.find(o.specialInfo,function(t){return C.startsWith(t,"multi_decor_spec")}).split(":")[1].split(",")[n]+"@0,0,20,20"):this.sprite=dt.makeSprite(null==o.onBuildSprite?F.field(a,"spriteName"):o.onBuildSprite,new yr(22*n,0,20,20)),0<=s&&(this.sprite.tint=s),this.originalCost=L.fromBuildingInfo(o),this.isUniqueBuilding=-1!=o.specialInfo.indexOf("unique"),this.isLimitedBuilding=-1!=o.specialInfo.indexOf("limited"),this.isLimitedBuilding&&(this.isLimitedToOnePerNCitizens=Y.parseInt(lt.find(o.specialInfo,function(t){return C.startsWith(t,"limitedToCitizens")}).split(":")[1])),this.isUniqueBuilding&&t.upgrades.vars.hasGalacticLibrary&&-1!=o.specialInfo.indexOf("notUniqueIfGalacticLibrary")&&(this.isUniqueBuilding=!1,this.isLimitedBuilding=!0,this.isLimitedToNumber=2);break;case 1:var l=i.decorationInfo;this.sprite=dt.makeSprite(l.textureName+"@0,0,20,20"),this.originalCost=L.fromDecorationInfo(l);break;case 2:var h=i.resourceInfo;this.sprite=dt.makeSprite(""+h.textureName),this.originalCost=L.fromWorldResourceInfo(h);break;case 3:var u=i.worldResource;this.sprite=new PIXI.Sprite(u.sprite.texture);break;case 4:this.sprite=dt.makeSprite("spr_floatingplatform");break;case 5:var c=i.bridgeInfo;this.sprite=dt.makeSprite(c.textureName,new yr(66,0,20,20)),this.originalCost=L.fromBridgeInfo(c)}r&&(this.sprite.scale.set(-1,1),this.sprite.anchor.set(1,0)),this.stage=e,this.builderSecondaryHelpSprite=dt.makeSprite("spr_insertbuildinghere"),e.addChild(this.sprite),e.addChild(this.builderSecondaryHelpSprite),this.sprite.alpha=0,this.builderSecondaryHelpSprite.alpha=0,this.touchAlpha=0,this.showContinuousTooltip()}(q.Builder=U).__name__="Builder",U.canRemoveFromLRPerspective=function(t,e,i){return t?(null==e.leftBuilding||null!=ha.find(i,e.leftBuilding,function(t){return 0==t.worldPosition.y},function(t){return t==e}))&&(null==e.rightBuilding||null!=ha.find(i,e.rightBuilding,function(t){return 0==t.worldPosition.y},function(t){return t==e})):!(null!=e.leftBuilding&&0!=e.leftBuilding.worldPosition.y&&null==e.leftBuilding.bottomBuilding&&!i.miscCityElements.collidesSpecific(new vr(e.leftBuilding.position.x,e.leftBuilding.position.y+20),Zo))&&(null==e.rightBuilding||0==e.rightBuilding.worldPosition.y||null!=e.rightBuilding.bottomBuilding||i.miscCityElements.collidesSpecific(new vr(e.rightBuilding.position.x,e.rightBuilding.position.y+20),Zo))},U.canRemoveLeavingHoleFromStructuralPerspective=function(t,e,i){return t?(null==e.leftBuilding||null!=ha.find(i,e.leftBuilding,function(t){return 0==t.worldPosition.y},function(t){return t==e}))&&((null==e.rightBuilding||null!=ha.find(i,e.rightBuilding,function(t){return 0==t.worldPosition.y},function(t){return t==e}))&&(null==e.rightBuilding||null!=ha.find(i,e.topBuilding,function(t){return 0==t.worldPosition.y},function(t){return t==e}))):!(null!=e.leftBuilding&&0!=e.leftBuilding.worldPosition.y&&null==e.leftBuilding.bottomBuilding&&!i.miscCityElements.collidesSpecific(new vr(e.leftBuilding.position.x,e.leftBuilding.position.y+20),Zo)||null!=e.rightBuilding&&0!=e.rightBuilding.worldPosition.y&&null==e.rightBuilding.bottomBuilding&&!i.miscCityElements.collidesSpecific(new vr(e.rightBuilding.position.x,e.rightBuilding.position.y+20),Zo)||!(null==e.leftBuilding&&null==e.rightBuilding&&null==e.topBuilding||null!=e.leftBuilding&&null!=e.rightBuilding||null==e.topBuilding))&&(null==e.topBuilding||null!=e.topBuilding.leftBuilding&&null!=e.topBuilding.rightBuilding)},U.prototype={get_buildingToBuild:function(){var t=this.builderType;if(0!=t._hx_index)return null;t.buildingInfo;return t.buildingType},fixBuilder:function(t,e){this.fixedToWorld=t,this.fixedToPos=e,null==t||null==e?null!=this.fixedSprite&&(this.fixedSprite.destroy(),this.fixedSprite=null):(this.fixedSprite=dt.makeSprite("spr_forcedbuildinglocation"),this.stage.addChild(this.fixedSprite),this.fixedSprite.position.set(t.rect.x+20*e-1,t.rect.y-20-31))},invalidateCache:function(){this.buildablePositionsDisplayCacheValid=!1},isCacheValid:function(){return this.buildablePositionsDisplayCacheValid},prevalidateCache:function(){this.buildablePositionsDisplayCacheValid=!0},update:function(t){if(this.lastBuilt+=t,this.city.game.isMobile&&!this.buildablePositionsDisplayCacheValid)for(var e=(rt=this.city.builderHighlightStage).children.length-1;0<=e;)rt.children[e].destroy(),--e;if(this.wasMouseHandled||(this.sprite.alpha=0),0<this.touchAlpha&&(this.touchAlpha=Math.max(this.touchAlpha-t/30,0)),this.wasMouseHandled=!1,this.city.game.mouse.rightPressed&&this.cancel(),this.showContinuousTooltip(),this.city.buildingMode!=ot.Destroy&&this.city.buildingMode!=ot.DestroyLeavingHole&&this.buildingPrerequirementsValid()){var i=this.city.game.isMobile&&!this.city.game.mouse.hasSpecificClaim(this);if(i&&!this.buildablePositionsDisplayCacheValid){for(var n=new jo,r=0,s=this.city.worlds;r<s.length;){var o=s[r];++r;for(var a=1e7,l=null,h=o.rect.x-20,u=0,c=0,d=this.city.worlds;c<d.length;){var p=d[c];++c,p.rect.y<a&&p.rect.y>o.rect.y&&h>=p.rect.x&&h<p.rect.get_x2()&&(u=(h-(l=p).rect.x)/20|0,a=p.rect.y)}if(null!=l){var f=n.h[l.__id__];null==f&&(f=[],n.set(l,f)),f.push({world:l,x:u,checkUntil:((l.rect.y-o.rect.y)/20|0)+o.permanents[0].length})}for(var g=1e7,m=null,y=o.rect.x+o.rect.width,_=0,v=0,b=this.city.worlds;v<b.length;){var w=b[v];++v,w.rect.y<g&&w.rect.y>o.rect.y&&y>=w.rect.x&&y<w.rect.get_x2()&&(g=(m=w).rect.y,_=(y-m.rect.x)/20|0)}if(null!=m){var S=n.h[m.__id__];null==S&&(S=[],n.set(m,S)),S.push({world:m,x:_,checkUntil:((m.rect.y-o.rect.y)/20|0)+o.permanents[o.permanents.length-1].length})}}var x=this.city.getCityEdges();for(r=[],s=0,c=(x.maxX-x.minX)/20|0;s<c;){var T=s++;r.push([])}var I=r;for(r=0,s=this.city.miscCityElements.allMiscElements;r<s.length;){var P=s[r];if(++r,P.is(Zo))I[((z=P).rect.x-x.minX)/20|0].push(z)}for(r=0,s=this.city.worlds;r<s.length;){o=s[r];if(++r,null==this.fixedToWorld||o==this.fixedToWorld)switch((c=this.builderType)._hx_index){case 0:var C=c.buildingInfo,E=c.buildingType;for(d=0,v=o.permanents.length;d<v;){T=[d++];if(null==this.fixedToPos||T[0]==this.fixedToPos){var A=o.permanents[T[0]].length+1;if(1<=T[0]){var M=o.permanents[T[0]-1].length;A<M&&(A=M)}var B=n.h[o.__id__],R=null==B?null:gr.whereMax(B,function(e){return function(t){return e[0]==t.x}}(T),function(t){return t.checkUntil});if(null!=R){var O=R.checkUntil;A<O&&(A=O)}b=0;for(var k=A;b<k;){var D=b++;if(this.canBuildBuilding(o,T[0],D,E,C)==st.BuildingOK){var F=dt.makeSprite("spr_buildhereoutline");F.position.set(o.rect.x+20*T[0],o.rect.y-20*(1+D)),this.city.builderHighlightStage.addChild(F),this.buildingModeCanReplace()&&o.permanents[T[0]].length>D&&null!=o.permanents[T[0]][D]&&(F.tint=16776960)}}var N=(20*T[0]+o.rect.x-x.minX)/20|0;if(0<=N&&N<I.length)for(var L=0,U=I[N];L<U.length;){var z=U[L];++L;var W=(o.rect.y-z.rect.y)/20|0;if(0<W&&this.canBuildBuilding(o,T[0],W,E,C)==st.BuildingOK){var G=dt.makeSprite("spr_buildhereoutline");G.position.set(z.rect.x,z.rect.y-20),this.city.builderHighlightStage.addChild(G),this.buildingModeCanReplace()&&o.permanents[T[0]].length>W&&null!=o.permanents[T[0]][W]&&(G.tint=16776960)}}}}break;case 1:c.decorationInfo;if(!o.canBuildOnSurface())continue;for(var H=0,X=o.permanents.length;H<X;){var j=H++;if(null==this.fixedToPos||j==this.fixedToPos){var V=o.permanents[j];if(0==V.length||null==V[0]){var Y=dt.makeSprite("spr_buildhereoutline");Y.position.set(o.rect.x+20*j,o.rect.y-20),this.city.builderHighlightStage.addChild(Y)}}}break;case 2:c.resourceInfo;if(!o.canBuildOnSurface())continue;for(var q=0,K=o.permanents.length;q<K;){var $=q++;if(null==this.fixedToPos||$==this.fixedToPos){var Q=o.permanents[$];if(0==Q.length||null==Q[0]){var J=dt.makeSprite("spr_buildhereoutline");J.position.set(o.rect.x+20*$,o.rect.y-20),this.city.builderHighlightStage.addChild(J)}}}break;case 3:c.worldResource;if(!o.canBuildOnSurface())continue;for(var Z=0,tt=o.permanents.length;Z<tt;){var et=Z++;if(null==this.fixedToPos||et==this.fixedToPos){var it=o.permanents[et];if(0==it.length||null==it[0]){var nt=dt.makeSprite("spr_buildhereoutline");nt.position.set(o.rect.x+20*et,o.rect.y-20),this.city.builderHighlightStage.addChild(nt)}}}}}this.builderType._hx_index;this.buildablePositionsDisplayCacheValid=!0}else if(!i){for(e=(rt=this.city.builderHighlightStage).children.length-1;0<=e;)rt.children[e].destroy(),--e;this.buildablePositionsDisplayCacheValid=!1}}else if(this.buildablePositionsDisplayCacheValid){var rt;for(e=(rt=this.city.builderHighlightStage).children.length-1;0<=e;)rt.children[e].destroy(),--e;this.buildablePositionsDisplayCacheValid=!1}},showContinuousTooltip:function(){if(this.city.game.isMobile){var t=this.builderType;switch(t._hx_index){case 0:var e=t.buildingInfo,i=t.buildingType;this.city.gui.buildingButtons.showBuildingTooltip(e,i,this,!0);break;case 1:var n=t.decorationInfo;this.city.gui.buildingButtons.showDecorationTooltip(n,this,!0);break;case 2:var r=t.resourceInfo;this.city.gui.buildingButtons.showWorldResourceTooltip(r,this,!0);break;case 4:this.city.gui.buildingButtons.showFloatingPlatformTooltip(this,!0);break;case 5:var s=t.bridgeInfo;this.city.gui.buildingButtons.showBridgeTooltip(s,this,!0)}}},handleMouse:function(t){if(this.city.buildingMode==ot.Destroy||this.city.buildingMode==ot.DestroyLeavingHole)return!1;this.wasMouseHandled=!0,this.sprite.alpha=.2;var e=20*Math.floor(t.get_cityX()/20),i=20*Math.floor(t.get_cityY()/20);if(this.sprite.position.set(e,i),this.builderSecondaryHelpSprite.position.set(e,i),this.sprite.tint=16777215,0<=this.decorationAppearanceColor&&(this.sprite.tint=this.decorationAppearanceColor),this.builderSecondaryHelpSprite.alpha=0,5==(r=this.builderType)._hx_index){var n=r.bridgeInfo;m=!0}else m=!1;if(m){var r=0;for(n=this.extraSprites;r<n.length;){var s=n[r];++r,s.destroy()}this.extraSprites=[]}if(0==(r=this.builderType)._hx_index){n=r.buildingInfo,n=r.buildingType;m=!0}else m=!1;if(this.city.miscCityElements.isUnbuildable(new vr(e,i),m))return!1;if(this.buildingPrerequirementsValid()){if(4==this.builderType._hx_index){if(this.canPlaceMiscCityElement(e,i)){var o=t.get_cityX()/20|0,a=t.get_cityY()/20|0;switch(this.buildingModeCanDrag()?(O=t.claimMouse(this,"",!0,!0,!0),t.hasStrongClaim=!0,t.strongClaimOnUpdate=null):O=t.claimMouse(this,o+" "+a,!1),O._hx_index){case 0:return this.sprite.alpha=.8,!0;case 1:return this.buildFloatingPlatform(e,i),!0}}return!1}if(5==(r=this.builderType)._hx_index){var l=r.bridgeInfo;if(this.canPlaceMiscCityElement(e,i)){var h=this.getBridgeRect(l,e,i);if(null!=h){o=t.get_cityX()/20|0,a=t.get_cityY()/20|0;this.buildingModeCanDrag()?(O=t.claimMouse(this,"",!0,!0,!0),t.hasStrongClaim=!0,t.strongClaimOnUpdate=null):O=t.claimMouse(this,o+" "+a,!1);var u=dt.getTexturesBySizeInverse(l.textureName,20,20,2)[0],c=h.width/20|0;for(r=0,n=c;r<n;){var d=r++;(s=new PIXI.Sprite(u[(0==d?1:0)+(d==c-1?2:0)])).position.set(h.x+20*(1+d),h.y),this.extraSprites.push(s),s.alpha=.5,this.stage.addChild(s)}switch(this.sprite.alpha=0,O._hx_index){case 0:for(r=0,n=this.extraSprites;r<n.length;){s=n[r];++r,s.alpha=.8}return!0;case 1:return this.buildBridge(l,e,i),!0}}}return!1}var p=this.calculateCurrentCost(),f=!1;for(r=0,n=this.city.worlds;r<n.length;){var g=n[r];if(++r,null==this.fixedToWorld||g==this.fixedToWorld){var m,y=t.get_cityX(),_=g.rect.x,v=g.rect.get_x2();if(_<=y&&y<v)m=!0;else{var b;if(this.buildingModeCanDrag()&&t.hasSpecificClaim(this)){var w=t.prevCityPosition.x,S=g.rect.x,x=g.rect.get_x2();if(S<=w&&w<x)b=!0;else{var T=g.rect.x,I=Math.min(t.prevCityPosition.x,t.get_cityX()),P=Math.max(t.prevCityPosition.x,t.get_cityX());b=I<=T&&T<P}}else b=!1;if(b){var C=this.builderType;if(0==C._hx_index){C.buildingInfo,C.buildingType;m=!0}else m=!1}else m=!1}if(m&&t.get_cityY()<g.rect.y){o=(t.get_cityX()-g.rect.x)/20|0;if(null!=this.fixedToPos&&o!=this.fixedToPos)break;var E=g.permanents[o],A=(a=(g.rect.y-t.get_cityY()-1)/20|0,this.builderType);switch(A._hx_index){case 0:var M=A.buildingInfo,B=A.buildingType;if(this.buildingModeCanDrag()&&t.hasSpecificClaim(this))this.tryBuildingMulti(g,B,M,t)&&(f=!0);else{var R=this.canBuildBuilding(g,o,a,B,M);if(R==st.BuildingOK){if(this.tryBuildingAt(g,o,a,B,M,t))return!0}else if(R==st.BuildingInWorld){var O;if(this.sprite.tint=16744576,t.isTouch)if((O=t.claimMouse(this,o,!1))==$.Active)return this.touchAlpha=1,this.sprite.alpha=this.touchAlpha,!0}else if(R==st.WorldNotAllowed){t.claimMouse(this,o,!1)==$.Active&&g.onCannotBuild()}}break;case 1:var k=A.decorationInfo;if(!g.canBuildOnSurface()){if(0==a)t.claimMouse(this,o,!1)==$.Active&&g.onCannotBuild();continue}if((0==E.length||null==E[0])&&0==a){this.sprite.alpha=.5;var D=t.claimMouse(this,o+" "+a,!1);if(D==$.Confirmed){var F=g.decorations[o];return"spr_removedecoration"==k.textureName?g.removeDecoration(o):null!=F&&F.textureName==k.textureName?(++F.subImage>=F.textures.length&&(F.subImage=0),F.sprite.texture=F.textures[F.subImage]):g.setDecoration(k.textureName,o),this.city.materials.remove(p),this.city.game.audio.playSound(this.city.game.audio.decorateSound),!0}if(D==$.Active)return this.sprite.alpha=.8,!0}break;case 2:var N=A.resourceInfo;if(!g.canBuildOnSurface()){if(0==a)t.claimMouse(this,o,!1)==$.Active&&g.onCannotBuild();continue}if((0==E.length||null==E[0])&&0==a){this.sprite.alpha=.5;var L=t.claimMouse(this,o+" "+a,!1);if(L==$.Confirmed){var U="worldResources."+N.className,z=g.createWorldResource(q[U],o);if(z instanceof Ih){var W=z;null==N.initialResources?W.materialsLeft=0:W.materialsLeft=N.initialResources,null!=N.initialGrow&&(W.regrowProgress=N.initialGrow),W.updateTexture()}return this.city.materials.remove(p),this.city.game.audio.playSound(this.city.game.audio.decorateSound),this.city.connections.updateCityConnections(),this.city.simulation.updatePathfinder(!1),!0}if(L==$.Active)return this.sprite.alpha=.8,!0}break;case 3:var G=A.worldResource;if(!g.canBuildOnSurface()){if(0==a)t.claimMouse(this,o,!1)==$.Active&&g.onCannotBuild();continue}if((0==E.length||null==E[0])&&0==a&&g.canBuildOnSurface()){this.sprite.alpha=.5;var H=t.claimMouse(this,o+" "+a,!1);if(H==$.Confirmed){for(var X=0,j=this.city.simulation.citizens;X<j.length;){var V=j[X];if(++X,V.inPermanent==G){if(null!=V.inPermanent&&V.inPermanent.isBuilding){var Y=null!=V.inPermanent&&V.inPermanent.isBuilding?V.inPermanent:null;V.relativeX=20*Y.worldPosition.x+Y.doorX}else V.relativeX+=20*V.inPermanent.worldPosition.x;null!=V.inPermanent&&V.inPermanent.onCitizenLeave(V,null),V.inBuildingSince=V.city.simulation.time.timeSinceStart,V.set_drawOnStage(V.foregroundStage),V.inPermanent=null,V.relativeY=0,K.shouldUpdateDraw=!0}}return 1==G.world.permanents[G.worldPosition.x].length?G.world.permanents[G.worldPosition.x].splice(0,1):G.world.permanents[G.worldPosition.x][0]=null,G.world=g,G.worldPosition.x=o,G.position.x=g.rect.x+20*o,G.position.y=g.rect.y-20,G.positionSprites(),(E[0]=G).world.removeDecoration(o),this.city.game.audio.playSound(this.city.game.audio.buildSound),this.city.connections.updateCityConnections(),this.city.simulation.updatePathfinder(!0),!0}if(H==$.Active)return this.sprite.alpha=.8,!0}break;case 4:break;case 5:A.bridgeInfo}}}}if(f)return!0}else this.sprite.tint=16744576,this.sprite.alpha=.6;return this.city.cityView.isDraggingView?this.sprite.alpha=0:t.isTouch&&(this.sprite.alpha=this.touchAlpha),!1},buildFloatingPlatform:function(t,e){var i=this.calculateCurrentCost();this.city.materials.remove(i),this.city.game.audio.playSound(this.city.game.audio.buildSound),this.city.miscCityElements.addElement(new Zo(this.city,new vr(t,e)));var n=gr.whereMax(this.city.worlds,function(t){return 0==t.rect.height},function(t){return t.rect.width});t<n.rect.x?n.resizeInvisibleWorld(t,n.rect.width+(n.rect.x-t)):t>=n.rect.x&&n.resizeInvisibleWorld(n.rect.x,t-n.rect.x+20),this.city.connections.updateCityConnections(),this.city.simulation.updatePathfinder(!0)},buildBridge:function(t,e,i){var n=this.calculateCurrentCost();this.city.materials.remove(n),this.city.game.audio.playSound(this.city.game.audio.buildSound);var r="miscCityElements."+t.className;this.city.miscCityElements.addElement(k.createInstance(q[r],[this.city,new vr(e,i)])),this.city.connections.updateCityConnections(),this.city.simulation.updatePathfinder(!0);r="miscCityElements."+t.className;this.city.progress.unlocks.research(q[r])},tryBuildingMulti:function(t,e,i,n){var r=n.prevCityPosition,s=n.cityPosition,o=s.x-r.x,a=s.y-r.y,l=new br(o,a),h=l.get_length();if(0<Math.max(Math.abs(l.x),Math.abs(l.y))){var u=Math.max(Math.abs(l.x),Math.abs(l.y));l=new br(l.x/u,l.y/u)}for(var c=!1,d=new br(0,0);d.get_length()<=h;){var p=r.x+d.x,f=r.y+d.y,g=Math.floor(p-t.rect.x)/20|0,m=Math.floor(t.rect.y-f-1)/20|0;if(0<=g&&g<t.permanents.length){if(null!=this.fixedToPos&&g!=this.fixedToPos)break;this.canBuildBuilding(t,g,m,e,i)==st.BuildingOK&&this.buildingPrerequirementsValid()&&this.tryBuildingAt(t,g,m,e,i,n)&&(c=!0)}if(l.get_length()<1e-4)return c;for(;g==(Math.floor(r.x+d.x-t.rect.x)/20|0)&&m==(Math.floor(t.rect.y-r.y-d.y-1)/20|0);)d=new br(d.x+l.x,d.y+l.y)}return c},tryBuildingAt:function(t,e,i,n,r,s){var o=this.calculateCurrentCost(),a=t.permanents[e],l=!(this.sprite.alpha=.5),h=!1;this.buildingModeCanReplace()?l=i!=a.length&&null!=a[i]:h=i!=a.length&&null!=a[i],h?(this.builderSecondaryHelpSprite.alpha=1,this.sprite.tint=12632256,0<=this.decorationAppearanceColor&&(this.sprite.tint=this.decorationAppearanceColor),this.builderSecondaryHelpSprite.texture=dt.getTexture("spr_insertbuildinghere")):l&&(this.builderSecondaryHelpSprite.alpha=1,this.sprite.tint=16777215,0<=this.decorationAppearanceColor&&(this.sprite.tint=this.decorationAppearanceColor),this.builderSecondaryHelpSprite.texture=dt.getTexture("spr_replacebuildinghere"));var u=$.None;if(this.buildingModeCanDrag()?(u=s.claimMouse(this,"",!0,!0,!0),s.hasStrongClaim=!0,s.strongClaimOnUpdate=null):u=s.claimMouse(this,e+" "+i,!1),u!=$.Confirmed)return u==$.Active?(this.sprite.alpha=.8,!0):(this.city.game.isMobile&&(this.builderSecondaryHelpSprite.alpha=0),!1);var c=!0;if(l)i<a.length&&null!=a[i]&&((c=Ko.getClass(a[i])!=this.get_buildingToBuild())&&a[i].isBuilding&&a[i].giveRecycleReward(c),a[i].destroyForReplacement());else if(h)for(var d=i,p=a.length;d<p;){var f=a[d++];if(null==f)break;f.position.y-=20,f.worldPosition.y+=1}var g=t.build(this.get_buildingToBuild(),e,i);-1!=r.specialInfo.indexOf("as_multi_decor")&&g.customize(this.decorationAppearance,this.mirrored),-1!=r.specialInfo.indexOf("as_multi_decor_anycolor")&&0<=this.decorationAppearanceColor&&g.customizeColor(this.decorationAppearanceColor),this.city.game.audio.playSound(this.city.game.audio.buildSound),c&&this.city.materials.remove(o),this.city.onBuildBuilding(h,l,g,this.get_buildingToBuild(),i,a),this.fixBuilder(null,null),this.lastBuilt<0||60<this.lastBuilt?(this.city.progress.unlocks.checkBuildRelatedUnlocks(),this.city.saveToBrowserStorageSoon()):this.city.progress.unlocks.checkBuildRelatedUnlocksSoon(),null!=this.city.windowRelatedOnBuildOrDestroy&&this.city.windowRelatedOnBuildOrDestroy(),this.lastBuilt=0;g.is(fn);return!0},buildingPrerequirementsValid:function(){var e=this,t=this.builderType;switch(t._hx_index){case 3:t.worldResource;return!0;case 4:var i=this.calculateCurrentCost();return this.city.materials.canAfford(i)}null!=this.get_buildingToBuild()&&this.city.progress.unlocks.getUnlockState(this.get_buildingToBuild())==$a.Researched&&(this.originalCost.knowledge=0);var n=!this.isUniqueBuilding||!gr.any(this.city.permanents,function(t){return t.is(e.get_buildingToBuild())});n&&this.isLimitedBuilding&&(n=0<this.isLimitedToNumber?lt.count(this.city.permanents,function(t){return t.is(e.get_buildingToBuild())})<this.isLimitedToNumber:lt.count(this.city.permanents,function(t){return t.is(e.get_buildingToBuild())})<Math.ceil(this.city.simulation.citizens.length/this.isLimitedToOnePerNCitizens));i=this.calculateCurrentCost();return!!this.city.materials.canAfford(i)&&n},calculateCurrentCost:function(){var t=this.builderType;switch(t._hx_index){case 0:t.buildingType;var e=t.buildingInfo,i=this.city.progress.buildingCost.getBuildingCost(e);return null!=this.get_buildingToBuild()&&this.city.progress.unlocks.getUnlockState(this.get_buildingToBuild())==$a.Researched&&(i.knowledge=0),i;case 4:return U.floatingPlatformCost;case 5:var n=t.bridgeInfo,r=(i=this.originalCost.copy(),"miscCityElements."+n.className),s=q[r];return null!=s&&this.city.progress.unlocks.getUnlockState(s)==$a.Researched&&(i.knowledge=0),i;default:return this.originalCost}},canPlaceMiscCityElement:function(t,e){if(e>gr.whereMax(this.city.worlds,function(t){return 0==t.rect.height},function(t){return t.rect.width}).rect.y-20)return!1;for(var i=0,n=this.city.worlds;i<n.length;){var r=n[i];if(++i,!(t>=r.rect.get_x2()||t<r.rect.x)){var s=r.permanents[(t-r.rect.x)/20|0],o=((r.rect.y-e)/20|0)-1;if(s.length>o&&null!=s[o])return!1;if(r.rect.intersects(new yr(t,e-20,20,40))&&null!=r.mask&&r.mask[(t-r.rect.x)/20|0][(e-r.rect.y)/20|0])return!1;if(null!=s[s.length-1]&&s[s.length-1].isBuilding&&-1!=s[s.length-1].info.specialInfo.indexOf("cityTop"))return!1}}return!0},getBridgeRect:function(t,e,i){for(var n=t.maxSize,r=e,s=null,o=0,a=n;o<a;){o++;if(r-=20,null!=(l=this.city.getPermanentAtPos(r,i))){l.isBuilding&&!l.cannotBuildOnTop&&(s=l);break}}if(r+=20,null!=s)for(o=0,a=n;o<a;){var l;o++;if(r+=20,null!=(l=this.city.getPermanentAtPos(r,i))){if(l.isBuilding&&!l.cannotBuildOnTop)return new yr(s.position.x,i,l.position.x-s.position.x-20,20);break}}return null},canBuildBuilding:function(e,t,i,n,r){if(0==i&&!e.canBuildOnSurface())return st.WorldNotAllowed;if(!e.canBuildOnNotSurface("TheMachine"==r.className&&!this.buildingModeCanReplace()))return st.WorldNotAllowed;if(-1!=r.specialInfo.indexOf("buildOnGround")){if(0!=i)return st.BuildingPositionImpossible;if(0<e.permanents[t].length&&null!=e.permanents[t][i])return st.BuildingPositionImpossible}var s=e.permanents[t],o=e.rect.y-20*(s.length+1),a=e.rect.x+20*t,l=e.rect.y-20*(i+1),h=0==s.length,u=!h&&s[s.length-1].isBuilding,c=h||null==s[0]||s[0].isBuilding,d=u&&s[s.length-1].cannotBuildOnTop?20+o:o,p=!1,f=!1,g=this.city.game.keyboard.down[46],m=this.city.game.keyboard.down[16],y=!g&&!m,_=this.city.buildingMode==ot.Insert&&y,v=this.buildingModeCanReplace()&&y;!v&&i<s.length&&null!=s[i]&&s[i].isBuilding&&s[i].cannotBuildOnTop&&(_=!0);var b=i<s.length&&null!=s[i]&&s[i].isBuilding,w=!1,S=!1,x=null,T=null,I=!1;if(b&&(S=this.city.buildingMode==ot.DragReplace&&Ko.getClass(s[i])==n&&(!Ko.__implements(s[i],Oe)||s[i].areSameCustomizations(this.decorationAppearance,this.mirrored,this.decorationAppearanceColor)),w=s[i].cannotBuildOnTop,-1!=s[i].info.specialInfo.indexOf("disableInsertReplaceOrBuildOnTop")))return st.BuildingPositionImpossible;if("cityofthekey"==this.city.progress.story.storyName&&b&&v){var P=s[i];if(P.is(mi)&&(100==P.position.x||-100==P.position.x))return st.BuildingPositionImpossible}if((i>=s.length||null==s[i])&&0<i){if(-1==r.specialInfo.indexOf("rooftop")){x=this.city.getPermanentAtPos(a-20,l),T=this.city.getPermanentAtPos(a+20,l);var C=this.city.upgrades.vars.advancedBuildingAllowed,E=null!=x&&x.isBuilding,A=null!=T&&T.isBuilding;if(C?E||A:E&&A){var M=x,B=T;I=!0;(C?!(null!=M&&!M.cannotBuildOnTop||null!=B&&!B.cannotBuildOnTop):M.cannotBuildOnTop||B.cannotBuildOnTop)||(p=!0)}}p||(f=this.city.miscCityElements.collidesSpecific(new vr(a,20+l),Zo)),(p||f)&&gr.any(this.city.worlds,function(t){return t!=e&&a>=t.rect.x&&a<t.rect.get_x2()&&0<t.rect.y-l&&t.rect.y-l<e.rect.y-l})&&(f=p=!1)}var R=!1;if(_)for(var O=i,k=s.length-1;O<k;){var D=O++;if(null==s[D]){if(this.city.miscCityElements.isUnbuildable(new vr(a,l-20*(D-i)),!0))return st.BuildingPositionImpossible;R=!0;break}if(s[D].isBuilding)if(s[D].cannotBuildOnTop&&null!=s[1+D])return st.BuildingPositionImpossible}if(-1!=r.specialInfo.indexOf("cityTop")){if(i!=s.length)return st.BuildingPositionImpossible;if(gr.any(this.city.worlds,function(t){return t.rect.y<l&&t.rect.x<=a&&t.rect.get_x2()>a}))return st.BuildingPositionImpossible;if(gr.any(this.city.miscCityElements.allMiscElements,function(t){return t.rect.y<l&&t.rect.x<=a&&t.rect.get_x2()>a}))return st.BuildingPositionImpossible}else if(0!=i&&i>=s.length&&null!=s[s.length-1]&&s[s.length-1].isBuilding&&-1!=s[s.length-1].info.specialInfo.indexOf("cityTop"))return st.BuildingPositionImpossible;var F=-1!=r.specialInfo.indexOf("rooftop"),N=this.city.upgrades.vars.advancedBuildingAllowed;if(v&&b&&(!F||w)&&!S||(h||u||p||f)&&(0!=i||c)&&((_||i<s.length&&null==s[i])&&d<=l&&l<e.rect.y&&(0==i||I||0<i&&null!=s[i]&&s[i].isBuilding||0<i&&null!=s[i-1]&&s[i-1].isBuilding&&!s[i-1].cannotBuildOnTop)||!_&&y&&d<=l&&l<20+d||p||f)&&(i>=s.length||null==s[i]&&p||0==i||null!=s[i-1]||_||f)&&(!F||i==s.length||null==s[i]||f||i==s.length-1&&v&&s[i].isBuilding&&!S&&(0==i||null!=s[i].bottomBuilding&&!s[i].bottomBuilding.cannotBuildOnTop)&&U.canRemoveFromLRPerspective(N,s[i],this.city))){var L=_?l<o?l:o:l;return R?st.BuildingOK:_&&i<s.length&&null==s[i]?st.BuildingOK:this.city.miscCityElements.isUnbuildable(new vr(a,L),!0)?st.BuildingPositionImpossible:i<s.length&&null==s[i]?st.BuildingOK:gr.any(this.city.worlds,function(t){return t!=e&&null!=t.mask&&(!!t.rect.intersects(new yr(a,L,20,20))&&t.mask[(a-t.rect.x)/20|0][(L-t.rect.y)/20|0])})?st.BuildingInWorld:st.BuildingOK}return st.BuildingPositionImpossible},cancel:function(){this.sprite.destroy();for(var t=0,e=this.extraSprites;t<e.length;){var i=e[t];++t,i.destroy()}this.builderSecondaryHelpSprite.destroy(),null!=this.fixedSprite&&this.fixedSprite.destroy(),(this.city.builder=null)!=this.city.specialActionOld&&this.city.specialActionOld.activate()},buildingModeCanReplace:function(){return this.city.buildingMode==ot.Replace||this.city.buildingMode==ot.DragReplace},buildingModeCanDrag:function(){return this.city.buildingMode==ot.Drag||this.city.buildingMode==ot.DragReplace},__class__:U};function n(){}(q.ICreatableCityElement=n).__name__="ICreatableCityElement",n.__isInterface__=!0;var y=function(t,e,i,n,r,s){this.destroyed=!1,this.highlightSprite=null,this.bonusEntertainmentCapacity=0,this.bonusAttractiveness=0,this.game=t,this.id=e,this.city=i,this.world=n,this.position=r,this.worldPosition=s,n.city.permanentsByID.h[e]=this,n.city.permanents.push(this);var o=(u=Ko.getClass(this)).__name__;if(Object.prototype.hasOwnProperty.call(i.permanentNumberCached.h,o)){var a=o,l=i.permanentNumberCached.h[a]+1;i.permanentNumberCached.h[a]=l}else i.permanentNumberCached.h[o]=1;this.isBuilding=!1,this.ancestors=[];for(var h=Ko.getClass(this);h!=y;)this.ancestors.push(h),h=h.__super__;var u=Ko.getClass(this);this.className=u.__name__,this.classID=ht.getClassID(this.className),Ko.__implements(this,ne)&&-1==this.ancestors.indexOf(re)&&this.ancestors.push(re),this.is(ee)&&n.city.workBuildings.push(this)};(q.Permanent=y).__name__="Permanent",y.__interfaces__=[n],y.prototype={get_name:function(){return""},get_typeID:function(){return 0},get_attractiveness:function(){return this.get_baseAttractiveness()+this.bonusAttractiveness},get_baseAttractiveness:function(){return 50},get_entertainmentCapacity:function(){return this.get_baseEntertainmentCapacity()+this.bonusEntertainmentCapacity},get_baseEntertainmentCapacity:function(){return 0},get_remainingCapacity:function(){return 0},get_connectedBuildingsType:function(){return this.className},destroyForReplacement:function(){y.destroyingForReplacement=!0,this.destroy(),y.destroyingForReplacement=!1},destroy:function(){this.destroyed=!0;var t=this.world.permanents[this.worldPosition.x],e=!1;y.destroyingDisableMoveDown||y.destroyingForReplacement?e=!(t[this.worldPosition.y]=null):this.is(E)&&1<t.length?e=!(t[0]=null):at.remove(t,this),at.remove(this.city.permanents,this),this.city.permanentsByID.remove(this.id);var i=Ko.getClass(this).__name__;if(Object.prototype.hasOwnProperty.call(this.city.permanentNumberCached.h,i)){var n=i,r=this.city.permanentNumberCached.h[n]-1;this.city.permanentNumberCached.h[n]=r}this.is(ee)&&at.remove(this.world.city.workBuildings,this);for(var s=0,o=this.city.simulation.citizens;s<o.length;){var a=o[s];if(++s,a.inPermanent==this){if(0==this.worldPosition.y){if(null!=a.inPermanent&&a.inPermanent.isBuilding){var l=null!=a.inPermanent&&a.inPermanent.isBuilding?a.inPermanent:null;a.relativeX=20*l.worldPosition.x+l.doorX}else a.relativeX+=20*a.inPermanent.worldPosition.x;null!=a.inPermanent&&a.inPermanent.onCitizenLeave(a,null),a.inBuildingSince=a.city.simulation.time.timeSinceStart,a.set_drawOnStage(a.foregroundStage),a.inPermanent=null,a.relativeY=0,K.shouldUpdateDraw=!0}else{if(null!=(null!=a.inPermanent&&a.inPermanent.isBuilding?a.inPermanent:null).bottomBuilding)a.inPermanent=(null!=a.inPermanent&&a.inPermanent.isBuilding?a.inPermanent:null).bottomBuilding,a.onWorld=a.inPermanent.world,this.onCitizenLeave(a,(null!=a.inPermanent&&a.inPermanent.isBuilding?a.inPermanent:null).bottomBuilding),a.inBuildingSince=a.city.simulation.time.timeSinceStart;else if(null!=(null!=a.inPermanent&&a.inPermanent.isBuilding?a.inPermanent:null).leftBuilding)a.inPermanent=(null!=a.inPermanent&&a.inPermanent.isBuilding?a.inPermanent:null).leftBuilding,a.onWorld=a.inPermanent.world,this.onCitizenLeave(a,(null!=a.inPermanent&&a.inPermanent.isBuilding?a.inPermanent:null).leftBuilding),a.inBuildingSince=a.city.simulation.time.timeSinceStart;else if(null!=(null!=a.inPermanent&&a.inPermanent.isBuilding?a.inPermanent:null).rightBuilding)a.inPermanent=(null!=a.inPermanent&&a.inPermanent.isBuilding?a.inPermanent:null).rightBuilding,a.onWorld=a.inPermanent.world,this.onCitizenLeave(a,(null!=a.inPermanent&&a.inPermanent.isBuilding?a.inPermanent:null).rightBuilding),a.inBuildingSince=a.city.simulation.time.timeSinceStart;else if(null!=(null!=a.inPermanent&&a.inPermanent.isBuilding?a.inPermanent:null).topBuilding)a.inPermanent=(null!=a.inPermanent&&a.inPermanent.isBuilding?a.inPermanent:null).topBuilding,a.onWorld=a.inPermanent.world,this.onCitizenLeave(a,(null!=a.inPermanent&&a.inPermanent.isBuilding?a.inPermanent:null).topBuilding),a.inBuildingSince=a.city.simulation.time.timeSinceStart;else if(0<a.onWorld.rect.height){if(null!=a.inPermanent&&a.inPermanent.isBuilding){var h=null!=a.inPermanent&&a.inPermanent.isBuilding?a.inPermanent:null;a.relativeX=20*h.worldPosition.x+h.doorX}else a.relativeX+=20*a.inPermanent.worldPosition.x;null!=a.inPermanent&&a.inPermanent.onCitizenLeave(a,null),a.inBuildingSince=a.city.simulation.time.timeSinceStart,a.set_drawOnStage(a.foregroundStage),a.inPermanent=null,a.relativeY=0,K.shouldUpdateDraw=!0}else{var u=[a.getCityPosition()],c=lt.find(this.city.permanents,function(e){return function(t){return e[0].x>=t.position.x&&e[0].x<t.position.x+20&&t.position.y>e[0].y}}(u));if(null!=c)a.inPermanent=c,a.onWorld=a.inPermanent.world,this.onCitizenLeave(a,c),a.inBuildingSince=a.city.simulation.time.timeSinceStart;else{var d=gr.whereMax(this.city.worlds,function(t){return 0<t.rect.height},function(e){return function(t){return-Math.abs(t.rect.get_center().x-e[0].x)-Math.abs(t.rect.get_center().y-e[0].y)}}(u));if(null!=a.inPermanent&&a.inPermanent.isBuilding){var p=null!=a.inPermanent&&a.inPermanent.isBuilding?a.inPermanent:null;a.relativeX=20*p.worldPosition.x+p.doorX}else a.relativeX+=20*a.inPermanent.worldPosition.x;null!=a.inPermanent&&a.inPermanent.onCitizenLeave(a,null),a.inBuildingSince=a.city.simulation.time.timeSinceStart,a.set_drawOnStage(a.foregroundStage),a.inPermanent=null,a.relativeY=0,K.shouldUpdateDraw=!0,a.onWorld=d,a.setRelativeX(0)}}a.setRelativeY(0)}a.recyclePathArray&&(ka.returnToPool(a.path),a.recyclePathArray=!1),a.path=null,a.nextPathPos=-1,a.pathEnd=-1,a.currentPathAction=-2,a.canViewSelfInBuilding||(a.delayCanViewSelfInBuilding=!0),a.canViewSelfInBuilding=!0,a.verticalPathProgress=0,a.pathEndFunction=null,a.requestingPathGoal=null,a.pathOnlyRelatedTo=null,a.pathWalkSpeed=1,a.pathCanBeReconsidered=!0,0<a.sprite.alpha&&a.sprite.alpha<1&&(a.sprite.alpha=1)}}if(!e){for(s=this.worldPosition.y,o=t.length;s<o;){var f=t[g=s++];if(null==f){t.splice(g,0,null);break}if(f.worldPosition.y-=1,f.position.y=this.world.rect.y-20*(f.worldPosition.y+1),f.isBuilding&&f.isRooftopBuilding&&g+1<t.length){t.splice(g+1,0,null);break}}for(var g=t.length-1,m=0;0<=g&&null==t[g];)++m,--g;0<m&&t.splice(t.length-m,m)}if(y.destroyingForReplacement||this.city.connections.updateCityConnections(),!e)for(s=this.worldPosition.y,o=t.length;s<o;){null!=t[g=s++]&&t[g].positionSprites()}y.destroyingForReplacement||this.city.simulation.updatePathfinder(!0,this),this.city.gui.windowRelatedTo==this&&this.city.gui.closeWindow();for(s=0,o=this.city.simulation.citizens;s<o.length;){a=o[s];++s,a.actuallyUpdateDraw()}},postCreate:function(){},onCityChange:function(){},onCityChangePost:function(){},invalidatePathfindingRelatedInfo:function(){},update:function(t){},onClick:function(){null!=this.city.specialAction&&this.city.specialAction.get_hasPermanentAction()?this.city.specialAction.performPermanentAction(this):(this.showWindow(),this.city.game.audio.playSound(this.city.game.audio.buildingClickSound))},onHover:function(t){},showWindow:function(){po.hasMultiUpgradeModeOn=!1,this.createWindow()},reloadWindow:function(){this.city.gui.reloadWindow(Uh(this,this.createWindow))},createWindow:function(){var t=this;this.city.gui.createWindow(this),this.city.gui.setWindowReload(Uh(this,this.createWindow)),this.city.gui.windowAddTitleText(this.get_name()),this.createMainWindowPart(),this.createWindowAddBottomButtons(),this.selectedSprite=dt.makeSprite("spr_selectedbuilding"),this.selectedSprite.position.set(this.position.x-1,this.position.y-1),this.city.farForegroundStage.addChild(this.selectedSprite);var e=this.city.gui.windowOnDestroy;this.city.gui.windowOnDestroy=function(){null!=e&&e(),t.selectedSprite.destroy(),t.selectedSprite=null},this.city.gui.clearWindowStack(),this.city.gui.addWindowToStack(function(){t.destroyed||t.createWindow()})},addWindowInfoLines:function(){},createMainWindowPart:function(){this.addWindowInfoLines()},createWindowAddBottomButtons:function(){this.city.gui.windowAddBottomButtons()},positionSprites:function(){null!=this.selectedSprite&&this.selectedSprite.position.set(this.position.x-1,this.position.y-1),null!=this.highlightSprite&&this.highlightSprite.position.set(this.position.x-1,this.position.y-1)},is:function(t){for(var e=0,i=this.ancestors;e<i.length;){var n=i[e];if(++e,t==n)return!0}return!1},onCitizenLeave:function(t,e){},save:function(t,e){null==e&&(e=!0),e&&t.addString(y.saveDefinition)},load:function(t,e){null==e&&(e=t.readString());Dr.makeLoadMap(e,t)},__class__:y};function _(t,e,i,n,r,s,o,a){this.isMedical=!1,this.isEntertainment=!1,this.doorX=13,y.call(this,t,a,n,r,s,o),this.isBuilding=!0,this.upgrades=[],this.buildingMode=null,this.adjecentBuildingEffects=[],this.stage=e,this.bgStage=i,this.drawer=k.createInstance(this.get_drawerType(),[this,e,i,F.field(Ko.getClass(this),"spriteName")]),this.info=n.progress.resources.buildingInfo.h[this.className],this.isRooftopBuilding=-1!=this.info.specialInfo.indexOf("rooftop"),this.cannotBuildOnTop=this.isRooftopBuilding||-1!=this.info.specialInfo.indexOf("disableInsertReplaceOrBuildOnTop"),n.simulation.jobAssigner.buildingsHaveWork=!0,n.simulation.houseAssigner.shouldUpdateHouses=!0,n.simulation.schoolAssigner.schoolsShouldBeUpdated=!0,!g.isLoading&&0<this.get_possibleBuildingModes().length&&(this.buildingMode=k.createInstance(this.get_possibleBuildingModes()[0],[e,n.cityMidStage,i,this]))}(q.Building=_).__name__="Building",_.__super__=y,_.prototype=e(y.prototype,{get_name:function(){return this.info.name},get_possibleUpgrades:function(){return[]},get_possibleBuildingModes:function(){return[]},get_possibleCityUpgrades:function(){return[]},get_possiblePolicies:function(){return[]},get_walkThroughCanViewSelfInThisBuilding:function(){return!0},get_drawerType:function(){return Fn},onBuild:function(){},destroy:function(){!this.isRooftopBuilding&&this.city.buildingMode!=ot.DestroyLeavingHole||this.worldPosition.y==this.world.permanents[this.worldPosition.x].length-1||(y.destroyingDisableMoveDown=!0),y.prototype.destroy.call(this),y.destroyingDisableMoveDown=!1,this.drawer.destroy(),lt.iter(this.upgrades,function(t){t.destroy()}),null!=this.buildingMode&&this.buildingMode.destroy(),null!=this.city.windowRelatedOnBuildOrDestroy&&this.city.windowRelatedOnBuildOrDestroy()},tryDestroy:function(t){null==t&&(t=!0);var e=!1,i=this.city.upgrades.vars.advancedBuildingAllowed;if(null!=this.world&&this.world.isProtectedKey)return t&&this.city.gui.showSimpleWindow(Tr.lo("secret_society_forbidden"),null,!0,!0),!1;if(!this.isRooftopBuilding){for(var n=this;null!=n.topBuilding&&!n.topBuilding.isRooftopBuilding;)n=n.topBuilding;e=this.city.buildingMode==ot.DestroyLeavingHole?!U.canRemoveLeavingHoleFromStructuralPerspective(i,this,this.city):!U.canRemoveFromLRPerspective(i,n,this.city),null!=this.topBuilding&&this.topBuilding.isRooftopBuilding&&null==this.bottomBuilding&&0!=this.worldPosition.y&&!this.city.miscCityElements.collidesSpecific(new vr(this.position.x,this.position.y+20),Zo)&&(e=!0)}return e?(t&&(this.city.buildingMode==ot.DestroyLeavingHole?this.city.gui.showSimpleWindow(Tr.lo("invalid_structure_2"),null,!0,!0):this.city.gui.showSimpleWindow(Tr.lo("invalid_structure"),null,!0,!0)),!1):(this.giveRecycleReward(),this.destroy(),!0)},giveRecycleReward:function(t){if(null==t&&(t=!0),null!=this.info){for(var e=t?L.fromBuildingInfo(this.info):new L,i=0,n=this.upgrades;i<n.length;){var r=n[i];++i;var s=dt.buildingUpgradesInfo.h[r.className];e.add(L.fromBuildingUpgradesInfo(s))}e.knowledge=0,e.multiply(this.city.upgrades.vars.recyclingAmount),this.city.materials.add(e)}},createWindowAddBottomButtons:function(){var t=this;if(this.city.progress.story.disableDestroy)this.city.gui.windowAddBottomButtons();else{var e=null,i=!1;e=this.city.gui.windowAddBottomButtons([{text:Tr.lo("destroy"),action:function(){i?(t.city.gui.closeWindow(),t.tryDestroy(!0)):(e.setText(Tr.lo("really_destroy")),i=!0)},onHover:function(){i||t.city.gui.tooltip.setText(e,t.game.isMobile?Tr.lo("destroy_this_building"):Tr.lo("destroy_this_building")+"\n"+Tr.lo("destroy_tip"))}}])[0]}},positionSprites:function(){y.prototype.positionSprites.call(this),this.drawer.positionSprites(),lt.iter(this.upgrades,function(t){t.reposition()}),null!=this.buildingMode&&this.buildingMode.reposition()},changeMainTexture:function(t){this.drawer.changeMainTexture(t)},save:function(t,e){null==e&&(e=!0),y.prototype.save.call(this,t,e);var i=this.upgrades.length;if(t.size+4>t.bytes.length){var n=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+4))),t.bytes.blit(0,n,0,t.size)}t.bytes.setInt32(t.size,i),t.size+=4;for(var r=0,s=this.upgrades;r<s.length;){var o=s[r];++r,t.addString(o.className),o.save(t)}i=null!=this.buildingMode?1:0;if(t.size+4>t.bytes.length){n=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+4))),t.bytes.blit(0,n,0,t.size)}t.bytes.setInt32(t.size,i),t.size+=4,null!=this.buildingMode&&(t.addString(this.buildingMode.className),this.buildingMode.save(t))},load:function(t,e){y.prototype.load.call(this,t,e);var i=t.bytes.getInt32(t.readStart);t.readStart+=4;for(var n=0,r=i;n<r;){n++;var s=t.readString(),o=k.createInstance(q[s],[this.stage,this.city.cityMidStage,this.bgStage,this]);o.load(t),this.upgrades.push(o)}i=t.bytes.getInt32(t.readStart);if(t.readStart+=4,1==i){s=t.readString();this.buildingMode=k.createInstance(q[s],[this.stage,this.city.cityMidStage,this.bgStage,this]),this.buildingMode.load(t)}else this.buildingMode=null},createMainWindowPart:function(){y.prototype.createMainWindowPart.call(this),gs.createMainWindowPart(this,this.city)},getTotalAdjacentBuildingEffects:function(t){for(var e=0,i=0,n=this.adjecentBuildingEffects;i<n.length;){var r=n[i];++i,r.name==t&&(e+=r.intensity)}return e},getEffectsOfAdjecentBuildings:function(t){var e=0;if(null!=this.leftBuilding){for(var i=0,n=0,r=this.leftBuilding.adjecentBuildingEffects;n<r.length;){var s=r[n];++n,s.name==t&&(i+=s.intensity)}e+=i}if(null!=this.rightBuilding){for(i=0,n=0,r=this.rightBuilding.adjecentBuildingEffects;n<r.length;){s=r[n];++n,s.name==t&&(i+=s.intensity)}e+=i}if(null!=this.topBuilding){for(i=0,n=0,r=this.topBuilding.adjecentBuildingEffects;n<r.length;){s=r[n];++n,s.name==t&&(i+=s.intensity)}e+=i}if(null!=this.bottomBuilding){for(i=0,n=0,r=this.bottomBuilding.adjecentBuildingEffects;n<r.length;){s=r[n];++n,s.name==t&&(i+=s.intensity)}e+=i}return e},getEffectsOfAdjecentBuildingsLR:function(t){var e=0;if(null!=this.leftBuilding){for(var i=0,n=0,r=this.leftBuilding.adjecentBuildingEffects;n<r.length;){var s=r[n];++n,s.name==t&&(i+=s.intensity)}e+=i}if(null!=this.rightBuilding){for(i=0,n=0,r=this.rightBuilding.adjecentBuildingEffects;n<r.length;){s=r[n];++n,s.name==t&&(i+=s.intensity)}e+=i}return e},onClick:function(){null!=this.city.specialAction&&this.city.specialAction.get_hasPermanentAction()?this.city.specialAction.performPermanentAction(this):this.game.keyboard.down[46]||this.city.buildingMode==ot.Destroy||this.city.buildingMode==ot.DestroyLeavingHole?this.city.progress.story.disableDestroy?this.city.gui.showSimpleWindow(Tr.lo("no_destroy_allowed"),null,!0):(this.city.gui.windowRelatedTo==this&&this.city.gui.closeWindow(),this.tryDestroy(!0)&&this.city.game.audio.playSound(this.city.game.audio.buttonFailSound)):this.game.keyboard.down[16]?this.createOrRemoveBuilderForThis():(this.showWindow(),this.city.game.audio.playSound(this.city.game.audio.buildingClickSound))},createOrRemoveBuilderForThis:function(){this.city.createOrRemoveBuilder(Ko.getClass(this),!0)},onHover:function(t){if(y.prototype.onHover.call(this,t),(this.game.keyboard.down[46]||this.city.buildingMode==ot.Destroy||this.city.buildingMode==ot.DestroyLeavingHole)&&null==this.city.specialAction){var e=new PIXI.Sprite(dt.getTexture("spr_destroying"));e.position.set(this.position.x,this.position.y),this.city.furtherForegroundTempStage.addChild(e),e.alpha=t?1:this.game.isMobile?0:.5}},hasHolesBelowInBuildingStack:function(){for(var t=0,e=this.worldPosition.y;t<e;){var i=t++,n=this.world.permanents[this.worldPosition.x][i];if(null==n||!n.isBuilding)return!0}return!1},getGlobalGoal:function(){return null},couldStandHere:function(){return this.get_drawerType()!=Bn||(null==this.bottomBuilding||!this.bottomBuilding.is(Ko.getClass(this)))},__class__:_});function s(t,e){this.stage=t,this.building=e;var i=Ko.getClass(this);this.className=i.__name__,e.bonusAttractiveness+=this.get_bonusAttractiveness(),null!=t?(this.textures=dt.getTexturesByWidth(this.get_textureName(),20),this.spriteIndex=il.getInt(this.get_availableTextures()),this.sprite=new PIXI.Sprite(this.textures[this.spriteIndex]),this.reposition(),this.get_canCacheSprite()?(t.cacheableChildren.push(this.sprite),t.isInvalid=!0):t.addChild(this.sprite)):this.textures=[]}var ot=T.BuildingMode={__ename__:"BuildingMode",__constructs__:["Normal","Insert","Replace","Drag","DragReplace","Destroy","DestroyLeavingHole"],Normal:{_hx_index:0,__enum__:"BuildingMode",toString:i},Insert:{_hx_index:1,__enum__:"BuildingMode",toString:i},Replace:{_hx_index:2,__enum__:"BuildingMode",toString:i},Drag:{_hx_index:3,__enum__:"BuildingMode",toString:i},DragReplace:{_hx_index:4,__enum__:"BuildingMode",toString:i},Destroy:{_hx_index:5,__enum__:"BuildingMode",toString:i},DestroyLeavingHole:{_hx_index:6,__enum__:"BuildingMode",toString:i}};(q.BuildingUpgrade=s).__name__="BuildingUpgrade",s.__interfaces__=[n],s.prototype={get_textureName:function(){return""},get_hasChangeableAppearance:function(){return 1<this.textures.length},get_bonusAttractiveness:function(){return 0},get_canCacheSprite:function(){return!0},get_availableTextures:function(){return this.textures.length},set_onUpdate:function(t){return-1==this.building.city.simulation.buildingUpgradesToUpdate.indexOf(this)&&this.building.city.simulation.buildingUpgradesToUpdate.push(this),this.onUpdate=t,this.onUpdate},changeAppearance:function(){this.textures.length<=1||((this.spriteIndex+=1)>=this.get_availableTextures()&&(this.spriteIndex=0),this.sprite.texture=this.textures[this.spriteIndex],this.get_canCacheSprite()&&(this.stage.isInvalid=!0))},reposition:function(){null!=this.stage&&(this.sprite.position.set(this.building.position.x,this.building.position.y),this.get_canCacheSprite()&&(this.stage.isInvalid=!0))},postLoad:function(){null!=this.stage&&(this.sprite.texture=this.textures[this.spriteIndex],this.get_canCacheSprite()&&(this.stage.isInvalid=!0))},destroy:function(){if(this.building.bonusAttractiveness-=this.get_bonusAttractiveness(),null!=this.stage)if(this.get_canCacheSprite()){var t=this.stage,e=this.sprite;at.remove(t.cacheableChildren,e),t.isInvalid=!0,e.destroy({children:!0,texture:!1})}else this.sprite.destroy()},update:function(t){this.onUpdate(t)},save:function(t,e){null==e&&(e=!0),e&&t.addString(s.saveDefinition);var i=this.spriteIndex;if(t.size+4>t.bytes.length){var n=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+4))),t.bytes.blit(0,n,0,t.size)}t.bytes.setInt32(t.size,i),t.size+=4},load:function(t,e){null==e&&(e=t.readString());var i=Dr.makeLoadMap(e,t);Object.prototype.hasOwnProperty.call(i.h,"spriteIndex")&&(this.spriteIndex=i.h.spriteIndex),this.postLoad()},__class__:s};var K=function(t,e,i,n,r,s,o,a,l,h,u){null==h&&(h=0),this.impossibleToReachWorldSurfaceForWorld=null,this.lastMorningCommuteTime=-1,this.dynamicUnsavedVars={},this.likesNightclubs=!1,this.hasDied=!1,this.hobby=null,this.isForcedHome=!1,this.wantsNightEntertainmentIn=0,this.pathStartTime=0,this.pathCanBeReconsidered=!0,this.recyclePathArray=!1,this.pathWalkSpeed=1,this.pathOnlyRelatedTo=null,this.pathEndFunction=null,this.currentPathActionTimerXY=0,this.verticalPathProgress=0,this.delayCanViewSelfInBuilding=!1,this.canViewSelfInBuilding=!0,this.currentPathAction=-2,this.inBuildingSince=0,this.inPermanent=null,this.accessorySprite=null,this.educationLevel=0,this.lastInfrequentUpdateAge=0,this.hasWorkTools=!1,this.currentAction=2,this.hasBuildingInited=!1,this.city=t,this.simulation=e,this.spriteIndexActual=il.getInt(o.length-1),this.nameIndex=il.getInt(1,0==dt.citizenNames.length?8e3:dt.citizenNames.length),dt.citizenNames.length>=this.nameIndex&&"Waldo"==dt.citizenNames[this.nameIndex]&&(this.spriteIndexActual=o.length-1),this.spriteIndex=this.spriteIndexActual+(this.nameIndex<<14),this.onWorld=a,this.relativeX=l,this.relativeY=0,this.foregroundStage=i,this.inBuildingStageNonParticle=r,this.inBuildingStage=n,this.adultTextures=s,this.childrenTextures=o,e.houseAssigner.shouldUpdateHouses=!0,e.schoolAssigner.schoolsShouldBeUpdated=!0,this.bornOn=e.time.timeSinceStart-1440*h,this.lastInfrequentUpdateAge=this.get_age(),this.dieAgeModifier=il.getInt(-5,5),this.setPreferences(),this.addedToStage=null,this.sprite=new PIXI.Sprite,this.setCurrentTexture(),K.spriteCitizens.set(this.sprite,this),this.sprite.anchor.y=1,!g.isLoading&&16<=this.get_age()&&this.addToWorkers(),null!=u?(null!=this.inPermanent&&this.inPermanent.onCitizenLeave(this,u),this.inBuildingSince=this.city.simulation.time.timeSinceStart,this.inPermanent=u,this.hasBuildingInited=!1,this.set_drawOnStage(n),this.canViewSelfInBuilding=!1):this.set_drawOnStage(i),this.entertainment=new ul(this),this.wantsNightEntertainmentIn=il.getInt(5),this.pathWalkSpeed=1,this.inBuildingSince=t.simulation.time.timeSinceStart,this.actuallyUpdateDraw()};(q.Citizen=K).__name__="Citizen",K.prototype={get_stepsInBuilding:function(){return(this.city.simulation.time.timeSinceStart-this.inBuildingSince)/this.city.simulation.time.minutesPerTick},get_worldX:function(){return(null==this.inPermanent?0:20*this.inPermanent.worldPosition.x)+this.relativeX},get_workTimePreference:function(){return this.actualWorkTimePreference*(null==this.job?1:this.job.workTimePreferenceMod)},get_educationSpeedModifier:function(){return 1+this.educationLevel/2},get_age:function(){return(this.simulation.time.timeSinceStart-this.bornOn)/1440},set_drawOnStage:function(t){return this.drawOnStage!=(this.drawOnStage=t)&&(this.sprite.alpha=1),this.drawOnStage},setHobby:function(t){this.hobby=t,this.likesNightclubs=!1},postLoad:function(){var t=this.relativeX;isNaN(t)&&(this.relativeX=0);t=this.dieAgeModifier;isNaN(t)&&(this.dieAgeModifier=0),this.entertainment.setAgeRelatedEntertainment(),null==(null!=this.inPermanent&&this.inPermanent.isBuilding?this.inPermanent:null)||(null!=this.inPermanent&&this.inPermanent.isBuilding?this.inPermanent:null).get_walkThroughCanViewSelfInThisBuilding()||(this.canViewSelfInBuilding=!1),this.actuallyUpdateDraw()},tryRemove:function(t){null==t&&(t=!1),this.fullyBeingControlled||3!=this.currentAction&&(t||this.city.simulation.babyMaker.onCitizenDeath(),at.remove(this.simulation.jobAssigner.citizensWithoutJob,this),null!=this.job&&(at.remove(this.job.workers,this),this.simulation.jobAssigner.buildingsHaveWork=!0),null!=this.home&&(at.remove(this.home.residents,this),this.simulation.houseAssigner.shouldUpdateHouses=!0),null!=this.school&&(at.remove(this.school.students,this),this.simulation.schoolAssigner.schoolsShouldBeUpdated=!0),null!=this.addedToStage&&this.swapRemoveFromStage(),K.spriteCitizens.remove(this.sprite),this.sprite.destroy({children:!0}),at.remove(this.simulation.citizens,this),null!=this.hobby&&this.hobby.onDie(),this.hasDied=!0,this.isForcedHome&&at.remove(this.simulation.houseAssigner.citizensWithFixedHomes,this))},setPreferences:function(){this.actualWorkTimePreference=il.getFloat(-1,1),this.likesNightclubs=this.spriteIndex%5!=0},shouldWorkNow:function(){if(null==this.job)return!1;var t=this.simulation.time.timeSinceStart/60%24,e=this.job.startTime+this.get_workTimePreference(),i=(this.job.endTime+this.get_workTimePreference()+this.city.policies.vars.workTimeChange)%24;return e<i?e<=t&&t<i:e<=t||t<i},shouldSchoolNow:function(){if(null==this.school)return!1;var t=this.simulation.time.timeSinceStart/60%24,e=this.school.schoolStartTime,i=this.school.schoolEndTime;return e<i?e<=t&&t<i:e<=t||t<i},updateDailyLife:function(t){var e=this.simulation.time.timeSinceStart/60%24;if(0==this.currentAction){var i=this.job,n=this.job.startTime+this.get_workTimePreference(),r=this.job.endTime+this.get_workTimePreference()+this.city.policies.vars.workTimeChange;i.work(this,t,!(n<r?n<=e&&e<r:n<=e||e<r))}else if(1==this.currentAction){((n=this.school.schoolStartTime)<(r=this.school.schoolEndTime)?n<=e&&e<r:n<=e||e<r)?this.school.beAtSchool(this,t):this.currentAction=2}else if(null!=this.hobby&&this.hobby.isActive())this.hobby.update(t);else if(3!=this.currentAction)if(this.shouldWorkNow())if(this.inPermanent==this.job)this.currentAction=0;else{if(this.simulation.pathfinder.mayRequestPathNow(this.inPermanent))i=null==(s=this.entertainment).citizen.inPermanent||!s.citizen.inPermanent.isBuilding||!s.citizen.inPermanent.isEntertainment||s.citizen.inPermanent.finishEntertainment(s.citizen,t);else i=!1;i&&this.simulation.pathfinder.findPathCombined(this,this.job.get_firstBuildingToGoTo())}else if(this.shouldSchoolNow())if(this.inPermanent==this.school)this.currentAction=1;else{var s;if(this.simulation.pathfinder.mayRequestPathNow(this.inPermanent))i=null==(s=this.entertainment).citizen.inPermanent||!s.citizen.inPermanent.isBuilding||!s.citizen.inPermanent.isEntertainment||s.citizen.inPermanent.finishEntertainment(s.citizen,t);else i=!1;i&&(0==this.school.workers.length?this.leaveSchool():this.simulation.pathfinder.findPathCombined(this,this.school))}else{if(!this.entertainment.updateEntertainment(t)){if(null!=this.home)if(null==this.job)i=!((n=8+this.get_workTimePreference())<(r=21+this.get_workTimePreference())?n<=e&&e<r:n<=e||e<r);else i=!0;else i=!1;if(i)if(this.inPermanent!=this.home)this.simulation.pathfinder.mayRequestPathNow(this.inPermanent)&&this.simulation.pathfinder.findPathCombined(this,this.home);else{var o,a;a=null==this.job?(o=8,21):(o=this.job.startTime,this.job.endTime);var l=this.simulation.time.timeSinceStart/60%24,h=o;h+=this.get_workTimePreference()-1;n=h%=24,h=a;h+=this.get_workTimePreference()+1,(n<(r=h%=24)?n<=l&&l<r:n<=l||l<r)||this.get_stepsInBuilding()<240?(this.canViewSelfInBuilding=!0,this.home.walkAround(this,this.get_stepsInBuilding())):this.canViewSelfInBuilding=!1}else this.wander(t)}}},stopWork:function(){this.currentAction=2},tryFinishWork:function(t){return 0==this.currentAction&&this.job.work(this,t,!0),0!=this.currentAction},evictFromHome:function(){null!=this.home&&(at.remove(this.home.residents,this),this.home=null,this.simulation.houseAssigner.shouldUpdateHouses=!0)},leaveSchool:function(){null!=this.school&&(at.remove(this.school.students,this),this.school=null,this.simulation.schoolAssigner.schoolsShouldBeUpdated=!0,1==this.currentAction&&(this.currentAction=2))},loseJob:function(t){null==t&&(t=!1),null!=this.job&&(at.remove(this.job.workers,this),this.job=null,t||(this.simulation.jobAssigner.buildingsHaveWork=!0,this.simulation.jobAssigner.citizensWithoutJob.push(this)),this.hasWorkTools=!1,0==this.currentAction&&(this.currentAction=2))},infrequentUpdate:function(){this.setCurrentTexture(),this.lastInfrequentUpdateAge<16&&16<=this.get_age()&&(null==this.job?this.addToWorkers():null!=this.school&&this.leaveSchool()),this.lastInfrequentUpdateAge=this.get_age(),this.get_age()>=75+this.dieAgeModifier&&!this.city.progress.story.disableDying&&this.tryRemove();for(var t=!0,e=0,i=this.city.simulation.festivalManager.festivals;e<i.length;){var n=i[e];++e,n.isInvolvedWithFestival(this)&&(t=!1)}if(null!=this.path&&this.pathCanBeReconsidered&&t){var r=0!=this.currentAction&&this.shouldWorkNow(),s=1!=this.currentAction&&this.shouldSchoolNow();if((r&&this.pathDestination!=this.job||s&&this.pathDestination!=this.school)&&(null==this.pathDestination||!this.pathDestination.is(Hi))){var o=!1;null==o&&(o=!0),this.recyclePathArray&&(ka.returnToPool(this.path),this.recyclePathArray=!1),this.path=null,this.nextPathPos=-1,this.pathEnd=-1,this.currentPathAction=-2,o&&(this.canViewSelfInBuilding||(this.delayCanViewSelfInBuilding=!0),this.canViewSelfInBuilding=!0),this.verticalPathProgress=0,this.pathEndFunction=null,this.requestingPathGoal=null,this.pathOnlyRelatedTo=null,this.pathWalkSpeed=1,this.pathCanBeReconsidered=!0,0<this.sprite.alpha&&this.sprite.alpha<1&&(this.sprite.alpha=1)}}},addToWorkers:function(){this.simulation.jobAssigner.citizensWithoutJob.push(this),this.simulation.jobAssigner.buildingsHaveWork=!0,null!=this.school&&this.leaveSchool()},midDayUpdate:function(){0<this.wantsNightEntertainmentIn&&this.wantsNightEntertainmentIn--,this.dieAgeModifier+=this.simulation.happiness.medicalHappiness/100*.2+this.simulation.happiness.specializedMedicalHappiness/100*.05,this.city.simulation.happiness.happiness<10&&null==this.home&&this.city.materials.food<1&&(null==this.job&&(this.dieAgeModifier-=10),this.dieAgeModifier-=1),null!=this.home&&(this.dieAgeModifier+=this.home.yearsToLiveLongerPerYearIfLivingHere),this.dieAgeModifier+=this.city.upgrades.vars.extendAgeBy,this.impossibleToReachWorldSurfaceForWorld=null},updatePath:function(t){var e=this;if(-1<=this.currentPathAction){if(-1==this.currentPathAction){for(;12==this.path[this.nextPathPos];)this.pathWalkSpeed=1*this.path[this.nextPathPos+1]/100,this.nextPathPos+=2;this.currentPathAction=this.path[this.nextPathPos],0==this.currentPathAction||1==this.currentPathAction||9==this.currentPathAction?(this.canViewSelfInBuilding=!1,K.shouldUpdateDraw=!0):null==this.pathOnlyRelatedTo&&4!=this.currentPathAction&&8!=this.currentPathAction&&(this.canViewSelfInBuilding=null==(null!=this.inPermanent&&this.inPermanent.isBuilding?this.inPermanent:null)||this.inPermanent.get_walkThroughCanViewSelfInThisBuilding(),K.shouldUpdateDraw=!0),this.currentPathAction<=1&&0<this.relativeY?(this.verticalPathProgress=this.relativeY*(this.currentPathAction-.5)*-2,this.relativeY=0):4!=this.currentPathAction&&8!=this.currentPathAction&&9!=this.currentPathAction&&(this.relativeY=0),this.currentPathActionTimerXY=0,5==this.currentPathAction||7==this.currentPathAction||11==this.currentPathAction||13<=this.currentPathAction&&this.currentPathAction<=16?this.currentPathActionPermanent=this.city.findPermanentByID(this.path[this.nextPathPos+1]):4!=this.currentPathAction&&9!=this.currentPathAction&&8!=this.currentPathAction||(this.currentPathActionTimerXY=this.path[this.nextPathPos+1])}var i=!1;switch(this.currentPathAction){case 0:if(this.verticalPathProgress+=t,20<=this.verticalPathProgress){var n=(null!=this.inPermanent&&this.inPermanent.isBuilding?this.inPermanent:null).topBuilding;null!=this.inPermanent&&this.inPermanent.onCitizenLeave(this,n),this.inBuildingSince=this.city.simulation.time.timeSinceStart,this.inPermanent=n,this.hasBuildingInited=!1,this.verticalPathProgress-=20,i=!0}break;case 1:if(this.verticalPathProgress+=t,20<=this.verticalPathProgress){n=(null!=this.inPermanent&&this.inPermanent.isBuilding?this.inPermanent:null).bottomBuilding;null!=this.inPermanent&&this.inPermanent.onCitizenLeave(this,n),this.inBuildingSince=this.city.simulation.time.timeSinceStart,this.inPermanent=n,this.hasBuildingInited=!1,this.verticalPathProgress-=20,i=!0}break;case 2:if(this.relativeX-=t*this.pathWalkSpeed,this.relativeX<-2){n=(null!=this.inPermanent&&this.inPermanent.isBuilding?this.inPermanent:null).leftBuilding;null!=this.inPermanent&&this.inPermanent.onCitizenLeave(this,n),this.inBuildingSince=this.city.simulation.time.timeSinceStart,this.inPermanent=n,this.hasBuildingInited=!1,this.onWorld=this.inPermanent.world,this.relativeX+=20,i=!0}else K.shouldUpdateDraw=!0;break;case 3:if(this.relativeX+=t*this.pathWalkSpeed,20<this.relativeX){n=(null!=this.inPermanent&&this.inPermanent.isBuilding?this.inPermanent:null).rightBuilding;null!=this.inPermanent&&this.inPermanent.onCitizenLeave(this,n),this.inBuildingSince=this.city.simulation.time.timeSinceStart,this.inPermanent=n,this.hasBuildingInited=!1,this.onWorld=this.inPermanent.world,this.relativeX-=20,i=!0}else K.shouldUpdateDraw=!0;break;case 4:var r=this.currentPathActionTimerXY,s=this.pathWalkSpeed*t;if(K.shouldUpdateDraw=!0,Math.abs(r-this.relativeX)<s)this.relativeX=r,i=!0;else{var o=r-this.relativeX;this.relativeX+=(0<o?1:o<0?-1:0)*s,i=!1}break;case 5:if(null!=this.inPermanent)if(null!=this.inPermanent&&this.inPermanent.isBuilding){r=(null!=this.inPermanent&&this.inPermanent.isBuilding?this.inPermanent:null).doorX,s=this.pathWalkSpeed*t;if(K.shouldUpdateDraw=!0,Math.abs(r-this.relativeX)<s)this.relativeX=r,g=!0;else{o=r-this.relativeX;this.relativeX+=(0<o?1:o<0?-1:0)*s,g=!1}if(g){if(null!=this.inPermanent&&this.inPermanent.isBuilding){var a=null!=this.inPermanent&&this.inPermanent.isBuilding?this.inPermanent:null;this.relativeX=20*a.worldPosition.x+a.doorX}else this.relativeX+=20*this.inPermanent.worldPosition.x;null!=this.inPermanent&&this.inPermanent.onCitizenLeave(this,null),this.inBuildingSince=this.city.simulation.time.timeSinceStart,this.set_drawOnStage(this.foregroundStage),this.inPermanent=null,this.relativeY=0,K.shouldUpdateDraw=!0}}else{if(null!=this.inPermanent&&this.inPermanent.isBuilding){a=null!=this.inPermanent&&this.inPermanent.isBuilding?this.inPermanent:null;this.relativeX=20*a.worldPosition.x+a.doorX}else this.relativeX+=20*this.inPermanent.worldPosition.x;null!=this.inPermanent&&this.inPermanent.onCitizenLeave(this,null),this.inBuildingSince=this.city.simulation.time.timeSinceStart,this.set_drawOnStage(this.foregroundStage),this.inPermanent=null,this.relativeY=0,K.shouldUpdateDraw=!0}else if(this.currentPathActionPermanent.isBuilding){var l=this.currentPathActionPermanent;r=20*l.worldPosition.x+l.doorX,s=this.pathWalkSpeed*t;if(K.shouldUpdateDraw=!0,Math.abs(r-this.relativeX)<s)this.relativeX=r,i=!0;else{o=r-this.relativeX;this.relativeX+=(0<o?1:o<0?-1:0)*s,i=!1}if(i){n=this.currentPathActionPermanent;null!=this.inPermanent&&this.inPermanent.onCitizenLeave(this,n),this.inBuildingSince=this.city.simulation.time.timeSinceStart,this.inPermanent=n,this.hasBuildingInited=!1,this.set_drawOnStage(this.inBuildingStage),this.relativeX=l.doorX}}else{var h=20*this.currentPathActionPermanent.worldPosition.x;o=10+h-this.relativeX;if(this.relativeX+=(0<o?1:o<0?-1:0)*(t*this.pathWalkSpeed),this.relativeX>h&&this.relativeX<20+h-2){n=this.currentPathActionPermanent;null!=this.inPermanent&&this.inPermanent.onCitizenLeave(this,n),this.inBuildingSince=this.city.simulation.time.timeSinceStart,this.inPermanent=n,this.hasBuildingInited=!1,this.relativeX-=20*this.inPermanent.worldPosition.x,i=!0}}K.shouldUpdateDraw=!0;break;case 7:if(0<this.currentPathActionTimerXY)if(this.currentPathActionTimerXY+=.1*t,1<=this.currentPathActionTimerXY)if(this.sprite.alpha=1,this.inPermanent.is(Ci))null==(v=!0)&&(v=!0),this.recyclePathArray&&(ka.returnToPool(this.path),this.recyclePathArray=!1),this.path=null,this.nextPathPos=-1,this.pathEnd=-1,this.currentPathAction=-2,v&&(this.canViewSelfInBuilding||(this.delayCanViewSelfInBuilding=!0),this.canViewSelfInBuilding=!0),this.verticalPathProgress=0,this.pathEndFunction=null,this.requestingPathGoal=null,this.pathOnlyRelatedTo=null,this.pathWalkSpeed=1,this.pathCanBeReconsidered=!0,0<this.sprite.alpha&&this.sprite.alpha<1&&(this.sprite.alpha=1),this.waitAndMoveAndWaitRandom(30,45,3,16,120,180,null,!1,!0),this.pathCanBeReconsidered=!1,this.inPermanent.giveReward();else i=!0;else this.sprite.alpha=this.currentPathActionTimerXY;else if(this.city.simulation.operatingCost.teleportersEnabled){r=this.inPermanent.teleportX,s=this.pathWalkSpeed*t;if(K.shouldUpdateDraw=!0,Math.abs(r-this.relativeX)<s)this.relativeX=r,g=!0;else{o=r-this.relativeX;this.relativeX+=(0<o?1:o<0?-1:0)*s,g=!1}if(g){this.inPermanent.createTeleportParticle(),this.inPermanent.timesUsed+=1,null!=this.city.misdirector&&0<this.city.misdirector.get_misdirectChance()&&il.getFloat()<this.city.misdirector.get_misdirectChance()&&(this.currentPathActionPermanent=this.city.misdirector);n=this.currentPathActionPermanent;null!=this.inPermanent&&this.inPermanent.onCitizenLeave(this,n),this.inBuildingSince=this.city.simulation.time.timeSinceStart,this.inPermanent=n,this.hasBuildingInited=!1,this.inPermanent.timesUsedTo+=1,this.onWorld=this.currentPathActionPermanent.world,this.relativeX=this.inPermanent.teleportX,this.currentPathActionTimerXY=.1*t,this.sprite.alpha=this.currentPathActionTimerXY}}else{null==(v=!0)&&(v=!0),this.recyclePathArray&&(ka.returnToPool(this.path),this.recyclePathArray=!1),this.path=null,this.nextPathPos=-1,this.pathEnd=-1,this.currentPathAction=-2,v&&(this.canViewSelfInBuilding||(this.delayCanViewSelfInBuilding=!0),this.canViewSelfInBuilding=!0),this.verticalPathProgress=0,this.pathEndFunction=null,this.requestingPathGoal=null,this.pathOnlyRelatedTo=null,this.pathWalkSpeed=1,this.pathCanBeReconsidered=!0,0<this.sprite.alpha&&this.sprite.alpha<1&&(this.sprite.alpha=1)}K.shouldUpdateDraw=!0;break;case 8:this.currentPathActionTimerXY-=t,i=this.currentPathActionTimerXY<=.5*(t-.6666666666666666);break;case 9:s=t;if(Math.abs(this.currentPathActionTimerXY-this.relativeY)<s)this.relativeY=this.currentPathActionTimerXY,i=!0;else{o=this.currentPathActionTimerXY-this.relativeY;this.relativeY+=(0<o?1:o<0?-1:0)*s}K.shouldUpdateDraw=!0;break;case 10:i=!0;break;case 11:if(this.inPermanent==this.currentPathActionPermanent)i=!0;else{var u=this.inPermanent,c=this.currentPathActionPermanent;if(null!=u.currentlyLandedSaucer&&(u.currentlyLandedSaucer.destination==c||u.currentlyLandedSaucer.destination.estimatedFlyingDistanceTo(c)<u.estimatedFlyingDistanceTo(c))){if((p=u.currentlyLandedSaucer).addPassenger(this),this.fullyBeingControlled=!0,this.canViewSelfInBuilding=!1,this.inTransportationThing=p,u.currentlyLandedSaucer.destination!=c)if(u.estimatedFlyingDistanceTo(c)<u.estimatedFlyingDistanceTo(u.currentlyLandedSaucer.destination))null!=(d=this.simulation.flyingPathfinder.findRoute(u,c))&&p.setDestination(c,d)}else if(u.hasFlyingSaucer){var d;if(null==(d=this.simulation.flyingPathfinder.findRoute(u,c)))return this.recyclePathArray&&(ka.returnToPool(this.path),this.recyclePathArray=!1),this.path=null,this.nextPathPos=-1,this.pathEnd=-1,this.currentPathAction=-2,this.canViewSelfInBuilding||(this.delayCanViewSelfInBuilding=!0),this.canViewSelfInBuilding=!0,this.verticalPathProgress=0,this.pathEndFunction=null,this.requestingPathGoal=null,this.pathOnlyRelatedTo=null,this.pathWalkSpeed=1,this.pathCanBeReconsidered=!0,void(0<this.sprite.alpha&&this.sprite.alpha<1&&(this.sprite.alpha=1));var p=new vl(this.simulation,this.city.aboveCitizensInBuildingStage,d,u,this.currentPathActionPermanent);this.simulation.flyingSaucers.push(p),p.addPassenger(this),this.fullyBeingControlled=!0,this.canViewSelfInBuilding=!1,this.inTransportationThing=p,this.inPermanent.removeFlyingSaucer();this.relativeX=il.getInt(7,14)}else this.relativeY=-1}K.shouldUpdateDraw=!0;break;case 12:break;case 13:var f=20*(this.currentPathActionPermanent.worldPosition.y-this.inPermanent.worldPosition.y);if(this.inPermanent==this.currentPathActionPermanent)if(3<this.currentPathActionTimerXY)if(this.nextPathPos+2<this.pathEnd)if(0==this.path[this.nextPathPos+2]||1==this.path[this.nextPathPos+2]){r=10<this.relativeX?18:0,s=this.pathWalkSpeed*t;if(K.shouldUpdateDraw=!0,Math.abs(r-this.relativeX)<s)this.relativeX=r,g=!0;else{o=r-this.relativeX;this.relativeX+=(0<o?1:o<0?-1:0)*s,g=!1}g&&(i=!0)}else i=!0;else i=!0;else this.currentPathActionTimerXY+=t;else if(0<this.currentPathActionTimerXY){if(Math.abs(this.verticalPathProgress)<Math.abs(f)&&(this.verticalPathProgress+=20*t*(0<f?1:f<0?-1:0),this.canViewSelfInBuilding=!1),Math.abs(this.verticalPathProgress)>=Math.abs(f)&&this.currentPathActionPermanent.openDoor()){n=this.currentPathActionPermanent;null!=this.inPermanent&&this.inPermanent.onCitizenLeave(this,n),this.inBuildingSince=this.city.simulation.time.timeSinceStart,this.inPermanent=n,this.hasBuildingInited=!1,this.inPermanent.timesUsedTo+=1,this.verticalPathProgress=0,this.canViewSelfInBuilding=!0,this.relativeX+=il.getInt(-2,3)}}else{this.canViewSelfInBuilding=!0;var g;s=this.pathWalkSpeed*t;if(K.shouldUpdateDraw=!0,Math.abs(9-this.relativeX)<s)this.relativeX=9,g=!0;else{o=9-this.relativeX;this.relativeX+=(0<o?1:o<0?-1:0)*s,g=!1}g&&this.inPermanent.openDoor()&&(this.inPermanent.timesUsed+=1,this.currentPathActionTimerXY=1,this.canViewSelfInBuilding=!1)}K.shouldUpdateDraw=!0;break;case 14:break;case 15:var m=this.currentPathActionPermanent.position.x-this.inPermanent.position.x;this.relativeX-=t*this.pathWalkSpeed;var y=-Math.abs((m+20)/-2+this.relativeX)-m/2-10;if(this.relativeY=y<0?0:5<y?5:y,this.relativeX<0&&(this.canViewSelfInBuilding=!0),this.relativeX<m+20-2){n=this.currentPathActionPermanent;null!=this.inPermanent&&this.inPermanent.onCitizenLeave(this,n),this.inBuildingSince=this.city.simulation.time.timeSinceStart,this.inPermanent=n,this.hasBuildingInited=!1,this.onWorld=this.inPermanent.world,this.relativeX-=m,i=!0}else K.shouldUpdateDraw=!0;break;case 16:m=this.currentPathActionPermanent.position.x-this.inPermanent.position.x;this.relativeX+=t*this.pathWalkSpeed;y=-Math.abs((m-20)/2-(this.relativeX-20))+m/2-10;if(this.relativeY=y<0?0:5<y?5:y,20<this.relativeX&&(this.canViewSelfInBuilding=!0),this.relativeX>m){n=this.currentPathActionPermanent;null!=this.inPermanent&&this.inPermanent.onCitizenLeave(this,n),this.inBuildingSince=this.city.simulation.time.timeSinceStart,this.inPermanent=n,this.hasBuildingInited=!1,this.onWorld=this.inPermanent.world,this.relativeX-=m,i=!0}else K.shouldUpdateDraw=!0}if(i){if(this.nextPathPos+2>=this.pathEnd){var _=e.pathEndFunction;null==(v=!0)&&(v=!0),e.recyclePathArray&&(ka.returnToPool(e.path),e.recyclePathArray=!1),e.path=null,e.nextPathPos=-1,e.pathEnd=-1,e.currentPathAction=-2,v&&(e.canViewSelfInBuilding||(e.delayCanViewSelfInBuilding=!0),e.canViewSelfInBuilding=!0),e.verticalPathProgress=0,e.pathEndFunction=null,e.requestingPathGoal=null,e.pathOnlyRelatedTo=null,e.pathWalkSpeed=1,e.pathCanBeReconsidered=!0,0<e.sprite.alpha&&e.sprite.alpha<1&&(e.sprite.alpha=1),null!=_&&_(),null!=e.inPermanent&&e.inPermanent==e.job&&0!=e.currentAction&&e.shouldWorkNow()&&(e.lastMorningCommuteTime=e.city.simulation.time.timeSinceStart-e.pathStartTime)}else{if(this.nextPathPos+=2,this.currentPathAction=-1,13==this.path[this.nextPathPos])for(;this.nextPathPos+2<this.pathEnd&&13==this.path[this.nextPathPos+2];)this.nextPathPos+=2;if(14==this.path[this.nextPathPos])for(;this.nextPathPos+2<this.pathEnd&&14==this.path[this.nextPathPos+2];)this.nextPathPos+=2;if(10==this.path[this.nextPathPos])if(this.nextPathPos+2>=this.pathEnd){var v;_=e.pathEndFunction;null==(v=!0)&&(v=!0),e.recyclePathArray&&(ka.returnToPool(e.path),e.recyclePathArray=!1),e.path=null,e.nextPathPos=-1,e.pathEnd=-1,e.currentPathAction=-2,v&&(e.canViewSelfInBuilding||(e.delayCanViewSelfInBuilding=!0),e.canViewSelfInBuilding=!0),e.verticalPathProgress=0,e.pathEndFunction=null,e.requestingPathGoal=null,e.pathOnlyRelatedTo=null,e.pathWalkSpeed=1,e.pathCanBeReconsidered=!0,0<e.sprite.alpha&&e.sprite.alpha<1&&(e.sprite.alpha=1),null!=_&&_(),null!=e.inPermanent&&e.inPermanent==e.job&&0!=e.currentAction&&e.shouldWorkNow()&&(e.lastMorningCommuteTime=e.city.simulation.time.timeSinceStart-e.pathStartTime)}else this.canViewSelfInBuilding=!0,this.nextPathPos+=2}K.shouldUpdateDraw=!0}}},leavePermanent:function(t){if(null!=this.inPermanent&&this.inPermanent.isBuilding){var e,i=(null!=this.inPermanent&&this.inPermanent.isBuilding?this.inPermanent:null).doorX,n=this.pathWalkSpeed*t;if(K.shouldUpdateDraw=!0,Math.abs(i-this.relativeX)<n)this.relativeX=i,e=!0;else{var r=i-this.relativeX;this.relativeX+=(0<r?1:r<0?-1:0)*n,e=!1}if(e){if(null!=this.inPermanent&&this.inPermanent.isBuilding){var s=null!=this.inPermanent&&this.inPermanent.isBuilding?this.inPermanent:null;this.relativeX=20*s.worldPosition.x+s.doorX}else this.relativeX+=20*this.inPermanent.worldPosition.x;null!=this.inPermanent&&this.inPermanent.onCitizenLeave(this,null),this.inBuildingSince=this.city.simulation.time.timeSinceStart,this.set_drawOnStage(this.foregroundStage),this.inPermanent=null,this.relativeY=0,K.shouldUpdateDraw=!0}}else{if(null!=this.inPermanent&&this.inPermanent.isBuilding){s=null!=this.inPermanent&&this.inPermanent.isBuilding?this.inPermanent:null;this.relativeX=20*s.worldPosition.x+s.doorX}else this.relativeX+=20*this.inPermanent.worldPosition.x;null!=this.inPermanent&&this.inPermanent.onCitizenLeave(this,null),this.inBuildingSince=this.city.simulation.time.timeSinceStart,this.set_drawOnStage(this.foregroundStage),this.inPermanent=null,this.relativeY=0,K.shouldUpdateDraw=!0}},instantLeavePermanent:function(){if(null!=this.inPermanent&&this.inPermanent.isBuilding){var t=null!=this.inPermanent&&this.inPermanent.isBuilding?this.inPermanent:null;this.relativeX=20*t.worldPosition.x+t.doorX}else this.relativeX+=20*this.inPermanent.worldPosition.x;null!=this.inPermanent&&this.inPermanent.onCitizenLeave(this,null),this.inBuildingSince=this.city.simulation.time.timeSinceStart,this.set_drawOnStage(this.foregroundStage),this.inPermanent=null,this.relativeY=0,K.shouldUpdateDraw=!0},moveTowardsX:function(t,e){var i=this.pathWalkSpeed*e;if(K.shouldUpdateDraw=!0,Math.abs(t-this.relativeX)<i)return this.relativeX=t,!0;var n=t-this.relativeX;return this.relativeX+=(0<n?1:n<0?-1:0)*i,!1},setRelativePos:function(t,e){t==this.relativeX&&e==this.relativeY||(this.relativeX=t,this.relativeY=e,K.shouldUpdateDraw=!0)},setRelativeY:function(t){this.relativeY=t,K.shouldUpdateDraw=!0},setRelativeX:function(t){this.relativeX=t,K.shouldUpdateDraw=!0},wait:function(t,e){var i=ka.pool,n=0<i[2].length?i[2].splice(i[2].length-1,1)[0]:new Int32Array(2);n[0]=8,n[1]=t,this.setPath(n,0,2,!0),this.pathEndFunction=e,this.pathOnlyRelatedTo=this.inPermanent},waitRandom:function(t,e,i){var n=ka.pool,r=0<n[2].length?n[2].splice(n[2].length-1,1)[0]:new Int32Array(2);r[0]=8,r[1]=il.getInt(t,e),this.setPath(r,0,2,!0),this.pathEndFunction=i,this.pathOnlyRelatedTo=this.inPermanent},wander:function(t){if(null==this.inPermanent){var e=(0|this.relativeX)-100,i=100+(0|this.relativeX),n=this.onWorld.rect.width-2;this.moveAndWait(il.getInt(0<e?e:0,n<i?n:i),il.getInt(30,60),null,!1,!1)}else this.goDownTowardsWorldSurface(t)},goDownTowardsWorldSurface:function(t){if(0==this.inPermanent.worldPosition.y&&null!=this.inPermanent.world&&0<this.inPermanent.world.rect.height){if(null!=this.inPermanent&&this.inPermanent.isBuilding){var e,i=(null!=this.inPermanent&&this.inPermanent.isBuilding?this.inPermanent:null).doorX,n=this.pathWalkSpeed*t;if(K.shouldUpdateDraw=!0,Math.abs(i-this.relativeX)<n)this.relativeX=i,e=!0;else{var r=i-this.relativeX;this.relativeX+=(0<r?1:r<0?-1:0)*n,e=!1}if(e){if(null!=this.inPermanent&&this.inPermanent.isBuilding){var s=null!=this.inPermanent&&this.inPermanent.isBuilding?this.inPermanent:null;this.relativeX=20*s.worldPosition.x+s.doorX}else this.relativeX+=20*this.inPermanent.worldPosition.x;null!=this.inPermanent&&this.inPermanent.onCitizenLeave(this,null),this.inBuildingSince=this.city.simulation.time.timeSinceStart,this.set_drawOnStage(this.foregroundStage),this.inPermanent=null,this.relativeY=0,K.shouldUpdateDraw=!0}}else{if(null!=this.inPermanent&&this.inPermanent.isBuilding){s=null!=this.inPermanent&&this.inPermanent.isBuilding?this.inPermanent:null;this.relativeX=20*s.worldPosition.x+s.doorX}else this.relativeX+=20*this.inPermanent.worldPosition.x;null!=this.inPermanent&&this.inPermanent.onCitizenLeave(this,null),this.inBuildingSince=this.city.simulation.time.timeSinceStart,this.set_drawOnStage(this.foregroundStage),this.inPermanent=null,this.relativeY=0,K.shouldUpdateDraw=!0}this.impossibleToReachWorldSurfaceForWorld=null}else{if(this.impossibleToReachWorldSurfaceForWorld==this.onWorld)return;for(var o=null!=this.inPermanent&&this.inPermanent.isBuilding?this.inPermanent:null,a=[];0!=o.worldPosition.y;){if(null==o.bottomBuilding)null!=o.leftBuilding?(a.push(2),a.push(0),o=o.leftBuilding):null!=o.rightBuilding&&(a.push(3),a.push(0),o=o.rightBuilding);if(null==o.bottomBuilding){a=[],this.impossibleToReachWorldSurfaceForWorld=this.onWorld;break}a.push(1),a.push(0),o=o.bottomBuilding}0<a.length&&this.setPath(new Int32Array(a),0,a.length)}},move:function(t,e,i){var n,r;(null==i&&(i=!1),i)?((r=0<(n=ka.pool)[4].length?n[4].splice(n[4].length-1,1)[0]:new Int32Array(4))[0]=12,r[1]=50,r[2]=4,r[3]=t,this.setPath(r,0,4,!0)):((r=0<(n=ka.pool)[2].length?n[2].splice(n[2].length-1,1)[0]:new Int32Array(2))[0]=4,r[1]=t,this.setPath(r,0,2,!0));this.pathEndFunction=e,this.pathOnlyRelatedTo=this.inPermanent},moveRandom:function(t,e,i,n){null==n&&(n=!1);var r,s,o=il.getInt(t,e);n?((s=0<(r=ka.pool)[4].length?r[4].splice(r[4].length-1,1)[0]:new Int32Array(4))[0]=12,s[1]=50,s[2]=4,s[3]=o,this.setPath(s,0,4,!0)):((s=0<(r=ka.pool)[2].length?r[2].splice(r[2].length-1,1)[0]:new Int32Array(2))[0]=4,s[1]=o,this.setPath(s,0,2,!0));this.pathEndFunction=i,this.pathOnlyRelatedTo=this.inPermanent},moveTowardsRandomInWorldCoords:function(t,e,i){var n=il.getInt(t,e);if(null!=this.inPermanent){var r=n-this.relativeX-this.inPermanent.position.x;if(r<-this.relativeX)if(null!=(null!=this.inPermanent&&this.inPermanent.isBuilding?this.inPermanent:null).leftBuilding)(a=0<(o=ka.pool)[4].length?o[4].splice(o[4].length-1,1)[0]:new Int32Array(4))[0]=2,a[1]=0,a[2]=4,a[3]=18,this.setPath(a,0,4,!0);else(a=0<(o=ka.pool)[2].length?o[2].splice(o[2].length-1,1)[0]:new Int32Array(2))[0]=4,a[1]=0,this.setPath(a,0,2,!0),this.pathEndFunction=null,this.pathOnlyRelatedTo=this.inPermanent;else if(r>=20-this.relativeX){if(null!=(null!=this.inPermanent&&this.inPermanent.isBuilding?this.inPermanent:null).rightBuilding)(a=0<(o=ka.pool)[4].length?o[4].splice(o[4].length-1,1)[0]:new Int32Array(4))[0]=3,a[1]=0,a[2]=4,a[3]=0,this.setPath(a,0,4,!0);else(a=0<(o=ka.pool)[2].length?o[2].splice(o[2].length-1,1)[0]:new Int32Array(2))[0]=4,a[1]=18,this.setPath(a,0,2,!0),this.pathEndFunction=null,this.pathOnlyRelatedTo=this.inPermanent}else{var s=Math.floor(r+this.relativeX);(a=0<(o=ka.pool)[2].length?o[2].splice(o[2].length-1,1)[0]:new Int32Array(2))[0]=4,a[1]=s,this.setPath(a,0,2,!0),this.pathEndFunction=null,this.pathOnlyRelatedTo=this.inPermanent}this.pathEndFunction=i}else{var o,a;n=il.getInt(t-this.onWorld.rect.x,e-this.onWorld.rect.x);(a=0<(o=ka.pool)[2].length?o[2].splice(o[2].length-1,1)[0]:new Int32Array(2))[0]=4,a[1]=n,this.setPath(a,0,2,!0),this.pathEndFunction=i,this.pathOnlyRelatedTo=this.inPermanent}},moveAndWaitRandom:function(t,e,i,n,r,s,o){null==o&&(o=!1),null==s&&(s=!1),this.moveAndWait(il.getInt(t,e),il.getInt(i,n),r,s,o)},moveAndWait:function(t,e,i,n,r){var s,o;(null==r&&(r=!1),null==n&&(n=!1),n&&(e=e/this.simulation.happiness.actionSpeedModifier|0),r)?((o=0<(s=ka.pool)[6].length?s[6].splice(s[6].length-1,1)[0]:new Int32Array(6))[0]=12,o[1]=50,o[2]=4,o[3]=t,o[4]=8,o[5]=e,this.setPath(o,0,6,!0)):((o=0<(s=ka.pool)[4].length?s[4].splice(s[4].length-1,1)[0]:new Int32Array(4))[0]=4,o[1]=t,o[2]=8,o[3]=e,this.setPath(o,0,4,!0));this.pathEndFunction=i,this.pathOnlyRelatedTo=this.inPermanent},waitAndMoveAndWaitRandom:function(t,e,i,n,r,s,o,a,l){null==l&&(l=!1),null==a&&(a=!1);var h,u,c=il.getInt(t,e),d=il.getInt(r,s),p=il.getInt(i,n);(a&&(c=c/this.simulation.happiness.actionSpeedModifier|0,d=d/this.simulation.happiness.actionSpeedModifier|0),l)?((u=0<(h=ka.pool)[8].length?h[8].splice(h[8].length-1,1)[0]:new Int32Array(8))[0]=8,u[1]=c,u[2]=12,u[3]=50,u[4]=4,u[5]=p,u[6]=8,u[7]=d,this.setPath(u,0,8,!0)):((u=0<(h=ka.pool)[6].length?h[6].splice(h[6].length-1,1)[0]:new Int32Array(6))[0]=8,u[1]=c,u[2]=4,u[3]=p,u[4]=8,u[5]=d,this.setPath(u,0,6,!0));this.pathEndFunction=o,this.pathOnlyRelatedTo=this.inPermanent},changeFloorAndMoveRandom:function(t,e,i){var n=this.isAtGroundLevel()?10:0,r=ka.pool,s=0<r[4].length?r[4].splice(r[4].length-1,1)[0]:new Int32Array(4);s[0]=9,s[1]=n,s[2]=4,s[3]=il.getInt(t,e),this.setPath(s,0,4,!0),this.pathEndFunction=i,this.pathOnlyRelatedTo=this.inPermanent},isAtGroundLevel:function(){return this.relativeY<5},isAtBottomFloor:function(){return this.relativeY<5},changeFloor:function(t){var e=this.isAtGroundLevel()?10:0,i=ka.pool,n=0<i[2].length?i[2].splice(i[2].length-1,1)[0]:new Int32Array(2);n[0]=9,n[1]=e,this.setPath(n,0,2,!0),this.pathEndFunction=t,this.pathOnlyRelatedTo=this.inPermanent},changeFloorAndWait:function(t,e){var i=0==this.relativeY?10:0,n=ka.pool,r=0<n[4].length?n[4].splice(n[4].length-1,1)[0]:new Int32Array(4);r[0]=9,r[1]=i,r[2]=8,r[3]=t,this.setPath(r,0,4,!0),this.pathEndFunction=e,this.pathOnlyRelatedTo=this.inPermanent},changeFloorAndWaitRandom:function(t,e,i){var n=0==this.relativeY?10:0,r=ka.pool,s=0<r[4].length?r[4].splice(r[4].length-1,1)[0]:new Int32Array(4);s[0]=9,s[1]=n,s[2]=8,s[3]=il.getInt(t,e),this.setPath(s,0,4,!0),this.pathEndFunction=i,this.pathOnlyRelatedTo=this.inPermanent},resetPath:function(t){null==t&&(t=!0),this.recyclePathArray&&(ka.returnToPool(this.path),this.recyclePathArray=!1),this.path=null,this.nextPathPos=-1,this.pathEnd=-1,this.currentPathAction=-2,t&&(this.canViewSelfInBuilding||(this.delayCanViewSelfInBuilding=!0),this.canViewSelfInBuilding=!0),this.verticalPathProgress=0,this.pathEndFunction=null,this.requestingPathGoal=null,this.pathOnlyRelatedTo=null,this.pathWalkSpeed=1,this.pathCanBeReconsidered=!0,0<this.sprite.alpha&&this.sprite.alpha<1&&(this.sprite.alpha=1)},swapRemoveFromStage:function(){var t=this.addedToStage.children[this.addedToStage.children.length-1];this.addedToStage.children[this.stageChildIndex]=t,K.spriteCitizens.h[t.__id__].stageChildIndex=this.stageChildIndex,this.addedToStage.children[this.addedToStage.children.length-1]=this.sprite,this.addedToStage.removeChildAt(this.addedToStage.children.length-1)},actuallyUpdateDraw:function(){null!=this.inPermanent?(this.sprite.position.x=this.inPermanent.position.x+this.relativeX,null!=this.inPermanent&&this.inPermanent.isBuilding?(0!=this.sprite.alpha&&1!=this.sprite.alpha||(this.sprite.alpha=this.canViewSelfInBuilding&&!this.delayCanViewSelfInBuilding?1:0),this.sprite.position.y=this.inPermanent.position.y+20-this.relativeY-1):this.sprite.position.y=this.inPermanent.position.y+20-this.relativeY):(this.sprite.position.x=this.onWorld.rect.x+this.relativeX,this.sprite.position.y=this.onWorld.rect.y-this.relativeY),this.updateCull()},uncull:function(){null==this.addedToStage&&null!=this.drawOnStage&&(this.stageChildIndex=this.drawOnStage.children.length,this.drawOnStage.addChild(this.sprite),this.addedToStage=this.drawOnStage)},updateCull:function(){var t;(t=this.sprite.x>=this.city.cityCullX&&this.sprite.y>=this.city.cityCullY&&this.sprite.x<this.city.cityCullX2&&this.sprite.y<this.city.cityCullY2?this.drawOnStage:null)!=this.addedToStage&&(null!=this.addedToStage&&this.swapRemoveFromStage(),null!=t&&(this.stageChildIndex=t.children.length,t.addChild(this.sprite)),this.addedToStage=t)},addToOnWorldStage:function(){this.set_drawOnStage(this.foregroundStage)},addToWithAccessoryStage:function(){this.set_drawOnStage(this.inBuildingStageNonParticle)},addToCorrectStage:function(){this.set_drawOnStage(null!=this.inPermanent&&this.inPermanent.isBuilding?null!=this.accessorySprite?this.inBuildingStageNonParticle:this.inBuildingStage:this.foregroundStage)},findPath:function(t,e){this.simulation.pathfinder.findPath(this,t),this.pathOnFail=e},findPathCombined:function(t,e){this.simulation.pathfinder.findPathCombined(this,t),this.pathOnFail=e},findPathEntertainment:function(t,e){this.simulation.pathfinder.findPathEntertainment(this,t,e),this.pathOnFail=null},setPath:function(t,e,i,n){var r;if(null==n&&(n=!1),null!=this.path&&(console.log("FloatingSpaceCities/Citizen.hx:1542:","overwriting path"),console.log("FloatingSpaceCities/Citizen.hx:1542:",this)),-1==t[e])return this.isRequestingPath=!1,this.requestingPathGoal==this.home?this.evictFromHome():this.requestingPathGoal==this.job?this.loseJob():this.requestingPathGoal==this.school&&this.leaveSchool(),null!=this.pathOnFail&&this.pathOnFail(),null==(r=!1)&&(r=!0),this.recyclePathArray&&(ka.returnToPool(this.path),this.recyclePathArray=!1),this.path=null,this.nextPathPos=-1,this.pathEnd=-1,this.currentPathAction=-2,r&&(this.canViewSelfInBuilding||(this.delayCanViewSelfInBuilding=!0),this.canViewSelfInBuilding=!0),this.verticalPathProgress=0,this.pathEndFunction=null,this.requestingPathGoal=null,this.pathOnlyRelatedTo=null,this.pathWalkSpeed=1,this.pathCanBeReconsidered=!0,void(0<this.sprite.alpha&&this.sprite.alpha<1&&(this.sprite.alpha=1));if(this.pathDestination=this.requestingPathGoal,null==(r=!1)&&(r=!0),this.recyclePathArray&&(ka.returnToPool(this.path),this.recyclePathArray=!1),this.path=null,this.nextPathPos=-1,this.pathEnd=-1,this.currentPathAction=-2,r&&(this.canViewSelfInBuilding||(this.delayCanViewSelfInBuilding=!0),this.canViewSelfInBuilding=!0),this.verticalPathProgress=0,this.pathEndFunction=null,this.requestingPathGoal=null,this.pathOnlyRelatedTo=null,this.pathWalkSpeed=1,this.pathCanBeReconsidered=!0,0<this.sprite.alpha&&this.sprite.alpha<1&&(this.sprite.alpha=1),0!=i&&(this.path=t,this.nextPathPos=e,this.currentPathAction=-1,this.pathEnd=e+i,null!=this.inPermanent&&(this.relativeX<0||18<this.relativeX)&&15!=this.path[this.nextPathPos]&&16!=this.path[this.nextPathPos])){var s=this.relativeX;this.relativeX=s<0?0:18<s?18:s}this.isRequestingPath=!1,this.recyclePathArray=n,this.pathStartTime=this.city.simulation.time.timeSinceStart},setPathWithEnd:function(t,e,i,n,r){null==r&&(r=!1),this.setPath(t,e,i,r),this.pathEndFunction=n},setCurrentTexture:function(){var t=this.get_age()<16?this.childrenTextures[this.spriteIndexActual]:this.adultTextures[this.spriteIndexActual];this.sprite.texture=t,this.actualSpriteHeight=this.get_age()<16?4:6==this.spriteIndexActual||12==this.spriteIndexActual||16==this.spriteIndexActual||20==this.spriteIndexActual||26==this.spriteIndexActual?4:5},load:function(t,e){this.loadBasics(t,e),this.updateSpriteAndNameIndexInfo()},updateSpriteAndNameIndexInfo:function(){this.nameIndex=this.spriteIndex>>14,this.spriteIndexActual=this.spriteIndex-(this.nameIndex<<14),0==this.nameIndex&&(this.nameIndex=il.getInt(1,8e3)),this.spriteIndexActual>=this.adultTextures.length-1&&(this.spriteIndexActual=il.getInt(this.childrenTextures.length-1),this.spriteIndex=this.spriteIndexActual+(this.nameIndex<<14)),dt.citizenNames.length>=this.nameIndex&&"Waldo"==dt.citizenNames[this.nameIndex]&&(this.spriteIndexActual=this.childrenTextures.length-1),this.likesNightclubs=this.spriteIndex%5!=0,this.setCurrentTexture()},afterLoadingInPermanent:function(){null!=this.inPermanent&&(this.relativeX<0||20<this.relativeX)&&(this.relativeY=5),null==this.inPermanent&&null!=this.onWorld&&0==this.onWorld.rect.height&&(this.onWorld=lt.find(this.city.worlds,function(t){return 0<t.rect.y}),this.setRelativeX(0)),this.addToCorrectStage(),this.actuallyUpdateDraw(),null==this.school&&1==this.currentAction&&(this.currentAction=2)},goToPermanent:function(t){null!=this.inPermanent&&this.inPermanent.onCitizenLeave(this,t),this.inBuildingSince=this.city.simulation.time.timeSinceStart,this.inPermanent=t,this.hasBuildingInited=!1},goToPermanentLocal:function(t){this.inPermanent=t},educate:function(t,e){this.educationLevel=Math.max(Math.min(this.educationLevel+t,e),this.educationLevel)},getCityPosition:function(){var t=new br(0,0);if(this.fullyBeingControlled&&null!=this.inTransportationThing)t=new br(this.inTransportationThing.position.x+this.inTransportationThing.get_citizenOffset().x,this.inTransportationThing.position.y+this.inTransportationThing.get_citizenOffset().y);else if(null!=this.inPermanent)t.x=this.inPermanent.position.x+this.relativeX,null!=(null!=this.inPermanent&&this.inPermanent.isBuilding?this.inPermanent:null)?t.y=this.inPermanent.position.y+20-this.relativeY-1:t.y=this.inPermanent.position.y+20-this.relativeY;else{var e=this.onWorld.rect,i=e.x,n=e.y,r=this.relativeX,s=-this.relativeY;t=new br(i+r,n+s)}return null!=this.path&&(0==this.currentPathAction?t.y-=this.verticalPathProgress:1==this.currentPathAction&&(t.y+=this.verticalPathProgress)),t},getShard:function(){return null!=this.inPermanent?this.inPermanent.shardId:this.onWorld.surfaceShardId},onClick:function(){var t=this;if(Ss.createWindow(this.city,this),!this.city.simulation.bonuses.waldoFound&&dt.citizenNames.length>this.nameIndex&&"Waldo"==dt.citizenNames[this.nameIndex]){var e=Math.floor(10+.05*this.city.simulation.citizens.length);this.city.materials.knowledge+=e,this.city.simulation.stats.materialProduction[10][0]+=e,this.city.simulation.bonuses.waldoFound=!0;var i=function(){t.city.gui.showSimpleWindow(Tr.lo("waldo_found",[e]),null,!0)};i(),this.city.gui.addWindowToStack(i)}},save:function(t,e){null==e&&(e=!0),e&&t.addString(K.saveDefinition);var i=this.hasBuildingInited;if(t.size+1>t.bytes.length){var n=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+1))),t.bytes.blit(0,n,0,t.size)}t.bytes.b[t.size]=i?1:0,t.size+=1;i=this.spriteIndex;if(t.size+4>t.bytes.length){n=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+4))),t.bytes.blit(0,n,0,t.size)}t.bytes.setInt32(t.size,i),t.size+=4;i=this.relativeX;if(t.size+8>t.bytes.length){n=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+8))),t.bytes.blit(0,n,0,t.size)}t.bytes.setDouble(t.size,i),t.size+=8;i=this.bornOn;if(t.size+8>t.bytes.length){n=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+8))),t.bytes.blit(0,n,0,t.size)}t.bytes.setDouble(t.size,i),t.size+=8;i=this.currentAction;if(t.size+4>t.bytes.length){n=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+4))),t.bytes.blit(0,n,0,t.size)}t.bytes.setInt32(t.size,i),t.size+=4;i=this.hasWorkTools;if(t.size+1>t.bytes.length){n=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+1))),t.bytes.blit(0,n,0,t.size)}t.bytes.b[t.size]=i?1:0,t.size+=1;i=this.lastInfrequentUpdateAge;if(t.size+8>t.bytes.length){n=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+8))),t.bytes.blit(0,n,0,t.size)}t.bytes.setDouble(t.size,i),t.size+=8;i=this.dieAgeModifier;if(t.size+8>t.bytes.length){n=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+8))),t.bytes.blit(0,n,0,t.size)}t.bytes.setDouble(t.size,i),t.size+=8;i=this.educationLevel;if(t.size+8>t.bytes.length){n=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+8))),t.bytes.blit(0,n,0,t.size)}t.bytes.setDouble(t.size,i),t.size+=8;i=this.actualWorkTimePreference;if(t.size+8>t.bytes.length){n=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+8))),t.bytes.blit(0,n,0,t.size)}t.bytes.setDouble(t.size,i),t.size+=8},loadBasics:function(t,e){null==e&&(e=t.readString());var i=Dr.makeLoadMap(e,t);Object.prototype.hasOwnProperty.call(i.h,"hasBuildingInited")&&(this.hasBuildingInited=i.h.hasBuildingInited),Object.prototype.hasOwnProperty.call(i.h,"spriteIndex")&&(this.spriteIndex=i.h.spriteIndex),Object.prototype.hasOwnProperty.call(i.h,"relativeX")&&(this.relativeX=i.h.relativeX),Object.prototype.hasOwnProperty.call(i.h,"bornOn")&&(this.bornOn=i.h.bornOn),Object.prototype.hasOwnProperty.call(i.h,"currentAction")&&(this.currentAction=i.h.currentAction),Object.prototype.hasOwnProperty.call(i.h,"hasWorkTools")&&(this.hasWorkTools=i.h.hasWorkTools),Object.prototype.hasOwnProperty.call(i.h,"lastInfrequentUpdateAge")&&(this.lastInfrequentUpdateAge=i.h.lastInfrequentUpdateAge),Object.prototype.hasOwnProperty.call(i.h,"dieAgeModifier")&&(this.dieAgeModifier=i.h.dieAgeModifier),Object.prototype.hasOwnProperty.call(i.h,"educationLevel")&&(this.educationLevel=i.h.educationLevel),Object.prototype.hasOwnProperty.call(i.h,"actualWorkTimePreference")&&(this.actualWorkTimePreference=i.h.actualWorkTimePreference),this.postLoad()},__class__:K};function r(){}(q.GameState=r).__name__="GameState",r.__isInterface__=!0,r.prototype={__class__:r};function x(t,e,i,n,r){null==r&&(r="fpc_save"),null==n&&(n=!1),this.cachedCityEdges=null,this.possibleSubCities=[],this.subCities=[],this.cityName="",this.usingParticleContainers=!0,this.previousCullRectangle=null,this.updateConnectedBuildingSprites=!1,this.isLoserState=!1,this.skyColor=0,this.saveRawDataToReuse=null,this.currentlySaving=!1,this.secondsSinceAutoSave=0,this.simulationSpeed=1,this.windowRelatedOnBuildOrDestroy=null,this.zoomScale=2,this.fixViewBottomYOn=null,this.specialActionOld=null,this.specialAction=null,this.postCreateBuilder=null,this.misdirector=null,this.maxPermanentID=0,this.worlds=[],this.hoverHighlightSetThisStep=!1,"snowWorld"!=i&&"displayCitySnow"!=i||(this.usingParticleContainers=!1),this.cityCullX=0,this.cityCullY=0,this.cityCullX2=1,this.cityCullY2=1,this.zoomScale=Math.max(t.scaling,this.zoomScale),this.game=t,this.outerStage=e,this.displayOnly=n,this.cityFile=r,this.cityMainFile=r,this.buildingMode=ot.Normal,this.materials=new L,this.permanentsByID=new Wo,this.permanents=[],this.permanentNumberCached=new Vo,this.workBuildings=[],this.upgrades=new Qn(this),this.policies=new Sa(this),this.teleporters=[],this.landingSites=[],this.connections=new pl(this),this.progress=new za(this,i),this.progress.init(),this.viewPos=new br(225,150),this.cityView=new l(this),this.sky=new PIXI.Graphics,this.updateSky(0),this.outerStage.addChild(this.sky),this.starStage=new PIXI.Container,this.outerStage.addChild(this.starStage),this.stars=new Yr(this.starStage,this),this.backgroundImageStage=new PIXI.Container,this.outerStage.addChild(this.backgroundImageStage),this.backgroundImages=new Lr(this.backgroundImageStage,this),this.movingViewStage=new PIXI.Container,this.outerStage.addChild(this.movingViewStage),this.movingViewStage.position.set(t.addX,t.addY),this.mainMovingViewStage=new PIXI.Container,this.movingViewStage.addChild(this.mainMovingViewStage),this.cityBgStageBelow=new zr(new yr(-1024,-1024,2048,2048)),this.mainMovingViewStage.addChild(this.cityBgStageBelow),this.trainStage=new Gr,this.mainMovingViewStage.addChild(this.trainStage),this.cityBgStage=new zr(new yr(-1024,-1024,2048,2048)),this.mainMovingViewStage.addChild(this.cityBgStage),this.cityBgStageAbove=new PIXI.Container,this.mainMovingViewStage.addChild(this.cityBgStageAbove),this.usingParticleContainers?this.citizenInBuildingStage=new PIXI.ParticleContainer(1e4,{position:!0,alpha:!0,uvs:!0,scale:!1}):this.citizenInBuildingStage=new PIXI.Container,this.mainMovingViewStage.addChild(this.citizenInBuildingStage),this.citizenInBuildingStageNonParticle=new PIXI.Container,this.mainMovingViewStage.addChild(this.citizenInBuildingStageNonParticle);var s=new PIXI.Container;if(this.mainMovingViewStage.addChild(s),this.particles=new Vr(s,this),this.cityMidStage=new zr(new yr(-1024,-1024,2048,2048)),this.mainMovingViewStage.addChild(this.cityMidStage),this.aboveCitizensInBuildingStage=new Gr,this.mainMovingViewStage.addChild(this.aboveCitizensInBuildingStage),this.cityStage=new zr(new yr(-1024,-1024,2048,2048)),this.mainMovingViewStage.addChild(this.cityStage),this.justAboveCityStage=new PIXI.Container,this.mainMovingViewStage.addChild(this.justAboveCityStage),this.builderStage=new PIXI.Container,this.mainMovingViewStage.addChild(this.builderStage),this.usingParticleContainers?this.citizenForegroundStage=new PIXI.ParticleContainer(5e3,{position:!0,uvs:!0,scale:!1}):this.citizenForegroundStage=new PIXI.Container,this.mainMovingViewStage.addChild(this.citizenForegroundStage),this.justAboveCitizensForegroundStage=new PIXI.Container,this.mainMovingViewStage.addChild(this.justAboveCitizensForegroundStage),this.farForegroundStage=new PIXI.Container,this.mainMovingViewStage.addChild(this.farForegroundStage),this.furtherForegroundStage=new PIXI.Container,this.mainMovingViewStage.addChild(this.furtherForegroundStage),this.builderHighlightStage=new PIXI.Container,this.furtherForegroundStage.addChild(this.builderHighlightStage),this.hoverHighlightStage=new PIXI.Container,this.furtherForegroundStage.addChild(this.hoverHighlightStage),this.hoverHighlightStage2=new PIXI.Container,this.furtherForegroundStage.addChild(this.hoverHighlightStage2),this.furtherForegroundTempStage=new PIXI.Container,this.furtherForegroundStage.addChild(this.furtherForegroundTempStage),this.simulation=new a(this,this.citizenForegroundStage,this.citizenInBuildingStage,this.citizenInBuildingStageNonParticle),this.miscCityElements=new ta(this),this.guiStage=new PIXI.Container,n&&(this.guiStage.visible=!1),this.outerStage.addChild(this.guiStage),this.gui=new os(t,this.guiStage,this),this.set_pauseGame(!1),g.isLoading||(this.progress.story.makeWorlds(t,this.cityStage,this.cityMidStage,this.cityBgStage),this.createBottomWorld(),this.progress.story.start(),this.updateDrawCachingRectSize()),g.isLoading||(this.connections.updateCityConnections(),this.simulation.updatePathfinder(!0),this.progress.unlocks.stopAllNotifyForUnlock(),this.gui.refreshCategoryBuildingsShown()),Th.alreadyFoundBonuses=[],this.simulation.time.updateSky(),this.secondsSinceAutoSave=0,this.resize(),B.enableCheats){window.cheatMaterials=Uh(this,this.cheatMaterials),window.cheatPeople=Uh(this,this.cheatPeople),window.cheatUnlocks=Uh(this,this.cheatUnlocks),window.cheatSpeed=function(){B.cheatSpeedEnabled=!0},window.cheatMaterialsZero=Uh(this,this.cheatMaterialsZero),window.cheatFood=Uh(this,this.cheatFood),window.cheatWood=Uh(this,this.cheatWood),window.cheatStone=Uh(this,this.cheatStone);var o=this;window.permanentFinderPerf=function(){Jl.doTest(o)}}this.viewActions=new Xn(this),window.curCity=this,g.isLoading||this.backgroundImages.postCreate()}(q.City=x).__name__="City",x.__interfaces__=[r],x.prototype={get_publicGUI:function(){return this.gui},get_displayWidth:function(){return Math.floor(this.game.rect.width*this.game.scaling/this.zoomScale)},get_displayHeight:function(){return Math.floor(this.game.rect.height*this.game.scaling/this.zoomScale)},set_pauseGame:function(t){return this.pauseGame=t,this.gui.pausedForWindow=!1,this.pauseGame},refreshPossibleSubCities:function(){for(var t=[],e=0,i=this.possibleSubCities;e<i.length;){var n=i[e];++e,-1==this.subCities.indexOf(n)&&t.push(n)}this.possibleSubCities=t},enableDisplayOnly:function(){this.displayOnly=!0},disableDisplayOnlyMode:function(t){this.displayOnly=!1,this.guiStage.visible=!0,null!=t&&(this.cityFile=t,this.cityMainFile=this.cityFile)},setHoverHightlight:function(t,e){var i=0,n=0;this.hoverHighlightSetThisStep&&(i=this.hoverHighlightStage.children.length,n=this.hoverHighlightStage2.children.length);for(var r=0,s=this.permanents;r<s.length;){var o=s[r];++r;var a=t(o);if(null!=a){i>=this.hoverHighlightStage.children.length&&this.hoverHighlightStage.addChild(new PIXI.Sprite);var l=this.hoverHighlightStage.children[i];l.position.set(o.position.x-1,o.position.y-1),l.texture=a,l.alpha=.5+(Math.sin(this.gui.guiTimer/10)+1)/4,++i,n>=this.hoverHighlightStage2.children.length&&this.hoverHighlightStage2.addChild(new PIXI.Sprite);var h=this.hoverHighlightStage2.children[n];h.position.set(o.position.x-1,o.position.y-1),h.texture=dt.getTexture("spr_whiteoutline"),h.tint=e,h.alpha=1,++n}}if(i<this.hoverHighlightStage.children.length){null==(d=i)&&(d=0);for(var u=(c=this.hoverHighlightStage).children.length-1;d<=u;)c.children[u].destroy(),--u}if(n<this.hoverHighlightStage2.children.length){var c,d;null==(d=n)&&(d=0);for(u=(c=this.hoverHighlightStage2).children.length-1;d<=u;)c.children[u].destroy(),--u}this.hoverHighlightSetThisStep=!0},updateDrawCachingRectSize:function(){var t=new yr(0,0,1024,1024);0<this.worlds.length&&(t=new yr(gr.whereMin(this.worlds,function(t){return 0<t.rect.width},function(t){return t.rect.x}).rect.x,gr.max(this.worlds,function(t){return t.rect.get_y2()}).rect.get_y2()-2040,2046,2046)),this.cityStage.cacheWithinRect=t,this.cityBgStage.cacheWithinRect=t,this.cityMidStage.cacheWithinRect=t,this.cityBgStageBelow.cacheWithinRect=t},stop:function(){this.displayOnly||this.saveToBrowserStorage(),this.simulation.stop();for(var t=0,e=this.worlds;t<e.length;){var i=e[t];++t,i.cleanup()}this.cityStage.removeCache(),this.cityBgStage.removeCache(),this.cityMidStage.removeCache(),this.cityBgStageBelow.removeCache()},pause:function(){this.pauseGame||(this.pausedForUnfocused=!0,this.set_pauseGame(!0))},resume:function(){this.pauseGame&&this.pausedForUnfocused&&(this.pausedForUnfocused=!1,this.set_pauseGame(!1))},handleMouse:function(t){if(this.progress.handleMouse(t))return!0;if(this.displayOnly||this.pauseGame&&this.pausedForUnfocused)return!1;this.pauseGame&&!this.gui.pausedForWindow||this.displayOnly||-1!=this.gui.windowStackMeta.indexOf("GameMenu")||!t.pressed||Mr.reportStartGameplay();var e=!1;if(!this.cityView.isDraggingView){if(this.gui.handleMouse(t))return!0;if(this.cityView.handleScrollbarZoom(t),e=!0,this.cityView.handleEarlyMouse(t))return!0;if(!this.isLoserState){if(this.simulation.handleMouse(t))return!0;if(null!=this.builder&&this.builder.handleMouse(t))return!0;for(var i=0,n=this.worlds;i<n.length;){var r=n[i];if(++i,r.handleMouse(t))return!0}if(this.miscCityElements.handleMouse(t))return!0}if(t.pressed&&t.disableCityMovement&&(t.disableCityMovement=!1),this.cityView.handleMouse(t))return!0}return e||this.cityView.handleScrollbarZoom(t),t.releaseAllClaims(),!1},update:function(t){!this.game.mouse.rightPressed||this.buildingMode!=ot.Destroy&&this.buildingMode!=ot.DestroyLeavingHole||(this.buildingMode=ot.Normal,null!=this.specialActionOld&&this.specialActionOld.activate()),this.pauseGame&&this.pausedForUnfocused||this.displayOnly||!this.game.keyboard.pressed[32]&&!this.game.keyboard.pressed[f.getLetterCode("P")]||(this.set_pauseGame(!this.pauseGame),this.pauseGame&&Mr.reportStopGameplay()),this.pauseGame&&!this.gui.pausedForWindow||this.displayOnly||-1!=this.gui.windowStackMeta.indexOf("GameMenu")||!this.game.keyboard.anyKey()||Mr.reportStartGameplay();for(var e=this.pauseGame?0:.6666666666666666*this.simulationSpeed,i=0,n=this.worlds;i<n.length;){var r=n[i];++i,r.update(t*e)}if(this.particles.update(t*e),null!=this.builder)this.builder.update(t);else if(this.game.isMobile)for(var s=this.builderHighlightStage,o=s.children.length-1;0<=o;)s.children[o].destroy(),--o;this.displayOnly||this.gui.update(t);var a=Math.ceil(e/1.67);this.cityCullX=this.viewPos.x-this.get_displayWidth()/2-5,this.cityCullY=this.viewPos.y-this.get_displayHeight()/2-5,this.cityCullX2=this.cityCullX+this.get_displayWidth()+10,this.cityCullY2=this.cityCullY+this.get_displayHeight()+10;for(i=0,n=a;i<n;){o=i++;this.simulation.update(t*(e/a))}if(this.miscCityElements.update(t),this.simulation.prevTimeMod=t*e,0==a&&this.simulation.updateWhilePaused(),this.stars.update(),this.progress.update(t),this.displayOnly||pr.cityUpdate(this,this.game.mouse),this.displayOnly||(this.cityView.handleMouseMovement(t),this.cityView.handleKeyboardMove(t)),this.displayOnly||this.handleAutoSave(t),this.displayOnly||this.gui.lateUpdate(),this.updateConnectedBuildingSprites){this.miscCityElements.onCityChange();for(i=0,n=this.permanents;i<n.length;){var l=n[i];if(++i,l.isBuilding)l.drawer.positionSpritesMerging()}this.updateConnectedBuildingSprites=!1}var h=new _r(this.viewPos.x-this.get_displayWidth()/2-1,this.viewPos.y-this.get_displayHeight()/2-1,this.get_displayWidth()+2,this.get_displayHeight()+2);null!=this.previousCullRectangle&&this.previousCullRectangle.x==h.x&&this.previousCullRectangle.y==h.y&&this.previousCullRectangle.width==h.width&&this.previousCullRectangle.height==h.height||(this.simulation.recomputeCull(),this.previousCullRectangle=h.clone()),this.backgroundImages.update(t*e),this.cityBgStage.preDraw(h),this.cityStage.preDraw(h),this.cityMidStage.preDraw(h),this.cityBgStageBelow.preDraw(h),this.aboveCitizensInBuildingStage.preDraw(h),this.trainStage.preDraw(h)},uncull:function(){this.cityBgStage.uncull(),this.cityStage.uncull(),this.cityMidStage.uncull(),this.cityBgStageBelow.uncull(),this.aboveCitizensInBuildingStage.uncull(),this.trainStage.uncull(),this.simulation.uncull()},postDraw:function(){this.simulation.lateUpdate();for(var t=(e=this.furtherForegroundTempStage).children.length-1;0<=t;)e.children[t].destroy(),--t;if(this.hoverHighlightSetThisStep)this.hoverHighlightSetThisStep=!1;else{for(t=(e=this.hoverHighlightStage).children.length-1;0<=t;)e.children[t].destroy(),--t;var e;for(t=(e=this.hoverHighlightStage2).children.length-1;0<=t;)e.children[t].destroy(),--t}},resize:function(){this.displayOnly&&(this.zoomScale=this.game.scaling);var t=this.zoomScale;t=this.zoomScale%1<.001||.999<this.zoomScale%1?(!0,Math.round(this.zoomScale)):this.zoomScale,this.sky.scale.x=this.sky.scale.y=t,this.starStage.scale.x=this.starStage.scale.y=t,this.backgroundImages.backgroundImagesStage.scale.x=this.backgroundImages.backgroundImagesStage.scale.y=t;for(var e=0,i=this.backgroundImages.cloudsStages;e<i.length;){var n=i[e];++e,n.scale.x=n.scale.y=t}this.movingViewStage.scale.x=this.movingViewStage.scale.y=t,this.cityView.updateMovingView(),this.gui.resize(),this.simulation.time.updateSky(),this.stars.resize(),this.backgroundImages.resize(),this.starStage.position.set(t*(this.get_displayWidth()-this.stars.maxStarX)/2,t*(this.get_displayHeight()-this.stars.maxStarY)/2)},refocus:function(){this.game.isMobile&&(this.cityStage.isInvalid=!0,this.cityMidStage.isInvalid=!0,this.cityBgStage.isInvalid=!0,this.cityBgStageBelow.isInvalid=!0)},updateSky:function(t){this.sky.clear(),this.skyColor=t,this.sky.beginFill(t),this.sky.drawRect(0,0,this.get_displayWidth()+1,this.get_displayHeight()+1),this.sky.endFill()},getCityEdges:function(){if(null!=this.cachedCityEdges&&!g.isLoading)return this.cachedCityEdges;for(var t,e=0,i=0,n=0,r=1,s=0,o=this.worlds;s<o.length;){var a=o[s];if(++s,0<a.rect.height){var l=a.rect.x;l<e&&(e=l);var h=a.rect.get_x2();i<h&&(i=h);var u=a.rect.get_y2();r<u&&(r=u)}var c=a.rect.y-20*gr.max(a.permanents,function(t){return t.length}).length;c<n&&(n=c)}0<this.miscCityElements.allMiscElements.length&&((t=gr.min(this.miscCityElements.allMiscElements,function(t){return t.rect.x}).rect.x)<=e&&(e=t),i<=(t=gr.max(this.miscCityElements.allMiscElements,function(t){return t.rect.get_x2()}).rect.get_x2())&&(i=t));var d={minX:e,maxX:i,minY:n,maxY:r=20*Math.ceil(r/20)};return g.isLoading||(this.cachedCityEdges=d),d},generatePermanentsByPositionMap:function(){this.permanentsByPosition=new Vo;for(var t=0,e=this.worlds;t<e.length;){var i=e[t];++t;for(var n=0,r=i.permanents;n<r.length;){var s=r[n];++n;for(var o=0;o<s.length;){var a=s[o];++o,null!=a&&(this.permanentsByPosition.h[a.position.x+"-"+a.position.y]=a)}}}},getPermanentAtPos:function(t,e){return null==this.permanentsByPosition&&this.generatePermanentsByPositionMap(),this.permanentsByPosition.h[t+"-"+e]},fixViewBottom:function(t){this.fixViewBottomYOn=t},onCityChange:function(){this.cachedCityEdges=null},onBuildBuilding:function(t,e,i,n,r,s){if(this.connections.updateCityConnections(),this.simulation.updatePathfinder(t||e,i),this.progress.unlocks.research(n),t)for(var o=r+1,a=s.length;o<a;){var l=s[o++];null!=l&&l.positionSprites()}i.postCreate()},createOrRemoveBuilder:function(t,e,i,n,r){null==r&&(r=-1),null==n&&(n=!1),null==i&&(i=0),null==e&&(e=!1);var s=!1;if(null==this.builder||this.builder.get_buildingToBuild()!=t||this.builder.decorationAppearance!=i||this.builder.decorationAppearanceColor!=r){null!=this.builder&&(s=this.builder.isCacheValid());var o=this.progress.resources.buildingInfo,a=t.__name__,l=o.h[a],h=!1;if(null!=this.builder){var u=this.builder.builderType;if(0==u._hx_index){u.buildingType;var c=u.buildingInfo;h=-1!=l.specialInfo.indexOf("rooftop")==(-1!=c.specialInfo.indexOf("rooftop"))}this.builder.cancel()}null!=this.specialAction&&this.specialAction.deactivate(),-1!=r&&(ls.colorPicked=r),this.builder=new U(this,this.builderStage,d.Building(t,l),i,n,r),h&&s&&this.builder.prevalidateCache(),null!=this.postCreateBuilder&&this.postCreateBuilder()}else e||this.builder.cancel()},createOrRemoveFloatingPlatformBuilder:function(){null==this.builder||4!=this.builder.builderType._hx_index?(null!=this.builder&&this.builder.cancel(),null!=this.specialAction&&this.specialAction.deactivate(),this.builder=new U(this,this.builderStage,d.FloatingPlatform,0,!1,-1),null!=this.postCreateBuilder&&this.postCreateBuilder()):this.builder.cancel()},createOrRemoveBridgeBuilder:function(t){null!=this.builder&&k.enumEq(this.builder.builderType,d.Bridge(t))?this.builder.cancel():(null!=this.builder&&this.builder.cancel(),null!=this.specialAction&&this.specialAction.deactivate(),this.builder=new U(this,this.builderStage,d.Bridge(t),0,!1,-1),null!=this.postCreateBuilder&&this.postCreateBuilder())},createOrRemoveDecorationBuilder:function(t){var e;if(null!=this.builder){var i,n=this.builder.builderType;if(1==n._hx_index)i=n.decorationInfo.name;else i="";e=i==t.name}else e=!1;e?this.builder.cancel():(null!=this.builder&&this.builder.cancel(),null!=this.specialAction&&this.specialAction.deactivate(),this.builder=new U(this,this.builderStage,d.Decoration(t),0,!1,-1),null!=this.postCreateBuilder&&this.postCreateBuilder())},createOrRemoveWorldResourceBuilder:function(t){var e;if(null!=this.builder){var i,n=this.builder.builderType;if(2==n._hx_index)i=n.resourceInfo;else i=null;e=i==t}else e=!1;e?this.builder.cancel():(null!=this.builder&&this.builder.cancel(),null!=this.specialAction&&this.specialAction.deactivate(),this.builder=new U(this,this.builderStage,d.WorldResource(t),0,!1,-1),null!=this.postCreateBuilder&&this.postCreateBuilder())},createWorldResourceBuilderMove:function(t){null!=this.builder&&this.builder.cancel(),null!=this.specialAction&&this.specialAction.deactivate(),this.builder=new U(this,this.builderStage,d.MoveWorldResource(t),0,!1,-1),null!=this.postCreateBuilder&&this.postCreateBuilder()},activateSpecialCityAction:function(t){null!=this.builder&&this.builder.cancel(),(this.specialActionOld=null)!=this.specialAction&&this.specialAction.deactivate(!0),this.specialAction=t,this.specialAction.activate()},findPermanentByID:function(t){return this.permanentsByID.h[t]},handleAutoSave:function(t){this.secondsSinceAutoSave+=t/60,1.95<this.secondsSinceAutoSave&&!this.currentlySaving&&!this.isLoserState&&this.saveToBrowserStorage(this.cityFile)},saveToBrowserStorageSoon:function(){this.secondsSinceAutoSave=Math.max(this.secondsSinceAutoSave,1.9)},saveToBrowserStorage:function(t,e){var i=this;null==t&&(t=this.cityFile);var n=this.saveToUIntArray();this.currentlySaving=!0,Rr.setItem(t,n,function(){i.secondsSinceAutoSave=0,i.currentlySaving=!1,null!=e&&e()}),Nr.saveMetaData(this.cityFile,this.cityMainFile,this)},saveToString:function(){return this.save().toBase64()},saveToOtherSaveSlot:function(s,o){var a=this;Rr.setItem("__meta_mostRecentSubOf_"+s,"PARTIALLY_OVERWRITTEN",function(){function t(t,n){t!=a.cityFile&&Rr.getItem(t,function(t,e){if(null==t&&null!=e){var i=Fr.fromData(e).getData();Rr.setItem(s+n,i,function(){(r+=1)>=a.subCities.length&&Rr.setItem("__meta_mostRecentSubOf_"+s,a.cityFile,function(){o()})})}else console.log("FloatingSpaceCities/City.hx:1149:",t)},!0)}var r=0;t(a.cityMainFile,"");for(var e=0,i=a.subCities;e<i.length;){var n=i[e];++e,t(a.cityMainFile+"-"+n,"-"+n)}0==a.subCities.length&&Rr.setItem("__meta_mostRecentSubOf_"+s,a.cityFile,function(){o()})})},saveAllSubCitiesToString:function(r){function t(t,n){t!=s.cityFile&&Rr.getItem(t,function(t,e){if(null==t&&null!=e){var i=Fr.fromData(e).toBase64();o+=n+":"+i+":",(a+=1)>=s.subCities.length&&(console.log("FloatingSpaceCities/City.hx:1181:",o),r(o))}else console.log("FloatingSpaceCities/City.hx:1185:",t)},!0)}var s=this,o="THEFINALEARTH2_CITYPACK:",a=0;o+=this.subCities.length+":";var e=this.save().toBase64();o=(o+=this.cityFile==this.cityMainFile?":":at.substr(this.cityFile,this.cityMainFile.length,null)+":")+e+":",t(this.cityMainFile,"");for(var i=0,n=this.subCities;i<n.length;){var l=n[i];++i,t(this.cityMainFile+"-"+l,"-"+l)}},saveToUIntArray:function(){return this.save().getData()},save:function(){var e=new Fr(this.saveRawDataToReuse);if(e.size+4>e.bytes.length){var t=e.bytes,i=new Do(new ArrayBuffer(2*(e.size+4)));e.bytes=i,e.bytes.blit(0,t,0,e.size)}if(e.bytes.setInt32(e.size,-1234),e.size+=4,e.addString(this.progress.story.storyName),e.size+4>e.bytes.length){t=e.bytes,i=new Do(new ArrayBuffer(2*(e.size+4)));e.bytes=i,e.bytes.blit(0,t,0,e.size)}if(e.bytes.setInt32(e.size,57),e.size+=4,e.size+4>e.bytes.length){t=e.bytes,i=new Do(new ArrayBuffer(2*(e.size+4)));e.bytes=i,e.bytes.blit(0,t,0,e.size)}e.bytes.setInt32(e.size,0),e.size+=4,O.saveToCitySave(e);var n=this.worlds.length;if(e.size+4>e.bytes.length){t=e.bytes,i=new Do(new ArrayBuffer(2*(e.size+4)));e.bytes=i,e.bytes.blit(0,t,0,e.size)}if(e.bytes.setInt32(e.size,n),e.size+=4,lt.iter(this.worlds,function(t){t.save(e)}),this.progress.save(e),this.simulation.save(e),this.saveBasics(e),this.materials.save(e),this.upgrades.save(e),this.policies.save(e),this.miscCityElements.save(e),e.size+4>e.bytes.length){t=e.bytes,i=new Do(new ArrayBuffer(2*(e.size+4)));e.bytes=i,e.bytes.blit(0,t,0,e.size)}return e.bytes.setInt32(e.size,0),e.size+=4,this.saveRawDataToReuse=e.bytes,e},createBottomWorld:function(){var t=this.getCityEdges();this.worlds.push(new Q(this.game,this,this.cityStage,this.cityMidStage,this.cityBgStage,new yr(t.minX-20,t.maxY+40,t.maxX-t.minX,0),0))},activateLoserState:function(){null!=this.builder&&this.builder.cancel(),this.set_pauseGame(!0),this.gui.activateLoserState(),this.isLoserState=!0},load:function(t){if(-1234==t.bytes.getInt32(t.readStart)){var e=t.bytes.getInt32(t.readStart);t.readStart+=4,t.readString()}e=t.bytes.getInt32(t.readStart);t.readStart+=4,t.version=e,36<=t.version&&aa._performOnLoadEarly(this,t),14<=t.version&&O.loadFromCitySave(t);e=t.bytes.getInt32(t.readStart);t.readStart+=4;for(var i=0,n=e;i<n;){i++;this.worlds.push(Q.fromLoad(t,this.game,this,this.cityStage,this.cityMidStage,this.cityBgStage))}t.version<24&&this.createBottomWorld(),this.updateDrawCachingRectSize(),this.progress.load(t),this.simulation.load(t),this.loadBasics(t),this.materials.load(t),4<=t.version&&this.upgrades.load(t),34<=t.version&&this.policies.load(t),43<=t.version&&this.miscCityElements.load(t),35<=t.version&&aa._performOnLoad(this,t),this.cityView.updateMovingViewStagePosition(),this.connections.updateCityConnections(),this.simulation.updatePathfinder(!1),this.resize();for(i=0,n=this.permanents;i<n.length;){var r=n[i];++i,r.postCreate()}this.simulation.afterLoad(),this.refreshPossibleSubCities(),t.version<38&&0<this.teleporters.length&&this.gui.showSimpleWindow(Tr.lo("welcome_back_teleporter_warning"),Tr.lo("update_notice")),this.gui.refreshCityInfo(),B.hasPremium()||this.progress.sandbox.unlimitedResources&&this.progress.sandbox.disableUnlimitedResources(),this.backgroundImages.postCreate()},getAmountOfPermanentsPerType:function(){return this.permanentNumberCached},cheatMaterials:function(){this.materials.add(new L(1e4,1e4,1e4,1e4,1e4,1e4,1e4,0,0,1e4,1e4))},cheatMaterialsZero:function(){this.materials.remove(this.materials)},cheatFood:function(t){this.materials.set_food(t)},cheatWood:function(t){this.materials.wood=t},cheatStone:function(t){this.materials.stone=t},cheatPeople:function(){for(var t=0;t<100;){t++;for(var e=this.simulation,i=[],n=0,r=this.worlds;n<r.length;){var s=r[n];++n,gr.any(this.simulation.citizens,function(e){return function(t){return t.onWorld==e[0]}}([s]))&&i.push(s)}e.createCitizen(i[0],20,null,0)}},cheatUnlocks:function(){for(var t=Vo.valueIterator(dt.buildingInfo.h);t.hasNext();){var e=t.next(),i="buildings."+e.className;this.progress.unlocks.unlock(q[i]);var n="buildings."+e.className;this.progress.unlocks.fullyUnlock(q[n])}},onContextRestored:function(){this.cityStage.isInvalid=!0,this.cityMidStage.isInvalid=!0,this.cityBgStage.isInvalid=!0,this.cityBgStageBelow.isInvalid=!0,this.usingParticleContainers&&(jr.recreateContainer(this.citizenInBuildingStage),jr.recreateContainer(this.citizenForegroundStage))},saveBasics:function(t,e){null==e&&(e=!0),e&&t.addString(x.saveDefinition);var i=this.maxPermanentID;if(t.size+4>t.bytes.length){var n=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+4))),t.bytes.blit(0,n,0,t.size)}t.bytes.setInt32(t.size,i),t.size+=4,t.addFPoint(this.viewPos);i=this.zoomScale;if(t.size+8>t.bytes.length){n=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+8))),t.bytes.blit(0,n,0,t.size)}t.bytes.setDouble(t.size,i),t.size+=8,t.addString(this.cityMainFile),t.addString(this.cityName),t.addString(Bo.run(this.subCities)),t.addString(Bo.run(this.possibleSubCities))},loadBasics:function(t,e){null==e&&(e=t.readString());var i=Dr.makeLoadMap(e,t);Object.prototype.hasOwnProperty.call(i.h,"maxPermanentID")&&(this.maxPermanentID=i.h.maxPermanentID),Object.prototype.hasOwnProperty.call(i.h,"viewPos")&&(this.viewPos=i.h.viewPos),Object.prototype.hasOwnProperty.call(i.h,"zoomScale")&&(this.zoomScale=i.h.zoomScale),Object.prototype.hasOwnProperty.call(i.h,"cityMainFile")&&(this.cityMainFile=i.h.cityMainFile),Object.prototype.hasOwnProperty.call(i.h,"cityName")&&(this.cityName=i.h.cityName),Object.prototype.hasOwnProperty.call(i.h,"subCities")&&(this.subCities=i.h.subCities),Object.prototype.hasOwnProperty.call(i.h,"possibleSubCities")&&(this.possibleSubCities=i.h.possibleSubCities)},__class__:x};var a=function(t,e,i,n){this.rockets=null,this.winter=null,this.infrequentUpdateStart=0,this.adultTextures=[],this.childrenTextures=[],this.citizens=[],this.city=t,this.foregroundStage=e,this.inBuildingStageNonParticle=n,this.inBuildingStage=i,this.time=new h(t,this),this.childrenTextures=dt.getTexturesByWidth("spr_children",2).slice(),this.adultTextures=dt.getTexturesByWidth("spr_humans",2).slice(),this.childrenTextures.push(dt.getTexture("spr_waldo_child")),this.adultTextures.push(dt.getTexture("spr_waldo_adult")),this.jobAssigner=new Pl(t,this),this.houseAssigner=new Il(t,this),this.schoolAssigner=new Ol(t,this),this.pathfinder=new fa(t),this.permanentFinder=new ma(t),this.routeFinder=new _a(t),this.flyingPathfinder=new ua(t),this.happiness=new xl(t,this),this.babyMaker=new ol(t,this),this.stats=new Dl(t,this),this.bonuses=new al,this.flyingSaucers=[],this.trainsByBuildingLeft=new jo,this.trainsByBuildingRight=new jo,this.trains=[],this.citizenSpawners=[],this.rocketsGoingDown=[],this.eating=new fl(this),this.resourcePriorityManager=new El(t),this.fishes=new yl(this),this.frogs=new wl(this),this.animals=new sl(this),this.rockets=new Rl(t),this.buildingUpgradesToUpdate=[],g.isLoading?this.possibleCitizenHobbies=[]:this.initPossibleHobbies(),this.boostManager=new hl(this),this.festivalManager=new Yl(t,this),this.citizenUpdater=new dl(this),this.operatingCost=new Cl(t),"snowWorld"!=t.progress.story.storyName&&"displayCitySnow"!=t.progress.story.storyName||(this.winter=new Ql(t))};(q.CitySimulation=a).__name__="CitySimulation",a.prototype={recalculateOperatingCosts:function(){this.operatingCost.recalculate()},stop:function(){this.pathfinder.terminate()},initPossibleHobbies:function(){this.possibleCitizenHobbies=[{hobbyClass:Nl,minimumCitizenAmount:1},{hobbyClass:zl,minimumCitizenAmount:2},{hobbyClass:jl,minimumCitizenAmount:5},{hobbyClass:Wl,minimumCitizenAmount:6},{hobbyClass:Gl,minimumCitizenAmount:12},{hobbyClass:Hl,minimumCitizenAmount:18},{hobbyClass:Xl,minimumCitizenAmount:24},{hobbyClass:Ul,minimumCitizenAmount:35},{hobbyClass:Ll,minimumCitizenAmount:80}]},update:function(t){var e=((0|this.time.timeSinceStart)/60|0)%24;this.time.update(t),23<=e&&((0|this.time.timeSinceStart)/60|0)%24<1&&this.stats.midnightUpdate(),this.stats.update(t),this.permanentFinder.preUpdate(),this.pathfinder.distributePaths();for(var i=this.flyingSaucers.length;0<=--i;)this.flyingSaucers[i].update(t);for(i=this.trains.length;0<=--i;);for(i=this.citizenSpawners.length;0<=--i;)this.citizenSpawners[i].update(t);if(this.festivalManager.update(t),0<this.citizens.length){if(this.festivalManager.hasFestival()?this.festivalManager.updateFestivalCitizens(t):this.citizenUpdater.update(t),e<12&&12<=((0|this.time.timeSinceStart)/60|0)%24)for(var n=0,r=this.citizens;n<r.length;){var s=r[n];++n,s.midDayUpdate()}for(var o=this.citizens.length,a=Math.ceil(this.infrequentUpdateStart+this.citizens.length/60),l=(i=a<o?a:o,Math.ceil(this.infrequentUpdateStart));--i>=l;)this.citizens[i].infrequentUpdate();this.infrequentUpdateStart+=this.citizens.length/60,this.infrequentUpdateStart>=this.citizens.length&&(this.infrequentUpdateStart=0)}this.fishes.update(t),this.frogs.update(t),this.animals.update(t),this.babyMaker.update(t),this.pathfinder.update(t);for(n=0,r=this.city.permanents;n<r.length;){var h=r[n];++n,h.update(t)}for(n=0,r=this.buildingUpgradesToUpdate;n<r.length;){var u=r[n];++n,u.update(t)}this.boostManager.update(t),this.operatingCost.update(t),null!=this.winter&&this.winter.update(t)},lateUpdate:function(){var t=this.prevTimeMod;this.jobAssigner.assignJobs(),this.schoolAssigner.assignSchools(),this.houseAssigner.assignHouses(),this.happiness.update(t),this.eating.update(t)},updateWhilePaused:function(){this.stats.update(0),this.boostManager.update(0);for(var t=this.prevTimeMod=0,e=this.citizens;t<e.length;){var i=e[t];++t,i.actuallyUpdateDraw()}null!=this.winter&&this.winter.update(0)},recomputeCull:function(){for(var t=0,e=this.citizens;t<e.length;){var i=e[t];++t,i.updateCull()}},createCitizen:function(t,e,i,n){null==e&&(e=0);var r=this;null==n&&(n=null==i?il.getInt(t.rect.width-2):il.getInt(20));var s=new K(this.city,this,this.foregroundStage,this.inBuildingStage,this.inBuildingStageNonParticle,this.adultTextures,this.childrenTextures,t,n,e,i);this.citizens.push(s);function o(t){return r.citizens.length>=t.minimumCitizenAmount}if(0<this.possibleCitizenHobbies.length&&gr.any(this.possibleCitizenHobbies,o)&&("cityofthekey"!=this.city.progress.story.storyName||100<this.citizens.length)){for(var a=[],l=0,h=this.possibleCitizenHobbies;l<h.length;){var u=h[l];++l,o(u)&&a.push(u)}var c=il.fromArray(a);s.setHobby(k.createInstance(c.hobbyClass,[s])),at.remove(this.possibleCitizenHobbies,c)}return s},updatePathfinder:function(t,e){if(this.city.onCityChange(),t){this.pathfinder.invalidateAllPaths();for(var i=0,n=this.citizens;i<n.length;){var r=n[i];if(++i,null!=r.path&&(null==r.pathOnlyRelatedTo||null==e||e==r.pathOnlyRelatedTo)){var s=!1;null==s&&(s=!0),r.recyclePathArray&&(ka.returnToPool(r.path),r.recyclePathArray=!1),r.path=null,r.nextPathPos=-1,r.pathEnd=-1,r.currentPathAction=-2,s&&(r.canViewSelfInBuilding||(r.delayCanViewSelfInBuilding=!0),r.canViewSelfInBuilding=!0),r.verticalPathProgress=0,r.pathEndFunction=null,r.requestingPathGoal=null,r.pathOnlyRelatedTo=null,r.pathWalkSpeed=1,r.pathCanBeReconsidered=!0,0<r.sprite.alpha&&r.sprite.alpha<1&&(r.sprite.alpha=1),r.actuallyUpdateDraw()}}for(i=0,n=this.city.permanents;i<n.length;){var o=n[i];++i,o.invalidatePathfindingRelatedInfo()}this.permanentFinder.invalidatePathfindingRelatedInfo(),this.permanentFinder.requestQueryLimiting(!0)}this.permanentFinder.clearPFCache(),this.city.miscCityElements.onCityChange();for(i=0,n=this.city.permanents;i<n.length;){o=n[i];++i,o.onCityChange()}for(i=0,n=this.city.permanents;i<n.length;){o=n[i];++i,o.onCityChangePost()}for(i=0,n=this.city.worlds;i<n.length;){var a=n[i];++i,a.onCityChange()}for(i=0,n=this.fishes.fishes;i<n.length;){var l=n[i];++i,l.inPermanent!=e&&l.pushBackIntoPermanent()}for(var h=this.animals.animals.length;0<=--h;)this.animals.animals[h].pushBackIntoPermanentOrDestroy();this.pathfinder.sendPathfindingInfo(),this.recalculateOperatingCosts()},handleMouse:function(t){var e=null!=this.city.specialAction&&"FollowCitizenAction"==this.city.specialAction.get_specialActionID();if(this.city.game.keyboard.down[17]||e)switch(t.claimMouse(this,null,!1)._hx_index){case 0:return!0;case 1:var i=null,n=null,r=null,s=null,o=10;this.city.game.isMobile&&(o=25);for(var a=0,l=this.citizens;a<l.length;){var h=l[a];++a;var u=(g=h.getCityPosition()).x+1-t.get_cityX(),c=g.y-3-t.get_cityY();(m=Math.sqrt(u*u+c*c))<o&&(o=m,i=h)}for(a=0,l=this.fishes.fishes;a<l.length;){var d=l[a];++a;u=(g=d.getCityPosition()).x-t.get_cityX(),c=g.y-t.get_cityY();(m=Math.sqrt(u*u+c*c))<o&&(o=m,i=null,n=d)}for(a=0,l=this.frogs.frogs;a<l.length;){var p=l[a];++a;u=(g=p.getCityPosition()).x-t.get_cityX(),c=g.y-t.get_cityY();(m=Math.sqrt(u*u+c*c))<o&&(o=m,i=null,r=p)}for(a=0,l=this.animals.animals;a<l.length;){var f=l[a];++a;var g,m;u=(g=f.getCityPosition()).x-t.get_cityX(),c=g.y-t.get_cityY();(m=Math.sqrt(u*u+c*c))<o&&(o=m,i=null,s=f)}return null!=n?(n.onClick(),this.city.game.audio.playSound(this.city.game.audio.followCitizenSound),null!=this.city.specialAction&&this.city.specialAction.deactivate(!0)):null!=r?(r.onClick(),this.city.game.audio.playSound(this.city.game.audio.followCitizenSound),null!=this.city.specialAction&&this.city.specialAction.deactivate(!0)):null!=s?(s.onClick(),this.city.game.audio.playSound(this.city.game.audio.followCitizenSound),null!=this.city.specialAction&&this.city.specialAction.deactivate(!0)):null!=i&&(i.onClick(),this.city.game.audio.playSound(this.city.game.audio.followCitizenSound),null!=this.city.specialAction&&this.city.specialAction.deactivate(!0)),!0;case 2:return e}return!1},save:function(e){this.time.save(e);var t=this.citizenSpawners.length;if(e.size+4>e.bytes.length){var i=e.bytes,n=new Do(new ArrayBuffer(2*(e.size+4)));e.bytes=n,e.bytes.blit(0,i,0,e.size)}e.bytes.setInt32(e.size,t),e.size+=4,lt.iter(this.citizenSpawners,function(t){t.save(e)}),e.addString(K.saveDefinition);t=this.citizens.length;if(e.size+4>e.bytes.length){i=e.bytes,n=new Do(new ArrayBuffer(2*(e.size+4)));e.bytes=n,e.bytes.blit(0,i,0,e.size)}e.bytes.setInt32(e.size,t),e.size+=4;for(var r=0,s=this.citizens;r<s.length;){var o=s[r];++r;t=o.onWorld.id;if(e.size+4>e.bytes.length){i=e.bytes,n=new Do(new ArrayBuffer(2*(e.size+4)));e.bytes=n,e.bytes.blit(0,i,0,e.size)}e.bytes.setInt32(e.size,t),e.size+=4,o.save(e,!1);var a=null!=o.inPermanent?o.inPermanent.id:-1;if(e.size+4>e.bytes.length){var l=e.bytes,h=new Do(new ArrayBuffer(2*(e.size+4)));e.bytes=h,e.bytes.blit(0,l,0,e.size)}e.bytes.setInt32(e.size,a),e.size+=4;var u=null==o.job?-1:o.job.id;if(e.size+4>e.bytes.length){var c=e.bytes,d=new Do(new ArrayBuffer(2*(e.size+4)));e.bytes=d,e.bytes.blit(0,c,0,e.size)}e.bytes.setInt32(e.size,u),e.size+=4;var p=null==o.home?-1:o.home.id;if(e.size+4>e.bytes.length){var f=e.bytes,g=new Do(new ArrayBuffer(2*(e.size+4)));e.bytes=g,e.bytes.blit(0,f,0,e.size)}e.bytes.setInt32(e.size,p),e.size+=4;var m=null==o.school?-1:o.school.id;if(e.size+4>e.bytes.length){var y=e.bytes,_=new Do(new ArrayBuffer(2*(e.size+4)));e.bytes=_,e.bytes.blit(0,y,0,e.size)}e.bytes.setInt32(e.size,m),e.size+=4}this.happiness.save(e),this.bonuses.save(e),this.jobAssigner.save(e),this.eating.save(e),this.stats.save(e);for(r=0,s=this.citizens.length;r<s;){var v=r++,b=this.citizens[v];if(null!=b.hobby){if(e.size+4>e.bytes.length){i=e.bytes,n=new Do(new ArrayBuffer(2*(e.size+4)));e.bytes=n,e.bytes.blit(0,i,0,e.size)}e.bytes.setInt32(e.size,v),e.size+=4;o=Ko.getClass(b.hobby);e.addString(o.__name__)}}if(e.size+4>e.bytes.length){i=e.bytes,n=new Do(new ArrayBuffer(2*(e.size+4)));e.bytes=n,e.bytes.blit(0,i,0,e.size)}e.bytes.setInt32(e.size,-1),e.size+=4,this.babyMaker.save(e),this.resourcePriorityManager.save(e),this.boostManager.save(e),this.houseAssigner.save(e),this.fishes.save(e),this.frogs.save(e),this.animals.save(e),this.festivalManager.save(e),this.operatingCost.save(e);t=this.rocketsGoingDown.length;if(e.size+4>e.bytes.length){i=e.bytes,n=new Do(new ArrayBuffer(2*(e.size+4)));e.bytes=n,e.bytes.blit(0,i,0,e.size)}e.bytes.setInt32(e.size,t),e.size+=4,this.rockets.save(e)},load:function(t){this.time.load(t);var e=t.bytes.getInt32(t.readStart);t.readStart+=4;for(var i=0,n=e;i<n;){var r=i++;this.citizenSpawners.push(kl.fromLoad(t,this.city.simulation,this.city.farForegroundStage))}var s=t.readString();e=t.bytes.getInt32(t.readStart);t.readStart+=4;for(i=0,n=e;i<n;){var r=i++;e=t.bytes.getInt32(t.readStart);t.readStart+=4;var o=[e],a=null;a=44<=t.version?lt.find(this.city.worlds,function(e){return function(t){return t.id==e[0]}}(o)):this.city.worlds[o[0]];var l=this.createCitizen(a);l.load(t,s);var h=t.bytes.getInt32(t.readStart);t.readStart+=4;var u=h;-1!=u&&(l.inPermanent=this.city.findPermanentByID(u));var c=t.bytes.getInt32(t.readStart);t.readStart+=4;var d=c;-1!=d?(l.job=this.city.findPermanentByID(d),null!=l.job&&l.job.is(ee)?l.job.workers.push(l):(l.job=null,16<l.get_age()&&this.jobAssigner.citizensWithoutJob.push(l))):16<l.get_age()&&this.jobAssigner.citizensWithoutJob.push(l);var p=t.bytes.getInt32(t.readStart);t.readStart+=4;var f=p;-1!=f&&(l.home=this.city.findPermanentByID(f),null!=l.home&&l.home.is(re)?l.home.residents.push(l):l.home=null);var g=t.bytes.getInt32(t.readStart);t.readStart+=4;var m=g;-1!=m&&(l.school=this.city.findPermanentByID(m),null!=l.school&&l.school.is(Ki)?l.school.students.push(l):l.school=null),l.afterLoadingInPermanent()}if(this.jobAssigner.buildingsHaveWork=!0,this.houseAssigner.shouldUpdateHouses=!0,this.schoolAssigner.schoolsShouldBeUpdated=!0,this.happiness.load(t),this.bonuses.load(t),this.jobAssigner.load(t),this.eating.load(t),2<=t.version&&this.stats.load(t),3<=t.version)for(this.initPossibleHobbies();;){e=t.bytes.getInt32(t.readStart);if(t.readStart+=4,-1==(r=e))break;var y=t.readString(),_=[q[y]];this.citizens[r].setHobby(k.createInstance(_[0],[this.citizens[r]])),at.remove(this.possibleCitizenHobbies,lt.find(this.possibleCitizenHobbies,function(e){return function(t){return t.hobbyClass==e[0]}}(_)))}if(9<=t.version&&this.babyMaker.load(t),10<=t.version&&this.resourcePriorityManager.load(t),16<=t.version&&this.boostManager.load(t),17<=t.version&&this.houseAssigner.load(t),19<=t.version&&this.fishes.load(t),45<=t.version&&this.frogs.load(t),52<=t.version&&this.animals.load(t),21<=t.version&&this.festivalManager.load(t),37<=t.version&&this.operatingCost.load(t),49<=t.version){e=t.bytes.getInt32(t.readStart);t.readStart+=4}50<=t.version&&this.rockets.load(t),this.time.lastLoadTime=this.time.timeSinceStart},afterLoad:function(){this.festivalManager.afterLoad()},uncull:function(){for(var t=0,e=this.citizens;t<e.length;){var i=e[t];++t,i.uncull()}},__class__:a};var h=function(t,e){this.skyColors=[{color:2626656,time:0},{color:2626656,time:4},{color:12541833,time:6},{color:12541833,time:6.5},{color:11389183,time:8.5},{color:11389183,time:11},{color:12247804,time:13},{color:12247804,time:17},{color:8872356,time:20.5},{color:8872356,time:21},{color:2626656,time:23},{color:2626656,time:24}],this.lastLoadTime=0,this.minutesPerTick=.5,this.city=t,this.simulation=e,this.timeSinceStart=120};(q.CityTime=h).__name__="CityTime",h.getBasicTimeString=function(t){return 2880<t?Tr.lo("n_days",[Math.floor(t/1440)]):1440<t?Tr.lo("one_day"):60<t?Tr.lo("n_hours",[Math.floor(t/60)]):Tr.lo("one_hour")},h.prototype={update:function(t){this.timeSinceStart+=t*this.minutesPerTick,this.updateSky(),(23<this.timeSinceStart/60%24||this.timeSinceStart/60%24<4)&&this.city.progress.story.get_speedUpStartNights()&&(1+((0|this.timeSinceStart)/1440|0)==1||1+((0|this.timeSinceStart)/1440|0)==2||1+((0|this.timeSinceStart)/1440|0)==3&&this.timeSinceStart/60%24<4?this.timeSinceStart+=t*this.minutesPerTick*2.75:1+((0|this.timeSinceStart)/1440|0)==3?this.timeSinceStart+=t*this.minutesPerTick:1+((0|this.timeSinceStart)/1440|0)==4&&(this.timeSinceStart+=t*this.minutesPerTick*.5))},updateSky:function(){var t=this.getCurrentColor(this.skyColors);null!=t&&this.city.updateSky(t)},getCurrentColor:function(t){for(var e=function(t){return{r:t/65536|0,g:(t/256|0)%256,b:t%256}},i=0,n=t.length;i<n;){var r=i++,s=t[r],o=t[1+r];if(this.timeSinceStart/60%24<o.time){var a=e(s.color),l=e(o.color),h=(this.timeSinceStart/60%24-s.time)/(o.time-s.time),u=a.r,c=a.g,d=a.b;return 256*(u+h*(l.r-u)|0)*256+256*(c+h*(l.g-c)|0)+(d+h*(l.b-d)|0)}}return null},save:function(t,e){null==e&&(e=!0),e&&t.addString(h.saveDefinition);var i=this.timeSinceStart;if(t.size+8>t.bytes.length){var n=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+8))),t.bytes.blit(0,n,0,t.size)}t.bytes.setDouble(t.size,i),t.size+=8},load:function(t,e){null==e&&(e=t.readString());var i=Dr.makeLoadMap(e,t);Object.prototype.hasOwnProperty.call(i.h,"timeSinceStart")&&(this.timeSinceStart=i.h.timeSinceStart)},__class__:h};var l=function(t){this.remZoomScrollBarMovement=0,this.isDraggingViewTwoPointer=!1,this.isDraggingView=!1,this.city=t,this.dragPreviousMousePos=new br(0,0),this.dragDir=new br(0,0),this.dragDirRemaining=new br(0,0),this.dragPointerIdentifiers=[0,1],this.dragPreviousCityPointerPositions=[null,null],this.dragInitialPointerPositions=[null,null]};(q.CityView=l).__name__="CityView",l.prototype={get_game:function(){return this.city.game},handleEarlyMouse:function(t){return!(!t.weakClaimForScroll("doCityViewScroll")||t.disableCityMovement)&&(this.startViewDrag(),!0)},handleMouse:function(t){if((isNaN(this.city.viewPos.x)||isNaN(this.city.viewPos.y))&&(this.city.viewPos.x=0,this.city.viewPos.y=0),!this.isDraggingView&&!t.disableCityMovement){if(t.down)return this.startViewDrag(),!0;if(2<=t.pointerDown.length)return this.startViewDrag(),!0}return!1},handleKeyboardMove:function(t){var e=0,i=0,n=2+12/this.city.zoomScale;this.get_game().keyboard.down[37]&&(e-=n*t),this.get_game().keyboard.down[39]&&(e+=n*t),this.get_game().keyboard.down[38]&&(i-=n*t),this.get_game().keyboard.down[40]&&(i+=n*t),0==e&&0==i||(this.city.viewPos.x+=e,this.city.viewPos.y+=i,this.updateMovingView()),(this.get_game().keyboard.pressed[187]||this.get_game().keyboard.pressed[61])&&this.zoomIn(),(this.get_game().keyboard.pressed[189]||this.get_game().keyboard.pressed[173])&&this.zoomOut()},updateMovingView:function(){var t,e=this.city.getCityEdges(),i=e.minX,n=e.maxX,r=e.minY,s=e.maxY,o=this.city.viewPos.x-this.get_game().addX;(this.city.viewPos.x=(o<i?i:n<o?n:o)+this.get_game().addX,null==this.city.fixViewBottomYOn)?t=((o=this.city.viewPos.y-this.get_game().addY)<r?r:s<o?s:o)+this.get_game().addY:t=this.city.fixViewBottomYOn-(this.get_game().rect.height/2|0)+this.get_game().addY;this.city.viewPos.y=t,this.updateMovingViewStagePosition()},updateMovingViewStagePosition:function(){this.city.viewIsControlled?this.city.movingViewStage.position.set((-this.city.viewPos.x+this.get_game().addX)*this.city.zoomScale+(this.get_game().rect.width/2|0)*this.get_game().scaling,(-this.city.viewPos.y+this.get_game().addY)*this.city.zoomScale+this.get_game().scaling*(this.get_game().rect.height/2|0)):this.city.movingViewStage.position.set(Math.floor((-this.city.viewPos.x+this.get_game().addX)*this.city.zoomScale+(this.get_game().rect.width/2|0)*this.get_game().scaling),Math.floor((-this.city.viewPos.y+this.get_game().addY)*this.city.zoomScale+this.get_game().scaling*(this.get_game().rect.height/2|0)))},handleMouseMovement:function(t){var e=this,i=this.get_game().mouse;if(!this.city.viewIsControlled||2<=i.pointerDown.length){if(i.middlePressed)this.city.viewIsControlled||this.startViewDrag();else if(this.isDraggingView){var n=2<=i.pointerDown.length;if(0!=i.pointerDown.length||i.middleDown||i.down)if(n!=this.isDraggingViewTwoPointer)this.startViewDrag();else if(this.isDraggingViewTwoPointer)if(gr.any(i.pointerDown,function(t){return-1==e.dragPointerIdentifiers.indexOf(t)})||gr.any(this.dragPointerIdentifiers,function(t){return-1==i.pointerDown.indexOf(t)}))this.startViewDrag();else{for(var r=[],s=0,o=this.dragPointerIdentifiers.length;s<o;){var a=s++;r.push(null)}var l=r;for(r=[],s=0,o=this.dragPointerIdentifiers.length;s<o;){a=s++;r.push(null)}var h=r;for(r=0,s=this.dragPointerIdentifiers.length;r<s;){l[a=r++]=i.pointerCityPosition.h[this.dragPointerIdentifiers[a]],h[a]=i.pointerPosition.h[this.dragPointerIdentifiers[a]]}if(-1!=l.indexOf(null))this.startViewDrag();else{var u=gr.sumFPoint(h),c=1/l.length,d=new br(u.x*c,u.y*c),p=(u=gr.sumFPoint(this.dragInitialPointerPositions),c=1/this.dragInitialPointerPositions.length,new br(u.x*c,u.y*c)),f=Math.max(1,gr.sum(h,function(t){return br.distance(d,new br(t.x,t.y))}))/Math.max(1,gr.sum(this.dragInitialPointerPositions,function(t){return br.distance(p,new br(t.x,t.y))}))*this.originalTwoFingerDragZoom,g=this.get_game().scaling/2,m=O.allowMoreZoom?1:2,y=Math.floor(g<1?1:m<g?m:g);m=this.get_game().scaling/2*7;if(this.setZoom(f<y?y:m<f?m:f,i),!this.city.viewIsControlled){for(r=0,s=this.dragPointerIdentifiers.length;r<s;){l[a=r++]=i.pointerCityPosition.h[this.dragPointerIdentifiers[a]]}u=gr.sumFPoint(l),c=1/l.length;var _=u.x*c,v=u.y*c,b=(u=gr.sumFPoint(this.dragPreviousCityPointerPositions),c=1/this.dragPreviousCityPointerPositions.length,u.x*c-_),w=u.y*c-v;this.dragDir.x=.4*this.dragDir.x+.6*b,this.dragDir.y=.4*this.dragDir.y+.6*w;u=this.city.viewPos,f=new br(u.x+b,u.y+w);this.city.viewPos=f,this.updateMovingView()}for(r=0,s=this.dragPointerIdentifiers.length;r<s;){a=r++;this.dragPreviousCityPointerPositions[a]=i.calcCityFPositionForPointer(this.get_game(),this.city,this.dragPointerIdentifiers[a])}}}else{var S;S=!i.down&&0<i.pointerDown.length?i.pointerCityScaledPosition.h[i.pointerDown[0]]:i.cityScaledPosition;b=(u=this.dragPreviousMousePos).x-S.x,w=u.y-S.y;this.dragDir.x=.4*this.dragDir.x+.6*b,this.dragDir.y=.4*this.dragDir.y+.6*w;u=this.city.viewPos,f=new br(u.x+b,u.y+w);this.city.viewPos=f,this.dragPreviousMousePos=S,this.updateMovingView()}else this.isDraggingView=!1,this.isDraggingViewTwoPointer=!1}if(!this.isDraggingView)if(i.pressed||this.dragDir.get_length()<.5)this.dragDir.x=0,this.dragDir.y=0,this.dragDirRemaining.x=0,this.dragDirRemaining.y=0;else{var x=i.isTouch?.933:.8;this.dragDir.x*=x,this.dragDir.y*=x;var T=this.dragDir.x+this.dragDirRemaining.x,I=this.dragDir.y+this.dragDirRemaining.y;this.dragDirRemaining.x+=this.dragDir.x-T,this.dragDirRemaining.y+=this.dragDir.y-I;u=this.city.viewPos,f=new br(u.x+T,u.y+I);this.city.viewPos=f,this.updateMovingView()}}else this.isDraggingView=!1,this.isDraggingViewTwoPointer=!1},startViewDrag:function(){var t=this.get_game().mouse;if(2<=t.pointerDown.length){this.dragPointerIdentifiers=t.pointerDown.slice();for(var e=[],i=0,n=this.dragPointerIdentifiers.length;i<n;){var r=i++;e.push(null)}this.dragPreviousCityPointerPositions=e;for(e=[],i=0,n=this.dragPointerIdentifiers.length;i<n;){r=i++;e.push(null)}this.dragInitialPointerPositions=e;for(e=0,i=this.dragPointerIdentifiers.length;e<i;){r=e++;this.dragPreviousCityPointerPositions[r]=t.pointerCityPosition.h[this.dragPointerIdentifiers[r]],this.dragInitialPointerPositions[r]=t.pointerPosition.h[this.dragPointerIdentifiers[r]]}this.isDraggingViewTwoPointer=!0,this.originalTwoFingerDragZoom=this.city.zoomScale}else!t.down&&0<t.pointerDown.length?this.dragPreviousMousePos=t.pointerCityScaledPosition.h[t.pointerDown[0]]:this.dragPreviousMousePos=t.cityScaledPosition,this.isDraggingViewTwoPointer=!1;this.dragDir=new br(0,0),this.isDraggingView=!0},zoomIn:function(t){this.city.zoomScale<Math.max(7,this.get_game().scaling/2*7)&&this.setZoom(Math.round(this.city.zoomScale+1),t)},zoomOut:function(t){1<this.city.zoomScale&&this.setZoom(Math.max(Math.round(this.city.zoomScale-1),1),t)},setZoom:function(t,e){new br(0,0);null!=e&&this.isDraggingView&&this.isDraggingViewTwoPointer&&vr.mean(e.calcCityPositionForPointer(this.get_game(),this.city,this.dragPointerIdentifiers[0]),e.calcCityPositionForPointer(this.get_game(),this.city,this.dragPointerIdentifiers[1]));this.city.zoomScale;if(this.city.zoomScale=t,this.city.resize(),null!=e)if(this.isDraggingView&&this.isDraggingViewTwoPointer)for(var i=0,n=this.dragPointerIdentifiers.length;i<n;){var r=i++,s=e.pointerCityPosition,o=this.dragPointerIdentifiers[r],a=e.calcCityFPositionForPointer(this.get_game(),this.city,this.dragPointerIdentifiers[r]);s.h[o]=a}else{var l=e.calcCityPosition(this.get_game(),this.city);this.city.viewPos.x+=e.cityPosition.x-l.x,this.city.viewPos.y+=e.cityPosition.y-l.y}this.updateMovingView()},handleScrollbarZoom:function(t){if(!t.isTouch){if(Math.abs(this.remZoomScrollBarMovement)<.75)this.remZoomScrollBarMovement=0;else{var e=this.remZoomScrollBarMovement;this.remZoomScrollBarMovement-=.75*(0<e?1:e<0?-1:0)}this.remZoomScrollBarMovement+=t.scrollBarMovement+t.scrollBarMovementPages*this.get_game().rect.height*this.get_game().scaling,15<=this.remZoomScrollBarMovement?(this.zoomOut(t),this.remZoomScrollBarMovement=0):this.remZoomScrollBarMovement<=-15&&(this.zoomIn(t),this.remZoomScrollBarMovement=0)}},__class__:l};var B=function(){};(q.Config=B).__name__="Config",B.get_enableCrossPromo=function(){return!1},B.get_isCoolMathWithCrossPromotion=function(){return!A.isMobile},B.get_allowUnlimitedResources=function(){return B.hasPremium()},B.earlyInit=function(){B.isSnowThemed=11==(new Date).getMonth()||0==(new Date).getMonth()&&(new Date).getDate()<=3},B.init=function(){0},B.gameInit=function(t){4},B.doPlay=function(){try{parent.cmgGameEvent&&(parent.cmgGameEvent("start"),console.log("FloatingSpaceCities/Config.hx:249:","coolmath: play event"))}catch(t){}},B.showSplashScreen=function(t){null!=t.renderer&&(t.renderer.backgroundColor=2368548),B.splashScreen=new Br(t.stage,"site-specific/coolmath/coolmath-splash.png",800,600,t.width,t.height,150,function(){B.splashScreenDone=!0,(B.splashScreen=null)!=t.renderer&&(t.renderer.backgroundColor=0)})},B.resizeSplash=function(t){null!=B.splashScreen&&B.splashScreen.resize(t.width,t.height)},B.update=function(t){null!=B.splashScreen&&B.splashScreen.update(t)},B.onCitySwitch=function(t){null==t&&(t=!1)},B.waitForInitialization=function(t,e,i){t()},B.handleInput=function(t,e){},B.callLoadStart=function(){0},B.callLoadFinish=function(){0},B.callLoadProgress=function(t){0},B.has=function(t){return!1},B.hasPremium=function(){return!B.isAdsTest&&B.has("premium")},B.canHavePremium=function(){return B.has("premium")},B.hasRemoveAds=function(){return!B.isAdsTest&&B.has("remove_ads")};function c(t,e){this.r=new RegExp(t,e.split("u").join(""))}(q.EReg=c).__name__="EReg",c.prototype={match:function(t){return this.r.global&&(this.r.lastIndex=0),this.r.m=this.r.exec(t),this.r.s=t,null!=this.r.m},matched:function(t){if(null!=this.r.m&&0<=t&&t<this.r.m.length)return this.r.m[t];throw Co.thrown("EReg::matched")},split:function(t){var e="#__delim__#";return t.replace(this.r,e).split(e)},__class__:c};function p(t,e){this.safeAreaTop=0,this.safeAreaBottom=0,this.safeAreaRight=0,this.safeAreaLeft=0,this.guiTimer=0,this.spaceAboveBelowWindow=40,this.windowCanBeClosed=!0,this.windowCapturesAllInput=!1,this.windowReloadOnResize=!1,this.windowShowingBanner=!1,this.windowPosition=fo.Center,this.overlayElements=[],this.notificationPanel=null,this.windowSimpleButtonContainer=null,this.game=t,this.outerStage=e,this.stage=new PIXI.Container,e.addChild(this.stage),this.windowStage=new PIXI.Container,e.addChild(this.windowStage),this.prevWindowStack=[],this.windowStackMeta=[],this.gameHelpStage=new PIXI.Container,e.addChild(this.gameHelpStage),this.tooltipStage=new PIXI.Container,e.addChild(this.tooltipStage),this.notificationStage=new PIXI.Container,e.addChild(this.notificationStage),this.tooltip=new uo(t,null,this.tooltipStage),this.notifications=[],this.computeSafeSpace()}(q.GUI=p).__name__="GUI",p.prototype={get_windowHeight:function(){var t,e=this.game.rect.height;if(this.windowPosition==fo.CenterWithBanner){var i=50/this.game.scaling*this.game.get_pixelRatio(),n=this.safeAreaTop,r=this.safeAreaBottom;t=Math.floor(35+Math.max(i,n<r?r:n))}else{n=this.spaceAboveBelowWindow;var s=this.safeAreaTop,o=s<(r=this.safeAreaBottom)?r:s;t=n<o?o:n}return e-t},get_keyboard:function(){return this.game.keyboard},computeSafeSpace:function(){},update:function(t){this.guiTimer+=t,null!=this.windowOnUpdate&&null!=this.window&&this.windowOnUpdate(t),this.tooltip.update(t);for(var e=0,i=this.overlayElements;e<i.length;){var n=i[e];++e,n.update(t)}this.game.keyboard.anyBack()&&(null==this.window||this.windowCanBeClosed)&&(null!=this.notificationPanel?(this.notificationPanel.destroy(),this.notificationPanel=null):null!=this.window?this.goPreviousWindow():null==window.document.fullscreenElement&&this.onEscapePressWithoutWindow()),null!=this.window&&this.window.update(),this.game.keyboard.down[17]&&this.game.keyboard.pressed[121]&&(this.stage.visible=!this.stage.visible);for(var r=this.notifications.length;0<=--r;)this.notifications[r].update(t);!this.windowShowingBanner||null!=this.window&&this.windowPosition==fo.CenterWithBanner||(pr.hideBanner(),this.windowShowingBanner=!1)},onEscapePressWithoutWindow:function(){},lateUpdate:function(){null!=this.windowOnLateUpdate&&null!=this.window&&this.windowOnLateUpdate()},handleMouse:function(t){return!(null==this.window||!this.window.handleMouse(t))||!!this.windowCapturesAllInput},createWindowInCurrentContext:function(t,e){this.createWindow(t,e)},notify:function(t,e,i){null==i&&(i=600);var n=new co(this.game,this,this.notificationStage,t,e,i);this.notifications.push(n)},createWindow:function(t,e,i,n){null==n&&(n=2),null==i&&(i=40),this.closeWindow(!0),this.spaceAboveBelowWindow=i,this.game.mouse.releaseAllClaims(!0);var r=new Ys(null==e?dt.getTexture("spr_9p_window"):e,1,4,4);this.window=new ps(this,this.windowStage,null,new vr(this.game.rect.width/2|0,this.game.rect.height/2|0),new br(.5,.5),null,r),this.window.direction=Ps.Vertical,this.windowPosition=fo.Center,this.windowScrollableOuter=new fs(500,this.get_windowHeight(),this,this.windowStage,this.window),this.window.addChild(this.windowScrollableOuter),this.windowInner=new ps(this,this.innerWindowStage,this.windowScrollableOuter,new vr(0,0),null,null,null,{top:n,right:n,bottom:n,left:n}),this.windowInner.direction=Ps.Vertical,this.windowScrollableOuter.setInnerContainer(this.windowInner),this.innerWindowStage=this.windowScrollableOuter.scrollable.stage,this.windowRelatedTo=t,this.windowOnLateUpdate=null,this.windowOnUpdate=null,this.windowTitleElem=null,this.windowReloadOnResize=!1,this.windowCapturesAllInput=!1,this.windowIsOnStack=!1,this.windowSimpleButtonContainer=null,this.windowCanBeClosed=!0},windowAllowBanner:function(){pr.canShowBanner()&&(this.setWindowPositioning(fo.CenterWithBanner),pr.showBanner(),this.windowShowingBanner=!0)},addWindowToStack:function(t,e,i){null==i&&(i=""),null==e&&(e=!0),0!=this.prevWindowStack.length&&this.prevWindowStack[this.prevWindowStack.length-1]==t||(this.prevWindowStack.push(t),this.windowStackMeta.push(i)),this.windowIsOnStack=!0},clearWindowStack:function(){this.prevWindowStack=[],this.windowStackMeta=[],this.windowIsOnStack=!1},setWindowReload:function(t){this.windowReload=t},windowAddBottomButtons:function(t,e,i){if(null==e&&(e="lo_close"),"lo_close"==e&&(e=Tr.lo("close")),!p.closeButtonEnabled&&(null==t||0==t.length))return[];var n=new ps(this,this.innerWindowStage,this.windowInner);n.fillSecondarySize=!0,this.windowInner.addChild(n);var r=[];if(null!=t)for(var s=0;s<t.length;){var o=t[s];++s;var a=o.buttonTexture;null==a&&(a="spr_button"),r.push(n.addChild(new oo(this,this.innerWindowStage,n,o.action,o.text,null,o.onHover,a))),n.addChild(new Ms(n,new vr(2,2)))}return n.addChild(new As(n,0)),!p.closeButtonEnabled&&null==i||(null==i&&(i=Uh(this,this.goPreviousWindow)),r.push(n.addChild(new oo(this,this.innerWindowStage,n,i,e)))),r},goPreviousWindow:function(){this.closeWindow(),0<this.prevWindowStack.length&&this.windowIsOnStack&&(this.prevWindowStack.pop(),this.windowStackMeta.pop(),0<this.prevWindowStack.length&&(this.windowStackMeta.pop(),this.prevWindowStack.pop()()))},closeWindow:function(t){null==t&&(t=!1),null!=this.window&&(this.window.destroy(),this.window=null,this.windowRelatedTo=null,this.windowReload=null,this.windowOnLateUpdate=null,this.windowOnUpdate=null,this.windowTitleElem=null,this.windowReloadOnResize=!1,this.windowCapturesAllInput=!1,this.windowSimpleButtonContainer=null,this.windowCanBeClosed=!0,this.spaceAboveBelowWindow=40,null!=this.windowOnDestroy&&this.windowOnDestroy(),this.windowOnDestroy=null)},windowAddTitleText:function(t,e,i,n){null==n&&(n=!0),null==t&&(t="");var r=this;if(null!=this.windowTitleElem)return this.windowTitleElem.setTextAndTextUpdate(t,e),this.windowTitleElem;var s=this.windowStage,o=this.window,a=new Ms(this.windowInner,new vr(0,0));this.windowInner.addChild(a);var l=new Es(this,s,o);l.fillSecondarySize=!0,l.setSizeCallback(function(){a.rect.width=l.rect.width-6,a.updateSize()}),l.addChild(new Ms(l,new vr(3,0))),null!=i&&(this.windowIconSprite=new PIXI.Sprite(i),l.addChild(new Ms(l,new vr(1,0))),l.addChild(new ds(o,this.windowStage,this.windowIconSprite,{top:4,bottom:0,left:0,right:0})),l.addChild(new Ms(l,new vr(2,0))));var h=new ao(l,s,t,e,"Arial16",{left:0,top:3,right:0,bottom:-3},null,!0);if(l.addChild(h),l.addChild(new As(l)),n){var u=new Us(this,s,l,function(){null!=r.window&&r.goPreviousWindow()},dt.getTexture("spr_icon_close"),null,null,null,this.game.isMobile?"spr_button_windowheader_mobi":"spr_button_windowheader",this.game.isMobile?2:1);l.addChild(u)}return o.insertChild(l,0),this.windowTitleElem=h,this.game.isMobile&&(this.windowInner.padding.top=0),h},windowAddInfoText:function(t,e,i){return null==i&&(i="Arial"),null==t&&(t=""),this.windowInner.addChild(new ao(this.windowInner,this.innerWindowStage,t,e,i,null,null,!0))},windowAddInfoTextClickable:function(e,t,i,n){null==n&&(n="Arial"),null==t&&(t="");var r=new ao(this.windowInner,this.innerWindowStage,t,i,n,null,null,!0);return r.handleMouseFunction=function(t){if(r.rect.contains(t.position))switch(t.claimMouse(r)._hx_index){case 0:return!0;case 1:return e(),!0;default:return!1}return!1},this.windowInner.addChild(r)},windowAddSimpleButton:function(t,e,i,n,r){null==r&&(r="Arial"),null==i&&(i=""),null==this.windowSimpleButtonContainer?(this.windowSimpleButtonContainer=new ps(this,this.innerWindowStage,this.windowInner),this.windowInner.addChild(this.windowSimpleButtonContainer),this.windowInner.addChild(new Ms(this.windowInner,new vr(2,4)))):this.windowSimpleButtonContainer.addChild(new Ms(this.windowSimpleButtonContainer,new vr(4,2)));var s=new us(this,this.innerWindowStage,this.windowSimpleButtonContainer,e),o=s.container;o.padding={left:2,right:3,top:2,bottom:-1},o.addChild(new ds(o,this.innerWindowStage,new PIXI.Sprite(t)));var a=new ao(o,this.innerWindowStage,i,n,r,{left:1,top:1,bottom:0,right:0},null,!0);return a.handleMouseFunction=function(t){if(a.rect.contains(t.position))switch(t.claimMouse(a)._hx_index){case 0:return!0;case 1:return e(),!0;default:return!1}return!1},o.addChild(a),this.windowSimpleButtonContainer.addChild(s)},resize:function(){this.outerStage.scale.x=this.outerStage.scale.y=this.game.scaling,null!=this.window&&(this.windowReloadOnResize&&null!=this.windowReload?this.windowReload():(this.updateWindowPosition(),this.windowUpdateSize()))},windowUpdateSize:function(){this.windowScrollableOuter.scrollable.maxHeight=this.get_windowHeight(),this.windowScrollableOuter.maxHeight=this.get_windowHeight(),this.windowScrollableOuter.scrollable.updateSize()},showSimpleWindow:function(t,e,i,n){if(null==n&&(n=!1),null==i&&(i=!1),null==e&&(e=""),null==t&&(t=""),null!=this.window){if(!i)return!1;this.closeWindow()}return n?this.createWindowInCurrentContext():this.createWindow(),""!=e&&this.windowAddTitleText(e),this.windowAddInfoText(t),this.windowAddBottomButtons(),!0},reloadWindow:function(t){if(null==t&&(t=this.windowReload),null!=t){var e=this.windowScrollableOuter.scrollable.scrollPosition,i=new vr(e.x,e.y),n=null,r=null,s=null;this.windowIsOnStack&&1<=this.windowStackMeta.length&&(n=this.prevWindowStack.length,r=this.prevWindowStack.pop(),s=this.windowStackMeta.pop()),t(),this.prevWindowStack.length<n&&(this.prevWindowStack.push(r),this.windowStackMeta.push(s),this.windowIsOnStack=!0),this.windowScrollableOuter.forceSetScrollPosition(i)}},setWindowPositioning:function(t){this.windowPosition=t,this.updateWindowPosition()},updateWindowPosition:function(){var t=this.windowPosition;switch(t._hx_index){case 0:this.window.origin.x=.5,this.window.origin.y=0,this.window.updatePosition(new vr(this.game.rect.width/2|0,10));break;case 1:this.window.origin.x=.5,this.window.origin.y=.5,this.window.updatePosition(new vr(this.game.rect.width/2|0,this.game.rect.height/2|0));break;case 2:var e=t.offsetToTop;this.window.origin.x=.5,this.window.origin.y=.5,this.window.updatePosition(new vr(this.game.rect.width/2|0,(this.game.rect.height/2|0)-e));break;case 3:this.window.origin.x=0,this.window.origin.y=0,this.window.updatePosition(new vr(10,10));break;case 4:this.window.origin.x=.5,this.window.origin.y=.5;e=Math.ceil(25/this.game.scaling*this.game.get_pixelRatio());this.window.updatePosition(new vr(this.game.rect.width/2|0,(this.game.rect.height/2|0)+e)),this.windowUpdateSize()}},onLanguageChange:function(){this.reloadWindow(),null!=this.tooltip&&this.tooltip.destroy(),this.tooltip=new uo(this.game,null,this.tooltipStage)},__class__:p};var g=function(t,e,i,n,r,s,o){this.tempSavedState=null,this.workshopOverlay=null,this.tapToContinue=null,this.gamePausedFor=0,this.isLargeMobile=!1,this.isMobile=!1,this.setOnClickTo=null,this.onClick=null,this.state=null;var a=this;this.application=t,this.stage=e,this.keyboard=new f(this),this.audio=new R(this),this.isMobile=o,this.currentlyPausedForReasons=[],this.resize(i,n,r,s),this.initInteraction(e),o&&(this.mouse.isTouch=!0),this.textHelper=new kr(this),Tr.init(this),g.isLoading||(this.metaGame=new Ha(function(){ra.init(a,function(){pr.prepare(function(){a.createMainMenu()})})}),this.addImportHandler()),B.gameInit(this)};(q.Game=g).__name__="Game",g.prototype={get_preDPIAdjustScaling:function(){return this.scaling/this.application.pixelRatio},get_pixelRatio:function(){return this.application.pixelRatio},createMainMenu:function(t){this.stopState();var e=new M(this,this.stage);null!=t&&e.showError(t),this.state=e,this.afterStateSwitch()},tempSaveState:function(){this.savedStateStages=this.stage.children.slice(),this.tempSavedState=this.state,this.stage.removeChildren(),this.saveStateSpriteCitizens=K.spriteCitizens},destroyTempSaveState:function(){for(var t=0,e=this.savedStateStages;t<e.length;){var i=e[t];++t,i.destroy({children:!0})}this.savedStateStages=null,this.tempSavedState=null,this.saveStateSpriteCitizens=null},restoreState:function(){this.stopState(),K.spriteCitizens=this.saveStateSpriteCitizens;for(var t=0,e=this.savedStateStages;t<e.length;){var i=e[t];++t,this.stage.addChild(i)}this.state=this.tempSavedState,this.state.refocus(),this.state.resize(),this.afterStateSwitch()},switchState:function(t,e){null==e&&(e=!1),e&&this.stopState(),this.state=t,this.afterStateSwitch()},createNewGameState:function(t){var e=this;this.tempSaveState();function i(){e.state=new b(e,e.stage,t),e.afterStateSwitch(),e.mouse.releaseAllClaims(!0)}Object.prototype.hasOwnProperty.call(dt.storiesInfo.h,t)?i():new Ka(t,function(){i()},function(){e.createMainMenu(Tr.lo("game_load_error")),S.sendEvent("game","newGameFailed",null,t),S.sendEventFirebase("newGameFailed","scenario",t)})},newCity:function(e,i,n,r){null==n&&(n=!1);var s=this;this.stopState();function t(){var t=new x(s,s.stage,e,n,i);s.state=t,s.afterStateSwitch(),s.updateCityMousePos(),s.mouse.releaseAllClaims(!0),B.doPlay(),S.sendEvent("game","newGame",null,e),S.sendEventFirebase("newGame","scenario",e),-1==i.indexOf("-")&&Rr.setItem("__meta_mostRecentSubOf_"+i,t.cityFile,function(){}),null!=r&&r(t)}Object.prototype.hasOwnProperty.call(dt.storiesInfo.h,e)?t():new Ka(e,function(){t()},function(){s.createMainMenu(Tr.lo("game_load_error")),S.sendEvent("game","newGameFailed",null,e),S.sendEventFirebase("newGameFailed","scenario",e)}),B.onCitySwitch()},loadFromString:function(t,e){try{var i=Fr.fromBase64(t);this.load(i,e),Rr.setItem("__meta_mostRecentSubOf_"+e,e,function(){})}catch(t){this.createMainMenu(Tr.lo("game_import_error"))}},loadFromTypedArray:function(t,e,i){var n=Fr.fromData(t);this.load(n,e,i)},loadFromStorage:function(i,n,t){null==t&&(t=!1);var r=this;this.stopState();function s(i){Rr.getItem(i,function(t,e){null==t&&null!=e?r.loadFromTypedArray(e,i,n):(console.log("FloatingSpaceCities/Game.hx:293:",t),r.createMainMenu(Tr.lo("game_load_save_error")+Y.string(t.code)))},!0)}t?s(i):Rr.getItem("__meta_mostRecentSubOf_"+i,function(t,e){null==t&&null!=e&&""!=e||(e=i),"PARTIALLY_OVERWRITTEN"==e&&(e=i,console.log("FloatingSpaceCities/Game.hx:307:","this file has been partially overwritten, may be problematic sometimes...")),s(e)})},loadMultiFromString:function(t,e){for(var i=this,n=t.split(":"),r=1,s=Y.parseInt(n[r++]),o=n[r++],a=n[r++],l=0,h=Fr.fromBase64(a),u=0,c=s;u<c;){u++;var d=n[r++],p=n[r++],f=Fr.fromBase64(p).getData();Rr.setItem(e+d,f,function(){if(s<(l+=1))try{i.load(h,e+o,function(t){t.cityMainFile=e,Rr.setItem("__meta_mostRecentSubOf_"+e,t.cityFile,function(){})})}catch(t){i.createMainMenu(Tr.lo("game_import_error"))}}),Rr.setItem(e+d+"__meta","(recently imported)",function(){})}try{var g=h.getData();Rr.setItem(e+o,g,function(){s<(l+=1)&&i.load(h,e+o,function(t){t.cityMainFile=e})})}catch(u){this.createMainMenu(Tr.lo("game_import_error"))}},createSubCity:function(e,i){var n=this,r=null,s=null;null!=e&&(r=e.progress.unlocks.saveForCitySwitch(),s=e.upgrades.saveForCitySwitch(),e.subCities.push(i),e.saveToBrowserStorage()),this.newCity(i,e.cityMainFile+"-"+i,null,function(t){t.cityMainFile=e.cityMainFile,t.subCities=e.subCities,t.refreshPossibleSubCities(),t.progress.allCitiesInfo=e.progress.allCitiesInfo,(t.progress.allCitiesInfo.city=t).progress.allCitiesInfo.update(),null!=r&&(t.progress.unlocks.restoreFromCitySwitch(r),t.upgrades.loadFromCitySwitch(s)),t.gui.simulationSpeedChosen=e.gui.simulationSpeedChosen,t.simulationSpeed=os.simulationSpeeds[e.gui.simulationSpeedChosen].speed,t.gui.gameSpeedButton.imageSprite.texture=os.simulationSpeeds[e.gui.simulationSpeedChosen].icon,n.updateCityMousePos(),t.saveToBrowserStorage(null,function(){Rr.setItem("__meta_mostRecentSubOf_"+e.cityMainFile,e.cityMainFile+"-"+i,function(){})}),t.gui.refreshCityInfo()})},loadSubCity:function(e,i,n){var r=this,s=null,o=null;null!=e&&(s=e.progress.unlocks.saveForCitySwitch(),o=e.upgrades.saveForCitySwitch()),this.loadFromStorage(""==n?i:i+"-"+n,function(t){null!=s&&(t.cityMainFile=e.cityMainFile,t.cityFile=""==n?i:i+"-"+n,t.gui.simulationSpeedChosen=e.gui.simulationSpeedChosen,t.simulationSpeed=os.simulationSpeeds[e.gui.simulationSpeedChosen].speed,t.gui.gameSpeedButton.imageSprite.texture=os.simulationSpeeds[e.gui.simulationSpeedChosen].icon,t.progress.unlocks.restoreFromCitySwitch(s),t.upgrades.loadFromCitySwitch(o),t.subCities=e.subCities,t.refreshPossibleSubCities(),t.progress.allCitiesInfo=e.progress.allCitiesInfo,(t.progress.allCitiesInfo.city=t).progress.allCitiesInfo.update(),t.progress.allCitiesInfo.doTransfer(),r.updateCityMousePos(),Rr.setItem("__meta_mostRecentSubOf_"+e.cityMainFile,t.cityFile,function(){}))},!0)},updateCityMousePos:function(){if(this.state instanceof x){var t=this.state;this.mouse.cityScaledPosition=new br(this.mouse.unscaledPosition.x/t.zoomScale,this.mouse.unscaledPosition.y/t.zoomScale),this.mouse.cityPosition=this.mouse.calcCityPosition(this,t)}},load:function(e,i,n){var r=this;this.stopState();var s="theLostShip";g.isLoading=!0;function t(){if(57<e.bytes.getInt32(e.readStart))r.createMainMenu(Tr.lo("game_load_save_error_version"));else{r.newCity(s,i);var t=r.state;t.load(e),-1==i.indexOf("-")&&(t.cityMainFile=i),r.updateCityMousePos(),g.isLoading=!1,null!=n&&n(t)}}if(-1234==e.bytes.getInt32(e.readStart)){e.bytes.getInt32(e.readStart);e.readStart+=4,s=e.readString(),Object.prototype.hasOwnProperty.call(dt.storiesInfo.h,s)?t():new Ka(s,function(){t()},function(){r.createMainMenu(Tr.lo("game_load_error"))})}else t()},resize:function(t,e,i,n){this.rect=t,this.addX=e,this.addY=i,this.scaling=n;this.stage.hitArea=new PIXI.Rectangle(0,0,1/0,1/0),this.stage.interactiveChildren=!1,null!=this.state&&this.state.resize()},update:function(t){this.mouseBeginStep(),this.mouse.timeMod=t,this.keyboard.update(),jsFunctions.crossPromoIsVisible()&&this.keyboard.anyBack()&&(jsFunctions.crossPromoClose(),this.keyboard.pressed[27]=!1),null!=this.workshopOverlay&&this.workshopOverlay.isOpen()&&this.keyboard.anyBack()&&(this.keyboard.pressed[27]=!1),B.handleInput(this.mouse,this.keyboard),this.mouse.preHandling(),(this.setOnClickTo=null)==this.state||this.isMobile&&this.mouse.hasStrongClaim&&null!=this.mouse.strongClaimOnUpdate||this.state.handleMouse(this.mouse),this.onClick=this.setOnClickTo,this.mouse.afterHandling(),null!=this.state&&-1==this.currentlyPausedForReasons.indexOf("WaitAndShowAd")&&this.state.update(t),this.updateForceUnpause(t),O.update(this),B.mobileTrailerMode&&this.keyboard.down[17]&&this.keyboard.pressed[116]&&(B.mobileTrailerModeMultiplier+=.5,3<B.mobileTrailerModeMultiplier&&(B.mobileTrailerModeMultiplier=2),this.application.setGameScale()),this.mouseEndStep(t),this.keyboard.postUpdate(),S.update(t),oa.generalUpdate(t),Cr.update(t),null!=this.waitAndShowAdInstance&&this.waitAndShowAdInstance.update(t)},waitAndShowAd:function(t,e){new oa(this,this.stage,t).useIfPossible(e)},updateForceUnpause:function(t){this.gamePausedFor=0,null!=this.tapToContinue&&null!=this.tapToContinue.parent&&(this.tapToContinue.destroy(),this.tapToContinue=null)},postDraw:function(){null!=this.state&&this.state.postDraw()},mouseBeginStep:function(){var t=this.mouse.nextStepReleased;this.mouse.nextStepReleased&&(this.mouse.down=!1,this.mouse.nextStepReleased=!1,this.mouse.released=!0),this.mouse.nextStepQuietReleased&&(this.mouse.down=!1,this.mouse.nextStepQuietReleased=!1,this.mouse.released=!1,this.mouse.releaseAllClaims(!0)),this.mouse.nextStepDown&&(t||(this.mouse.down=!0),this.mouse.pressed=!0,this.mouse.nextStepDown=!1);t=this.mouse.nextStepRightReleased;this.mouse.nextStepRightReleased&&(this.mouse.rightDown=!1,this.mouse.nextStepRightReleased=!1,this.mouse.rightReleased=!0),this.mouse.nextStepRightDown&&(t||(this.mouse.rightDown=!0),this.mouse.rightPressed=!0,this.mouse.nextStepRightDown=!1);t=this.mouse.nextStepMiddleReleased;this.mouse.nextStepMiddleReleased&&(this.mouse.middleDown=!1,this.mouse.nextStepMiddleReleased=!1,this.mouse.middleReleased=!0),this.mouse.nextStepMiddleDown&&(t||(this.mouse.middleDown=!0),this.mouse.middlePressed=!0,this.mouse.nextStepMiddleDown=!1),this.mouse.scrollBarMovement=this.mouse.scrollBarNextMovement,this.mouse.scrollBarMovementPages=this.mouse.scrollBarNextMovementPages,this.mouse.scrollBarNextMovementPages=0,this.mouse.scrollBarNextMovement=0,!this.isMobile||this.mouse.down||this.mouse.released||0!=this.mouse.pointerDown.length||null==this.state||this.state.get_publicGUI().tooltip.shown()||(this.mouse.position=new vr(-1e5,-1e5),this.mouse.unscaledPosition=new vr(-1e5,-1e5),this.mouse.cityScaledPosition=new br(-1e5,-1e5),this.mouse.cityPosition=new vr(-1e5,-1e5)),null==this.mouse.prevPosition||this.mouse.position.x==this.mouse.prevPosition.x&&this.mouse.position.y==this.mouse.prevPosition.y?this.mouse.moved=!1:this.mouse.moved=!0},mouseEndStep:function(t){this.mouse.pressed=!1,this.mouse.released=!1,this.mouse.rightPressed=!1,this.mouse.rightReleased=!1,this.mouse.middlePressed=!1,this.mouse.middleReleased=!1,0<this.mouse.mouseDownTick&&(this.mouse.mouseDownTick-=t);var e=this.mouse.position,i=new vr(e.x,e.y);this.mouse.prevPosition=i;e=this.mouse.cityPosition,i=new vr(e.x,e.y);this.mouse.prevCityPosition=i},initInteraction:function(o){function t(t){var e=t.data.originalEvent;if(h.isMobile||"touch"==e.pointerType)1==h.mouse.pointerDown.length&&(h.mouse.down||h.mouse.nextStepDown)&&(h.mouse.nextStepReleased=!0),at.remove(h.mouse.pointerDown,t.data.identifier),h.mouse.pointerUnscaledPosition.remove(t.data.identifier);else{var i=t.data.originalEvent.button;null==i&&(i=0),1==i?h.mouse.nextStepMiddleReleased=!0:2==i?h.mouse.nextStepRightReleased=!0:0==i&&(h.mouse.nextStepReleased=!0)}}function a(t){if(null==h.workshopOverlay||!h.workshopOverlay.isOpen()){h.mouse.unscaledPosition=t;var e=h.scaling,i=new vr(t.x/e|0,t.y/e|0);if(h.mouse.position=i,h.state instanceof x){var n=h.state;h.mouse.cityScaledPosition=new br(t.x/n.zoomScale,t.y/n.zoomScale),h.mouse.cityPosition=h.mouse.calcCityPosition(h,n)}}}function l(t,e){h.mouse.pointerUnscaledPosition.h[e]=t;var i=h.mouse.pointerPosition,n=h.scaling,r=new vr(t.x/n|0,t.y/n|0);if(i.h[e]=r,h.state instanceof x){var s=h.state;i=h.mouse.pointerCityScaledPosition,r=new br(t.x/s.zoomScale,t.y/s.zoomScale);i.h[e]=r;i=h.mouse.pointerCityPosition,r=h.mouse.calcCityFPositionForPointer(h,s,e);i.h[e]=r}}var h=this;this.mouse=new v,o.interactive=!0,o.on("pointermove",function(t){var e=t.data.originalEvent;if(h.isMobile||"touch"==e.pointerType){var i=l,n=t.data.getLocalPosition(o);i(new vr(Math.floor(n.x),Math.floor(n.y)),t.data.identifier)}var r=a;n=t.data.getLocalPosition(o);r(new vr(Math.floor(n.x),Math.floor(n.y)));var s=t.data.originalEvent.buttons;null!=s&&"number"==typeof s&&(0|s)===s&&(1!=(1&s)&&h.mouse.down&&(h.mouse.nextStepReleased=!0),2!=(2&s)&&h.mouse.rightDown&&(h.mouse.nextStepRightReleased=!0),4!=(4&s)&&h.mouse.middleDown&&(h.mouse.nextStepMiddleReleased=!0))}),this.isMobile&&o.on("touchend",function(t){null!=h.onClick?h.onClick():h.mouse.isTouch&&(h.rect.width<500||h.rect.height<230)&&!jsFunctions.isAnyApple()&&jsFunctions.goFullscreen(!1,function(){h.mouse.nextStepReleased=!0})}),this.isMobile&&!B.mobileTrailerMode||o.on("click",function(t){null!=h.onClick&&h.onClick()}),o.on("pointerdown",function(t){var e=t.data.originalEvent;if(h.isMobile||"touch"==e.pointerType){if(-1==h.mouse.pointerDown.indexOf(t.data.identifier)){h.mouse.pointerDown.push(t.data.identifier);var i=l,n=t.data.getLocalPosition(o);if(i(new vr(Math.floor(n.x),Math.floor(n.y)),t.data.identifier),1==h.mouse.pointerDown.length){var r=a;n=t.data.getLocalPosition(o);r(new vr(Math.floor(n.x),Math.floor(n.y))),h.mouse.nextStepDown=!0,h.mouse.nextStepReleased=!1}else h.mouse.down&&(h.mouse.nextStepQuietReleased=!0),h.mouse.nextStepDown=!1,h.mouse.nextStepReleased=!1}}else{r=a,n=t.data.getLocalPosition(o);r(new vr(Math.floor(n.x),Math.floor(n.y)));var s=e.button;null==s&&(s=0),1==s?(h.mouse.nextStepMiddleDown=!0,h.mouse.nextStepMiddleReleased=!1,t.data.originalEvent.preventDefault()):2==s?(h.mouse.nextStepRightReleased=!1,h.mouse.nextStepRightDown=!0):0==s&&(h.mouse.nextStepDown=!0,h.mouse.nextStepReleased=!1)}}),window.document.addEventListener("mousedown",function(t){1==t.button&&t.preventDefault()},jsFunctions.getPassiveEventListenerVar()),window.document.addEventListener("dragstart",function(t){return t.preventDefault(),!1}),o.on("pointerup",t),o.on("pointerupoutside",t),o.on("pointercancel",function(t){var e=t.data.originalEvent;!h.isMobile&&"touch"!=e.pointerType||((h.mouse.down||h.mouse.nextStepDown)&&1==h.mouse.pointerDown.length&&(h.mouse.nextStepReleased=!0),at.remove(h.mouse.pointerDown,t.data.identifier),h.mouse.pointerUnscaledPosition.remove(t.data.identifier))}),window.addEventListener("wheel",function(t){switch(t.deltaMode){case 0:h.mouse.scrollBarNextMovement+=t.deltaY/h.scaling;break;case 1:h.mouse.scrollBarNextMovement+=10*t.deltaY;break;case 2:h.mouse.scrollBarNextMovementPages+=t.deltaY}t.preventDefault()},jsFunctions.getPassiveEventListenerVar())},refocus:function(){null!=this.state&&this.state.refocus(),this.mouse.pointerDown.splice(0,this.mouse.pointerDown.length),this.mouse.pointerUnscaledPosition=new Wo,this.mouse.releaseAllClaims(!0),this.mouse.down=!1,this.mouse.middleDown=!1,this.mouse.rightDown=!1},addImportHandler:function(i){var n=this,r=window.document.getElementById("importFile");r.addEventListener("change",function(){var t=r.files[0],e=Sr.getFileReader();e.addEventListener("load",function(t){var e=t.target.result;eo.createSaveWindow(n,n.state.get_publicGUI(),Tr.lo("save_slot_import"),function(t){C.startsWith(e,"THEFINALEARTH2_CITYPACK")?n.loadMultiFromString(e,t):n.loadFromString(e,t)},function(){null!=i&&i()}),r.value=""}),e.readAsText(t)}),r.addEventListener("click",function(){})},stopState:function(){if(null!=this.state){this.state.stop();for(var t=0,e=this.stage.children;t<e.length;){var i=e[t];++t,i.destroy({children:!0})}this.stage.removeChildren(),K.spriteCitizens=new jo}this.state=null},pause:function(t){0==this.currentlyPausedForReasons.length&&this.actuallyPauseState(),-1==this.currentlyPausedForReasons.indexOf(t)&&this.currentlyPausedForReasons.push(t)},pauseCityForBlurIfDesired:function(){},actuallyPauseState:function(){null!=this.state&&this.state.pause(),this.audio.pauseMusic()},resume:function(t){return 0!=this.currentlyPausedForReasons.length&&(at.remove(this.currentlyPausedForReasons,t),0==this.currentlyPausedForReasons.length&&(null!=this.state&&this.state.resume(),this.audio.resumeMusic(),!0))},afterStateSwitch:function(){0<this.currentlyPausedForReasons.length&&this.actuallyPauseState()},onContextRestored:function(){null!=this.state&&this.state.onContextRestored(),null!=this.tempSavedState&&this.tempSavedState.onContextRestored()},__class__:g};function o(t,e,i){this.finalizedLoad=!1,this.hasError=!1;var p=this;O.load(i),B.callLoadStart(),null!=window.removeLoadingExplainer&&window.removeLoadingExplainer(),this.loader=new PIXI.Loader,this.loadingGraphics=new PIXI.Graphics,e.addChild(this.loadingGraphics);var f="?cache=20221005155535";this.loader.add("sprites.json"+f),this.loader.add("fonts/standard.fnt"+f),this.loader.add("fonts/standard10.fnt"+f),this.loader.add("fonts/standard16.fnt"+f),this.loader.add("fonts/standard15.fnt"+f),this.loader.add("fonts/standard18.fnt"+f),this.loader.add("buildinginfo.json"+f),this.loader.add("buildingUpgradesInfo.json"+f),this.loader.add("buildingCategoriesInfo.json"+f),this.loader.add("decorationsInfo.json"+f),this.loader.add("buildableWorldResourcesInfo.json"+f),this.loader.add("cityUpgradesInfo.json"+f),this.loader.add("policiesInfo.json"+f),this.loader.add("stories.json"+f),this.loader.add("js/pathfinder.js"+f),B.canHavePremium()&&this.loader.add("bridgesInfo.json"+f);var g=Object.create(null);g[n="stories/theLostShip.json"]="theLostShip",p.loader.add(n);var n,r=B.isSnowThemed?"displayCitySnow":"displayCity";g[n="stories/"+r+".json"]=r,p.loader.add(n),this.loader.use(function(t,e){if(t.error){if(console.log("FloatingSpaceCities/GameLoader.hx:69:",t.error),!p.hasError){var i="Unfortunately, something went wrong while loading the game. Please check your internet connection and reload the page. If your internet connection is working fine, please report the technical details below. Technical details:\n"+Y.string(t.error);window.alert(Y.string(i))}p.hasError=!0}else{if(t.name=="buildingUpgradesInfo.json"+f){dt.buildingUpgradesInfo=new Vo;for(var n=t.data,r=0;r<n.length;){var s=n[r];++r,dt.buildingUpgradesInfo.h["buildingUpgrades."+s.className]=s}}else if(t.name=="buildinginfo.json"+f){dt.buildingInfo=new Vo,dt.buildingInfoArray=t.data;r=0;for(var o=dt.buildingInfoArray;r<o.length;){var a=o[r];++r,dt.buildingInfo.h["buildings."+a.className]=a}}else if(t.name=="buildableWorldResourcesInfo.json"+f)dt.worldResourcesInfo=t.data;else if(t.name=="buildingCategoriesInfo.json"+f)dt.buildingCategoriesInfo=t.data;else if(t.name=="decorationsInfo.json"+f)dt.decorationsInfo=t.data;else if(t.name=="bridgesInfo.json"+f)dt.bridgesInfo=t.data;else if(t.name=="cityUpgradesInfo.json"+f){dt.cityUpgradesInfo=new Vo;var l=t.data;for(r=0;r<l.length;){var h=l[r];++r,dt.cityUpgradesInfo.h["cityUpgrades."+h.className]=h}}else if(t.name=="policiesInfo.json"+f){dt.policiesInfo=new Vo;var u=t.data;for(r=0;r<u.length;){var c=u[r];++r,dt.policiesInfo.h["policies."+c.className]=c}}else if(t.name=="stories.json"+f)dt.allStoriesInfo=t.data;else if(t.name=="js/pathfinder.js"+f)dt.pathfinderCodeUrl=URL.createObjectURL(new Blob([t.data]));else if(Object.prototype.hasOwnProperty.call(g,t.name)){var d=g[t.name];i=t.data;dt.storiesInfo.h[d]=i}else"shader.glsl"==t.name&&(dt.shader=new PIXI.Filter("",t.data));e()}}),this.loader.load(function(){jsFunctions.fontsPrepareVietnamese(),p.resourcesLoaded=!0,O.settingsLoaded&&B.splashScreenDone&&p.postLoad()}),this.loaderThen=t}(q.GameLoader=o).__name__="GameLoader",o.prototype={postLoad:function(){this.finalizedLoad=!0,B.callLoadFinish(),null!=window.removeLoadingExplainer&&window.removeLoadingExplainer(),this.loadOptionals(),Tr.translateFiles(),this.loaderThen(),this.loadingGraphics.destroy()},loadOptionals:function(){var t=new PIXI.Loader;t.add("citizenNames.txt"),t.use(function(t,e){if(t.error)console.log("FloatingSpaceCities/GameLoader.hx:166:","error loading optionals");else{if("citizenNames.txt"==t.name){var i=t.data,n=i.split("\r\n");1==n.length&&(n=i.split("\n")),n.splice(0,1+n.indexOf("START")),dt.citizenNames=n}e()}}),t.load(function(){})},update:function(t,e){if(B.splashScreenDone){this.loadingGraphics.scale.x=this.loadingGraphics.scale.y=e,B.callLoadProgress(this.loader.progress/100);var i=t.width/3|0,n=i<100?i:100,r=2*n;if(this.resourcesLoaded)this.loadingGraphics.clear();else{var s=this.hasError?6303792:6316128,o=this.loadingGraphics.clear().beginFill(s),a=(s=t.get_center().x-n,t.get_center().y-5),l=this.hasError?16711680:16777215;o.drawRect(s,a,r,10).endFill().beginFill(l).drawRect(t.get_center().x-n,t.get_center().y-5,r*(this.loader.progress/100),10).endFill()}}this.resourcesLoaded&&!this.finalizedLoad&&O.settingsLoaded&&B.splashScreenDone&&this.postLoad()},__class__:o};var at=function(){};(q.HxOverrides=at).__name__="HxOverrides",at.strDate=function(t){switch(t.length){case 8:var e=t.split(":"),i=new Date;return i.setTime(0),i.setUTCHours(e[0]),i.setUTCMinutes(e[1]),i.setUTCSeconds(e[2]),i;case 10:e=t.split("-");return new Date(e[0],e[1]-1,e[2],0,0,0);case 19:var n=(e=t.split(" "))[0].split("-"),r=e[1].split(":");return new Date(n[0],n[1]-1,n[2],r[0],r[1],r[2]);default:throw Co.thrown("Invalid date format : "+t)}},at.cca=function(t,e){var i=t.charCodeAt(e);if(i==i)return i},at.substr=function(t,e,i){if(null==i)i=t.length;else if(i<0){if(0!=e)return"";i=t.length+i}return t.substr(e,i)},at.remove=function(t,e){var i=t.indexOf(e);return-1!=i&&(t.splice(i,1),!0)},at.now=function(){return Date.now()};var f=function(t){this.inputs=[];for(var i=this,e=[],n=0;n<256;){n++;e.push(!1)}this.nextPressed=e;for(e=[],n=0;n<256;){n++;e.push(!1)}this.nextDown=e;for(e=[],n=0;n<256;){n++;e.push(!1)}this.pressed=e;for(e=[],n=0;n<256;){n++;e.push(!1)}this.down=e,f.mobileBackPressed=!1,window.addEventListener("keydown",function(t){var e=t.keyCode;gr.any(i.inputs,function(t){return t==window.document.activeElement})&&27!=e||(null!=t.key&&("Delete"==t.key&&(e=46),"Control"==t.key&&(e=17)),e<256&&(i.nextDown[e]||(i.nextPressed[e]=!0,i.nextDown[e]=!0)),t.preventDefault())},jsFunctions.getPassiveEventListenerVar()),window.addEventListener("keyup",function(t){var e=t.keyCode;e<256&&(i.nextDown[e]=!1),122==e&&jsFunctions.goFullscreen(!0),t.preventDefault()},jsFunctions.getPassiveEventListenerVar()),window.document.addEventListener("visibilitychange",function(){if("hidden"==window.document.visibilityState)for(var t=0;t<256;){var e=t++;i.nextDown[e]=!1}}),window.addEventListener("focus",function(){for(var t=0;t<256;){var e=t++;i.nextDown[e]=!1}f.mobileBackPressed=!1},!1),window.addEventListener("blur",function(){for(var t=0;t<256;){var e=t++;i.nextDown[e]=!1}f.mobileBackPressed=!1},!1)};(q.Keyboard=f).__name__="Keyboard",f.getLetterCode=function(t){var e=at.cca(t,0);return 97<=e&&e<=122&&(e-=32),e},f.prototype={anyKey:function(){for(var t=0;t<256;){var e=t++;if(this.pressed[e])return!0}return!1},anyBack:function(){return!!this.pressed[27]||f.mobileBackPressed},update:function(){for(var t=0;t<256;){var e=t++;this.nextDown[e]?this.down[e]=!0:this.down[e]=!1,this.nextPressed[e]&&(this.pressed[e]=!0,this.nextPressed[e]=!1)}},postUpdate:function(){for(var t=0;t<256;){var e=t++;this.pressed[e]=!1}f.mobileBackPressed=!1},__class__:f};var lt=function(){};(q.Lambda=lt).__name__="Lambda",lt.array=function(t){for(var e=[],i=Lh(t);i.hasNext();){var n=i.next();e.push(n)}return e},lt.exists=function(t,e){for(var i=Lh(t);i.hasNext();){if(e(i.next()))return!0}return!1},lt.iter=function(t,e){for(var i=Lh(t);i.hasNext();){e(i.next())}},lt.count=function(t,e){var i=0;if(null==e)for(var n=Lh(t);n.hasNext();){n.next();++i}else for(var r=Lh(t);r.hasNext();){e(r.next())&&++i}return i},lt.find=function(t,e){for(var i=Lh(t);i.hasNext();){var n=i.next();if(e(n))return n}return null};function m(){this._animationFrameId=null,this.pixelRatio=1,this.autoResize=!0,this.transparent=!1,this.antialias=!1,this.forceFXAA=!1,this.roundPixels=!1,this.clearBeforeRender=!0,this.preserveDrawingBuffer=!1,this.backgroundColor=16777215,this.width=Math.max(window.innerWidth*this.pixelRatio,3*this.pixelRatio),this.height=Math.max(window.innerHeight*this.pixelRatio,3*this.pixelRatio),this.position="static"}(q["common.PixiApplication"]=m).__name__="common.PixiApplication",m.prototype={start:function(t,e,i){if(null==t&&(t="auto"),null==i){this.canvas=window.document.createElement("canvas");var n=Y.string(window.innerWidth);this.canvas.style.width=n+"px";n=Y.string(window.innerHeight);this.canvas.style.height=n+"px",this.canvas.style.position=this.position}else this.canvas=i;window.onresize=Uh(this,this._onWindowResize);var r={};r.width=this.width,r.height=this.height,r.view=this.canvas,r.backgroundColor=this.backgroundColor,r.resolution=1,r.antialias=this.antialias,r.forceFXAA=this.forceFXAA,r.autoResize=this.autoResize,r.clearBeforeRender=this.clearBeforeRender,r.preserveDrawingBuffer=this.preserveDrawingBuffer,r.roundPixels=this.roundPixels,r.powerPreference="high-performance",r.legacy=this.useLegacyRenderer,null==t||"canvas"==t&&(r.noWebGL=!0,r.forceCanvas=!0),this.app=new PIXI.Application(r),this.stage=this.app.stage,this.renderer=this.app.renderer,null==e?window.document.body.appendChild(this.app.view):e.appendChild(this.app.view),this.app.ticker.add(Uh(this,this._onRequestAnimationFrame))},addPostDraw:function(t){Uh(N=this.app.ticker,N.add)(t,null,-100)},_onWindowResize:function(t){var e=window.innerWidth,i=window.innerHeight;this.width=Math.max(e*this.pixelRatio,3*this.pixelRatio),this.height=Math.max(i*this.pixelRatio,3*this.pixelRatio),this.app.renderer.resize(this.width,this.height),this.canvas.style.width=e+"px",this.canvas.style.height=i+"px",jsFunctions.isAnyApple()&&window.scrollTo(0,0),null!=this.onResize&&this.onResize()},_onRequestAnimationFrame:function(){null!=this.onUpdate&&this.onUpdate(this.app.ticker.deltaTime)},__class__:m};var A=function(){this.knownInnerW=-1,this.knownInnerH=-1,this.rotationAsker=null,this.askForRotation=!1,this.setScalingIn=-1,this.scaling=1,this.maxScaling=2;var t=this;A.isMobile=B.canBeMobile&&(B.forceMobile||jsFunctions.isAnyMobile()),m.call(this),B.waitForInitialization(function(){t.init()},function(){null!=t.game&&t.game.pause("ConfigBasedPause")},function(){null!=t.game&&t.game.resume("ConfigBasedPause")})};(q.Main=A).__name__="Main",A.main=function(){new A},A.__super__=m,A.prototype=e(m.prototype,{init:function(){var e=this;if(B.checkSitelock()){this.autoResize=!1,this.onUpdate=Uh(this,this.update),window.addEventListener("resize",Uh(this,this.setGameScaleSoon)),this.backgroundColor=0,this.pixelRatio=1,A.isMobile&&(this.pixelRatio=window.devicePixelRatio),(null==this.pixelRatio||this.pixelRatio<=0)&&(this.pixelRatio=1),this.knownInnerH=window.innerHeight,this.knownInnerW=window.innerWidth;var t=window.innerWidth,i=window.innerHeight;this.width=Math.max(t*this.pixelRatio,3*this.pixelRatio),this.height=Math.max(i*this.pixelRatio,3*this.pixelRatio),B.earlyInit();try{this.preserveDrawingBuffer=jsFunctions.maliDetect()}catch(t){var n=Co.caught(t);console.log("FloatingSpaceCities/Main.hx:93:",n)}this.transparent=!0,PIXI.settings.SCALE_MODE=PIXI.SCALE_MODES.NEAREST,this.initConfig();m.prototype.start.call(this,"auto"),this.setGameScale(),this.loader=new o(function(){e.loader.update(e.gameRect,e.scaling),e.loader=null;var t=e.stage.addChild(new PIXI.Container);e.game=new g(e,t,e.gameRect,e.addX,e.addY,e.scaling,A.isMobile),e.game.isLargeMobile=e.game.isMobile&&A.isLargeMobile,e.askForRotation&&null==e.rotationAsker&&(e.rotationAsker=new Ar(e.stage),e.game.pause("pleaseRotateFirst"))},this.stage,this),A.isCanvasRenderer=this.renderer.type==PIXI.RENDERER_TYPE.CANVAS,this.canvas.addEventListener("contextmenu",function(t){return t.preventDefault(),!1},jsFunctions.getPassiveEventListenerVar()),this.canvas.addEventListener("webglcontextrestored",Uh(this,this.onContextRestored)),B.init(),B.showSplashScreen(this),S.init(),B.get_enableCrossPromo()&&jsFunctions.initCrossPromo("coolmath"),this.addPostDraw(Uh(this,this.postDraw)),null!=window.document.hidden&&window.addEventListener("visibilitychange",function(){window.document.hidden?e.onWindowBlur():e.onWindowFocus()});try{window.addEventListener("error",function(t){var e="";null!=t.error&&(e=t.error.stack);var i="1.0.49+: "+t.message+" - "+t.filename+" - line "+t.lineno+" - col "+t.colno+" - "+e+"}";S.sendErrorEvent(i)})}catch(t){}}else window.alert("This version of The Final Earth 2 has not been licensed for this site. If you're seeing this in error or need a new domain added to an existing sitelock, just contact me and I'll fix it. Otherwise, please contact me (e.g. from florianvanstrien.nl) for licensing options.")},onContextRestored:function(){null!=this.game&&this.game.onContextRestored()},onWindowBlur:function(){null!=this.game&&(Cr.shouldShowPause()&&this.game.pauseCityForBlurIfDesired(),this.game.pause("windowBlur"))},onWindowFocus:function(){null!=this.game&&this.game.resume("windowBlur")&&this.game.refocus()},getWebRequestParams:function(){var t;t=at.substr(u.location.search,1,null);for(var e=new Vo,i=0,n=new c("[&;]","g").split(t);i<n.length;){var r=n[i];++i;var s=r.split("=");if(!(s.length<2)){var o=s.shift(),a=decodeURIComponent(o.split("+").join(" ")),l=s.join("="),h=decodeURIComponent(l.split("+").join(" "));e.h[a]=h}}return e},initConfig:function(){try{var t=this.getWebRequestParams();null!=t.h.maxScale&&(this.maxScaling=Y.parseInt(t.h.maxScale)),null!=t.h.kv_maxScale&&(this.maxScaling=Y.parseInt(t.h.kv_maxScale)),0==this.maxScaling&&(this.maxScaling=2)}catch(t){}},update:function(t){Er.registerFrame(),-1!=this.setScalingIn?(this.setScalingIn--,0==this.setScalingIn&&(this.setGameScale(),this.setScalingIn=-1)):window.innerHeight!=this.knownInnerH||window.innerWidth!=this.knownInnerW?jsFunctions.isAnyApple()&&(this._onWindowResize(null),this.setGameScaleSoon(),this.knownInnerH=window.innerHeight,this.knownInnerW=window.innerWidth):A.isMobile&&jsFunctions.isAnyApple()&&0!=window.scrollY&&window.scrollTo(0,0),null!=this.rotationAsker?this.rotationAsker.update(this.width/this.scaling,this.height/this.scaling,this.scaling):null!=this.game?this.game.update(t):null!=this.loader&&this.loader.update(this.gameRect,this.scaling),B.update(t)},postDraw:function(){null!=this.game&&this.game.postDraw()},_onWindowResize:function(t){this.knownInnerH=window.innerHeight,this.knownInnerW=window.innerWidth,m.prototype._onWindowResize.call(this,t)},setGameScale:function(){var t=this.pixelRatio*(B.mobileTrailerMode?B.mobileTrailerModeMultiplier:1),e=2;if(e*=t,this.scaling=e/t>this.maxScaling?Math.floor(this.maxScaling*t):Math.floor(e),A.isMobile&&this.width<this.height&&Math.floor(this.width/this.scaling)<320)this.askForRotation=!0,null==this.loader&&null!=this.game&&null==this.rotationAsker&&(this.rotationAsker=new Ar(this.stage),this.game.pause("pleaseRotateFirst"));else{if(this.width/this.scaling<320){var i=Math.floor(this.width/320),n=this.scaling;this.scaling=i<1?1:n<i?n:i}if(this.height/this.scaling<150){i=Math.floor(this.height/150),n=this.scaling;this.scaling=i<1?1:n<i?n:i}i=this.scaling+A.scalingMod;this.scaling=i<1?1:100<i?100:i,this.askForRotation=!1,null!=this.rotationAsker&&(this.rotationAsker.destroy(),this.rotationAsker=null,this.game.resume("pleaseRotateFirst"))}A.isLargeMobile=450<=Math.floor(this.width/this.scaling),this.gameRect=new yr(0,0,Math.floor(this.width/this.scaling),Math.floor(this.height/this.scaling)),this.addX=0,this.addY=0,null!=this.game?(this.game.isLargeMobile=this.game.isMobile&&A.isLargeMobile,this.game.resize(this.gameRect,this.addX,this.addY,this.scaling)):B.resizeSplash(this)},setGameScaleSoon:function(){this.setScalingIn=5},__class__:A});var M=function(r,t){this.displayCityActivation=0,this.deletedCurSave=!1,this.premiumButton=null,this.premiumBadge=null,this.fullscreenButton=null,this.totalTimeOnMenu=0;var s=this;this.game=r,this.stage=t,this.language=O.language;var e=new PIXI.Container;t.addChild(e),this.bgCity=new x(r,e,B.isSnowThemed?"displayCitySnow":"displayCity",!0,"___"),this.bottomButtonStage=new PIXI.Container,t.addChild(this.bottomButtonStage),this.visibilityGraphics=new PIXI.Graphics,this.bottomButtonStage.addChild(this.visibilityGraphics),this.visibilityGraphics.alpha=0,this.infoStage=new PIXI.Container,t.addChild(this.infoStage),this.unscaledStage=new PIXI.Container,this.unscaledStage.scale.set(r.scaling/r.get_preDPIAdjustScaling(),r.scaling/r.get_preDPIAdjustScaling()),t.parent.addChild(this.unscaledStage),this.titleSprite=new PIXI.Sprite(dt.getTexture("spr_title")),this.titleSprite.anchor.x=.5,this.infoStage.addChild(this.titleSprite),B.hasPremium(),this.versionText=new Ur("",{font:"Arial",tint:16777215}),this.versionText.alpha=.6,this.versionText.get_anchor().x=0,this.versionText.get_anchor().y=1,this.infoStage.addChild(this.versionText),this.bottomButtons=[],this.bottomButtonOnClick=new jo,this.bottomButtonOnHover=new jo,this.bottomButtonOnRight=new jo,this.bottomButtonAttract=new jo,this.otherButtons=[];var i=dt.getTexturesByWidth("spr_music",14),n=new PIXI.Sprite(i[O.musicOn?0:1]);this.musicOffButton={theSprite:n,onClick:function(){r.audio.changeMusicEnabledness(!O.musicOn),n.texture=i[O.musicOn?0:1]},onHover:function(){s.gui.tooltip.setText(s.musicOffButton,O.musicOn?Tr.lo("mute_music"):Tr.lo("unmute_music"))}},this.bottomButtonStage.addChild(this.musicOffButton.theSprite),this.otherButtons.push(this.musicOffButton);var o=dt.getTexturesByWidth("spr_sound",14),a=new PIXI.Sprite(o[O.soundOn?0:1]);if(this.soundOffButton={theSprite:a,onClick:function(){r.audio.changeSoundEnabledness(!O.soundOn),a.texture=o[O.soundOn?0:1]},onHover:function(){s.gui.tooltip.setText(s.soundOffButton,O.soundOn?Tr.lo("mute_sfx"):Tr.lo("unmute_sfx"))}},this.bottomButtonStage.addChild(this.soundOffButton.theSprite),this.otherButtons.push(this.soundOffButton),B.hasFullscreen&&!r.isMobile){var l=dt.getTexture("spr_fullscreen"),h=new PIXI.Sprite(l);this.fullscreenButton={theSprite:h,onClick:function(){},onHover:function(){s.gui.tooltip.setText(s.creditsButton,Tr.lo("full_screen")),r.setOnClickTo=function(){jsFunctions.goFullscreen(!0)}}},this.bottomButtonStage.addChild(this.fullscreenButton.theSprite),this.otherButtons.push(this.fullscreenButton)}var u="spr_button_small",c=2;r.isMobile&&(u="spr_button_medium",c=4);var d=dt.getTexture("spr_moresettings"),p=new PIXI.Sprite(d),f=null;f=function(){s.gui.createWindow("moreSettingsWindow"),s.gui.addWindowToStack(f),js.create(s.bgCity,s.gui,s.gui.innerWindowStage,s.gui.windowInner,u,c,!1)},this.moreSettingsButton={theSprite:p,onClick:f,onHover:function(){s.gui.tooltip.setText(s.moreSettingsButton,Tr.lo("advanced_settings"))}},this.bottomButtonStage.addChild(this.moreSettingsButton.theSprite),this.otherButtons.push(this.moreSettingsButton);var g=dt.getTexture("spr_credits"),m=new PIXI.Sprite(g),y=null;if(y=function(){s.gui.createWindow("creditsWindow"),s.gui.addWindowToStack(y),_s.create(null,s.gui,s.gui.innerWindowStage,s.gui.windowInner)},this.creditsButton={theSprite:m,onClick:y,onHover:function(){s.gui.tooltip.setText(s.creditsButton,Tr.lo("credits"))}},this.bottomButtonStage.addChild(m),this.otherButtons.push(this.creditsButton),this.rightBadges=[],B.get_isCoolMathWithCrossPromotion()){var _=dt.getTextures("steam_badge_coolmath",3),v=new PIXI.Sprite(_[0]),b={sprite:v,url:"https://store.steampowered.com/app/1180130/The_Final_Earth_2/?utm_source=coolmathgames&utm_medium=web&utm_campaign=titlescreen",altTextures:_};this.rightBadges.push(b),this.unscaledStage.addChild(v)}var w=new PIXI.Container;t.addChild(w),this.gui=new Gs(r,w),this.resize(),this.positionUIElements(),this.siteLogo=null,Rr.getItem("__meta__mostRecentlyPlayed",function(t,e){if(t||null==e){var i=s.addBottomButton("- "+Tr.lo("click_here_to_play")+" -",function(){r.newCity("theLostShip","0"),B.doPlay(),S.sendEvent("game","play_initial"),S.sendEventFirebase("playInitial","","")},null,"Arial18");s.bottomButtonAttract.set(i,!0);var n=r.isMobile?"Arial18":"Arial16";(i=s.addBottomButton("- "+Tr.lo("played_before")+" -",function(){s.gui.doCreatePlayedBeforeWindow(function(){}),S.sendEventFirebase("playedBefore","","")},null,n)).set_tint(10526896),Rr.storageSupported()||s.showErrorWithImportButton(Tr.lo("no_saves_warning")),!0}else{n=r.isMobile?"Arial18":"Arial16";"DELETED_SAVE"!=e&&s.addBottomButton("- "+Tr.lo("continue")+" -",function(){if(s.deletedCurSave){var t=null;(t=function(){s.gui.showSimpleWindow(Tr.lo("deleted_save"),null,!0),s.gui.addWindowToStack(t,!0),s.gui.setWindowReload(t)})()}else r.loadFromStorage(e),B.doPlay(),S.sendEvent("game","continue"),S.sendEventFirebase("continueGame","","")},null,n),s.addBottomButton("- "+Tr.lo("new_city")+" -",function(){s.gui.createPlayWindow(function(){})},null,n),s.addBottomButton("- "+Tr.lo("load_city")+" -",function(){var t=r,e=s.gui,i=Tr.lo("which_city_to_load"),n=Uh(r,r.loadFromStorage);eo.createLoadWindow(t,e,i,function(t){n(t)})},null,n),B.get_enableCrossPromo()&&s.addBottomButton("- "+Tr.lo("play_other")+" -",function(){jsFunctions.showCrossPromoDisplay(!0)})}s.positionUIElements(),1==pr.showEUConsent&&-1==O.euAdConsentStatus&&vo.createWindow(s.gui,!1)}),Mr.reportStopGameplay()};(q.MainMenu=M).__name__="MainMenu",M.__interfaces__=[r],M.prototype={get_publicGUI:function(){return this.gui},addBottomButton:function(t,e,i,n,r){null==n&&(n="Arial16"),null==i&&(i=!1);var s=new Ur(t,{font:i?"Arial":n,tint:i?13684944:16777215});return this.bottomButtonStage.addChild(s),this.bottomButtons.push(s),this.bottomButtonOnClick.set(s,e),this.bottomButtonOnHover.set(s,r),this.bottomButtonOnRight.set(s,i),this.bottomButtonAttract.set(s,!1),s},positionUIElements:function(){this.visibilityGraphics.clear(),this.titleSprite.position.x=this.game.rect.width/2,this.titleSprite.position.y=10,this.visibilityGraphics.beginFill(0,.5),this.visibilityGraphics.drawRect(0,0,this.game.rect.width,20+this.titleSprite.height),this.visibilityGraphics.endFill();var t=this.game.rect.height;this.versionText.position.x=1,this.versionText.position.y=this.game.rect.height;for(var e=this.game.rect.height-10,i=16+(this.game.isMobile?3:0),n=[],r=0,s=this.bottomButtons;r<s.length;){var o=s[r];++r,this.bottomButtonOnRight.h[o.__id__]||n.push(o)}var a=e-i*n.length;for(n=[],r=0,s=this.bottomButtons;r<s.length;){o=s[r];++r,this.bottomButtonOnRight.h[o.__id__]||"Arial18"!=o.get_fontName()||n.push(o)}e=a-3*((w=n.length-1)<0?0:w)-this.gui.safeAreaBottom;var l=this.game.rect.height;for(n=[],r=0,s=this.bottomButtons;r<s.length;){o=s[r];++r,this.bottomButtonOnRight.h[o.__id__]&&n.push(o)}var h=l-14*n.length-this.gui.safeAreaBottom;if((w=e-7)<=t&&(t=w),null!=this.rightBadges&&0<this.rightBadges.length){var u=0;null==this.siteLogo?h=2:h-=3;for(n=0,r=this.rightBadges;n<r.length;){var c=r[n];++n,!0,c.sprite.position.set((this.game.rect.width-10)*this.game.get_preDPIAdjustScaling()-c.sprite.width,(this.game.rect.height-10)*this.game.get_preDPIAdjustScaling()-c.sprite.height-u),u+=14+c.sprite.height,null!=this.siteLogo&&(h-=Math.ceil((14+c.sprite.height)/this.game.get_preDPIAdjustScaling()))}(w=this.game.rect.height-10-u/this.game.get_preDPIAdjustScaling()|0)<=t&&(t=w)}for(n=0,r=this.bottomButtons;n<r.length;){var d=r[n];if(++n,this.bottomButtonOnRight.h[d.__id__]){var p=this.game.rect.width-d.get_textWidth()-3;d.position.x=p-this.gui.safeAreaRight,d.position.y=h,h+=16}else{var f=this.game.rect.width/2,g=d.get_textWidth()/2;d.position.x=f-g,d.position.y=e,this.game.isMobile&&(e+=3),"Arial18"==d.get_fontName()?e+=19:e+=16}}var m=this.game.rect.height-24-this.gui.safeAreaBottom,y=10+this.gui.safeAreaLeft,_=y,v=m;p=new PIXI.Point(_,v);this.musicOffButton.theSprite.position=p;_=y+=22,v=m,p=new PIXI.Point(_,v);if(this.soundOffButton.theSprite.position=p,y+=22,null!=this.fullscreenButton){_=y,v=m,p=new PIXI.Point(_,v);this.fullscreenButton.theSprite.position=p,y+=22}if(null!=this.moreSettingsButton){_=y,v=m,p=new PIXI.Point(_,v);this.moreSettingsButton.theSprite.position=p,y+=22}y+=10;var b=0;this.game.isMobile&&(b=-24,y=10+this.gui.safeAreaLeft);var w;_=y,v=m+b,p=new PIXI.Point(_,v);if(this.creditsButton.theSprite.position=p,y+=22,(w=m+b-10)<=t&&(t=w),null!=this.siteLogo){_=this.game.rect.width*this.game.scaling-10,v=10,p=new PIXI.Point(_,v);this.siteLogo.position=p}this.visibilityGraphics.beginFill(0,.5),this.visibilityGraphics.drawRect(0,t,this.game.rect.width,this.game.rect.height),this.visibilityGraphics.endFill(),this.visibilityGraphicsYStart=20+this.titleSprite.height,this.visibilityGraphicsYEnd=t;try{0!=M.fireBaseReportScale&&(S.sendEventFirebase("ABTEST","scalingInitial",2==M.fireBaseReportScale?"1":"0"),M.fireBaseReportScale=0)}catch(n){}},showError:function(t){this.gui.showSimpleWindow(t)},showErrorWithImportButton:function(t){var e=this;this.gui.createWindow(),this.gui.windowAddInfoText(t),this.gui.windowAddBottomButtons([{text:Tr.lo("import")+"...",onHover:function(){e.game.setOnClickTo=function(){var t=window.document.getElementById("importFile");t.value="",t.click(),e.game.onClick=null}},action:function(){}}])},handleMouse:function(t){if(this.gui.handleMouse(t)){for(var e=0,i=this.bottomButtons;e<i.length;){var n=i[e];++e,n.alpha=.7}for(e=0,i=this.otherButtons;e<i.length;){var r=i[e];++e,r.theSprite.alpha=.7}return!0}if(this.bottomButtonStage.visible){for(e=0,i=this.bottomButtons;e<i.length;){n=i[e];if(++e,t.get_x()>=n.position.x&&t.get_x()<=n.position.x+n.get_textWidth()&&t.get_y()>n.position.y+2&&t.get_y()<=n.position.y+n.get_textHeight()){switch(t.claimMouse(n)._hx_index){case 0:n.alpha=1;break;case 1:n.alpha=1,this.bottomButtonStage.visible=!1,this.bottomButtonOnClick.h[n.__id__](),R.get().playSound(R.get().buttonSound);break;case 2:n.alpha=.85}null!=this.bottomButtonOnHover.h[n.__id__]&&this.bottomButtonOnHover.h[n.__id__]()}else n.alpha=.7+(this.bottomButtonAttract.h[n.__id__]?.30000000000000004*Math.sin(.08*this.totalTimeOnMenu):0)}for(e=0,i=this.otherButtons;e<i.length;){r=i[e];if(++e,t.get_x()>=r.theSprite.position.x&&t.get_x()<r.theSprite.position.x+r.theSprite.width&&t.get_y()>=r.theSprite.position.y&&t.get_y()<r.theSprite.position.y+r.theSprite.height){switch(t.claimMouse(r)._hx_index){case 0:r.theSprite.alpha=1;break;case 1:r.theSprite.alpha=1,null!=r.onClick&&r.onClick(),R.get().playSound(R.get().buttonSound);break;case 2:r.theSprite.alpha=.85}null!=r.onHover&&r.onHover()}else r.theSprite.alpha=.7}for(e=0,i=this.rightBadges;e<i.length;){var s=[i[e]];++e,t.get_x()*this.game.get_preDPIAdjustScaling()>=s[0].sprite.position.x&&t.get_x()*this.game.get_preDPIAdjustScaling()<s[0].sprite.position.x+s[0].sprite.width&&t.get_y()*this.game.get_preDPIAdjustScaling()>=s[0].sprite.position.y&&t.get_y()*this.game.get_preDPIAdjustScaling()<s[0].sprite.position.y+s[0].sprite.height?(this.game.setOnClickTo=function(t){return function(){t[0].url.indexOf("steam"),window.open(t[0].url,"_blank")}}(s),null!=s[0].altTextures&&(s[0].sprite.texture=t.down?s[0].altTextures[2]:s[0].altTextures[1])):null!=s[0].altTextures&&(s[0].sprite.texture=s[0].altTextures[0])}}else null!=this.gui.window&&"privacyWindow"==this.gui.windowRelatedTo&&t.pressed&&(this.gui.goPreviousWindow(),R.get().playSound(R.get().buttonSound));null!=this.siteLogo&&this.siteLogo.visible&&this.siteLogo.parent;return t.pressed&&t.get_y()>this.visibilityGraphicsYStart&&t.get_y()<this.visibilityGraphicsYEnd&&(!this.game.isMobile||this.game.isLargeMobile)&&this.clickDisplayCity(),!1},update:function(t){this.game.keyboard.anyBack(),this.updateDisplayCity(t),this.gui.update(t),this.bgCity.update(t);var e=null==this.gui.window&&!jsFunctions.crossPromoIsVisible();this.bottomButtonStage.visible=e;e=null==this.gui.window&&!jsFunctions.crossPromoIsVisible();if(this.unscaledStage.visible=e,null!=this.siteLogo){e=null==this.gui.window&&!jsFunctions.crossPromoIsVisible();this.siteLogo.visible=e}this.totalTimeOnMenu+=t,B.hasPremium()||null!=this.premiumBadge&&(this.premiumBadge.visible=!1,this.premiumBadge=null)},updateDisplayCity:function(t){0<this.displayCityActivation?(this.displayCityActivation=Math.min(1,this.displayCityActivation+.025*t),this.visibilityGraphics.alpha=this.displayCityActivation):this.bgCity.simulation.time.timeSinceStart=0},clickDisplayCity:function(){},postDraw:function(){this.bgCity.postDraw()},resize:function(){this.bottomButtonStage.scale.x=this.bottomButtonStage.scale.y=this.game.scaling,this.infoStage.scale.x=this.infoStage.scale.y=this.game.scaling;var t=this.game.scaling,e=this.game.get_preDPIAdjustScaling();this.unscaledStage.scale.x=this.unscaledStage.scale.y=t/e,this.bgCity.resize(),this.gui.resize(),this.positionUIElements()},refocus:function(){this.bgCity.refocus()},stop:function(){this.bgCity.stop(),this.unscaledStage.destroy()},pause:function(){},resume:function(){},onContextRestored:function(){this.bgCity.onContextRestored()},__class__:M};var ct=function(){};(q.MaterialsHelper=ct).__name__="MaterialsHelper",ct.findMaterialIndex=function(t){return ct.materialNames.indexOf(t)},ct.findMaterialName=function(t){return ct.materialNames[t]},ct.findMaterialDisplayName=function(t){var e=ct.findMaterialName(t);switch(e){case"computerChips":e="computer_chips";break;case"machineParts":e="machine_parts";break;case"refinedMetals":e="refined_metals"}return Or.firstToUpper(Tr.lo(e))},Math.__name__="Math";var $=T.MouseState={__ename__:"MouseState",__constructs__:["Active","Confirmed","None"],Active:{_hx_index:0,__enum__:"MouseState",toString:i},Confirmed:{_hx_index:1,__enum__:"MouseState",toString:i},None:{_hx_index:2,__enum__:"MouseState",toString:i}},v=function(){this.timeMod=0,this.scrollBarNextMovementPages=0,this.scrollBarMovementPages=0,this.scrollBarNextMovement=0,this.scrollBarMovement=0,this.nextTickReset=12,this.mouseDownTick=0,this.isTouch=!1,this.disableCityMovement=!1,this.strongClaimOnEnd=null,this.strongClaimOnUpdate=null,this.hasStrongClaim=!1,this.additionalClaimData=null,this.activeObject=null,this.nextStepQuietReleased=!1,this.nextStepMiddleReleased=!1,this.nextStepMiddleDown=!1,this.nextStepRightReleased=!1,this.nextStepRightDown=!1,this.nextStepReleased=!1,this.nextStepDown=!1,this.middleDown=!1,this.middleReleased=!1,this.middlePressed=!1,this.rightDown=!1,this.rightReleased=!1,this.rightPressed=!1,this.moved=!1,this.down=!1,this.released=!1,this.pressed=!1,this.position=new vr(0,0),this.unscaledPosition=new vr(0,0),this.cityPosition=new vr(0,0),this.mouseDownTick=0,this.pointerDown=[],this.pointerUnscaledPosition=new Wo,this.pointerPosition=new Wo,this.pointerCityScaledPosition=new Wo,this.pointerCityPosition=new Wo};(q.Mouse=v).__name__="Mouse",v.prototype={get_x:function(){return this.position.x},get_y:function(){return this.position.y},get_cityX:function(){return this.cityPosition.x},get_cityY:function(){return this.cityPosition.y},claimMouse:function(t,e,i,n,r){return null==r&&(r=!1),null==n&&(n=!1),null==i&&(i=!0),this.pressed&&(this.activeObject=t,this.additionalClaimData=e,this.disableCityMovement=i,this.hasStrongClaim=!1),this.activeObject==t&&this.additionalClaimData==e?n?this.released?(this.releaseClaim(),$.None):(this.down||this.released)&&(this.mouseDownTick<=0||r)?(this.mouseDownTick+=this.nextTickReset,this.nextTickReset-=1,this.nextTickReset<=2&&(this.nextTickReset=2),$.Confirmed):$.Active:this.released?(this.releaseAllClaims(!0),$.Confirmed):$.Active:(this.releaseClaim(),$.None)},weakClaimForScroll:function(t){return(null==this.activeWeakObject||this.activeWeakObject==t)&&(!this.hasStrongClaim&&(this.activeWeakObject==t?10<=vr.distance(this.weakClaimStartPos,this.position)&&(this.activeWeakObject=null,this.releaseAllClaims(),!0):(this.pressed&&(this.activeWeakObject=t,this.weakClaimStartPos=this.position),!1)))},hasNoClaim:function(){return null==this.activeObject},hasSpecificClaim:function(t){return this.activeObject==t},strongClaimMouse:function(t,e,i){return null==i&&(i=!0),!(this.activeObject!=t||!this.hasStrongClaim)||!(!this.pressed&&i)&&(this.activeObject=t,this.disableCityMovement=!0,this.hasStrongClaim=!0,this.strongClaimOnUpdate=e,!0)},preHandling:function(){this.released&&this.hasStrongClaim&&this.releaseAllClaims(!0),this.down||(this.disableCityMovement=!1)},afterHandling:function(){this.hasStrongClaim&&null!=this.strongClaimOnUpdate&&this.strongClaimOnUpdate()},releaseAllClaims:function(t){null==t&&(t=!1),this.releaseClaim(t),this.releaseWeakClaim()},releaseClaim:function(t){null==t&&(t=!1),!t&&this.hasStrongClaim||(null!=this.strongClaimOnEnd&&this.strongClaimOnEnd(),this.activeObject=null,this.additionalClaimData=null,this.mouseDownTick=0,this.nextTickReset=12,this.hasStrongClaim=!1,this.strongClaimOnEnd=null)},releaseWeakClaim:function(){this.activeWeakObject=null},calcCityPosition:function(t,e){var i=this.unscaledPosition,n=(t.rect.width/2|0)*t.scaling,r=(t.rect.height/2|0)*t.scaling,s=u=i.x-n,o=l=i.y-r,a=e.zoomScale,l=o/a,h=(s=(u=s/a)-(n=t.addX),o=l-(r=t.addY),e.viewPos),u=s+h.x;l=o+h.y;return new vr(Math.floor(u),Math.floor(l))},calcCityPositionForPointer:function(t,e,i){var n=this.calcCityFPositionForPointer(t,e,i);return new vr(Math.floor(n.x),Math.floor(n.y))},calcCityFPositionForPointer:function(t,e,i){var n=this.pointerUnscaledPosition.h[i],r=(t.rect.width/2|0)*t.scaling,s=(t.rect.height/2|0)*t.scaling,o=n.x-r,a=h=n.y-s,l=e.zoomScale,h=a/l,u=(o=o/l-(r=t.addX),a=h-(s=t.addY),e.viewPos);return new br(o+u.x,a+u.y)},getActiveObject:function(){return this.activeObject},resetPosition:function(){this.position=new vr(-1e5,-1e5),this.unscaledPosition=new vr(-1e5,-1e5),this.cityScaledPosition=new br(-1e5,-1e5),this.cityPosition=new vr(-1e5,-1e5)},__class__:v};var b=function(t,e,i){this.game=t,this.stage=e;var n=new PIXI.Container;e.addChild(n),this.bgCity=new x(t,n,i,!0,"___"),this.guiStage=new PIXI.Container,e.addChild(this.guiStage),this.gui=new p(t,this.guiStage),this.resize(),this.startUI(i),this.resize()};(q.NewGameCreator=b).__name__="NewGameCreator",b.__interfaces__=[r],b.prototype={get_publicGUI:function(){return this.gui},startUI:function(e){var t=lt.find(dt.allStoriesInfo,function(t){return t.link==e}).freePlay;if(null!=t&&t){var i=Uh(this,this.createSaveWindow),n=e;Is.createWindow(this.bgCity,this.gui,function(){i(n,!1)},Uh(N=this.game,N.restoreState))}else this.createSaveWindow(e)},createSaveWindow:function(e,t){null==t&&(t=!0);var i=this;this.gui.windowOnDestroy=null,eo.createSaveWindow(this.game,this.gui,Tr.lo("save_slot_choice"),function(t){i.game.destroyTempSaveState(),i.bgCity.disableDisplayOnlyMode(t),i.bgCity.progress.unlocks.postInitialCreate(),B.doPlay(),S.sendEvent("game","newGame",null,e),S.sendEventFirebase("newGame","scenario",e),i.game.switchState(i.bgCity),B.onCitySwitch(!0),i.guiStage.destroy(),Rr.setItem("__meta_mostRecentSubOf_"+t,t,function(){})},function(){t&&i.game.restoreState()})},handleMouse:function(t){return!!this.gui.handleMouse(t)},update:function(t){this.bgCity.update(t),this.gui.update(t)},postDraw:function(){this.bgCity.postDraw()},resize:function(){this.bgCity.resize(),this.gui.resize()},refocus:function(){this.bgCity.refocus()},stop:function(){this.bgCity.stop()},pause:function(){},resume:function(){},onContextRestored:function(){this.bgCity.onContextRestored()},__class__:b};var w=t.Perf=function(t,e){if(null==e&&(e=0),null==t&&(t="TR"),this._perfObj=window.performance,null!=F.field(this._perfObj,"memory")&&(this._memoryObj=F.field(this._perfObj,"memory")),this._memCheck=null!=this._perfObj&&null!=this._memoryObj&&0<this._memoryObj.totalJSHeapSize,this._pos=t,this._offset=e,this.currentFps=60,this.currentMs=0,this.currentMem="0",this.lowFps=60,this.avgFps=60,this._measureCount=0,this._totalFps=0,this._time=0,this._ticks=0,this._fpsMin=60,this._fpsMax=60,this._startTime=null!=this._perfObj&&null!=this._perfObj.now?this._perfObj.now():(new Date).getTime(),this._prevTime=-w.MEASUREMENT_INTERVAL,this._createFpsDom(),this._createMsDom(),this._memCheck&&this._createMemoryDom(),null!=window.requestAnimationFrame?this.RAF=Uh(N=window,N.requestAnimationFrame):null!=window.mozRequestAnimationFrame?this.RAF=window.mozRequestAnimationFrame:null!=window.webkitRequestAnimationFrame?this.RAF=window.webkitRequestAnimationFrame:null!=window.msRequestAnimationFrame&&(this.RAF=window.msRequestAnimationFrame),null!=window.cancelAnimationFrame?this.CAF=Uh(N=window,N.cancelAnimationFrame):null!=window.mozCancelAnimationFrame?this.CAF=window.mozCancelAnimationFrame:null!=window.webkitCancelAnimationFrame?this.CAF=window.webkitCancelAnimationFrame:null!=window.msCancelAnimationFrame&&(this.CAF=window.msCancelAnimationFrame),null!=this.RAF){var i=window;this._raf=this.RAF.apply(i,[Uh(this,this._tick)])}};(q.Perf=w).__name__="Perf",w.prototype={_init:function(){this.currentFps=60,this.currentMs=0,this.currentMem="0",this.lowFps=60,this.avgFps=60,this._measureCount=0,this._totalFps=0,this._time=0,this._ticks=0,this._fpsMin=60,this._fpsMax=60,this._startTime=null!=this._perfObj&&null!=this._perfObj.now?this._perfObj.now():(new Date).getTime(),this._prevTime=-w.MEASUREMENT_INTERVAL},_now:function(){return null!=this._perfObj&&null!=this._perfObj.now?this._perfObj.now():(new Date).getTime()},_tick:function(t){var e=null!=this._perfObj&&null!=this._perfObj.now?this._perfObj.now():(new Date).getTime();if(this._ticks++,null!=this._raf&&e>this._prevTime+w.MEASUREMENT_INTERVAL&&(this.currentMs=Math.round(e-this._startTime),this.ms.innerHTML="MS: "+this.currentMs,this.currentFps=Math.round(1e3*this._ticks/(e-this._prevTime)),0<this.currentFps&&t>w.DELAY_TIME&&(this._measureCount++,this._totalFps+=this.currentFps,this.lowFps=this._fpsMin=Math.min(this._fpsMin,this.currentFps),this._fpsMax=Math.max(this._fpsMax,this.currentFps),this.avgFps=Math.round(this._totalFps/this._measureCount)),this.fps.innerHTML="FPS: "+this.currentFps+" ("+this._fpsMin+"-"+this._fpsMax+")",30<=this.currentFps?this.fps.style.backgroundColor=w.FPS_BG_CLR:15<=this.currentFps?this.fps.style.backgroundColor=w.FPS_WARN_BG_CLR:this.fps.style.backgroundColor=w.FPS_PROB_BG_CLR,this._prevTime=e,this._ticks=0,this._memCheck&&(this.currentMem=this._getFormattedSize(this._memoryObj.usedJSHeapSize,2),this.memory.innerHTML="MEM: "+this.currentMem)),this._startTime=e,null!=this._raf){var i=window;this._raf=this.RAF.apply(i,[Uh(this,this._tick)])}},_createDiv:function(t,e){null==e&&(e=0);var i=window.document.createElement("div");switch(i.id=t,i.className=t,i.style.position="absolute",this._pos){case"BL":i.style.left=this._offset+"px",i.style.bottom=(this._memCheck?48:32)-e+"px";break;case"BR":i.style.right=this._offset+"px",i.style.bottom=(this._memCheck?48:32)-e+"px";break;case"TL":i.style.left=this._offset+"px",i.style.top=e+"px";break;case"TR":i.style.right=this._offset+"px",i.style.top=e+"px"}return i.style.width="80px",i.style.height="12px",i.style.lineHeight="12px",i.style.padding="2px",i.style.fontFamily=w.FONT_FAMILY,i.style.fontSize="9px",i.style.fontWeight="bold",i.style.textAlign="center",window.document.body.appendChild(i),i},_createFpsDom:function(){this.fps=this._createDiv("fps"),this.fps.style.backgroundColor=w.FPS_BG_CLR,this.fps.style.zIndex="995",this.fps.style.color=w.FPS_TXT_CLR,this.fps.innerHTML="FPS: 0"},_createMsDom:function(){this.ms=this._createDiv("ms",16),this.ms.style.backgroundColor=w.MS_BG_CLR,this.ms.style.zIndex="996",this.ms.style.color=w.MS_TXT_CLR,this.ms.innerHTML="MS: 0"},_createMemoryDom:function(){this.memory=this._createDiv("memory",32),this.memory.style.backgroundColor=w.MEM_BG_CLR,this.memory.style.color=w.MEM_TXT_CLR,this.memory.style.zIndex="997",this.memory.innerHTML="MEM: 0"},_getFormattedSize:function(t,e){null==e&&(e=0);if(0==t)return"0";var i=Math.pow(10,e),n=Math.floor(Math.log(t)/Math.log(1024));return Math.round(t*i/Math.pow(1024,n))/i+" "+["Bytes","KB","MB","GB","TB"][n]},addInfo:function(t){this.info=this._createDiv("info",this._memCheck?48:32),this.info.style.backgroundColor=w.INFO_BG_CLR,this.info.style.color=w.INFO_TXT_CLR,this.info.style.zIndex="998",this.info.innerHTML=t},clearInfo:function(){null!=this.info&&(window.document.body.removeChild(this.info),this.info=null)},destroy:function(){var t=window;this.CAF.apply(t,[this._raf]),this._raf=null,this._perfObj=null,(this._memoryObj=null)!=this.fps&&(window.document.body.removeChild(this.fps),this.fps=null),null!=this.ms&&(window.document.body.removeChild(this.ms),this.ms=null),null!=this.memory&&(window.document.body.removeChild(this.memory),this.memory=null),this.clearInfo(),this.currentFps=60,this.currentMs=0,this.currentMem="0",this.lowFps=60,this.avgFps=60,this._measureCount=0,this._totalFps=0,this._time=0,this._ticks=0,this._fpsMin=60,this._fpsMax=60,this._startTime=null!=this._perfObj&&null!=this._perfObj.now?this._perfObj.now():(new Date).getTime(),this._prevTime=-w.MEASUREMENT_INTERVAL},_cancelRAF:function(){var t=window;this.CAF.apply(t,[this._raf]),this._raf=null},__class__:w};var ht=function(){};(q.PermanentMetaHelper=ht).__name__="PermanentMetaHelper",ht.getClassIDLength=function(){return ht.buildingClassesNumber},ht.getClassID=function(t){var e=ht.registeredClassNames.h[t];if(null!=e)return e;var i=ht.buildingClassesNumber;return ht.registeredClassNames.h[t]=i,ht.buildingClassesNumber++,ht.buildingClassesNumber-1};var F=function(){};(q.Reflect=F).__name__="Reflect",F.field=function(t,e){try{return t[e]}catch(t){return null}},F.fields=function(t){var e=[];if(null!=t){var i=Object.prototype.hasOwnProperty;for(var n in t)"__id__"!=n&&"hx__closures__"!=n&&i.call(t,n)&&e.push(n)}return e},F.isFunction=function(t){return"function"==typeof t&&!(t.__name__||t.__ename__)},F.deleteField=function(t,e){return!!Object.prototype.hasOwnProperty.call(t,e)&&(delete t[e],!0)},F.copy=function(t){if(null==t)return null;for(var e={},i=0,n=F.fields(t);i<n.length;){var r=n[i];++i,e[r]=F.field(t,r)}return e};var dt=function(){};(q.Resources=dt).__name__="Resources",dt.getTextures=function(t,e,i,n){null==n&&(n=1),null==i&&(i=!1);var r=t+"%num%"+e;if(i&&(r+="%s%"),1!=n&&(r+="%r%"+n),Object.prototype.hasOwnProperty.call(dt.multiTextureCache.h,r))return dt.multiTextureCache.h[r];for(var s=[],o=0,a=n;o<a;)for(var l=o++,h=0,u=e;h<u;){var c=h++,d=PIXI.Texture.from(t+".png").clone(),p=((d.frame.width+2|0)/e|0)-(i?1:2);d.frame=new PIXI.Rectangle(d.frame.x+(p+(i?1:2))*c-(i&&c%2==1?1:0),d.frame.y+((d.frame.height-2*(n-1))/n+2)*l,p,(d.frame.height-2*(n-1))/n),s.push(d)}return dt.multiTextureCache.h[r]=s},dt.getTexturesByWidth=function(t,e,i){null==i&&(i=!1);var n=t+"%width%"+e;if(i&&(n+="%s%"),Object.prototype.hasOwnProperty.call(dt.multiTextureCache.h,n))return dt.multiTextureCache.h[n];var r=dt.getTextures(t,(PIXI.Texture.from(t+".png").width+2)/(e+(i?1:2))|0,i);return dt.multiTextureCache.h[n]=r},dt.getTexturesAsGrid=function(t,e,i,n,r){null==r&&(r=!1),null==n&&(n=0);var s=t+"%numW%"+e+"%numH%"+i;if(r&&(s+="%s%"),Object.prototype.hasOwnProperty.call(dt.multiTextureCache2.h,s))return dt.multiTextureCache2.h[s];for(var o=[],a=0,l=e;a<l;){var h=a++;o[h]=[];for(var u=0,c=i;u<c;){var d=u++,p=PIXI.Texture.from(t+".png").clone(),f=((p.frame.width+2|0)/e|0)-(r?1:n),g=(0|p.frame.height)/i|0;p.frame=new PIXI.Rectangle(p.frame.x+(f+(r?1:n))*h-(r&&h%2==1?1:0),p.frame.y+g*d,f,g),o[h].push(p)}}return dt.multiTextureCache2.h[s]=o},dt.getTexturesBySize=function(t,e,i,n,r){null==r&&(r=!1),null==n&&(n=0);var s=t+"%width%"+e+"%height%"+i;if(r&&(s+="%s%"),Object.prototype.hasOwnProperty.call(dt.multiTextureCache2.h,s))return dt.multiTextureCache2.h[s];var o=dt.getTexturesAsGrid(t,(PIXI.Texture.from(t+".png").width+n)/(e+(r?1:n))|0,PIXI.Texture.from(t+".png").height/i|0,null,r);return dt.multiTextureCache2.h[s]=o},dt.getTexturesAsGridInverse=function(t,e,i,n,r){null==r&&(r=!1),null==n&&(n=0);var s=t+"%numW%"+e+"%numH%"+i+"%INV";if(r&&(s+="%s%"),Object.prototype.hasOwnProperty.call(dt.multiTextureCache2.h,s))return dt.multiTextureCache2.h[s];for(var o=[],a=0,l=i;a<l;){var h=a++;o[h]=[];for(var u=0,c=e;u<c;){var d=u++,p=PIXI.Texture.from(t+".png").clone(),f=((p.frame.width+2|0)/e|0)-(r?1:n),g=(0|p.frame.height)/i|0;p.frame=new PIXI.Rectangle(p.frame.x+(f+(r?1:n))*d-(r&&d%2==1?1:0),p.frame.y+g*h,f,g),o[h].push(p)}}return dt.multiTextureCache2.h[s]=o},dt.getTexturesBySizeInverse=function(t,e,i,n,r){null==r&&(r=!1),null==n&&(n=0);var s=t+"%width%"+e+"%height%"+i+"%INV";if(r&&(s+="%s%"),Object.prototype.hasOwnProperty.call(dt.multiTextureCache2.h,s))return dt.multiTextureCache2.h[s];var o=dt.getTexturesAsGridInverse(t,(PIXI.Texture.from(t+".png").width+n)/(e+(r?1:n))|0,PIXI.Texture.from(t+".png").height/i|0,n,r);return dt.multiTextureCache2.h[s]=o},dt.getTexture=function(t,e){var i=null!=e?t+"@"+e.x+","+e.y+","+e.width+","+e.height:t;if(Object.prototype.hasOwnProperty.call(dt.singleTextureCache.h,i))return dt.singleTextureCache.h[i];if(null==e&&-1!=t.indexOf("@")){var n=t.split("@");t=n[0];for(var r=n[1].split(","),s=new Array(r.length),o=0,a=r.length;o<a;){var l=o++;s[l]=Y.parseInt(r[l])}var h=s;e=new yr(h[0],h[1],h[2],h[3])}var u=PIXI.Texture.from(t+".png").clone();return null!=e&&(u.frame=new PIXI.Rectangle(u.frame.x+e.x,u.frame.y+e.y,e.width,e.height)),dt.singleTextureCache.h[i]=u},dt.makeSprite=function(t,e){return new PIXI.Sprite(dt.getTexture(t,e))},dt.initializeCityResources=function(t){t.buildingInfoArray=[];for(var e=0,i=dt.buildingInfoArray;e<i.length;){var n=i[e];++e,t.buildingInfoArray.push(F.copy(n))}t.buildingInfo=new Vo;for(e=0,i=t.buildingInfoArray;e<i.length;){var r=i[e];++e,t.buildingInfo.h["buildings."+r.className]=r}};var O=function(){};(q.Settings=O).__name__="Settings",O.loadLanguages=function(){Tr.loadLanguage("en",!0,function(){"en"!=O.language?Tr.loadLanguage(O.language,!1,function(){O.settingsLoaded=!0},function(){}):O.settingsLoaded=!0},function(){})},O.load=function(i){null==Rr.getItem("tfe2_settings",function(t,e){null==t&&null!=e?(O.musicOn=e.musicOn,O.soundOn=e.soundOn,null!=e.pathfindingWorkers&&(O.pathfindingWorkers=e.pathfindingWorkers),null!=e.secretCodesEnabled&&(O.secretCodesEnabled=e.secretCodesEnabled),null!=e.boostHidden&&(O.boostHidden=e.boostHidden),null!=e.colorBlindMode&&(O.colorBlindMode=e.colorBlindMode),null!=e.musicVolume&&(O.musicVolume=e.musicVolume),null!=e.soundVolume&&(O.soundVolume=e.soundVolume),null!=e.language&&(O.language=e.language),null!=e.euAdConsentStatus&&(O.euAdConsentStatus=e.euAdConsentStatus),null!=e.allowMoreZoom&&(O.allowMoreZoom=e.allowMoreZoom),null!=e.compatDisableMasking&&(O.compatDisableMasking=e.compatDisableMasking),null!=e.disableClouds&&(O.disableClouds=e.disableClouds),null!=e.disablePlanets&&(O.disablePlanets=e.disablePlanets),null!=e.scalingMod&&(A.scalingMod=e.scalingMod,0!=A.scalingMod&&i.setGameScale()),O.fullscreen=e.isFullScreen):O.language=O.getLanguage(),O.loadLanguages()})&&(O.language=O.getLanguage(),O.loadLanguages()),O.pathfindingWorkers<=0&&O.resetPathfindingWorkers()},O.getLanguage=function(){var t=u.navigator.language;if(null!=t&&""!=t)switch(t.split("-")[0]){case"de":return"de";case"en":return"en";case"es":return"es";case"fr":return"fr";case"pt":return"pt";case"ru":return"ru";case"vi":return"vi"}return"en"},O.resetPathfindingWorkers=function(){if(O.pathfindingWorkers=2,null!=u.navigator&&null!=u.navigator.hardwareConcurrency)try{var t=(u.navigator.hardwareConcurrency/2|0)-1;O.pathfindingWorkers=t<2?2:7<t?7:t}catch(t){O.pathfindingWorkers=2}return O.pathfindingWorkers},O.save=function(){var t={};t.musicOn=O.musicOn,t.soundOn=O.soundOn,t.boostHidden=O.boostHidden,t.colorBlindMode=O.colorBlindMode,t.pathfindingWorkers=O.pathfindingWorkers,t.secretCodesEnabled=O.secretCodesEnabled,t.musicVolume=O.musicVolume,t.soundVolume=O.soundVolume,t.language=O.language,t.euAdConsentStatus=O.euAdConsentStatus,t.scalingMod=A.scalingMod,t.allowMoreZoom=O.allowMoreZoom,t.compatDisableMasking=O.compatDisableMasking,t.disableClouds=O.disableClouds,t.disablePlanets=O.disablePlanets,Rr.setItem("tfe2_settings",t,function(){})},O.hasSecretCode=function(t){return-1!=O.secretCodesEnabled.indexOf(t)},O.unlockSecretCode=function(t){O.hasSecretCode(t)||(O.secretCodesEnabled.push(t),O.save())},O.loadFromCitySave=function(t){var e=t.bytes.getInt32(t.readStart);t.readStart+=4;for(var i=0,n=e;i<n;){i++;O.unlockSecretCode(t.readString())}},O.saveToCitySave=function(t){var e=O.secretCodesEnabled.length;if(t.size+4>t.bytes.length){var i=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+4))),t.bytes.blit(0,i,0,t.size)}t.bytes.setInt32(t.size,e),t.size+=4;for(var n=0,r=O.secretCodesEnabled;n<r.length;){var s=r[n];++n,t.addString(s)}},O.update=function(t){if(Ko.getClass(t.state)==x){var e=t.state;if(B.iosMobileScreenshotMode&&t.mouse.pressed&&t.mouse.get_x()<100||t.keyboard.down[17]&&t.keyboard.pressed[117]){for(var i=Ws.languages.concat(Ws.languagesSecondary),n=new Array(i.length),r=0,s=i.length;r<s;){var o=r++;n[o]=i[o].code}var a=n;Ws.changeLanguage(e,a[(a.indexOf(O.language)+1)%a.length],e.gui)}}};var Y=function(){};(q.Std=Y).__name__="Std",Y.string=function(t){return Ko.__string_rec(t,"")},Y.parseInt=function(t){if(null!=t)for(var e=0,i=t.length;e<i;){var n=e++,r=t.charCodeAt(n);if(r<=8||14<=r&&32!=r&&45!=r){var s=t.charCodeAt(1+n),o=parseInt(t,120==s||88==s?16:10);return isNaN(o)?null:o}}return null},Y.random=function(t){return t<=0?0:Math.floor(Math.random()*t)};function I(){this.b=""}(q.StringBuf=I).__name__="StringBuf",I.prototype={__class__:I};var C=function(){};(q.StringTools=C).__name__="StringTools",C.startsWith=function(t,e){return t.length>=e.length&&0==t.lastIndexOf(e,0)},C.replace=function(t,e,i){return t.split(e).join(i)};var P=T.ValueType={__ename__:"ValueType",__constructs__:["TNull","TInt","TFloat","TBool","TObject","TFunction","TClass","TEnum","TUnknown"],TNull:{_hx_index:0,__enum__:"ValueType",toString:i},TInt:{_hx_index:1,__enum__:"ValueType",toString:i},TFloat:{_hx_index:2,__enum__:"ValueType",toString:i},TBool:{_hx_index:3,__enum__:"ValueType",toString:i},TObject:{_hx_index:4,__enum__:"ValueType",toString:i},TFunction:{_hx_index:5,__enum__:"ValueType",toString:i},TClass:(N=function(t){return{_hx_index:6,c:t,__enum__:"ValueType",toString:i}},N.__params__=["c"],N),TEnum:(N=function(t){return{_hx_index:7,e:t,__enum__:"ValueType",toString:i}},N.__params__=["e"],N),TUnknown:{_hx_index:8,__enum__:"ValueType",toString:i}},k=function(){};(q.Type=k).__name__="Type",k.createInstance=function(t,e){return new(Function.prototype.bind.apply(t,[null].concat(e)))},k.createEnum=function(t,e,i){var n=F.field(t,e);if(null==n)throw Co.thrown("No such constructor "+e);if(F.isFunction(n)){if(null==i)throw Co.thrown("Constructor "+e+" need parameters");return n.apply(t,i)}if(null!=i&&0!=i.length)throw Co.thrown("Constructor "+e+" does not need parameters");return n},k.typeof=function(t){switch(typeof t){case"boolean":return P.TBool;case"function":return t.__name__||t.__ename__?P.TObject:P.TFunction;case"number":return Math.ceil(t)==t%2147483648?P.TInt:P.TFloat;case"object":if(null==t)return P.TNull;var e=t.__enum__;if(null!=e)return P.TEnum(T[e]);var i=Ko.getClass(t);return null!=i?P.TClass(i):P.TObject;case"string":return P.TClass(String);case"undefined":return P.TNull;default:return P.TUnknown}},k.enumEq=function(t,e){if(t==e)return!0;try{var i=t.__enum__;if(null==i||i!=e.__enum__)return!1;if(t._hx_index!=e._hx_index)return!1;for(var n=T[i],r=n[n.__constructs__[t._hx_index]].__params__,s=0;s<r.length;){var o=r[s];if(++s,!k.enumEq(t[o],e[o]))return!1}}catch(s){return!1}return!0},k.enumParameters=function(t){var e=T[t.__enum__],i=e[e.__constructs__[t._hx_index]].__params__;if(null==i)return[];for(var n=[],r=0;r<i.length;){var s=i[r];++r,n.push(t[s])}return n};var Q=function(t,e,i,n,r,s,o,a){this.id=0,this.tempId=0,this.appearance=null,this.isProtectedKey=!1,this.isUnbuildableFromAliens=!1,this.hasTeleporterOnGroup=!1,this.stresstest=!1,this.knownResourceInavailabilityLastResetDay=0,this.relevantWorldsForDirectCityConnectionsCache=null,this.surfaceShardId=-1,this.worldGroup=null,this.game=t,this.city=e,this.rect=s,this.stage=i,this.midStage=n,this.bgStage=r,this.seed=o,this.worldGlow=null,this.appearance=a;var l=new nl(o);if(null==o&&(this.seed=l.seed),0!=s.height){var h=qr.makeWorldSprite(l,s.width,s.height,a);this.worldSprite=h.sprite,this.mask=h.mask,this.worldSprite.position.set(s.x,s.y),i.cacheableChildren.push(this.worldSprite),i.isInvalid=!0}else this.worldSprite=null;for(var u=Math.ceil(s.width/20),c=[],d=0,p=u;d<p;){d++;c.push([])}this.permanents=c;for(c=[],d=0,p=u;d<p;){d++;c.push(null)}if(this.decorations=c,!g.isLoading&&0!=s.height&&"snow"!=a)for(c=0,d=u;c<d;){var f=c++;this.setDecoration("spr_grass",f)}this.reachableWorlds=[],this.knownResourceInavailability=new Vo,0==e.worlds.length?this.id=0:this.id=gr.max(e.worlds,function(t){return t.id}).id+1};(q.World=Q).__name__="World",Q.fromLoad=function(t,e,i,n,r,s){var o=t.readRectangle();t.version<56&&(o.y=20*Math.ceil(o.y/20));var a=t.bytes.getInt32(t.readStart);t.readStart+=4;var l=a,h="";41<=t.version&&(h=t.readString());for(var u=new Q(e,i,n,r,s,o,l,h),c=0,d=0,p=u.permanents;d<p.length;){var f=p[d];++d;a=t.bytes.getInt32(t.readStart);t.readStart+=4;for(var g=a,m=0,y=g;m<y;){var _=m++,v=t.bytes.getInt32(t.readStart);t.readStart+=4;var b=v;if(2==b)f.push(null);else{var w=1==b,S=t.bytes.getInt32(t.readStart);t.readStart+=4;var x=S,T=t.readString(),I=q[T],P=new vr(c,_),C=new vr(o.x+20*c,o.y-20*(1+_)),E=null==I?new Sn(e,n,s,i,u,C,P,x):w?k.createInstance(I,[e,n,s,i,u,C,P,x]):k.createInstance(I,[e,x,i,u,C,P,n]);f.push(E),E.load(t)}}if(0==g||55<=t.version&&null==f[0]){var A=t.readString();if(""!=A){var M=t.bytes.getInt32(t.readStart);t.readStart+=4;var B=M;u.setDecoration(A,c,B)}}++c}if(27<=t.version){var R=t.bytes.b[t.readStart];t.readStart+=1,u.isUnbuildableFromAliens=1==R,u.isUnbuildableFromAliens&&u.setUnbuildableAliens()}if(42<=t.version){R=t.bytes.b[t.readStart];t.readStart+=1,u.isProtectedKey=0<R}if(44<=t.version){a=t.bytes.getInt32(t.readStart);t.readStart+=4,u.id=a}return u},Q.prototype={update:function(t){this.knownResourceInavailabilityLastResetDay!=1+((0|this.city.simulation.time.timeSinceStart)/1440|0)&&(this.knownResourceInavailability=new Vo,this.knownResourceInavailabilityLastResetDay=1+((0|this.city.simulation.time.timeSinceStart)/1440|0)),this.isUnbuildableFromAliens||null==this.worldGlow||(this.worldGlow.alpha-=.1*t,this.worldGlow.alpha<=0&&(this.worldGlow.destroy(),this.worldGlow=null))},resizeInvisibleWorld:function(t,e){if(0==this.rect.height&&!(this.rect.width>e)){var i=(this.rect.x-t)/20|0;this.rect.x=t;var n=(this.rect.width=e)/20|0,r=(l=this.permanents.length-1)+1;for(this.permanents.length=n,this.decorations.length=n;0<=l;){this.permanents[l+i]=this.permanents[l];for(var s=0,o=this.permanents[l+i];s<o.length;){var a=o[s];++s,null!=a&&(a.worldPosition.x=l+i)}this.decorations[l+i]=this.decorations[l],--l}for(s=0,o=i;s<o;){var l=s++;this.permanents[l]=[],this.decorations[l]=null}for(s=r+i,o=this.permanents.length;s<o;){l=s++;this.permanents[l]=[],this.decorations[l]=null}}},canBuildOnSurface:function(){return!this.isProtectedKey&&(0!=this.rect.height&&!this.isUnbuildableFromAliens)},canBuildOnNotSurface:function(t){return!(this.isProtectedKey&&!t)},onCannotBuild:function(){this.isUnbuildableFromAliens&&this.city.gui.showSimpleWindow(Tr.lo("building_prevented_strange_force"),null,!0),this.isProtectedKey&&this.city.gui.showSimpleWindow(Tr.lo("secret_society_forbidden"),null,!0)},onCityChange:function(){this.knownResourceInavailability=new Vo},build:function(t,e,i){null!=i&&0!=i||this.removeDecoration(e);var n=this.permanents[e].length,r=null==i?n:i;if(n<r)for(var s=0,o=r-n;s<o;){var a=s++;this.permanents[e].push(null)}var l=k.createInstance(t,[this.game,this.stage,this.bgStage,this.city,this,new vr(this.rect.x+20*e,this.rect.y-20*(1+r)),new vr(e,r),this.city.maxPermanentID++]);if(r<this.permanents[e].length&&null==this.permanents[e][r])this.permanents[e][r]=l;else if(null==i)this.permanents[e].push(l);else{this.permanents[e].splice(i,0,l);for(s=r+1,o=n+1;s<o;){a=s++;if(null==this.permanents[e][a]){this.permanents[e].splice(a,1);break}}}for(s=0,o=this.city.miscCityElements.allMiscElements;s<o.length;){var h=o[s];if(++s,h.is(Qo)){var u=h;u.position.x==l.position.x&&u.position.y==l.position.y&&(u.rect.x==u.position.x?u.position.x+=20:u.position.x-=20)}}return l.onBuild(),l},createWorldResource:function(t,e){this.removeDecoration(e);var i=k.createInstance(t,[this.game,this.city.maxPermanentID++,this.city,this,new vr(this.rect.x+20*e,this.rect.y-20),new vr(e,0),this.stage]);return this.permanents[e][0]=i},setDecoration:function(t,e,i){this.removeDecoration(e),0<this.permanents[e].length&&null!=this.permanents[e][0]||(this.decorations[e]=new Hr(this.stage,new vr(this.rect.x+20*e,this.rect.y-20),t,i))},removeDecoration:function(t){null!=this.decorations[t]&&(this.decorations[t].destroy(),this.decorations[t]=null)},handleMouse:function(t){var e;if(this.stresstest){var i=this.rect,n=i.x;i.y;e=0==n}else e=!1;if(e){this.stresstest=!1;for(var r=0;r<1250;){r++;var s=il.getInt(this.permanents.length);0!=this.permanents[s].length&&!this.permanents[s][this.permanents[s].length-1].isBuilding||this.build(Bi,s);var o=il.getInt(this.permanents.length);0!=this.permanents[o].length&&!this.permanents[o][this.permanents[o].length-1].isBuilding||this.build(di,o)}this.city.connections.updateCityConnections(),this.city.simulation.updatePathfinder(!1)}if(t.get_cityX()>=this.rect.x&&t.get_cityX()<this.rect.x+this.rect.width&&t.get_cityY()<this.rect.y){var a=this.permanents[(t.get_cityX()-this.rect.x)/20|0],l=(this.rect.y-(t.get_cityY()+1))/20|0;if(l>=a.length&&l<=a.length+3&&0<a.length&&null!=a[a.length-1]&&a[a.length-1].is(Hi)&&(l=a.length-1),l<a.length&&null!=a[l])switch(t.claimMouse(a[l],null,!1)._hx_index){case 0:return a[l].onHover(!0),!0;case 1:return a[l].onClick(),!0;case 2:return a[l].onHover(!1),!1}}return!1},save:function(t){t.addRectangle(this.rect);var e=this.seed;if(t.size+4>t.bytes.length){var i=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+4))),t.bytes.blit(0,i,0,t.size)}t.bytes.setInt32(t.size,e),t.size+=4,null==this.appearance?t.addString(""):t.addString(this.appearance);for(var n=0,r=this.permanents.length;n<r;){var s=n++,o=this.permanents[s];e=o.length;if(t.size+4>t.bytes.length){i=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+4))),t.bytes.blit(0,i,0,t.size)}t.bytes.setInt32(t.size,e),t.size+=4;for(var a=0;a<o.length;){var l=o[a];if(++a,null==l){if(t.size+4>t.bytes.length){var h=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+4))),t.bytes.blit(0,h,0,t.size)}t.bytes.setInt32(t.size,2),t.size+=4}else{var u=l.isBuilding?1:0;if(t.size+4>t.bytes.length){var c=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+4))),t.bytes.blit(0,c,0,t.size)}t.bytes.setInt32(t.size,u),t.size+=4;var d=l.id;if(t.size+4>t.bytes.length){var p=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+4))),t.bytes.blit(0,p,0,t.size)}t.bytes.setInt32(t.size,d),t.size+=4,t.addString(l.className),l.save(t)}}if(0==o.length||null==o[0])if(null!=this.decorations[s]){t.addString(this.decorations[s].textureName);var f=this.decorations[s].subImage;if(t.size+4>t.bytes.length){var g=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+4))),t.bytes.blit(0,g,0,t.size)}t.bytes.setInt32(t.size,f),t.size+=4}else t.addString("")}e=this.isUnbuildableFromAliens?1:0;if(t.size+1>t.bytes.length){i=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+1))),t.bytes.blit(0,i,0,t.size)}t.bytes.b[t.size]=e,t.size+=1;e=this.isProtectedKey;if(t.size+1>t.bytes.length){i=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+1))),t.bytes.blit(0,i,0,t.size)}t.bytes.b[t.size]=e?1:0,t.size+=1;e=this.id;if(t.size+4>t.bytes.length){i=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+4))),t.bytes.blit(0,i,0,t.size)}t.bytes.setInt32(t.size,e),t.size+=4},setUnbuildableAliens:function(){null==this.worldGlow&&(this.worldGlow=new PIXI.Sprite(dt.getTexture("spr_blueworldglow")),this.worldGlow.width=this.rect.width,this.worldGlow.position.set(this.rect.x,this.rect.y-4),this.stage.addChild(this.worldGlow),this.isUnbuildableFromAliens=!0)},setProtectedKey:function(){this.isProtectedKey=!0},makeBuildableAliens:function(){this.isUnbuildableFromAliens=!1},cleanup:function(){if(null!=this.worldSprite){var t=this.worldSprite.texture,e=this.stage,i=this.worldSprite,n=!0;null==n&&(n=!1),at.remove(e.cacheableChildren,i),e.isInvalid=!0,i.destroy({children:!0,texture:n}),t.destroy(!0)}},__class__:Q};var E=function(t,e,i,n,r,s,o,a){this.stage=o,this.sprite=new PIXI.Sprite(a),o.addChild(this.sprite),y.call(this,t,e,i,n,r,s),this.positionSprites()};(q.WorldResource=E).__name__="WorldResource",E.__super__=y,E.prototype=e(y.prototype,{destroy:function(){y.prototype.destroy.call(this),this.sprite.destroy(),this.city.simulation.resourcePriorityManager.deprioritize(this)},positionSprites:function(){y.prototype.positionSprites.call(this),this.sprite.position.set(this.position.x,this.position.y)},__class__:E});function D(t,e,i,n){s.call(this,i,n),n.extraQuality+=25,n.extraCapacity+=50}(q["buildingUpgrades.AIAssistedDiagnosis"]=D).__name__="buildingUpgrades.AIAssistedDiagnosis",D.__super__=s,D.prototype=e(s.prototype,{get_textureName:function(){return"spr_smartdiagnose"},destroy:function(){s.prototype.destroy.call(this);var t=this.building;t.extraQuality-=25,t.extraCapacity-=50},__class__:D});function z(t,e,i,n){s.call(this,i,n),n.stoneMinedPerActionBoost+=.3}(q["buildingUpgrades.AIMining"]=z).__name__="buildingUpgrades.AIMining",z.__super__=s,z.prototype=e(s.prototype,{get_textureName:function(){return"spr_aiMining"},destroy:function(){s.prototype.destroy.call(this),this.building.stoneMinedPerActionBoost-=.3},__class__:z});function W(t,e,i,n){s.call(this,null,n),n.regrowSpeedBoost+=2}(q["buildingUpgrades.AutomaticWaterManagement"]=W).__name__="buildingUpgrades.AutomaticWaterManagement",W.__super__=s,W.prototype=e(s.prototype,{destroy:function(){s.prototype.destroy.call(this),this.building.regrowSpeedBoost-=2},__class__:W});function G(t,e,i,n){s.call(this,null,n),n.nightClubEntertainmentQuantity+=40,this.addedLasers=[],this.addedLasers.push({start:new br(7,4),end:new br(6,18),hue:90,speed:.5,targetLaserHue:-1,laserSprite:null}),this.addedLasers.push({start:new br(12,4),end:new br(6,18),hue:270,speed:-.5,targetLaserHue:-1,laserSprite:null}),lt.iter(this.addedLasers,function(t){n.lasers.push(t)})}(q["buildingUpgrades.BetterLightShow"]=G).__name__="buildingUpgrades.BetterLightShow",G.__super__=s,G.prototype=e(s.prototype,{destroy:function(){s.prototype.destroy.call(this);var e=this.building;e.nightClubEntertainmentQuantity-=40,lt.iter(this.addedLasers,function(t){at.remove(e.lasers,t)})},__class__:G});function H(t,e,i,n){s.call(this,i,n),n.stoneMinedPerActionBoost+=.2}(q["buildingUpgrades.BetterPickaxes"]=H).__name__="buildingUpgrades.BetterPickaxes",H.__super__=s,H.prototype=e(s.prototype,{get_textureName:function(){return"spr_improvedpickaxes"},destroy:function(){s.prototype.destroy.call(this),this.building.stoneMinedPerActionBoost-=.2},__class__:H});function X(t,e,i,n){s.call(this,i,n)}(q["buildingUpgrades.BetterTools"]=X).__name__="buildingUpgrades.BetterTools",X.__super__=s,X.prototype=e(s.prototype,{get_textureName:function(){return"spr_tinkerershouse_bettertools"},get_bonusAttractiveness:function(){return 20},__class__:X});function j(t,e,i,n){s.call(this,i,n),n.extraCapacity+=1}(q["buildingUpgrades.BiggerTV"]=j).__name__="buildingUpgrades.BiggerTV",j.__super__=s,j.prototype=e(s.prototype,{get_textureName:function(){return"spr_biggertv"},get_bonusAttractiveness:function(){return 5},destroy:function(){s.prototype.destroy.call(this),this.building.extraCapacity-=1},__class__:j});function V(t,e,i,n){s.call(this,null,n),2!=n.materialType&&n.resetProgress(),n.setMaterialType(2)}(q["buildingUpgrades.CHProduceFood"]=V).__name__="buildingUpgrades.CHProduceFood",V.__super__=s,V.prototype=e(s.prototype,{destroy:function(){s.prototype.destroy.call(this)},__class__:V});function J(t,e,i,n){s.call(this,null,n),0!=n.materialType&&n.resetProgress(),n.setMaterialType(0)}(q["buildingUpgrades.CHProduceStone"]=J).__name__="buildingUpgrades.CHProduceStone",J.__super__=s,J.prototype=e(s.prototype,{destroy:function(){s.prototype.destroy.call(this)},__class__:J});function Z(t,e,i,n){s.call(this,null,n),1!=n.materialType&&n.resetProgress(),n.setMaterialType(1)}(q["buildingUpgrades.CHProduceWood"]=Z).__name__="buildingUpgrades.CHProduceWood",Z.__super__=s,Z.prototype=e(s.prototype,{destroy:function(){s.prototype.destroy.call(this)},__class__:Z});function tt(t,e,i,n){s.call(this,null,n),n.bldMode=0}(q["buildingUpgrades.CensusData"]=tt).__name__="buildingUpgrades.CensusData",tt.__super__=s,tt.prototype=e(s.prototype,{destroy:function(){s.prototype.destroy.call(this)},__class__:tt});function et(t,e,i,n){s.call(this,i,n)}(q["buildingUpgrades.ComfortableCouch"]=et).__name__="buildingUpgrades.ComfortableCouch",et.__super__=s,et.prototype=e(s.prototype,{get_textureName:function(){return"spr_comfortablecouch"},get_bonusAttractiveness:function(){return 15},destroy:function(){s.prototype.destroy.call(this)},__class__:et});function it(t,e,i,n){s.call(this,null,n),n.adjecentBuildingEffects.push({name:"restaurantCapBoost",intensity:10}),n.drawer.changeMainTexture("spr_herbgarden"),n.drawer.changeTextureGroup("spr_restaurant"),n.changePlantsTexture(2*il.getInt(n.herbTextures.length/2|0))}(q["buildingUpgrades.CulinaryHerbs"]=it).__name__="buildingUpgrades.CulinaryHerbs",it.__super__=s,it.prototype=e(s.prototype,{destroy:function(){s.prototype.destroy.call(this);var t=lt.find(this.building.adjecentBuildingEffects,function(t){return"restaurantCapBoost"==t.name});at.remove(this.building.adjecentBuildingEffects,t)},__class__:it});function nt(t,e,i,n){s.call(this,e,n),n.efficiency-=2,n.materialsMadePerStepPerWorker+=5e-5}(q["buildingUpgrades.DieShrink"]=nt).__name__="buildingUpgrades.DieShrink",nt.__super__=s,nt.prototype=e(s.prototype,{get_textureName:function(){return"spr_dieshrink"},destroy:function(){s.prototype.destroy.call(this);var t=this.building;t.efficiency+=2,t.materialsMadePerStepPerWorker-=5e-5},__class__:nt});function rt(t,e,i,n){s.call(this,null,n),n.buildingEnabled=!1}(q["buildingUpgrades.FactoryDisabled"]=rt).__name__="buildingUpgrades.FactoryDisabled",rt.__super__=s,rt.prototype=e(s.prototype,{destroy:function(){s.prototype.destroy.call(this),this.building.buildingEnabled=!0},__class__:rt});function ut(t,e,i,n){s.call(this,null,n),n.currentMaterialUsed=0}(q["buildingUpgrades.FactoryUsingFood"]=ut).__name__="buildingUpgrades.FactoryUsingFood",ut.__super__=s,ut.prototype=e(s.prototype,{__class__:ut});function pt(t,e,i,n){s.call(this,null,n),n.currentMaterialUsed=1}(q["buildingUpgrades.FactoryUsingWood"]=pt).__name__="buildingUpgrades.FactoryUsingWood",pt.__super__=s,pt.prototype=e(s.prototype,{__class__:pt});function ft(t,e,i,n){s.call(this,null,n),n.buildingEnabled=!0}(q["buildingUpgrades.FactoryWorking"]=ft).__name__="buildingUpgrades.FactoryWorking",ft.__super__=s,ft.prototype=e(s.prototype,{__class__:ft});function gt(t,e,i,n){s.call(this,e,n),this.myEffect={name:"increaseCropNumber",intensity:7.5},n.adjecentBuildingEffects.push(this.myEffect)}(q["buildingUpgrades.FarmingResearch"]=gt).__name__="buildingUpgrades.FarmingResearch",gt.__super__=s,gt.prototype=e(s.prototype,{get_textureName:function(){return"spr_upgrade_farmboost"},destroy:function(){s.prototype.destroy.call(this),at.remove(this.building.adjecentBuildingEffects,this.myEffect)},__class__:gt});function mt(t,e,i,n){s.call(this,e,n)}(q["buildingUpgrades.Flowers"]=mt).__name__="buildingUpgrades.Flowers",mt.__super__=s,mt.prototype=e(s.prototype,{get_textureName:function(){return"spr_upgrade_flowers"},get_bonusAttractiveness:function(){return 5},__class__:mt});function yt(t,e,i,n){s.call(this,i,n),n.city.upgrades.vars.stoneResearchCenterWithFossils=n}(q["buildingUpgrades.FossilScanner"]=yt).__name__="buildingUpgrades.FossilScanner",yt.__super__=s,yt.prototype=e(s.prototype,{get_textureName:function(){return"spr_stoneresearchcentre_computer"},destroy:function(){s.prototype.destroy.call(this),this.building.city.upgrades.vars.stoneResearchCenterWithFossils=null},__class__:yt});function _t(t,e,i,n){s.call(this,e,n),n.materialsMadePerStepPerWorker+=625e-7}(q["buildingUpgrades.GrapheneFactoryImprovement"]=_t).__name__="buildingUpgrades.GrapheneFactoryImprovement",_t.__super__=s,_t.prototype=e(s.prototype,{get_textureName:function(){return"spr_dieshrink"},destroy:function(){s.prototype.destroy.call(this),this.building.materialsMadePerStepPerWorker-=625e-7},__class__:_t});function vt(t,e,i,n){s.call(this,null,n),n.hasHeatedBed=!0,n.onCityChange()}(q["buildingUpgrades.HeatedBed"]=vt).__name__="buildingUpgrades.HeatedBed",vt.__super__=s,vt.prototype=e(s.prototype,{get_bonusAttractiveness:function(){return 20},destroy:function(){s.prototype.destroy.call(this),this.building.hasHeatedBed=!1},__class__:vt});function bt(t,e,i,n){s.call(this,i,n)}(q["buildingUpgrades.IndoorPond"]=bt).__name__="buildingUpgrades.IndoorPond",bt.__super__=s,bt.prototype=e(s.prototype,{get_textureName:function(){return"spr_communityhouse_indoorpond"},get_bonusAttractiveness:function(){return 15},__class__:bt});function wt(t,e,i,n){s.call(this,null,n),n.buildingEnabled=!1}(q["buildingUpgrades.LabDisabled"]=wt).__name__="buildingUpgrades.LabDisabled",wt.__super__=s,wt.prototype=e(s.prototype,{destroy:function(){s.prototype.destroy.call(this),this.building.buildingEnabled=!0},__class__:wt});function St(t,e,i,n){s.call(this,null,n),n.buildingEnabled=!0}(q["buildingUpgrades.LabWorking"]=St).__name__="buildingUpgrades.LabWorking",St.__super__=s,St.prototype=e(s.prototype,{__class__:St});function xt(t,e,i,n){s.call(this,i,n)}(q["buildingUpgrades.LivingComputer"]=xt).__name__="buildingUpgrades.LivingComputer",xt.__super__=s,xt.prototype=e(s.prototype,{get_textureName:function(){return"spr_alienhouse_livingcomputer"},get_bonusAttractiveness:function(){return 20},__class__:xt});function Tt(t,e,i,n){s.call(this,null,n),n.efficiency-=1}(q["buildingUpgrades.MachinePartsFactoryEfficiency"]=Tt).__name__="buildingUpgrades.MachinePartsFactoryEfficiency",Tt.__super__=s,Tt.prototype=e(s.prototype,{destroy:function(){s.prototype.destroy.call(this),this.building.efficiency+=1},__class__:Tt});function It(t,e,i,n){s.call(this,null,n),n.buildingEnabled=!0,n.efficiency+=2,n.materialsMadePerStepPerWorker+=.0015}(q["buildingUpgrades.MachinePartsFactoryTurbo"]=It).__name__="buildingUpgrades.MachinePartsFactoryTurbo",It.__super__=s,It.prototype=e(s.prototype,{destroy:function(){s.prototype.destroy.call(this);var t=this.building;t.efficiency-=2,t.materialsMadePerStepPerWorker-=.0015},__class__:It});function Pt(t,e,i,n){s.call(this,null,n),n.medicalEducationPart=1}(q["buildingUpgrades.MedicalEducation"]=Pt).__name__="buildingUpgrades.MedicalEducation",Pt.__super__=s,Pt.prototype=e(s.prototype,{destroy:function(){s.prototype.destroy.call(this),this.building.medicalEducationPart=0},__class__:Pt});function Ct(t,e,i,n){s.call(this,null,n),n.drawer.changeMainTexture("spr_herbgarden_medic"),n.drawer.changeTextureGroup("spr_botanicalgardens"),n.isMedical=!0,n.changePlantsTexture(2*il.getInt(n.herbTextures.length/2|0)+1)}(q["buildingUpgrades.MedicalHerbs"]=Ct).__name__="buildingUpgrades.MedicalHerbs",Ct.__super__=s,Ct.prototype=e(s.prototype,{destroy:function(){s.prototype.destroy.call(this),this.building.isMedical=!1},__class__:Ct});function Et(t,e,i,n){s.call(this,e,n)}(q["buildingUpgrades.MiniChristmasTree"]=Et).__name__="buildingUpgrades.MiniChristmasTree",Et.__super__=s,Et.prototype=e(s.prototype,{get_textureName:function(){return"spr_upgrade_christmastree"},get_bonusAttractiveness:function(){return 5},__class__:Et});function At(t,e,i,n){s.call(this,null,n),n.mode=Pi.Always}(q["buildingUpgrades.MisdirectorAlways"]=At).__name__="buildingUpgrades.MisdirectorAlways",At.__super__=s,At.prototype=e(s.prototype,{destroy:function(){s.prototype.destroy.call(this),this.building.mode=Pi.Always},__class__:At});function Mt(t,e,i,n){s.call(this,null,n),n.mode=Pi.Disabled,dr.achieve("DISABLE_MISDIRECTOR")}(q["buildingUpgrades.MisdirectorDisabled"]=Mt).__name__="buildingUpgrades.MisdirectorDisabled",Mt.__super__=s,Mt.prototype=e(s.prototype,{destroy:function(){s.prototype.destroy.call(this),this.building.mode=Pi.Disabled},__class__:Mt});function Bt(t,e,i,n){s.call(this,null,n),n.mode=Pi.MostlyDisabled}(q["buildingUpgrades.MisdirectorMostlyDisabled"]=Bt).__name__="buildingUpgrades.MisdirectorMostlyDisabled",Bt.__super__=s,Bt.prototype=e(s.prototype,{destroy:function(){s.prototype.destroy.call(this),this.building.mode=Pi.Normal},__class__:Bt});function Rt(t,e,i,n){s.call(this,null,n),n.mode=Pi.Normal}(q["buildingUpgrades.MisdirectorNormal"]=Rt).__name__="buildingUpgrades.MisdirectorNormal",Rt.__super__=s,Rt.prototype=e(s.prototype,{destroy:function(){s.prototype.destroy.call(this),this.building.mode=Pi.Normal},__class__:Rt});function Ot(t,e,i,n){s.call(this,i,n)}(q["buildingUpgrades.ModernConveniences"]=Ot).__name__="buildingUpgrades.ModernConveniences",Ot.__super__=s,Ot.prototype=e(s.prototype,{get_textureName:function(){return"spr_modernconveniences"},get_bonusAttractiveness:function(){return 15},__class__:Ot});function kt(t,e,i,n){s.call(this,i,n),n.yearsToLiveLongerPerYearIfLivingHere+=.05}(q["buildingUpgrades.ModernHomePlant"]=kt).__name__="buildingUpgrades.ModernHomePlant",kt.__super__=s,kt.prototype=e(s.prototype,{get_textureName:function(){return"spr_modernhomeplant"},get_bonusAttractiveness:function(){return 10},get_availableTextures:function(){return this.textures.length-(O.hasSecretCode("orchid")?0:3)},destroy:function(){s.prototype.destroy.call(this),this.building.yearsToLiveLongerPerYearIfLivingHere-=.05},__class__:kt});function Dt(t,e,i,n){s.call(this,null,n),n.bldMode=1}(q["buildingUpgrades.NightMayor"]=Dt).__name__="buildingUpgrades.NightMayor",Dt.__super__=s,Dt.prototype=e(s.prototype,{destroy:function(){s.prototype.destroy.call(this)},__class__:Dt});function Ft(t,e,i,n){s.call(this,i,n),n.hasPickaxeTech=!0}(q["buildingUpgrades.PickaxeTech"]=Ft).__name__="buildingUpgrades.PickaxeTech",Ft.__super__=s,Ft.prototype=e(s.prototype,{get_textureName:function(){return"spr_stoneresearchcentre_pickaxetech"},destroy:function(){s.prototype.destroy.call(this),this.building.hasPickaxeTech=!1},__class__:Ft});function Nt(t,e,i,n){s.call(this,null,n),n.efficiencyNorm-=1,n.materialsMadePerStepPerWorkerNorm+=15e-5,n.onCityChange()}(q["buildingUpgrades.RefinedMetalFactoryEfficiency"]=Nt).__name__="buildingUpgrades.RefinedMetalFactoryEfficiency",Nt.__super__=s,Nt.prototype=e(s.prototype,{destroy:function(){s.prototype.destroy.call(this),this.building.efficiencyNorm+=1,this.building.materialsMadePerStepPerWorkerNorm-=15e-5,this.building.onCityChange()},__class__:Nt});function Lt(t,e,i,n){s.call(this,null,n),n.buildingEnabled=!0,n.efficiencyNorm+=1,n.materialsMadePerStepPerWorkerNorm+=5e-4,n.onCityChange()}(q["buildingUpgrades.RefinedMetalsFactoryHack"]=Lt).__name__="buildingUpgrades.RefinedMetalsFactoryHack",Lt.__super__=s,Lt.prototype=e(s.prototype,{destroy:function(){s.prototype.destroy.call(this);var t=this.building;t.efficiencyNorm-=1,t.materialsMadePerStepPerWorkerNorm-=5e-4,this.building.onCityChange()},__class__:Lt});function Ut(t,e,i,n){rt.call(this,t,e,i,n)}(q["buildingUpgrades.RefinedStoneUsingFactoryDisabled"]=Ut).__name__="buildingUpgrades.RefinedStoneUsingFactoryDisabled",Ut.__super__=rt,Ut.prototype=e(rt.prototype,{__class__:Ut});function zt(t,e,i,n){s.call(this,null,n),n.efficiency-=.5,n.materialsMadePerStepPerWorker+=5e-4}(q["buildingUpgrades.RocketFuelFactoryEfficiency"]=zt).__name__="buildingUpgrades.RocketFuelFactoryEfficiency",zt.__super__=s,zt.prototype=e(s.prototype,{destroy:function(){s.prototype.destroy.call(this),this.building.efficiency+=.5,this.building.materialsMadePerStepPerWorker+=5e-4},__class__:zt});function Wt(t,e,i,n){s.call(this,i,n)}(q["buildingUpgrades.SmartChairs"]=Wt).__name__="buildingUpgrades.SmartChairs",Wt.__super__=s,Wt.prototype=e(s.prototype,{get_textureName:function(){return"spr_smartchairs"},get_bonusAttractiveness:function(){return 10},__class__:Wt});function Gt(t,e,i,n){this.lightColor=[{color:14680064,time:0},{color:14680064,time:4},{color:16777215,time:6},{color:16777215,time:19},{color:16766023,time:21},{color:16766023,time:23},{color:14680064,time:24}];var r=this;s.call(this,i,n),this.set_onUpdate(function(t){r.sprite.tint=n.city.simulation.time.getCurrentColor(r.lightColor)})}(q["buildingUpgrades.SmartLights"]=Gt).__name__="buildingUpgrades.SmartLights",Gt.__super__=s,Gt.prototype=e(s.prototype,{get_textureName:function(){return"spr_smartlights"},get_bonusAttractiveness:function(){return 15},get_canCacheSprite:function(){return!1},__class__:Gt});function Ht(t,e,i,n){s.call(this,i,n)}(q["buildingUpgrades.SmartSpeaker"]=Ht).__name__="buildingUpgrades.SmartSpeaker",Ht.__super__=s,Ht.prototype=e(s.prototype,{get_textureName:function(){return"spr_smartspeaker"},get_bonusAttractiveness:function(){return 10},destroy:function(){s.prototype.destroy.call(this)},__class__:Ht});function Xt(t,e,i,n){s.call(this,i,n)}(q["buildingUpgrades.SofterBeds"]=Xt).__name__="buildingUpgrades.SofterBeds",Xt.__super__=s,Xt.prototype=e(s.prototype,{get_textureName:function(){return"spr_softerbeds"},get_bonusAttractiveness:function(){return 10},__class__:Xt});function jt(t,e,i,n){s.call(this,null,n)}(q["buildingUpgrades.SoundProofing"]=jt).__name__="buildingUpgrades.SoundProofing",jt.__super__=s,jt.prototype=e(s.prototype,{get_bonusAttractiveness:function(){return 12},destroy:function(){s.prototype.destroy.call(this)},__class__:jt});function Vt(t,e,i,n){s.call(this,i,n),n.hasStarDatabase=!0}(q["buildingUpgrades.StarDatabase"]=Vt).__name__="buildingUpgrades.StarDatabase",Vt.__super__=s,Vt.prototype=e(s.prototype,{get_textureName:function(){return"spr_computer_observatory"},destroy:function(){s.prototype.destroy.call(this),this.building.hasStarDatabase=!1},__class__:Vt});function Yt(t,e,i,n){s.call(this,i,n),n.hasRemoteControl=!0}(q["buildingUpgrades.StoneTeleporterRemote"]=Yt).__name__="buildingUpgrades.StoneTeleporterRemote",Yt.__super__=s,Yt.prototype=e(s.prototype,{get_textureName:function(){return"spr_stoneteleporter_remote"},destroy:function(){s.prototype.destroy.call(this),this.building.hasRemoteControl=!1},__class__:Yt});function qt(t,e,i,n){rt.call(this,t,e,i,n)}(q["buildingUpgrades.StoneUsingFactoryDisabled"]=qt).__name__="buildingUpgrades.StoneUsingFactoryDisabled",qt.__super__=rt,qt.prototype=e(rt.prototype,{__class__:qt});function Kt(t,e,i,n){s.call(this,null,n),n.hasUpgrade=!0}(q["buildingUpgrades.TheMachineUpgrade"]=Kt).__name__="buildingUpgrades.TheMachineUpgrade",Kt.__super__=s,Kt.prototype=e(s.prototype,{destroy:function(){s.prototype.destroy.call(this),this.building.hasUpgrade=!1},__class__:Kt});function $t(t,e,i,n){s.call(this,t,n),this.myEffect={name:"increaseTreeGrowth",intensity:.2},n.adjecentBuildingEffects.push(this.myEffect)}(q["buildingUpgrades.TreePlantationResearch"]=$t).__name__="buildingUpgrades.TreePlantationResearch",$t.__super__=s,$t.prototype=e(s.prototype,{get_textureName:function(){return"spr_treegrowthboost"},destroy:function(){s.prototype.destroy.call(this),at.remove(this.building.adjecentBuildingEffects,this.myEffect)},__class__:$t});function Qt(t,e,i,n){s.call(this,i,n),n.efficiency-=.058}(q["buildingUpgrades.UltimateScrewdriver"]=Qt).__name__="buildingUpgrades.UltimateScrewdriver",Qt.__super__=s,Qt.prototype=e(s.prototype,{get_textureName:function(){return"spr_experimentationlab_screwdriver"},get_canCacheSprite:function(){return!1},destroy:function(){s.prototype.destroy.call(this),this.building.efficiency+=.058},__class__:Qt});function Jt(t,e,i,n){s.call(this,i,n),n.isProducingKnowledge=!0}(q["buildingUpgrades.WorkshopKnowledge"]=Jt).__name__="buildingUpgrades.WorkshopKnowledge",Jt.__super__=s,Jt.prototype=e(s.prototype,{get_textureName:function(){return"spr_workshop_petprojects"},destroy:function(){s.prototype.destroy.call(this)},__class__:Jt});function Zt(t,e,i,n){s.call(this,i,n),n.isProducingKnowledge=!1}(q["buildingUpgrades.WorkshopMachineParts"]=Zt).__name__="buildingUpgrades.WorkshopMachineParts",Zt.__super__=s,Zt.prototype=e(s.prototype,{get_textureName:function(){return"spr_workshop_makemachineparts"},destroy:function(){s.prototype.destroy.call(this)},__class__:Zt});function te(t,e,i,n,r,s,o,a){this.timeWorking=0,_.call(this,t,e,i,n,r,s,o,a)}(q["buildings.AlienDecryptor"]=te).__name__="buildings.AlienDecryptor",te.__super__=_,te.prototype=e(_.prototype,{update:function(t){this.timeWorking+=t*this.city.simulation.time.minutesPerTick},save:function(t,e){null==e&&(e=!0),_.prototype.save.call(this,t),e&&t.addString(te.saveDefinition);var i=this.timeWorking;if(t.size+8>t.bytes.length){var n=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+8))),t.bytes.blit(0,n,0,t.size)}t.bytes.setDouble(t.size,i),t.size+=8},load:function(t,e){_.prototype.load.call(this,t),null==e&&(e=t.readString());var i=Dr.makeLoadMap(e,t);Object.prototype.hasOwnProperty.call(i.h,"timeWorking")&&(this.timeWorking=i.h.timeWorking)},__class__:te});var ee=function(t,e,i,n,r,s,o,a){this.workTimePreferenceMod=1,this.endTime=19,this.startTime=6,this.workers=[],_.call(this,t,e,i,n,r,s,o,a)};(q["buildings.Work"]=ee).__name__="buildings.Work",ee.__super__=_,ee.prototype=e(_.prototype,{get_jobs:function(){return null==this.info.jobs?0:this.info.jobs},get_remainingCapacity:function(){return this.get_jobs()-this.workers.length},get_firstBuildingToGoTo:function(){return this},destroy:function(){for(_.prototype.destroy.call(this);0!=this.workers.length;)this.workers[this.workers.length-1].loseJob()},work:function(t,e,i){i&&(t.currentAction=2)},addWindowInfoLines:function(){var t=this;_.prototype.addWindowInfoLines.call(this);var e=this.city.gui,i=dt.getTexture("spr_work"),n=this.city,r=this.workers,s=Tr.lo("workers_of",[this.get_name()]),o=this,a=Tr.lo("no_workers");e.windowAddSimpleButton(i,function(){Vs.createWindow(n,r,s,o,a)},null,function(){return Tr.lo("workers",[t.workers.length,t.get_jobs()])})},afterGiveJob:function(t){},__class__:ee});function ie(t,e,i,n,r,s,o,a){this.percentCleaned=0,this.foodLeft=0,this.percentGrown=20,this.farmStage=0,ee.call(this,t,e,i,n,r,s,o,a),this.textures=dt.getTexturesByWidth("spr_alienfarm_crops",20),this.growthSprite=new PIXI.Sprite,i.addChild(this.growthSprite),this.updateTexture(),this.positionSprites(),this.doorX=12,this.adjecentBuildingEffects.push({name:"farm",intensity:1})}(q["buildings.AlienFarm"]=ie).__name__="buildings.AlienFarm",ie.__super__=ee,ie.prototype=e(ee.prototype,{postLoad:function(){this.updateTexture()},work:function(t,e,i){var r=this;if(i)t.currentAction=2;else{var n=(1==this.farmStage?15:30)/this.city.simulation.happiness.actionSpeedModifierWithoutPenalties|0,s=(1==this.farmStage?30:60)/this.city.simulation.happiness.actionSpeedModifierWithoutPenalties|0,o=!1;null==o&&(o=!1),t.moveAndWait(il.getInt(3,15),il.getInt(n,s),function(){switch(r.farmStage){case 0:if(r.percentGrown+=2*r.city.simulation.bonuses.indoorFarmSpeed,100<=r.percentGrown){r.farmStage=1;var t=20+r.city.simulation.bonuses.extraFoodFromFarms,e=5*r.getEffectsOfAdjecentBuildings("alienHouse");r.foodLeft=t+e}r.updateTexture();break;case 1:var i=.3*r.city.simulation.boostManager.currentGlobalBoostAmount;r.foodLeft-=i;var n=r.city.materials;n.set_food(n.food+i),r.city.simulation.stats.materialProduction[0][0]+=i,r.foodLeft<=0&&(r.percentCleaned=0,r.farmStage=2),r.updateTexture();break;case 2:r.percentCleaned+=5,100<=r.percentCleaned&&(r.farmStage=0,r.percentGrown=0),r.updateTexture()}},o,!1)}},destroy:function(){ee.prototype.destroy.call(this),this.growthSprite.destroy()},update:function(t){if(0==this.farmStage){var e=this.city.simulation.time.timeSinceStart/60%24;if((i=7)<(n=20)?i<=e&&e<n:i<=e||e<n)this.percentGrown+=.05*t*this.city.simulation.bonuses.indoorFarmSpeed,100<=this.percentGrown&&(this.farmStage=1,this.foodLeft=20+this.city.simulation.bonuses.extraFoodFromFarms+5*this.getEffectsOfAdjecentBuildings("alienHouse")),this.updateTexture();else{var i,n;e=this.city.simulation.time.timeSinceStart/60%24;((i=6)<(n=21)?i<=e&&e<n:i<=e||e<n)&&(this.percentGrown+=.025*t*this.city.simulation.bonuses.indoorFarmSpeed,100<=this.percentGrown&&(this.farmStage=1,this.foodLeft=20+this.city.simulation.bonuses.extraFoodFromFarms+5*this.getEffectsOfAdjecentBuildings("alienHouse")),this.updateTexture())}}},grow:function(t){this.percentGrown+=t,100<=this.percentGrown&&(this.farmStage=1,this.foodLeft=20+this.city.simulation.bonuses.extraFoodFromFarms+5*this.getEffectsOfAdjecentBuildings("alienHouse")),this.updateTexture()},updateTexture:function(){var t;switch(this.farmStage){case 0:t=this.textures[Math.floor(this.percentGrown/100*(this.textures.length-2))];break;case 1:t=this.textures[this.textures.length-2];break;case 2:t=this.textures[this.textures.length-1]}this.growthSprite.texture=t},positionSprites:function(){ee.prototype.positionSprites.call(this),null!=this.growthSprite&&this.growthSprite.position.set(this.position.x,this.position.y)},addWindowInfoLines:function(){var t=this;ee.prototype.addWindowInfoLines.call(this),this.city.gui.windowAddInfoText(null,function(){switch(t.farmStage){case 0:return Tr.lo("crops_grown",[Math.floor(t.percentGrown)]);case 1:return Tr.lo("food_left",[Math.floor(t.foodLeft)]);case 2:return Tr.lo("percent_cleaned",[Math.floor(t.percentCleaned)])}})},save:function(t,e){null==e&&(e=!0),ee.prototype.save.call(this,t),e&&t.addString(ie.saveDefinition);var i=this.farmStage;if(t.size+4>t.bytes.length){var n=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+4))),t.bytes.blit(0,n,0,t.size)}t.bytes.setInt32(t.size,i),t.size+=4;i=this.percentGrown;if(t.size+8>t.bytes.length){n=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+8))),t.bytes.blit(0,n,0,t.size)}t.bytes.setDouble(t.size,i),t.size+=8;i=this.foodLeft;if(t.size+8>t.bytes.length){n=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+8))),t.bytes.blit(0,n,0,t.size)}t.bytes.setDouble(t.size,i),t.size+=8;i=this.percentCleaned;if(t.size+8>t.bytes.length){n=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+8))),t.bytes.blit(0,n,0,t.size)}t.bytes.setDouble(t.size,i),t.size+=8},load:function(t,e){ee.prototype.load.call(this,t),null==e&&(e=t.readString());var i=Dr.makeLoadMap(e,t);Object.prototype.hasOwnProperty.call(i.h,"farmStage")&&(this.farmStage=i.h.farmStage),Object.prototype.hasOwnProperty.call(i.h,"percentGrown")&&(this.percentGrown=i.h.percentGrown),Object.prototype.hasOwnProperty.call(i.h,"foodLeft")&&(this.foodLeft=i.h.foodLeft),Object.prototype.hasOwnProperty.call(i.h,"percentCleaned")&&(this.percentCleaned=i.h.percentCleaned),this.postLoad()},__class__:ie});var ne=function(){};(q["buildings.IHousing"]=ne).__name__="buildings.IHousing",ne.__isInterface__=!0,ne.prototype={__class__:ne};var re=function(t,e,i,n,r,s,o,a){this.yearsToLiveLongerPerYearIfLivingHere=0,this.residents=[],this.extraCapacity=0,_.call(this,t,e,i,n,r,s,o,a)};(q["buildings.House"]=re).__name__="buildings.House",re.__interfaces__=[ne],re.__super__=_,re.prototype=e(_.prototype,{get_residentCapacity:function(){return null==this.info.residents?0:this.info.residents+this.extraCapacity},get_baseAttractiveness:function(){return this.info.quality},get_possibleUpgrades:function(){return[]},get_remainingCapacity:function(){return this.get_residentCapacity()-this.residents.length},get_fixedCapacityForWorkers:function(){return 0},get_hasPrivateTeleporter:function(){return!1},destroy:function(){for(_.prototype.destroy.call(this);0!=this.residents.length;)this.residents[this.residents.length-1].evictFromHome()},addWindowInfoLines:function(){var t=this;_.prototype.addWindowInfoLines.call(this);var e=this.city.gui,i=dt.getTexture("spr_housing"),n=this.city,r=this.residents,s=Tr.lo("residents_of",[this.get_name()]),o=this,a=Tr.lo("no_residents");e.windowAddSimpleButton(i,function(){Vs.createWindow(n,r,s,o,a)},null,function(){return Tr.lo("residents",[t.residents.length,t.get_residentCapacity()])}),this.city.gui.windowAddInfoText(null,function(){return Tr.lo("quality",[t.get_baseAttractiveness()+t.bonusAttractiveness])})},walkAround:function(t,e){var i=il.getInt(4);if(0==i&&120<e)t.changeFloorAndWaitRandom(30,60);else if(1==i)t.moveAndWait(il.getInt(3,7),il.getInt(30,60),null,!1,!1);else if(2==i)t.moveAndWait(il.getInt(12,16),il.getInt(30,60),null,!1,!1);else{var n=ka.pool,r=0<n[2].length?n[2].splice(n[2].length-1,1)[0]:new Int32Array(2);r[0]=8,r[1]=il.getInt(90,120),t.setPath(r,0,2,!0),t.pathEndFunction=null,t.pathOnlyRelatedTo=t.inPermanent}},__class__:re});function se(t,e,i,n,r,s,o,a){re.call(this,t,e,i,n,r,s,o,a),this.adjecentBuildingEffects.push({name:"alienHouse",intensity:1})}(q["buildings.AlienHouse"]=se).__name__="buildings.AlienHouse",se.__super__=re,se.prototype=e(re.prototype,{get_possibleUpgrades:function(){return[xt]},__class__:se});function oe(){}(q["buildings.IEntertainmentBuilding"]=oe).__name__="buildings.IEntertainmentBuilding",oe.__isInterface__=!0,oe.prototype={__class__:oe};function ae(t,e,i,n,r,s,o,a){this.laserImages=dt.getTexturesByWidth("spr_nightclub_laser",18),this.lights=[],ee.call(this,t,e,i,n,r,s,o,a);var l=new PIXI.Sprite(dt.getTexture("spr_lightbeam_aliennightclub"));i.addChild(l),this.lights.push({sprite:l,color:0,alpha:0,waiting:1,alphaDir:1}),l.alpha=.8;var h=[150,1,.5];l.tint=gh.toInt(ah.toRgb(h)),l=new PIXI.Sprite(dt.getTexture("spr_lightbeam_aliennightclub")),i.addChild(l),this.lights.push({sprite:l,color:0,alpha:0,waiting:1,alphaDir:1}),l.alpha=.8,h=[150,1,.5],l.tint=gh.toInt(ah.toRgb(h)),(l=new PIXI.Sprite(dt.getTexture("spr_aliennightclub_alienthing"))).anchor.set(.5,1),i.addChild(l),this.lights.push({sprite:l,color:0,alpha:0,waiting:1,alphaDir:1}),l.alpha=.8,h=[150,1,.5],l.tint=gh.toInt(ah.toRgb(h)),(l=new PIXI.Sprite(dt.getTexture("spr_aliennightclub_alienthing"))).anchor.set(.5,1),i.addChild(l),this.lights.push({sprite:l,color:0,alpha:0,waiting:1,alphaDir:1}),l.alpha=.8,h=[150,1,.5],l.tint=gh.toInt(ah.toRgb(h)),this.laserStage=new PIXI.Container,i.addChild(this.laserStage),this.laserStage.position.set(s.x,s.y),this.lasers=[],this.lasers.push({start:new br(2,3),end:new br(6,18),hue:120,speed:1,targetLaserHue:-1,laserSprite:null,goBack:!1}),this.lasers.push({start:new br(17,3),end:new br(6,18),hue:200,speed:-1,targetLaserHue:-1,laserSprite:null,goBack:!0}),this.positionSprites(),this.startTime=20,this.endTime=5.5,this.workTimePreferenceMod=.5,this.isEntertainment=!0,this.lightsAreOn=-1}(q["buildings.AlienNightClub"]=ae).__name__="buildings.AlienNightClub",ae.__interfaces__=[oe],ae.__super__=ee,ae.prototype=e(ee.prototype,{get_baseEntertainmentCapacity:function(){return 80*this.workers.length+this.city.upgrades.vars.nightClubEntertainmentQualityBonus},get_isOpen:function(){if(1!=this.workers.length||0!=this.workers[0].currentAction)return!1;var t=this.city.simulation.time.timeSinceStart/60%24,e=this.startTime-this.workTimePreferenceMod;return e<6?e<=t&&t<6:e<=t||t<6},get_entertainmentType:function(){return 0},get_secondaryEntertainmentTypes:function(){return null},get_minimumNormalTimeToSpend:function(){return 5},get_maximumNormalTimeToSpend:function(){return 7},get_minimumEntertainmentGroupSatisfy:function(){return 1},get_maximumEntertainmentGroupSatisfy:function(){return 3},get_entertainmentQuality:function(){return 100},get_isOpenForExistingVisitors:function(){return this.get_isOpen()},finishEntertainment:function(t,e){return!0},get_possibleUpgrades:function(){return[]},get_drawerType:function(){return Rn},get_hasLeftNightClub:function(){return null!=this.leftBuilding&&this.leftBuilding.is(ae)},get_hasRightNightClub:function(){return null!=this.rightBuilding&&this.rightBuilding.is(ae)},postCreate:function(){ee.prototype.postCreate.call(this),this.positionSprites()},destroy:function(){for(var t=0,e=this.lights;t<e.length;){var i=e[t];++t,i.sprite.destroy()}this.laserStage.destroy({children:!0}),ee.prototype.destroy.call(this)},work:function(t,e,i){if(i&&6<this.city.simulation.time.timeSinceStart/60%24)t.currentAction=2;else if(this.get_hasLeftNightClub())t.moveAndWait(il.getInt(0,this.get_hasRightNightClub()?19:17),il.getInt(20,50),null,!1,!1),this.lightsAreOn=60;else{var n=t.pathWalkSpeed*e;if(K.shouldUpdateDraw=!0,Math.abs(1-t.relativeX)<n)t.relativeX=1;else{var r=1-t.relativeX;t.relativeX+=(0<r?1:r<0?-1:0)*n}this.lightsAreOn=3}},beEntertained:function(t,e){var i=il.getInt(2+(this.get_hasLeftNightClub()?1:0)+(this.get_hasRightNightClub()?1:0));if(this.get_hasLeftNightClub()&&0==i&&this.leftBuilding.get_isOpen())(r=0<(n=ka.pool)[6].length?n[6].splice(n[6].length-1,1)[0]:new Int32Array(6))[0]=2,r[1]=0,r[2]=4,r[3]=il.getInt(5,19),r[4]=8,r[5]=il.getInt(3,6),t.setPath(r,0,6,!0);else if(this.get_hasRightNightClub()&&1==i&&this.rightBuilding.get_isOpen()){var n,r;(r=0<(n=ka.pool)[6].length?n[6].splice(n[6].length-1,1)[0]:new Int32Array(6))[0]=3,r[1]=0,r[2]=4,r[3]=il.getInt(0,17),r[4]=8,r[5]=il.getInt(3,6),t.setPath(r,0,6,!0)}else{var s=this.get_hasLeftNightClub()?0:5,o=this.get_hasRightNightClub()?19:17,a=!1,l=!1;null==l&&(l=!1),null==a&&(a=!1),t.moveAndWait(il.getInt(s,o),il.getInt(3,6),null,a,l)}t.hasBuildingInited||(t.wantsNightEntertainmentIn=il.getInt(1,5),t.hasBuildingInited=!0)},positionSprites:function(){ee.prototype.positionSprites.call(this),2<=this.lights.length&&(this.lights[0].sprite.position.set(this.position.x+4,this.position.y+4),this.lights[1].sprite.position.set(this.position.x+9,this.position.y+4)),4<=this.lights.length&&(this.lights[2].sprite.position.set(this.position.x+il.getInt(2,10),this.position.y+20-1),this.lights[3].sprite.position.set(this.position.x+il.getInt(10,19),this.position.y+20-1)),this.laserStage.position.set(this.position.x,this.position.y)},update:function(t){if(ee.prototype.update.call(this,t),this.lightsAreOn-=Math.min(1,t),!(this.lightsAreOn<=0)||1<=this.workers.length&&this.workers[0].inPermanent==this&&0==this.workers[0].currentAction){for(f=0,g=this.lasers;f<g.length;){var e=g[f];if(++f,e.end.x+=t*e.speed,0<e.speed)18<e.end.x&&(e.end.x=18,e.speed=-e.speed);else if(e.end.x<(this.get_hasLeftNightClub()?1:6)){var i=this.get_hasLeftNightClub()?1:6;e.end.x=i,e.speed=-e.speed}e.hue+=.2*t*(e.goBack?-1:1),240<e.hue?e.goBack=!0:e.hue<120&&(e.goBack=!1),null==e.laserSprite&&(e.laserSprite=new PIXI.Sprite,this.laserStage.addChild(e.laserSprite));var n=Math.floor(Math.abs(e.end.x-e.start.x)),r=this.laserImages.length-1;e.laserSprite.texture=this.laserImages[n<0?0:r<n?r:n],e.laserSprite.position.y=e.start.y;var s=[e.hue,.7,1],o=hh.toRgb(s);e.laserSprite.tint=mr.toHexInt(o),e.end.x<e.start.x?(e.laserSprite.position.set(e.start.x+1,e.start.y),e.laserSprite.scale.x=-1):(e.laserSprite.position.set(e.start.x,e.start.y),e.laserSprite.scale.x=1)}for(f=0,g=this.lights.length;f<g;){var a=f++,l=this.lights[a];if(0<l.alpha){if(l.alpha+=.05*l.alphaDir,1.4<l.alpha)l.alpha=1.4,l.alphaDir=-1;else if(l.alpha<=0)if(l.alpha=0,l.waiting=il.getInt(1<a?60:20),2==a){i=this.position.x,o=il.getInt(2,10);l.sprite.position.x=i+o}else if(3==a){var h=this.position.x,u=il.getInt(10,19);l.sprite.position.x=h+u}l.sprite.alpha=Math.min(l.alpha,1)}else if(0<l.waiting)l.waiting-=t;else if(l.waiting=0,l.alpha=.01,l.alphaDir=1,2==a||3==a){s=[il.getInt(180,240),.9,.5];var c=ah.toRgb(s);l.sprite.tint=gh.toInt(c)}else{var d=[il.getInt(200,300),.8,.5],p=ah.toRgb(d);l.sprite.tint=gh.toInt(p)}}}else{for(var f=0,g=this.lights;f<g.length;){var m=g[f];++f,m.sprite.alpha=0}for(var f=0,g=this.lasers;f<g.length;){m=g[f];++f,null!=m.laserSprite&&(m.laserSprite.destroy(),m.laserSprite=null)}}},save:function(t,e){null==e&&(e=!0),ee.prototype.save.call(this,t),e&&t.addString(ae.saveDefinition)},load:function(t,e){ee.prototype.load.call(this,t),null==e&&(e=t.readString());Dr.makeLoadMap(e,t)},__class__:ae});function le(){}(q["buildings.IWaterFilled"]=le).__name__="buildings.IWaterFilled",le.__isInterface__=!0,le.prototype={__class__:le};function he(t,e,i,n,r,s,o,a){this.justBuilt=!1,this.citizenDivingTextures=null,this.currentTexture=0,_.call(this,t,e,i,n,r,s,o,a),this.isEntertainment=!0,this.currentTexture=0,this.adjecentBuildingEffects.push({name:"modernRusticHomeCommunityFeeling",intensity:1}),this.leftIsWaterFilled=!1,this.rightIsWaterFilled=!1,this.topIsWaterFilled=!1,this.bottomIsWaterFilled=!1}(q["buildings.Aquarium"]=he).__name__="buildings.Aquarium",he.__interfaces__=[le,oe],he.__super__=_,he.prototype=e(_.prototype,{get_baseEntertainmentCapacity:function(){return 50},get_isOpen:function(){return!1},get_entertainmentType:function(){return 3},get_secondaryEntertainmentTypes:function(){return null},get_minimumNormalTimeToSpend:function(){return 3},get_maximumNormalTimeToSpend:function(){return 4},get_minimumEntertainmentGroupSatisfy:function(){return 1},get_maximumEntertainmentGroupSatisfy:function(){return 1.5},get_entertainmentQuality:function(){return 100},get_drawerType:function(){return Bn},get_mergingDrawer:function(){return this.drawer},get_walkThroughCanViewSelfInThisBuilding:function(){return!1},get_hasLeftAquarium:function(){return null!=this.leftBuilding&&this.leftBuilding.is(he)},get_hasRightAquarium:function(){return null!=this.rightBuilding&&this.rightBuilding.is(he)},get_hasTopAquarium:function(){return null!=this.topBuilding&&this.topBuilding.is(he)},get_hasBottomAquarium:function(){return null!=this.bottomBuilding&&this.bottomBuilding.is(he)},get_isOpenForExistingVisitors:function(){return this.get_isOpen()},finishEntertainment:function(t,e){return!0},postCreate:function(){if(_.prototype.postCreate.call(this),this.updateGardenTexture(),this.justBuilt){var t=null;null!=this.bottomBuilding&&this.bottomBuilding.is(he)&&(t=this.bottomBuilding),null!=this.topBuilding&&this.topBuilding.is(he)&&(t=this.topBuilding),null!=t?this.get_mergingDrawer().setGroupOfSecondaryTextureForThisBuilding(this.get_mergingDrawer().getSecondaryTextureGroup(t.currentTexture)):this.currentTexture=il.getInt(gr.isum(he.gardenTextureSets)),this.justBuilt=!1,this.updateGardenTexture()}this.positionSprites()},destroy:function(){_.prototype.destroy.call(this);for(var t=this.city.simulation.fishes.fishes,e=t.length;0<=--e;)t[e].inPermanent==this&&t[e].destroy()},onCityChange:function(){this.leftIsWaterFilled=null!=this.leftBuilding&&Ko.__implements(this.leftBuilding,le),this.rightIsWaterFilled=null!=this.rightBuilding&&Ko.__implements(this.rightBuilding,le),this.topIsWaterFilled=null!=this.topBuilding&&this.topBuilding instanceof he,this.bottomIsWaterFilled=null!=this.bottomBuilding&&this.bottomBuilding instanceof he,this.leftIsWaterFilled?this.leftAsWaterFilled=this.leftBuilding:this.leftAsWaterFilled=null,this.rightIsWaterFilled?this.rightAsWaterFilled=this.rightBuilding:this.rightAsWaterFilled=null,this.topIsWaterFilled?this.topAsWaterFilled=this.topBuilding:this.topAsWaterFilled=null,this.bottomIsWaterFilled?this.bottomAsWaterFilled=this.bottomBuilding:this.bottomAsWaterFilled=null},postLoad:function(){this.updateGardenTexture()},onBuild:function(){_.prototype.onBuild.call(this),this.justBuilt=!0},updateGardenTexture:function(){var e=this;this.get_mergingDrawer().setSecondaryBackgroundImages("spr_botanicalgardens_plants",he.gardenTextureSets,this.currentTexture,function(t){e.currentTexture=t})},beEntertained:function(t,e){},createWindowAddBottomButtons:function(){var t=this;To.create(this.city.gui,function(){return t.get_mergingDrawer().getCurrentSecondaryTextureGroup()},Uh(N=this.get_mergingDrawer(),N.setGroupOfSecondaryTexture),function(){return he.gardenTextureSets.length},Tr.lo("change_plants")),To.create(this.city.gui,function(){return t.currentTexture-t.get_mergingDrawer().getFirstSecondaryTextureOfGroup(t.get_mergingDrawer().getCurrentSecondaryTextureGroup())},Uh(N=this.get_mergingDrawer(),N.setSecondaryTextureWithinGroup),function(){return he.gardenTextureSets[t.get_mergingDrawer().getCurrentSecondaryTextureGroup()]},Tr.lo("change_plants_variant")),_.prototype.createWindowAddBottomButtons.call(this)},onCitizenLeave:function(t,e){null!=e&&e.is(he)||(t.dynamicUnsavedVars.buildingInited=null)},save:function(t,e){null==e&&(e=!0),_.prototype.save.call(this,t),e&&t.addString(he.saveDefinition);var i=this.currentTexture;if(t.size+4>t.bytes.length){var n=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+4))),t.bytes.blit(0,n,0,t.size)}t.bytes.setInt32(t.size,i),t.size+=4},load:function(t,e){_.prototype.load.call(this,t),null==e&&(e=t.readString());var i=Dr.makeLoadMap(e,t);Object.prototype.hasOwnProperty.call(i.h,"currentTexture")&&(this.currentTexture=i.h.currentTexture),this.postLoad()},__class__:he});function ue(t,e,i,n,r,s,o,a){ee.call(this,t,e,i,n,r,s,o,a),this.startTime=12,this.endTime=23.5,this.workTimePreferenceMod=.1,this.isEntertainment=!0}(q["buildings.Arcade"]=ue).__name__="buildings.Arcade",ue.__interfaces__=[oe],ue.__super__=ee,ue.prototype=e(ee.prototype,{get_baseEntertainmentCapacity:function(){return 120*this.workers.length},get_isOpen:function(){return 1==this.workers.length&&0==this.workers[0].currentAction&&this.city.simulation.time.timeSinceStart/60%24<23},get_entertainmentType:function(){return 4},get_secondaryEntertainmentTypes:function(){return null},get_minimumNormalTimeToSpend:function(){return 2.5},get_maximumNormalTimeToSpend:function(){return 3},get_minimumEntertainmentGroupSatisfy:function(){return 4},get_maximumEntertainmentGroupSatisfy:function(){return 7},get_entertainmentQuality:function(){return 100},get_isOpenForExistingVisitors:function(){return this.get_isOpen()},finishEntertainment:function(t,e){return!0},beEntertained:function(e,t){function i(){var t=e.relativeY<5?5+4*il.getInt(3):5+8*il.getInt(2);e.moveAndWait(il.getInt(t,1+t),il.getInt(100,120),null,!1,!1)}1==il.getInt(3)?e.changeFloor(i):i()},work:function(t,e,i){if(i)t.currentAction=2;else{var n=t.pathWalkSpeed*e;if(K.shouldUpdateDraw=!0,Math.abs(6-t.relativeX)<n)t.relativeX=6;else{var r=6-t.relativeX;t.relativeX+=(0<r?1:r<0?-1:0)*n}}},save:function(t,e){null==e&&(e=!0),ee.prototype.save.call(this,t),e&&t.addString(ue.saveDefinition)},load:function(t,e){ee.prototype.load.call(this,t),null==e&&(e=t.readString());Dr.makeLoadMap(e,t)},__class__:ue});function ce(t,e,i,n,r,s,o,a){this.yearsToLiveLongerPerYearIfLivingHere=0,this.residents=[],this.extraCapacity=0,ee.call(this,t,e,i,n,r,s,o,a)}(q["buildings.WorkWithHome"]=ce).__name__="buildings.WorkWithHome",ce.__interfaces__=[ne],ce.__super__=ee,ce.prototype=e(ee.prototype,{get_residentCapacity:function(){return null==this.info.residents?0:this.info.residents+this.extraCapacity},get_baseAttractiveness:function(){return this.info.quality},get_possibleUpgrades:function(){return[]},get_remainingCapacity:function(){return this.get_residentCapacity()-this.residents.length},get_fixedCapacityForWorkers:function(){return this.get_residentCapacity()},get_hasPrivateTeleporter:function(){return!1},destroy:function(){for(ee.prototype.destroy.call(this);0!=this.residents.length;)this.residents[this.residents.length-1].evictFromHome()},addWindowInfoLines:function(){var t=this,e=this.city.gui,i=dt.getTexture("spr_housing"),n=this.city,r=this.residents,s=Tr.lo("residents_of",[this.get_name()]),o=this,a=Tr.lo("no_residents");e.windowAddSimpleButton(i,function(){Vs.createWindow(n,r,s,o,a)},null,function(){return Tr.lo("residents",[t.residents.length,t.get_residentCapacity()])}),ee.prototype.addWindowInfoLines.call(this),this.city.gui.windowAddInfoText(null,function(){return Tr.lo("quality",[t.get_baseAttractiveness()+t.bonusAttractiveness])})},walkAround:function(t,e){var i=il.getInt(4);if(0==i&&120<e)t.changeFloorAndWaitRandom(30,60);else if(1==i)t.moveAndWait(il.getInt(3,7),il.getInt(30,60),null,!1,!1);else if(2==i)t.moveAndWait(il.getInt(12,16),il.getInt(30,60),null,!1,!1);else{var n=ka.pool,r=0<n[2].length?n[2].splice(n[2].length-1,1)[0]:new Int32Array(2);r[0]=8,r[1]=il.getInt(90,120),t.setPath(r,0,2,!0),t.pathEndFunction=null,t.pathOnlyRelatedTo=t.inPermanent}},__class__:ce});function de(t,e,i,n,r,s,o,a){this.artSprite=null,this.currentWorkProgress=0,this.currentTexture=0,ce.call(this,t,e,i,n,r,s,o,a),this.startTime=10,this.endTime=22,this.workTimePreferenceMod=.3,this.isEntertainment=!0,this.artTextures=dt.getTexturesByWidth("spr_artcolonywork",20),this.currentTexture=0,this.artSprite=new PIXI.Sprite(this.artTextures[this.currentTexture]),this.artSprite.position.set(s.x,s.y),i.addChild(this.artSprite)}(q["buildings.ArtColony"]=de).__name__="buildings.ArtColony",de.__interfaces__=[oe],de.__super__=ce,de.prototype=e(ce.prototype,{get_baseEntertainmentCapacity:function(){return 50*this.workers.length},get_isOpen:function(){return 0<this.workers.length&&0==this.workers[0].currentAction&&(1+((0|this.city.simulation.time.timeSinceStart)/1440|0))%3==0&&this.city.simulation.time.timeSinceStart/60%24<21.5&&15<this.city.simulation.time.timeSinceStart/60%24},get_entertainmentType:function(){return 2},get_secondaryEntertainmentTypes:function(){return null},get_minimumNormalTimeToSpend:function(){return 1},get_maximumNormalTimeToSpend:function(){return 2},get_minimumEntertainmentGroupSatisfy:function(){return 2},get_maximumEntertainmentGroupSatisfy:function(){return 3},get_entertainmentQuality:function(){return 100},get_isOpenForExistingVisitors:function(){return this.get_isOpen()},finishEntertainment:function(t,e){return!0},postLoad:function(){this.artSprite.texture=this.artTextures[this.currentTexture]},positionSprites:function(){ce.prototype.positionSprites.call(this),null!=this.artSprite&&this.artSprite.position.set(this.position.x,this.position.y)},destroy:function(){ce.prototype.destroy.call(this),this.artSprite.destroy()},beEntertained:function(i,t){function e(){var t=!1,e=!0;null==e&&(e=!1),null==t&&(t=!1),i.moveAndWait(il.getInt(3,16),il.getInt(50,100),null,t,e)}i.relativeY<5?i.changeFloor(e):e()},get_possibleUpgrades:function(){return[]},addWindowInfoLines:function(){var t=this,e=this.city.gui,i=dt.getTexture("spr_work_housing"),n=this.city,r=this.residents,s=Tr.lo("resident_workers_of",[this.get_name()]),o=this,a=Tr.lo("none");e.windowAddSimpleButton(i,function(){Vs.createWindow(n,r,s,o,a)},null,function(){return Tr.lo("resident_workers",[t.residents.length,t.get_residentCapacity()])}),this.city.gui.windowAddInfoText(null,function(){return Tr.lo("quality",[t.get_baseAttractiveness()+t.bonusAttractiveness])})},walkAround:function(t,e){var i=il.getInt(3);if(0==i&&120<e)t.changeFloorAndWaitRandom(30,60);else if(1==i)t.relativeY,t.moveAndWait(il.getInt(3,15),il.getInt(30,60),null,!1,!1);else{var n=ka.pool,r=0<n[2].length?n[2].splice(n[2].length-1,1)[0]:new Int32Array(2);r[0]=8,r[1]=il.getInt(90,120),t.setPath(r,0,2,!0),t.pathEndFunction=null,t.pathOnlyRelatedTo=t.inPermanent}},work:function(t,e,i){i&&(t.currentAction=2);var n=(this.workers.indexOf(t)+(1+((0|this.city.simulation.time.timeSinceStart)/1440|0)))%5;if(0==n||3==n?5<t.relativeY?t.changeFloor():0==n?(t.relativeX<3||6<t.relativeX||il.getFloat()<.015*e)&&t.moveAndWait(il.getInt(3,7),il.getInt(5,10),null,!1,!1):3==n&&(t.relativeX<12||15<t.relativeX||il.getFloat()<.015*e)&&t.moveAndWait(il.getInt(12,16),il.getInt(5,10),null,!1,!1):t.relativeY<5?t.changeFloor():1==n?(t.relativeX<3||6<t.relativeX||il.getFloat()<.015*e)&&t.moveAndWait(il.getInt(3,7),il.getInt(5,10),null,!1,!1):2==n?(t.relativeX<12||15<t.relativeX||il.getFloat()<.015*e)&&t.moveAndWait(il.getInt(12,16),il.getInt(5,10),null,!1,!1):4==n&&(t.relativeX<8||10<t.relativeX||il.getFloat()<.015*e)&&t.moveAndWait(il.getInt(8,11),il.getInt(5,10),null,!1,!1),1<=this.currentWorkProgress){this.currentTexture+=1;for(var r=0,s=0,o=de.unlockNewWorkAfter;s<o.length;){var a=o[s];++s,this.currentTexture>a&&++r}var l=this.city.progress.unlocks.numberOfModernArtMuseumArtworksUnlocked,h=4+r;this.city.progress.unlocks.numberOfModernArtMuseumArtworksUnlocked=l<h?h:l,this.currentTexture%=this.artTextures.length,this.artSprite.texture=this.artTextures[this.currentTexture],this.currentWorkProgress=0}this.currentWorkProgress+=e*t.get_educationSpeedModifier()*this.city.simulation.happiness.actionSpeedModifier*2e-5},save:function(t,e){null==e&&(e=!0),ce.prototype.save.call(this,t),e&&t.addString(de.saveDefinition);var i=this.currentTexture;if(t.size+4>t.bytes.length){var n=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+4))),t.bytes.blit(0,n,0,t.size)}t.bytes.setInt32(t.size,i),t.size+=4;i=this.currentWorkProgress;if(t.size+8>t.bytes.length){n=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+8))),t.bytes.blit(0,n,0,t.size)}t.bytes.setDouble(t.size,i),t.size+=8},load:function(t,e){ce.prototype.load.call(this,t),null==e&&(e=t.readString());var i=Dr.makeLoadMap(e,t);Object.prototype.hasOwnProperty.call(i.h,"currentTexture")&&(this.currentTexture=i.h.currentTexture),Object.prototype.hasOwnProperty.call(i.h,"currentWorkProgress")&&(this.currentWorkProgress=i.h.currentWorkProgress),this.postLoad()},__class__:de});function pe(t,e,i,n,r,s,o,a){_.call(this,t,e,i,n,r,s,o,a),this.lightSpr=new PIXI.Sprite(dt.getTexture("spr_beacon_light")),e.addChild(this.lightSpr),this.positionSprites()}(q["buildings.Beacon"]=pe).__name__="buildings.Beacon",pe.__interfaces__=[oe],pe.__super__=_,pe.prototype=e(_.prototype,{get_isOpen:function(){return!0},get_entertainmentType:function(){return 2},get_secondaryEntertainmentTypes:function(){return null},get_minimumNormalTimeToSpend:function(){return 1.5},get_maximumNormalTimeToSpend:function(){return 3},get_minimumEntertainmentGroupSatisfy:function(){return 2},get_maximumEntertainmentGroupSatisfy:function(){return 3},get_entertainmentQuality:function(){return 100},get_baseEntertainmentCapacity:function(){return 50},get_isOpenForExistingVisitors:function(){return!0},finishEntertainment:function(t,e){return!0},destroy:function(){_.prototype.destroy.call(this),null!=this.lightSpr&&this.lightSpr.destroy()},positionSprites:function(){_.prototype.positionSprites.call(this),this.lightSpr.position.set(this.position.x+8,this.position.y+1),this.lightSpr.alpha=0},update:function(t){_.prototype.update.call(this,t),((0|this.city.simulation.time.timeSinceStart)/60|0)%24<6||20.5<((0|this.city.simulation.time.timeSinceStart)/60|0)%24?this.lightSpr.alpha=1:((0|this.city.simulation.time.timeSinceStart)/60|0)%24<6.5?this.lightSpr.alpha=2*(6.5-this.city.simulation.time.timeSinceStart/60%24):20<((0|this.city.simulation.time.timeSinceStart)/60|0)%24?this.lightSpr.alpha=2*(this.city.simulation.time.timeSinceStart/60%24-20):this.lightSpr.alpha=0},beEntertained:function(t,e){il.getFloat()<.5?t.moveAndWait(il.getInt(4,8),il.getInt(60,90),null,!1,!1):t.moveAndWait(il.getInt(11,15),il.getInt(60,90),null,!1,!1)},addWindowInfoLines:function(){_.prototype.addWindowInfoLines.call(this),this.city.gui.windowAddInfoText(Tr.lo("beacon_credits"))},save:function(t,e){null==e&&(e=!0),_.prototype.save.call(this,t),e&&t.addString(pe.saveDefinition)},load:function(t,e){_.prototype.load.call(this,t),null==e&&(e=t.readString());Dr.makeLoadMap(e,t)},__class__:pe});function fe(t,e,i,n,r,s,o,a){this.canLeaveForBG=0,this.eventBotanicalGardens=null,this.timeToCheckBuildings=0,this.currentMission=0,this.eventPhase=0,this.doingEvent=-1,this.lastEventDoneOnDay=0,ce.call(this,t,e,i,n,r,s,o,a),this.startTime=11,this.endTime=23,this.workTimePreferenceMod=.3}(q["buildings.BlossomHippieHQ"]=fe).__name__="buildings.BlossomHippieHQ",fe.__super__=ce,fe.prototype=e(ce.prototype,{positionSprites:function(){ce.prototype.positionSprites.call(this)},destroy:function(){ce.prototype.destroy.call(this)},addWindowInfoLines:function(){var t=this;ce.prototype.addWindowInfoLines.call(this),this.city.gui.windowInner.addChild(new Ms(this.city.gui.window,new vr(4,4))),this.city.gui.windowAddInfoText(null,function(){return t.missionGetTitle()},"Arial15"),this.city.gui.windowAddInfoText(null,function(){return t.missionGetText()})},createMainWindowPart:function(){var i=this;ce.prototype.createMainWindowPart.call(this);var t=!1,e=null,n=null,r=new ps(this.city.gui,this.city.gui.innerWindowStage,this.city.gui.windowInner);r.direction=Ps.Vertical,this.city.gui.windowInner.addChild(r),r.onUpdate=function(){2==i.currentMission?t||(t=!0,e=new oo(i.city.gui,i.city.gui.innerWindowStage,r,function(){if(2==i.currentMission&&i.city.materials.canAfford(new L(0,0,1e4))){i.currentMission=3,i.city.progress.unlocks.unlock($e);var t=i.city.materials;t.set_food(t.food-1e4)}else{var e=function(){i.city.gui.showSimpleWindow(Tr.lo("cannot_afford_hippie_bribe"),null,!0)};e(),i.city.gui.addWindowToStack(e)}},Tr.lo("bribe_hippies_option")),r.addChild(e),n=r.addChild(new Ms(r,new vr(4,4)))):t&&(r.removeChild(e),t=!1,r.removeChild(n))}},missionGetTitle:function(){return 8==this.currentMission?Tr.lo("thank_you"):Tr.lo("current_task")},missionGetText:function(){return 8<=this.currentMission?Tr.lo("peace_out"):this.workers.length!=this.get_jobs()?Tr.lo("flower_buds"):Tr.lo("hippie_mission_"+this.currentMission)},checkMissionCompletions:function(){for(var t=!1;;){switch(t=!1,this.currentMission){case 0:for(var e=0,i=0,n=this.city.permanents;i<n.length;){var r=n[i];if(++i,r.is(dn)){var s=r;null!=s.leftBuilding&&null!=s.rightBuilding&&null!=s.topBuilding&&null!=s.bottomBuilding&&s.leftBuilding.is(be)&&s.rightBuilding.is(be)&&s.bottomBuilding.is(be)&&s.topBuilding.is(be)&&++e}}2<=e&&(t=!0,this.city.progress.unlocks.unlock(me));break;case 2:for(var o=0,a=this.city.permanents;o<a.length;){var l=a[o];if(++o,l.is(Ph))l.managementMode==Oh.Protect&&(t=!0,this.city.progress.unlocks.unlock($e))}break;case 6:(t=gr.any(this.city.upgrades.upgrades,function(t){return t instanceof lr}))&&this.city.progress.unlocks.unlock(Je)}if(this.timeToCheckBuildings<=0&&0!=this.currentMission&&2!=this.currentMission&&6!=this.currentMission&&8!=this.currentMission){var h=this.city.getAmountOfPermanentsPerType();switch(this.currentMission){case 1:t=3<=h.h["buildings.BlossomRestaurant"];break;case 3:t=20<=h.h["buildings.FarmHouse"];break;case 4:(t=30<=h.h["buildings.EcoFarm"])&&this.city.progress.unlocks.unlock(qe);break;case 5:(t=9<=h.h["buildings.FarmByProductProcessor"])&&this.city.progress.unlocks.unlock(lr);break;case 7:t=1<=h.h["buildings.FestivalHQ"]}this.timeToCheckBuildings=30}if(t&&(this.currentMission+=1,this.timeToCheckBuildings=0,this.city.progress.goalHelp.updateHasBuildingGoal()),!t)break}},update:function(t){ce.prototype.update.call(this,t),this.checkMissionCompletions(),this.timeToCheckBuildings-=t,this.canLeaveForBG-=t},work:function(t,e,i){var n=this;if(null!=t.inPermanent&&t.inPermanent.is(be)&&t.inPermanent.isTree()){if(0==this.eventPhase){var r,s=t.pathWalkSpeed*e;if(K.shouldUpdateDraw=!0,Math.abs(9-t.relativeX)<s)t.relativeX=9,r=!0;else{var o=9-t.relativeX;t.relativeX+=(0<o?1:o<0?-1:0)*s,r=!1}return void(r&&(t.setRelativeY(t.relativeY+.4*e),10<=t.relativeY&&(null!=(null!=t.inPermanent&&t.inPermanent.isBuilding?t.inPermanent:null).topBuilding&&(null!=t.inPermanent&&t.inPermanent.isBuilding?t.inPermanent:null).topBuilding.is(be)?(t.setRelativeY(t.relativeY-20),t.inPermanent=(null!=t.inPermanent&&t.inPermanent.isBuilding?t.inPermanent:null).topBuilding):this.eventPhase=1)))}if(t.setRelativeY(t.relativeY-.4*e),!(t.relativeY<=0))return;if(null!=(null!=t.inPermanent&&t.inPermanent.isBuilding?t.inPermanent:null).bottomBuilding&&(null!=t.inPermanent&&t.inPermanent.isBuilding?t.inPermanent:null).bottomBuilding.is(be))return t.setRelativeY(t.relativeY+20),void(t.inPermanent=(null!=t.inPermanent&&t.inPermanent.isBuilding?t.inPermanent:null).bottomBuilding);t.setRelativeY(0),this.doingEvent=-1}else if(-1!=this.doingEvent){if(t.setRelativeY(0),null==this.eventBotanicalGardens&&(this.eventBotanicalGardens=this.city.simulation.permanentFinder.query(this,function(t){if(t.is(be)){var e=t;return(null==e.bottomBuilding||!e.bottomBuilding.is(be))&&e.isTree()}return!1})),null!=this.eventBotanicalGardens)return void(this.canLeaveForBG<=0&&(t.simulation.pathfinder.findPath(t,this.eventBotanicalGardens),t.pathOnFail=function(){n.doingEvent=-1},this.canLeaveForBG=20));this.doingEvent=-1}if(i)t.currentAction=2;else{if(t.inPermanent!=this)return t.setRelativeY(0),t.simulation.pathfinder.findPath(t,this),void(t.pathOnFail=null);this.doWalkAround(t),10<((0|this.city.simulation.time.timeSinceStart)/60|0)%24&&1+((0|this.city.simulation.time.timeSinceStart)/1440|0)>this.lastEventDoneOnDay&&(this.doingEvent=1,this.eventPhase=0,this.lastEventDoneOnDay=1+((0|this.city.simulation.time.timeSinceStart)/1440|0))}},walkAround:function(t,e){this.doWalkAround(t)},doWalkAround:function(t){t.relativeX<7&&il.getFloat()<.3?t.changeFloorAndWaitRandom(10,30):5<t.relativeY||.5<il.getFloat()?t.moveAndWait(il.getInt(3,7),il.getInt(60,180),null,!1,!1):t.moveAndWait(il.getInt(12,16),il.getInt(60,180),null,!1,!1)},getGlobalGoal:function(){return 8==this.currentMission?null:{category:Tr.lo("hippie_mission"),text:this.missionGetText()}},save:function(t,e){null==e&&(e=!0),ce.prototype.save.call(this,t),e&&t.addString(fe.saveDefinition);var i=this.lastEventDoneOnDay;if(t.size+4>t.bytes.length){var n=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+4))),t.bytes.blit(0,n,0,t.size)}t.bytes.setInt32(t.size,i),t.size+=4;i=this.doingEvent;if(t.size+4>t.bytes.length){n=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+4))),t.bytes.blit(0,n,0,t.size)}t.bytes.setInt32(t.size,i),t.size+=4;i=this.eventPhase;if(t.size+4>t.bytes.length){n=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+4))),t.bytes.blit(0,n,0,t.size)}t.bytes.setInt32(t.size,i),t.size+=4;i=this.currentMission;if(t.size+4>t.bytes.length){n=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+4))),t.bytes.blit(0,n,0,t.size)}t.bytes.setInt32(t.size,i),t.size+=4},load:function(t,e){ce.prototype.load.call(this,t),null==e&&(e=t.readString());var i=Dr.makeLoadMap(e,t);Object.prototype.hasOwnProperty.call(i.h,"lastEventDoneOnDay")&&(this.lastEventDoneOnDay=i.h.lastEventDoneOnDay),Object.prototype.hasOwnProperty.call(i.h,"doingEvent")&&(this.doingEvent=i.h.doingEvent),Object.prototype.hasOwnProperty.call(i.h,"eventPhase")&&(this.eventPhase=i.h.eventPhase),Object.prototype.hasOwnProperty.call(i.h,"currentMission")&&(this.currentMission=i.h.currentMission)},__class__:fe});function ge(t,e,i,n,r,s,o,a){re.call(this,t,e,i,n,r,s,o,a),this.get_mergingDrawer().setBackgroundTextures("spr_bloomhouse")}(q["buildings.BlossomHut"]=ge).__name__="buildings.BlossomHut",ge.__super__=re,ge.prototype=e(re.prototype,{get_drawerType:function(){return Bn},get_mergingDrawer:function(){return this.drawer},postCreate:function(){re.prototype.postCreate.call(this),this.positionSprites()},positionSprites:function(){re.prototype.positionSprites.call(this)},walkAround:function(t,e){if(9==t.relativeX)t.canViewSelfInBuilding=!1;else{var i=ka.pool,n=0<i[2].length?i[2].splice(i[2].length-1,1)[0]:new Int32Array(2);n[0]=4,n[1]=9,t.setPath(n,0,2,!0),t.pathEndFunction=null,t.pathOnlyRelatedTo=t.inPermanent}},__class__:ge});var me=function(t,e,i,n,r,s,o,a){ee.call(this,t,e,i,n,r,s,o,a),this.startTime=16,this.endTime=1,this.workTimePreferenceMod=.5,this.isEntertainment=!0,this.get_mergingDrawer().setForegroundTextures("spr_bloomrestaurant_foreground")};(q["buildings.BlossomRestaurant"]=me).__name__="buildings.BlossomRestaurant",me.__interfaces__=[oe],me.__super__=ee,me.prototype=e(ee.prototype,{get_baseEntertainmentCapacity:function(){var t=50;return t+=this.getEffectsOfAdjecentBuildingsLR("restaurantCapBoost"),this.workers.length*t|0},get_isOpen:function(){if(1<=this.workers.length&&0==this.workers[0].currentAction){var t=this.city.simulation.time.timeSinceStart/60%24,e=this.startTime-this.workTimePreferenceMod;return e<.5?e<=t&&t<.5:e<=t||t<.5}return!1},get_entertainmentType:function(){return 1},get_secondaryEntertainmentTypes:function(){return null},get_minimumNormalTimeToSpend:function(){return 1},get_maximumNormalTimeToSpend:function(){return 2},get_minimumEntertainmentGroupSatisfy:function(){return 1},get_maximumEntertainmentGroupSatisfy:function(){return 3},get_entertainmentQuality:function(){return 100},get_isOpenForExistingVisitors:function(){return this.get_isOpen()},finishEntertainment:function(t,e){return!0},get_drawerType:function(){return Bn},get_mergingDrawer:function(){return this.drawer},beEntertained:function(t,e){if(t.hasBuildingInited){(n=0<(i=ka.pool)[2].length?i[2].splice(i[2].length-1,1)[0]:new Int32Array(2))[0]=8,n[1]=il.getInt(30,60),t.setPath(n,0,2,!0),t.pathEndFunction=null,t.pathOnlyRelatedTo=t.inPermanent}else{if(null!=this.bottomBuilding&&this.bottomBuilding.is(me))switch(il.getInt(4)){case 0:(n=0<(i=ka.pool)[2].length?i[2].splice(i[2].length-1,1)[0]:new Int32Array(2))[0]=4,n[1]=1,t.setPath(n,0,2,!0),t.pathEndFunction=null,t.pathOnlyRelatedTo=t.inPermanent;break;case 1:(n=0<(i=ka.pool)[2].length?i[2].splice(i[2].length-1,1)[0]:new Int32Array(2))[0]=4,n[1]=4,t.setPath(n,0,2,!0),t.pathEndFunction=null,t.pathOnlyRelatedTo=t.inPermanent;break;case 2:(n=0<(i=ka.pool)[2].length?i[2].splice(i[2].length-1,1)[0]:new Int32Array(2))[0]=4,n[1]=12,t.setPath(n,0,2,!0),t.pathEndFunction=null,t.pathOnlyRelatedTo=t.inPermanent;break;case 3:(n=0<(i=ka.pool)[2].length?i[2].splice(i[2].length-1,1)[0]:new Int32Array(2))[0]=4,n[1]=17,t.setPath(n,0,2,!0),t.pathEndFunction=null,t.pathOnlyRelatedTo=t.inPermanent}else switch(il.getInt(6)){case 0:(n=0<(i=ka.pool)[2].length?i[2].splice(i[2].length-1,1)[0]:new Int32Array(2))[0]=4,n[1]=1,t.setPath(n,0,2,!0),t.pathEndFunction=null,t.pathOnlyRelatedTo=t.inPermanent;break;case 1:(n=0<(i=ka.pool)[2].length?i[2].splice(i[2].length-1,1)[0]:new Int32Array(2))[0]=4,n[1]=2,t.setPath(n,0,2,!0),t.pathEndFunction=null,t.pathOnlyRelatedTo=t.inPermanent;break;case 2:(n=0<(i=ka.pool)[2].length?i[2].splice(i[2].length-1,1)[0]:new Int32Array(2))[0]=4,n[1]=5,t.setPath(n,0,2,!0),t.pathEndFunction=null,t.pathOnlyRelatedTo=t.inPermanent;break;case 3:(n=0<(i=ka.pool)[2].length?i[2].splice(i[2].length-1,1)[0]:new Int32Array(2))[0]=4,n[1]=13,t.setPath(n,0,2,!0),t.pathEndFunction=null,t.pathOnlyRelatedTo=t.inPermanent;break;case 4:(n=0<(i=ka.pool)[2].length?i[2].splice(i[2].length-1,1)[0]:new Int32Array(2))[0]=4,n[1]=14,t.setPath(n,0,2,!0),t.pathEndFunction=null,t.pathOnlyRelatedTo=t.inPermanent;break;case 5:var i,n;(n=0<(i=ka.pool)[2].length?i[2].splice(i[2].length-1,1)[0]:new Int32Array(2))[0]=4,n[1]=17,t.setPath(n,0,2,!0),t.pathEndFunction=null,t.pathOnlyRelatedTo=t.inPermanent}t.hasBuildingInited=!0}},work:function(t,e,i){if(i&&.5<this.city.simulation.time.timeSinceStart/60%24)t.currentAction=2;else{var n=!1,r=!0;null==r&&(r=!1),null==n&&(n=!1),t.moveAndWait(il.getInt(3,18),il.getInt(60,120),null,n,r)}},__class__:me});function ye(t,e,i,n,r,s,o,a){this.hasNotSearchedForResourceGatherPlaceThisStep=!0,this.nearestResourceGatherPlace=null,ee.call(this,t,e,i,n,r,s,o,a)}(q["buildings.BlueCollarWork"]=ye).__name__="buildings.BlueCollarWork",ye.__super__=ee,ye.prototype=e(ee.prototype,{doBlueCollarJob:function(t,e,i,n,r,s,o){var a=this;if(i)t.hasWorkTools?t.inPermanent==this?t.moveAndWait(4,20,function(){t.hasWorkTools=!1}):(t.simulation.pathfinder.findPath(t,this),t.pathOnFail=null):t.currentAction=2;else if(t.hasWorkTools){for(var l=!1,h=0;h<n.length;){var u=n[h];if(++h,Ko.__instanceof(t.inPermanent,u)){l=!0;break}}if(l&&(0<t.inPermanent.materialsLeft||t.inPermanent.get_stayIfEmpty())&&!t.inPermanent.get_doNotGather()){var c=t.inPermanent;if(0<c.materialsLeft){var d=!0;null==d&&(d=!1),t.moveAndWait(il.getInt(c.minCitizenX,c.maxCitizenX),il.getInt(s,o),function(){c.get_doNotGather()?a.nearestResourceGatherPlace=null:(r(c),c.materialsLeft<=0&&!c.get_stayIfEmpty()?(a.nearestResourceGatherPlace=null,c.get_destroyedOnEmpty()&&c.destroy()):c.updateTexture())},d,!1)}}else{var p=!0;if(null==this.nearestResourceGatherPlace||this.nearestResourceGatherPlace.materialsLeft<=0&&!this.nearestResourceGatherPlace.get_stayIfEmpty()||this.nearestResourceGatherPlace.get_doNotGather()){this.nearestResourceGatherPlace=null;var f,g=this.city.simulation.permanentFinder.canPerformQuery();if(g||(p=!1),g&&this.hasNotSearchedForResourceGatherPlaceThisStep){var m=this.world.knownResourceInavailability,y=n[0].__name__;f=!Object.prototype.hasOwnProperty.call(m.h,y)}else f=!1;if(f){if(this.city.simulation.resourcePriorityManager.hasResourcePrioritiesFor(n[0])){var _=0==n.length?function(t){return!(!(t.is(n[0])&&0<t.materialsLeft)||t.get_doNotGather())&&a.city.simulation.resourcePriorityManager.isPrioritized(t)}:function(e){return!(!(gr.any(n,function(t){return e.is(t)})&&0<e.materialsLeft)||e.get_doNotGather())&&a.city.simulation.resourcePriorityManager.isPrioritized(e)};this.nearestResourceGatherPlace=this.city.simulation.permanentFinder.query(this,_)}if(null==this.nearestResourceGatherPlace){_=0==n.length?function(t){return!!(t.is(n[0])&&0<t.materialsLeft)&&!t.get_doNotGather()}:function(e){return!!(gr.any(n,function(t){return e.is(t)})&&0<e.materialsLeft)&&!e.get_doNotGather()};this.nearestResourceGatherPlace=this.city.simulation.permanentFinder.query(this,_)}if(null==this.nearestResourceGatherPlace){m=this.world.knownResourceInavailability;var v=n[0].__name__;m.h[v]=!0}this.hasNotSearchedForResourceGatherPlaceThisStep=!1}}p&&(null!=this.nearestResourceGatherPlace?(t.simulation.pathfinder.findPathCombined(t,this.nearestResourceGatherPlace),t.pathOnFail=null):t.wander(e))}}else t.inPermanent==this?t.moveAndWait(4,20,function(){t.hasWorkTools=!0}):(t.simulation.pathfinder.findPathCombined(t,this),t.pathOnFail=null)},update:function(t){ee.prototype.update.call(this,t),this.hasNotSearchedForResourceGatherPlaceThisStep=!0},invalidatePathfindingRelatedInfo:function(){ee.prototype.invalidatePathfindingRelatedInfo.call(this),this.nearestResourceGatherPlace=null},__class__:ye});function _e(t,e,i,n,r,s,o,a){ee.call(this,t,e,i,n,r,s,o,a),this.startTime=11,this.endTime=23.5,this.workTimePreferenceMod=.1,this.isEntertainment=!0}(q["buildings.BoardGameStore"]=_e).__name__="buildings.BoardGameStore",_e.__interfaces__=[oe],_e.__super__=ee,_e.prototype=e(ee.prototype,{get_baseEntertainmentCapacity:function(){return 90*this.workers.length},get_isOpen:function(){return 1==this.workers.length&&0==this.workers[0].currentAction&&this.city.simulation.time.timeSinceStart/60%24<23},get_entertainmentType:function(){return 4},get_secondaryEntertainmentTypes:function(){return null},get_minimumNormalTimeToSpend:function(){return 3},get_maximumNormalTimeToSpend:function(){return 3.5},get_minimumEntertainmentGroupSatisfy:function(){return 4},get_maximumEntertainmentGroupSatisfy:function(){return 8},get_entertainmentQuality:function(){return 100},get_isOpenForExistingVisitors:function(){return this.get_isOpen()},finishEntertainment:function(t,e){return!0},beEntertained:function(n,t){function e(){var t=n.relativeY<5?il.getInt(8,16):0==il.getInt(2)?il.fromArray(_e.firstFloorChairs):il.getInt(3,14),e=!1,i=!0;null==i&&(i=!1),null==e&&(e=!1),n.moveAndWait(il.getInt(t,t+1),il.getInt(100,120),null,e,i)}0==il.getInt(3-n.relativeY<10?1:0)?n.changeFloor(e):e()},work:function(t,e,i){if(i)t.currentAction=2;else{var n=t.pathWalkSpeed*e;if(K.shouldUpdateDraw=!0,Math.abs(4-t.relativeX)<n)t.relativeX=4;else{var r=4-t.relativeX;t.relativeX+=(0<r?1:r<0?-1:0)*n}t.setRelativeY(1)}},save:function(t,e){null==e&&(e=!0),ee.prototype.save.call(this,t),e&&t.addString(_e.saveDefinition)},load:function(t,e){ee.prototype.load.call(this,t),null==e&&(e=t.readString());Dr.makeLoadMap(e,t)},__class__:_e});function ve(){}(q["buildings.IBuildingWithFestivalSpecials"]=ve).__name__="buildings.IBuildingWithFestivalSpecials",ve.__isInterface__=!0,ve.prototype={__class__:ve};var be=function(t,e,i,n,r,s,o,a){this.justBuilt=!1,this.festivalJobs=2,this.currentTexture=0,this.currentMainTexture=0,_.call(this,t,e,i,n,r,s,o,a),this.isEntertainment=!0,this.currentTexture=0,this.adjecentBuildingEffects.push({name:"modernRusticHomeCommunityFeeling",intensity:1})};(q["buildings.BotanicalGardens"]=be).__name__="buildings.BotanicalGardens",be.__interfaces__=[ve,oe],be.__super__=_,be.prototype=e(_.prototype,{get_mainTextures:function(){return["spr_botanicalgardens","spr_indoorpark","spr_indoorpark_alt1"]},get_baseEntertainmentCapacity:function(){return 40},get_isOpen:function(){if(null!=this.bottomBuilding&&this.bottomBuilding.is(be))return!1;var t=this.city.simulation.time.timeSinceStart/60%24;return 6<=t&&t<22},get_entertainmentType:function(){return 3},get_secondaryEntertainmentTypes:function(){return null},get_minimumNormalTimeToSpend:function(){return 2.5},get_maximumNormalTimeToSpend:function(){return 4},get_minimumEntertainmentGroupSatisfy:function(){return 1},get_maximumEntertainmentGroupSatisfy:function(){return 1.5},get_entertainmentQuality:function(){return 100},get_drawerType:function(){return Bn},get_mergingDrawer:function(){return this.drawer},get_walkThroughCanViewSelfInThisBuilding:function(){return null==this.bottomBuilding||!this.bottomBuilding.is(be)},get_isOpenForExistingVisitors:function(){return this.get_isOpen()},finishEntertainment:function(t,e){return!0},postCreate:function(){if(_.prototype.postCreate.call(this),this.updateGardenTexture(),this.justBuilt){var t=null;null!=this.bottomBuilding&&this.bottomBuilding.is(be)&&(t=this.bottomBuilding),null!=this.topBuilding&&this.topBuilding.is(be)&&(t=this.topBuilding),null!=t?this.get_mergingDrawer().setGroupOfSecondaryTextureForThisBuilding(this.get_mergingDrawer().getSecondaryTextureGroup(t.currentTexture)):this.currentTexture=il.getInt(gr.isum(be.gardenTextureSets)),this.justBuilt=!1,this.updateGardenTexture()}this.positionSprites()},postLoad:function(){this.updateGardenTexture(),this.changeMainTexture(this.get_mainTextures()[this.currentMainTexture])},onBuild:function(){_.prototype.onBuild.call(this),this.justBuilt=!0},updateGardenTexture:function(){var e=this;this.get_mergingDrawer().setSecondaryBackgroundImages("spr_botanicalgardens_plants",be.gardenTextureSets,this.currentTexture,function(t){e.currentTexture=t})},beEntertained:function(t,e){En.beEntertainedPark(this.leftBuilding,this.rightBuilding,t)},createWindowAddBottomButtons:function(){var e=this;To.create(this.city.gui,function(){return e.currentMainTexture},function(t){e.currentMainTexture=t,e.changeMainTexture(e.get_mainTextures()[e.currentMainTexture])},function(){return e.get_mainTextures().length},Tr.lo("change_building_color")),To.create(this.city.gui,function(){return e.get_mergingDrawer().getCurrentSecondaryTextureGroup()},Uh(N=this.get_mergingDrawer(),N.setGroupOfSecondaryTexture),function(){return be.gardenTextureSets.length},Tr.lo("change_plants")),To.create(this.city.gui,function(){return e.currentTexture-e.get_mergingDrawer().getFirstSecondaryTextureOfGroup(e.get_mergingDrawer().getCurrentSecondaryTextureGroup())},Uh(N=this.get_mergingDrawer(),N.setSecondaryTextureWithinGroup),function(){return be.gardenTextureSets[e.get_mergingDrawer().getCurrentSecondaryTextureGroup()]},Tr.lo("change_plants_variant")),_.prototype.createWindowAddBottomButtons.call(this)},destroy:function(){_.prototype.destroy.call(this),null!=this.festivalEntertainment&&this.festivalEntertainment.destroy()},initFestival:function(){null==this.festivalEntertainment&&(this.festivalEntertainment=new Cn(this,this.bgStage))},stopFestival:function(){null!=this.festivalEntertainment&&(this.festivalEntertainment.stop(),this.festivalEntertainment.destroy(),this.festivalEntertainment=null)},doFestivalWork:function(t,e,i,n){this.festivalEntertainment.doFestivalWork(t,e,i,0,n)},beEntertainedFestival:function(t,e,i){this.festivalEntertainment.beEntertainedFestival(t,e,i)},endFestivalWork:function(t,e){e.setRelativeY(0)},isTree:function(){return 7<=this.currentTexture&&this.currentTexture<=10},save:function(t,e){null==e&&(e=!0),_.prototype.save.call(this,t),e&&t.addString(be.saveDefinition);var i=this.currentMainTexture;if(t.size+4>t.bytes.length){var n=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+4))),t.bytes.blit(0,n,0,t.size)}t.bytes.setInt32(t.size,i),t.size+=4;i=this.currentTexture;if(t.size+4>t.bytes.length){n=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+4))),t.bytes.blit(0,n,0,t.size)}t.bytes.setInt32(t.size,i),t.size+=4},load:function(t,e){_.prototype.load.call(this,t),null==e&&(e=t.readString());var i=Dr.makeLoadMap(e,t);Object.prototype.hasOwnProperty.call(i.h,"currentMainTexture")&&(this.currentMainTexture=i.h.currentMainTexture),Object.prototype.hasOwnProperty.call(i.h,"currentTexture")&&(this.currentTexture=i.h.currentTexture),this.postLoad()},__class__:be});function we(t,e,i,n,r,s,o,a){this.currentDomeVersion=0,be.call(this,t,e,i,n,r,s,o,a),this.drawer.mergeClass=be,this.drawer.changeTextureGroup("spr_botanicalgardens")}(q["buildings.BotanicalGardensDome"]=we).__name__="buildings.BotanicalGardensDome",we.__super__=be,we.prototype=e(be.prototype,{get_mainTextures:function(){return 0==this.currentDomeVersion?["spr_dome_botanicalgarden","spr_dome_botanicalgarden_alt1","spr_dome_botanicalgarden_alt2"]:["spr_dome_botanicalgarden_b","spr_dome_botanicalgarden_alt1b","spr_dome_botanicalgarden_alt2b"]},get_drawerType:function(){return Un},updateGardenTexture:function(){var e=this;this.get_mergingDrawer().setSecondaryBackgroundImages("spr_dome_botanicalgarden_plants",we.gardenTextureSets,this.currentTexture,function(t){e.currentTexture=t})},postLoad:function(){be.prototype.postLoad.call(this),this.drawer.changeTextureGroup(we.mainTexturesNonDome[this.get_mainTextures().indexOf(this.get_mainTextures()[this.currentMainTexture])])},changeMainTexture:function(t){be.prototype.changeMainTexture.call(this,t),this.drawer.changeTextureGroup(we.mainTexturesNonDome[this.get_mainTextures().indexOf(t)])},createWindowAddBottomButtons:function(){var e=this;To.create(this.city.gui,function(){return e.currentDomeVersion},function(t){e.currentDomeVersion=t,e.changeMainTexture(e.get_mainTextures()[e.currentMainTexture])},function(){return 2},Tr.lo("change_dome_variant")),be.prototype.createWindowAddBottomButtons.call(this)},save:function(t,e){null==e&&(e=!0),be.prototype.save.call(this,t),e&&t.addString(we.saveDefinition);var i=this.currentDomeVersion;if(t.size+4>t.bytes.length){var n=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+4))),t.bytes.blit(0,n,0,t.size)}t.bytes.setInt32(t.size,i),t.size+=4},load:function(t,e){if(be.prototype.load.call(this,t),!(t.version<51)){null==e&&(e=t.readString());var i=Dr.makeLoadMap(e,t);Object.prototype.hasOwnProperty.call(i.h,"currentDomeVersion")&&(this.currentDomeVersion=i.h.currentDomeVersion),this.postLoad()}},__class__:we});function Se(t,e,i,n,r,s,o,a){this.percentCleaned=0,this.foodLeft=0,this.percentGrown=0,this.farmStage=xe.Growing,ee.call(this,t,e,i,n,r,s,o,a),this.textures=dt.getTexturesByWidth("spr_cacaofarm_trees",20),this.growthSprite=new PIXI.Sprite,i.addChild(this.growthSprite),this.updateTexture(),this.positionSprites(),this.doorX=12,this.adjecentBuildingEffects.push({name:"farm",intensity:1})}var xe=T["buildings.CacaoFarmStage"]={__ename__:"buildings.CacaoFarmStage",__constructs__:["Growing","Harvesting"],Growing:{_hx_index:0,__enum__:"buildings.CacaoFarmStage",toString:i},Harvesting:{_hx_index:1,__enum__:"buildings.CacaoFarmStage",toString:i}};(q["buildings.CacaoFarm"]=Se).__name__="buildings.CacaoFarm",Se.__super__=ee,Se.prototype=e(ee.prototype,{postLoad:function(){this.updateTexture()},work:function(t,e,i){var n=this;if(i)t.currentAction=2;else if(this.farmStage==xe.Growing){t.setRelativeY(0);var r=1<this.city.materials.food||1<this.city.simulation.happiness.actionSpeedModifier;null==r&&(r=!1),t.moveAndWait(il.getInt(5,13),il.getInt(50,100),function(){if(n.percentGrown+=.75,100<=n.percentGrown){n.farmStage=xe.Harvesting;var t=35+n.city.simulation.bonuses.extraFoodFromFarms,e=n.getEffectsOfAdjecentBuildings("increaseCropNumber");n.foodLeft=t+e}n.updateTexture()},r,!1)}else{if(t.relativeY<=1)0==this.workers.indexOf(t)?t.setPath(new Int32Array([4,6,9,7]),0,4,!0):t.setPath(new Int32Array([4,12,9,5]),0,4,!0);else{var s=.025*this.city.simulation.boostManager.currentGlobalBoostAmount/this.city.simulation.happiness.actionSpeedModifier;this.foodLeft-=s;var o=this.city.materials;o.set_food(o.food+s),this.city.simulation.stats.materialProduction[0][0]+=s,this.city.materials.cacao+=s,this.city.simulation.stats.materialProduction[6][0]+=s,this.foodLeft<=0&&(this.farmStage=xe.Growing,this.percentGrown=0),this.updateTexture()}}},destroy:function(){ee.prototype.destroy.call(this),this.growthSprite.destroy()},update:function(t){if(this.farmStage==xe.Growing){var e=this.city.simulation.time.timeSinceStart/60%24;if((i=7)<(n=20)?i<=e&&e<n:i<=e||e<n)this.percentGrown+=.012*t,100<=this.percentGrown&&(this.farmStage=xe.Harvesting,this.foodLeft=35+this.city.simulation.bonuses.extraFoodFromFarms+this.getEffectsOfAdjecentBuildings("increaseCropNumber")),this.updateTexture();else{var i,n;e=this.city.simulation.time.timeSinceStart/60%24;((i=6)<(n=21)?i<=e&&e<n:i<=e||e<n)&&(this.percentGrown+=.006*t,100<=this.percentGrown&&(this.farmStage=xe.Harvesting,this.foodLeft=35+this.city.simulation.bonuses.extraFoodFromFarms+this.getEffectsOfAdjecentBuildings("increaseCropNumber")),this.updateTexture())}}},grow:function(t){this.percentGrown+=t,100<=this.percentGrown&&(this.farmStage=xe.Harvesting,this.foodLeft=35+this.city.simulation.bonuses.extraFoodFromFarms+this.getEffectsOfAdjecentBuildings("increaseCropNumber")),this.updateTexture()},updateTexture:function(){var t;switch(this.farmStage._hx_index){case 0:t=this.textures[Math.floor(this.percentGrown/100*(this.textures.length-1))];break;case 1:t=this.textures[this.textures.length-1]}this.growthSprite.texture=t},positionSprites:function(){ee.prototype.positionSprites.call(this),null!=this.growthSprite&&this.growthSprite.position.set(this.position.x,this.position.y)},addWindowInfoLines:function(){var t=this;ee.prototype.addWindowInfoLines.call(this),this.city.gui.windowAddInfoText(null,function(){switch(t.farmStage._hx_index){case 0:return Tr.lo("beans_grown",[Math.floor(t.percentGrown)]);case 1:return Tr.lo("cacao_left",[Math.floor(t.foodLeft)])}})},save:function(t,e){null==e&&(e=!0),ee.prototype.save.call(this,t),e&&t.addString(Se.saveDefinition);var i=this.farmStage;t.addString(T[i.__enum__].__constructs__[i._hx_index]);var n=this.percentGrown;if(t.size+8>t.bytes.length){var r=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+8))),t.bytes.blit(0,r,0,t.size)}t.bytes.setDouble(t.size,n),t.size+=8;n=this.foodLeft;if(t.size+8>t.bytes.length){r=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+8))),t.bytes.blit(0,r,0,t.size)}t.bytes.setDouble(t.size,n),t.size+=8;n=this.percentCleaned;if(t.size+8>t.bytes.length){r=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+8))),t.bytes.blit(0,r,0,t.size)}t.bytes.setDouble(t.size,n),t.size+=8},load:function(t,e){ee.prototype.load.call(this,t),null==e&&(e=t.readString());var i=Dr.makeLoadMap(e,t);Object.prototype.hasOwnProperty.call(i.h,"farmStage")&&(this.farmStage=i.h.farmStage),Object.prototype.hasOwnProperty.call(i.h,"percentGrown")&&(this.percentGrown=i.h.percentGrown),Object.prototype.hasOwnProperty.call(i.h,"foodLeft")&&(this.foodLeft=i.h.foodLeft),Object.prototype.hasOwnProperty.call(i.h,"percentCleaned")&&(this.percentCleaned=i.h.percentCleaned),this.postLoad()},__class__:Se});function Te(t,e,i,n,r,s,o,a){ee.call(this,t,e,i,n,r,s,o,a),this.startTime=20,this.endTime=5.5,this.workTimePreferenceMod=.5,this.isEntertainment=!0}(q["buildings.CarrotJuiceBar"]=Te).__name__="buildings.CarrotJuiceBar",Te.__interfaces__=[oe],Te.__super__=ee,Te.prototype=e(ee.prototype,{get_baseEntertainmentCapacity:function(){return 50*this.workers.length},get_isOpen:function(){if(1!=this.workers.length||0!=this.workers[0].currentAction)return!1;var t=this.city.simulation.time.timeSinceStart/60%24,e=this.startTime-this.workTimePreferenceMod;return e<4.5?e<=t&&t<4.5:e<=t||t<4.5},get_entertainmentType:function(){return 1},get_secondaryEntertainmentTypes:function(){return null},get_minimumNormalTimeToSpend:function(){return 2},get_maximumNormalTimeToSpend:function(){return 6},get_minimumEntertainmentGroupSatisfy:function(){return 1},get_maximumEntertainmentGroupSatisfy:function(){return 3},get_entertainmentQuality:function(){return 100},get_isOpenForExistingVisitors:function(){return this.get_isOpen()},finishEntertainment:function(t,e){return!0},beEntertained:function(r,t){function e(){var t=il.getInt(7,16),e=r,i=ka.pool,n=0<i[2].length?i[2].splice(i[2].length-1,1)[0]:new Int32Array(2);n[0]=4,n[1]=t,e.setPath(n,0,2,!0),r.pathEndFunction=null,r.pathOnlyRelatedTo=r.inPermanent}if(r.relativeY<5)r.changeFloor(e);else{var i=r,n=ka.pool,s=0<n[2].length?n[2].splice(n[2].length-1,1)[0]:new Int32Array(2);s[0]=8,s[1]=il.getInt(120,180),i.setPath(s,0,2,!0),r.pathEndFunction=e,r.pathOnlyRelatedTo=r.inPermanent}r.hasBuildingInited||(r.wantsNightEntertainmentIn=il.getInt(1,5),r.hasBuildingInited=!0)},work:function(t,e,i){if(i&&4.5<this.city.simulation.time.timeSinceStart/60%24)t.currentAction=2;else switch(this.workers.indexOf(t)){case 0:if(t.relativeY<5)t.changeFloor();else{var n=t.pathWalkSpeed*e;if(K.shouldUpdateDraw=!0,Math.abs(3-t.relativeX)<n)t.relativeX=3;else{var r=3-t.relativeX;t.relativeX+=(0<r?1:r<0?-1:0)*n}}break;case 1:5<t.relativeY?t.changeFloor():t.moveAndWait(il.getInt(12,16),il.getInt(30,60),null,!1,!1);break;case 2:t.relativeY<5?t.changeFloor():t.moveAndWait(il.getInt(7,16),il.getInt(90,120),null,!1,!1)}},__class__:Te});function Ie(t,e,i,n,r,s,o,a,l,h){this.activeWorkersTotalEducation=0,this.activeWorkers=0,this.buildingEnabled=!0,ee.call(this,t,e,i,n,r,s,o,a),this.activeBgTextures=dt.getTexturesByWidth(l,20),this.idleBgTextures=dt.getTexturesByWidth(h,20),this.bgTexture=0,this.backSprite=new PIXI.Sprite(this.idleBgTextures[0]),this.backSprite.position.set(s.x,s.y),i.addChild(this.backSprite)}(q["buildings.Factory"]=Ie).__name__="buildings.Factory",Ie.__super__=ee,Ie.prototype=e(ee.prototype,{work:function(t,e,i){i?t.currentAction=2:(this.workAnimation(t,e),this.activeWorkers+=1,this.activeWorkersTotalEducation+=t.get_educationSpeedModifier())},workAnimation:function(t,e){},update:function(t){var e=!1;0<this.activeWorkers&&this.buildingEnabled&&(e=this.possiblyBeActive(t));var i=e&&this.canShowActiveTextures()?this.activeBgTextures:this.idleBgTextures;this.bgTexture+=t/4,this.bgTexture>=i.length&&(this.bgTexture=0),this.backSprite.texture=i[0|this.bgTexture],this.activeWorkers=0,this.activeWorkersTotalEducation=0},positionSprites:function(){ee.prototype.positionSprites.call(this),null!=this.backSprite&&this.backSprite.position.set(this.position.x,this.position.y)},destroy:function(){ee.prototype.destroy.call(this),null!=this.backSprite&&this.backSprite.destroy()},possiblyBeActive:function(t){return!1},canShowActiveTextures:function(){return!1},__class__:Ie});function Pe(t,e,i,n,r,s,o,a,l,h){this.materialMade=0,this.totalMaterialUsed=0,this.efficiency=this.get_normalEfficiency(),Ie.call(this,t,e,i,n,r,s,o,a,l,h)}(q["buildings.MaterialConvertingFactory"]=Pe).__name__="buildings.MaterialConvertingFactory",Pe.__super__=Ie,Pe.prototype=e(Ie.prototype,{get_normalEfficiency:function(){return 3},get_materialFrom:function(){return 0},set_materialFrom:function(t){return t},get_materialTo:function(){return 0},set_materialTo:function(t){return t},get_bonusSpeed:function(){return 1},get_walkThroughCanViewSelfInThisBuilding:function(){return!1},possiblyBeActive:function(t){if(1<=this.get_materialFrom()){var e=t*this.materialsMadePerStepPerWorker*this.activeWorkers*this.city.simulation.happiness.actionSpeedModifier*this.get_bonusSpeed()*this.city.simulation.boostManager.currentGlobalBoostAmount;(i=this).set_materialTo(i.get_materialTo()+e),this.materialMade+=e;var i,n=e*this.efficiency;return(i=this).set_materialFrom(i.get_materialFrom()-n),this.totalMaterialUsed+=n,!0}return!1},canShowActiveTextures:function(){return 3<=this.get_materialFrom()},save:function(t,e){null==e&&(e=!0),Ie.prototype.save.call(this,t),e&&t.addString(Pe.saveDefinition);var i=this.totalMaterialUsed;if(t.size+8>t.bytes.length){var n=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+8))),t.bytes.blit(0,n,0,t.size)}t.bytes.setDouble(t.size,i),t.size+=8;i=this.materialMade;if(t.size+8>t.bytes.length){n=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+8))),t.bytes.blit(0,n,0,t.size)}t.bytes.setDouble(t.size,i),t.size+=8},load:function(t,e){Ie.prototype.load.call(this,t),null==e&&(e=t.readString());var i=Dr.makeLoadMap(e,t);Object.prototype.hasOwnProperty.call(i.h,"totalMaterialUsed")&&(this.totalMaterialUsed=i.h.totalMaterialUsed),Object.prototype.hasOwnProperty.call(i.h,"materialMade")&&(this.materialMade=i.h.materialMade)},__class__:Pe});function Ce(t,e,i,n,r,s,o,a){this.materialsMadePerStepPerWorker=8e-4,Pe.call(this,t,e,i,n,r,s,o,a,"spr_chocolatefactory_frames","spr_chocolatefactory_idle")}(q["buildings.ChocolateFactory"]=Ce).__name__="buildings.ChocolateFactory",Ce.__super__=Pe,Ce.prototype=e(Pe.prototype,{get_normalEfficiency:function(){return 1},get_walkThroughCanViewSelfInThisBuilding:function(){return!1},get_possibleUpgrades:function(){return[]},get_possibleBuildingModes:function(){return[ft,rt]},get_materialFrom:function(){return this.city.materials.cacao},set_materialFrom:function(t){return this.city.materials.cacao=t},get_materialTo:function(){return this.city.materials.chocolate},set_materialTo:function(t){var e=t-this.city.materials.chocolate;return this.city.materials.chocolate+=e,this.city.simulation.stats.materialProduction[7][0]+=e,this.city.materials.chocolate},workAnimation:function(t,e){if(1==this.workers.indexOf(t)){var i=t.pathWalkSpeed*e;if(K.shouldUpdateDraw=!0,Math.abs(3-t.relativeX)<i)t.relativeX=3;else{var n=3-t.relativeX;t.relativeX+=(0<n?1:n<0?-1:0)*i}}else{i=t.pathWalkSpeed*e;if(K.shouldUpdateDraw=!0,Math.abs(7-t.relativeX)<i)t.relativeX=7;else{n=7-t.relativeX;t.relativeX+=(0<n?1:n<0?-1:0)*i}}},addWindowInfoLines:function(){var t=this;Pe.prototype.addWindowInfoLines.call(this),this.city.gui.windowAddInfoText(null,function(){return Tr.lo("chocolate_production",[0|t.totalMaterialUsed,0|t.materialMade])})},save:function(t,e){null==e&&(e=!0),Pe.prototype.save.call(this,t),e&&t.addString(Ce.saveDefinition)},load:function(t,e){Pe.prototype.load.call(this,t),null==e&&(e=t.readString());Dr.makeLoadMap(e,t)},__class__:Ce});function Ee(t,e,i,n,r,s,o,a){ee.call(this,t,e,i,n,r,s,o,a),this.startTime=20,this.endTime=5.5,this.workTimePreferenceMod=.5,this.isEntertainment=!0}(q["buildings.ChristmasMarket"]=Ee).__name__="buildings.ChristmasMarket",Ee.__interfaces__=[oe],Ee.__super__=ee,Ee.prototype=e(ee.prototype,{get_baseEntertainmentCapacity:function(){return 50*this.workers.length},get_isOpen:function(){if(1<=this.workers.length&&0==this.workers[0].currentAction){var t=this.city.simulation.time.timeSinceStart/60%24,e=this.startTime-this.workTimePreferenceMod;return e<4.5?e<=t&&t<4.5:e<=t||t<4.5}return!1},get_entertainmentType:function(){return 1},get_secondaryEntertainmentTypes:function(){return null},get_minimumNormalTimeToSpend:function(){return 2},get_maximumNormalTimeToSpend:function(){return 6},get_minimumEntertainmentGroupSatisfy:function(){return 1},get_maximumEntertainmentGroupSatisfy:function(){return 3},get_entertainmentQuality:function(){return 100},get_isOpenForExistingVisitors:function(){return this.get_isOpen()},finishEntertainment:function(t,e){return!0},get_drawerType:function(){return Rn},beEntertained:function(r,t){function e(){var t=il.getInt(3,16),e=r,i=ka.pool,n=0<i[2].length?i[2].splice(i[2].length-1,1)[0]:new Int32Array(2);n[0]=4,n[1]=t,e.setPath(n,0,2,!0),r.pathEndFunction=null,r.pathOnlyRelatedTo=r.inPermanent}if(r.relativeY<5&&il.getFloat()<.3)r.changeFloor(e);else{var i=r,n=ka.pool,s=0<n[2].length?n[2].splice(n[2].length-1,1)[0]:new Int32Array(2);s[0]=8,s[1]=il.getInt(120,180),i.setPath(s,0,2,!0),r.pathEndFunction=e,r.pathOnlyRelatedTo=r.inPermanent}r.hasBuildingInited||(r.wantsNightEntertainmentIn=il.getInt(1,5),r.hasBuildingInited=!0)},work:function(t,e,i){if(i&&4.5<this.city.simulation.time.timeSinceStart/60%24)t.currentAction=2;else if(0==this.workers.indexOf(t)){var n=t.pathWalkSpeed*e;if(K.shouldUpdateDraw=!0,Math.abs(12-t.relativeX)<n)t.relativeX=12;else{var r=12-t.relativeX;t.relativeX+=(0<r?1:r<0?-1:0)*n}}else if(t.relativeY<5)t.changeFloor();else{var s=!1,o=!0;null==o&&(o=!1),null==s&&(s=!1),t.moveAndWait(il.getInt(3,16),il.getInt(60,90),null,s,o)}},save:function(t,e){null==e&&(e=!0),ee.prototype.save.call(this,t),e&&t.addString(Ee.saveDefinition)},load:function(t,e){if(ee.prototype.load.call(this,t),!(t.version<7)){null==e&&(e=t.readString());Dr.makeLoadMap(e,t)}},__class__:Ee});function Ae(t,e,i,n,r,s,o,a){this.festivalJobs=2,this.parkSprite=null,this.currentMainTexture=0,_.call(this,t,e,i,n,r,s,o,a),this.isEntertainment=!0,this.parkTextures=dt.getTexturesByWidth(this.get_myParkTextures(),20),this.currentTexture=il.getInt(this.parkTextures.length-this.get_numberOfLockedParkTextures()),this.parkSprite=new PIXI.Sprite(this.parkTextures[this.currentTexture]),this.parkSprite.position.set(s.x,s.y),i.cacheableChildren.push(this.parkSprite),i.isInvalid=!0,this.adjecentBuildingEffects.push({name:"modernRusticHomeCommunityFeeling",intensity:1}),this.festivalEntertainment=null}(q["buildings.Park"]=Ae).__name__="buildings.Park",Ae.__interfaces__=[ve,oe],Ae.__super__=_,Ae.prototype=e(_.prototype,{get_myParkTextures:function(){return"spr_park_plants"},get_changePlantsText:function(){return Tr.lo("change_plants")},get_baseEntertainmentCapacity:function(){return 30},get_isOpen:function(){var t=this.city.simulation.time.timeSinceStart/60%24;return 6<=t&&t<22},get_entertainmentType:function(){return 3},get_secondaryEntertainmentTypes:function(){return null},get_minimumNormalTimeToSpend:function(){return 1.5},get_maximumNormalTimeToSpend:function(){return 2.5},get_minimumEntertainmentGroupSatisfy:function(){return 1},get_maximumEntertainmentGroupSatisfy:function(){return 1.75},get_entertainmentQuality:function(){return 100},get_isOpenForExistingVisitors:function(){return this.get_isOpen()},finishEntertainment:function(t,e){return!0},get_drawerType:function(){return Rn},get_numberOfLockedParkTextures:function(){return O.hasSecretCode("orchid")?0:3},postLoad:function(){this.parkSprite.texture=this.parkTextures[this.currentTexture],this.bgStage.isInvalid=!0,this.changeMainTexture(Ae.mainTextures[this.currentMainTexture])},postCreate:function(){_.prototype.postCreate.call(this),this.positionSprites()},positionSprites:function(){_.prototype.positionSprites.call(this),null!=this.parkSprite&&(this.parkSprite.position.set(this.position.x,this.position.y),this.bgStage.isInvalid=!0)},beEntertained:function(t,e){En.beEntertainedPark(this.leftBuilding,this.rightBuilding,t)},createWindowAddBottomButtons:function(){var e=this;To.create(this.city.gui,function(){return e.currentMainTexture},function(t){e.currentMainTexture=t,e.changeMainTexture(Ae.mainTextures[e.currentMainTexture])},function(){return Ae.mainTextures.length},Tr.lo("change_building_color")),""!=this.get_changePlantsText()&&To.create(this.city.gui,function(){return e.currentTexture},function(t){e.currentTexture=t,e.parkSprite.texture=e.parkTextures[e.currentTexture],e.bgStage.isInvalid=!0},function(){return e.parkTextures.length-e.get_numberOfLockedParkTextures()},this.get_changePlantsText()),_.prototype.createWindowAddBottomButtons.call(this)},destroy:function(){_.prototype.destroy.call(this),null!=this.festivalEntertainment&&this.festivalEntertainment.destroy();var t=this.bgStage,e=this.parkSprite;at.remove(t.cacheableChildren,e),t.isInvalid=!0,e.destroy({children:!0,texture:!1})},initFestival:function(){null==this.festivalEntertainment&&(this.festivalEntertainment=new Cn(this,this.bgStage))},stopFestival:function(){null!=this.festivalEntertainment&&(this.festivalEntertainment.stop(),this.festivalEntertainment.destroy(),this.festivalEntertainment=null)},doFestivalWork:function(t,e,i,n){this.festivalEntertainment.doFestivalWork(t,e,i,this.currentMainTexture,n)},beEntertainedFestival:function(t,e,i){this.festivalEntertainment.beEntertainedFestival(t,e,i)},endFestivalWork:function(t,e){e.setRelativeY(0)},save:function(t,e){null==e&&(e=!0),_.prototype.save.call(this,t),e&&t.addString(Ae.saveDefinition);var i=this.currentTexture;if(t.size+4>t.bytes.length){var n=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+4))),t.bytes.blit(0,n,0,t.size)}t.bytes.setInt32(t.size,i),t.size+=4;i=this.currentMainTexture;if(t.size+4>t.bytes.length){n=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+4))),t.bytes.blit(0,n,0,t.size)}t.bytes.setInt32(t.size,i),t.size+=4},load:function(t,e){_.prototype.load.call(this,t),null==e&&(e=t.readString());var i=Dr.makeLoadMap(e,t);Object.prototype.hasOwnProperty.call(i.h,"currentTexture")&&(this.currentTexture=i.h.currentTexture),Object.prototype.hasOwnProperty.call(i.h,"currentMainTexture")&&(this.currentMainTexture=i.h.currentMainTexture),this.postLoad()},__class__:Ae});function Me(t,e,i,n,r,s,o,a){Ae.call(this,t,e,i,n,r,s,o,a),this.currentTexture=0,this.parkSprite.texture=this.parkTextures[this.currentTexture]}(q["buildings.ChristmasTree"]=Me).__name__="buildings.ChristmasTree",Me.__super__=Ae,Me.prototype=e(Ae.prototype,{get_myParkTextures:function(){return"spr_christmastree"},get_changePlantsText:function(){return""},get_entertainmentType:function(){return 3},get_baseEntertainmentCapacity:function(){return 50},get_numberOfLockedParkTextures:function(){return 0},save:function(t,e){null==e&&(e=!0),Ae.prototype.save.call(this,t),e&&t.addString(Me.saveDefinition)},load:function(t,e){Ae.prototype.load.call(this,t),null==e&&(e=t.readString());Dr.makeLoadMap(e,t)},__class__:Me});function Be(t,e,i,n,r,s,o,a){this.totalKnowledgeGenerated=0,this.bldMode=0,ee.call(this,t,e,i,n,r,s,o,a)}(q["buildings.CityHall"]=Be).__name__="buildings.CityHall",Be.sanitizeCityName=function(t){return at.substr(t,0,1e3)},Be.__super__=ee,Be.prototype=e(ee.prototype,{get_possiblePolicies:function(){return[ba,Ta,wa]},get_possibleBuildingModes:function(){return[tt,Dt]},postCreate:function(){null==this.buildingMode&&0<this.get_possibleBuildingModes().length&&(this.buildingMode=k.createInstance(this.get_possibleBuildingModes()[0],[this.stage,this.city.cityMidStage,this.bgStage,this]))},destroy:function(){ee.prototype.destroy.call(this),this.city.upgrades.vars.nightClubEntertainmentQualityBonus=0},update:function(t){if(ee.prototype.update.call(this,t),(this.city.upgrades.vars.nightClubEntertainmentQualityBonus=0)==this.bldMode){var e=this.workers.length*this.city.simulation.citizens.length*t*5e-7;this.city.materials.knowledge+=e,this.city.simulation.stats.materialProduction[10][0]+=e,this.totalKnowledgeGenerated+=e}else 1==this.bldMode&&(this.city.upgrades.vars.nightClubEntertainmentQualityBonus=2*this.workers.length)},work:function(t,e,i){i&&(t.currentAction=2);var n=il.getInt(7);t.relativeY<5?n<3?t.changeFloorAndWaitRandom(20,30):n<5?t.moveAndWait(il.getInt(3,7),il.getInt(90,180),null,!1,!1):t.moveAndWait(il.getInt(12,15),il.getInt(90,180),null,!1,!1):n<1?t.changeFloorAndWaitRandom(20,30):n<3?t.moveAndWait(il.getInt(3,4),il.getInt(90,180),null,!1,!1):n<5?t.moveAndWait(il.getInt(9,10),il.getInt(90,180),null,!1,!1):t.moveAndWait(il.getInt(15,16),il.getInt(90,180),null,!1,!1)},addWindowInfoLines:function(){var t=this;ee.prototype.addWindowInfoLines.call(this),this.city.gui.windowAddInfoText(null,function(){return Tr.lo("knowledge_gathered",[0|t.totalKnowledgeGenerated])})},createWindowAddBottomButtons:function(){var e=this;ss.createSettingButton(this.city.gui,this.city.gui.innerWindowStage,this.city.gui.windowInner,function(){e.city.simulation.happiness.ignoreUnhappyCitizens=!e.city.simulation.happiness.ignoreUnhappyCitizens},function(){return e.city.simulation.happiness.ignoreUnhappyCitizens},Tr.lo("ignore_unhappy_citizens")),this.city.gui.windowInner.addChild(new Ms(this.city.gui.windowInner,new vr(2,4))),po.createHeader(this.city.gui,Tr.lo("city_name")),this.city.gui.windowInner.addChild(new lo(this.city.gui.windowInner,this.city.gui.innerWindowStage,null,function(){return""==e.city.cityName?Tr.lo("unnamed_city"):e.city.cityName},"Arial, sans-serif",null,300,null,15));Io.create(this.city.gui,function(){if(e.game.isMobile){var t=window.prompt(Tr.lo("give_city_name"),e.city.cityName);null!=t&&(e.city.cityName=Be.sanitizeCityName(t))}else rs.createWindow(e.city)},this.city.gui.windowInner,function(){return Tr.lo("change_city_name")},this.city.gui.innerWindowStage);this.city.gui.windowInner.addChild(new Ms(this.city.gui.windowInner,new vr(2,4))),ee.prototype.createWindowAddBottomButtons.call(this)},save:function(t,e){null==e&&(e=!0),ee.prototype.save.call(this,t),e&&t.addString(Be.saveDefinition);var i=this.totalKnowledgeGenerated;if(t.size+8>t.bytes.length){var n=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+8))),t.bytes.blit(0,n,0,t.size)}t.bytes.setDouble(t.size,i),t.size+=8},load:function(t,e){ee.prototype.load.call(this,t),null==e&&(e=t.readString());var i=Dr.makeLoadMap(e,t);Object.prototype.hasOwnProperty.call(i.h,"totalKnowledgeGenerated")&&(this.totalKnowledgeGenerated=i.h.totalKnowledgeGenerated)},__class__:Be});function Re(){}(q["buildings.IRecolorableOnBuild"]=Re).__name__="buildings.IRecolorableOnBuild",Re.__isInterface__=!0;var Oe=function(){};(q["buildings.ICustomizableOnBuild"]=Oe).__name__="buildings.ICustomizableOnBuild",Oe.__isInterface__=!0,Oe.prototype={__class__:Oe};function ke(t,e,i,n,r,s,o,a){this.currentRecolor=-1,this.currentTexture=0,_.call(this,t,e,i,n,r,s,o,a)}(q["buildings.ColoredBlock"]=ke).__name__="buildings.ColoredBlock",ke.__interfaces__=[Re,Oe],ke.__super__=_,ke.prototype=e(_.prototype,{get_drawerType:function(){return Ln},get_decorationDrawer:function(){return this.drawer},customize:function(t,e){this.currentTexture=t},customizeColor:function(t){this.currentRecolor=t},areSameCustomizations:function(t,e,i){return this.currentTexture==t&&this.currentRecolor==i},createOrRemoveBuilderForThis:function(){this.city.createOrRemoveBuilder(Ko.getClass(this),!0,this.currentTexture,null,this.currentRecolor)},postCreate:function(){this.get_decorationDrawer().changeSubImage(this.currentTexture),this.get_decorationDrawer().setTint(this.currentRecolor)},createWindowAddBottomButtons:function(){var e=this;-1==this.currentRecolor?To.create(this.city.gui,function(){return e.currentTexture},function(t){e.currentTexture=t,e.get_decorationDrawer().changeSubImage(t)},function(){return e.get_decorationDrawer().getSubImageNumber()-1},Tr.lo("change_building_color")):(Io.create(this.city.gui,function(){ls.colorPicked=e.currentRecolor,hs.createWindow(e.city,function(t){e.currentRecolor=t,e.get_decorationDrawer().setTint(e.currentRecolor)})},this.city.gui.windowInner,function(){return Tr.lo("change_building_color")},this.city.gui.innerWindowStage),this.city.gui.windowInner.addChild(new Ms(this.city.gui.windowInner,new vr(2,4))),Io.create(this.city.gui,function(){e.createOrRemoveBuilderForThis(),e.city.gui.closeWindow()},this.city.gui.windowInner,function(){return Tr.lo("duplicate_building")},this.city.gui.innerWindowStage)),this.city.gui.windowInner.addChild(new Ms(this.city.gui.windowInner,new vr(2,6))),_.prototype.createWindowAddBottomButtons.call(this)},save:function(t,e){null==e&&(e=!0),_.prototype.save.call(this,t),e&&t.addString(ke.saveDefinition);var i=this.currentTexture;if(t.size+4>t.bytes.length){var n=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+4))),t.bytes.blit(0,n,0,t.size)}t.bytes.setInt32(t.size,i),t.size+=4;i=this.currentRecolor;if(t.size+4>t.bytes.length){n=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+4))),t.bytes.blit(0,n,0,t.size)}t.bytes.setInt32(t.size,i),t.size+=4},load:function(t,e){_.prototype.load.call(this,t),null==e&&(e=t.readString());var i=Dr.makeLoadMap(e,t);Object.prototype.hasOwnProperty.call(i.h,"currentTexture")&&(this.currentTexture=i.h.currentTexture),Object.prototype.hasOwnProperty.call(i.h,"currentRecolor")&&(this.currentRecolor=i.h.currentRecolor)},__class__:ke});function De(t,e,i,n,r,s,o,a){re.call(this,t,e,i,n,r,s,o,a)}(q["buildings.ComfortableHouse"]=De).__name__="buildings.ComfortableHouse",De.__super__=re,De.prototype=e(re.prototype,{get_possibleUpgrades:function(){return[et,Ht]},__class__:De});function Fe(t,e,i,n,r,s,o,a){this.materialsMadePerStepPerWorker=1e-4,Pe.call(this,t,e,i,n,r,s,o,a,"spr_computerchipfactory_frames","spr_computerchipfactory_idle")}(q["buildings.ComputerChipFactory"]=Fe).__name__="buildings.ComputerChipFactory",Fe.__super__=Pe,Fe.prototype=e(Pe.prototype,{get_normalEfficiency:function(){return 7},get_walkThroughCanViewSelfInThisBuilding:function(){return!1},get_possibleUpgrades:function(){return[nt]},get_possibleBuildingModes:function(){return[ft,Ut]},get_materialFrom:function(){return this.city.materials.refinedMetal},set_materialFrom:function(t){var e=this.city.materials.refinedMetal-t;return this.city.materials.refinedMetal-=e,this.city.simulation.stats.materialUsed[4][0]+=e,this.city.materials.refinedMetal},get_materialTo:function(){return this.city.materials.computerChips},set_materialTo:function(t){var e=t-this.city.materials.computerChips;return this.city.materials.computerChips+=e,this.city.simulation.stats.materialProduction[5][0]+=e,this.city.materials.computerChips},get_bonusSpeed:function(){return(0==this.activeWorkers?1:this.activeWorkersTotalEducation/this.activeWorkers)*this.city.upgrades.vars.computerChipFactorySpeed},onBuild:function(){this.city.progress.unlocks.unlock(z),this.city.progress.unlocks.unlock(vt),this.city.progress.unlocks.unlock(un),this.city.progress.unlocks.unlock(vi),this.city.progress.unlocks.unlock(dn),this.city.progress.unlocks.unlock(Le),this.city.progress.unlocks.fullyUnlock(ue),this.city.progress.unlocks.unlock($n),this.city.progress.unlocks.unlock(Ft),this.city.progress.unlocks.unlock(yt)},workAnimation:function(t,e){if(10!=t.relativeY)if(1==this.workers.indexOf(t))t.setRelativePos(3,10);else if(0==this.workers.indexOf(t)){var i=t.pathWalkSpeed*e;if(K.shouldUpdateDraw=!0,Math.abs(3-t.relativeX)<i)t.relativeX=3;else{var n=3-t.relativeX;t.relativeX+=(0<n?1:n<0?-1:0)*i}t.setRelativeY(0)}else{i=t.pathWalkSpeed*e;if(K.shouldUpdateDraw=!0,Math.abs(13-t.relativeX)<i)t.relativeX=13;else{n=13-t.relativeX;t.relativeX+=(0<n?1:n<0?-1:0)*i}t.setRelativeY(0)}},addWindowInfoLines:function(){var t=this;Pe.prototype.addWindowInfoLines.call(this),this.city.gui.windowAddInfoText(null,function(){return Tr.lo("computer_chip_production",[0|t.totalMaterialUsed,0|t.materialMade])})},save:function(t,e){null==e&&(e=!0),Pe.prototype.save.call(this,t),e&&t.addString(Fe.saveDefinition)},load:function(t,e){Pe.prototype.load.call(this,t),null==e&&(e=t.readString());Dr.makeLoadMap(e,t)},__class__:Fe});function Ne(t,e,i,n,r,s,o,a){this.totalKnowledgeGenerated=0,Ie.call(this,t,e,i,n,r,s,o,a,"spr_computerresearchcenter_frames","spr_computerresearchcenter_idle")}(q["buildings.ComputerResearchCenter"]=Ne).__name__="buildings.ComputerResearchCenter",Ne.__super__=Ie,Ne.prototype=e(Ie.prototype,{get_possibleCityUpgrades:function(){return[$n]},get_walkThroughCanViewSelfInThisBuilding:function(){return!1},workAnimation:function(t,e){switch(this.workers.indexOf(t)){case 0:t.setRelativePos(13,10);break;case 1:t.setRelativePos(6,0);break;case 2:t.setRelativePos(6,10);break;case 3:t.setRelativePos(15,0);break;case 4:t.setRelativePos(8,0)}},possiblyBeActive:function(t){var e=.0014*t*this.city.simulation.happiness.actionSpeedModifier*this.activeWorkersTotalEducation*this.city.simulation.boostManager.currentGlobalBoostAmount;return this.city.materials.knowledge+=e,this.city.simulation.stats.materialProduction[10][0]+=e,this.totalKnowledgeGenerated+=e,!0},canShowActiveTextures:function(){return!0},addWindowInfoLines:function(){var t=this;Ie.prototype.addWindowInfoLines.call(this),this.city.gui.windowAddInfoText(null,function(){return Tr.lo("knowledge_gathered",[0|t.totalKnowledgeGenerated])})},save:function(t,e){null==e&&(e=!0),Ie.prototype.save.call(this,t),e&&t.addString(Ne.saveDefinition);var i=this.totalKnowledgeGenerated;if(t.size+8>t.bytes.length){var n=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+8))),t.bytes.blit(0,n,0,t.size)}t.bytes.setDouble(t.size,i),t.size+=8},load:function(t,e){Ie.prototype.load.call(this,t),null==e&&(e=t.readString());var i=Dr.makeLoadMap(e,t);Object.prototype.hasOwnProperty.call(i.h,"totalKnowledgeGenerated")&&(this.totalKnowledgeGenerated=i.h.totalKnowledgeGenerated)},__class__:Ne});var Le=function(t,e,i,n,r,s,o,a){re.call(this,t,e,i,n,r,s,o,a)};(q["buildings.CuttingEdgeHome"]=Le).__name__="buildings.CuttingEdgeHome",Le.__super__=re,Le.prototype=e(re.prototype,{get_possibleUpgrades:function(){return[j,kt,Wt]},walkAround:function(t,e){var i=il.getInt(3);if(0==i&&120<e)t.changeFloorAndWaitRandom(30,60);else if(1==i)t.relativeY<5?t.moveAndWait(il.getInt(3,15),il.getInt(30,60),null,!1,!1):t.moveAndWait(il.getInt(5,15),il.getInt(30,60),null,!1,!1);else{var n=ka.pool,r=0<n[2].length?n[2].splice(n[2].length-1,1)[0]:new Int32Array(2);r[0]=8,r[1]=il.getInt(90,120),t.setPath(r,0,2,!0),t.pathEndFunction=null,t.pathOnlyRelatedTo=t.inPermanent}},__class__:Le});var Ue=function(t,e,i,n,r,s,o,a){this.crop3Sprite=0,this.crop2Sprite=0,this.openDay=0,ee.call(this,t,e,i,n,r,s,o,a),this.crop2Sprite=il.getInt(Ue.crop2Sprites.length),this.crop3Sprite=il.getInt(Ue.crop3Sprites.length),this.growthAreas=[new Ke(i,this,new vr(3,3),n,"spr_ecofarm_crop1",6,20+n.upgrades.vars.extraEcoFarmFoodToPlot1,.7,0,6),new Ke(i,this,new vr(9,3),n,Ue.crop2Sprites[this.crop2Sprite],8,10+n.upgrades.vars.extraEcoFarmFoodToPlot2,1.4,10),new Ke(i,this,new vr(9,12),n,Ue.crop3Sprites[this.crop3Sprite],8,12,.6,7)],this.isEntertainment=!0,this.openDay=il.getInt(7),this.positionSprites(),this.adjecentBuildingEffects.push({name:"farm",intensity:1})};(q["buildings.EcoFarm"]=Ue).__name__="buildings.EcoFarm",Ue.__interfaces__=[oe],Ue.__super__=ee,Ue.prototype=e(ee.prototype,{get_baseEntertainmentCapacity:function(){return 5*this.workers.length},get_isOpen:function(){return 0<this.workers.length&&0==this.workers[0].currentAction&&(1+((0|this.city.simulation.time.timeSinceStart)/1440|0))%7==this.openDay&&this.city.simulation.time.timeSinceStart/60%24<20.5&&12<this.city.simulation.time.timeSinceStart/60%24},get_entertainmentType:function(){return 3},get_secondaryEntertainmentTypes:function(){return null},get_minimumNormalTimeToSpend:function(){return 2},get_maximumNormalTimeToSpend:function(){return 3},get_minimumEntertainmentGroupSatisfy:function(){return 1},get_maximumEntertainmentGroupSatisfy:function(){return 1.5},get_entertainmentQuality:function(){return 100},get_isOpenForExistingVisitors:function(){return this.get_isOpen()},finishEntertainment:function(t,e){return!0},onBuild:function(){this.city.progress.unlocks.unlock(Zn)},beEntertained:function(t,e){var i=!1,n=!0;null==n&&(n=!1),null==i&&(i=!1),t.moveAndWait(il.getInt(3,16),il.getInt(50,100),null,i,n)},postLoad:function(){this.growthAreas[1].setTexture(Ue.crop2Sprites[this.crop2Sprite],8),this.growthAreas[2].setTexture(Ue.crop3Sprites[this.crop3Sprite],8);for(var t=0,e=this.growthAreas;t<e.length;){var i=e[t];++t,i.updateTexture()}},update:function(t){(1+((0|this.city.simulation.time.timeSinceStart)/1440|0))%7==this.openDay?this.endTime=21:this.endTime=19,ee.prototype.update.call(this,t);for(var e=0,i=this.growthAreas;e<i.length;){var n=i[e];++e,n.update(t)}},work:function(t,e,i){if(i)t.currentAction=2;else{var n=this.workers.indexOf(t);if(1==n)if(t.relativeY<5){var r=t,s=ka.pool,o=0<s[2].length?s[2].splice(s[2].length-1,1)[0]:new Int32Array(2);o[0]=4,o[1]=18,r.setPath(o,0,2,!0),t.pathEndFunction=function(){t.changeFloor()},t.pathOnlyRelatedTo=t.inPermanent}else this.growthAreas[n].doCitizenWork(t);else 0==n&&1==this.growthAreas[0].farmStage?t.relativeY<=1||t.relativeX<4||6<t.relativeX?t.setPath(new Int32Array([4,5,9,8]),0,4,!0):this.growthAreas[n].doCitizenWorkNoMove(t):5<t.relativeY?t.changeFloor():this.growthAreas[n].doCitizenWork(t)}},save:function(t,e){null==e&&(e=!0),ee.prototype.save.call(this,t,e),this.saveBasics(t);for(var i=0,n=this.growthAreas;i<n.length;){var r=n[i];++i,r.save(t)}},load:function(t,e){ee.prototype.load.call(this,t,e),this.loadBasics(t,e);for(var i=0,n=this.growthAreas;i<n.length;){var r=n[i];++i,r.load(t)}this.postLoad()},destroy:function(){ee.prototype.destroy.call(this);for(var t=0,e=this.growthAreas;t<e.length;){var i=e[t];++t,i.destroy()}},positionSprites:function(){ee.prototype.positionSprites.call(this);for(var t=0,e=this.growthAreas;t<e.length;){var i=e[t];++t,i.positionSprites()}},addWindowInfoLines:function(){ee.prototype.addWindowInfoLines.call(this),this.growthAreas[0].showInfoText(Tr.lo("left_plot")+" "),this.growthAreas[1].showInfoText(Tr.lo("top_right_plot")+" "),this.growthAreas[2].showInfoText(Tr.lo("bottom_right_plot")+" ")},saveBasics:function(t,e){null==e&&(e=!0),e&&t.addString(Ue.saveDefinition);var i=this.openDay;if(t.size+4>t.bytes.length){var n=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+4))),t.bytes.blit(0,n,0,t.size)}t.bytes.setInt32(t.size,i),t.size+=4;i=this.crop2Sprite;if(t.size+4>t.bytes.length){n=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+4))),t.bytes.blit(0,n,0,t.size)}t.bytes.setInt32(t.size,i),t.size+=4;i=this.crop3Sprite;if(t.size+4>t.bytes.length){n=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+4))),t.bytes.blit(0,n,0,t.size)}t.bytes.setInt32(t.size,i),t.size+=4},loadBasics:function(t,e){null==e&&(e=t.readString());var i=Dr.makeLoadMap(e,t);Object.prototype.hasOwnProperty.call(i.h,"openDay")&&(this.openDay=i.h.openDay),Object.prototype.hasOwnProperty.call(i.h,"crop2Sprite")&&(this.crop2Sprite=i.h.crop2Sprite),Object.prototype.hasOwnProperty.call(i.h,"crop3Sprite")&&(this.crop3Sprite=i.h.crop3Sprite),this.postLoad()},__class__:Ue});function ze(t,e,i,n,r,s,o,a){this.graphicsDrawn=!1,this.escapeRoomPhaseProgress=0,this.escapeRoomPhase=We.Start,ee.call(this,t,e,i,n,r,s,o,a),this.startTime=13,this.endTime=3,this.workTimePreferenceMod=.1,this.isEntertainment=!0,this.registeredCitizens=[],this.graphics=new PIXI.Graphics,i.addChild(this.graphics),this.graphics.position.set(s.x,s.y)}var We=T["buildings.EscapeRoomPhase"]={__ename__:"buildings.EscapeRoomPhase",__constructs__:["Start","First","Second","Third","Lasers","Last","Done"],Start:{_hx_index:0,__enum__:"buildings.EscapeRoomPhase",toString:i},First:{_hx_index:1,__enum__:"buildings.EscapeRoomPhase",toString:i},Second:{_hx_index:2,__enum__:"buildings.EscapeRoomPhase",toString:i},Third:{_hx_index:3,__enum__:"buildings.EscapeRoomPhase",toString:i},Lasers:{_hx_index:4,__enum__:"buildings.EscapeRoomPhase",toString:i},Last:{_hx_index:5,__enum__:"buildings.EscapeRoomPhase",toString:i},Done:{_hx_index:6,__enum__:"buildings.EscapeRoomPhase",toString:i}};(q["buildings.EscapeRoom"]=ze).__name__="buildings.EscapeRoom",ze.__interfaces__=[oe],ze.__super__=ee,ze.prototype=e(ee.prototype,{get_baseEntertainmentCapacity:function(){return 120*this.workers.length},get_isOpen:function(){return 1==this.workers.length&&0==this.workers[0].currentAction&&this.city.simulation.time.timeSinceStart/60%24<23.99&&this.registeredCitizens.length<10},get_entertainmentType:function(){return 4},get_secondaryEntertainmentTypes:function(){return null},get_minimumNormalTimeToSpend:function(){return 2.5},get_maximumNormalTimeToSpend:function(){return 3.5},get_minimumEntertainmentGroupSatisfy:function(){return 4},get_maximumEntertainmentGroupSatisfy:function(){return 7},get_entertainmentQuality:function(){return 100},get_isOpenForExistingVisitors:function(){return 1==this.workers.length&&0==this.workers[0].currentAction},finishEntertainment:function(t,e){return this.registeredCitizens.length<5||-1==this.registeredCitizens.indexOf(t)||this.escapeRoomPhase==We.Done||!this.get_isOpenForExistingVisitors()},beEntertained:function(t,e){if(!t.hasBuildingInited||null==t.dynamicUnsavedVars.buildingInited){if(-1==this.registeredCitizens.indexOf(t)){if(10<this.registeredCitizens.length)return void t.entertainment.stop();this.registeredCitizens.push(t)}t.hasBuildingInited=!0,t.dynamicUnsavedVars.buildingInited=!0}if(this.escapeRoomPhase!=We.Done)if(this.registeredCitizens.length<5)5<t.relativeY?t.changeFloor():t.moveAndWait(il.getInt(7,16),il.getInt(50,70),null,!1,!1);else{if(this.escapeRoomPhase==We.Start)return 5<t.relativeY?t.changeFloor():t.moveAndWait(il.getInt(7,16),il.getInt(50,70),null,!1,!1),void(this.registeredCitizens.length<8&&this.escapeRoomPhaseProgress<1?this.escapeRoomPhaseProgress+=.02*e:(this.escapeRoomPhase=We.First,this.escapeRoomPhaseProgress=0));if(this.escapeRoomPhase==We.First)t.relativeY<5&&2<t.relativeX&&t.relativeX<7?t.changeFloor():(t.moveAndWait(il.getInt(3,6),il.getInt(30,60),null,!1,!1),il.getFloat(1)<.2&&(this.escapeRoomPhaseProgress+=.2,1<this.escapeRoomPhaseProgress&&(this.escapeRoomPhase=We.Second,this.escapeRoomPhaseProgress=0)));else if(this.escapeRoomPhase==We.Second){this.registeredCitizens.indexOf(t)%2==0?5<t.relativeY?t.changeFloor():(t.moveAndWait(il.getInt(3,16),il.getInt(50,120),null,!1,!1),il.getFloat(1)<.3&&(this.escapeRoomPhaseProgress+=.34,1<this.escapeRoomPhaseProgress&&(this.escapeRoomPhase=We.Third,this.escapeRoomPhaseProgress=0))):t.relativeY<5&&2<t.relativeX&&t.relativeX<7?t.changeFloor():t.moveAndWait(il.getInt(3,6),il.getInt(30,60),null,!1,!1)}else if(this.escapeRoomPhase==We.Third){if(5<t.relativeY)t.changeFloor();else if(4<t.relativeX){var i=il.getInt(3,5),n=ka.pool,r=0<n[2].length?n[2].splice(n[2].length-1,1)[0]:new Int32Array(2);r[0]=4,r[1]=i,t.setPath(r,0,2,!0),t.pathEndFunction=null,t.pathOnlyRelatedTo=t.inPermanent}}else this.escapeRoomPhase==We.Last&&(t.relativeY<5&&11<t.relativeX&&t.relativeX<16?t.changeFloor():t.moveAndWait(il.getInt(11,16),il.getInt(20,60),null,!1,!1))}else t.entertainment.stop()},update:function(t){for(var e=this.registeredCitizens.length;0<--e;){var i=this.registeredCitizens[e];!i.hasDied&&(null!=i.inPermanent&&i.inPermanent.isBuilding?i.inPermanent:null)==this||this.registeredCitizens.splice(e,1)}if(this.escapeRoomPhase==We.Done?(this.escapeRoomPhaseProgress+=.02*t,1<=this.escapeRoomPhaseProgress&&this.resetEscapeRoom()):this.escapeRoomPhase==We.Third?gr.all(this.registeredCitizens,function(t){return t.relativeY<5&&t.relativeX<5})&&(this.escapeRoomPhase=We.Lasers,this.escapeRoomPhaseProgress=0):this.escapeRoomPhase==We.Last&&gr.all(this.registeredCitizens,function(t){return 5<t.relativeY&&11<t.relativeX})&&(this.escapeRoomPhase=We.Done,this.escapeRoomPhaseProgress=0),this.escapeRoomPhase==We.Lasers){this.graphics.clear(),this.graphics.beginFill(16711680,.7);var n=13;this.graphics.drawRect(7,n,1,1);n=13;this.graphics.drawRect(8,n,1,1);n=13;this.graphics.drawRect(9,n,1,1);n=13;this.graphics.drawRect(10,n,1,1);n=13;this.graphics.drawRect(11,n,1,1);n=13;this.graphics.drawRect(12,n,1,1);n=13;this.graphics.drawRect(13,n,1,1);n=13;this.graphics.drawRect(14,n,1,1);n=13;this.graphics.drawRect(15,n,1,1);n=13;this.graphics.drawRect(16,n,1,1),this.graphics.endFill(),this.graphicsDrawn=!0,this.escapeRoomPhaseProgress+=.01*t,1<=this.escapeRoomPhaseProgress&&(this.escapeRoomPhaseProgress=0,this.escapeRoomPhase=We.Last)}else this.graphicsDrawn&&(this.graphics.clear(),this.graphicsDrawn=!1)},postLoad:function(){this.graphics.position.set(this.position.x,this.position.y)},positionSprites:function(){ee.prototype.positionSprites.call(this),this.graphics.position.set(this.position.x,this.position.y)},onCitizenLeave:function(t,e){at.remove(this.registeredCitizens,t)},work:function(t,e,i){if(i)t.currentAction=2,this.resetEscapeRoom();else{var n=t.pathWalkSpeed*e;if(K.shouldUpdateDraw=!0,Math.abs(3-t.relativeX)<n)t.relativeX=3;else{var r=3-t.relativeX;t.relativeX+=(0<r?1:r<0?-1:0)*n}}},resetEscapeRoom:function(){this.escapeRoomPhase=We.Start,this.escapeRoomPhaseProgress=0},save:function(t,e){null==e&&(e=!0),ee.prototype.save.call(this,t),e&&t.addString(ze.saveDefinition)},load:function(t,e){ee.prototype.load.call(this,t),null==e&&(e=t.readString());Dr.makeLoadMap(e,t);this.postLoad()},__class__:ze});function Ge(t,e,i,n,r,s,o,a){ee.call(this,t,e,i,n,r,s,o,a),this.growthAreas=[new Ke(i,this,new vr(3,3),n,"spr_experimentalfarm_crop1",5,12,1,5),new Ke(i,this,new vr(12,3),n,"spr_experimentalfarm_crop2",5,10,1.2,10),new Ke(i,this,new vr(12,12),n,"spr_experimentalfarm_crop3",5,6,1.5,10)],this.positionSprites(),this.adjecentBuildingEffects.push({name:"farm",intensity:1})}(q["buildings.ExperimentalFarm"]=Ge).__name__="buildings.ExperimentalFarm",Ge.__super__=ee,Ge.prototype=e(ee.prototype,{get_possibleCityUpgrades:function(){return[Zn]},onBuild:function(){this.city.simulation.bonuses.indoorFarmSpeed+=.1},postLoad:function(){for(var t=0,e=this.growthAreas;t<e.length;){var i=e[t];++t,i.updateTexture()}},update:function(t){ee.prototype.update.call(this,t);for(var e=0,i=this.growthAreas;e<i.length;){var n=i[e];++e,n.update(t)}},work:function(t,e,i){if(i)t.currentAction=2;else{var n=this.workers.indexOf(t);if(1==n)if(t.relativeY<5){var r=t,s=ka.pool,o=0<s[2].length?s[2].splice(s[2].length-1,1)[0]:new Int32Array(2);o[0]=4,o[1]=18,r.setPath(o,0,2,!0),t.pathEndFunction=function(){t.changeFloor()},t.pathOnlyRelatedTo=t.inPermanent}else this.growthAreas[n].doCitizenWork(t);else 5<t.relativeY?t.changeFloor():this.growthAreas[n].doCitizenWork(t)}},save:function(t,e){null==e&&(e=!0),ee.prototype.save.call(this,t,e),this.saveBasics(t);for(var i=0,n=this.growthAreas;i<n.length;){var r=n[i];++i,r.save(t)}},load:function(t,e){ee.prototype.load.call(this,t,e),this.loadBasics(t,e);for(var i=0,n=this.growthAreas;i<n.length;){var r=n[i];++i,r.load(t)}this.postLoad()},destroy:function(){ee.prototype.destroy.call(this);for(var t=0,e=this.growthAreas;t<e.length;){var i=e[t];++t,i.destroy()}this.city.simulation.bonuses.indoorFarmSpeed-=.1},positionSprites:function(){ee.prototype.positionSprites.call(this);for(var t=0,e=this.growthAreas;t<e.length;){var i=e[t];++t,i.positionSprites()}},addWindowInfoLines:function(){ee.prototype.addWindowInfoLines.call(this),this.growthAreas[0].showInfoText(Tr.lo("left_plot")+" "),this.growthAreas[1].showInfoText(Tr.lo("top_right_plot")+" "),this.growthAreas[2].showInfoText(Tr.lo("bottom_right_plot")+" ")},saveBasics:function(t,e){null==e&&(e=!0),e&&t.addString(Ge.saveDefinition)},loadBasics:function(t,e){null==e&&(e=t.readString());Dr.makeLoadMap(e,t);this.postLoad()},__class__:Ge});function He(t,e,i,n,r,s,o,a){this.bottomPipeSprite=null,this.topPipeSprite=null,this.materialsMadePerStepPerWorker=.0023,Pe.call(this,t,e,i,n,r,s,o,a,this.get_idleFrames(),this.get_idleFrames())}(q["buildings.ExperimentationLab"]=He).__name__="buildings.ExperimentationLab",He.__super__=Pe,He.prototype=e(Pe.prototype,{get_normalEfficiency:function(){return.2},get_walkThroughCanViewSelfInThisBuilding:function(){return!1},get_possibleUpgrades:function(){return[Qt]},get_possibleBuildingModes:function(){return[St,wt]},get_materialFrom:function(){return this.city.materials.machineParts},set_materialFrom:function(t){var e=this.city.materials.machineParts-t;return this.city.materials.machineParts-=e,this.city.simulation.stats.materialUsed[3][0]+=e,this.city.materials.machineParts},get_materialTo:function(){return this.city.materials.knowledge},set_materialTo:function(t){var e=t-this.city.materials.knowledge;return this.city.materials.knowledge+=e,this.city.simulation.stats.materialProduction[10][0]+=e,this.city.materials.knowledge},get_idleFrames:function(){return"spr_experimentationlab_idle"},get_bonusSpeed:function(){return 0==this.activeWorkers?1:this.activeWorkersTotalEducation/this.activeWorkers},destroy:function(){Pe.prototype.destroy.call(this),null!=this.topPipeSprite&&this.topPipeSprite.destroy(),null!=this.bottomPipeSprite&&this.bottomPipeSprite.destroy()},workAnimation:function(t,e){10!=t.relativeY&&(0==this.workers.indexOf(t)?t.setRelativePos(4,10):t.setRelativePos(3,0))},addWindowInfoLines:function(){var t=this;Pe.prototype.addWindowInfoLines.call(this),this.city.gui.windowAddInfoText(null,function(){return Tr.lo("knowledge_production_from_machine_parts",[0|t.totalMaterialUsed,0|t.materialMade])})},canShowActiveTextures:function(){return!1},onCityChange:function(){null!=this.bottomBuilding&&this.bottomBuilding.is(Ve)&&!this.bottomBuilding.is(Ye)?(null==this.bottomPipeSprite&&(this.bottomPipeSprite=new PIXI.Sprite(dt.getTexture("spr_experimentationlab_pipe_bottom")),this.city.justAboveCityStage.addChild(this.bottomPipeSprite)),this.bottomPipeSprite.position.set(this.position.x+7,this.position.y+17)):null!=this.bottomPipeSprite&&(this.bottomPipeSprite.destroy(),this.bottomPipeSprite=null),null!=this.topBuilding&&this.topBuilding.is(Ve)&&!this.topBuilding.is(Ye)?(null==this.topPipeSprite&&(this.topPipeSprite=new PIXI.Sprite(dt.getTexture("spr_experimentationlab_pipe_top")),this.city.justAboveCityStage.addChild(this.topPipeSprite)),this.topPipeSprite.position.set(this.position.x+10,this.position.y-11)):null!=this.topPipeSprite&&(this.topPipeSprite.destroy(),this.topPipeSprite=null)},save:function(t,e){null==e&&(e=!0),Pe.prototype.save.call(this,t),e&&t.addString(He.saveDefinition)},load:function(t,e){Pe.prototype.load.call(this,t),null==e&&(e=t.readString());Dr.makeLoadMap(e,t)},__class__:He});function Xe(t,e,i,n,r,s,o,a){this.hasSearchedForRuinsThisStep=!1,this.currentAction=je.Unknown,this.nearestRuins=null,ee.call(this,t,e,i,n,r,s,o,a)}var je=T["buildings.CurrentExplorationCentreAction"]={__ename__:"buildings.CurrentExplorationCentreAction",__constructs__:["Unknown","Exploring","Investigating"],Unknown:{_hx_index:0,__enum__:"buildings.CurrentExplorationCentreAction",toString:i},Exploring:{_hx_index:1,__enum__:"buildings.CurrentExplorationCentreAction",toString:i},Investigating:{_hx_index:2,__enum__:"buildings.CurrentExplorationCentreAction",toString:i}};(q["buildings.ExplorationCentre"]=Xe).__name__="buildings.ExplorationCentre",Xe.__super__=ee,Xe.prototype=e(ee.prototype,{addWindowInfoLines:function(){var t=this;ee.prototype.addWindowInfoLines.call(this),this.city.gui.windowAddInfoText(null,function(){switch(t.currentAction._hx_index){case 0:return Tr.lo("current_task_looking");case 1:return Tr.lo("current_task_exploring");case 2:return Tr.lo("current_task_investigating")}})},work:function(t,e,i){if(i)t.currentAction=2,t.hasWorkTools=!1;else if(t.hasWorkTools)if(t.inPermanent instanceof Th)this.exploreTheseRuins(t);else{if(null==this.nearestRuins&&!this.hasSearchedForRuinsThisStep&&!Object.prototype.hasOwnProperty.call(this.world.knownResourceInavailability.h,"AlienRuins")){if(!this.city.simulation.permanentFinder.canPerformQuery())return;this.nearestRuins=this.city.simulation.permanentFinder.query(this,function(t){return!!t.is(Th)&&t.explored<100}),this.hasSearchedForRuinsThisStep=!0,null==this.nearestRuins&&(this.world.knownResourceInavailability.h.AlienRuins=!0)}this.exploreOrInvestigate(t,e)}else t.inPermanent==this?t.moveAndWait(4,30,function(){t.hasWorkTools=!0},!0):(t.simulation.pathfinder.findPath(t,this),t.pathOnFail=null)},exploreTheseRuins:function(n){var r=this,s=n.inPermanent,t=0==s.standingPlaces.length?il.getInt(1,17):il.fromArray(s.standingPlaces);n.moveAndWait(t,il.getInt(90,180),function(){if(s.explored<100){s.explored+=.25;var t=r.city.simulation,e=.25*(B.earlyGameFix1&&t.citizens.length<30?1.3-t.citizens.length/60*.3:1)*r.city.simulation.boostManager.currentGlobalBoostAmount;if(r.city.materials.knowledge+=e,r.city.simulation.stats.materialProduction[10][0]+=e,s.awardAnyBonuses(),100<=s.explored){if(s.explored=100,null!=n.inPermanent&&n.inPermanent.isBuilding){var i=null!=n.inPermanent&&n.inPermanent.isBuilding?n.inPermanent:null;n.relativeX=20*i.worldPosition.x+i.doorX}else n.relativeX+=20*n.inPermanent.worldPosition.x;null!=n.inPermanent&&n.inPermanent.onCitizenLeave(n,null),n.inBuildingSince=n.city.simulation.time.timeSinceStart,n.set_drawOnStage(n.foregroundStage),n.inPermanent=null,n.relativeY=0,K.shouldUpdateDraw=!0,r.nearestRuins=null}}else{if(null!=n.inPermanent&&n.inPermanent.isBuilding){i=null!=n.inPermanent&&n.inPermanent.isBuilding?n.inPermanent:null;n.relativeX=20*i.worldPosition.x+i.doorX}else n.relativeX+=20*n.inPermanent.worldPosition.x;null!=n.inPermanent&&n.inPermanent.onCitizenLeave(n,null),n.inBuildingSince=n.city.simulation.time.timeSinceStart,n.set_drawOnStage(n.foregroundStage),n.inPermanent=null,n.relativeY=0,K.shouldUpdateDraw=!0,r.nearestRuins=null}},!0)},exploreOrInvestigate:function(t,e){if(null!=this.nearestRuins)t.simulation.pathfinder.findPath(t,this.nearestRuins),t.pathOnFail=null,this.currentAction=je.Exploring;else if(this.currentAction=je.Investigating,t.inPermanent==this){var i=this.workers.indexOf(t);if(1!=i&&2!=i||!t.isAtGroundLevel()){var n=2==i?12:3,r=2==i?16:7;if(t.relativeX>=n&&t.relativeX<r){var s=.001*e*this.city.simulation.happiness.actionSpeedModifier*t.get_educationSpeedModifier()*this.city.simulation.boostManager.currentGlobalBoostAmount;this.city.materials.knowledge+=s,this.city.simulation.stats.materialProduction[10][0]+=s}else{var o=il.getInt(n,r),a=ka.pool,l=0<a[2].length?a[2].splice(a[2].length-1,1)[0]:new Int32Array(2);l[0]=4,l[1]=o,t.setPath(l,0,2,!0),t.pathEndFunction=null,t.pathOnlyRelatedTo=t.inPermanent}}else t.changeFloor()}else t.simulation.pathfinder.findPath(t,this),t.pathOnFail=null},update:function(t){ee.prototype.update.call(this,t),this.hasSearchedForRuinsThisStep=!1},invalidatePathfindingRelatedInfo:function(){ee.prototype.invalidatePathfindingRelatedInfo.call(this),this.nearestRuins=null},__class__:Xe});var Ve=function(t,e,i,n,r,s,o,a){this.materialsMadePerStepPerWorkerNorm=.001,this.efficiencyNorm=5,this.materialsMadePerStepPerWorker=this.materialsMadePerStepPerWorkerNorm,Pe.call(this,t,e,i,n,r,s,o,a,this.get_animationFrames(),this.get_idleFrames())};(q["buildings.RefinedMetalFactory"]=Ve).__name__="buildings.RefinedMetalFactory",Ve.__super__=Pe,Ve.prototype=e(Pe.prototype,{get_normalEfficiency:function(){return 5},get_walkThroughCanViewSelfInThisBuilding:function(){return!1},get_possibleUpgrades:function(){return[Nt]},get_possibleBuildingModes:function(){return[ft,Lt,qt]},get_materialFrom:function(){return this.city.materials.stone},set_materialFrom:function(t){var e=this.city.materials.stone-t;return this.city.materials.stone-=e,this.city.simulation.stats.materialUsed[2][0]+=e,this.city.materials.stone},get_materialTo:function(){return this.city.materials.refinedMetal},set_materialTo:function(t){var e=t-this.city.materials.refinedMetal;return this.city.materials.refinedMetal+=e,this.city.simulation.stats.materialProduction[4][0]+=e,this.city.materials.refinedMetal},get_animationFrames:function(){return"spr_refinedmetalfactory_frames"},get_idleFrames:function(){return"spr_refinedmetalfactory_idle"},onBuild:function(){this.city.progress.unlocks.unlock(ci),this.city.progress.unlocks.unlock(Ne),this.city.progress.unlocks.fullyUnlock(Ii),this.city.progress.unlocks.fullyUnlock(Ei),this.city.progress.unlocks.unlock(tn),this.city.progress.unlocks.unlock(an)},workAnimation:function(t,e){if(10!=t.relativeY)if(0==this.workers.indexOf(t))t.setRelativePos(3,10);else{var i=t.pathWalkSpeed*e;if(K.shouldUpdateDraw=!0,Math.abs(3-t.relativeX)<i)t.relativeX=3;else{var n=3-t.relativeX;t.relativeX+=(0<n?1:n<0?-1:0)*i}t.setRelativeY(0)}},addWindowInfoLines:function(){var t=this;Pe.prototype.addWindowInfoLines.call(this),this.city.gui.windowAddInfoText(null,function(){return Tr.lo("refinded_metals_made",[0|t.totalMaterialUsed,0|t.materialMade])})},onCityChange:function(){this.efficiency=this.efficiencyNorm,this.materialsMadePerStepPerWorker=this.materialsMadePerStepPerWorkerNorm,null!=this.bottomBuilding&&this.bottomBuilding.is(He)&&(this.efficiency-=.5,this.materialsMadePerStepPerWorker+=1e-4),null!=this.topBuilding&&this.topBuilding.is(He)&&(this.efficiency-=.5,this.materialsMadePerStepPerWorker+=1e-4)},save:function(t,e){null==e&&(e=!0),Pe.prototype.save.call(this,t),e&&t.addString(Ve.saveDefinition)},load:function(t,e){Pe.prototype.load.call(this,t),null==e&&(e=t.readString());Dr.makeLoadMap(e,t)},__class__:Ve});var Ye=function(t,e,i,n,r,s,o,a){Ve.call(this,t,e,i,n,r,s,o,a),this.materialsMadePerStepPerWorker=75e-5,this.startTime=16.5,this.endTime=5.5,this.workTimePreferenceMod=.5,this.isEntertainment=!0};(q["buildings.FactoryPub"]=Ye).__name__="buildings.FactoryPub",Ye.__interfaces__=[oe],Ye.__super__=Ve,Ye.prototype=e(Ve.prototype,{get_baseEntertainmentCapacity:function(){return 25*this.workers.length},get_isOpen:function(){if(1<=this.workers.length&&0==this.workers[0].currentAction){var t=this.city.simulation.time.timeSinceStart/60%24,e=this.startTime-this.workTimePreferenceMod;return e<4.5?e<=t&&t<4.5:e<=t||t<4.5}return!1},get_entertainmentType:function(){return 1},get_secondaryEntertainmentTypes:function(){return null},get_minimumNormalTimeToSpend:function(){return 2},get_maximumNormalTimeToSpend:function(){return 5},get_minimumEntertainmentGroupSatisfy:function(){return 1},get_maximumEntertainmentGroupSatisfy:function(){return 3},get_entertainmentQuality:function(){return 100},get_isOpenForExistingVisitors:function(){return this.get_isOpen()},finishEntertainment:function(t,e){return!0},get_animationFrames:function(){return"spr_refinedmetalfactorypub_frames"},get_idleFrames:function(){return"spr_refinedmetalfactorypub_idle"},get_drawerType:function(){return Rn},destroy:function(){Ve.prototype.destroy.call(this)},positionSprites:function(){Ve.prototype.positionSprites.call(this)},beEntertained:function(r,t){if(r.relativeY<5)r.changeFloor(function(){var t=il.getInt(8,16),e=r,i=ka.pool,n=0<i[2].length?i[2].splice(i[2].length-1,1)[0]:new Int32Array(2);n[0]=4,n[1]=t,e.setPath(n,0,2,!0),r.pathEndFunction=null,r.pathOnlyRelatedTo=r.inPermanent});else{var e=r,i=ka.pool,n=0<i[4].length?i[4].splice(i[4].length-1,1)[0]:new Int32Array(4);n[0]=4,n[1]=il.getInt(8,null!=this.rightBuilding&&this.rightBuilding.is(Ye)?19:16),n[2]=8,n[3]=il.getInt(60,120),e.setPath(n,0,4,!0)}r.hasBuildingInited||(r.wantsNightEntertainmentIn=il.getInt(1,5),r.hasBuildingInited=!0)},workAnimation:function(t,e){10!=t.relativeY&&(0==this.workers.indexOf(t)?t.setRelativePos(8,10):t.setRelativePos(3,1))},save:function(t,e){null==e&&(e=!0),Ve.prototype.save.call(this,t),e&&t.addString(Ye.saveDefinition)},load:function(t,e){Ve.prototype.load.call(this,t),null==e&&(e=t.readString());Dr.makeLoadMap(e,t)},__class__:Ye});var qe=function(t,e,i,n,r,s,o,a){this.cachedAdjacencyExpiration=0,this.cachedAdjacencyValue=0,this.woodMade=0,Ie.call(this,t,e,i,n,r,s,o,a,"spr_farmbyproductprocessor_frames","spr_farmbyproductprocessor_idle")};(q["buildings.FarmByProductProcessor"]=qe).__name__="buildings.FarmByProductProcessor",qe.__super__=Ie,qe.prototype=e(Ie.prototype,{get_walkThroughCanViewSelfInThisBuilding:function(){return!1},possiblyBeActive:function(t){this.cachedAdjacencyExpiration--;var e=this.cachedAdjacencyValue;this.cachedAdjacencyExpiration<=0&&(e=this.adjacentFarmNumber(!0),this.cachedAdjacencyValue=e,this.cachedAdjacencyExpiration=72);var i=.0014*this.activeWorkersTotalEducation*this.city.simulation.happiness.actionSpeedModifier*this.city.simulation.boostManager.currentGlobalBoostAmount*t*e;return this.city.materials.wood+=i,this.city.simulation.stats.materialProduction[1][0]+=i,this.woodMade+=i,0<i},adjacentFarmNumber:function(t){var e="farm",i=0;if(null!=this.leftBuilding){for(var n=0,r=0,s=this.leftBuilding.adjecentBuildingEffects;r<s.length;){var o=s[r];++r,o.name==e&&(n+=o.intensity)}if(.5<n)if(t)if(this.leftBuilding.is(ee))i+=(a=this.leftBuilding).workers.length/a.get_jobs();else i+=(l=this.leftBuilding).residents.length/l.get_residentCapacity();else++i}if(null!=this.rightBuilding&&(null==this.rightBuilding.rightBuilding||!this.rightBuilding.rightBuilding.is(qe))){for(n=0,r=0,s=this.rightBuilding.adjecentBuildingEffects;r<s.length;){o=s[r];++r,o.name==e&&(n+=o.intensity)}if(.5<n)if(t)if(this.rightBuilding.is(ee))i+=(a=this.rightBuilding).workers.length/a.get_jobs();else i+=(l=this.rightBuilding).residents.length/l.get_residentCapacity();else++i}if(!(null==this.topBuilding||null!=this.topBuilding.leftBuilding&&this.topBuilding.leftBuilding.is(qe)||null!=this.topBuilding.rightBuilding&&this.topBuilding.rightBuilding.is(qe))){for(n=0,r=0,s=this.topBuilding.adjecentBuildingEffects;r<s.length;){o=s[r];++r,o.name==e&&(n+=o.intensity)}if(.5<n)if(t)if(this.topBuilding.is(ee))i+=(a=this.topBuilding).workers.length/a.get_jobs();else i+=(l=this.topBuilding).residents.length/l.get_residentCapacity();else++i}if(!(null==this.bottomBuilding||null!=this.bottomBuilding.leftBuilding&&this.bottomBuilding.leftBuilding.is(qe)||null!=this.bottomBuilding.rightBuilding&&this.bottomBuilding.rightBuilding.is(qe)||null!=this.bottomBuilding.bottomBuilding&&this.bottomBuilding.bottomBuilding.is(qe))){for(n=0,r=0,s=this.bottomBuilding.adjecentBuildingEffects;r<s.length;){o=s[r];++r,o.name==e&&(n+=o.intensity)}var a,l;if(.5<n)if(t)if(this.bottomBuilding.is(ee))i+=(a=this.bottomBuilding).workers.length/a.get_jobs();else i+=(l=this.bottomBuilding).residents.length/l.get_residentCapacity();else++i}return i},workAnimation:function(t,e){10!=t.relativeY&&(0==this.workers.indexOf(t)?t.setRelativePos(12,10):t.setRelativePos(15,10))},canShowActiveTextures:function(){return!0},addWindowInfoLines:function(){var t=this;Ie.prototype.addWindowInfoLines.call(this),this.city.gui.windowAddInfoText(null,function(){return 1==(0|t.adjacentFarmNumber(!1))?Tr.lo("producing_by_products_for_1_farm"):Tr.lo("producing_by_products_for_n_farms",[0|t.adjacentFarmNumber(!1)])}),this.city.gui.windowAddInfoText(null,function(){return Tr.lo("wood_produced",[0|t.woodMade])})},save:function(t,e){null==e&&(e=!0),Ie.prototype.save.call(this,t),e&&t.addString(qe.saveDefinition);var i=this.woodMade;if(t.size+8>t.bytes.length){var n=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+8))),t.bytes.blit(0,n,0,t.size)}t.bytes.setDouble(t.size,i),t.size+=8},load:function(t,e){if(Ie.prototype.load.call(this,t),!(t.version<22)){null==e&&(e=t.readString());var i=Dr.makeLoadMap(e,t);Object.prototype.hasOwnProperty.call(i.h,"woodMade")&&(this.woodMade=i.h.woodMade)}},__class__:qe});var Ke=function(t,e,i,n,r,s,o,a,l,h){null==h&&(h=1),this.percentCleaned=0,this.originalFoodLeft=1,this.foodLeft=0,this.percentGrown=0,this.farmStage=0,this.harvestSpritePart=1,this.passiveGrowSpeedBadLight=.006,this.passiveGrowSpeed=.012,this.cleanSpeed=5,this.harvestAmount=.25,this.growSpeed=.85,this.foodPerHarvest=25,this.partOf=e,this.city=n,this.relativePosition=i,this.stage=t,this.foodPerHarvest=o,this.growSpeed*=a,this.passiveGrowSpeed*=a,this.passiveGrowSpeedBadLight*=a,this.cleanSpeed=l,this.harvestSpritePart=h,this.textures=dt.getTexturesByWidth(r,s),this.growthSprite=new PIXI.Sprite,t.addChild(this.growthSprite),this.positionSprites(),this.updateTexture()};(q["buildings.FarmGrowArea"]=Ke).__name__="buildings.FarmGrowArea",Ke.prototype={destroy:function(){this.growthSprite.destroy()},update:function(t){if(0==this.farmStage){var e=this.city.simulation.time.timeSinceStart/60%24;if((i=7)<(n=20)?i<=e&&e<n:i<=e||e<n)this.percentGrown+=t*this.passiveGrowSpeed,100<=this.percentGrown&&(this.farmStage=1,this.foodLeft=this.foodPerHarvest+this.city.simulation.bonuses.extraFoodFromFarms+this.partOf.getEffectsOfAdjecentBuildings("increaseCropNumber"),this.originalFoodLeft=this.foodLeft),this.updateTexture();else{var i,n;e=this.city.simulation.time.timeSinceStart/60%24;((i=6)<(n=21)?i<=e&&e<n:i<=e||e<n)&&(this.percentGrown+=t*this.passiveGrowSpeedBadLight,100<=this.percentGrown&&(this.farmStage=1,this.foodLeft=this.foodPerHarvest+this.city.simulation.bonuses.extraFoodFromFarms+this.partOf.getEffectsOfAdjecentBuildings("increaseCropNumber"),this.originalFoodLeft=this.foodLeft),this.updateTexture())}}},doCitizenWork:function(t){var e=this,i=(1==this.farmStage?15:30)/this.city.simulation.happiness.actionSpeedModifierWithoutPenalties|0,n=(1==this.farmStage?30:60)/this.city.simulation.happiness.actionSpeedModifierWithoutPenalties|0,r=!1;null==r&&(r=!1),t.moveAndWait(il.getInt(this.relativePosition.x,this.relativePosition.x+(0|this.growthSprite.texture.width)-2+1),il.getInt(i,n),function(){e.onCitizenWork(t)},r,!1)},doCitizenWorkNoMove:function(t){var e=this,i=1==this.farmStage?15:30,n=1==this.farmStage?30:60,r=t,s=ka.pool,o=0<s[2].length?s[2].splice(s[2].length-1,1)[0]:new Int32Array(2);o[0]=8,o[1]=il.getInt(i,n),r.setPath(o,0,2,!0),t.pathEndFunction=function(){e.onCitizenWork(t)},t.pathOnlyRelatedTo=t.inPermanent},onCitizenWork:function(t){switch(this.farmStage){case 0:this.percentGrown+=this.growSpeed,100<=this.percentGrown&&(this.farmStage=1,this.foodLeft=this.foodPerHarvest+this.city.simulation.bonuses.extraFoodFromFarms+this.partOf.getEffectsOfAdjecentBuildings("increaseCropNumber"),this.originalFoodLeft=this.foodLeft),this.updateTexture();break;case 1:var e=this.harvestAmount*this.city.simulation.boostManager.currentGlobalBoostAmount;this.foodLeft-=e;var i=this.city.materials;i.set_food(i.food+e),this.city.simulation.stats.materialProduction[0][0]+=e,this.foodLeft<=0&&(this.cleanSpeed<=0?(this.farmStage=0,this.percentGrown=0):(this.percentCleaned=0,this.farmStage=2)),this.updateTexture();break;case 2:this.percentCleaned+=this.cleanSpeed,100<=this.percentCleaned&&(this.farmStage=0,this.percentGrown=0),this.updateTexture()}},setTexture:function(t,e){this.textures=dt.getTexturesByWidth(t,e)},updateTexture:function(){var t;switch(this.farmStage){case 0:t=this.textures[Math.floor(this.percentGrown/100*(this.textures.length-1-this.harvestSpritePart))];break;case 1:var e=this.textures.length-1-Math.ceil(this.foodLeft/this.originalFoodLeft*.9999*this.harvestSpritePart),i=this.textures.length-2;t=this.textures[e<1?1:i<e?i:e];break;case 2:t=this.textures[this.textures.length-1]}this.growthSprite.texture=t},positionSprites:function(){null!=this.growthSprite&&this.growthSprite.position.set(this.partOf.position.x+this.relativePosition.x,this.partOf.position.y+this.relativePosition.y)},showInfoText:function(i){var n=this;this.city.gui.windowAddInfoText(null,function(){var t,e=i;switch(n.farmStage){case 0:t=Tr.lo("crops_grow_pct",[Math.floor(n.percentGrown)]);break;case 1:t=Tr.lo("food_left_to_harvest",[Math.floor(n.foodLeft)]);break;case 2:t=Tr.lo("old_crops_cleaned",[Math.floor(n.percentCleaned)])}return e+t})},save:function(t,e){null==e&&(e=!0),e&&t.addString(Ke.saveDefinition);var i=this.farmStage;if(t.size+4>t.bytes.length){var n=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+4))),t.bytes.blit(0,n,0,t.size)}t.bytes.setInt32(t.size,i),t.size+=4;i=this.percentGrown;if(t.size+8>t.bytes.length){n=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+8))),t.bytes.blit(0,n,0,t.size)}t.bytes.setDouble(t.size,i),t.size+=8;i=this.foodLeft;if(t.size+8>t.bytes.length){n=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+8))),t.bytes.blit(0,n,0,t.size)}t.bytes.setDouble(t.size,i),t.size+=8;i=this.originalFoodLeft;if(t.size+8>t.bytes.length){n=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+8))),t.bytes.blit(0,n,0,t.size)}t.bytes.setDouble(t.size,i),t.size+=8;i=this.percentCleaned;if(t.size+8>t.bytes.length){n=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+8))),t.bytes.blit(0,n,0,t.size)}t.bytes.setDouble(t.size,i),t.size+=8},load:function(t,e){null==e&&(e=t.readString());var i=Dr.makeLoadMap(e,t);Object.prototype.hasOwnProperty.call(i.h,"farmStage")&&(this.farmStage=i.h.farmStage),Object.prototype.hasOwnProperty.call(i.h,"percentGrown")&&(this.percentGrown=i.h.percentGrown),Object.prototype.hasOwnProperty.call(i.h,"foodLeft")&&(this.foodLeft=i.h.foodLeft),Object.prototype.hasOwnProperty.call(i.h,"originalFoodLeft")&&(this.originalFoodLeft=i.h.originalFoodLeft),Object.prototype.hasOwnProperty.call(i.h,"percentCleaned")&&(this.percentCleaned=i.h.percentCleaned)},__class__:Ke};var $e=function(t,e,i,n,r,s,o,a){this.totalMaterialsProduced=0,this.materialPhase=0,this.stageProgress=0,this.resourceSprite=null,this.resourceSprite=new PIXI.Sprite(dt.getTexturesByWidth("spr_communityhouse_crop",5)[0]),re.call(this,t,e,i,n,r,s,o,a),this.buildingMode=k.createInstance(this.get_possibleBuildingModes()[il.getInt(3)],[e,n.cityMidStage,i,this]),this.currentMaterialTextures=this.get_materialTextures(),this.resourceSprite.position.set(s.x+3,s.y+3),i.addChild(this.resourceSprite)};(q["buildings.FarmHouse"]=$e).__name__="buildings.FarmHouse",$e.__super__=re,$e.prototype=e(re.prototype,{get_originalMaterials:function(){switch(this.materialType){case 0:return 20;case 1:return 25;case 2:default:return 10}},get_materialTextures:function(){var t;switch(this.materialType){case 0:t="spr_communityhouse_rock";break;case 1:t="spr_communityhouse_tree";break;case 2:t="spr_communityhouse_crop";break;default:t=""}return dt.getTexturesByWidth(t,5)},get_possibleUpgrades:function(){return[bt]},get_possibleBuildingModes:function(){return[V,J,Z]},destroy:function(){re.prototype.destroy.call(this),this.resourceSprite.destroy()},postLoad:function(){this.resourceSprite.alpha=1,this.setResourceSpriteTexture()},positionSprites:function(){re.prototype.positionSprites.call(this),null!=this.resourceSprite&&this.resourceSprite.position.set(this.position.x+3,this.position.y+3)},update:function(t){if(0==this.materialPhase)switch(this.materialType){case 0:this.stageProgress+=.05*t,1<=this.stageProgress&&(this.materialPhase=1,this.stageProgress=this.get_originalMaterials(),this.resourceSprite.alpha=1),this.setResourceSpriteTexture();break;case 1:var e=this.city.simulation.time.timeSinceStart/60%24;((i=7)<(n=20)?i<=e&&e<n:i<=e||e<n)&&(this.stageProgress+=18e-5*t,1<=this.stageProgress&&(this.materialPhase=1,this.stageProgress=this.get_originalMaterials()),this.setResourceSpriteTexture());break;case 2:var i,n;e=this.city.simulation.time.timeSinceStart/60%24;((i=7)<(n=20)?i<=e&&e<n:i<=e||e<n)&&(this.stageProgress+=8e-5*t,1<=this.stageProgress&&(this.materialPhase=1,this.stageProgress=this.get_originalMaterials()),this.setResourceSpriteTexture())}},walkAround:function(t,e){var i=this;if(e<180)if(5<t.relativeY)t.changeFloor();else{var n=2==this.materialPhase?20:50,r=2==this.materialPhase?30:80,s=!0;null==s&&(s=!1),t.moveAndWait(il.getInt(3,7),il.getInt(n,r),function(){switch(i.materialType){case 0:if(1==i.materialPhase){var t=.1*i.city.simulation.boostManager.currentGlobalBoostAmount;i.stageProgress-=t,i.city.materials.stone+=t,i.city.simulation.stats.materialProduction[2][0]+=t,i.totalMaterialsProduced+=t,i.stageProgress<=0&&(i.stageProgress=0,i.materialPhase=0)}break;case 1:if(0==i.materialPhase)i.stageProgress+=.005,1<=i.stageProgress&&(i.stageProgress=i.get_originalMaterials(),i.materialPhase+=1);else{t=.2*i.city.simulation.boostManager.currentGlobalBoostAmount;i.stageProgress-=t,i.city.materials.wood+=t,i.city.simulation.stats.materialProduction[1][0]+=t,i.totalMaterialsProduced+=t,i.stageProgress<=0&&(i.stageProgress=0,i.materialPhase=0)}break;case 2:if(1==i.materialPhase){t=.25*i.city.simulation.boostManager.currentGlobalBoostAmount;i.stageProgress-=t;var e=i.city.materials;e.set_food(e.food+t),i.city.simulation.stats.materialProduction[0][0]+=t,i.totalMaterialsProduced+=t,i.stageProgress<=0&&(i.stageProgress=0,i.materialPhase=2)}else 0==i.materialPhase?(i.stageProgress+=.01,1<=i.stageProgress&&(i.stageProgress=i.get_originalMaterials(),i.materialPhase+=1)):2==i.materialPhase&&(i.stageProgress+=.1,1<=i.stageProgress&&(i.stageProgress=0,i.materialPhase=0))}i.setResourceSpriteTexture()},s,!1)}else 11<t.relativeX&&1==il.getInt(3)?t.changeFloorAndWaitRandom(60,90):t.moveAndWait(il.getInt(12,16),il.getInt(60,90),null,!1,!1)},setMaterialType:function(t){if(this.materialType=t,this.currentMaterialTextures=this.get_materialTextures(),$e.treeGrowTextures=dt.getTexturesByWidth("spr_communityhouse_tree_grow",5),2==this.materialType)this.adjecentBuildingEffects.push({name:"farm",intensity:1});else{var e=lt.find(this.adjecentBuildingEffects,function(t){return"farm"==t.name});at.remove(this.adjecentBuildingEffects,e)}this.resourceSprite.alpha=1,this.setResourceSpriteTexture()},resetProgress:function(){this.materialPhase=0,this.stageProgress=0},setResourceSpriteTexture:function(){if(0!=this.materialType&&1!=this.materialType||1!=this.materialPhase)0==this.materialType?(this.resourceSprite.texture=this.currentMaterialTextures[0],this.resourceSprite.alpha=this.stageProgress):2==this.materialType&&0==this.materialPhase?this.resourceSprite.texture=this.currentMaterialTextures[this.stageProgress*(this.currentMaterialTextures.length-2)|0]:1==this.materialType&&0==this.materialPhase?this.resourceSprite.texture=$e.treeGrowTextures[this.stageProgress*$e.treeGrowTextures.length|0]:2==this.materialType&&(1==this.materialPhase?this.resourceSprite.texture=this.currentMaterialTextures[this.currentMaterialTextures.length-2]:2==this.materialPhase&&(this.resourceSprite.texture=this.currentMaterialTextures[this.currentMaterialTextures.length-1]));else{var t=this.currentMaterialTextures,e=1-this.stageProgress/this.get_originalMaterials();this.resourceSprite.texture=t[Math.ceil(e*(this.currentMaterialTextures.length-1))]}},addWindowInfoLines:function(){var t=this;re.prototype.addWindowInfoLines.call(this),this.city.gui.windowAddInfoText(null,function(){return Tr.lo("resources_produced",[0|t.totalMaterialsProduced])})},save:function(t,e){null==e&&(e=!0),re.prototype.save.call(this,t),e&&t.addString($e.saveDefinition);var i=this.stageProgress;if(t.size+8>t.bytes.length){var n=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+8))),t.bytes.blit(0,n,0,t.size)}t.bytes.setDouble(t.size,i),t.size+=8;i=this.materialPhase;if(t.size+4>t.bytes.length){n=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+4))),t.bytes.blit(0,n,0,t.size)}t.bytes.setInt32(t.size,i),t.size+=4;i=this.totalMaterialsProduced;if(t.size+8>t.bytes.length){n=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+8))),t.bytes.blit(0,n,0,t.size)}t.bytes.setDouble(t.size,i),t.size+=8},load:function(t,e){if(re.prototype.load.call(this,t),!(t.version<23)){null==e&&(e=t.readString());var i=Dr.makeLoadMap(e,t);Object.prototype.hasOwnProperty.call(i.h,"stageProgress")&&(this.stageProgress=i.h.stageProgress),Object.prototype.hasOwnProperty.call(i.h,"materialPhase")&&(this.materialPhase=i.h.materialPhase),Object.prototype.hasOwnProperty.call(i.h,"totalMaterialsProduced")&&(this.totalMaterialsProduced=i.h.totalMaterialsProduced),this.postLoad()}},__class__:$e});function Qe(t,e,i,n,r,s,o,a){this.timeToCheckBuildings=0,this.currentMission=0,ce.call(this,t,e,i,n,r,s,o,a),this.startTime=12,this.endTime=2,this.workTimePreferenceMod=.3}(q["buildings.FeatherAlliance"]=Qe).__name__="buildings.FeatherAlliance",Qe.__super__=ce,Qe.prototype=e(ce.prototype,{addWindowInfoLines:function(){var t=this;ce.prototype.addWindowInfoLines.call(this),this.city.gui.windowAddInfoText(null,function(){return t.missionGetTitle()},"Arial15"),this.city.gui.windowAddInfoText(null,function(){return t.missionGetText()})},missionGetTitle:function(){return 8==this.currentMission?Tr.lo("thank_you"):Tr.lo("current_task")},missionGetText:function(){return 8<=this.currentMission?Tr.lo("feather_alliance_done"):this.workers.length!=this.get_jobs()?Tr.lo("jobs_filled_featheralliance"):Tr.lo("feather_alliance_mission_"+this.currentMission)},checkMissionCompletions:function(){for(var t=!1;;){if(t=!1,0==this.currentMission)t=gr.any(this.city.simulation.stats.materialProduction[ct.findMaterialIndex("graphene")],function(t){return 100<=t});else if(1==this.currentMission)t&&this.city.progress.unlocks.unlock(qi);else if(4!=this.currentMission&&3!=this.currentMission&&this.currentMission<8&&this.timeToCheckBuildings<=0){var e=this.city.getAmountOfPermanentsPerType();switch(this.currentMission){case 2:(t=10<=e.h["buildings.RooftopPark"])&&this.city.progress.unlocks.unlock(Kt);break;case 6:(t=2<=e.h["buildings.Mansion"])&&this.city.progress.unlocks.unlock(pi);break;case 7:t=1<=e.h["buildings.IntergalacticLibrary"]}this.timeToCheckBuildings=30}if(t&&(this.currentMission+=1,this.timeToCheckBuildings=0,this.city.progress.goalHelp.updateHasBuildingGoal()),!t)break}},update:function(t){ce.prototype.update.call(this,t),this.checkMissionCompletions(),this.timeToCheckBuildings-=t},work:function(t,e,i){i?t.currentAction=2:this.walkAround(t,150)},walkAround:function(t,e){var i=il.getInt(5);if(0==i&&120<e)t.changeFloorAndWaitRandom(30,60);else if(1==i&&t.relativeY<5)t.moveAndWait(il.getInt(3,7),il.getInt(30,60),null,!1,!1);else if(2==i)t.moveAndWait(il.getInt(12,13),il.getInt(30,60),null,!1,!1);else{var n=ka.pool,r=0<n[2].length?n[2].splice(n[2].length-1,1)[0]:new Int32Array(2);r[0]=8,r[1]=il.getInt(90,120),t.setPath(r,0,2,!0),t.pathEndFunction=null,t.pathOnlyRelatedTo=t.inPermanent}},getGlobalGoal:function(){return 8==this.currentMission?null:{category:Tr.lo("feather_alliance_mission"),text:this.missionGetText()}},save:function(t,e){null==e&&(e=!0),ce.prototype.save.call(this,t),e&&t.addString(Qe.saveDefinition);var i=this.currentMission;if(t.size+4>t.bytes.length){var n=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+4))),t.bytes.blit(0,n,0,t.size)}t.bytes.setInt32(t.size,i),t.size+=4},load:function(t,e){ce.prototype.load.call(this,t),null==e&&(e=t.readString());var i=Dr.makeLoadMap(e,t);Object.prototype.hasOwnProperty.call(i.h,"currentMission")&&(this.currentMission=i.h.currentMission)},__class__:Qe});var Je=function(t,e,i,n,r,s,o,a){ee.call(this,t,e,i,n,r,s,o,a),this.doorX=14,this.festivalCoolDown=0};(q["buildings.FestivalHQ"]=Je).__name__="buildings.FestivalHQ",Je.__super__=ee,Je.prototype=e(ee.prototype,{onBuild:function(){ee.prototype.onBuild.call(this),dr.achieve("BUILD_FESTIVAL_HQ")},work:function(n,t,e){e?n.currentAction=2:5<n.relativeY?il.getFloat(1)<.5?n.changeFloor(function(){var t=n,e=ka.pool,i=0<e[2].length?e[2].splice(e[2].length-1,1)[0]:new Int32Array(2);i[0]=8,i[1]=il.getInt(50,100),t.setPath(i,0,2,!0),n.pathEndFunction=null,n.pathOnlyRelatedTo=n.inPermanent}):n.moveAndWait(il.fromArray([3,4,5,6,12,13,14,15]),il.getInt(50,100)):il.getFloat(1)<.3?n.changeFloor(function(){var t=n,e=ka.pool,i=0<e[2].length?e[2].splice(e[2].length-1,1)[0]:new Int32Array(2);i[0]=8,i[1]=il.getInt(50,100),t.setPath(i,0,2,!0),n.pathEndFunction=null,n.pathOnlyRelatedTo=n.inPermanent}):n.moveAndWait(il.fromArray([3,8,13,14]),il.getInt(50,100))},update:function(t){-1<this.festivalCoolDown&&(this.festivalCoolDown-=t*(this.workers.length/this.get_jobs())*this.city.simulation.time.minutesPerTick)},getMusicFestivalMTP:function(){return new L(this.city.simulation.citizens.length,0,3*this.city.simulation.citizens.length)},getHundredFestivalMTP:function(){return new L(0,0,2*this.city.simulation.citizens.length)},addWindowInfoLines:function(){function t(){return!!(s.city.simulation.festivalManager.hasNoPlannedFestival()&&s.festivalCoolDown<0)&&s.city.simulation.festivalManager.festivalCoolDown<0}var s=this;ee.prototype.addWindowInfoLines.call(this);var e,o=this.city.gui,a=new ps(o,o.innerWindowStage,o.windowInner);a.fillSecondarySize=!0,a.direction=Ps.Vertical,o.windowInner.addChild(a);function l(){a.clear(),a.addChild(new Ms(a,new vr(0,3))),a.addChild(new ao(a,o.innerWindowStage,null,function(){var t=s.city.simulation.festivalManager;return t.hasFestival()?Tr.lo("current_festival"):null!=t.plannedFestival()?Tr.lo("planned_festival"):Tr.lo("preparing")},"Arial15")),a.addChild(new ao(a,o.innerWindowStage,null,function(){var t=s.city.simulation.festivalManager;if(t.hasFestival())return t.currentFestival().getText();if(null!=t.plannedFestival())return t.plannedFestival().getText();if(0==s.workers.length)return Tr.lo("assign_workers_to_prepare");var e="";return s.workers.length<s.get_jobs()&&(e=" "+Tr.lo("assign_more_to_speed_up")),Or.firstToUpper(h.getBasicTimeString(Math.max(s.festivalCoolDown,s.city.simulation.festivalManager.festivalCoolDown)*(s.get_jobs()/s.workers.length)))+" of preparation left."+e})),o.window.onUpdate=function(){t()&&e()}}e=function(){a.clear();po.createHeader(o,Tr.lo("organize_a_festival"),a);var t=po.createActivatableButton(s.city.gui,!1,function(){var t=s.getMusicFestivalMTP();if(s.city.materials.canAfford(t)&&s.city.simulation.festivalManager.hasNoPlannedFestival()&&ql.canDo(s.city,s.city.simulation,s)){s.city.materials.remove(t);var e=new ql(s.city,s.city.simulation,s.city.simulation.festivalManager,s);e.plan(),s.city.simulation.festivalManager.addFestival(e),s.festivalCoolDown+=8783.999999999998,s.city.simulation.festivalManager.festivalCoolDown=s.festivalCoolDown,l()}else{var i=function(){s.city.gui.showSimpleWindow(Tr.lo("cant_organize"),null,!0)};i(),s.city.gui.addWindowToStack(i)}},Tr.lo("music_festival"),Tr.lo("music_festival_help"),a),e=s.getMusicFestivalMTP(),i=t.container,n=new ps(o,o.innerWindowStage,i),r=new Hs(s.city,e,"");n.addChild(new ds(n,o.innerWindowStage,r,{left:0,right:0,top:0,bottom:po.hasMultiUpgradeModeOn?0==e.knowledge?0:1:2},Uh(r,r.updateCostDisplay))),o.window.onUpdate=function(){var t=s.getMusicFestivalMTP();r.setCost(t)},i.addChild(n),a.addChild(new Ms(a,new vr(0,3)))},t()?e():l()},destroy:function(){ee.prototype.destroy.call(this);for(var t=0,e=this.city.simulation.festivalManager.festivals;t<e.length;){var i=e[t];++t,this.city.simulation.festivalManager.endFestival(i)}},save:function(t,e){null==e&&(e=!0),ee.prototype.save.call(this,t),e&&t.addString(Je.saveDefinition);var i=this.festivalCoolDown;if(t.size+8>t.bytes.length){var n=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+8))),t.bytes.blit(0,n,0,t.size)}t.bytes.setDouble(t.size,i),t.size+=8},load:function(t,e){ee.prototype.load.call(this,t),null==e&&(e=t.readString());var i=Dr.makeLoadMap(e,t);Object.prototype.hasOwnProperty.call(i.h,"festivalCoolDown")&&(this.festivalCoolDown=i.h.festivalCoolDown)},__class__:Je});function Ze(t,e,i,n,r,s,o,a){this.timesUsedTo=0,this.timesUsed=0,this.mirrored=!1,this.teleportX=15,this.topFlower=null,re.call(this,t,e,i,n,r,s,o,a),this.doorX=14,this.yearsToLiveLongerPerYearIfLivingHere=.05,this.updateTopFlower()}(q["buildings.FlowerPenthouse"]=Ze).__name__="buildings.FlowerPenthouse",Ze.__super__=re,Ze.prototype=e(re.prototype,{get_possibleUpgrades:function(){return[]},get_baseAttractiveness:function(){return 100},get_hasPrivateTeleporter:function(){return!0},postLoad:function(){this.mirrored&&(this.mirror(),this.mirrored=!0)},mirror:function(){this.mirrored=!this.mirrored,this.updateTopFlower(),this.teleportX=19-this.teleportX,this.drawer.mirror(),this.mirrored?this.doorX=4:this.doorX=14},updateTopFlower:function(){this.world.permanents[this.worldPosition.x].length==this.worldPosition.y+1||null==this.world.permanents[this.worldPosition.x][this.worldPosition.y+1]?(null==this.topFlower&&(this.topFlower=new PIXI.Sprite(dt.getTexture("spr_flower_up")),this.stage.addChild(this.topFlower),this.topFlower.anchor.y=1),this.mirrored?(this.topFlower.position.set(this.position.x+20,this.position.y),this.topFlower.scale.x=-1):(this.topFlower.position.set(this.position.x,this.position.y),this.topFlower.scale.x=1)):null!=this.topFlower&&(this.topFlower.destroy(),this.topFlower=null)},onCityChange:function(){re.prototype.onCityChange.call(this),this.updateTopFlower()},destroy:function(){re.prototype.destroy.call(this),null!=this.topFlower&&this.topFlower.destroy()},walkAround:function(t,e){if(this.mirrored)if(t.relativeY<5)5<=t.relativeX||il.getFloat()<.5?t.moveAndWait(il.getInt(3,16),il.getInt(60,90),null,!1,!1):t.changeFloorAndWait(60);else if(5<=t.relativeX||il.getFloat()<.8){(i=il.getFloat())<.5?t.moveAndWait(il.getInt(15,18),il.getInt(40,60),null,!1,!1):i<.8?t.moveAndWait(il.getInt(10,12),il.getInt(60,90),null,!1,!1):t.moveAndWait(il.getInt(3,5),il.getInt(60,90),null,!1,!1)}else t.changeFloorAndWait(60);else if(t.relativeY<5)t.relativeX<14||il.getFloat()<.5?t.moveAndWait(il.getInt(3,16),il.getInt(60,90),null,!1,!1):t.changeFloorAndWait(60);else if(t.relativeX<14||il.getFloat()<.8){var i;(i=il.getFloat())<.5?t.moveAndWait(il.getInt(1,4),il.getInt(40,60),null,!1,!1):i<.8?t.moveAndWait(il.getInt(7,9),il.getInt(60,90),null,!1,!1):t.moveAndWait(il.getInt(14,16),il.getInt(60,90),null,!1,!1)}else t.changeFloorAndWait(60)},addWindowInfoLines:function(){var t=this;re.prototype.addWindowInfoLines.call(this),this.city.gui.windowAddInfoText(null,function(){return Tr.lo("teleported_from",[t.timesUsed])}),this.city.gui.windowAddInfoText(null,function(){return Tr.lo("teleported_to",[t.timesUsedTo])})},createWindowAddBottomButtons:function(){Io.create(this.city.gui,Uh(this,this.mirror),this.city.gui.windowInner,function(){return Tr.lo("mirror")},this.city.gui.innerWindowStage),this.city.gui.windowInner.addChild(new Ms(this.city.gui.windowInner,new vr(2,6))),dn.createUpkeepInfo(this.city,this.city.gui),re.prototype.createWindowAddBottomButtons.call(this)},createTeleportParticle:function(t){null==t&&(t="unused"),this.city.particles.addParticle(dt.getTexturesByWidth(this.mirrored?"spr_smallteleporter_ray_penthouse_mirror":"spr_smallteleporter_ray_penthouse",3),new vr(this.position.x+(this.mirrored?3:14),this.position.y+12))},save:function(t,e){null==e&&(e=!0),re.prototype.save.call(this,t),e&&t.addString(Ze.saveDefinition);var i=this.mirrored;if(t.size+1>t.bytes.length){var n=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+1))),t.bytes.blit(0,n,0,t.size)}t.bytes.b[t.size]=i?1:0,t.size+=1;i=this.timesUsed;if(t.size+4>t.bytes.length){n=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+4))),t.bytes.blit(0,n,0,t.size)}t.bytes.setInt32(t.size,i),t.size+=4;i=this.timesUsedTo;if(t.size+4>t.bytes.length){n=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+4))),t.bytes.blit(0,n,0,t.size)}t.bytes.setInt32(t.size,i),t.size+=4},load:function(t,e){if(re.prototype.load.call(this,t),!(t.version<26)){null==e&&(e=t.readString());var i=Dr.makeLoadMap(e,t);Object.prototype.hasOwnProperty.call(i.h,"mirrored")&&(this.mirrored=i.h.mirrored),Object.prototype.hasOwnProperty.call(i.h,"timesUsed")&&(this.timesUsed=i.h.timesUsed),Object.prototype.hasOwnProperty.call(i.h,"timesUsedTo")&&(this.timesUsedTo=i.h.timesUsedTo),this.postLoad()}},__class__:Ze});function ti(t,e,i,n,r,s,o,a){this.totalKnowledgeGenerated=0,ee.call(this,t,e,i,n,r,s,o,a),this.startTime=14,this.endTime=23,this.workTimePreferenceMod=.5,this.isEntertainment=!0}(q["buildings.FossilMuseum"]=ti).__name__="buildings.FossilMuseum",ti.__interfaces__=[oe],ti.__super__=ee,ti.prototype=e(ee.prototype,{get_baseEntertainmentCapacity:function(){return 0},get_isOpen:function(){if(1<=this.workers.length&&gr.any(this.workers,function(t){return 0==t.currentAction})){var t=this.city.simulation.time.timeSinceStart/60%24,e=this.startTime-this.workTimePreferenceMod;return e<23?e<=t&&t<23:e<=t||t<23}return!1},get_entertainmentType:function(){return 5},get_secondaryEntertainmentTypes:function(){return null},get_minimumNormalTimeToSpend:function(){return 2},get_maximumNormalTimeToSpend:function(){return 5},get_minimumEntertainmentGroupSatisfy:function(){return 1},get_maximumEntertainmentGroupSatisfy:function(){return 3},get_entertainmentQuality:function(){return 100},get_isOpenForExistingVisitors:function(){return this.get_isOpen()},finishEntertainment:function(t,e){return!0},onBuild:function(){ee.prototype.onBuild.call(this),dr.achieve("FOSSILIZED")},positionSprites:function(){ee.prototype.positionSprites.call(this)},beEntertained:function(s,t){function e(){if(s.relativeY<5)if(il.getFloat()<1){null==(i=!0)&&(i=!1);var t=il.getInt(12,16);if(i){var e=s;(r=0<(n=ka.pool)[4].length?n[4].splice(n[4].length-1,1)[0]:new Int32Array(4))[0]=12,r[1]=50,r[2]=4,r[3]=t,e.setPath(r,0,4,!0)}else{e=s;(r=0<(n=ka.pool)[2].length?n[2].splice(n[2].length-1,1)[0]:new Int32Array(2))[0]=4,r[1]=t,e.setPath(r,0,2,!0)}s.pathEndFunction=null,s.pathOnlyRelatedTo=s.inPermanent}else{if(null==(i=!0)&&(i=!1),i){e=s;(r=0<(n=ka.pool)[4].length?n[4].splice(n[4].length-1,1)[0]:new Int32Array(4))[0]=12,r[1]=50,r[2]=4,r[3]=6,e.setPath(r,0,4,!0)}else{e=s;(r=0<(n=ka.pool)[2].length?n[2].splice(n[2].length-1,1)[0]:new Int32Array(2))[0]=4,r[1]=6,e.setPath(r,0,2,!0)}s.pathEndFunction=null,s.pathOnlyRelatedTo=s.inPermanent}else{var i;null==(i=!0)&&(i=!1);t=il.getInt(4,15);if(i){e=s;(r=0<(n=ka.pool)[4].length?n[4].splice(n[4].length-1,1)[0]:new Int32Array(4))[0]=12,r[1]=50,r[2]=4,r[3]=t,e.setPath(r,0,4,!0)}else{var n,r;e=s;(r=0<(n=ka.pool)[2].length?n[2].splice(n[2].length-1,1)[0]:new Int32Array(2))[0]=4,r[1]=t,e.setPath(r,0,2,!0)}s.pathEndFunction=null,s.pathOnlyRelatedTo=s.inPermanent}}if(1==il.getInt(2))s.changeFloor(e);else{var i=s,n=ka.pool,r=0<n[2].length?n[2].splice(n[2].length-1,1)[0]:new Int32Array(2);r[0]=8,r[1]=il.getInt(120,180),i.setPath(r,0,2,!0),s.pathEndFunction=e,s.pathOnlyRelatedTo=s.inPermanent}s.hasBuildingInited||(s.educationLevel=Math.max(Math.min(s.educationLevel+.035,1.61),s.educationLevel),s.hasBuildingInited=!0)},work:function(t,e,i){if(i)t.currentAction=2;else switch(this.workers.indexOf(t)){case 0:var n=t.pathWalkSpeed*e;if(K.shouldUpdateDraw=!0,Math.abs(6-t.relativeX)<n)t.relativeX=6;else{var r=6-t.relativeX;t.relativeX+=(0<r?1:r<0?-1:0)*n}var s=.001*this.city.simulation.bonuses.fossilsCollected*e*this.city.simulation.happiness.actionSpeedModifier*t.get_educationSpeedModifier()*this.city.simulation.boostManager.currentGlobalBoostAmount*this.workers.length;this.city.materials.knowledge+=s,this.city.simulation.stats.materialProduction[10][0]+=s,this.totalKnowledgeGenerated+=s;break;case 1:t.moveAndWait(il.getInt(12,16),il.getInt(120,180),null,!1,!1);break;case 2:t.relativeY<5?t.changeFloor():t.moveAndWait(il.getInt(4,16),il.getInt(120,180),null,!1,!1)}},addWindowInfoLines:function(){var t=this;ee.prototype.addWindowInfoLines.call(this),this.city.gui.windowAddInfoText(null,function(){return Tr.lo("knowledge_gathered",[0|t.totalKnowledgeGenerated])})},save:function(t,e){null==e&&(e=!0),ee.prototype.save.call(this,t),e&&t.addString(ti.saveDefinition);var i=this.totalKnowledgeGenerated;if(t.size+8>t.bytes.length){var n=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+8))),t.bytes.blit(0,n,0,t.size)}t.bytes.setDouble(t.size,i),t.size+=8},load:function(t,e){ee.prototype.load.call(this,t),null==e&&(e=t.readString());var i=Dr.makeLoadMap(e,t);Object.prototype.hasOwnProperty.call(i.h,"totalKnowledgeGenerated")&&(this.totalKnowledgeGenerated=i.h.totalKnowledgeGenerated)},__class__:ti});function ei(){}(q["buildings.IMedicalBuilding"]=ei).__name__="buildings.IMedicalBuilding",ei.__isInterface__=!0,ei.prototype={__class__:ei};function ii(t,e,i,n,r,s,o,a){this.interior=0,this.mirrored=!1,re.call(this,t,e,i,n,r,s,o,a),this.isMedical=!0,this.interiorSprites=dt.getTexturesByWidth("spr_futuristichome_interiors",20),this.interior=il.getInt(this.interiorSprites.length)}(q["buildings.FuturisticHome"]=ii).__name__="buildings.FuturisticHome",ii.__interfaces__=[ei],ii.__super__=re,ii.prototype=e(re.prototype,{get_medicalQuality:function(){return 100},get_medicalCapacity:function(){return this.residents.length},get_medicalTypeLimit:function(){return 1},get_medicalTypeID:function(){return 0},get_drawerType:function(){return Nn},get_customizableDrawer:function(){return this.drawer},postLoad:function(){this.mirrored&&(this.mirror(),this.mirrored=!0)},postCreate:function(){re.prototype.postCreate.call(this),this.get_customizableDrawer().setCustomTextures(null,null,this.interiorSprites[this.interior])},mirror:function(){this.mirrored=!this.mirrored,this.drawer.mirror()},createWindowAddBottomButtons:function(){},walkAround:function(t,e){},save:function(t,e){null==e&&(e=!0),re.prototype.save.call(this,t),e&&t.addString(ii.saveDefinition);var i=this.mirrored;if(t.size+1>t.bytes.length){var n=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+1))),t.bytes.blit(0,n,0,t.size)}t.bytes.b[t.size]=i?1:0,t.size+=1;i=this.interior;if(t.size+4>t.bytes.length){n=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+4))),t.bytes.blit(0,n,0,t.size)}t.bytes.setInt32(t.size,i),t.size+=4},load:function(t,e){re.prototype.load.call(this,t),null==e&&(e=t.readString());var i=Dr.makeLoadMap(e,t);Object.prototype.hasOwnProperty.call(i.h,"mirrored")&&(this.mirrored=i.h.mirrored),Object.prototype.hasOwnProperty.call(i.h,"interior")&&(this.interior=i.h.interior),this.postLoad()},__class__:ii});function ni(t,e,i,n,r,s,o,a){this.currentTexture=0,_.call(this,t,e,i,n,r,s,o,a)}(q["buildings.GlassPiece"]=ni).__name__="buildings.GlassPiece",ni.__interfaces__=[Oe],ni.__super__=_,ni.prototype=e(_.prototype,{customize:function(t,e){this.currentTexture=t,this.setAppearance()},createOrRemoveBuilderForThis:function(){this.city.createOrRemoveBuilder(Ko.getClass(this),!0,this.currentTexture)},areSameCustomizations:function(t,e,i){return this.currentTexture==t},postCreate:function(){},setAppearance:function(){var t;switch(this.currentTexture){case 0:t="spr_indoorfarm";break;case 1:t="spr_treeplantation";break;default:t=""}this.drawer.changeMainTexture(t)},createWindowAddBottomButtons:function(){var e=this;To.create(this.city.gui,function(){return e.currentTexture},function(t){e.currentTexture=t,e.setAppearance()},function(){return 2},Tr.lo("change_building_color")),this.city.gui.windowInner.addChild(new Ms(this.city.gui.windowInner,new vr(2,6))),_.prototype.createWindowAddBottomButtons.call(this)},save:function(t,e){null==e&&(e=!0),_.prototype.save.call(this,t),e&&t.addString(ni.saveDefinition);var i=this.currentTexture;if(t.size+4>t.bytes.length){var n=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+4))),t.bytes.blit(0,n,0,t.size)}t.bytes.setInt32(t.size,i),t.size+=4},load:function(t,e){_.prototype.load.call(this,t),null==e&&(e=t.readString());var i=Dr.makeLoadMap(e,t);Object.prototype.hasOwnProperty.call(i.h,"currentTexture")&&(this.currentTexture=i.h.currentTexture)},__class__:ni});function ri(t,e,i,n,r,s,o,a){this.usesNoStone=!1,this.materialMade=0,this.totalKnowledgeUsed=0,this.totalStoneUsed=0,this.materialsMadePerStepPerWorker=125e-6,this.efficiency=this.get_normalEfficiencyKnowledge(),Ie.call(this,t,e,i,n,r,s,o,a,"spr_graphenefactory_frames","spr_graphenefactory_idle"),this.connectionSprite=null}(q["buildings.GrapheneFactory"]=ri).__name__="buildings.GrapheneFactory",ri.__super__=Ie,ri.prototype=e(Ie.prototype,{get_normalEfficiencyKnowledge:function(){return 10},get_normalEfficiencyStone:function(){return 1},get_walkThroughCanViewSelfInThisBuilding:function(){return!1},get_possibleUpgrades:function(){return[_t]},get_possibleBuildingModes:function(){return[ft,rt]},get_bonusSpeed:function(){return 0==this.activeWorkers?1:this.activeWorkersTotalEducation/this.activeWorkers},possiblyBeActive:function(t){return!1},canShowActiveTextures:function(){return!!(this.usesNoStone||3<=this.city.materials.stone)&&3<=this.city.materials.knowledge},workAnimation:function(t,e){var i=this.workers.indexOf(t);1==i?t.setRelativePos(3,0):0==i?t.setRelativePos(15,0):2==i?t.setRelativePos(11,10):t.setRelativePos(15,10)},onCityChange:function(){null!=this.leftBuilding&&this.leftBuilding.is(hn)?(null==this.connectionSprite&&(this.connectionSprite=new PIXI.Sprite(dt.getTexture("spr_stoneteleporter_graphenefactory_connection")),this.city.justAboveCityStage.addChild(this.connectionSprite)),this.connectionSprite.position.set(this.position.x-3,this.position.y+1),this.usesNoStone=!0):null!=this.connectionSprite&&(this.connectionSprite.destroy(),this.connectionSprite=null,this.usesNoStone=!1)},destroy:function(){null!=this.connectionSprite&&(this.connectionSprite.destroy(),this.connectionSprite=null),Ie.prototype.destroy.call(this)},addWindowInfoLines:function(){var t=this;Ie.prototype.addWindowInfoLines.call(this),this.city.gui.windowAddInfoText(null,function(){return Tr.lo("graphene_sheets_production",[0|t.totalKnowledgeUsed,0|t.totalStoneUsed,0|t.materialMade])})},save:function(t,e){null==e&&(e=!0),Ie.prototype.save.call(this,t),e&&t.addString(ri.saveDefinition);var i=this.totalStoneUsed;if(t.size+8>t.bytes.length){var n=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+8))),t.bytes.blit(0,n,0,t.size)}t.bytes.setDouble(t.size,i),t.size+=8;i=this.totalKnowledgeUsed;if(t.size+8>t.bytes.length){n=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+8))),t.bytes.blit(0,n,0,t.size)}t.bytes.setDouble(t.size,i),t.size+=8;i=this.materialMade;if(t.size+8>t.bytes.length){n=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+8))),t.bytes.blit(0,n,0,t.size)}t.bytes.setDouble(t.size,i),t.size+=8},load:function(t,e){Ie.prototype.load.call(this,t),null==e&&(e=t.readString());var i=Dr.makeLoadMap(e,t);Object.prototype.hasOwnProperty.call(i.h,"totalStoneUsed")&&(this.totalStoneUsed=i.h.totalStoneUsed),Object.prototype.hasOwnProperty.call(i.h,"totalKnowledgeUsed")&&(this.totalKnowledgeUsed=i.h.totalKnowledgeUsed),Object.prototype.hasOwnProperty.call(i.h,"materialMade")&&(this.materialMade=i.h.materialMade)},__class__:ri});function si(t,e,i,n,r,s,o,a){this.totalGrapheneProduced=0,this.totalStoneUsed=0,this.totalKnowledgeGenerated=0,ee.call(this,t,e,i,n,r,s,o,a)}(q["buildings.GrapheneLab"]=si).__name__="buildings.GrapheneLab",si.__super__=ee,si.prototype=e(ee.prototype,{onBuild:function(){this.city.progress.unlocks.unlockMaterial("graphene")},work:function(t,e,i){},addWindowInfoLines:function(){var t=this;ee.prototype.addWindowInfoLines.call(this),this.city.gui.windowAddInfoText(null,function(){return Tr.lo("knowledge_gathered",[0|t.totalKnowledgeGenerated])}),this.city.gui.windowAddInfoText(null,function(){return Tr.lo("graphene_sheets_made",[0|t.totalStoneUsed,0|t.totalGrapheneProduced])})},save:function(t,e){null==e&&(e=!0),ee.prototype.save.call(this,t),e&&t.addString(si.saveDefinition);var i=this.totalKnowledgeGenerated;if(t.size+8>t.bytes.length){var n=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+8))),t.bytes.blit(0,n,0,t.size)}t.bytes.setDouble(t.size,i),t.size+=8;i=this.totalStoneUsed;if(t.size+8>t.bytes.length){n=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+8))),t.bytes.blit(0,n,0,t.size)}t.bytes.setDouble(t.size,i),t.size+=8;i=this.totalGrapheneProduced;if(t.size+8>t.bytes.length){n=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+8))),t.bytes.blit(0,n,0,t.size)}t.bytes.setDouble(t.size,i),t.size+=8},load:function(t,e){ee.prototype.load.call(this,t),null==e&&(e=t.readString());var i=Dr.makeLoadMap(e,t);Object.prototype.hasOwnProperty.call(i.h,"totalKnowledgeGenerated")&&(this.totalKnowledgeGenerated=i.h.totalKnowledgeGenerated),Object.prototype.hasOwnProperty.call(i.h,"totalStoneUsed")&&(this.totalStoneUsed=i.h.totalStoneUsed),Object.prototype.hasOwnProperty.call(i.h,"totalGrapheneProduced")&&(this.totalGrapheneProduced=i.h.totalGrapheneProduced)},__class__:si});function oi(t,e,i,n,r,s,o,a){this.timeToCheckBuildings=0,this.currentMission=0,this.manyTeleportAlpha=0,this.eventPhase=0,this.doingEvent=-1,this.lastEventDoneOnDay=0,ce.call(this,t,e,i,n,r,s,o,a),this.startTime=14,this.endTime=3,this.workTimePreferenceMod=.3,this.boltSprite=new PIXI.Sprite(dt.getTexture("spr_hackers_bolt")),this.boltSprite.position.set(s.x+12,s.y+11),e.addChild(this.boltSprite),0==o.y&&(this.boltSprite.alpha=0)}(q["buildings.HackerHQ"]=oi).__name__="buildings.HackerHQ",oi.__super__=ce,oi.prototype=e(ce.prototype,{positionSprites:function(){ce.prototype.positionSprites.call(this),this.boltSprite.position.set(this.position.x+12,this.position.y+11),0==this.worldPosition.y&&(this.boltSprite.alpha=0)},destroy:function(){this.boltSprite.destroy(),ce.prototype.destroy.call(this)},addWindowInfoLines:function(){var t=this;ce.prototype.addWindowInfoLines.call(this),this.city.gui.windowInner.addChild(new Ms(this.city.gui.window,new vr(4,4))),this.city.gui.windowAddInfoText(null,function(){return t.missionGetTitle()},"Arial15"),this.city.gui.windowAddInfoText(null,function(){return t.missionGetText()})},missionGetTitle:function(){return 11==this.currentMission?Tr.lo("thank_you"):Tr.lo("current_task")},missionGetText:function(){return 11<=this.currentMission?Tr.lo("hackers_done"):this.workers.length!=this.get_jobs()?Tr.lo("hackers_gather"):Tr.lo("hacker_mission_"+this.currentMission)},checkMissionCompletions:function(){for(var t=!1;;){switch(t=!1,this.currentMission){case 3:(t=this.city.progress.unlocks.getUnlockState(Lt)==$a.Researched)&&this.city.progress.unlocks.unlock(Ye);break;case 5:(t=gr.any(this.city.simulation.stats.materialProduction[ct.findMaterialIndex("computerChips")],function(t){return 20<=t}))&&this.city.progress.unlocks.unlock($i);break;case 8:(t=this.city.progress.unlocks.getUnlockState(W)==$a.Researched)&&this.city.progress.unlocks.unlock(hi)}if(this.timeToCheckBuildings<=0&&3!=this.currentMission&&5!=this.currentMission&&8!=this.currentMission&&11!=this.currentMission){var e=this.city.getAmountOfPermanentsPerType();switch(this.currentMission){case 0:null==e.h["buildings.ExperimentationLab"]&&(e.h["buildings.ExperimentationLab"]=0),(t=20<=e.h["buildings.Laboratory"]+e.h["buildings.ExperimentationLab"])&&this.city.progress.unlocks.unlock(_i);break;case 1:(t=3<=e.h["buildings.Library"])&&this.city.progress.unlocks.unlock(gn);break;case 2:(t=5<=e.h["buildings.TinkerersHome"])&&this.city.progress.unlocks.unlock(Lt);break;case 4:t=1<=e.h["buildings.FactoryPub"];break;case 6:(t=7<=e.h["buildings.ScrapyardNightClub"])&&this.city.progress.unlocks.unlock(ze);break;case 7:(t=1<=e.h["buildings.EscapeRoom"])&&this.city.progress.unlocks.unlock(W);break;case 9:(t=2<=e.h["buildings.HoloGameHall"])&&this.city.progress.unlocks.unlock(Ci);break;case 10:t=1<=e.h["buildings.Misdirector"]}this.timeToCheckBuildings=30}if(t&&(this.currentMission+=1,this.timeToCheckBuildings=0,this.city.progress.goalHelp.updateHasBuildingGoal()),!t)break}},update:function(t){if(ce.prototype.update.call(this,t),this.checkMissionCompletions(),this.timeToCheckBuildings-=t,0<=((0|this.city.simulation.time.timeSinceStart)/60|0)%24&&((0|this.city.simulation.time.timeSinceStart)/60|0)%24<4){var e=4-4*Math.abs(1-this.city.simulation.time.timeSinceStart/60%24/2);this.boltSprite.alpha=e<0?0:1<e?1:e}else this.boltSprite.alpha=0},work:function(t,e,i){i?t.currentAction=2:this.doWalkAround(t)},walkAround:function(t,e){this.doWalkAround(t)},doWalkAround:function(t){5<t.relativeY?1==il.getInt(4)&&5<t.relativeX?t.changeFloor():t.moveAndWait(il.fromArray(oi.walkAroundPositions),il.getInt(60,120)):1==il.getInt(4)?t.changeFloor():1==il.getInt(3)?t.moveAndWait(il.getInt(5,7),il.getInt(90,150),null,!1,!1):t.moveAndWait(il.getInt(9,15),il.getInt(60,150),null,!1,!1)},getGlobalGoal:function(){return 11==this.currentMission?null:{category:Tr.lo("hackers_mission"),text:this.missionGetText()}},save:function(t,e){null==e&&(e=!0),ce.prototype.save.call(this,t),e&&t.addString(oi.saveDefinition);var i=this.lastEventDoneOnDay;if(t.size+4>t.bytes.length){var n=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+4))),t.bytes.blit(0,n,0,t.size)}t.bytes.setInt32(t.size,i),t.size+=4;i=this.doingEvent;if(t.size+4>t.bytes.length){n=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+4))),t.bytes.blit(0,n,0,t.size)}t.bytes.setInt32(t.size,i),t.size+=4;i=this.eventPhase;if(t.size+4>t.bytes.length){n=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+4))),t.bytes.blit(0,n,0,t.size)}t.bytes.setInt32(t.size,i),t.size+=4;i=this.currentMission;if(t.size+4>t.bytes.length){n=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+4))),t.bytes.blit(0,n,0,t.size)}t.bytes.setInt32(t.size,i),t.size+=4},load:function(t,e){ce.prototype.load.call(this,t),null==e&&(e=t.readString());var i=Dr.makeLoadMap(e,t);Object.prototype.hasOwnProperty.call(i.h,"lastEventDoneOnDay")&&(this.lastEventDoneOnDay=i.h.lastEventDoneOnDay),Object.prototype.hasOwnProperty.call(i.h,"doingEvent")&&(this.doingEvent=i.h.doingEvent),Object.prototype.hasOwnProperty.call(i.h,"eventPhase")&&(this.eventPhase=i.h.eventPhase),Object.prototype.hasOwnProperty.call(i.h,"currentMission")&&(this.currentMission=i.h.currentMission)},__class__:oi});function ai(t,e,i,n,r,s,o,a){this.herbSprite=null,this.currentTexture=0,this.herbCapPerWorker=50,this.herbTextures=dt.getTexturesByWidth(this.get_myHerbTextures(),20),this.currentTexture=2*il.getInt(this.herbTextures.length/2|0),ee.call(this,t,e,i,n,r,s,o,a),this.drawer.changeTextureGroup("spr_restaurant"),this.herbSprite=new PIXI.Sprite(this.herbTextures[this.currentTexture]),this.herbSprite.position.set(s.x,s.y),i.cacheableChildren.push(this.herbSprite),i.isInvalid=!0}(q["buildings.HerbGarden"]=ai).__name__="buildings.HerbGarden",ai.__interfaces__=[ei],ai.__super__=ee,ai.prototype=e(ee.prototype,{get_drawerType:function(){return On},get_possibleBuildingModes:function(){return[it,Ct]},get_medicalQuality:function(){return 100},get_medicalCapacity:function(){return this.buildingMode instanceof Ct?100:0},get_medicalTypeLimit:function(){return.2},get_medicalTypeID:function(){return 1},get_myHerbTextures:function(){return"spr_herbgarden_plants"},postLoad:function(){this.herbSprite.texture=this.herbTextures[this.currentTexture],this.bgStage.isInvalid=!0},work:function(t,e,i){if(i)t.currentAction=2;else if(t.relativeY<5&&1==this.workers.indexOf(t))t.changeFloor();else{var n=!1,r=!0;null==r&&(r=!1),null==n&&(n=!1),t.moveAndWait(il.getInt(3,16),il.getInt(30,60),null,n,r)}},getHerbCapacity:function(){return this.herbCapPerWorker*this.workers.length},positionSprites:function(){ee.prototype.positionSprites.call(this),null!=this.herbSprite&&(this.herbSprite.position.set(this.position.x,this.position.y),this.bgStage.isInvalid=!0)},changePlantsTexture:function(t){this.currentTexture=t,null!=this.herbSprite&&(this.herbSprite.texture=this.herbTextures[this.currentTexture],this.bgStage.isInvalid=!0)},destroy:function(){ee.prototype.destroy.call(this);var t=this.bgStage,e=this.herbSprite;at.remove(t.cacheableChildren,e),t.isInvalid=!0,e.destroy({children:!0,texture:!1})},addWindowInfoLines:function(){var t=this;ee.prototype.addWindowInfoLines.call(this),this.city.gui.windowAddInfoText(null,function(){return Tr.lo("herb_reduction",[Math.round(.2*t.city.simulation.eating.currentFoodSaveByHerbsPct*100),20])+"\n"+Tr.lo("herb_medical_happiness",[Math.round(t.city.simulation.happiness.healthCapacityByType[1]/t.city.simulation.citizens.length*100)])})},createWindowAddBottomButtons:function(){var t=this;To.create(this.city.gui,function(){return t.currentTexture},Uh(this,this.changePlantsTexture),function(){return t.herbTextures.length},Tr.lo("change_herb_plants"),null,2),ee.prototype.createWindowAddBottomButtons.call(this)},save:function(t,e){null==e&&(e=!0),ee.prototype.save.call(this,t),e&&t.addString(ai.saveDefinition);var i=this.currentTexture;if(t.size+4>t.bytes.length){var n=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+4))),t.bytes.blit(0,n,0,t.size)}t.bytes.setInt32(t.size,i),t.size+=4},load:function(t,e){if(ee.prototype.load.call(this,t),!(t.version<32)){null==e&&(e=t.readString());var i=Dr.makeLoadMap(e,t);Object.prototype.hasOwnProperty.call(i.h,"currentTexture")&&(this.currentTexture=i.h.currentTexture),this.postLoad()}},__class__:ai});var li=function(t,e,i,n,r,s,o,a){this.lowestNightClub=null,ee.call(this,t,e,i,n,r,s,o,a),this.positionSprites(),this.startTime=20,this.endTime=7.5,this.workTimePreferenceMod=.5,this.isEntertainment=!0,null==li.citizenClothesTexture&&(li.citizenClothesTexture=dt.getTexture("spr_tech_nightclub_hoverer")),this.lowestNightClub=this};(q["buildings.HighTechNightClub"]=li).__name__="buildings.HighTechNightClub",li.__interfaces__=[oe],li.__super__=ee,li.prototype=e(ee.prototype,{get_baseEntertainmentCapacity:function(){return 100*this.workers.length},get_isOpen:function(){if(null!=this.bottomBuilding&&this.bottomBuilding.is(li)||1!=this.workers.length||0!=this.workers[0].currentAction)return!1;var t=this.city.simulation.time.timeSinceStart/60%24,e=this.startTime-this.workTimePreferenceMod;return e<6?e<=t&&t<6:e<=t||t<6},get_entertainmentType:function(){return 0},get_secondaryEntertainmentTypes:function(){return null},get_minimumNormalTimeToSpend:function(){return 5},get_maximumNormalTimeToSpend:function(){return 7},get_minimumEntertainmentGroupSatisfy:function(){return 1},get_maximumEntertainmentGroupSatisfy:function(){return 3},get_entertainmentQuality:function(){return 100},get_isOpenForExistingVisitors:function(){var t=this.city.simulation.time.timeSinceStart/60%24,e=this.startTime-this.workTimePreferenceMod;return e<6?e<=t&&t<6:e<=t||t<6},get_drawerType:function(){return Bn},get_mergingDrawer:function(){return this.drawer},get_walkThroughCanViewSelfInThisBuilding:function(){return null==this.bottomBuilding||!this.bottomBuilding.is(li)},get_hasLeftNightClub:function(){return null!=this.leftBuilding&&this.leftBuilding.is(li)},get_hasRightNightClub:function(){return null!=this.rightBuilding&&this.rightBuilding.is(li)},get_hasTopNightClub:function(){return null!=this.topBuilding&&this.topBuilding.is(li)},get_hasBottomNightClub:function(){return null!=this.bottomBuilding&&this.bottomBuilding.is(li)},get_firstBuildingToGoTo:function(){return this.lowestNightClub},postCreate:function(){ee.prototype.postCreate.call(this),this.updateLowestNightClub()},onCityChange:function(){this.updateLowestNightClub()},updateLowestNightClub:function(){for(this.lowestNightClub=this;this.lowestNightClub.get_hasBottomNightClub();)this.lowestNightClub=this.lowestNightClub.bottomBuilding},onCitizenLeave:function(t,e){null==e||e.is(li)||null!=t.accessorySprite&&(t.accessorySprite.destroy(),t.accessorySprite=null)},beEntertained:function(t,e){if(null==t.accessorySprite){var i,n=t.pathWalkSpeed*e;if(K.shouldUpdateDraw=!0,Math.abs(9-t.relativeX)<n)t.relativeX=9,i=!0;else{var r=9-t.relativeX;t.relativeX+=(0<r?1:r<0?-1:0)*n,i=!1}return i?(t.setRelativeY(t.relativeY+e/2),4<=t.relativeY&&(t.accessorySprite=new PIXI.Sprite(li.citizenClothesTexture),t.accessorySprite.anchor.set(0,0),t.accessorySprite.position.set(-1,-1),t.sprite.addChild(t.accessorySprite),t.setRelativeY(4),t.addToWithAccessoryStage())):t.setRelativeY(0),t.dynamicUnsavedVars.xMoveLeft=0,t.dynamicUnsavedVars.yMoveLeft=0,void(t.dynamicUnsavedVars.waitTime=0)}var s=this.get_hasLeftNightClub(),o=this.leftBuilding,a=this.get_hasRightNightClub(),l=this.rightBuilding,h=this.get_hasTopNightClub(),u=this.topBuilding,c=this.get_hasBottomNightClub(),d=this.bottomBuilding;if(0<Math.abs(t.dynamicUnsavedVars.xMoveLeft)){var p=0<(r=t.dynamicUnsavedVars.xMoveLeft)?1:r<0?-1:0,f=e*p;p*f>p*t.dynamicUnsavedVars.xMoveLeft?(t.setRelativeX(t.relativeX+t.dynamicUnsavedVars.xMoveLeft),t.dynamicUnsavedVars.xMoveLeft=0):(t.setRelativeX(t.relativeX+f),t.dynamicUnsavedVars.xMoveLeft-=f),0<p&&20<t.relativeX&&(a?(t.inPermanent=l,t.setRelativeX(t.relativeX-20)):t.dynamicUnsavedVars.xMoveLeft=0),p<0&&t.relativeX<0&&(s?(t.setRelativeX(t.relativeX+20),t.inPermanent=o):t.dynamicUnsavedVars.xMoveLeft=0)}if(0<Math.abs(t.dynamicUnsavedVars.yMoveLeft)){var g=0<(r=t.dynamicUnsavedVars.yMoveLeft)?1:r<0?-1:0,m=e*g;g*m>g*t.dynamicUnsavedVars.yMoveLeft?(t.setRelativeY(t.relativeY+t.dynamicUnsavedVars.yMoveLeft),t.dynamicUnsavedVars.yMoveLeft=0):(t.setRelativeY(t.relativeY+m),t.dynamicUnsavedVars.yMoveLeft-=m),0<g&&20<t.relativeY&&(h?(t.inPermanent=u,t.setRelativeY(t.relativeY-20)):t.dynamicUnsavedVars.yMoveLeft=0),g<0&&t.relativeY<0&&(c?(t.setRelativeY(t.relativeY+20),t.inPermanent=d):t.dynamicUnsavedVars.yMoveLeft=0)}if(0==t.dynamicUnsavedVars.yMoveLeft&&0==t.dynamicUnsavedVars.xMoveLeft){if(t.dynamicUnsavedVars.waitTime<1)return void(t.dynamicUnsavedVars.waitTime+=e);t.dynamicUnsavedVars.waitTime=0;var y=il.getInt(2);if(0==y){var _=20-t.relativeY-t.actualSpriteHeight-4;this.get_hasTopNightClub()&&(this.topBuilding.get_hasLeftNightClub()||4<=t.relativeX)&&(this.topBuilding.get_hasRightNightClub()||t.relativeX<=14)&&(_+=20);var v=0;(_<10||0==il.getInt(2))&&(v=t.relativeY-4,this.get_hasBottomNightClub()&&(this.bottomBuilding.get_hasLeftNightClub()||4<=t.relativeX)&&(this.bottomBuilding.get_hasRightNightClub()||t.relativeX<=14)&&(v+=20)),t.dynamicUnsavedVars.yMoveLeft=il.getFloat(-v,_)}else if(1==y){var b=20-t.relativeX-2-4;this.get_hasRightNightClub()&&(this.rightBuilding.get_hasBottomNightClub()||2<t.relativeY)&&(this.rightBuilding.get_hasTopNightClub()||t.relativeY<20-t.actualSpriteHeight-4)&&(b+=20);var w=t.relativeX-4;this.get_hasLeftNightClub()&&(this.leftBuilding.get_hasBottomNightClub()||2<t.relativeY)&&(this.leftBuilding.get_hasTopNightClub()||t.relativeY<20-t.actualSpriteHeight-4)&&(w+=20),t.dynamicUnsavedVars.xMoveLeft=il.getFloat(-w,b)}}},work:function(t,e,i){if(i&&6<this.city.simulation.time.timeSinceStart/60%24)return t.inPermanent.is(li)?void(t.inPermanent.exitBuilding(t,e)&&(t.currentAction=2)):(t.setRelativeY(0),null!=t.accessorySprite&&(t.accessorySprite.destroy(),t.accessorySprite=null),void(t.currentAction=2));t.inPermanent==this||t.inPermanent.is(li)&&t.inPermanent.get_hasTopNightClub()},createWindowAddBottomButtons:function(){ee.prototype.createWindowAddBottomButtons.call(this)},exitBuilding:function(t,e){if(null==t.accessorySprite&&t.relativeY<=0)return!0;if(t.relativeX<3){var i=t.pathWalkSpeed*e;if(K.shouldUpdateDraw=!0,Math.abs(3-t.relativeX)<i)t.relativeX=3,r=!0;else{var n=3-t.relativeX;t.relativeX+=(0<n?1:n<0?-1:0)*i,r=!1}y=!r}else y=!1;if(y)return!1;if(16<t.relativeX){var r;i=t.pathWalkSpeed*e;if(K.shouldUpdateDraw=!0,Math.abs(16-t.relativeX)<i)t.relativeX=16,r=!0;else{n=16-t.relativeX;t.relativeX+=(0<n?1:n<0?-1:0)*i,r=!1}y=!r}else y=!1;if(y)return!1;var s=this.get_hasLeftNightClub(),o=this.leftBuilding,a=this.get_hasRightNightClub(),l=this.rightBuilding,h=this.get_hasTopNightClub(),u=this.topBuilding,c=this.get_hasBottomNightClub(),d=this.bottomBuilding;if(0<Math.abs(t.dynamicUnsavedVars.xMoveLeft)){var p=0<(n=t.dynamicUnsavedVars.xMoveLeft)?1:n<0?-1:0,f=e*p;p*f>p*t.dynamicUnsavedVars.xMoveLeft?(t.setRelativeX(t.relativeX+t.dynamicUnsavedVars.xMoveLeft),t.dynamicUnsavedVars.xMoveLeft=0):(t.setRelativeX(t.relativeX+f),t.dynamicUnsavedVars.xMoveLeft-=f),0<p&&20<t.relativeX&&(a?(t.inPermanent=l,t.setRelativeX(t.relativeX-20)):t.dynamicUnsavedVars.xMoveLeft=0),p<0&&t.relativeX<0&&(s?(t.setRelativeX(t.relativeX+20),t.inPermanent=o):t.dynamicUnsavedVars.xMoveLeft=0)}if(0<Math.abs(t.dynamicUnsavedVars.yMoveLeft)){var g=0<(n=t.dynamicUnsavedVars.yMoveLeft)?1:n<0?-1:0,m=e*g;g*m>g*t.dynamicUnsavedVars.yMoveLeft?(t.setRelativeY(t.relativeY+t.dynamicUnsavedVars.yMoveLeft),t.dynamicUnsavedVars.yMoveLeft=0):(t.setRelativeY(t.relativeY+m),t.dynamicUnsavedVars.yMoveLeft-=m),0<g&&20<t.relativeY&&(h?(t.inPermanent=u,t.setRelativeY(t.relativeY-20)):t.dynamicUnsavedVars.yMoveLeft=0),g<0&&t.relativeY<0&&(c?(t.setRelativeY(t.relativeY+20),t.inPermanent=d):t.dynamicUnsavedVars.yMoveLeft=0)}if(this.get_hasBottomNightClub())return t.dynamicUnsavedVars.yMoveLeft=-t.relativeY-15,!1;if(4<t.relativeY)return t.dynamicUnsavedVars.yMoveLeft=4-t.relativeY,!1;t.dynamicUnsavedVars.yMoveLeft=0,t.dynamicUnsavedVars.xMoveLeft=0;var y;i=t.pathWalkSpeed*e;if(K.shouldUpdateDraw=!0,Math.abs(9-t.relativeX)<i)t.relativeX=9,y=!0;else{n=9-t.relativeX;t.relativeX+=(0<n?1:n<0?-1:0)*i,y=!1}return!!y&&(null!=t.accessorySprite&&(t.accessorySprite.destroy(),t.accessorySprite=null),!(0<t.relativeY)||(t.setRelativeY(Math.max(t.relativeY-.5*e,0)),!1))},finishEntertainment:function(t,e){return this.exitBuilding(t,e)},save:function(t,e){null==e&&(e=!0),ee.prototype.save.call(this,t),e&&t.addString(li.saveDefinition)},load:function(t,e){ee.prototype.load.call(this,t),null==e&&(e=t.readString());Dr.makeLoadMap(e,t)},__class__:li});var hi=function(t,e,i,n,r,s,o,a){this.boostTeam2=0,this.boostTeam1=0,this.progressTeam2=0,this.progressTeam1=0,this.hasAtLeastOneVisitor=!1,this.totalWidth=18,this.coordinatorBuilding=null,this.gameInited=!1,this.boosters=[],this.monsterSpriteTeam2=null,this.monsterSpriteTeam1=null,this.currentGameType=null,_.call(this,t,e,i,n,r,s,o,a),this.isEntertainment=!0,this.currentGameType=0,null==hi.citizenClothesTexture&&(hi.citizenClothesTexture=dt.getTexture("spr_hgh_citizenclothes_1"));var l=[];l.push([]),l.push([]),l.push([]),l.push([]),l.push([]),this.blocks=l};(q["buildings.HoloGameHall"]=hi).__name__="buildings.HoloGameHall",hi.__interfaces__=[oe],hi.__super__=_,hi.prototype=e(_.prototype,{get_baseEntertainmentCapacity:function(){return 75},get_isOpen:function(){var t=this.city.simulation.time.timeSinceStart/60%24;return 12<=t||t<2},get_entertainmentType:function(){return 4},get_secondaryEntertainmentTypes:function(){return null},get_minimumNormalTimeToSpend:function(){return 4},get_maximumNormalTimeToSpend:function(){return 5},get_minimumEntertainmentGroupSatisfy:function(){return 2},get_maximumEntertainmentGroupSatisfy:function(){return 5},get_entertainmentQuality:function(){return 100},get_isOpenForExistingVisitors:function(){return this.get_isOpen()},finishEntertainment:function(t,e){return!0},get_drawerType:function(){return Rn},get_hasLeftHoloGameHall:function(){return null!=this.leftBuilding&&this.leftBuilding.is(hi)},get_hasRightHoloGameHall:function(){return null!=this.rightBuilding&&this.rightBuilding.is(hi)},postCreate:function(){_.prototype.postCreate.call(this),this.positionSprites(),this.calculateCoordinatorBuilding(),this.setGameType()},onCityChange:function(){if(this.calculateCoordinatorBuilding(),!this.get_hasRightHoloGameHall()){for(var t=0,e=this.blocks[4];t<e.length;){var i=e[t];++t,i.sprite.destroy()}this.blocks[4]=[]}},calculateCoordinatorBuilding:function(){var t=this.coordinatorBuilding;for(this.coordinatorBuilding=this;this.coordinatorBuilding.get_hasLeftHoloGameHall();)this.coordinatorBuilding=this.coordinatorBuilding.leftBuilding;if(this.coordinatorBuilding==this){this.totalWidth=18;for(var e=this;e.get_hasRightHoloGameHall();)this.totalWidth+=20,e=e.rightBuilding;t!=this&&this.resetSpaceShipGame()}this.get_hasLeftHoloGameHall()||this.get_hasRightHoloGameHall()||0!=this.currentGameType||(this.currentGameType=1,this.destroyHGHSprites(),this.boosters=[]),this.currentGameType!=this.coordinatorBuilding.currentGameType?(this.destroyHGHSprites(),this.currentGameType=this.coordinatorBuilding.currentGameType):t!=this.coordinatorBuilding&&this.coordinatorBuilding!=this&&0==this.currentGameType&&this.destroyHGHSprites()},destroy:function(){_.prototype.destroy.call(this),this.destroyHGHSprites()},destroyHGHSprites:function(){null!=this.monsterSpriteTeam1&&(this.monsterSpriteTeam1.destroy(),this.monsterSpriteTeam1=null),null!=this.monsterSpriteTeam2&&(this.monsterSpriteTeam2.destroy(),this.monsterSpriteTeam2=null);for(var t=0,e=this.boosters;t<e.length;){var i=e[t];++t,null!=i.sprite&&i.sprite.destroy()}this.boosters=[];for(t=0,e=this.blocks;t<e.length;){var n=e[t];++t;for(var r=0;r<n.length;){var s=n[r];++r,s.sprite.destroy()}}(t=[]).push([]),t.push([]),t.push([]),t.push([]),t.push([]),this.blocks=t},beEntertained:function(t,e){switch(this.coordinatorBuilding.currentGameType){case 0:this.beEntertainedSpaceShipBattle(t,e);break;case 1:this.beEntertainedBlockGame(t,e)}this.currentGameType=this.coordinatorBuilding.currentGameType},beEntertainedBlockGame:function(t,e){var o=this,a=il.getInt(4+(this.get_hasRightHoloGameHall()?1:0)),i=il.getInt(6);if(this.get_hasLeftHoloGameHall()&&0==i){var n=t;(s=0<(r=ka.pool)[4].length?r[4].splice(r[4].length-1,1)[0]:new Int32Array(4))[0]=2,s[1]=0,s[2]=4,s[3]=19,n.setPathWithEnd(s,0,4,function(){t.hasBuildingInited=!0},!0)}else if(this.get_hasRightHoloGameHall()&&1==i){var r,s;n=t;(s=0<(r=ka.pool)[4].length?r[4].splice(r[4].length-1,1)[0]:new Int32Array(4))[0]=3,s[1]=0,s[2]=4,s[3]=0,n.setPathWithEnd(s,0,4,function(){t.hasBuildingInited=!0},!0)}else t.moveAndWait(3+4*a,il.getInt(45,90),function(){if(1==o.coordinatorBuilding.currentGameType&&(4!=a||o.get_hasRightHoloGameHall()))if(0==o.blocks[a].length||1<=o.blocks[a][o.blocks[a].length-1].sprite.alpha)if(o.blocks[a].length<4){o.gameInited=!0;var t=new PIXI.Sprite(dt.getTexture("spr_hgh_block"));o.bgStage.addChild(t);var e=n=[il.getFloat(360),1,1];o.blocks[a].push({sprite:t,color:e}),t.alpha=.1,t.tint=mr.toHexInt(hh.toRgb(e)),t.position.set(o.position.x+2+4*a,o.position.y+20-1-4*o.blocks[a].length)}else{var i=il.fromArray(o.blocks[a]),n=[(i.color[0]+5)%360,1,1];i.color=n;var r=hh.toRgb(i.color);i.sprite.tint=mr.toHexInt(r)}else{var s=o.blocks[a][o.blocks[a].length-1].sprite;s.alpha=Math.min(s.alpha+.1,1)}})},beEntertainedSpaceShipBattle:function(t,e){if(t.hasBuildingInited&&null!=t.dynamicUnsavedVars.buildingInited||(t.dynamicUnsavedVars.hghTeam=il.getInt(2),t.dynamicUnsavedVars.hghStarted=!1,t.hasBuildingInited=!0,t.dynamicUnsavedVars.focussingOnBoosters=il.fromArray([!1,!1,!0]),t.dynamicUnsavedVars.focussingOnBooster=il.getInt(2),t.dynamicUnsavedVars.buildingInited=!0),t.dynamicUnsavedVars.hghStarted){var i=this.coordinatorBuilding.totalWidth-2*hi.monsterSize,n=this.coordinatorBuilding.boosters;if(!t.dynamicUnsavedVars.focussingOnBoosters&&0<n.length&&il.getFloat(90)<e&&(t.dynamicUnsavedVars.focussingOnBoosters=!0,t.dynamicUnsavedVars.focussingOnBooster=il.getInt(n.length)),t.dynamicUnsavedVars.focussingOnBoosters)if(n.length<=t.dynamicUnsavedVars.focussingOnBooster)t.dynamicUnsavedVars.focussingOnBoosters=!1;else{var r=n[t.dynamicUnsavedVars.focussingOnBooster],s=this.coordinatorBuilding.position.x+r.xPos;(null!=t.inPermanent&&t.inPermanent.isBuilding?t.inPermanent:null).position.x+t.relativeX>s&&(null!=t.inPermanent&&t.inPermanent.isBuilding?t.inPermanent:null).position.x+t.relativeX<s+hi.boosterSpriteSize?(0==t.dynamicUnsavedVars.hghTeam?r.team1Ownership++:r.team2Ownership++,il.getFloat(40)<e&&(t.dynamicUnsavedVars.focussingOnBoosters=!1)):t.moveTowardsRandomInWorldCoords(s,s+hi.boosterSpriteSize-1,function(){t.hasBuildingInited=!0})}if(!t.dynamicUnsavedVars.focussingOnBoosters)if(0==t.dynamicUnsavedVars.hghTeam){var o=this.coordinatorBuilding.position.x+1+Math.floor(this.coordinatorBuilding.progressTeam1*i);(null!=t.inPermanent&&t.inPermanent.isBuilding?t.inPermanent:null).position.x+t.relativeX>o&&(null!=t.inPermanent&&t.inPermanent.isBuilding?t.inPermanent:null).position.x+t.relativeX<o+hi.monsterSize-1&&il.getFloat(30)>e?(this.coordinatorBuilding.progressTeam1=Math.min(this.coordinatorBuilding.progressTeam1+e/(i*(10+(20-this.boostTeam1)*this.coordinatorBuilding.progressTeam1)),1),1<this.coordinatorBuilding.progressTeam1+this.coordinatorBuilding.progressTeam2&&(this.coordinatorBuilding.progressTeam2=1-this.coordinatorBuilding.progressTeam1)):t.moveTowardsRandomInWorldCoords(o,o+hi.monsterSize-1,function(){t.hasBuildingInited=!0})}else{var a=this.coordinatorBuilding.position.x+this.coordinatorBuilding.totalWidth-hi.monsterSize+1-Math.floor(this.coordinatorBuilding.progressTeam2*i);(null!=t.inPermanent&&t.inPermanent.isBuilding?t.inPermanent:null).position.x+t.relativeX>a&&(null!=t.inPermanent&&t.inPermanent.isBuilding?t.inPermanent:null).position.x+t.relativeX<a+hi.monsterSize-1&&il.getFloat(30)>e?(this.coordinatorBuilding.progressTeam2=Math.min(this.coordinatorBuilding.progressTeam2+e/(i*(10+(20-this.boostTeam2)*this.coordinatorBuilding.progressTeam2)),1),1<this.coordinatorBuilding.progressTeam1+this.coordinatorBuilding.progressTeam2&&(this.coordinatorBuilding.progressTeam1=1-this.coordinatorBuilding.progressTeam2)):t.moveTowardsRandomInWorldCoords(a,a+hi.monsterSize-1,function(){t.hasBuildingInited=!0})}}else{var l=!1;if(0==t.dynamicUnsavedVars.hghTeam)if(this.get_hasLeftHoloGameHall()){var h=t;(c=0<(u=ka.pool)[4].length?u[4].splice(u[4].length-1,1)[0]:new Int32Array(4))[0]=2,c[1]=0,c[2]=4,c[3]=il.getInt(1,19),h.setPathWithEnd(c,0,4,function(){t.hasBuildingInited=!0},!0)}else 1<t.relativeX?t.setRelativeX(Math.max(1,t.relativeX-e)):(t.setRelativeX(1),l=!0);else if(this.get_hasRightHoloGameHall()){var u,c;h=t;(c=0<(u=ka.pool)[4].length?u[4].splice(u[4].length-1,1)[0]:new Int32Array(4))[0]=3,c[1]=0,c[2]=4,c[3]=il.getInt(0,17),h.setPathWithEnd(c,0,4,function(){t.hasBuildingInited=!0},!0)}else t.relativeX<17?t.setRelativeX(Math.min(17,t.relativeX+e)):(t.setRelativeX(17),l=!0);l&&(t.dynamicUnsavedVars.hghStarted=!0,this.coordinatorBuilding.hasAtLeastOneVisitor=!0,null==t.accessorySprite&&(t.accessorySprite=new PIXI.Sprite(hi.citizenClothesTexture),t.accessorySprite.anchor.set(0,1),t.accessorySprite.alpha=.5,4==t.actualSpriteHeight&&t.accessorySprite.position.set(0,1),t.sprite.addChild(t.accessorySprite),t.addToWithAccessoryStage(),0==t.dynamicUnsavedVars.hghTeam?t.accessorySprite.tint=16711680:t.accessorySprite.tint=255))}},onCitizenLeave:function(t,e){null!=e&&e.is(hi)||null!=t.accessorySprite&&(t.accessorySprite.destroy(),t.accessorySprite=null,t.addToCorrectStage())},positionSprites:function(){_.prototype.positionSprites.call(this),this.coordinatorBuilding==this&&this.positionHGHSprites()},createWindowAddBottomButtons:function(){_.prototype.createWindowAddBottomButtons.call(this)},update:function(t){switch(_.prototype.update.call(this,t),this.currentGameType){case 0:this.updateSpaceShipGame(t);break;case 1:this.updateBlockGame(t)}},updateBlockGame:function(t){this.get_isOpen()||this.gameInited&&4<this.city.simulation.time.timeSinceStart/60%24&&(this.destroyHGHSprites(),this.gameInited=!1,this.coordinatorBuilding==this&&this.setGameType())},updateSpaceShipGame:function(t){if(this.coordinatorBuilding==this)if(this.get_isOpen()){if(this.hasAtLeastOneVisitor){this.gameInited=!0,this.boostTeam1=0,this.boostTeam2=0,null==this.monsterSpriteTeam1&&(this.monsterSpriteTeam1=new PIXI.Sprite(dt.getTexture("spr_hgh_monster_1")),this.monsterSpriteTeam1.tint=16711680,this.bgStage.addChild(this.monsterSpriteTeam1)),null==this.monsterSpriteTeam2&&(this.monsterSpriteTeam2=new PIXI.Sprite(dt.getTexture("spr_hgh_monster_1")),this.monsterSpriteTeam2.scale.set(-1,1),this.monsterSpriteTeam2.tint=255,this.bgStage.addChild(this.monsterSpriteTeam2));for(var e=this.boosters.length;0<=--e;){(a=this.boosters[e]).xPos>this.totalWidth-hi.boosterSpriteSize?(a.sprite.destroy(),this.boosters.splice(e,1)):(a.age+=t,a.team1Ownership>a.team2Ownership?(a.sprite.tint=16711680,this.boostTeam1+=11):a.team2Ownership>a.team1Ownership&&(a.sprite.tint=255,this.boostTeam2+=11),a.team1Ownership=0,a.team2Ownership=0,a.isFadingOut?(a.sprite.alpha-=.1*t,a.sprite.alpha<0&&(a.sprite.destroy(),this.boosters.splice(e,1))):200<=a.age&&il.getFloat(50)<t&&e==this.boosters.length-1?a.isFadingOut=!0:a.sprite.alpha<1&&(a.sprite.alpha=Math.min(1,a.sprite.alpha+.1*t)))}if(this.boosters.length<2&&il.getFloat(100)<t){for(var i=-1,n=0;n<10;){i=il.getInt(this.totalWidth-hi.boosterSpriteSize);for(var r=!1,s=0,o=this.boosters;s<o.length;){var a=o[s];++s,i>a.xPos-hi.boosterSpriteSize&&i<a.xPos+hi.boosterSpriteSize&&(r=!0)}if(!r)break;++n}if(n<10){var l=new PIXI.Sprite(dt.getTexture("spr_hgh_booster"));l.alpha=0,this.bgStage.addChild(l),this.boosters.push({xPos:i,team2Ownership:0,team1Ownership:0,sprite:l,isFadingOut:!1,age:0})}}this.positionHGHSprites()}}else this.gameInited&&this.stopSpaceShipGame()},resetSpaceShipGame:function(){this.progressTeam1=0,this.progressTeam2=0,this.gameInited=!1,this.destroyHGHSprites(),this.hasAtLeastOneVisitor=!1,this.boosters=[]},stopSpaceShipGame:function(){this.resetSpaceShipGame(),this.setGameType()},setGameType:function(){var t;switch(il.getInt(1+(this.get_hasRightHoloGameHall()||this.get_hasLeftHoloGameHall()?1:0))){case 0:t=1;break;case 1:t=0;break;default:t=1}this.currentGameType=t},positionHGHSprites:function(){var t=this.totalWidth-2*hi.monsterSize;null!=this.monsterSpriteTeam1&&this.monsterSpriteTeam1.position.set(this.position.x+1+Math.floor(this.progressTeam1*t),this.position.y+2),null!=this.monsterSpriteTeam2&&this.monsterSpriteTeam2.position.set(this.position.x+this.totalWidth+1-Math.ceil(this.progressTeam2*t),this.position.y+2);for(var e=0,i=this.boosters;e<i.length;){var n=i[e];++e,n.sprite.position.set(this.position.x+n.xPos,this.position.y+20-9)}for(e=0,i=this.blocks.length;e<i;)for(var r=e++,s=this.blocks[r],o=0,a=s.length;o<a;){var l=o++;s[l].sprite.position.set(this.position.x+2+4*r,this.position.y+20-5-4*l)}},__class__:hi});function ui(t,e,i,n,r,s,o,a){re.call(this,t,e,i,n,r,s,o,a)}(q["buildings.HouseOfTheKeyFriends"]=ui).__name__="buildings.HouseOfTheKeyFriends",ui.__super__=re,ui.prototype=e(re.prototype,{walkAround:function(t,e){var i=il.getInt(5);if(0==i&&120<e)t.changeFloorAndWaitRandom(30,60);else if(1==i||2==i&&t.relativeY<5)t.moveAndWait(il.getInt(3,7),il.getInt(30,60),null,!1,!1);else if(2==i)t.moveAndWait(il.getInt(12,16),il.getInt(30,60),null,!1,!1);else{var n=ka.pool,r=0<n[2].length?n[2].splice(n[2].length-1,1)[0]:new Int32Array(2);r[0]=8,r[1]=il.getInt(90,120),t.setPath(r,0,2,!0),t.pathEndFunction=null,t.pathOnlyRelatedTo=t.inPermanent}},__class__:ui});var ci=function(t,e,i,n,r,s,o,a){this.timesUsedTo=0,this.timesUsed=0,_.call(this,t,e,i,n,r,s,o,a),this.doorX=8,this.doorTextures=dt.getTexturesByWidth("spr_hyperelevator_door",10),this.doorSprite=new PIXI.Sprite(this.doorTextures[0]),i.addChild(this.doorSprite),this.doorSprite.position.set(s.x+5,s.y+10),this.doorFullyOpenFor=0,this.currentDoorTexture=0,this.relocateSprite()};(q["buildings.HyperElevator"]=ci).__name__="buildings.HyperElevator",ci.__super__=_,ci.prototype=e(_.prototype,{get_typeID:function(){return 4},positionSprites:function(){_.prototype.positionSprites.call(this),this.relocateSprite()},relocateSprite:function(){this.doorSprite.parent.removeChild(this.doorSprite),0==this.worldPosition.y?this.stage.addChild(this.doorSprite):this.bgStage.addChild(this.doorSprite),this.doorSprite.position.set(this.position.x+5,this.position.y+10)},update:function(t){if(_.prototype.update.call(this,t),0<this.doorFullyOpenFor){this.doorFullyOpenFor-=t;var e=this.currentDoorTexture+.5*t,i=this.doorTextures.length-1;this.currentDoorTexture=e<0?0:i<e?i:e,this.updateCurrentDoorTexture()}else{e=this.currentDoorTexture-.5*t,i=this.doorTextures.length-1;this.currentDoorTexture=e<0?0:i<e?i:e,this.updateCurrentDoorTexture()}},openDoor:function(){return this.doorFullyOpenFor=45,this.currentDoorTexture>=this.doorTextures.length-1.01},updateCurrentDoorTexture:function(){this.doorSprite.texture=this.doorTextures[Math.floor(this.currentDoorTexture)]},destroy:function(){_.prototype.destroy.call(this),this.doorSprite.destroy()},addWindowInfoLines:function(){var t=this;_.prototype.addWindowInfoLines.call(this),this.city.gui.windowAddInfoText(null,function(){return Tr.lo("elevator_entered",[t.timesUsed])}),this.city.gui.windowAddInfoText(null,function(){return Tr.lo("elevator_left",[t.timesUsedTo])})},save:function(t,e){null==e&&(e=!0),_.prototype.save.call(this,t),e&&t.addString(ci.saveDefinition);var i=this.timesUsed;if(t.size+4>t.bytes.length){var n=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+4))),t.bytes.blit(0,n,0,t.size)}t.bytes.setInt32(t.size,i),t.size+=4;i=this.timesUsedTo;if(t.size+4>t.bytes.length){n=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+4))),t.bytes.blit(0,n,0,t.size)}t.bytes.setInt32(t.size,i),t.size+=4},load:function(t,e){_.prototype.load.call(this,t),null==e&&(e=t.readString());var i=Dr.makeLoadMap(e,t);Object.prototype.hasOwnProperty.call(i.h,"timesUsed")&&(this.timesUsed=i.h.timesUsed),Object.prototype.hasOwnProperty.call(i.h,"timesUsedTo")&&(this.timesUsedTo=i.h.timesUsedTo)},__class__:ci});var di=function(t,e,i,n,r,s,o,a){this.percentCleaned=0,this.foodLeft=0,this.percentGrown=20,this.farmStage=0,ee.call(this,t,e,i,n,r,s,o,a),this.textures=dt.getTexturesByWidth("spr_indoorfarm_crops",20),this.growthSprite=new PIXI.Sprite,i.addChild(this.growthSprite),this.updateTexture(),this.positionSprites(),this.doorX=12,this.adjecentBuildingEffects.push({name:"farm",intensity:1})};(q["buildings.IndoorFarm"]=di).__name__="buildings.IndoorFarm",di.__super__=ee,di.prototype=e(ee.prototype,{postLoad:function(){this.updateTexture()},work:function(t,e,i){var r=this;if(i)t.currentAction=2;else{var n=(1==this.farmStage?15:30)/this.city.simulation.happiness.actionSpeedModifierWithoutPenalties|0,s=(1==this.farmStage?30:60)/this.city.simulation.happiness.actionSpeedModifierWithoutPenalties|0,o=!1;null==o&&(o=!1),t.moveAndWait(il.getInt(3,15),il.getInt(n,s),function(){switch(r.farmStage){case 0:if(r.percentGrown+=1.35*r.city.simulation.bonuses.indoorFarmSpeed,100<=r.percentGrown){r.farmStage=1;var t=25+r.city.simulation.bonuses.extraFoodFromFarms,e=r.getEffectsOfAdjecentBuildings("increaseCropNumber");r.foodLeft=t+e}r.updateTexture();break;case 1:var i=.25*r.city.simulation.boostManager.currentGlobalBoostAmount;r.foodLeft-=i;var n=r.city.materials;n.set_food(n.food+i),r.city.simulation.stats.materialProduction[0][0]+=i,r.foodLeft<=0&&(r.percentCleaned=0,r.farmStage=2),r.updateTexture();break;case 2:r.percentCleaned+=5,100<=r.percentCleaned&&(r.farmStage=0,r.percentGrown=0),r.updateTexture()}},o,!1)}},destroy:function(){ee.prototype.destroy.call(this),this.growthSprite.destroy()},update:function(t){if(0==this.farmStage){var e=this.city.simulation.time.timeSinceStart/60%24;if((i=7)<(n=20)?i<=e&&e<n:i<=e||e<n)this.percentGrown+=.03*t*this.city.simulation.bonuses.indoorFarmSpeed,100<=this.percentGrown&&(this.farmStage=1,this.foodLeft=25+this.city.simulation.bonuses.extraFoodFromFarms+this.getEffectsOfAdjecentBuildings("increaseCropNumber")),this.updateTexture();else{var i,n;e=this.city.simulation.time.timeSinceStart/60%24;((i=6)<(n=21)?i<=e&&e<n:i<=e||e<n)&&(this.percentGrown+=.015*t*this.city.simulation.bonuses.indoorFarmSpeed,100<=this.percentGrown&&(this.farmStage=1,this.foodLeft=25+this.city.simulation.bonuses.extraFoodFromFarms+this.getEffectsOfAdjecentBuildings("increaseCropNumber")),this.updateTexture())}}},grow:function(t){this.percentGrown+=t,100<=this.percentGrown&&(this.farmStage=1,this.foodLeft=25+this.city.simulation.bonuses.extraFoodFromFarms+this.getEffectsOfAdjecentBuildings("increaseCropNumber")),this.updateTexture()},updateTexture:function(){var t;switch(this.farmStage){case 0:t=this.textures[Math.floor(this.percentGrown/100*(this.textures.length-2))];break;case 1:t=this.textures[this.textures.length-2];break;case 2:t=this.textures[this.textures.length-1]}this.growthSprite.texture=t},positionSprites:function(){ee.prototype.positionSprites.call(this),null!=this.growthSprite&&this.growthSprite.position.set(this.position.x,this.position.y)},addWindowInfoLines:function(){var t=this;ee.prototype.addWindowInfoLines.call(this),this.city.gui.windowAddInfoText(null,function(){switch(t.farmStage){case 0:return Tr.lo("crops_grown",[Math.floor(t.percentGrown)]);case 1:return Tr.lo("food_left",[Math.floor(t.foodLeft)]);case 2:return Tr.lo("percent_cleaned",[Math.floor(t.percentCleaned)])}})},save:function(t,e){null==e&&(e=!0),ee.prototype.save.call(this,t),e&&t.addString(di.saveDefinition);var i=this.farmStage;if(t.size+4>t.bytes.length){var n=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+4))),t.bytes.blit(0,n,0,t.size)}t.bytes.setInt32(t.size,i),t.size+=4;i=this.percentGrown;if(t.size+8>t.bytes.length){n=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+8))),t.bytes.blit(0,n,0,t.size)}t.bytes.setDouble(t.size,i),t.size+=8;i=this.foodLeft;if(t.size+8>t.bytes.length){n=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+8))),t.bytes.blit(0,n,0,t.size)}t.bytes.setDouble(t.size,i),t.size+=8;i=this.percentCleaned;if(t.size+8>t.bytes.length){n=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+8))),t.bytes.blit(0,n,0,t.size)}t.bytes.setDouble(t.size,i),t.size+=8},load:function(t,e){ee.prototype.load.call(this,t),null==e&&(e=t.readString());var i=Dr.makeLoadMap(e,t);Object.prototype.hasOwnProperty.call(i.h,"farmStage")&&(this.farmStage=i.h.farmStage),Object.prototype.hasOwnProperty.call(i.h,"percentGrown")&&(this.percentGrown=i.h.percentGrown),Object.prototype.hasOwnProperty.call(i.h,"foodLeft")&&(this.foodLeft=i.h.foodLeft),Object.prototype.hasOwnProperty.call(i.h,"percentCleaned")&&(this.percentCleaned=i.h.percentCleaned),this.postLoad()},__class__:di});var pi=function(t,e,i,n,r,s,o,a){this.knowledgeSoFar=0,ee.call(this,t,e,i,n,r,s,o,a),this.startTime=13,this.endTime=23,this.workTimePreferenceMod=.5,this.isEntertainment=!0};(q["buildings.IntergalacticLibrary"]=pi).__name__="buildings.IntergalacticLibrary",pi.__interfaces__=[oe],pi.__super__=ee,pi.prototype=e(ee.prototype,{get_baseEntertainmentCapacity:function(){return 0},get_isOpen:function(){if(1<=this.workers.length&&0==this.workers[0].currentAction){var t=this.city.simulation.time.timeSinceStart/60%24,e=this.startTime-this.workTimePreferenceMod;return e<23?e<=t&&t<23:e<=t||t<23}return!1},get_entertainmentType:function(){return 5},get_secondaryEntertainmentTypes:function(){return null},get_minimumNormalTimeToSpend:function(){return 2},get_maximumNormalTimeToSpend:function(){return 5},get_minimumEntertainmentGroupSatisfy:function(){return 1},get_maximumEntertainmentGroupSatisfy:function(){return 3},get_entertainmentQuality:function(){return 100},get_isOpenForExistingVisitors:function(){return this.get_isOpen()},finishEntertainment:function(t,e){return!0},get_knowledgePerDay:function(){return this.workers.length/3*.05*gr.sum(this.city.progress.allCitiesInfo.subCityPops)},get_possibleCityUpgrades:function(){return[tr,er,Jn]},onBuild:function(){ee.prototype.onBuild.call(this),dr.achieve("INTERGALACTIC_LIBRARY")},positionSprites:function(){ee.prototype.positionSprites.call(this)},beEntertained:function(t,e){function i(){t.relativeY<5?t.moveAndWait(il.getInt(3,7),il.getInt(30,60),null,!1,!1):t.moveAndWait(il.getInt(3,16),il.getInt(30,60),null,!1,!1)}if(1==il.getInt(2))t.changeFloor(i);else{var n=t,r=ka.pool,s=0<r[2].length?r[2].splice(r[2].length-1,1)[0]:new Int32Array(2);s[0]=8,s[1]=il.getInt(120,180),n.setPath(s,0,2,!0),t.pathEndFunction=i,t.pathOnlyRelatedTo=t.inPermanent}t.hasBuildingInited||(t.educationLevel=Math.max(Math.min(t.educationLevel+.033,1.81),t.educationLevel),t.hasBuildingInited=!0)},update:function(t){var e=t*(this.get_knowledgePerDay()/(1440/this.city.simulation.time.minutesPerTick))*this.city.simulation.boostManager.currentGlobalBoostAmount;this.city.materials.knowledge+=e,this.city.simulation.stats.materialProduction[10][0]+=e,this.knowledgeSoFar+=e},work:function(t,e,i){if(i&&23<this.city.simulation.time.timeSinceStart/60%24)t.currentAction=2;else switch(this.workers.indexOf(t)){case 0:var n=t.pathWalkSpeed*e;if(K.shouldUpdateDraw=!0,Math.abs(15-t.relativeX)<n)t.relativeX=15;else{var r=15-t.relativeX;t.relativeX+=(0<r?1:r<0?-1:0)*n}break;case 1:if(t.relativeY<5)t.changeFloor();else{n=t.pathWalkSpeed*e;if(K.shouldUpdateDraw=!0,Math.abs(7-t.relativeX)<n)t.relativeX=7;else{r=7-t.relativeX;t.relativeX+=(0<r?1:r<0?-1:0)*n}}break;case 2:if(t.relativeY<5)t.changeFloor();else{n=t.pathWalkSpeed*e;if(K.shouldUpdateDraw=!0,Math.abs(14-t.relativeX)<n)t.relativeX=14;else{r=14-t.relativeX;t.relativeX+=(0<r?1:r<0?-1:0)*n}}}},addWindowInfoLines:function(){var t=this;ee.prototype.addWindowInfoLines.call(this),this.city.gui.windowAddInfoText(null,function(){return Tr.lo("knowledge_gathered_per_day",[0|t.get_knowledgePerDay()])}),this.city.gui.windowAddInfoText(null,function(){return Tr.lo("knowledge_gathered_so_far",[0|t.knowledgeSoFar])})},save:function(t,e){null==e&&(e=!0),ee.prototype.save.call(this,t),e&&t.addString(pi.saveDefinition);var i=this.knowledgeSoFar;if(t.size+8>t.bytes.length){var n=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+8))),t.bytes.blit(0,n,0,t.size)}t.bytes.setDouble(t.size,i),t.size+=8},load:function(t,e){ee.prototype.load.call(this,t),null==e&&(e=t.readString());var i=Dr.makeLoadMap(e,t);Object.prototype.hasOwnProperty.call(i.h,"knowledgeSoFar")&&(this.knowledgeSoFar=i.h.knowledgeSoFar)},__class__:pi});function fi(t,e,i,n,r,s,o,a){this.anyoneHasWorkedHere=!1,this.totalKnowledgeGenerated=0,ee.call(this,t,e,i,n,r,s,o,a),this.normalDrawer=this.drawer,this.originalBackTexture=dt.getTexturesByWidth("spr_laboratory",20)[2],this.noLightBackTexture=dt.getTexture("spr_laboratory_lightsoff"),this.backSprite=new PIXI.Sprite(this.originalBackTexture),this.backSprite.position.set(s.x,s.y),i.addChild(this.backSprite)}(q["buildings.Laboratory"]=fi).__name__="buildings.Laboratory",fi.__super__=ee,fi.prototype=e(ee.prototype,{get_possibleUpgrades:function(){return[gt,$t]},positionSprites:function(){ee.prototype.positionSprites.call(this),null!=this.backSprite&&this.backSprite.position.set(this.position.x,this.position.y)},destroy:function(){ee.prototype.destroy.call(this),null!=this.backSprite&&this.backSprite.destroy()},work:function(t,e,i){if(i)t.currentAction=2;else if(this.anyoneHasWorkedHere=!0,t.isAtGroundLevel()){var n=this.workers.indexOf(t);t.setRelativePos(0==n?5:13,9)}else{var r=.00125*e*this.city.simulation.happiness.actionSpeedModifier*this.city.simulation.bonuses.labSpeed*t.get_educationSpeedModifier()*this.city.simulation.boostManager.currentGlobalBoostAmount;this.city.materials.knowledge+=r,this.city.simulation.stats.materialProduction[10][0]+=r,this.totalKnowledgeGenerated+=r}},update:function(t){this.backSprite.texture=this.anyoneHasWorkedHere?this.originalBackTexture:this.noLightBackTexture,this.anyoneHasWorkedHere=!1},addWindowInfoLines:function(){var t=this;ee.prototype.addWindowInfoLines.call(this),this.city.gui.windowAddInfoText(null,function(){return Tr.lo("knowledge_gathered",[0|t.totalKnowledgeGenerated])})},createMainWindowPart:function(){ee.prototype.createMainWindowPart.call(this),Rs.addSmartUpgradeForLabs(this.city)},save:function(t,e){null==e&&(e=!0),ee.prototype.save.call(this,t),e&&t.addString(fi.saveDefinition);var i=this.totalKnowledgeGenerated;if(t.size+8>t.bytes.length){var n=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+8))),t.bytes.blit(0,n,0,t.size)}t.bytes.setDouble(t.size,i),t.size+=8},load:function(t,e){ee.prototype.load.call(this,t),null==e&&(e=t.readString());var i=Dr.makeLoadMap(e,t);Object.prototype.hasOwnProperty.call(i.h,"totalKnowledgeGenerated")&&(this.totalKnowledgeGenerated=i.h.totalKnowledgeGenerated)},__class__:fi});function gi(t,e,i,n,r,s,o,a){this.mirrored=!1,re.call(this,t,e,i,n,r,s,o,a),this.doorX=4}(q["buildings.LandedExplorationShip"]=gi).__name__="buildings.LandedExplorationShip",gi.__super__=re,gi.prototype=e(re.prototype,{get_possibleUpgrades:function(){return[]},get_baseAttractiveness:function(){return 50},walkAround:function(t,e){var i=il.getInt(3),n=this.mirrored?-1:1,r=this.mirrored?20:0;if(t.relativeX*n>(r+11*n)*n&&t.setRelativeX(11),t.relativeX*n<=(r+n)*n&&t.setRelativeX(2),1==i)t.moveAndWait(il.getInt(r+4*n,r+5*n),il.getInt(30,60),null,!1,!1);else if(2==i)t.moveAndWait(il.getInt(r+9*n,r+12*n),il.getInt(30,60),null,!1,!1);else{var s=ka.pool,o=0<s[2].length?s[2].splice(s[2].length-1,1)[0]:new Int32Array(2);o[0]=8,o[1]=il.getInt(90,120),t.setPath(o,0,2,!0),t.pathEndFunction=null,t.pathOnlyRelatedTo=t.inPermanent}},postLoad:function(){this.mirrored&&(this.mirror(),this.mirrored=!0)},mirror:function(){this.mirrored=!this.mirrored,this.drawer.mirror(),this.mirrored?this.doorX=14:this.doorX=4},createWindowAddBottomButtons:function(){Io.create(this.city.gui,Uh(this,this.mirror),this.city.gui.windowInner,function(){return Tr.lo("mirror")},this.city.gui.innerWindowStage),this.city.gui.windowInner.addChild(new Ms(this.city.gui.windowInner,new vr(2,6))),re.prototype.createWindowAddBottomButtons.call(this)},addWindowInfoLines:function(){this.city.gui.windowAddInfoText(null,function(){return Tr.lo("used_as_house")}),re.prototype.addWindowInfoLines.call(this)},save:function(t,e){null==e&&(e=!0),re.prototype.save.call(this,t),e&&t.addString(gi.saveDefinition);var i=this.mirrored;if(t.size+1>t.bytes.length){var n=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+1))),t.bytes.blit(0,n,0,t.size)}t.bytes.b[t.size]=i?1:0,t.size+=1},load:function(t,e){re.prototype.load.call(this,t),null==e&&(e=t.readString());var i=Dr.makeLoadMap(e,t);Object.prototype.hasOwnProperty.call(i.h,"mirrored")&&(this.mirrored=i.h.mirrored),this.postLoad()},__class__:gi});var mi=function(t,e,i,n,r,s,o,a){this.saucerType=0,this.timesUsedStopOver=0,this.timesUsedTo=0,this.timesUsed=0,this.landingSiteGroup=0,this.currentlyLandedSaucer=null,this.hasFlyingSaucer=!0,_.call(this,t,e,i,n,r,s,o,a),n.landingSites.push(this),this.doorX=15,this.connectedWaypoint=null,this.flyingSaucerSprite=dt.makeSprite("spr_flyingsaucer"),this.flyingSaucerSprite.position.set(s.x,s.y),n.aboveCitizensInBuildingStage.addChild(this.flyingSaucerSprite)};(q["buildings.LandingSite"]=mi).__name__="buildings.LandingSite",mi.__super__=_,mi.prototype=e(_.prototype,{get_typeID:function(){return 2},get_saucherTexture:function(){switch(this.saucerType){case 0:return"spr_flyingsaucer";case 1:return"spr_flyingsaucer_alt";case 2:return"spr_flowercraft";case 3:return"spr_flyingsaucer_cube";case 4:return"spr_flyingsaucer_deepblue";case 5:return"spr_flyingsaucer_shade";default:return"spr_flyingsaucer"}},get_mainTexture:function(){switch(this.saucerType){case 0:return mi.spriteName;case 1:return"spr_landingplace_alt";case 4:return"spr_landingplace_deepblue";default:return mi.spriteName}},postLoad:function(){var t=this.get_saucherTexture();this.flyingSaucerSprite.texture=dt.getTexture(t),this.drawer.changeMainTexture(this.get_mainTexture())},positionSprites:function(){_.prototype.positionSprites.call(this),null!=this.flyingSaucerSprite&&this.flyingSaucerSprite.position.set(this.position.x,this.position.y)},update:function(t){_.prototype.update.call(this,t),0<this.timeUntilCanGetNewFlyingSaucer?this.timeUntilCanGetNewFlyingSaucer-=t:0<this.gettingNewFlyingSaucerStage&&(this.gettingNewFlyingSaucerStage-=t,this.flyingSaucerSprite.position.set(this.position.x,this.position.y-Math.max(0,.25*this.gettingNewFlyingSaucerStage)),this.flyingSaucerSprite.alpha=1-this.gettingNewFlyingSaucerStage/16,this.gettingNewFlyingSaucerStage<=0&&(this.hasFlyingSaucer=!0))},tryDestroy:function(t){return null==t&&(t=!0),"cityofthekey"!=this.city.progress.story.storyName||100!=this.position.x&&-100!=this.position.x?_.prototype.tryDestroy.call(this,t):(t&&this.city.gui.showSimpleWindow(Tr.lo("secret_society_forbidden"),null,!0,!0),!1)},destroy:function(){at.remove(this.city.landingSites,this),this.flyingSaucerSprite.destroy();for(var t=this.city.simulation.flyingSaucers.length;0<=--t;)this.city.simulation.flyingSaucers[t].destination==this&&this.city.simulation.flyingSaucers[t].cancel();_.prototype.destroy.call(this)},addFlyingSaucer:function(){this.hasFlyingSaucer||(this.hasFlyingSaucer=!0,this.flyingSaucerSprite.alpha=1,this.flyingSaucerSprite.position.set(this.position.x,this.position.y))},removeFlyingSaucer:function(){this.hasFlyingSaucer&&(this.hasFlyingSaucer=!1,this.flyingSaucerSprite.alpha=0,this.gettingNewFlyingSaucerStage=16,this.timeUntilCanGetNewFlyingSaucer=30)},estimatedFlyingDistanceTo:function(t){return(Math.abs(t.position.x-this.position.x)+Math.abs(t.position.y-this.position.y))/3},addWindowInfoLines:function(){var e=this;_.prototype.addWindowInfoLines.call(this),this.city.gui.windowAddInfoText(null,function(){var t=e.timesUsed-e.timesUsedStopOver;return Tr.lo("transported_from",[0<t?t:0])}),this.city.gui.windowAddInfoText(null,function(){return Tr.lo("transported_to",[e.timesUsedTo])}),this.city.gui.windowAddInfoText(null,function(){return Tr.lo("used_as_stopover",[e.timesUsedStopOver])})},createWindowAddBottomButtons:function(){var i=this;O.hasSecretCode("hangar")&&To.create(this.city.gui,function(){return i.saucerType},function(t){i.saucerType=t;var e=i.get_saucherTexture();i.flyingSaucerSprite.texture=dt.getTexture(e),i.drawer.changeMainTexture(i.get_mainTexture())},function(){return 6},Tr.lo("change_space_ship")),_.prototype.createWindowAddBottomButtons.call(this)},save:function(t,e){null==e&&(e=!0),_.prototype.save.call(this,t),e&&t.addString(mi.saveDefinition);var i=this.timesUsed;if(t.size+4>t.bytes.length){var n=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+4))),t.bytes.blit(0,n,0,t.size)}t.bytes.setInt32(t.size,i),t.size+=4;i=this.timesUsedTo;if(t.size+4>t.bytes.length){n=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+4))),t.bytes.blit(0,n,0,t.size)}t.bytes.setInt32(t.size,i),t.size+=4;i=this.timesUsedStopOver;if(t.size+4>t.bytes.length){n=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+4))),t.bytes.blit(0,n,0,t.size)}t.bytes.setInt32(t.size,i),t.size+=4;i=this.saucerType;if(t.size+4>t.bytes.length){n=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+4))),t.bytes.blit(0,n,0,t.size)}t.bytes.setInt32(t.size,i),t.size+=4},load:function(t,e){_.prototype.load.call(this,t),null==e&&(e=t.readString());var i=Dr.makeLoadMap(e,t);Object.prototype.hasOwnProperty.call(i.h,"timesUsed")&&(this.timesUsed=i.h.timesUsed),Object.prototype.hasOwnProperty.call(i.h,"timesUsedTo")&&(this.timesUsedTo=i.h.timesUsedTo),Object.prototype.hasOwnProperty.call(i.h,"timesUsedStopOver")&&(this.timesUsedStopOver=i.h.timesUsedStopOver),Object.prototype.hasOwnProperty.call(i.h,"saucerType")&&(this.saucerType=i.h.saucerType),this.postLoad()},__class__:mi});function yi(t,e,i,n,r,s,o,a){this.bgSpr=null,mi.call(this,t,e,i,n,r,s,o,a),this.bgSpr=dt.makeSprite("spr_landingpadtunnel_bg"),this.bgSpr.position.set(s.x,s.y),i.addChild(this.bgSpr)}(q["buildings.LandingSiteTunnel"]=yi).__name__="buildings.LandingSiteTunnel",yi.__super__=mi,yi.prototype=e(mi.prototype,{get_drawerType:function(){return Bn},get_mainTexture:function(){this.saucerType;return yi.spriteName},positionSprites:function(){mi.prototype.positionSprites.call(this),this.bgSpr.position.set(this.position.x,this.position.y)},destroy:function(){mi.prototype.destroy.call(this),null!=this.bgSpr&&(this.bgSpr.destroy(),this.bgSpr=null)},__class__:yi});var _i=function(t,e,i,n,r,s,o,a){ee.call(this,t,e,i,n,r,s,o,a),this.startTime=14,this.endTime=22,this.workTimePreferenceMod=.5,this.isEntertainment=!0};(q["buildings.Library"]=_i).__name__="buildings.Library",_i.__interfaces__=[oe],_i.__super__=ee,_i.prototype=e(ee.prototype,{get_baseEntertainmentCapacity:function(){return 0},get_isOpen:function(){if(1!=this.workers.length||0!=this.workers[0].currentAction)return!1;var t=this.city.simulation.time.timeSinceStart/60%24,e=this.startTime-this.workTimePreferenceMod;return e<22?e<=t&&t<22:e<=t||t<22},get_entertainmentType:function(){return 5},get_secondaryEntertainmentTypes:function(){return null},get_minimumNormalTimeToSpend:function(){return 2},get_maximumNormalTimeToSpend:function(){return 5},get_minimumEntertainmentGroupSatisfy:function(){return 1},get_maximumEntertainmentGroupSatisfy:function(){return 3},get_entertainmentQuality:function(){return 100},get_isOpenForExistingVisitors:function(){return this.get_isOpen()},finishEntertainment:function(t,e){return!0},get_drawerType:function(){return Rn},positionSprites:function(){ee.prototype.positionSprites.call(this)},beEntertained:function(t,e){function i(){t.relativeY<5?t.moveAndWait(il.getInt(3,7),il.getInt(30,60),null,!1,!1):t.moveAndWait(il.getInt(3,16),il.getInt(30,60),null,!1,!1)}if(1==il.getInt(2))t.changeFloor(i);else{var n=t,r=ka.pool,s=0<r[2].length?r[2].splice(r[2].length-1,1)[0]:new Int32Array(2);s[0]=8,s[1]=il.getInt(120,180),n.setPath(s,0,2,!0),t.pathEndFunction=i,t.pathOnlyRelatedTo=t.inPermanent}t.hasBuildingInited||(t.educationLevel=Math.max(Math.min(t.educationLevel+.025,1.5),t.educationLevel),t.hasBuildingInited=!0)},work:function(t,e,i){if(i&&22<this.city.simulation.time.timeSinceStart/60%24)t.currentAction=2;else{var n=t.pathWalkSpeed*e;if(K.shouldUpdateDraw=!0,Math.abs(12-t.relativeX)<n)t.relativeX=12;else{var r=12-t.relativeX;t.relativeX+=(0<r?1:r<0?-1:0)*n}}},save:function(t,e){null==e&&(e=!0),ee.prototype.save.call(this,t),e&&t.addString(_i.saveDefinition)},load:function(t,e){ee.prototype.load.call(this,t),null==e&&(e=t.readString());Dr.makeLoadMap(e,t)},__class__:_i});var vi=function(t,e,i,n,r,s,o,a){this.totalKnowledgeGenerated=0,ce.call(this,t,e,i,n,r,s,o,a)};(q["buildings.LivingResearchCenter"]=vi).__name__="buildings.LivingResearchCenter",vi.__super__=ce,vi.prototype=e(ce.prototype,{get_possibleCityUpgrades:function(){return[cr,ar,or,sr,ir,lr]},walkAround:function(t,e){var i=il.getInt(3);if(t.relativeY<5)t.changeFloorAndWaitRandom(30,60);else if(1==i)0==il.getInt(2)?t.moveAndWait(il.getInt(3,7),il.getInt(30,60),null,!1,!1):t.moveAndWait(il.getInt(12,16),il.getInt(30,60),null,!1,!1);else{var n=ka.pool,r=0<n[2].length?n[2].splice(n[2].length-1,1)[0]:new Int32Array(2);r[0]=8,r[1]=il.getInt(90,120),t.setPath(r,0,2,!0),t.pathEndFunction=null,t.pathOnlyRelatedTo=t.inPermanent}},work:function(t,e,i){if(i)t.currentAction=2;else{if(t.relativeY<2)if(0==il.getInt(2))null==(r=!0)&&(r=!1),null==(n=!1)&&(n=!1),t.moveAndWait(il.getInt(3,6),il.getInt(60,120),null,n,r);else null==(r=!0)&&(r=!1),null==(n=!1)&&(n=!1),t.moveAndWait(il.getInt(13,14),il.getInt(60,120),null,n,r);else if(0==il.getInt(2)){var n,r;null==(r=!0)&&(r=!1),null==(n=!1)&&(n=!1),t.moveAndWait(il.getInt(3,15),il.getInt(60,120),null,n,r)}var s=.10799999999999998*t.get_educationSpeedModifier()*this.city.simulation.boostManager.currentGlobalBoostAmount;this.city.materials.knowledge+=s,this.city.simulation.stats.materialProduction[10][0]+=s,this.totalKnowledgeGenerated+=s}},addWindowInfoLines:function(){var t=this;ce.prototype.addWindowInfoLines.call(this),this.city.gui.windowAddInfoText(null,function(){return Tr.lo("knowledge_gathered",[0|t.totalKnowledgeGenerated])})},createMainWindowPart:function(){var t=this;ce.prototype.createMainWindowPart.call(this);var e=null;e=function(){t.city.gui.createWindow(t),Js.create(t.city,t.city.gui,t.city.gui.innerWindowStage,t.city.gui.windowInner),t.city.gui.addWindowToStack(e)};var i=new us(this.city.gui,this.city.gui.innerWindowStage,this.city.gui.windowInner,e),n=this.city.game.isMobile?3:0;i.container.padding.top=3+n,i.container.padding.left=3,i.container.padding.right=3,i.container.padding.bottom=n,i.container.fillSecondarySize=!0,i.container.addChild(new ao(i,this.city.gui.innerWindowStage,Tr.lo("upgrade_basic_houses"))),this.city.gui.windowInner.addChild(i),this.city.gui.windowInner.addChild(new Ms(this.city.gui.windowInner,new vr(2,6)))},save:function(t,e){null==e&&(e=!0),ce.prototype.save.call(this,t),e&&t.addString(vi.saveDefinition);var i=this.totalKnowledgeGenerated;if(t.size+8>t.bytes.length){var n=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+8))),t.bytes.blit(0,n,0,t.size)}t.bytes.setDouble(t.size,i),t.size+=8},load:function(t,e){ce.prototype.load.call(this,t),null==e&&(e=t.readString());var i=Dr.makeLoadMap(e,t);Object.prototype.hasOwnProperty.call(i.h,"totalKnowledgeGenerated")&&(this.totalKnowledgeGenerated=i.h.totalKnowledgeGenerated)},__class__:vi});function bi(t,e,i,n,r,s,o,a){this.interior=0,this.mirrored=!1,re.call(this,t,e,i,n,r,s,o,a),this.doorX=14,this.interiorSprites=dt.getTexturesByWidth("spr_loft_furnishings",20),this.interior=il.getInt(this.interiorSprites.length),this.isEntertainment=!0}(q["buildings.Loft"]=bi).__name__="buildings.Loft",bi.__interfaces__=[oe],bi.__super__=re,bi.prototype=e(re.prototype,{get_possibleUpgrades:function(){return[jt]},get_baseAttractiveness:function(){return 88},get_drawerType:function(){return Nn},get_customizableDrawer:function(){return this.drawer},get_baseEntertainmentCapacity:function(){return 5*this.residents.length},get_isOpen:function(){return!1},get_entertainmentType:function(){return 2},get_secondaryEntertainmentTypes:function(){return null},get_minimumNormalTimeToSpend:function(){return 1},get_maximumNormalTimeToSpend:function(){return 2},get_minimumEntertainmentGroupSatisfy:function(){return 1},get_maximumEntertainmentGroupSatisfy:function(){return 1.5},get_entertainmentQuality:function(){return 100},get_isOpenForExistingVisitors:function(){return!1},finishEntertainment:function(t,e){return!0},postLoad:function(){this.mirrored&&(this.mirror(),this.mirrored=!0)},postCreate:function(){re.prototype.postCreate.call(this),this.get_customizableDrawer().setCustomTextures(null,null,this.interiorSprites[this.interior])},beEntertained:function(t,e){var i=!1,n=!0;null==n&&(n=!1),null==i&&(i=!1),t.moveAndWait(il.getInt(3,16),il.getInt(200,240),null,i,n)},mirror:function(){this.mirrored=!this.mirrored,this.drawer.mirror(),this.mirrored?this.doorX=4:this.doorX=14},walkAround:function(t,e){this.mirrored?t.relativeY<5&&(5<=t.relativeX||il.getFloat()<.5)&&t.moveAndWait(il.getInt(3,16),il.getInt(60,90),null,!1,!1):t.relativeY<5&&(t.relativeX<14||il.getFloat()<.5)&&t.moveAndWait(il.getInt(3,16),il.getInt(60,90),null,!1,!1)},createWindowAddBottomButtons:function(){var e=this;Io.create(this.city.gui,Uh(this,this.mirror),this.city.gui.windowInner,function(){return Tr.lo("mirror")},this.city.gui.innerWindowStage),this.city.gui.windowInner.addChild(new Ms(this.city.gui.windowInner,new vr(2,6))),To.create(this.city.gui,function(){return e.interior},function(t){e.interior=t,e.get_customizableDrawer().setCustomTextures(null,null,e.interiorSprites[e.interior])},function(){return e.interiorSprites.length},Tr.lo("change_interior")),re.prototype.createWindowAddBottomButtons.call(this)},save:function(t,e){null==e&&(e=!0),re.prototype.save.call(this,t),e&&t.addString(bi.saveDefinition);var i=this.mirrored;if(t.size+1>t.bytes.length){var n=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+1))),t.bytes.blit(0,n,0,t.size)}t.bytes.b[t.size]=i?1:0,t.size+=1;i=this.interior;if(t.size+4>t.bytes.length){n=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+4))),t.bytes.blit(0,n,0,t.size)}t.bytes.setInt32(t.size,i),t.size+=4},load:function(t,e){re.prototype.load.call(this,t),null==e&&(e=t.readString());var i=Dr.makeLoadMap(e,t);Object.prototype.hasOwnProperty.call(i.h,"mirrored")&&(this.mirrored=i.h.mirrored),Object.prototype.hasOwnProperty.call(i.h,"interior")&&(this.interior=i.h.interior),this.postLoad()},__class__:bi});function wi(t,e,i,n,r,s,o,a){ee.call(this,t,e,i,n,r,s,o,a),this.startTime=16,this.endTime=1,this.workTimePreferenceMod=.5,this.isEntertainment=!0}(q["buildings.LuxuryRestaurant"]=wi).__name__="buildings.LuxuryRestaurant",wi.__interfaces__=[oe],wi.__super__=ee,wi.prototype=e(ee.prototype,{get_baseEntertainmentCapacity:function(){var t=25;return t+=this.getEffectsOfAdjecentBuildingsLR("restaurantCapBoost"),this.workers.length*t|0},get_isOpen:function(){if(1<=this.workers.length&&0==this.workers[0].currentAction){var t=this.city.simulation.time.timeSinceStart/60%24,e=this.startTime-this.workTimePreferenceMod;return e<.5?e<=t&&t<.5:e<=t||t<.5}return!1},get_entertainmentType:function(){return 1},get_secondaryEntertainmentTypes:function(){return null},get_minimumNormalTimeToSpend:function(){return 2},get_maximumNormalTimeToSpend:function(){return 4},get_minimumEntertainmentGroupSatisfy:function(){return 2},get_maximumEntertainmentGroupSatisfy:function(){return 4},get_entertainmentQuality:function(){return 100},get_isOpenForExistingVisitors:function(){return this.get_isOpen()},finishEntertainment:function(t,e){return!0},beEntertained:function(n,t){if(n.hasBuildingInited){o=n;(r=0<(i=ka.pool)[2].length?i[2].splice(i[2].length-1,1)[0]:new Int32Array(2))[0]=8,r[1]=il.getInt(30,60),o.setPath(r,0,2,!0),n.pathEndFunction=null,n.pathOnlyRelatedTo=n.inPermanent}else{null!=this.leftBuilding&&this.leftBuilding.is(Wi),null!=this.rightBuilding&&this.rightBuilding.is(Wi);var e=function(){switch(il.getInt(2)){case 0:var t=n;(i=0<(e=ka.pool)[2].length?e[2].splice(e[2].length-1,1)[0]:new Int32Array(2))[0]=4,i[1]=4,t.setPath(i,0,2,!0),n.pathEndFunction=null,n.pathOnlyRelatedTo=n.inPermanent;break;case 1:var e,i;t=n;(i=0<(e=ka.pool)[2].length?e[2].splice(e[2].length-1,1)[0]:new Int32Array(2))[0]=4,i[1]=14,t.setPath(i,0,2,!0),n.pathEndFunction=null,n.pathOnlyRelatedTo=n.inPermanent}};if(n.wantsNightEntertainmentIn=il.getInt(1,5),n.hasBuildingInited=!0,n.relativeY<=5)if(0==il.getInt(3)){var i,r,s=il.getInt(4,6),o=n;(r=0<(i=ka.pool)[2].length?i[2].splice(i[2].length-1,1)[0]:new Int32Array(2))[0]=4,r[1]=s,o.setPath(r,0,2,!0),n.pathEndFunction=null,n.pathOnlyRelatedTo=n.inPermanent}else n.changeFloor(e);else e()}},work:function(t,e,i){if(i&&.5<this.city.simulation.time.timeSinceStart/60%24)t.currentAction=2;else switch(this.workers.indexOf(t)){case 0:if(5<t.relativeY)t.changeFloor();else{var n=t.pathWalkSpeed*e;if(K.shouldUpdateDraw=!0,Math.abs(12-t.relativeX)<n)t.relativeX=12;else{var r=12-t.relativeX;t.relativeX+=(0<r?1:r<0?-1:0)*n}}break;case 1:if(t.relativeY<5)t.changeFloor();else{t.moveAndWait(il.getInt(3,16),il.getInt(60,90),null,!1,!1)}}},__class__:wi});function Si(t,e,i,n,r,s,o,a){this.materialsMadePerStepPerWorker=.0015,Pe.call(this,t,e,i,n,r,s,o,a,"spr_machinepartsfactory_frames","spr_machinepartsfactory_idle")}(q["buildings.MachinePartsFactory"]=Si).__name__="buildings.MachinePartsFactory",Si.__super__=Pe,Si.prototype=e(Pe.prototype,{get_normalEfficiency:function(){return 3},get_walkThroughCanViewSelfInThisBuilding:function(){return!1},get_possibleUpgrades:function(){return[Tt]},get_possibleBuildingModes:function(){return[ft,It,qt]},get_materialFrom:function(){return this.city.materials.stone},set_materialFrom:function(t){var e=this.city.materials.stone-t;return this.city.materials.stone-=e,this.city.simulation.stats.materialUsed[2][0]+=e,this.city.materials.stone},get_materialTo:function(){return this.city.materials.machineParts},set_materialTo:function(t){var e=t-this.city.materials.machineParts;return this.city.materials.machineParts+=e,this.city.simulation.stats.materialProduction[3][0]+=e,this.city.materials.machineParts},get_bonusSpeed:function(){return this.city.simulation.bonuses.machinePartsFactorySpeed},onBuild:function(){Pe.prototype.onBuild.call(this),this.city.progress.unlocks.unlock(Ti)},workAnimation:function(t,e){10!=t.relativeY&&(0==this.workers.indexOf(t)?t.setRelativePos(12,10):t.setRelativePos(15,10))},addWindowInfoLines:function(){var t=this;Pe.prototype.addWindowInfoLines.call(this),this.city.gui.windowAddInfoText(null,function(){return(0|t.totalMaterialUsed)+" stone used to make "+(0|t.materialMade)+" machine parts."})},save:function(t,e){null==e&&(e=!0),Pe.prototype.save.call(this,t),e&&t.addString(Si.saveDefinition)},load:function(t,e){Pe.prototype.load.call(this,t),null==e&&(e=t.readString());Dr.makeLoadMap(e,t)},__class__:Si});function xi(t,e,i,n,r,s,o,a){this.teleportX=14,this.currentAdjBonus=0,this.timesUsedTo=0,this.timesUsed=0,re.call(this,t,e,i,n,r,s,o,a),this.yearsToLiveLongerPerYearIfLivingHere=.025}(q["buildings.Mansion"]=xi).__name__="buildings.Mansion",xi.__super__=re,xi.prototype=e(re.prototype,{get_hasPrivateTeleporter:function(){return!0},get_possibleUpgrades:function(){return[]},walkAround:function(t,e){t.hasBuildingInited||(t.educationLevel=Math.max(Math.min(t.educationLevel+.01,1.25),t.educationLevel),t.hasBuildingInited=!0);var i=il.getInt(3);if(0==i&&120<e)if(t.relativeX<5){var n=t;(s=0<(r=ka.pool)[2].length?r[2].splice(r[2].length-1,1)[0]:new Int32Array(2))[0]=4,s[1]=5,n.setPath(s,0,2,!0),t.pathEndFunction=function(){t.changeFloorAndWaitRandom(30,60)},t.pathOnlyRelatedTo=t.inPermanent}else t.changeFloorAndWaitRandom(30,60);else if(1==i||e<=10&&t.relativeX<this.teleportX+.5)t.relativeY<5?t.moveAndWait(il.getInt(3,9),il.getInt(30,60),null,!1,!1):t.moveAndWait(il.getInt(3,16),il.getInt(30,60),null,!1,!1);else{var r,s;n=t;(s=0<(r=ka.pool)[2].length?r[2].splice(r[2].length-1,1)[0]:new Int32Array(2))[0]=8,s[1]=il.getInt(90,120),n.setPath(s,0,2,!0),t.pathEndFunction=null,t.pathOnlyRelatedTo=t.inPermanent}},addWindowInfoLines:function(){var t=this;re.prototype.addWindowInfoLines.call(this),this.city.gui.windowAddInfoText(null,function(){return Tr.lo("teleported_from",[t.timesUsed])}),this.city.gui.windowAddInfoText(null,function(){return Tr.lo("teleported_to",[t.timesUsedTo])}),dn.createUpkeepInfo(this.city,this.city.gui)},createTeleportParticle:function(t){null==t&&(t="unused"),this.city.particles.addParticle(dt.getTexturesByWidth("spr_smallteleporter_ray",3),new vr(this.position.x+this.teleportX,this.position.y+12))},onCityChange:function(){if(null==this.leftBuilding||!this.leftBuilding.is(xi))for(var t=this,e=!1;null!=t&&t.is(xi);){if(e)t.drawer.changeMainTexture("spr_mansion_right"),e=!1,t.bonusAttractiveness=25;else{var i=null!=t.rightBuilding&&t.rightBuilding.is(xi);t.drawer.changeMainTexture(i?"spr_mansion_left":"spr_mansion"),e=!0,t.bonusAttractiveness=i?25:0}t=t.rightBuilding}},save:function(t,e){null==e&&(e=!0),re.prototype.save.call(this,t),e&&t.addString(xi.saveDefinition);var i=this.timesUsed;if(t.size+4>t.bytes.length){var n=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+4))),t.bytes.blit(0,n,0,t.size)}t.bytes.setInt32(t.size,i),t.size+=4;i=this.timesUsedTo;if(t.size+4>t.bytes.length){n=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+4))),t.bytes.blit(0,n,0,t.size)}t.bytes.setInt32(t.size,i),t.size+=4},load:function(t,e){re.prototype.load.call(this,t),null==e&&(e=t.readString());var i=Dr.makeLoadMap(e,t);Object.prototype.hasOwnProperty.call(i.h,"timesUsed")&&(this.timesUsed=i.h.timesUsed),Object.prototype.hasOwnProperty.call(i.h,"timesUsedTo")&&(this.timesUsedTo=i.h.timesUsedTo)},__class__:xi});var Ti=function(t,e,i,n,r,s,o,a){this.hasHeatedBed=!1,this.movementType=0,this.bgSprite2=null,this.currentAdjBonus=0,re.call(this,t,e,i,n,r,s,o,a)};(q["buildings.MechanicalHouse"]=Ti).__name__="buildings.MechanicalHouse",Ti.__super__=re,Ti.prototype=e(re.prototype,{get_possibleUpgrades:function(){return[vt]},destroy:function(){re.prototype.destroy.call(this),null!=this.spriteOverMachinePartsFactory&&this.spriteOverMachinePartsFactory.destroy(),null!=this.bgSprite&&this.bgSprite.destroy(),null!=this.bgSprite2&&this.bgSprite2.destroy(),this.spriteOverMachinePartsFactory=null,this.bgSprite=null},update:function(t){null!=this.bgSprite&&(this.bgTexture+=.25*t,this.bgTexture>=this.bgTextures.length&&(this.bgTexture=0),this.bgSprite.texture=this.bgTextures[0|this.bgTexture])},walkAround:function(t,e){if(0==this.movementType)re.prototype.walkAround.call(this,t,e);else if(1==this.movementType){if(0==(i=il.getInt(4))&&120<e&&t.relativeX<11)t.changeFloorAndWaitRandom(30,60);else if(1==i)t.moveAndWait(il.getInt(3,7),il.getInt(30,60),null,!1,!1);else if(2==i&&t.relativeY<5)t.moveAndWait(il.getInt(12,16),il.getInt(30,60),null,!1,!1);else{(r=0<(n=ka.pool)[2].length?n[2].splice(n[2].length-1,1)[0]:new Int32Array(2))[0]=8,r[1]=il.getInt(90,120),t.setPath(r,0,2,!0),t.pathEndFunction=null,t.pathOnlyRelatedTo=t.inPermanent}}else if(2==this.movementType){if(0==(i=il.getInt(4))&&120<e&&11<t.relativeX)t.changeFloorAndWaitRandom(30,60);else if(i<=2&&t.relativeY<5)t.moveAndWait(il.getInt(7,16),il.getInt(30,60),null,!1,!1);else if(i<=2)t.moveAndWait(il.getInt(12,16),il.getInt(30,60),null,!1,!1);else{(r=0<(n=ka.pool)[2].length?n[2].splice(n[2].length-1,1)[0]:new Int32Array(2))[0]=8,r[1]=il.getInt(90,120),t.setPath(r,0,2,!0),t.pathEndFunction=null,t.pathOnlyRelatedTo=t.inPermanent}}else if(3==this.movementType){var i;if(0==(i=il.getInt(4))&&120<e&&11<t.relativeX)t.changeFloorAndWaitRandom(30,60);else if((1==i||2==i)&&t.relativeY<5)t.moveAndWait(il.getInt(7,16),il.getInt(30,60),null,!1,!1);else if(2==i)t.moveAndWait(il.getInt(12,16),il.getInt(30,60),null,!1,!1);else{var n,r;(r=0<(n=ka.pool)[2].length?n[2].splice(n[2].length-1,1)[0]:new Int32Array(2))[0]=8,r[1]=il.getInt(90,120),t.setPath(r,0,2,!0),t.pathEndFunction=null,t.pathOnlyRelatedTo=t.inPermanent}}},onCityChange:function(){var t=this,e=0;this.movementType=0,null!=this.rightBuilding&&this.rightBuilding.is(Si)?(null!=this.leftBuilding&&this.leftBuilding.is(Si)?(e=50,this.drawer.changeMainTexture("spr_mechanicalhouse_leftright"),null==t.spriteOverMachinePartsFactory&&(t.spriteOverMachinePartsFactory=new PIXI.Sprite,t.city.justAboveCityStage.addChild(t.spriteOverMachinePartsFactory)),null==t.bgSprite&&(t.bgSprite=new PIXI.Sprite,t.bgStage.addChild(t.bgSprite)),null!=t.bgSprite2&&t.bgSprite2.destroy(),t.hasHeatedBed&&(t.bgSprite2=new PIXI.Sprite(dt.getTexture("spr_mechanicalhouse_heatedbed")),t.bgStage.addChild(t.bgSprite2)),t.bgSprite.position.set(t.position.x,t.position.y),this.bgTextures=dt.getTexturesByWidth("spr_mechanicalhouse_leftright_bganim",20),this.spriteOverMachinePartsFactory.texture=dt.getTexture(null==this.leftBuilding.bottomBuilding?"spr_mechanicalhouse_pipe_h3_bf":"spr_mechanicalhouse_pipe_h3"),this.spriteOverMachinePartsFactory.position.set(this.position.x-3,this.position.y)):(e=50,this.drawer.changeMainTexture("spr_mechanicalhouse_left"),null==t.spriteOverMachinePartsFactory&&(t.spriteOverMachinePartsFactory=new PIXI.Sprite,t.city.justAboveCityStage.addChild(t.spriteOverMachinePartsFactory)),null==t.bgSprite&&(t.bgSprite=new PIXI.Sprite,t.bgStage.addChild(t.bgSprite)),null!=t.bgSprite2&&t.bgSprite2.destroy(),t.hasHeatedBed&&(t.bgSprite2=new PIXI.Sprite(dt.getTexture("spr_mechanicalhouse_heatedbed")),t.bgStage.addChild(t.bgSprite2)),t.bgSprite.position.set(t.position.x,t.position.y),this.bgTextures=dt.getTexturesByWidth("spr_mechanicalhouse_left_bganim",20),this.spriteOverMachinePartsFactory.texture=dt.getTexture("spr_mechanicalhouse_pipe_h"),this.spriteOverMachinePartsFactory.position.set(this.position.x+20,this.position.y+4)),this.bgTexture=this.rightBuilding.bgTexture%this.bgTextures.length,this.movementType=1):null!=this.bottomBuilding&&this.bottomBuilding.is(Si)?(e=50,this.drawer.changeMainTexture("spr_mechanicalhouse_top"),null==t.spriteOverMachinePartsFactory&&(t.spriteOverMachinePartsFactory=new PIXI.Sprite,t.city.justAboveCityStage.addChild(t.spriteOverMachinePartsFactory)),null==t.bgSprite&&(t.bgSprite=new PIXI.Sprite,t.bgStage.addChild(t.bgSprite)),null!=t.bgSprite2&&t.bgSprite2.destroy(),t.hasHeatedBed&&(t.bgSprite2=new PIXI.Sprite(dt.getTexture("spr_mechanicalhouse_heatedbed")),t.bgStage.addChild(t.bgSprite2)),t.bgSprite.position.set(t.position.x,t.position.y),this.bgTextures=dt.getTexturesByWidth("spr_mechanicalhouse_top_bganim",20),null!=this.topBuilding&&this.topBuilding.is(Si)?(this.spriteOverMachinePartsFactory.texture=dt.getTexture("spr_mechanicalhouse_pipe_v3"),this.spriteOverMachinePartsFactory.position.set(this.position.x+1,this.position.y-3)):(this.spriteOverMachinePartsFactory.texture=dt.getTexture("spr_mechanicalhouse_pipe_v1"),this.spriteOverMachinePartsFactory.position.set(this.position.x+1,this.position.y+20)),this.bgTexture=this.bottomBuilding.bgTexture%this.bgTextures.length,this.movementType=2):null!=this.leftBuilding&&this.leftBuilding.is(Si)?(e=50,this.drawer.changeMainTexture("spr_mechanicalhouse_right"),null==t.spriteOverMachinePartsFactory&&(t.spriteOverMachinePartsFactory=new PIXI.Sprite,t.city.justAboveCityStage.addChild(t.spriteOverMachinePartsFactory)),null==t.bgSprite&&(t.bgSprite=new PIXI.Sprite,t.bgStage.addChild(t.bgSprite)),null!=t.bgSprite2&&t.bgSprite2.destroy(),t.hasHeatedBed&&(t.bgSprite2=new PIXI.Sprite(dt.getTexture("spr_mechanicalhouse_heatedbed")),t.bgStage.addChild(t.bgSprite2)),t.bgSprite.position.set(t.position.x,t.position.y),this.bgTextures=dt.getTexturesByWidth("spr_mechanicalhouse_right_bganim",20),this.spriteOverMachinePartsFactory.texture=dt.getTexture(null==this.leftBuilding.bottomBuilding?"spr_mechanicalhouse_pipe_h2_bf":"spr_mechanicalhouse_pipe_h2"),this.spriteOverMachinePartsFactory.position.set(this.position.x-3,this.position.y+11-(null==this.leftBuilding.bottomBuilding?6:0)),this.bgTexture=this.leftBuilding.bgTexture%this.bgTextures.length):null!=this.topBuilding&&this.topBuilding.is(Si)?(e=50,this.drawer.changeMainTexture("spr_mechanicalhouse_bottom"),null==t.spriteOverMachinePartsFactory&&(t.spriteOverMachinePartsFactory=new PIXI.Sprite,t.city.justAboveCityStage.addChild(t.spriteOverMachinePartsFactory)),null==t.bgSprite&&(t.bgSprite=new PIXI.Sprite,t.bgStage.addChild(t.bgSprite)),null!=t.bgSprite2&&t.bgSprite2.destroy(),t.hasHeatedBed&&(t.bgSprite2=new PIXI.Sprite(dt.getTexture("spr_mechanicalhouse_heatedbed")),t.bgStage.addChild(t.bgSprite2)),t.bgSprite.position.set(t.position.x,t.position.y),this.bgTextures=dt.getTexturesByWidth("spr_mechanicalhouse_bottom_bganim",20),this.spriteOverMachinePartsFactory.texture=dt.getTexture("spr_mechanicalhouse_pipe_v2"),this.spriteOverMachinePartsFactory.position.set(this.position.x+3,this.position.y-3),this.bgTexture=this.topBuilding.bgTexture%this.bgTextures.length,this.movementType=3):(this.drawer.changeMainTexture("spr_mechanicalhouse"),null!=this.spriteOverMachinePartsFactory&&(this.spriteOverMachinePartsFactory.destroy(),this.spriteOverMachinePartsFactory=null),null!=this.bgSprite&&(this.bgSprite.destroy(),this.bgSprite=null),this.hasHeatedBed&&null==this.bgSprite2&&(this.bgSprite2=new PIXI.Sprite(dt.getTexture("spr_mechanicalhouse_heatedbed")),this.bgStage.addChild(this.bgSprite2))),null!=this.bgSprite2&&this.bgSprite2.position.set(this.position.x,this.position.y),null!=this.bgSprite&&(this.bgSprite.texture=this.bgTextures[0|this.bgTexture]),this.bonusAttractiveness+=e-this.currentAdjBonus,e!=(0|this.currentAdjBonus)&&(this.city.simulation.houseAssigner.shouldUpdateHouses=!0),this.currentAdjBonus=0|e},__class__:Ti});var Ii=function(t,e,i,n,r,s,o,a){this.extraCapacity=0,this.extraQuality=0,this.medicalEducationPart=0,ee.call(this,t,e,i,n,r,s,o,a),this.isMedical=!0};(q["buildings.MedicalClinic"]=Ii).__name__="buildings.MedicalClinic",Ii.__interfaces__=[ei],Ii.__super__=ee,Ii.prototype=e(ee.prototype,{get_medicalQuality:function(){return 50+.25*this.city.simulation.happiness.schoolHappiness*this.medicalEducationPart+this.extraQuality},get_medicalCapacity:function(){return(50+this.extraCapacity)*(0==this.workers.length?0:gr.sum(this.workers,function(t){return t.get_educationSpeedModifier()}))},get_possibleUpgrades:function(){return[Pt,D]},get_possibleCityUpgrades:function(){return[Vn]},get_medicalTypeLimit:function(){return 1},get_medicalTypeID:function(){return 0},work:function(t,e,i){if(i)t.currentAction=2;else if(t.relativeY<5&&1==this.workers.indexOf(t))t.changeFloor();else{var n=t.relativeY<5?5:3,r=t.pathWalkSpeed*e;if(K.shouldUpdateDraw=!0,Math.abs(n-t.relativeX)<r)t.relativeX=n;else{var s=n-t.relativeX;t.relativeX+=(0<s?1:s<0?-1:0)*r}}},addWindowInfoLines:function(){var t=this;ee.prototype.addWindowInfoLines.call(this),this.city.gui.windowAddInfoText(null,function(){return Tr.lo("capacity",[Math.floor(t.get_medicalCapacity())])}),this.city.gui.windowAddInfoText(null,function(){return Tr.lo("quality",[Math.floor(t.get_medicalQuality())])})},createMainWindowPart:function(){var e=this;ee.prototype.createMainWindowPart.call(this);var i=new ps(this.city.gui,this.city.gui.innerWindowStage,this.city.gui.windowInner);this.city.gui.windowInner.addChild(i);function t(){i.padding.bottom=6;var t=null;t=function(){e.city.gui.createWindow("birthControlWindow"),e.city.gui.addWindowToStack(t),ts.create(e.city,e.city.gui,e.city.gui.innerWindowStage,e.city.gui.windowInner),e.city.gui.setWindowReload(t)},i.addChild(new oo(e.city.gui,e.city.gui.innerWindowStage,i,t,Tr.lo("manage_birth_control")))}if(this.city.upgrades.vars.hasBirthControl)t();else{var n=!0;i.onUpdate=function(){n&&e.city.upgrades.vars.hasBirthControl&&(n=!1,t())}}},__class__:Ii});var Pi=T["buildings.MisdirectorMode"]={__ename__:"buildings.MisdirectorMode",__constructs__:["Normal","Disabled","Always","MostlyDisabled"],Normal:{_hx_index:0,__enum__:"buildings.MisdirectorMode",toString:i},Disabled:{_hx_index:1,__enum__:"buildings.MisdirectorMode",toString:i},Always:{_hx_index:2,__enum__:"buildings.MisdirectorMode",toString:i},MostlyDisabled:{_hx_index:3,__enum__:"buildings.MisdirectorMode",toString:i}},Ci=function(t,e,i,n,r,s,o,a){this.mode=Pi.Normal,this.teleportX=9,this.timesUsedTo=0,this.knowledgeGenerated=0,_.call(this,t,e,i,n,r,s,o,a),this.doorX=12,n.misdirector=this};(q["buildings.Misdirector"]=Ci).__name__="buildings.Misdirector",Ci.__super__=_,Ci.prototype=e(_.prototype,{get_misdirectChance:function(){switch(this.mode._hx_index){case 0:return.025;case 1:return 0;case 2:return 1;case 3:return.001}},onBuild:function(){_.prototype.onBuild.call(this),dr.achieve("BUILD_MISDIRECTOR")},get_possibleBuildingModes:function(){return[Rt,At,Bt,Mt]},giveReward:function(){var t=this.mode==Pi.Always?.05:.5;this.city.materials.knowledge+=t,this.city.simulation.stats.materialProduction[10][0]+=t,this.knowledgeGenerated+=t},destroy:function(){_.prototype.destroy.call(this),this.city.misdirector=null},addWindowInfoLines:function(){var t=this;_.prototype.addWindowInfoLines.call(this),this.city.gui.windowAddInfoText(null,function(){return Tr.lo("misdirected",[t.timesUsedTo])}),this.city.gui.windowAddInfoText(null,function(){return Tr.lo("knowledge_generated",[Math.floor(t.knowledgeGenerated)])})},createTeleportParticle:function(t){null==t&&(t="spr_teleporter_ray_misdirect"),this.city.particles.addParticle(dt.getTexturesByWidth(t,4),new vr(this.position.x+8,this.position.y+4))},save:function(t,e){null==e&&(e=!0),_.prototype.save.call(this,t),e&&t.addString(Ci.saveDefinition);var i=this.knowledgeGenerated;if(t.size+8>t.bytes.length){var n=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+8))),t.bytes.blit(0,n,0,t.size)}t.bytes.setDouble(t.size,i),t.size+=8;i=this.timesUsedTo;if(t.size+4>t.bytes.length){n=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+4))),t.bytes.blit(0,n,0,t.size)}t.bytes.setInt32(t.size,i),t.size+=4},load:function(t,e){_.prototype.load.call(this,t),null==e&&(e=t.readString());var i=Dr.makeLoadMap(e,t);Object.prototype.hasOwnProperty.call(i.h,"knowledgeGenerated")&&(this.knowledgeGenerated=i.h.knowledgeGenerated),Object.prototype.hasOwnProperty.call(i.h,"timesUsedTo")&&(this.timesUsedTo=i.h.timesUsedTo)},__class__:Ci});var Ei=function(t,e,i,n,r,s,o,a){this.artSprite=null,ee.call(this,t,e,i,n,r,s,o,a),this.startTime=9,this.endTime=22,this.workTimePreferenceMod=.1,this.isEntertainment=!0,this.artTextures=dt.getTexturesByWidth("spr_modernart",20),this.currentTexture=il.getInt(n.progress.unlocks.numberOfModernArtMuseumArtworksUnlocked),this.artSprite=new PIXI.Sprite(this.artTextures[this.currentTexture]),this.artSprite.position.set(s.x,s.y),i.addChild(this.artSprite)};(q["buildings.ModernArtMuseum"]=Ei).__name__="buildings.ModernArtMuseum",Ei.__interfaces__=[oe],Ei.__super__=ee,Ei.prototype=e(ee.prototype,{get_baseEntertainmentCapacity:function(){return 100*this.workers.length},get_isOpen:function(){return 1==this.workers.length&&0==this.workers[0].currentAction&&this.city.simulation.time.timeSinceStart/60%24<21.5},get_entertainmentType:function(){return 2},get_secondaryEntertainmentTypes:function(){return null},get_minimumNormalTimeToSpend:function(){return 2},get_maximumNormalTimeToSpend:function(){return 3},get_minimumEntertainmentGroupSatisfy:function(){return 2},get_maximumEntertainmentGroupSatisfy:function(){return 3},get_entertainmentQuality:function(){return 100},get_isOpenForExistingVisitors:function(){return this.get_isOpen()},finishEntertainment:function(t,e){return!0},onBuild:function(){this.city.progress.unlocks.unlock(de)},postLoad:function(){this.artSprite.texture=this.artTextures[this.currentTexture]},positionSprites:function(){ee.prototype.positionSprites.call(this),null!=this.artSprite&&this.artSprite.position.set(this.position.x,this.position.y)},destroy:function(){ee.prototype.destroy.call(this),this.artSprite.destroy()},beEntertained:function(i,t){function e(){var t=!1,e=!0;null==e&&(e=!1),null==t&&(t=!1),i.moveAndWait(il.getInt(3,16),il.getInt(100,120),null,t,e)}i.relativeY<5?i.changeFloor(e):e()},createWindowAddBottomButtons:function(){var e=this;To.create(this.city.gui,function(){return e.currentTexture},function(t){e.currentTexture=t,e.artSprite.texture=e.artTextures[e.currentTexture]},function(){return e.city.progress.unlocks.numberOfModernArtMuseumArtworksUnlocked},Tr.lo("change_exhibition")),ee.prototype.createWindowAddBottomButtons.call(this)},work:function(s,t,e){if(e)s.currentAction=2;else if(4<=s.relativeX&&s.relativeX<6)if(0==il.getInt(10))s.changeFloorAndWaitRandom(30,60,function(){var t=!0;null==t&&(t=!1);var e=il.getInt(14,15);if(t){var i=s;(r=0<(n=ka.pool)[4].length?n[4].splice(n[4].length-1,1)[0]:new Int32Array(4))[0]=12,r[1]=50,r[2]=4,r[3]=e,i.setPath(r,0,4,!0)}else{var n,r;i=s;(r=0<(n=ka.pool)[2].length?n[2].splice(n[2].length-1,1)[0]:new Int32Array(2))[0]=4,r[1]=e,i.setPath(r,0,2,!0)}s.pathEndFunction=function(){var t=s,e=ka.pool,i=0<e[2].length?e[2].splice(e[2].length-1,1)[0]:new Int32Array(2);i[0]=8,i[1]=il.getInt(30,60),t.setPath(i,0,2,!0),s.pathEndFunction=function(){var t=!0;null==t&&(t=!1);var e=il.getInt(4,6);if(t){var i=s;(r=0<(n=ka.pool)[4].length?n[4].splice(n[4].length-1,1)[0]:new Int32Array(4))[0]=12,r[1]=50,r[2]=4,r[3]=e,i.setPath(r,0,4,!0)}else{var n,r;i=s;(r=0<(n=ka.pool)[2].length?n[2].splice(n[2].length-1,1)[0]:new Int32Array(2))[0]=4,r[1]=e,i.setPath(r,0,2,!0)}s.pathEndFunction=function(){var t=s,e=ka.pool,i=0<e[2].length?e[2].splice(e[2].length-1,1)[0]:new Int32Array(2);i[0]=8,i[1]=il.getInt(30,60),t.setPath(i,0,2,!0),s.pathEndFunction=function(){s.changeFloor()},s.pathOnlyRelatedTo=s.inPermanent},s.pathOnlyRelatedTo=s.inPermanent},s.pathOnlyRelatedTo=s.inPermanent},s.pathOnlyRelatedTo=s.inPermanent});else{var i=s;(r=0<(n=ka.pool)[2].length?n[2].splice(n[2].length-1,1)[0]:new Int32Array(2))[0]=8,r[1]=il.getInt(30,60),i.setPath(r,0,2,!0),s.pathEndFunction=null,s.pathOnlyRelatedTo=s.inPermanent}else{var n,r,o=il.getInt(4,6);i=s;(r=0<(n=ka.pool)[2].length?n[2].splice(n[2].length-1,1)[0]:new Int32Array(2))[0]=4,r[1]=o,i.setPath(r,0,2,!0),s.pathEndFunction=null,s.pathOnlyRelatedTo=s.inPermanent}},save:function(t,e){null==e&&(e=!0),ee.prototype.save.call(this,t),e&&t.addString(Ei.saveDefinition);var i=this.currentTexture;if(t.size+4>t.bytes.length){var n=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+4))),t.bytes.blit(0,n,0,t.size)}t.bytes.setInt32(t.size,i),t.size+=4},load:function(t,e){ee.prototype.load.call(this,t),null==e&&(e=t.readString());var i=Dr.makeLoadMap(e,t);Object.prototype.hasOwnProperty.call(i.h,"currentTexture")&&(this.currentTexture=i.h.currentTexture),this.postLoad()},__class__:Ei});function Ai(t,e,i,n,r,s,o,a){this.currentAdjBonus=0,re.call(this,t,e,i,n,r,s,o,a),this.adjecentBuildingEffects.push({name:"modernRusticHomeCommunityFeeling",intensity:1})}(q["buildings.ModernRusticHome"]=Ai).__name__="buildings.ModernRusticHome",Ai.__super__=re,Ai.prototype=e(re.prototype,{get_possibleUpgrades:function(){return[Ot]},onCityChange:function(){var t=0;3<=this.getEffectsOfAdjecentBuildings("modernRusticHomeCommunityFeeling")&&(t=15),this.bonusAttractiveness+=t-this.currentAdjBonus,t!=(0|this.currentAdjBonus)&&(this.city.simulation.houseAssigner.shouldUpdateHouses=!0),this.currentAdjBonus=0|t},__class__:Ai});function Mi(t,e,i,n,r,s,o,a){this.knownEntertainedCitizenSet=0,this.knownEntertainedCitizen=null,this.nightClubColor=0,this.nightClubEntertainmentQuantity=0,this.laserImages=dt.getTexturesByWidth("spr_nightclub_laser",18),this.lights=[],ee.call(this,t,e,i,n,r,s,o,a);var l=new PIXI.Sprite(dt.getTexture("spr_nightclub_light"));i.addChild(l),this.lights.push({sprite:l,color:0,alpha:0,waiting:1,alphaDir:1}),l.alpha=.8;var h=[150,1,.5];l.tint=gh.toInt(ah.toRgb(h)),l=new PIXI.Sprite(dt.getTexture("spr_nightclub_light")),i.addChild(l),this.lights.push({sprite:l,color:0,alpha:0,waiting:1,alphaDir:1}),l.alpha=.8,h=[150,1,.5],l.tint=gh.toInt(ah.toRgb(h)),this.laserStage=new PIXI.Container,i.addChild(this.laserStage),this.laserStage.position.set(s.x,s.y),this.lasers=[],this.lasers.push({start:new br(2,3),end:new br(6,18),hue:180,speed:1,targetLaserHue:-1,laserSprite:null}),this.lasers.push({start:new br(17,3),end:new br(6,18),hue:0,speed:-1,targetLaserHue:-1,laserSprite:null}),this.positionSprites(),this.startTime=20,this.endTime=5.5,this.workTimePreferenceMod=.5,this.isEntertainment=!0,this.lightsAreOn=-1}(q["buildings.NightClub"]=Mi).__name__="buildings.NightClub",Mi.__interfaces__=[oe],Mi.__super__=ee,Mi.prototype=e(ee.prototype,{get_baseEntertainmentCapacity:function(){return this.workers.length*(40+this.nightClubEntertainmentQuantity)+this.city.upgrades.vars.nightClubEntertainmentQualityBonus},get_isOpen:function(){if(1!=this.workers.length||0!=this.workers[0].currentAction)return!1;var t=this.city.simulation.time.timeSinceStart/60%24,e=this.startTime-this.workTimePreferenceMod;return e<6?e<=t&&t<6:e<=t||t<6},get_entertainmentType:function(){return 0},get_secondaryEntertainmentTypes:function(){return null},get_minimumNormalTimeToSpend:function(){return 5},get_maximumNormalTimeToSpend:function(){return 7},get_minimumEntertainmentGroupSatisfy:function(){return 1},get_maximumEntertainmentGroupSatisfy:function(){return 3},get_entertainmentQuality:function(){return 100},get_isOpenForExistingVisitors:function(){return this.get_isOpen()},finishEntertainment:function(t,e){return!0},get_possibleUpgrades:function(){return[G]},get_drawerType:function(){return Rn},get_hasLeftNightClub:function(){return null!=this.leftBuilding&&this.leftBuilding.is(Mi)},get_hasRightNightClub:function(){return null!=this.rightBuilding&&this.rightBuilding.is(Mi)},postLoad:function(){for(var t=0,e=this.lights;t<e.length;){var i=e[t];++t,3==this.nightClubColor&&(i.sprite.texture=dt.getTexture("spr_nightclub_light_rainbow"))}},postCreate:function(){ee.prototype.postCreate.call(this),this.positionSprites()},destroy:function(){for(var t=0,e=this.lights;t<e.length;){var i=e[t];++t,i.sprite.destroy()}this.laserStage.destroy({children:!0}),ee.prototype.destroy.call(this)},work:function(t,e,i){if(i&&6<this.city.simulation.time.timeSinceStart/60%24)t.currentAction=2;else if(this.get_hasLeftNightClub())t.moveAndWait(il.getInt(0,this.get_hasRightNightClub()?19:17),il.getInt(20,50),null,!1,!1),this.lightsAreOn=60;else{var n=t.pathWalkSpeed*e;if(K.shouldUpdateDraw=!0,Math.abs(1-t.relativeX)<n)t.relativeX=1;else{var r=1-t.relativeX;t.relativeX+=(0<r?1:r<0?-1:0)*n}this.lightsAreOn=3}},beEntertained:function(t,e){var i;switch(null==this.knownEntertainedCitizen?(this.knownEntertainedCitizen=t,this.knownEntertainedCitizenSet=60):this.knownEntertainedCitizen==t&&(this.knownEntertainedCitizenSet=60),this.nightClubColor){case 1:i=-3;break;case 2:case 4:i=3;break;default:i=0}var n=il.getInt(2+(this.get_hasLeftNightClub()?1:0)+(this.get_hasRightNightClub()?1:0)),r=4!=this.nightClubColor||this.knownEntertainedCitizen!=t;if(this.get_hasLeftNightClub()&&r&&0==n&&this.leftBuilding.get_isOpen())(o=0<(s=ka.pool)[6].length?s[6].splice(s[6].length-1,1)[0]:new Int32Array(6))[0]=2,o[1]=0,o[2]=4,o[3]=il.getInt(5,19),o[4]=8,o[5]=il.getInt(5,6),t.setPath(o,0,6,!0);else if(this.get_hasRightNightClub()&&r&&1==n&&this.rightBuilding.get_isOpen()){var s,o;(o=0<(s=ka.pool)[6].length?s[6].splice(s[6].length-1,1)[0]:new Int32Array(6))[0]=3,o[1]=0,o[2]=4,o[3]=il.getInt(0,17),o[4]=8,o[5]=il.getInt(5,6),t.setPath(o,0,6,!0)}else{var a=this.get_hasLeftNightClub()?0:5,l=this.get_hasRightNightClub()?19:17,h=!1,u=2==this.nightClubColor||4==this.nightClubColor;null==u&&(u=!1),null==h&&(h=!1),t.moveAndWait(il.getInt(a,l),il.getInt(5+i,6+i),null,h,u)}t.hasBuildingInited||(t.wantsNightEntertainmentIn=il.getInt(1,5),t.hasBuildingInited=!0)},positionSprites:function(){ee.prototype.positionSprites.call(this),2<=this.lights.length&&(this.lights[0].sprite.position.set(this.position.x+5,this.position.y+4),this.lights[1].sprite.position.set(this.position.x+10,this.position.y+4)),this.laserStage.position.set(this.position.x,this.position.y)},createWindowAddBottomButtons:function(){var s=this;if(O.hasSecretCode("nightClubColors"))To.create(this.city.gui,function(){return s.nightClubColor},function(t){s.nightClubColor=t,0==s.nightClubColor&&(s.lasers[0].hue=0,s.lasers[1].hue=180,4<=s.lasers.length&&(s.lasers[2].hue=90,s.lasers[3].hue=270));for(var e=0,i=s.lasers;e<i.length;){var n=i[e];++e,n.targetLaserHue=-1}for(e=0,i=s.lights;e<i.length;){var r=i[e];++e,3==s.nightClubColor?r.sprite.texture=dt.getTexture("spr_nightclub_light_rainbow"):r.sprite.texture=dt.getTexture("spr_nightclub_light")}},function(){return 5},null,function(){var t,e=Tr.lo("change_light_show")+" (";switch(s.nightClubColor){case 0:t=Tr.lo("colorful");break;case 1:t=Tr.lo("fast_red");break;case 2:t=Tr.lo("slow_blue");break;case 3:t=Tr.lo("rainbow_light");break;case 4:t=Tr.lo("romantic_pink");break;default:t=""}return e+t+")"});ee.prototype.createWindowAddBottomButtons.call(this)},update:function(t){if(ee.prototype.update.call(this,t),this.lightsAreOn-=Math.min(1,t),!(this.lightsAreOn<=0)||1<=this.workers.length&&this.workers[0].inPermanent==this&&0==this.workers[0].currentAction){for(S=0,x=this.lasers;S<x.length;){var e=x[S];if(++S,4==this.nightClubColor&&0<this.workers.length&&this.workers[0].inPermanent==this&&this.get_hasLeftNightClub())0<=this.knownEntertainedCitizenSet?null==this.knownEntertainedCitizen||this.knownEntertainedCitizen.inPermanent!=this||this.knownEntertainedCitizen.hasDied||(e.end.x=this.knownEntertainedCitizen.relativeX):e.end.x=this.workers[0].relativeX;else if(e.end.x+=t*e.speed,0<e.speed)18<e.end.x&&(e.end.x=18,e.speed=-e.speed);else if(e.end.x<(this.get_hasLeftNightClub()?1:6)){var i=this.get_hasLeftNightClub()?1:6;e.end.x=i,e.speed=-e.speed}switch(this.nightClubColor){case 0:e.hue+=t,360<e.hue&&(e.hue-=360);break;case 1:e.hue=0;break;case 2:(-1==e.targetLaserHue||Math.abs(e.hue-e.targetLaserHue)<t/2)&&(e.targetLaserHue=il.getInt(170,245));var n=1;(245<e.hue||e.hue<170)&&(n=12);var r=e.targetLaserHue-e.hue;e.hue+=.5*(0<r?1:r<0?-1:0)*t*n;break;case 3:(-1==e.targetLaserHue||Math.abs(e.hue-e.targetLaserHue)<t)&&(e.targetLaserHue=il.getInt(360));var s=e.targetLaserHue-e.hue;e.hue+=(0<s?1:s<0?-1:0)*t;break;case 4:(-1==e.targetLaserHue||Math.abs(e.hue-e.targetLaserHue)<t/2)&&(e.targetLaserHue=il.getInt(270,330));var o=1;(330<e.hue||e.hue<270)&&(o=12);var a=e.targetLaserHue-e.hue;e.hue+=.5*(0<a?1:a<0?-1:0)*t*o}if(0==il.getInt(20))switch(this.nightClubColor){case 1:var l=e.speed;e.speed=(0<l?1:l<0?-1:0)*il.getFloat(1,2);break;case 2:var h=e.speed;e.speed=(0<h?1:h<0?-1:0)*il.getFloat(.5,.8);break;case 4:var u=e.speed;e.speed=(0<u?1:u<0?-1:0)*il.getFloat(.5,.8);break;default:var c=e.speed;e.speed=(0<c?1:c<0?-1:0)*il.getFloat(.5,1.5)}null==e.laserSprite&&(e.laserSprite=new PIXI.Sprite,this.laserStage.addChild(e.laserSprite));var d=Math.floor(Math.abs(e.end.x-e.start.x)),p=this.laserImages.length-1;e.laserSprite.texture=this.laserImages[d<0?0:p<d?p:d],e.laserSprite.position.y=e.start.y;var f=[e.hue,.7,1],g=hh.toRgb(f);e.laserSprite.tint=mr.toHexInt(g),e.end.x<e.start.x?(e.laserSprite.position.set(e.start.x+1,e.start.y),e.laserSprite.scale.x=-1):(e.laserSprite.position.set(e.start.x,e.start.y),e.laserSprite.scale.x=1)}for(S=0,x=this.lights;S<x.length;){var m=x[S];if(++S,0<m.alpha)m.alpha+=.1*m.alphaDir*(4==this.nightClubColor?.25:1),1<m.alpha?(m.alpha=1,m.alphaDir=-1):m.alpha<=0&&(m.alpha=0,1==this.nightClubColor||3==this.nightClubColor?m.waiting=il.getInt(30):m.waiting=il.getInt(60)),m.sprite.alpha=m.alpha;else if(0<m.waiting)m.waiting-=t;else switch(m.waiting=0,m.alpha=.01,m.alphaDir=1,this.nightClubColor){case 0:f=[il.getInt(360),.8,.5],i=ah.toRgb(f);m.sprite.tint=gh.toInt(i);break;case 1:var y=[il.getInt(60),.8,.6];g=ah.toRgb(y);m.sprite.tint=gh.toInt(g);break;case 2:var _=[il.getInt(170,245),.8,.7],v=ah.toRgb(_);m.sprite.tint=gh.toInt(v);break;case 3:m.sprite.tint=16777215;break;case 4:var b=[il.getInt(270,330),.8,.7],w=ah.toRgb(b);m.sprite.tint=gh.toInt(w)}}0<=this.knownEntertainedCitizenSet&&(this.knownEntertainedCitizenSet-=t,this.knownEntertainedCitizenSet<0&&(this.knownEntertainedCitizen=null))}else{for(var S=0,x=this.lights;S<x.length;){var T=x[S];++S,T.sprite.alpha=0}for(var S=0,x=this.lasers;S<x.length;){T=x[S];++S,null!=T.laserSprite&&(T.laserSprite.destroy(),T.laserSprite=null)}}},save:function(t,e){null==e&&(e=!0),ee.prototype.save.call(this,t),e&&t.addString(Mi.saveDefinition);var i=this.nightClubColor;if(t.size+4>t.bytes.length){var n=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+4))),t.bytes.blit(0,n,0,t.size)}t.bytes.setInt32(t.size,i),t.size+=4},load:function(t,e){if(ee.prototype.load.call(this,t),!(t.version<15)){null==e&&(e=t.readString());var i=Dr.makeLoadMap(e,t);Object.prototype.hasOwnProperty.call(i.h,"nightClubColor")&&(this.nightClubColor=i.h.nightClubColor),this.postLoad()}},__class__:Mi});var Bi=function(t,e,i,n,r,s,o,a){this.doorMainTexture=0,re.call(this,t,e,i,n,r,s,o,a),this.doorTextures=dt.getTexturesByWidth("spr_coloreddoors",20),this.makeDoorSpriteIfNeeded()};(q["buildings.NormalHouse"]=Bi).__name__="buildings.NormalHouse",Bi.__super__=re,Bi.prototype=e(re.prototype,{get_possibleUpgrades:function(){return[mt,Et]},positionSprites:function(){re.prototype.positionSprites.call(this),null!=this.doorSprite?(this.doorSprite.position.set(this.position.x,this.position.y),0!=this.worldPosition.y&&(this.doorSprite.destroy(),this.doorSprite=null)):this.makeDoorSpriteIfNeeded()},postLoad:function(){null!=this.doorSprite&&(this.doorSprite.texture=this.doorTextures[this.doorMainTexture])},makeDoorSpriteIfNeeded:function(){null==this.doorSprite&&0==this.worldPosition.y&&(this.doorSprite=new PIXI.Sprite(this.doorTextures[this.doorMainTexture]),this.doorSprite.position.set(this.position.x,this.position.y),this.stage.addChild(this.doorSprite))},createWindowAddBottomButtons:function(){var e=this;if(null!=this.doorSprite){var t=To.create(this.city.gui,function(){return e.doorMainTexture},function(t){null!=e.doorSprite&&(e.doorMainTexture=t,e.doorSprite.texture=e.doorTextures[e.doorMainTexture])},function(){return e.doorTextures.length},Tr.lo("change_door_color"));t.onUpdate=function(){null==e.doorSprite&&e.city.gui.windowInner.removeChild(t)}}re.prototype.createWindowAddBottomButtons.call(this)},destroy:function(){null!=this.doorSprite&&this.doorSprite.destroy(),re.prototype.destroy.call(this)},addWindowInfoLines:function(){re.prototype.addWindowInfoLines.call(this)},save:function(t,e){null==e&&(e=!0),re.prototype.save.call(this,t),e&&t.addString(Bi.saveDefinition);var i=this.doorMainTexture;if(t.size+4>t.bytes.length){var n=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+4))),t.bytes.blit(0,n,0,t.size)}t.bytes.setInt32(t.size,i),t.size+=4},load:function(t,e){if(re.prototype.load.call(this,t),!(t.version<18)){null==e&&(e=t.readString());var i=Dr.makeLoadMap(e,t);Object.prototype.hasOwnProperty.call(i.h,"doorMainTexture")&&(this.doorMainTexture=i.h.doorMainTexture),this.postLoad()}},__class__:Bi});function Ri(t,e,i,n,r,s,o,a){this.hasStarDatabase=!1,this.totalKnowledgeGenerated=0,ee.call(this,t,e,i,n,r,s,o,a),this.startTime=21,this.endTime=4}(q["buildings.Observatory"]=Ri).__name__="buildings.Observatory",Ri.__super__=ee,Ri.prototype=e(ee.prototype,{get_possibleUpgrades:function(){return[Vt]},work:function(t,e,i){if(i)t.currentAction=2;else{switch(this.workers.indexOf(t)){case 0:var n=t.pathWalkSpeed*e;if(K.shouldUpdateDraw=!0,Math.abs(5-t.relativeX)<n)t.relativeX=5;else{var r=5-t.relativeX;t.relativeX+=(0<r?1:r<0?-1:0)*n}break;case 1:n=t.pathWalkSpeed*e;if(K.shouldUpdateDraw=!0,Math.abs(13-t.relativeX)<n)t.relativeX=13;else{r=13-t.relativeX;t.relativeX+=(0<r?1:r<0?-1:0)*n}break;case 2:n=t.pathWalkSpeed*e;if(K.shouldUpdateDraw=!0,Math.abs(9-t.relativeX)<n)t.relativeX=9;else{r=9-t.relativeX;t.relativeX+=(0<r?1:r<0?-1:0)*n}}var s=.002*(this.hasStarDatabase?this.city.upgrades.vars.starDatabaseIsMoreEffective?6:1.5:1)*e*this.city.simulation.happiness.actionSpeedModifier*this.city.simulation.bonuses.labSpeed*t.get_educationSpeedModifier()*this.city.simulation.boostManager.currentGlobalBoostAmount;this.city.materials.knowledge+=s,this.city.simulation.stats.materialProduction[10][0]+=s,this.totalKnowledgeGenerated+=s}},addWindowInfoLines:function(){var t=this;ee.prototype.addWindowInfoLines.call(this),this.city.gui.windowAddInfoText(null,function(){return Tr.lo("knowledge_gathered",[0|t.totalKnowledgeGenerated])})},save:function(t,e){null==e&&(e=!0),ee.prototype.save.call(this,t),e&&t.addString(Ri.saveDefinition);var i=this.totalKnowledgeGenerated;if(t.size+8>t.bytes.length){var n=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+8))),t.bytes.blit(0,n,0,t.size)}t.bytes.setDouble(t.size,i),t.size+=8},load:function(t,e){ee.prototype.load.call(this,t),null==e&&(e=t.readString());var i=Dr.makeLoadMap(e,t);Object.prototype.hasOwnProperty.call(i.h,"totalKnowledgeGenerated")&&(this.totalKnowledgeGenerated=i.h.totalKnowledgeGenerated)},__class__:Ri});function Oi(t,e,i,n,r,s,o,a){this.totalExtraYears=0,Ae.call(this,t,e,i,n,r,s,o,a),this.currentTexture=0,this.parkSprite.texture=this.parkTextures[this.currentTexture],this.totalExtraYears=0}(q["buildings.OldestTreeIntheUniverse"]=Oi).__name__="buildings.OldestTreeIntheUniverse",Oi.__super__=Ae,Oi.prototype=e(Ae.prototype,{get_myParkTextures:function(){return"spr_oldesttreeintheuniverse"},get_changePlantsText:function(){return""},get_entertainmentType:function(){return 3},get_baseEntertainmentCapacity:function(){return 100},get_numberOfLockedParkTextures:function(){return 0},onBuild:function(){Ae.prototype.onBuild.call(this),dr.achieve("OLDEST_TREE_IN_THE_UNIVERSE")},beEntertained:function(t,e){},addWindowInfoLines:function(){var t=this;Ae.prototype.addWindowInfoLines.call(this),this.city.gui.windowAddInfoText(null,function(){return Tr.lo("total_extra_years",[0|t.totalExtraYears])})},save:function(t,e){null==e&&(e=!0),Ae.prototype.save.call(this,t),e&&t.addString(Oi.saveDefinition);var i=this.totalExtraYears;if(t.size+8>t.bytes.length){var n=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+8))),t.bytes.blit(0,n,0,t.size)}t.bytes.setDouble(t.size,i),t.size+=8},load:function(t,e){Ae.prototype.load.call(this,t),null==e&&(e=t.readString());var i=Dr.makeLoadMap(e,t);Object.prototype.hasOwnProperty.call(i.h,"totalExtraYears")&&(this.totalExtraYears=i.h.totalExtraYears)},__class__:Oi});function ki(t,e,i,n,r,s,o,a){this.justBuilt=!1,Ae.call(this,t,e,i,n,r,s,o,a)}(q["buildings.OtherworldlyZoo"]=ki).__name__="buildings.OtherworldlyZoo",ki.__super__=Ae,ki.prototype=e(Ae.prototype,{get_myParkTextures:function(){return"spr_otherworld_plants"},get_changePlantsText:function(){return Tr.lo("change_plants")},get_entertainmentType:function(){return 3},get_baseEntertainmentCapacity:function(){return 35},get_numberOfLockedParkTextures:function(){return 0},onBuild:function(){Ae.prototype.onBuild.call(this),this.justBuilt=!0},postCreate:function(){Ae.prototype.postCreate.call(this);this.justBuilt},save:function(t,e){null==e&&(e=!0),Ae.prototype.save.call(this,t),e&&t.addString(ki.saveDefinition)},load:function(t,e){Ae.prototype.load.call(this,t),null==e&&(e=t.readString());Dr.makeLoadMap(e,t)},__class__:ki});function Di(t,e,i,n,r,s,o,a){re.call(this,t,e,i,n,r,s,o,a)}(q["buildings.OutpostHouse"]=Di).__name__="buildings.OutpostHouse",Di.__super__=re,Di.prototype=e(re.prototype,{destroy:function(){re.prototype.destroy.call(this)},addWindowInfoLines:function(){re.prototype.addWindowInfoLines.call(this)},__class__:Di});function Fi(t,e,i,n,r,s,o,a){this.parkSprite=null,this.currentMainTexture=0,re.call(this,t,e,i,n,r,s,o,a),this.parkTextures=dt.getTexturesByWidth("spr_parkpod",20),this.currentTexture=il.getInt(this.parkTextures.length),this.parkSprite=new PIXI.Sprite(this.parkTextures[this.currentTexture]),this.parkSprite.position.set(s.x,s.y),i.addChild(this.parkSprite),this.adjecentBuildingEffects.push({name:"modernRusticHomeCommunityFeeling",intensity:1})}(q["buildings.ParkPod"]=Fi).__name__="buildings.ParkPod",Fi.__super__=re,Fi.prototype=e(re.prototype,{get_drawerType:function(){return Rn},postLoad:function(){this.parkSprite.texture=this.parkTextures[this.currentTexture],this.changeMainTexture(Fi.mainTextures[this.currentMainTexture])},postCreate:function(){re.prototype.postCreate.call(this),this.positionSprites()},positionSprites:function(){re.prototype.positionSprites.call(this),null!=this.parkSprite&&this.parkSprite.position.set(this.position.x,this.position.y)},beEntertained:function(t,e){var i=null!=this.leftBuilding&&this.leftBuilding.is(Ae),n=null!=this.rightBuilding&&this.rightBuilding.is(Ae),r=il.getInt(1+(i?1:0)+(n?1:0));if(i&&0==r)(o=0<(s=ka.pool)[8].length?s[8].splice(s[8].length-1,1)[0]:new Int32Array(8))[0]=12,o[1]=50,o[2]=2,o[3]=0,o[4]=4,o[5]=il.getInt(0,18),o[6]=8,o[7]=il.getInt(100,180),t.setPath(o,0,8,!0);else if(n&&1==r){var s,o;(o=0<(s=ka.pool)[8].length?s[8].splice(s[8].length-1,1)[0]:new Int32Array(8))[0]=12,o[1]=50,o[2]=3,o[3]=0,o[4]=4,o[5]=il.getInt(0,18),o[6]=8,o[7]=il.getInt(100,180),t.setPath(o,0,8,!0)}else{var a=!1,l=!0;null==l&&(l=!1),null==a&&(a=!1),t.moveAndWait(il.getInt(i?0:3,n?18:15),il.getInt(100,180),null,a,l)}},createWindowAddBottomButtons:function(){var e=this;To.create(this.city.gui,function(){return e.currentMainTexture},function(t){e.currentMainTexture=t,e.changeMainTexture(Fi.mainTextures[e.currentMainTexture])},function(){return Fi.mainTextures.length},Tr.lo("change_building_color")),To.create(this.city.gui,function(){return e.currentTexture},function(t){e.currentTexture=t,e.parkSprite.texture=e.parkTextures[e.currentTexture]},function(){return e.parkTextures.length},Tr.lo("change_variant")),re.prototype.createWindowAddBottomButtons.call(this)},destroy:function(){re.prototype.destroy.call(this),this.parkSprite.destroy()},walkAround:function(t,e){if(9==t.relativeX)t.canViewSelfInBuilding=!1;else{var i=ka.pool,n=0<i[2].length?i[2].splice(i[2].length-1,1)[0]:new Int32Array(2);n[0]=4,n[1]=9,t.setPath(n,0,2,!0),t.pathEndFunction=null,t.pathOnlyRelatedTo=t.inPermanent}},save:function(t,e){null==e&&(e=!0),re.prototype.save.call(this,t),e&&t.addString(Fi.saveDefinition);var i=this.currentTexture;if(t.size+4>t.bytes.length){var n=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+4))),t.bytes.blit(0,n,0,t.size)}t.bytes.setInt32(t.size,i),t.size+=4;i=this.currentMainTexture;if(t.size+4>t.bytes.length){n=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+4))),t.bytes.blit(0,n,0,t.size)}t.bytes.setInt32(t.size,i),t.size+=4},load:function(t,e){re.prototype.load.call(this,t),null==e&&(e=t.readString());var i=Dr.makeLoadMap(e,t);Object.prototype.hasOwnProperty.call(i.h,"currentTexture")&&(this.currentTexture=i.h.currentTexture),Object.prototype.hasOwnProperty.call(i.h,"currentMainTexture")&&(this.currentMainTexture=i.h.currentMainTexture),this.postLoad()},__class__:Fi});function Ni(t,e,i,n,r,s,o,a){this.markingTexture="",this.marking=null,ee.call(this,t,e,i,n,r,s,o,a),this.startTime=20,this.endTime=5.5,this.workTimePreferenceMod=.5,this.isEntertainment=!0}(q["buildings.Pub"]=Ni).__name__="buildings.Pub",Ni.__interfaces__=[oe],Ni.__super__=ee,Ni.prototype=e(ee.prototype,{get_baseEntertainmentCapacity:function(){return 50*this.workers.length},get_isOpen:function(){var t;if(1==this.workers.length&&0==this.workers[0].currentAction){var e=this.city.simulation.time.timeSinceStart/60%24,i=this.startTime-this.workTimePreferenceMod;t=i<4.5?i<=e&&e<4.5:i<=e||e<4.5}else t=!1;return!!t&&null==this.marking},get_entertainmentType:function(){return 1},get_secondaryEntertainmentTypes:function(){return null},get_minimumNormalTimeToSpend:function(){return 2},get_maximumNormalTimeToSpend:function(){return 6},get_minimumEntertainmentGroupSatisfy:function(){return 1},get_maximumEntertainmentGroupSatisfy:function(){return 3},get_entertainmentQuality:function(){return 100},get_isOpenForExistingVisitors:function(){return this.get_isOpen()},finishEntertainment:function(t,e){return!0},postLoad:function(){""!=this.markingTexture&&this.setMarking(this.markingTexture)},destroy:function(){ee.prototype.destroy.call(this),null!=this.marking&&this.marking.destroy()},positionSprites:function(){ee.prototype.positionSprites.call(this),null!=this.marking&&this.marking.position.set(this.position.x+2,this.position.y+10)},createMainWindowPart:function(){var t=this;ee.prototype.createMainWindowPart.call(this);var e=this.city.progress.sideQuests.findSidequestWithType(tl);if(null!=e){var i=Te,n=Tr.lo("buildinginfo.json/CarrotJuiceBar.name"),r=Tr.lo("build_CarrotJuiceBar");xo.create(this.city,this,i,n,r,function(){t.city.progress.sideQuests.completeSidequest(e)})}},setMarking:function(t){this.markingTexture=t,null==this.marking&&(this.marking=new PIXI.Sprite(dt.getTexture(t))),this.marking.texture=dt.getTexture(t),this.marking.position.set(this.position.x+2,this.position.y+10),this.stage.addChild(this.marking)},beEntertained:function(r,t){function e(){var t=il.getInt(7,16),e=r,i=ka.pool,n=0<i[2].length?i[2].splice(i[2].length-1,1)[0]:new Int32Array(2);n[0]=4,n[1]=t,e.setPath(n,0,2,!0),r.pathEndFunction=null,r.pathOnlyRelatedTo=r.inPermanent}if(r.relativeY<5)r.changeFloor(e);else{var i=r,n=ka.pool,s=0<n[2].length?n[2].splice(n[2].length-1,1)[0]:new Int32Array(2);s[0]=8,s[1]=il.getInt(120,180),i.setPath(s,0,2,!0),r.pathEndFunction=e,r.pathOnlyRelatedTo=r.inPermanent}r.hasBuildingInited||(r.wantsNightEntertainmentIn=il.getInt(1,5),r.hasBuildingInited=!0)},work:function(t,e,i){if(i&&4.5<this.city.simulation.time.timeSinceStart/60%24)t.currentAction=2;else if(t.relativeY<5)t.changeFloor();else{var n=t.pathWalkSpeed*e;if(K.shouldUpdateDraw=!0,Math.abs(3-t.relativeX)<n)t.relativeX=3;else{var r=3-t.relativeX;t.relativeX+=(0<r?1:r<0?-1:0)*n}}},save:function(t,e){null==e&&(e=!0),ee.prototype.save.call(this,t),e&&t.addString(Ni.saveDefinition),t.addString(this.markingTexture)},load:function(t,e){if(ee.prototype.load.call(this,t),!(t.version<7)){null==e&&(e=t.readString());var i=Dr.makeLoadMap(e,t);Object.prototype.hasOwnProperty.call(i.h,"markingTexture")&&(this.markingTexture=i.h.markingTexture),this.postLoad()}},__class__:Ni});function Li(t,e,i,n,r,s,o,a){_.call(this,t,e,i,n,r,s,o,a),this.lastExpanded=n.simulation.time.timeSinceStart,this.subImageIfRelevant=il.getInt(4,7),this.doorX=9,this.isEntertainment=!0,this.hasGrass=!1,this.isPrimary=!0,this.isRooftopBuilding=!0}(q["buildings.RedwoodTree"]=Li).__name__="buildings.RedwoodTree",Li.__interfaces__=[oe],Li.__super__=_,Li.prototype=e(_.prototype,{get_drawerType:function(){return Ln},get_decorationDrawer:function(){return this.drawer},get_baseEntertainmentCapacity:function(){return 30},get_isOpen:function(){return!1},get_entertainmentType:function(){return 3},get_secondaryEntertainmentTypes:function(){return null},get_minimumNormalTimeToSpend:function(){return 3},get_maximumNormalTimeToSpend:function(){return 4},get_minimumEntertainmentGroupSatisfy:function(){return 1},get_maximumEntertainmentGroupSatisfy:function(){return 1.5},get_entertainmentQuality:function(){return 100},get_isOpenForExistingVisitors:function(){return this.get_isOpen()},finishEntertainment:function(t,e){return!0},get_primaryRedwood:function(){for(var t=this;null!=t.topBuilding&&t.topBuilding.is(Li);)t=t.topBuilding;return t},postLoad:function(){this.isRooftopBuilding=this.isPrimary},postCreate:function(){this.get_primaryRedwood()==this?this.isRooftopBuilding=!0:this.isRooftopBuilding=!1,this.updateSprite()},updateSprite:function(){var t=this.subImageIfRelevant;null==this.topBuilding&&null==this.bottomBuilding?t=this.hasGrass?9:0:null!=this.topBuilding&&null==this.topBuilding.topBuilding&&null==this.bottomBuilding?t=this.hasGrass?10:1:null==this.topBuilding&&null!=this.bottomBuilding&&null==this.bottomBuilding.bottomBuilding?t=2:null==this.bottomBuilding?t=this.hasGrass?11:3:null==this.topBuilding?t=8:null==this.topBuilding.topBuilding&&(t=7),this.get_decorationDrawer().changeSubImage(t)},doForWholeTrunk:function(t){for(var e=this.get_primaryRedwood();null!=e;)t(e),e.is(Li)&&(e=e.bottomBuilding)},canBuildAbove:function(){return this==this.get_primaryRedwood()?(this.world.permanents[this.worldPosition.x].length<=this.worldPosition.y||null==this.world.permanents[this.worldPosition.x][this.worldPosition.y+1])&&!this.city.miscCityElements.isUnbuildable(new vr(this.position.x,this.position.y-20),!0):this.get_primaryRedwood().canBuildAbove()},destroy:function(){var e=this,t=null;if(this==this.get_primaryRedwood()?null!=this.bottomBuilding&&this.bottomBuilding.is(Li)&&(this.bottomBuilding.isRooftopBuilding=!0,this.bottomBuilding.isPrimary=!0,t=this.bottomBuilding):t=this.get_primaryRedwood(),_.prototype.destroy.call(this),null!=t){var i=this;t.doForWholeTrunk(function(t){t!=i&&t.updateSprite()}),t.doForWholeTrunk(function(t){e.city.gui.windowRelatedTo==t&&e.city.gui.reloadWindow()})}},createMainWindowPart:function(){var i=this;_.prototype.createMainWindowPart.call(this);var n=this.city.gui;this.is(Ui)||(null!=this.topBuilding&&null!=this.bottomBuilding&&null!=this.topBuilding.topBuilding&&(To.create(this.city.gui,function(){return i.subImageIfRelevant-4},function(t){i.subImageIfRelevant=t+4,i.updateSprite()},function(){return 3},Tr.lo("change_variant")),n.windowInner.addChild(new Ms(n.windowInner,new vr(2,4)))),null==this.bottomBuilding&&(Io.create(this.city.gui,function(){i.hasGrass=!i.hasGrass,i.updateSprite()},this.city.gui.windowInner,function(){return i.hasGrass?Tr.lo("remove_grass"):Tr.lo("add_grass")},n.innerWindowStage),n.windowInner.addChild(new Ms(n.windowInner,new vr(2,4)))));var r=new L(100,0,50,0,0),s=new L(50,0,0,20,0,10);if(this.city.progress.unlocks.getUnlockState(Ui)!=$a.Researched&&(s.knowledge=2500),this.city.simulation.time.timeSinceStart>this.get_primaryRedwood().lastExpanded+1440){var t=po.createActivatableButton(n,!1,function(){if(i.city.materials.canAfford(r)&&i.canBuildAbove()){i.city.materials.remove(r),i.get_primaryRedwood().isRooftopBuilding=!1,i.get_primaryRedwood().isPrimary=!1;var t=i.world.build(Li,i.worldPosition.x,i.get_primaryRedwood().worldPosition.y+1);t.isRooftopBuilding=!0,t.isPrimary=!0,i.city.onBuildBuilding(!1,!1,t,Li,i.get_primaryRedwood().worldPosition.y+1,i.world.permanents[i.worldPosition.x]);var e=0;i.doForWholeTrunk(function(t){t.updateSprite(),e+=1}),20<=e&&dr.achieve("TALL_REDWOOD"),i.reloadWindow()}},Tr.lo("build_redwood"),Tr.lo("build_redwood_description"),this.city.gui.windowInner).container,e=new ps(n,n.innerWindowStage,t),o=new Hs(this.city,r,"");e.addChild(new ds(e,n.innerWindowStage,o,{left:0,right:0,top:0,bottom:2},Uh(o,o.updateCostDisplay))),o.setCost(r),t.addChild(e)}else n.windowAddInfoText(null,function(){i.city.simulation.time.timeSinceStart>i.get_primaryRedwood().lastExpanded+1440&&n.reloadWindow();var t=Math.ceil(24-(i.city.simulation.time.timeSinceStart-i.get_primaryRedwood().lastExpanded)/60);return t<=1?Tr.lo("build_redwood_wait_1"):Tr.lo("build_redwood_wait",[t])});if(!this.is(Ui)&&this.canBuildHouseHere()){t=po.createActivatableButton(n,!1,function(){if(i.city.materials.canAfford(s)&&i.canBuildHouseHere()){i.city.materials.remove(s),i.destroyForReplacement();var t=i.world.build(Ui,i.worldPosition.x,i.worldPosition.y);t.isPrimary=!1,t.isRooftopBuilding=!1,i.city.onBuildBuilding(!1,!0,t,Ui,i.worldPosition.y,i.world.permanents[i.worldPosition.x]),n.closeWindow(),t.showWindow()}},Tr.lo("build_redwood_house"),Tr.lo("build_redwood_house_description"),this.city.gui.windowInner).container,e=new ps(n,n.innerWindowStage,t),o=new Hs(this.city,s,"");e.addChild(new ds(e,n.innerWindowStage,o,{left:0,right:0,top:0,bottom:2},Uh(o,o.updateCostDisplay))),o.setCost(s),t.addChild(e)}else this.is(Ui)&&po.createActivatableButton(n,!1,function(){var t=s.copy();t.multiply(i.city.upgrades.vars.recyclingAmount),i.city.materials.add(t),i.destroyForReplacement();var e=i.world.build(Li,i.worldPosition.x,i.worldPosition.y);e.isPrimary=!1,e.isRooftopBuilding=!1,i.city.onBuildBuilding(!1,!0,e,Li,i.worldPosition.y,i.world.permanents[i.worldPosition.x]),n.closeWindow(),e.showWindow()},Tr.lo("remove_redwood_house"),"",this.city.gui.windowInner);n.windowInner.addChild(new Ms(n.windowInner,new vr(2,4))),this.city.gui.windowAddInfoText(Tr.lo("redwoodtree_credits"))},canBuildHouseHere:function(){return null!=this.topBuilding&&null!=this.topBuilding.topBuilding&&null!=this.bottomBuilding},tryDestroy:function(t){return null==t&&(t=!0),null==this.topBuilding&&null!=this.bottomBuilding&&null!=this.bottomBuilding.bottomBuilding&&this.bottomBuilding.bottomBuilding.is(Ui)||null!=this.topBuilding&&null==this.topBuilding.topBuilding&&null!=this.bottomBuilding&&this.bottomBuilding.is(Ui)||null==this.bottomBuilding&&null!=this.topBuilding&&this.topBuilding.is(Ui)?(t&&this.city.gui.showSimpleWindow(Tr.lo("redwoodtree_cannot_destroy_because_house_limits"),null,!0,!0),!1):_.prototype.tryDestroy.call(this,t)},beEntertained:function(t,e){},save:function(t,e){null==e&&(e=!0),_.prototype.save.call(this,t),e&&t.addString(Li.saveDefinition);var i=this.lastExpanded;if(t.size+8>t.bytes.length){var n=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+8))),t.bytes.blit(0,n,0,t.size)}t.bytes.setDouble(t.size,i),t.size+=8;i=this.subImageIfRelevant;if(t.size+4>t.bytes.length){n=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+4))),t.bytes.blit(0,n,0,t.size)}t.bytes.setInt32(t.size,i),t.size+=4;i=this.isPrimary;if(t.size+1>t.bytes.length){n=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+1))),t.bytes.blit(0,n,0,t.size)}t.bytes.b[t.size]=i?1:0,t.size+=1;i=this.hasGrass;if(t.size+1>t.bytes.length){n=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+1))),t.bytes.blit(0,n,0,t.size)}t.bytes.b[t.size]=i?1:0,t.size+=1},load:function(t,e){_.prototype.load.call(this,t),null==e&&(e=t.readString());var i=Dr.makeLoadMap(e,t);Object.prototype.hasOwnProperty.call(i.h,"lastExpanded")&&(this.lastExpanded=i.h.lastExpanded),Object.prototype.hasOwnProperty.call(i.h,"subImageIfRelevant")&&(this.subImageIfRelevant=i.h.subImageIfRelevant),Object.prototype.hasOwnProperty.call(i.h,"isPrimary")&&(this.isPrimary=i.h.isPrimary),Object.prototype.hasOwnProperty.call(i.h,"hasGrass")&&(this.hasGrass=i.h.hasGrass),this.postLoad()},__class__:Li});var Ui=function(t,e,i,n,r,s,o,a){this.yearsToLiveLongerPerYearIfLivingHere=0,this.residents=[],this.extraCapacity=0,Li.call(this,t,e,i,n,r,s,o,a)};(q["buildings.RedwoodTreeHouse"]=Ui).__name__="buildings.RedwoodTreeHouse",Ui.__interfaces__=[ne],Ui.__super__=Li,Ui.prototype=e(Li.prototype,{get_drawerType:function(){return Fn},get_residentCapacity:function(){return null==this.info.residents?0:this.info.residents+this.extraCapacity},get_baseAttractiveness:function(){return this.info.quality},get_possibleUpgrades:function(){return[]},get_remainingCapacity:function(){return this.get_residentCapacity()-this.residents.length},get_hasPrivateTeleporter:function(){return!1},get_fixedCapacityForWorkers:function(){return 0},destroy:function(){for(Li.prototype.destroy.call(this);0!=this.residents.length;)this.residents[this.residents.length-1].evictFromHome()},updateSprite:function(){},addWindowInfoLines:function(){var t=this,e=this.city.gui,i=dt.getTexture("spr_housing"),n=this.city,r=this.residents,s=Tr.lo("residents_of",[this.get_name()]),o=this,a=Tr.lo("no_residents");e.windowAddSimpleButton(i,function(){Vs.createWindow(n,r,s,o,a)},null,function(){return Tr.lo("residents",[t.residents.length,t.get_residentCapacity()])}),Li.prototype.addWindowInfoLines.call(this),this.city.gui.windowAddInfoText(null,function(){return Tr.lo("quality",[t.get_baseAttractiveness()+t.bonusAttractiveness])}),this.city.gui.windowInner.addChild(new Ms(this.city.gui.windowInner,new vr(2,4)))},walkAround:function(t,e){t.setRelativeY(5),t.moveAndWait(il.getInt(2,17),il.getInt(60,90),null,!1,!1)},__class__:Ui});function zi(t,e,i,n,r,s,o,a){this.timeWorking=0,this.waiting=0,this.flyingSaucerTargetX=0,this.flyingSaucerY=0,this.flyingSaucerXI=0,this.flyingSaucerXProg=0,this.returning=!1,this.flying=!1,ee.call(this,t,e,i,n,r,s,o,a),this.doorX=15,this.flyingSaucerSprite=dt.makeSprite("spr_researchbot"),this.flyingSaucerSprite.position.set(s.x,s.y),e.addChild(this.flyingSaucerSprite)}(q["buildings.ResearchBot"]=zi).__name__="buildings.ResearchBot",zi.__super__=ee,zi.prototype=e(ee.prototype,{positionSprites:function(){ee.prototype.positionSprites.call(this),this.flying?0<this.workers.length&&(this.workers[0].canViewSelfInBuilding=!1):(this.flyingSaucerXI=(this.position.x/20|0)-this.city.simulation.flyingPathfinder.gridIStart-1,this.flyingSaucerY=this.position.y,this.flyingSaucerSprite.position.set(this.position.x,this.position.y))},update:function(t){if(ee.prototype.update.call(this,t),this.flying)if(this.timeWorking+=t,0<this.waiting)this.waiting-=t;else{var e=this.flyingSaucerTargetX-this.flyingSaucerXI,i=0<e?1:e<0?-1:0;if(0==i){var n=this.city.simulation.flyingPathfinder.highestYPositions[this.flyingSaucerXI]-40;this.returning&&(n+=40),this.flyingSaucerY<n&&-1e6<=n?(this.flyingSaucerY+=3*t,this.flyingSaucerY>n&&(this.flyingSaucerY=n)):(-1e6<=n&&(this.flyingSaucerY=n),this.returning?(this.flying=!1,this.returning=!1):(this.flyingSaucerTargetX=(this.position.x/20|0)-this.city.simulation.flyingPathfinder.gridIStart-1,this.returning=!0),this.waiting=60)}else{n=this.city.simulation.flyingPathfinder.highestYPositions[this.flyingSaucerXI+i]-40;this.flyingSaucerY>n&&-1e5<=n?(this.flyingSaucerY-=3*t,this.flyingSaucerY<n&&(this.flyingSaucerY=n)):(this.flyingSaucerXProg+=3*i*t,20<i*this.flyingSaucerXProg&&(this.flyingSaucerXProg=0,this.flyingSaucerXI+=i))}this.flyingSaucerSprite.position.set(20*(this.flyingSaucerXI+this.city.simulation.flyingPathfinder.gridIStart+1)+this.flyingSaucerXProg,this.flyingSaucerY),0<this.workers.length&&this.workers[0].inPermanent==this&&this.workers[0].setRelativePos(this.flyingSaucerSprite.position.x-this.position.x+9,3-(this.flyingSaucerSprite.position.y-this.position.y))}},work:function(t,e,i){if(!i||this.flying){if(this.flying){var n=.00125*e*this.city.simulation.happiness.actionSpeedModifier*t.get_educationSpeedModifier()*this.city.simulation.boostManager.currentGlobalBoostAmount;return this.city.materials.knowledge+=n,void(this.city.simulation.stats.materialProduction[10][0]+=n)}var r,s=t.pathWalkSpeed*e;if(K.shouldUpdateDraw=!0,Math.abs(9-t.relativeX)<s)t.relativeX=9,r=!0;else{var o=9-t.relativeX;t.relativeX+=(0<o?1:o<0?-1:0)*s,r=!1}r&&(t.canViewSelfInBuilding=!1,this.flying=!0,this.flyingSaucerTargetX=il.getInt(this.city.simulation.flyingPathfinder.highestYPositions.length),this.flyingSaucerXI=(this.position.x/20|0)-this.city.simulation.flyingPathfinder.gridIStart-1,"hackersandaliens"==this.city.progress.story.storyName&&this.timeWorking<60&&(this.flyingSaucerTargetX=-36-this.city.simulation.flyingPathfinder.gridIStart-1),this.flyingSaucerY=this.position.y)}else t.currentAction=2},destroy:function(){this.flyingSaucerSprite.destroy(),ee.prototype.destroy.call(this)},save:function(t,e){null==e&&(e=!0),ee.prototype.save.call(this,t),e&&t.addString(zi.saveDefinition);var i=this.flying;if(t.size+1>t.bytes.length){var n=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+1))),t.bytes.blit(0,n,0,t.size)}t.bytes.b[t.size]=i?1:0,t.size+=1;i=this.returning;if(t.size+1>t.bytes.length){n=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+1))),t.bytes.blit(0,n,0,t.size)}t.bytes.b[t.size]=i?1:0,t.size+=1;i=this.flyingSaucerXProg;if(t.size+8>t.bytes.length){n=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+8))),t.bytes.blit(0,n,0,t.size)}t.bytes.setDouble(t.size,i),t.size+=8;i=this.flyingSaucerXI;if(t.size+4>t.bytes.length){n=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+4))),t.bytes.blit(0,n,0,t.size)}t.bytes.setInt32(t.size,i),t.size+=4;i=this.flyingSaucerY;if(t.size+8>t.bytes.length){n=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+8))),t.bytes.blit(0,n,0,t.size)}t.bytes.setDouble(t.size,i),t.size+=8;i=this.flyingSaucerTargetX;if(t.size+4>t.bytes.length){n=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+4))),t.bytes.blit(0,n,0,t.size)}t.bytes.setInt32(t.size,i),t.size+=4;i=this.waiting;if(t.size+8>t.bytes.length){n=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+8))),t.bytes.blit(0,n,0,t.size)}t.bytes.setDouble(t.size,i),t.size+=8;i=this.timeWorking;if(t.size+8>t.bytes.length){n=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+8))),t.bytes.blit(0,n,0,t.size)}t.bytes.setDouble(t.size,i),t.size+=8},load:function(t,e){ee.prototype.load.call(this,t),null==e&&(e=t.readString());var i=Dr.makeLoadMap(e,t);Object.prototype.hasOwnProperty.call(i.h,"flying")&&(this.flying=i.h.flying),Object.prototype.hasOwnProperty.call(i.h,"returning")&&(this.returning=i.h.returning),Object.prototype.hasOwnProperty.call(i.h,"flyingSaucerXProg")&&(this.flyingSaucerXProg=i.h.flyingSaucerXProg),Object.prototype.hasOwnProperty.call(i.h,"flyingSaucerXI")&&(this.flyingSaucerXI=i.h.flyingSaucerXI),Object.prototype.hasOwnProperty.call(i.h,"flyingSaucerY")&&(this.flyingSaucerY=i.h.flyingSaucerY),Object.prototype.hasOwnProperty.call(i.h,"flyingSaucerTargetX")&&(this.flyingSaucerTargetX=i.h.flyingSaucerTargetX),Object.prototype.hasOwnProperty.call(i.h,"waiting")&&(this.waiting=i.h.waiting),Object.prototype.hasOwnProperty.call(i.h,"timeWorking")&&(this.timeWorking=i.h.timeWorking)},__class__:zi});var Wi=function(t,e,i,n,r,s,o,a){ee.call(this,t,e,i,n,r,s,o,a),this.startTime=16,this.endTime=1,this.workTimePreferenceMod=.5,this.isEntertainment=!0};(q["buildings.Restaurant"]=Wi).__name__="buildings.Restaurant",Wi.__interfaces__=[oe],Wi.__super__=ee,Wi.prototype=e(ee.prototype,{get_baseEntertainmentCapacity:function(){var t=45;return t+=this.getEffectsOfAdjecentBuildingsLR("restaurantCapBoost"),this.workers.length*t|0},get_isOpen:function(){if(1<=this.workers.length&&0==this.workers[0].currentAction){var t=this.city.simulation.time.timeSinceStart/60%24,e=this.startTime-this.workTimePreferenceMod;return e<.5?e<=t&&t<.5:e<=t||t<.5}return!1},get_entertainmentType:function(){return 1},get_secondaryEntertainmentTypes:function(){return null},get_minimumNormalTimeToSpend:function(){return 1},get_maximumNormalTimeToSpend:function(){return 3},get_minimumEntertainmentGroupSatisfy:function(){return 1},get_maximumEntertainmentGroupSatisfy:function(){return 3},get_entertainmentQuality:function(){return 100},get_isOpenForExistingVisitors:function(){return this.get_isOpen()},finishEntertainment:function(t,e){return!0},get_drawerType:function(){return Rn},beEntertained:function(n,t){if(n.hasBuildingInited){s=n;(a=0<(o=ka.pool)[2].length?o[2].splice(o[2].length-1,1)[0]:new Int32Array(2))[0]=8,a[1]=il.getInt(30,60),s.setPath(a,0,2,!0),n.pathEndFunction=null,n.pathOnlyRelatedTo=n.inPermanent}else{var e=null!=this.leftBuilding&&this.leftBuilding.is(Wi),r=null!=this.rightBuilding&&this.rightBuilding.is(Wi),i=function(){switch(il.getInt(3+(r?1:0))){case 0:var t=n;(i=0<(e=ka.pool)[2].length?e[2].splice(e[2].length-1,1)[0]:new Int32Array(2))[0]=4,i[1]=4,t.setPath(i,0,2,!0),n.pathEndFunction=null,n.pathOnlyRelatedTo=n.inPermanent;break;case 1:t=n;(i=0<(e=ka.pool)[2].length?e[2].splice(e[2].length-1,1)[0]:new Int32Array(2))[0]=4,i[1]=7,t.setPath(i,0,2,!0),n.pathEndFunction=null,n.pathOnlyRelatedTo=n.inPermanent;break;case 2:t=n;(i=0<(e=ka.pool)[2].length?e[2].splice(e[2].length-1,1)[0]:new Int32Array(2))[0]=4,i[1]=14,t.setPath(i,0,2,!0),n.pathEndFunction=null,n.pathOnlyRelatedTo=n.inPermanent;break;case 3:var e,i;t=n;(i=0<(e=ka.pool)[2].length?e[2].splice(e[2].length-1,1)[0]:new Int32Array(2))[0]=4,i[1]=17,t.setPath(i,0,2,!0),n.pathEndFunction=null,n.pathOnlyRelatedTo=n.inPermanent}};if(n.wantsNightEntertainmentIn=il.getInt(1,5),n.hasBuildingInited=!0,n.relativeY<=5)if(il.getInt(3)<=1)n.changeFloor(i);else if(e)if(0==il.getInt(2)){var s=n;(a=0<(o=ka.pool)[2].length?o[2].splice(o[2].length-1,1)[0]:new Int32Array(2))[0]=4,a[1]=1,s.setPath(a,0,2,!0),n.pathEndFunction=null,n.pathOnlyRelatedTo=n.inPermanent}else{var s=n;(a=0<(o=ka.pool)[2].length?o[2].splice(o[2].length-1,1)[0]:new Int32Array(2))[0]=4,a[1]=6,s.setPath(a,0,2,!0),n.pathEndFunction=null,n.pathOnlyRelatedTo=n.inPermanent}else if(0==il.getInt(2)){s=n;(a=0<(o=ka.pool)[2].length?o[2].splice(o[2].length-1,1)[0]:new Int32Array(2))[0]=4,a[1]=3,s.setPath(a,0,2,!0),n.pathEndFunction=null,n.pathOnlyRelatedTo=n.inPermanent}else{var o,a;s=n;(a=0<(o=ka.pool)[2].length?o[2].splice(o[2].length-1,1)[0]:new Int32Array(2))[0]=4,a[1]=6,s.setPath(a,0,2,!0),n.pathEndFunction=null,n.pathOnlyRelatedTo=n.inPermanent}else i()}},work:function(t,e,i){if(i&&.5<this.city.simulation.time.timeSinceStart/60%24)t.currentAction=2;else switch(this.workers.indexOf(t)){case 0:if(5<t.relativeY)t.changeFloor();else{var n=t.pathWalkSpeed*e;if(K.shouldUpdateDraw=!0,Math.abs(12-t.relativeX)<n)t.relativeX=12;else{var r=12-t.relativeX;t.relativeX+=(0<r?1:r<0?-1:0)*n}}break;case 1:if(t.relativeY<5)t.changeFloor();else{var s=null!=this.leftBuilding&&this.leftBuilding.is(Wi),o=null!=this.rightBuilding&&this.rightBuilding.is(Wi);t.moveAndWait(il.getInt(s?0:3,o?19:16),il.getInt(60,90),null,!1,!1)}}},__class__:Wi});function Gi(t,e,i,n,r,s,o,a){this.currentMaterialUsed=0,this.materialsMadePerStepPerWorker=.001,Pe.call(this,t,e,i,n,r,s,o,a,this.get_animationFrames(),this.get_idleFrames())}(q["buildings.RocketFuelFactory"]=Gi).__name__="buildings.RocketFuelFactory",Gi.__super__=Pe,Gi.prototype=e(Pe.prototype,{get_normalEfficiency:function(){return 1},get_walkThroughCanViewSelfInThisBuilding:function(){return!1},get_possibleUpgrades:function(){return[zt]},get_possibleBuildingModes:function(){return[ut,pt,rt]},get_materialFrom:function(){return 0==this.currentMaterialUsed?this.city.materials.food:this.city.materials.wood},set_materialFrom:function(t){if(0==this.currentMaterialUsed){var e=this.city.materials.food-t,i=this.city.materials;i.set_food(i.food-e),this.city.simulation.stats.materialUsed[0][0]+=e}else{e=this.city.materials.wood-t;this.city.materials.wood-=e,this.city.simulation.stats.materialUsed[1][0]+=e}return 0==this.currentMaterialUsed?this.city.materials.food:this.city.materials.wood},get_materialTo:function(){return this.city.materials.rocketFuel},set_materialTo:function(t){var e=t-this.city.materials.rocketFuel;return this.city.materials.rocketFuel+=e,this.city.simulation.stats.materialProduction[9][0]+=e,this.city.materials.rocketFuel},get_animationFrames:function(){return"spr_rocketfuelfactory_frames"},get_idleFrames:function(){return"spr_rocketfuelfactory_idle"},get_bonusSpeed:function(){return 1+this.city.upgrades.vars.fasterRocketFuelFactory},onBuild:function(){},workAnimation:function(t,e){10!=t.relativeY&&(0==this.workers.indexOf(t)?t.setRelativePos(15,10):t.setRelativePos(12,0))},addWindowInfoLines:function(){var t=this;Pe.prototype.addWindowInfoLines.call(this),this.city.gui.windowAddInfoText(null,function(){return Tr.lo("rocket_fuel_made",[0|t.totalMaterialUsed,0|t.materialMade])})},save:function(t,e){null==e&&(e=!0),Pe.prototype.save.call(this,t),e&&t.addString(Gi.saveDefinition);var i=this.currentMaterialUsed;if(t.size+4>t.bytes.length){var n=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+4))),t.bytes.blit(0,n,0,t.size)}t.bytes.setInt32(t.size,i),t.size+=4},load:function(t,e){Pe.prototype.load.call(this,t),null==e&&(e=t.readString());var i=Dr.makeLoadMap(e,t);Object.prototype.hasOwnProperty.call(i.h,"currentMaterialUsed")&&(this.currentMaterialUsed=i.h.currentMaterialUsed)},__class__:Gi});var Hi=function(t,e,i,n,r,s,o,a){_.call(this,t,e,i,n,r,s,o,a)};(q["buildings.RocketLaunchPlatform"]=Hi).__name__="buildings.RocketLaunchPlatform",Hi.__super__=_,Hi.prototype=e(_.prototype,{__class__:Hi});function Xi(t,e,i,n,r,s,o,a){this.currentRecolor=-1,this.currentTexture=0,this.mirrored=!1,_.call(this,t,e,i,n,r,s,o,a)}(q["buildings.RooftopDecoration"]=Xi).__name__="buildings.RooftopDecoration",Xi.__interfaces__=[Re,Oe],Xi.__super__=_,Xi.prototype=e(_.prototype,{get_drawerType:function(){return Ln},get_decorationDrawer:function(){return this.drawer},customize:function(t,e){this.currentTexture=t,this.mirrored=e},areSameCustomizations:function(t,e,i){return this.currentTexture==t&&this.currentRecolor==i&&this.mirrored==e},customizeColor:function(t){this.currentRecolor=t},createOrRemoveBuilderForThis:function(){this.city.createOrRemoveBuilder(Ko.getClass(this),!0,this.currentTexture,this.mirrored,this.currentRecolor)},postCreate:function(){this.mirrored&&(this.mirror(),this.mirrored=!0),this.get_decorationDrawer().changeSubImage(this.currentTexture),this.get_decorationDrawer().setTint(this.currentRecolor)},mirror:function(){this.mirrored=!this.mirrored,this.drawer.mirror(),this.mirrored?this.doorX=14:this.doorX=4},createWindowAddBottomButtons:function(){var e=this;-1==this.currentRecolor?To.create(this.city.gui,function(){return e.currentTexture},function(t){e.currentTexture=t,e.get_decorationDrawer().changeSubImage(t)},function(){return e.get_decorationDrawer().getSubImageNumber()-1},Tr.lo("change_building_color")):(Io.create(this.city.gui,function(){ls.colorPicked=e.currentRecolor,hs.createWindow(e.city,function(t){e.currentRecolor=t,e.get_decorationDrawer().setTint(e.currentRecolor)})},this.city.gui.windowInner,function(){return Tr.lo("change_building_color")},this.city.gui.innerWindowStage),this.city.gui.windowInner.addChild(new Ms(this.city.gui.windowInner,new vr(2,4))),Io.create(this.city.gui,function(){e.createOrRemoveBuilderForThis(),e.city.gui.closeWindow()},this.city.gui.windowInner,function(){return Tr.lo("duplicate_building")},this.city.gui.innerWindowStage),this.city.gui.windowInner.addChild(new Ms(this.city.gui.windowInner,new vr(2,6)))),Io.create(this.city.gui,Uh(this,this.mirror),this.city.gui.windowInner,function(){return Tr.lo("mirror")},this.city.gui.innerWindowStage),this.city.gui.windowInner.addChild(new Ms(this.city.gui.windowInner,new vr(2,6))),_.prototype.createWindowAddBottomButtons.call(this)},save:function(t,e){null==e&&(e=!0),_.prototype.save.call(this,t),e&&t.addString(Xi.saveDefinition);var i=this.mirrored;if(t.size+1>t.bytes.length){var n=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+1))),t.bytes.blit(0,n,0,t.size)}t.bytes.b[t.size]=i?1:0,t.size+=1;i=this.currentTexture;if(t.size+4>t.bytes.length){n=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+4))),t.bytes.blit(0,n,0,t.size)}t.bytes.setInt32(t.size,i),t.size+=4;i=this.currentRecolor;if(t.size+4>t.bytes.length){n=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+4))),t.bytes.blit(0,n,0,t.size)}t.bytes.setInt32(t.size,i),t.size+=4},load:function(t,e){_.prototype.load.call(this,t),null==e&&(e=t.readString());var i=Dr.makeLoadMap(e,t);Object.prototype.hasOwnProperty.call(i.h,"mirrored")&&(this.mirrored=i.h.mirrored),Object.prototype.hasOwnProperty.call(i.h,"currentTexture")&&(this.currentTexture=i.h.currentTexture),Object.prototype.hasOwnProperty.call(i.h,"currentRecolor")&&(this.currentRecolor=i.h.currentRecolor)},__class__:Xi});function ji(t,e,i,n,r,s,o,a){this.currentRecolor=-1,this.currentTexture=0,this.mirrored=!1,_.call(this,t,e,i,n,r,s,o,a)}(q["buildings.RooftopDecoration2"]=ji).__name__="buildings.RooftopDecoration2",ji.__interfaces__=[Re,Oe],ji.__super__=_,ji.prototype=e(_.prototype,{get_drawerType:function(){return Ln},get_decorationDrawer:function(){return this.drawer},areSameCustomizations:function(t,e,i){return this.currentTexture==t&&this.currentRecolor==i},customize:function(t,e){this.currentTexture=t,this.mirrored=e},customizeColor:function(t){this.currentRecolor=t},createOrRemoveBuilderForThis:function(){this.city.createOrRemoveBuilder(Ko.getClass(this),!0,this.currentTexture,this.mirrored,this.currentRecolor)},postCreate:function(){this.mirrored&&(this.mirror(),this.mirrored=!0),this.get_decorationDrawer().changeSubImage(this.currentTexture),this.get_decorationDrawer().setTint(this.currentRecolor)},mirror:function(){this.mirrored=!this.mirrored,this.drawer.mirror(),this.mirrored?this.doorX=14:this.doorX=4},createWindowAddBottomButtons:function(){var e=this;-1==this.currentRecolor?To.create(this.city.gui,function(){return e.currentTexture},function(t){e.currentTexture=t,e.get_decorationDrawer().changeSubImage(t)},function(){return e.get_decorationDrawer().getSubImageNumber()-1},Tr.lo("change_building_color")):(Io.create(this.city.gui,function(){ls.colorPicked=e.currentRecolor,hs.createWindow(e.city,function(t){e.currentRecolor=t,e.get_decorationDrawer().setTint(e.currentRecolor)})},this.city.gui.windowInner,function(){return Tr.lo("change_building_color")},this.city.gui.innerWindowStage),this.city.gui.windowInner.addChild(new Ms(this.city.gui.windowInner,new vr(2,4))),Io.create(this.city.gui,function(){e.createOrRemoveBuilderForThis(),e.city.gui.closeWindow()},this.city.gui.windowInner,function(){return Tr.lo("duplicate_building")},this.city.gui.innerWindowStage)),this.city.gui.windowInner.addChild(new Ms(this.city.gui.windowInner,new vr(2,6))),_.prototype.createWindowAddBottomButtons.call(this)},save:function(t,e){null==e&&(e=!0),_.prototype.save.call(this,t),e&&t.addString(ji.saveDefinition);var i=this.mirrored;if(t.size+1>t.bytes.length){var n=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+1))),t.bytes.blit(0,n,0,t.size)}t.bytes.b[t.size]=i?1:0,t.size+=1;i=this.currentTexture;if(t.size+4>t.bytes.length){n=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+4))),t.bytes.blit(0,n,0,t.size)}t.bytes.setInt32(t.size,i),t.size+=4;i=this.currentRecolor;if(t.size+4>t.bytes.length){n=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+4))),t.bytes.blit(0,n,0,t.size)}t.bytes.setInt32(t.size,i),t.size+=4},load:function(t,e){_.prototype.load.call(this,t),null==e&&(e=t.readString());var i=Dr.makeLoadMap(e,t);Object.prototype.hasOwnProperty.call(i.h,"mirrored")&&(this.mirrored=i.h.mirrored),Object.prototype.hasOwnProperty.call(i.h,"currentTexture")&&(this.currentTexture=i.h.currentTexture),Object.prototype.hasOwnProperty.call(i.h,"currentRecolor")&&(this.currentRecolor=i.h.currentRecolor)},__class__:ji});function Vi(t,e,i,n,r,s,o,a){this.currentRecolor=-1,this.currentTexture=0,this.mirrored=!1,_.call(this,t,e,i,n,r,s,o,a)}(q["buildings.RooftopDecoration3"]=Vi).__name__="buildings.RooftopDecoration3",Vi.__interfaces__=[Re,Oe],Vi.__super__=_,Vi.prototype=e(_.prototype,{get_drawerType:function(){return Ln},get_decorationDrawer:function(){return this.drawer},areSameCustomizations:function(t,e,i){return this.currentTexture==t&&this.currentRecolor==i},customize:function(t,e){this.currentTexture=t,this.mirrored=e},customizeColor:function(t){this.currentRecolor=t},createOrRemoveBuilderForThis:function(){this.city.createOrRemoveBuilder(Ko.getClass(this),!0,this.currentTexture,this.mirrored,this.currentRecolor)},postCreate:function(){this.mirrored&&(this.mirror(),this.mirrored=!0),this.get_decorationDrawer().changeSubImage(this.currentTexture),this.get_decorationDrawer().setTint(this.currentRecolor)},mirror:function(){this.mirrored=!this.mirrored,this.drawer.mirror(),this.mirrored?this.doorX=14:this.doorX=4},createWindowAddBottomButtons:function(){var e=this;-1==this.currentRecolor?To.create(this.city.gui,function(){return e.currentTexture},function(t){e.currentTexture=t,e.get_decorationDrawer().changeSubImage(t)},function(){return e.get_decorationDrawer().getSubImageNumber()-1},Tr.lo("change_building_color")):(Io.create(this.city.gui,function(){ls.colorPicked=e.currentRecolor,hs.createWindow(e.city,function(t){e.currentRecolor=t,e.get_decorationDrawer().setTint(e.currentRecolor)})},this.city.gui.windowInner,function(){return Tr.lo("change_building_color")},this.city.gui.innerWindowStage),this.city.gui.windowInner.addChild(new Ms(this.city.gui.windowInner,new vr(2,4))),Io.create(this.city.gui,function(){e.createOrRemoveBuilderForThis(),e.city.gui.closeWindow()},this.city.gui.windowInner,function(){return Tr.lo("duplicate_building")},this.city.gui.innerWindowStage)),this.city.gui.windowInner.addChild(new Ms(this.city.gui.windowInner,new vr(2,6))),_.prototype.createWindowAddBottomButtons.call(this)},save:function(t,e){null==e&&(e=!0),_.prototype.save.call(this,t),e&&t.addString(Vi.saveDefinition);var i=this.mirrored;if(t.size+1>t.bytes.length){var n=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+1))),t.bytes.blit(0,n,0,t.size)}t.bytes.b[t.size]=i?1:0,t.size+=1;i=this.currentTexture;if(t.size+4>t.bytes.length){n=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+4))),t.bytes.blit(0,n,0,t.size)}t.bytes.setInt32(t.size,i),t.size+=4;i=this.currentRecolor;if(t.size+4>t.bytes.length){n=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+4))),t.bytes.blit(0,n,0,t.size)}t.bytes.setInt32(t.size,i),t.size+=4},load:function(t,e){_.prototype.load.call(this,t),null==e&&(e=t.readString());var i=Dr.makeLoadMap(e,t);Object.prototype.hasOwnProperty.call(i.h,"mirrored")&&(this.mirrored=i.h.mirrored),Object.prototype.hasOwnProperty.call(i.h,"currentTexture")&&(this.currentTexture=i.h.currentTexture),Object.prototype.hasOwnProperty.call(i.h,"currentRecolor")&&(this.currentRecolor=i.h.currentRecolor)},__class__:Vi});function Yi(t,e,i,n,r,s,o,a){this.currentRecolor=-1,this.currentTexture=0,this.mirrored=!1,_.call(this,t,e,i,n,r,s,o,a)}(q["buildings.RooftopDecoration4"]=Yi).__name__="buildings.RooftopDecoration4",Yi.__interfaces__=[Re,Oe],Yi.__super__=_,Yi.prototype=e(_.prototype,{get_drawerType:function(){return Ln},get_decorationDrawer:function(){return this.drawer},areSameCustomizations:function(t,e,i){return this.currentTexture==t&&this.currentRecolor==i},customize:function(t,e){this.currentTexture=t,this.mirrored=e},customizeColor:function(t){this.currentRecolor=t},createOrRemoveBuilderForThis:function(){this.city.createOrRemoveBuilder(Ko.getClass(this),!0,this.currentTexture,this.mirrored,this.currentRecolor)},postCreate:function(){this.mirrored&&(this.mirror(),this.mirrored=!0),this.get_decorationDrawer().changeSubImage(this.currentTexture),this.get_decorationDrawer().setTint(this.currentRecolor)},mirror:function(){this.mirrored=!this.mirrored,this.drawer.mirror(),this.mirrored?this.doorX=14:this.doorX=4},createWindowAddBottomButtons:function(){var e=this;-1==this.currentRecolor?To.create(this.city.gui,function(){return e.currentTexture},function(t){e.currentTexture=t,e.get_decorationDrawer().changeSubImage(t)},function(){return e.get_decorationDrawer().getSubImageNumber()-1},Tr.lo("change_building_color")):(Io.create(this.city.gui,function(){ls.colorPicked=e.currentRecolor,hs.createWindow(e.city,function(t){e.currentRecolor=t,e.get_decorationDrawer().setTint(e.currentRecolor)})},this.city.gui.windowInner,function(){return Tr.lo("change_building_color")},this.city.gui.innerWindowStage),this.city.gui.windowInner.addChild(new Ms(this.city.gui.windowInner,new vr(2,4))),Io.create(this.city.gui,function(){e.createOrRemoveBuilderForThis(),e.city.gui.closeWindow()},this.city.gui.windowInner,function(){return Tr.lo("duplicate_building")},this.city.gui.innerWindowStage)),this.city.gui.windowInner.addChild(new Ms(this.city.gui.windowInner,new vr(2,6))),_.prototype.createWindowAddBottomButtons.call(this)},save:function(t,e){null==e&&(e=!0),_.prototype.save.call(this,t),e&&t.addString(Yi.saveDefinition);var i=this.mirrored;if(t.size+1>t.bytes.length){var n=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+1))),t.bytes.blit(0,n,0,t.size)}t.bytes.b[t.size]=i?1:0,t.size+=1;i=this.currentTexture;if(t.size+4>t.bytes.length){n=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+4))),t.bytes.blit(0,n,0,t.size)}t.bytes.setInt32(t.size,i),t.size+=4;i=this.currentRecolor;if(t.size+4>t.bytes.length){n=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+4))),t.bytes.blit(0,n,0,t.size)}t.bytes.setInt32(t.size,i),t.size+=4},load:function(t,e){_.prototype.load.call(this,t),null==e&&(e=t.readString());var i=Dr.makeLoadMap(e,t);Object.prototype.hasOwnProperty.call(i.h,"mirrored")&&(this.mirrored=i.h.mirrored),Object.prototype.hasOwnProperty.call(i.h,"currentTexture")&&(this.currentTexture=i.h.currentTexture),Object.prototype.hasOwnProperty.call(i.h,"currentRecolor")&&(this.currentRecolor=i.h.currentRecolor)},__class__:Yi});var qi=function(t,e,i,n,r,s,o,a){this.parkSprite=null,_.call(this,t,e,i,n,r,s,o,a),this.isEntertainment=!0,this.parkTextures=dt.getTexturesByWidth(this.get_myParkTextures(),20),this.currentTexture=il.getInt(this.parkTextures.length),this.parkSprite=new PIXI.Sprite(this.parkTextures[this.currentTexture]),this.parkSprite.position.set(s.x,s.y),i.cacheableChildren.push(this.parkSprite),i.isInvalid=!0,this.adjecentBuildingEffects.push({name:"modernRusticHomeCommunityFeeling",intensity:1})};(q["buildings.RooftopPark"]=qi).__name__="buildings.RooftopPark",qi.__interfaces__=[oe],qi.__super__=_,qi.prototype=e(_.prototype,{get_myParkTextures:function(){return"spr_rooftoppark_plants"},get_changePlantsText:function(){return Tr.lo("change_plants")},get_baseEntertainmentCapacity:function(){return 35},get_isOpen:function(){var t=this.city.simulation.time.timeSinceStart/60%24;return 6<=t&&t<22},get_entertainmentType:function(){return 3},get_secondaryEntertainmentTypes:function(){return null},get_minimumNormalTimeToSpend:function(){return 1.5},get_maximumNormalTimeToSpend:function(){return 2.5},get_minimumEntertainmentGroupSatisfy:function(){return 1},get_maximumEntertainmentGroupSatisfy:function(){return 1.75},get_entertainmentQuality:function(){return 100},get_isOpenForExistingVisitors:function(){return this.get_isOpen()},finishEntertainment:function(t,e){return!0},get_drawerType:function(){return kn},get_drawerAsRooftopMerger:function(){return this.drawer},postLoad:function(){this.parkSprite.texture=this.parkTextures[this.currentTexture],this.bgStage.isInvalid=!0},postCreate:function(){_.prototype.postCreate.call(this),this.positionSprites()},positionSprites:function(){_.prototype.positionSprites.call(this),null!=this.parkSprite&&(this.parkSprite.position.set(this.position.x,this.position.y),this.bgStage.isInvalid=!0)},beEntertained:function(t,e){En.beEntertainedRooftopPark(this.get_drawerAsRooftopMerger().getLeftBuilding(this),this.get_drawerAsRooftopMerger().getRightBuilding(this),t)},createWindowAddBottomButtons:function(){var e=this;""!=this.get_changePlantsText()&&To.create(this.city.gui,function(){return e.currentTexture},function(t){e.currentTexture=t,e.parkSprite.texture=e.parkTextures[e.currentTexture],e.bgStage.isInvalid=!0},function(){return e.parkTextures.length},this.get_changePlantsText()),_.prototype.createWindowAddBottomButtons.call(this)},destroy:function(){_.prototype.destroy.call(this);var t=this.bgStage,e=this.parkSprite;at.remove(t.cacheableChildren,e),t.isInvalid=!0,e.destroy({children:!0,texture:!1})},save:function(t,e){null==e&&(e=!0),_.prototype.save.call(this,t),e&&t.addString(qi.saveDefinition);var i=this.currentTexture;if(t.size+4>t.bytes.length){var n=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+4))),t.bytes.blit(0,n,0,t.size)}t.bytes.setInt32(t.size,i),t.size+=4},load:function(t,e){_.prototype.load.call(this,t),null==e&&(e=t.readString());var i=Dr.makeLoadMap(e,t);Object.prototype.hasOwnProperty.call(i.h,"currentTexture")&&(this.currentTexture=i.h.currentTexture),this.postLoad()},__class__:qi});var Ki=function(t,e,i,n,r,s,o,a){this.schoolEndTime=16,this.schoolStartTime=7,ee.call(this,t,e,i,n,r,s,o,a),this.students=[]};(q["buildings.School"]=Ki).__name__="buildings.School",Ki.__super__=ee,Ki.prototype=e(ee.prototype,{get_studentCapacity:function(){return Math.round(30*this.city.policies.vars.schoolClassSizeMod)},get_educationPerDay:function(){return.07*this.city.policies.vars.schoolMaxEdu},get_educationCap:function(){return this.city.policies.vars.schoolMaxEdu},work:function(t,e,i){if(i)t.currentAction=2;else{var n=t.pathWalkSpeed*e;if(K.shouldUpdateDraw=!0,Math.abs(3-t.relativeX)<n)t.relativeX=3;else{var r=3-t.relativeX;t.relativeX+=(0<r?1:r<0?-1:0)*n}}},addWindowInfoLines:function(){var t=this;ee.prototype.addWindowInfoLines.call(this),this.city.gui.windowAddInfoText(null,function(){return Tr.lo("students",[t.students.length,t.get_studentCapacity()])})},destroy:function(){ee.prototype.destroy.call(this);for(var t=this.students.length;0<=--t;){this.students[t].leaveSchool()}},afterGiveJob:function(t){this.city.simulation.schoolAssigner.schoolsShouldBeUpdated=!0},beAtSchool:function(t,e){if(!t.hasBuildingInited){switch(this.students.indexOf(t)%3){case 0:var i=il.getInt(6,7);(r=0<(n=ka.pool)[2].length?n[2].splice(n[2].length-1,1)[0]:new Int32Array(2))[0]=4,r[1]=i,t.setPath(r,0,2,!0),t.pathEndFunction=null,t.pathOnlyRelatedTo=t.inPermanent;break;case 1:t.changeFloorAndMoveRandom(3,7);break;case 2:var n,r;i=il.getInt(12,16);(r=0<(n=ka.pool)[2].length?n[2].splice(n[2].length-1,1)[0]:new Int32Array(2))[0]=4,r[1]=i,t.setPath(r,0,2,!0),t.pathEndFunction=null,t.pathOnlyRelatedTo=t.inPermanent}var s=this.get_educationPerDay(),o=this.get_educationCap();t.educationLevel=Math.max(Math.min(t.educationLevel+s,o),t.educationLevel),t.hasBuildingInited=!0}},__class__:Ki});var $i=function(t,e,i,n,r,s,o,a){this.isCurrentlyActive=!1,this.mainTextureOther=0,this.mainTextureLeft=0,this.lightsAreOn=-1,this.knownEntertainedCitizenSet=0,this.knownEntertainedCitizen=null,this.hadLeftNightClub=!1,this.nightClubEntertainmentQuantity=0,this.mainTexturesLeft=dt.getTexturesByWidth("spr_synightclub_lefttextures",20),this.mainTextures=dt.getTexturesByWidth("spr_synightclub_maintextures",20),this.secondaryBackgroundSprites=[],this.mainTextureLeft=il.getInt(this.mainTexturesLeft.length),this.mainTextureOther=il.getInt(this.mainTextures.length),ee.call(this,t,e,i,n,r,s,o,a),this.mainSprite=new PIXI.Sprite(this.mainTextures[this.mainTextureOther]),this.mainSprite.position.set(s.x,s.y),i.addChild(this.mainSprite),this.positionSprites(),this.startTime=20,this.endTime=5.5,this.workTimePreferenceMod=.5,this.isEntertainment=!0};(q["buildings.ScrapyardNightClub"]=$i).__name__="buildings.ScrapyardNightClub",$i.__interfaces__=[oe],$i.__super__=ee,$i.prototype=e(ee.prototype,{get_baseEntertainmentCapacity:function(){return 120*this.workers.length+this.city.upgrades.vars.nightClubEntertainmentQualityBonus},get_isOpen:function(){if(1!=this.workers.length||0!=this.workers[0].currentAction)return!1;var t=this.city.simulation.time.timeSinceStart/60%24,e=this.startTime-this.workTimePreferenceMod;return e<6?e<=t&&t<6:e<=t||t<6},get_entertainmentType:function(){return 0},get_secondaryEntertainmentTypes:function(){return null},get_minimumNormalTimeToSpend:function(){return 5},get_maximumNormalTimeToSpend:function(){return 7},get_minimumEntertainmentGroupSatisfy:function(){return 1},get_maximumEntertainmentGroupSatisfy:function(){return 3},get_entertainmentQuality:function(){return 100},get_isOpenForExistingVisitors:function(){return this.get_isOpen()},finishEntertainment:function(t,e){return!0},get_drawerType:function(){return Rn},get_hasLeftNightClub:function(){return null!=this.leftBuilding&&this.leftBuilding.is($i)},get_hasRightNightClub:function(){return null!=this.rightBuilding&&this.rightBuilding.is($i)},reRegisterSecondaryImages:function(){for(var t=0,e=this.secondaryBackgroundSprites;t<e.length;){var i=e[t];++t,i.destroy()}if(this.secondaryBackgroundSprites.splice(0,this.secondaryBackgroundSprites.length),this.get_hasLeftNightClub())switch(this.mainTextureOther){case 0:(s=new PIXI.Sprite(dt.getTexture("spr_synightclub_lights"))).scale.y=1.1,this.secondaryBackgroundSprites.push(s),this.bgStage.addChild(s),(o=new PIXI.Sprite(dt.getTexture("spr_synightclub_lights"))).scale.y=1,this.secondaryBackgroundSprites.push(o),this.bgStage.addChild(o),(a=new PIXI.Sprite(dt.getTexture("spr_synightclub_lights"))).scale.y=1.1,this.secondaryBackgroundSprites.push(a),this.bgStage.addChild(a),(l=new PIXI.Sprite(dt.getTexture("spr_synightclub_lights"))).scale.y=1.3,this.secondaryBackgroundSprites.push(l),this.bgStage.addChild(l);var n=new PIXI.Sprite(dt.getTexture("spr_synightclub_lights"));n.scale.y=1,this.secondaryBackgroundSprites.push(n),this.bgStage.addChild(n),(t=[]).push({sprite:this.secondaryBackgroundSprites[0],blend:0}),t.push({sprite:this.secondaryBackgroundSprites[1],blend:60}),t.push({sprite:this.secondaryBackgroundSprites[2],blend:120}),t.push({sprite:this.secondaryBackgroundSprites[3],blend:180}),t.push({sprite:this.secondaryBackgroundSprites[4],blend:240}),this.lightColumnData=t;break;case 1:this.miniLightData=[];for(t=0;t<9;){var r=t++;(i=new PIXI.Sprite(dt.getTexture("spr_synightclub_minilight"))).alpha=0,this.bgStage.addChild(i),this.secondaryBackgroundSprites.push(i),this.miniLightData.push({waitTime:il.getInt(50),stage:0,sprite:i,alpha:0})}break;case 2:this.lightColumnData=[];for(t=0;t<6;){r=t++,i=new PIXI.Sprite(dt.getTexture("spr_synightclub_lights"));r<2?i.scale.y=1.2:r<4&&(i.scale.y=.7),i.alpha=0,this.bgStage.addChild(i),this.secondaryBackgroundSprites.push(i),this.lightColumnData.push({sprite:i,blend:120*r})}}else switch(this.mainTextureLeft){case 0:var s,o,a,l;(s=new PIXI.Sprite(dt.getTexture("spr_synightclub_lights"))).scale.y=.8,this.secondaryBackgroundSprites.push(s),this.bgStage.addChild(s),(o=new PIXI.Sprite(dt.getTexture("spr_synightclub_lights"))).scale.y=.4,this.secondaryBackgroundSprites.push(o),this.bgStage.addChild(o),(a=new PIXI.Sprite(dt.getTexture("spr_synightclub_lights"))).scale.y=.8,this.secondaryBackgroundSprites.push(a),this.bgStage.addChild(a),(l=new PIXI.Sprite(dt.getTexture("spr_synightclub_lights"))).scale.y=.5,this.secondaryBackgroundSprites.push(l),this.bgStage.addChild(l),(t=[]).push({sprite:this.secondaryBackgroundSprites[0],blend:0}),t.push({sprite:this.secondaryBackgroundSprites[1],blend:72}),t.push({sprite:this.secondaryBackgroundSprites[2],blend:144}),t.push({sprite:this.secondaryBackgroundSprites[3],blend:216}),this.lightColumnData=t;break;case 1:this.waterfallBaseHue=(60*this.position.x+75*this.position.y)%360;var i=new PIXI.Sprite(dt.getTexture("spr_synightclub_waterfalllight"));this.secondaryBackgroundSprites.push(i),this.bgStage.addChild(i);var i=new PIXI.Sprite(dt.getTexture("spr_synightclub_waterfalllight"));this.secondaryBackgroundSprites.push(i),this.bgStage.addChild(i);i=new PIXI.Sprite(dt.getTexture("spr_synightclub_waterfalllight"));this.secondaryBackgroundSprites.push(i),this.bgStage.addChild(i);var h=new PIXI.Sprite(dt.getTexture("spr_synightclub_waterfalllight_last"));this.secondaryBackgroundSprites.push(h),this.bgStage.addChild(h);break;case 2:this.lightColumnDataH=[],(i=new PIXI.Sprite(dt.getTexture("spr_synightclub_lights_h"))).alpha=0,this.bgStage.addChild(i),this.secondaryBackgroundSprites.push(i),this.lightColumnDataH.push({sprite:i,blend:0,targetBlend:il.getFloat(360)}),(i=new PIXI.Sprite(dt.getTexture("spr_synightclub_lights_h"))).alpha=0,this.bgStage.addChild(i),this.secondaryBackgroundSprites.push(i),this.lightColumnDataH.push({sprite:i,blend:120,targetBlend:il.getFloat(360)}),(i=new PIXI.Sprite(dt.getTexture("spr_synightclub_lights_h"))).alpha=0,this.bgStage.addChild(i),this.secondaryBackgroundSprites.push(i),this.lightColumnDataH.push({sprite:i,blend:240,targetBlend:il.getFloat(360)}),this.secondaryBackgroundSprites[0].scale.x=1.4,this.secondaryBackgroundSprites[1].scale.x=1.5,this.secondaryBackgroundSprites[2].scale.x=1.2}this.positionSprites(),this.activateOrDeactivateSprites(0<=this.lightsAreOn)},positionSprites:function(){if(ee.prototype.positionSprites.call(this),null!=this.mainSprite&&this.mainSprite.position.set(this.position.x,this.position.y),this.get_hasLeftNightClub())switch(this.mainTextureOther){case 0:null!=this.secondaryBackgroundSprites&&5<=this.secondaryBackgroundSprites.length&&(this.secondaryBackgroundSprites[0].position.set(this.position.x+2,this.position.y+3),this.secondaryBackgroundSprites[1].position.set(this.position.x+6,this.position.y+2),this.secondaryBackgroundSprites[2].position.set(this.position.x+10,this.position.y+3),this.secondaryBackgroundSprites[3].position.set(this.position.x+14,this.position.y+4),this.secondaryBackgroundSprites[4].position.set(this.position.x+17,this.position.y+2));break;case 1:null!=this.secondaryBackgroundSprites&&9<=this.secondaryBackgroundSprites.length&&(this.secondaryBackgroundSprites[0].position.set(this.position.x-1+3,this.position.y-1+3),this.secondaryBackgroundSprites[1].position.set(this.position.x-1+2,this.position.y-1+8),this.secondaryBackgroundSprites[2].position.set(this.position.x-1+3,this.position.y-1+14),this.secondaryBackgroundSprites[3].position.set(this.position.x-1+9,this.position.y-1+4),this.secondaryBackgroundSprites[4].position.set(this.position.x-1+7,this.position.y-1+9),this.secondaryBackgroundSprites[5].position.set(this.position.x-1+9,this.position.y-1+14),this.secondaryBackgroundSprites[6].position.set(this.position.x-1+14,this.position.y-1+4),this.secondaryBackgroundSprites[7].position.set(this.position.x-1+14,this.position.y-1+9),this.secondaryBackgroundSprites[8].position.set(this.position.x-1+13,this.position.y-1+14));break;case 2:null!=this.secondaryBackgroundSprites&&6<=this.secondaryBackgroundSprites.length&&(this.secondaryBackgroundSprites[0].position.set(this.position.x+3,this.position.y+3),this.secondaryBackgroundSprites[1].position.set(this.position.x+4,this.position.y+3),this.secondaryBackgroundSprites[2].position.set(this.position.x+9,this.position.y+8),this.secondaryBackgroundSprites[3].position.set(this.position.x+10,this.position.y+8),this.secondaryBackgroundSprites[4].position.set(this.position.x+15,this.position.y+5),this.secondaryBackgroundSprites[5].position.set(this.position.x+16,this.position.y+5))}else switch(this.mainTextureLeft){case 0:null!=this.secondaryBackgroundSprites&&4<=this.secondaryBackgroundSprites.length&&(this.secondaryBackgroundSprites[0].position.set(this.position.x+3,this.position.y+2),this.secondaryBackgroundSprites[1].position.set(this.position.x+7,this.position.y+4),this.secondaryBackgroundSprites[2].position.set(this.position.x+12,this.position.y+3),this.secondaryBackgroundSprites[3].position.set(this.position.x+16,this.position.y+4));break;case 1:null!=this.secondaryBackgroundSprites&&4<=this.secondaryBackgroundSprites.length&&(this.secondaryBackgroundSprites[0].position.set(this.position.x+2,this.position.y+1),this.secondaryBackgroundSprites[1].position.set(this.position.x+6,this.position.y+5),this.secondaryBackgroundSprites[2].position.set(this.position.x+10,this.position.y+9),this.secondaryBackgroundSprites[3].position.set(this.position.x+15,this.position.y+13));break;case 2:null!=this.secondaryBackgroundSprites&&3<=this.secondaryBackgroundSprites.length&&(this.secondaryBackgroundSprites[0].position.set(this.position.x+4,this.position.y+3),this.secondaryBackgroundSprites[1].position.set(this.position.x+3,this.position.y+7),this.secondaryBackgroundSprites[2].position.set(this.position.x+6,this.position.y+11))}},updateSecondaryImages:function(t){if(this.get_hasLeftNightClub())switch(this.mainTextureOther){case 0:for(n=0,r=this.lightColumnData;n<r.length;){s=r[n];++n;o=[s.blend,.65,1],a=hh.toRgb(o);s.sprite.tint=mr.toHexInt(a),s.blend=(s.blend+t)%360}break;case 1:for(n=0,r=this.miniLightData;n<r.length;){var e=r[n];switch(++n,e.stage){case 0:if(e.waitTime-=t,e.waitTime<=0){e.waitTime=0;o=[il.getInt(360),il.getFloat(.6,.9),1],a=hh.toRgb(o);e.sprite.tint=mr.toHexInt(a),e.stage=1}break;case 1:e.alpha+=.1*t,1<=e.alpha&&(e.alpha=1,e.stage=2,e.waitTime=il.getFloat(20,90)),e.sprite.alpha=e.alpha;break;case 2:e.waitTime-=t,e.waitTime<=0&&(e.waitTime=0,e.stage=3);break;case 3:e.alpha-=.1*t,e.alpha<=0&&(e.alpha=0,e.stage=0,e.waitTime=il.getFloat(5)),e.sprite.alpha=e.alpha}}break;case 2:for(n=0;n<6;){var i=n++;o=[(s=this.lightColumnData[i]).blend,.75-.01*i,1],a=hh.toRgb(o);s.sprite.tint=mr.toHexInt(a),s.blend=(s.blend+t*(i%2==0?1.5:-1.5)+360)%360}}else switch(this.mainTextureLeft){case 0:for(var n=0,r=this.lightColumnData;n<r.length;){var s=r[n];++n;var o=[s.blend,.65,1],a=hh.toRgb(o);s.sprite.tint=mr.toHexInt(a),s.blend=(s.blend+t)%360}break;case 1:this.waterfallBaseHue+=.5*t;for(var l=0,n=0,r=this.secondaryBackgroundSprites;n<r.length;){var h=r[n];++n;var o=[(this.waterfallBaseHue+l)%360,.7,1];h.tint=mr.toHexInt(hh.toRgb(o)),l+=25}break;case 2:for(var n=0,r=this.lightColumnDataH;n<r.length;){var s=r[n];++n;var o=[s.blend,.65,1],a=hh.toRgb(o);s.sprite.tint=mr.toHexInt(a);var u=s.targetBlend-s.blend,c=0<u?1:u<0?-1:0;s.blend=(s.blend+(180<Math.abs(u)?-c:c)*t+360)%360,Math.abs(u)<2&&(s.targetBlend=il.getFloat(360))}}},activateOrDeactivateSprites:function(t){if(!this.get_hasLeftNightClub()&&0==this.mainTextureLeft||!this.get_hasLeftNightClub()&&1==this.mainTextureLeft||!this.get_hasLeftNightClub()&&2==this.mainTextureLeft||this.get_hasLeftNightClub()&&0==this.mainTextureOther||this.get_hasLeftNightClub()&&2==this.mainTextureOther)for(var e=0,i=this.secondaryBackgroundSprites;e<i.length;){var n=i[e];++e,n.alpha=t?1:0}else if(this.get_hasLeftNightClub()&&1==this.mainTextureOther)for(e=0,i=this.miniLightData;e<i.length;){var r=i[e];++e,r.sprite.alpha=t?1:0,t||(r.alpha=0,r.stage=0)}},onCityChange:function(){if(this.hadLeftNightClub!=this.get_hasLeftNightClub()){var t=this.get_hasLeftNightClub()?this.mainTextures[this.mainTextureOther]:this.mainTexturesLeft[this.mainTextureLeft];this.mainSprite.texture=t,this.hadLeftNightClub=this.get_hasLeftNightClub(),this.reRegisterSecondaryImages()}},postCreate:function(){ee.prototype.postCreate.call(this);var t=this.get_hasLeftNightClub()?this.mainTextures[this.mainTextureOther]:this.mainTexturesLeft[this.mainTextureLeft];this.mainSprite.texture=t,this.hadLeftNightClub=this.get_hasLeftNightClub(),this.reRegisterSecondaryImages(),this.positionSprites()},destroy:function(){if(ee.prototype.destroy.call(this),this.mainSprite.destroy(),null!=this.secondaryBackgroundSprites)for(var t=0,e=this.secondaryBackgroundSprites;t<e.length;){var i=e[t];++t,i.destroy()}},work:function(t,e,i){if(i&&6<this.city.simulation.time.timeSinceStart/60%24)t.currentAction=2;else if(this.get_hasLeftNightClub())t.moveAndWait(il.getInt(0,this.get_hasRightNightClub()?19:17),il.getInt(20,50),null,!1,!1),this.lightsAreOn=60;else{var n=t.pathWalkSpeed*e;if(K.shouldUpdateDraw=!0,Math.abs(1-t.relativeX)<n)t.relativeX=1;else{var r=1-t.relativeX;t.relativeX+=(0<r?1:r<0?-1:0)*n}this.lightsAreOn=3}},beEntertained:function(t,e){null==this.knownEntertainedCitizen?(this.knownEntertainedCitizen=t,this.knownEntertainedCitizenSet=60):this.knownEntertainedCitizen==t&&(this.knownEntertainedCitizenSet=60);var i=il.getInt(2+(this.get_hasLeftNightClub()?1:0)+(this.get_hasRightNightClub()?1:0));if(this.get_hasLeftNightClub()&&0==i&&this.leftBuilding.get_isOpen())(r=0<(n=ka.pool)[6].length?n[6].splice(n[6].length-1,1)[0]:new Int32Array(6))[0]=2,r[1]=0,r[2]=4,r[3]=il.getInt(5,19),r[4]=8,r[5]=il.getInt(5,6),t.setPath(r,0,6,!0);else if(this.get_hasRightNightClub()&&1==i&&this.rightBuilding.get_isOpen()){var n,r;(r=0<(n=ka.pool)[6].length?n[6].splice(n[6].length-1,1)[0]:new Int32Array(6))[0]=3,r[1]=0,r[2]=4,r[3]=il.getInt(0,17),r[4]=8,r[5]=il.getInt(5,6),t.setPath(r,0,6,!0)}else{var s=this.get_hasLeftNightClub()?0:5,o=this.get_hasRightNightClub()?19:17,a=!1;null==a&&(a=!1),t.moveAndWait(il.getInt(s,o),il.getInt(8,9),null,a,!1)}t.hasBuildingInited||(t.wantsNightEntertainmentIn=il.getInt(1,5),t.hasBuildingInited=!0)},createWindowAddBottomButtons:function(){var i=this;To.create(this.city.gui,function(){return i.get_hasLeftNightClub()?i.mainTextureOther:i.mainTextureLeft},function(t){var e;e=i.get_hasLeftNightClub()?(i.mainTextureOther=t,i.mainTextures[i.mainTextureOther]):(i.mainTextureLeft=t,i.mainTexturesLeft[i.mainTextureLeft]),i.mainSprite.texture=e,i.reRegisterSecondaryImages()},function(){return i.get_hasLeftNightClub()?i.mainTextures.length:i.mainTexturesLeft.length},Tr.lo("change_machines")),ee.prototype.createWindowAddBottomButtons.call(this)},update:function(t){ee.prototype.update.call(this,t),this.lightsAreOn-=Math.min(1,t);var e=0<this.lightsAreOn||1<=this.workers.length&&this.workers[0].inPermanent==this&&0==this.workers[0].currentAction;e!=this.isCurrentlyActive&&(this.isCurrentlyActive=e,this.activateOrDeactivateSprites(this.isCurrentlyActive)),this.isCurrentlyActive&&this.updateSecondaryImages(t)},save:function(t,e){null==e&&(e=!0),ee.prototype.save.call(this,t),e&&t.addString($i.saveDefinition);var i=this.mainTextureLeft;if(t.size+4>t.bytes.length){var n=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+4))),t.bytes.blit(0,n,0,t.size)}t.bytes.setInt32(t.size,i),t.size+=4;i=this.mainTextureOther;if(t.size+4>t.bytes.length){n=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+4))),t.bytes.blit(0,n,0,t.size)}t.bytes.setInt32(t.size,i),t.size+=4},load:function(t,e){if(ee.prototype.load.call(this,t),!(t.version<15)){null==e&&(e=t.readString());var i=Dr.makeLoadMap(e,t);Object.prototype.hasOwnProperty.call(i.h,"mainTextureLeft")&&(this.mainTextureLeft=i.h.mainTextureLeft),Object.prototype.hasOwnProperty.call(i.h,"mainTextureOther")&&(this.mainTextureOther=i.h.mainTextureOther)}},__class__:$i});function Qi(t,e,i,n,r,s,o,a){this.isScenarioVariant=!1,this.givenStatueReward=!1,this.timeToCheckBuildings=0,this.currentMission=0,this.ownPub=null,this.manyTeleportAlpha=0,this.eventPhase=0,this.doingEvent=-1,this.lastEventDoneOnDay=0,ce.call(this,t,e,i,n,r,s,o,a),this.startTime=12,this.endTime=2,this.workTimePreferenceMod=.3,this.isScenarioVariant="cityofthekey"==n.progress.story.storyName}(q["buildings.SecretSocietyHouse"]=Qi).__name__="buildings.SecretSocietyHouse",Qi.__super__=ce,Qi.prototype=e(ce.prototype,{onBuild:function(){this.city.progress.unlocks.unlock(sr)},addWindowInfoLines:function(){var t=this;ce.prototype.addWindowInfoLines.call(this),this.city.gui.windowInner.addChild(new Ms(this.city.gui.window,new vr(4,4))),this.isScenarioVariant||(this.city.gui.windowAddInfoText(null,function(){return t.missionGetTitle()},"Arial15"),this.city.gui.windowAddInfoText(null,function(){return t.missionGetText()}))},missionGetTitle:function(){return 8==this.currentMission?Tr.lo("thank_you"):Tr.lo("current_task")},missionGetText:function(){return 8<=this.currentMission?Tr.lo("forever_grateful"):this.workers.length!=this.get_jobs()?Tr.lo("jobs_filled_secretsociety"):Tr.lo("secret_society_mission_"+this.currentMission)},checkMissionCompletions:function(){for(var t=!1;;){switch(t=!1,this.currentMission){case 0:t=gr.any(this.city.upgrades.upgrades,function(t){return t instanceof sr});break;case 1:t=gr.any(this.city.simulation.stats.materialProduction[ct.findMaterialIndex("wood")],function(t){return 1e3<=t});break;case 6:(t=gr.any(this.city.simulation.stats.materialProduction[ct.findMaterialIndex("knowledge")],function(t){return 1e3<=t}))&&this.city.progress.unlocks.unlock(fn)}if(0!=this.currentMission&&1!=this.currentMission&&6!=this.currentMission&&this.currentMission<8&&this.timeToCheckBuildings<=0){var e=this.city.getAmountOfPermanentsPerType();switch(this.currentMission){case 2:(t=50<=e.h["buildings.BotanicalGardens"])&&this.city.progress.unlocks.unlock(nn);break;case 3:t=12<=e.h["buildings.StatueGarden"];break;case 4:(t=7<=e.h["buildings.Teleporter"])&&this.city.progress.unlocks.unlock(xn);break;case 5:t=5<=e.h["buildings.Villa"];break;case 7:t=1<=e.h["buildings.TheMachine"]}this.timeToCheckBuildings=30}if(t&&(this.currentMission+=1,this.timeToCheckBuildings=0,this.city.progress.goalHelp.updateHasBuildingGoal()),!t)break}},update:function(t){if(ce.prototype.update.call(this,t),1==this.doingEvent&&1<=this.eventPhase)if(this.manyTeleportAlpha<1){this.manyTeleportAlpha+=.05;for(var e=0,i=this.workers;e<i.length;){var n=i[e];++e,n.sprite.alpha=this.manyTeleportAlpha}}else{this.doingEvent=-1;for(e=this.eventPhase=0,i=this.workers;e<i.length;){n=i[e];++e,n.sprite.alpha=1}}if(this.isScenarioVariant||this.checkMissionCompletions(),this.timeToCheckBuildings-=t,!this.givenStatueReward)for(e=0,i=this.workers;e<i.length;){n=i[e];++e,500<=n.get_age()&&(this.givenStatueReward||this.city.progress.unlocks.unlock(sn),this.givenStatueReward=!0)}},work:function(t,e,i){var n=this;if(-1!=this.doingEvent){if(1==this.doingEvent){if(0==this.eventPhase)if(gr.all(this.workers,function(t){return!(null==t.inPermanent||!t.inPermanent.is(dn)||t.relativeX!=t.inPermanent.teleportX||null!=t.path)&&!t.isRequestingPath})){this.eventPhase=1;for(var r=0,s=this.workers;r<s.length;){var o=s[r];++r;var a=o.inPermanent;null!=a&&(a.createTeleportParticle("spr_teleporter_ray_key"),a.timesUsed+=1),o.onWorld=this.world,o.setRelativePos(il.getInt(this.world.rect.width-2),0),o.inPermanent=null,o.addToOnWorldStage(),o.sprite.alpha=0,this.manyTeleportAlpha=0}}else if(null!=t.inPermanent&&t.inPermanent.is(dn)){var l=t.inPermanent.teleportX,h=t.pathWalkSpeed*e;if(K.shouldUpdateDraw=!0,Math.abs(l-t.relativeX)<h)t.relativeX=l;else{var u=l-t.relativeX;t.relativeX+=(0<u?1:u<0?-1:0)*h}}else{var c=this.city.simulation.permanentFinder.quickQueryForCitizen(t,function(t){return t.is(dn)},"secretSocietyTeleporterQuery"+this.id,3);null==c?this.doingEvent=-1:(t.simulation.pathfinder.findPath(t,c),t.pathOnFail=null)}return}if(2==this.doingEvent){if(null!=t.inPermanent&&t.inPermanent==this.ownPub)return""==(f=t.inPermanent).markingTexture&&f.setMarking("spr_pub_marking_key"),void(5<=((0|this.city.simulation.time.timeSinceStart)/60|0)%24&&((0|this.city.simulation.time.timeSinceStart)/60|0)%24<10?this.doingEvent=-1:f.beEntertained(t,e));var d=!0;if(null!=this.ownPub&&this.ownPub.destroyed&&(this.ownPub=null),null==this.ownPub)for(r=0,s=this.city.permanents;r<s.length;){var p=s[r];if(++r,p.is(Ni)){var f;if("spr_pub_marking_key"==(f=p).markingTexture){this.ownPub=f;break}d=!1}}if(null==this.ownPub&&!d){var g=this.city.simulation.permanentFinder.quickQueryForCitizen(t,function(t){return!!t.is(Ni)&&""==t.markingTexture},"secretSocietyPub"+this.id,3);null==g?this.doingEvent=-1:this.ownPub=g}return void(null!=this.ownPub&&(t.simulation.pathfinder.findPath(t,this.ownPub),t.pathOnFail=function(){n.doingEvent=-1}))}}if(t.inPermanent!=this)return t.simulation.pathfinder.findPath(t,this),void(t.pathOnFail=null);i?t.currentAction=2:(this.walkAround(t,150),15<((0|this.city.simulation.time.timeSinceStart)/60|0)%24&&1+((0|this.city.simulation.time.timeSinceStart)/1440|0)>this.lastEventDoneOnDay&&(this.doingEvent=il.getInt(1,3),1!=this.doingEvent||0!=this.world.rect.height&&this.world.surfaceShardId==this.shardId||(this.doingEvent=2),this.eventPhase=0,this.lastEventDoneOnDay=1+((0|this.city.simulation.time.timeSinceStart)/1440|0)))},walkAround:function(t,e){var i=il.getInt(5);if(0==i&&120<e)t.changeFloorAndWaitRandom(30,60);else if(1==i||2==i&&t.relativeY<5)t.moveAndWait(il.getInt(3,7),il.getInt(30,60),null,!1,!1);else if(2==i)t.moveAndWait(il.getInt(12,16),il.getInt(30,60),null,!1,!1);else{var n=ka.pool,r=0<n[2].length?n[2].splice(n[2].length-1,1)[0]:new Int32Array(2);r[0]=8,r[1]=il.getInt(90,120),t.setPath(r,0,2,!0),t.pathEndFunction=null,t.pathOnlyRelatedTo=t.inPermanent}},getGlobalGoal:function(){return 8==this.currentMission?null:this.isScenarioVariant?null:{category:Tr.lo("secret_society_mission"),text:this.missionGetText()}},save:function(t,e){null==e&&(e=!0),ce.prototype.save.call(this,t),e&&t.addString(Qi.saveDefinition);var i=this.lastEventDoneOnDay;if(t.size+4>t.bytes.length){var n=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+4))),t.bytes.blit(0,n,0,t.size)}t.bytes.setInt32(t.size,i),t.size+=4;i=this.doingEvent;if(t.size+4>t.bytes.length){n=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+4))),t.bytes.blit(0,n,0,t.size)}t.bytes.setInt32(t.size,i),t.size+=4;i=this.eventPhase;if(t.size+4>t.bytes.length){n=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+4))),t.bytes.blit(0,n,0,t.size)}t.bytes.setInt32(t.size,i),t.size+=4;i=this.currentMission;if(t.size+4>t.bytes.length){n=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+4))),t.bytes.blit(0,n,0,t.size)}t.bytes.setInt32(t.size,i),t.size+=4},load:function(t,e){ce.prototype.load.call(this,t),null==e&&(e=t.readString());var i=Dr.makeLoadMap(e,t);Object.prototype.hasOwnProperty.call(i.h,"lastEventDoneOnDay")&&(this.lastEventDoneOnDay=i.h.lastEventDoneOnDay),Object.prototype.hasOwnProperty.call(i.h,"doingEvent")&&(this.doingEvent=i.h.doingEvent),Object.prototype.hasOwnProperty.call(i.h,"eventPhase")&&(this.eventPhase=i.h.eventPhase),Object.prototype.hasOwnProperty.call(i.h,"currentMission")&&(this.currentMission=i.h.currentMission)},__class__:Qi});function Ji(t,e,i,n,r,s,o,a){re.call(this,t,e,i,n,r,s,o,a)}(q["buildings.ShadyHome"]=Ji).__name__="buildings.ShadyHome",Ji.__super__=re,Ji.prototype=e(re.prototype,{get_possibleUpgrades:function(){return[]},walkAround:function(t,e){var i=il.getInt(3);if(0==i&&120<e)t.changeFloorAndWaitRandom(30,60);else if(1==i)if(t.relativeY<5){var n=il.getInt(3);0==n?t.moveAndWait(il.getInt(3,5),il.getInt(30,60),null,!1,!1):1==n?t.moveAndWait(il.getInt(9,10),il.getInt(30,60),null,!1,!1):t.moveAndWait(il.getInt(14,15),il.getInt(30,60),null,!1,!1)}else t.moveAndWait(il.getInt(5,15),il.getInt(30,60),null,!1,!1);else{var r=ka.pool,s=0<r[2].length?r[2].splice(r[2].length-1,1)[0]:new Int32Array(2);s[0]=8,s[1]=il.getInt(90,120),t.setPath(s,0,2,!0),t.pathEndFunction=null,t.pathOnlyRelatedTo=t.inPermanent}},__class__:Ji});function Zi(t,e,i,n,r,s,o,a){_.call(this,t,e,i,n,r,s,o,a)}(q["buildings.SpaceShipTunnel"]=Zi).__name__="buildings.SpaceShipTunnel",Zi.__super__=_,Zi.prototype=e(_.prototype,{get_drawerType:function(){return Bn},get_walkThroughCanViewSelfInThisBuilding:function(){return null==this.bottomBuilding||!this.bottomBuilding.is(yi)&&!this.bottomBuilding.is(Zi)},__class__:Zi});var tn=function(t,e,i,n,r,s,o,a){re.call(this,t,e,i,n,r,s,o,a)};(q["buildings.SpaciousHouse"]=tn).__name__="buildings.SpaciousHouse",tn.__super__=re,tn.prototype=e(re.prototype,{get_possibleUpgrades:function(){return[Gt,Xt]},walkAround:function(t,e){var i=il.getInt(3);if(0==i&&120<e)t.changeFloorAndWaitRandom(30,60);else if(1==i)t.relativeY<5?t.moveAndWait(il.getInt(3,15),il.getInt(30,60),null,!1,!1):1==il.getInt(2)?t.moveAndWait(il.getInt(3,7),il.getInt(30,60),null,!1,!1):t.moveAndWait(il.getInt(12,16),il.getInt(30,60),null,!1,!1);else{var n=ka.pool,r=0<n[2].length?n[2].splice(n[2].length-1,1)[0]:new Int32Array(2);r[0]=8,r[1]=il.getInt(90,120),t.setPath(r,0,2,!0),t.pathEndFunction=null,t.pathOnlyRelatedTo=t.inPermanent}},__class__:tn});function en(t,e,i,n,r,s,o,a){ee.call(this,t,e,i,n,r,s,o,a),this.isMedical=!0}(q["buildings.SpecializedMedicalClinic"]=en).__name__="buildings.SpecializedMedicalClinic",en.__interfaces__=[ei],en.__super__=ee,en.prototype=e(ee.prototype,{get_medicalQuality:function(){return 100},get_medicalCapacity:function(){return 50*(0==this.workers.length?0:gr.sum(this.workers,function(t){return t.get_educationSpeedModifier()}))},get_possibleUpgrades:function(){return[]},get_medicalTypeLimit:function(){return 1},get_medicalTypeID:function(){return 0},work:function(t,e,i){if(i)t.currentAction=2;else if(t.relativeY<5&&1==this.workers.indexOf(t))t.changeFloor();else{var n=!1,r=!0;null==r&&(r=!1),null==n&&(n=!1),t.moveAndWait(il.getInt(3,t.relativeY<5?17:8),il.getInt(60,90),null,n,r)}},addWindowInfoLines:function(){var t=this;ee.prototype.addWindowInfoLines.call(this),this.city.gui.windowAddInfoText(null,function(){return Tr.lo("capacity",[Math.floor(t.get_medicalCapacity())])}),this.city.gui.windowAddInfoText(null,function(){return Tr.lo("quality",[Math.floor(t.get_medicalQuality())])})},createMainWindowPart:function(){var e=this;ee.prototype.createMainWindowPart.call(this);var i=new ps(this.city.gui,this.city.gui.innerWindowStage,this.city.gui.windowInner);this.city.gui.windowInner.addChild(i);function t(){i.padding.bottom=6;var t=null;t=function(){e.city.gui.createWindow("birthControlWindow"),e.city.gui.addWindowToStack(t),ts.create(e.city,e.city.gui,e.city.gui.innerWindowStage,e.city.gui.windowInner),e.city.gui.setWindowReload(t)},i.addChild(new oo(e.city.gui,e.city.gui.innerWindowStage,i,t,Tr.lo("manage_birth_control")))}if(this.city.upgrades.vars.hasBirthControl)t();else{var n=!0;i.onUpdate=function(){n&&e.city.upgrades.vars.hasBirthControl&&(n=!1,t())}}},__class__:en});var nn=function(t,e,i,n,r,s,o,a){this.mirrored=!1,Ae.call(this,t,e,i,n,r,s,o,a)};(q["buildings.StatueGarden"]=nn).__name__="buildings.StatueGarden",nn.__super__=Ae,nn.prototype=e(Ae.prototype,{get_myParkTextures:function(){return"spr_statuegarden_statues"},get_changePlantsText:function(){return Tr.lo("change_sculptures")},get_entertainmentType:function(){return 2},get_baseEntertainmentCapacity:function(){return 40},get_numberOfLockedParkTextures:function(){return 0},postLoad:function(){Ae.prototype.postLoad.call(this),this.mirrored&&this.mirrorSprite()},mirrorSprite:function(){this.mirrored?(this.parkSprite.anchor.set(1,0),this.parkSprite.scale.set(-1,1)):(this.parkSprite.anchor.set(0,0),this.parkSprite.scale.set(1,1)),this.bgStage.isInvalid=!0},createWindowAddBottomButtons:function(){var t=this;Io.create(this.city.gui,function(){t.mirrored=!t.mirrored,t.mirrorSprite()},this.city.gui.windowInner,function(){return Tr.lo("mirror")},this.city.gui.innerWindowStage),this.city.gui.windowInner.addChild(new Ms(this.city.gui.windowInner,new vr(2,4))),Ae.prototype.createWindowAddBottomButtons.call(this)},addWindowInfoLines:function(){var e=this;Ae.prototype.addWindowInfoLines.call(this);var i=!1,n=new ps(this.city.gui,this.city.gui.innerWindowStage,this.city.gui.windowInner),r=null;this.city.gui.windowInner.addChild(n),this.city.gui.windowInner.onUpdate=function(){if(0==e.currentTexture){if(!i){i=!0,(r=new ps(e.city.gui,e.city.gui.innerWindowStage,n)).direction=Ps.Vertical,r.addChild(new Ms(r,new vr(2,6))),r.addChild(new ao(r,e.city.gui.innerWindowStage,Tr.lo("dev_message"),null,"Arial15")),r.addChild(new ao(r,e.city.gui.innerWindowStage,Tr.lo("climate_crisis_message_1")));var t=null;t=function(){e.city.gui.createWindow("climateCrisisWindow",dt.getTexture("spr_9p_window_moreopaque")),e.city.gui.addWindowToStack(t),as.create(e.city,e.city.gui,e.city.gui.innerWindowStage,e.city.gui.windowInner)},r.addChild(new oo(e.city.gui,e.city.gui.innerWindowStage,r,t,Tr.lo("see_what_you_can_do"))),r.addChild(new Ms(r,new vr(2,6))),n.addChild(r),e.city.gui.setWindowPositioning(fo.CenterOffset(r.rect.height/2|0))}}else i&&(i=!1,n.removeChild(r),e.city.gui.setWindowPositioning(fo.Center))}},save:function(t,e){null==e&&(e=!0),Ae.prototype.save.call(this,t),e&&t.addString(nn.saveDefinition);var i=this.mirrored;if(t.size+1>t.bytes.length){var n=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+1))),t.bytes.blit(0,n,0,t.size)}t.bytes.b[t.size]=i?1:0,t.size+=1},load:function(t,e){Ae.prototype.load.call(this,t),null==e&&(e=t.readString());var i=Dr.makeLoadMap(e,t);Object.prototype.hasOwnProperty.call(i.h,"mirrored")&&(this.mirrored=i.h.mirrored),this.postLoad()},__class__:nn});function rn(t,e,i,n,r,s,o,a){Ae.call(this,t,e,i,n,r,s,o,a),this.currentTexture=0,this.parkSprite.texture=this.parkTextures[this.currentTexture]}(q["buildings.StatueOfHappiness"]=rn).__name__="buildings.StatueOfHappiness",rn.__super__=Ae,rn.prototype=e(Ae.prototype,{get_myParkTextures:function(){return"spr_statueofhappiness"},get_changePlantsText:function(){return Tr.lo("change_statue")},get_entertainmentType:function(){return 2},get_baseEntertainmentCapacity:function(){return 80},get_numberOfLockedParkTextures:function(){return 0},save:function(t,e){null==e&&(e=!0),Ae.prototype.save.call(this,t),e&&t.addString(rn.saveDefinition)},load:function(t,e){Ae.prototype.load.call(this,t),null==e&&(e=t.readString());Dr.makeLoadMap(e,t)},__class__:rn});var sn=function(t,e,i,n,r,s,o,a){Ae.call(this,t,e,i,n,r,s,o,a),this.currentTexture=0,this.parkSprite.texture=this.parkTextures[this.currentTexture]};(q["buildings.StatueOfTheKey"]=sn).__name__="buildings.StatueOfTheKey",sn.__super__=Ae,sn.prototype=e(Ae.prototype,{get_myParkTextures:function(){return"spr_statueofthekey"},get_changePlantsText:function(){return Tr.lo("change_statue")},get_entertainmentType:function(){return 2},get_baseEntertainmentCapacity:function(){return 80},get_numberOfLockedParkTextures:function(){return 0},save:function(t,e){null==e&&(e=!0),Ae.prototype.save.call(this,t),e&&t.addString(sn.saveDefinition)},load:function(t,e){Ae.prototype.load.call(this,t),null==e&&(e=t.readString());Dr.makeLoadMap(e,t)},__class__:sn});function on(t,e,i,n,r,s,o,a){this.stoneMinedPerActionBoost=1,ye.call(this,t,e,i,n,r,s,o,a)}(q["buildings.StoneMine"]=on).__name__="buildings.StoneMine",on.__super__=ye,on.prototype=e(ye.prototype,{get_stoneMinedPerAction:function(){return.2*this.stoneMinedPerActionBoost},get_possibleUpgrades:function(){return[H,z]},work:function(t,e,i){var r=this;this.doBlueCollarJob(t,e,i,[Eh,hn],function(t){var e=r.get_stoneMinedPerAction(),i=r.city.simulation,n=e*(r.city.progress.story.hiddenBoost&&r.city.materials.stone<=4?B.earlyGameFix1?1.6:2:1)*r.city.upgrades.vars.stoneMiningSpeed*(B.earlyGameFix1&&i.citizens.length<30?1.3-i.citizens.length/60*.3:1)*r.city.simulation.boostManager.currentGlobalBoostAmount;r.city.materials.stone+=n,r.city.simulation.stats.materialProduction[2][0]+=n,t.materialsLeft-=n},90,120)},__class__:on});var an=function(t,e,i,n,r,s,o,a){this.hasPickaxeTech=!1,this.currentBonus=0,this.totalKnowledgeGenerated=0,ee.call(this,t,e,i,n,r,s,o,a)};(q["buildings.StoneResearchCenter"]=an).__name__="buildings.StoneResearchCenter",an.__super__=ee,an.prototype=e(ee.prototype,{get_possibleUpgrades:function(){return[Ft,yt]},postCreate:function(){this.recalculateBonus()},work:function(t,e,i){if(i)t.currentAction=2;else{var n=il.getInt(3);0==n?t.changeFloorAndWait(50):1==n?t.moveAndWait(il.getInt(3,7),il.getInt(50,80),null,!1,!1):2==n&&t.moveAndWait(il.getInt(12,16),il.getInt(50,80),null,!1,!1)}},update:function(t){this.recalculateBonus()},recalculateBonus:function(){this.currentBonus=0;var t=this.city.simulation.stats.materialProduction[ct.findMaterialIndex("knowledge")],e=0;2<=t.length?e=t[1]:1<=t.length&&(e=t[0]);var i=this.hasPickaxeTech?195:200,n=this.hasPickaxeTech?.1:.075,r=this.hasPickaxeTech?1.65:2;this.currentBonus=e<i?e/i*.15:Math.log(e/i)/Math.log(r)*n+.15,this.hasPickaxeTech&&(this.currentBonus+=25e-6*e),this.currentBonus*=this.workers.length/this.get_jobs(),this.currentBonus=Math.max(0,this.currentBonus),this.city.upgrades.vars.stoneMiningSpeed=1+this.currentBonus,1<=this.currentBonus&&dr.achieve("HUGE_STONE_BONUS")},addWindowInfoLines:function(){var t=this;ee.prototype.addWindowInfoLines.call(this),this.city.gui.windowAddInfoText(null,function(){return t.recalculateBonus(),Tr.lo("stone_mining_boost",[100*t.currentBonus|0])}),this.city.gui.windowAddInfoText(Tr.lo("stone_mining_boost_base")),this.city.upgrades.vars.stoneResearchCenterWithFossils==this&&this.city.gui.windowAddInfoText(null,function(){return Tr.lo("fossils_found",[0|t.city.simulation.bonuses.fossilsCollected])})},save:function(t,e){null==e&&(e=!0),ee.prototype.save.call(this,t),e&&t.addString(an.saveDefinition);var i=this.totalKnowledgeGenerated;if(t.size+8>t.bytes.length){var n=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+8))),t.bytes.blit(0,n,0,t.size)}t.bytes.setDouble(t.size,i),t.size+=8},load:function(t,e){ee.prototype.load.call(this,t),null==e&&(e=t.readString());var i=Dr.makeLoadMap(e,t);Object.prototype.hasOwnProperty.call(i.h,"totalKnowledgeGenerated")&&(this.totalKnowledgeGenerated=i.h.totalKnowledgeGenerated)},__class__:an});function ln(){}(q["worldResources.ILimitedMaterialGatherPlace"]=ln).__name__="worldResources.ILimitedMaterialGatherPlace",ln.__isInterface__=!0,ln.prototype={__class__:ln};var hn=function(t,e,i,n,r,s,o,a){this.hasBigStone=!1,this.hasRemoteControl=!1,this.teleportButtonNotPressedTime=0,this.teleportButtonPressed=!1,this.maxCitizenX=13,this.minCitizenX=5,this.initialMaterials=50,ee.call(this,t,e,i,n,r,s,o,a),this.updateStoneTextures(),this.stoneSprite=new PIXI.Sprite(this.stoneTextures[0]),i.addChild(this.stoneSprite),this.positionSprites(),this.doorX=12,this.materialsLeft=0,this.regrowProgress=0,this.teleportButtonNotPressedTime=0,this.updateTexture()};(q["buildings.StoneTeleporter"]=hn).__name__="buildings.StoneTeleporter",hn.__interfaces__=[ln],hn.__super__=ee,hn.prototype=e(ee.prototype,{get_destroyedOnEmpty:function(){return!1},get_resourceName:function(){return"stone"},get_doNotGather:function(){return!1},get_regrowSpeed:function(){return 0},get_stayIfEmpty:function(){return!0},get_possibleUpgrades:function(){return[Yt]},postLoad:function(){this.hasBigStone&&(this.initialMaterials=150,this.updateStoneTextures()),this.updateTexture()},work:function(t,e,i){var n=this;if(i)t.currentAction=2;else{if(!this.hasRemoteControl){var r=t.pathWalkSpeed*e;if(K.shouldUpdateDraw=!0,Math.abs(3-t.relativeX)<r)t.relativeX=3;else{var s=3-t.relativeX;t.relativeX+=(0<s?1:s<0?-1:0)*r}}if(this.materialsLeft<=0)this.teleportButtonPressed=!0,this.teleportButtonNotPressedTime=0;else if(this.hasRemoteControl){var o=!0;null==o&&(o=!1),t.moveAndWait(il.getInt(this.minCitizenX,this.maxCitizenX),il.getInt(90,120),function(){if(0<n.materialsLeft){var t=.2*n.city.simulation.boostManager.currentGlobalBoostAmount*n.city.upgrades.vars.stoneMiningSpeed;n.materialsLeft-=t,n.city.materials.stone+=t,n.city.simulation.stats.materialProduction[2][0]+=t}n.updateTexture()},o,!1)}}},update:function(t){ee.prototype.update.call(this,t),this.materialsLeft<=0&&(this.teleportButtonPressed?(0==this.regrowProgress&&(this.hasBigStone=this.city.upgrades.vars.stoneTeleporterHasBigStones,this.updateStoneTextures()),this.regrowProgress+=2*t,100<=this.regrowProgress&&(this.regrowProgress=0,this.hasBigStone&&(this.initialMaterials=150),this.materialsLeft=this.initialMaterials,this.teleportButtonPressed=!1,this.teleportButtonNotPressedTime=0,null!=this.city.upgrades.vars.stoneResearchCenterWithFossils&&il.getFloat()<1e-5*this.initialMaterials&&(this.city.materials.knowledge+=1e4,this.city.simulation.stats.materialProduction[10][0]+=1e4,this.city.simulation.bonuses.fossilsCollected++)),this.updateTexture()):this.hasRemoteControl&&0<this.workers.length?(this.teleportButtonPressed=!0,this.teleportButtonNotPressedTime=0):this.teleportButtonNotPressedTime+=t)},destroy:function(){ee.prototype.destroy.call(this),this.stoneSprite.destroy()},positionSprites:function(){ee.prototype.positionSprites.call(this),null!=this.stoneSprite&&this.stoneSprite.position.set(this.position.x,this.position.y)},addWindowInfoLines:function(){var t=this;ee.prototype.addWindowInfoLines.call(this),this.city.gui.windowAddInfoText(null,function(){return 0<t.materialsLeft||!t.teleportButtonPressed&&t.teleportButtonNotPressedTime<3?Tr.lo("stone_left",[0|t.materialsLeft]):t.teleportButtonPressed?Tr.lo("teleporting_meteroid"):Tr.lo("waiting_for_worker_teleport")})},updateStoneTextures:function(){this.stoneTextures=dt.getTexturesByWidth(this.hasBigStone?"spr_stoneteleporter_stone_big":"spr_stoneteleporter_stone",20)},updateTexture:function(){if(this.materialsLeft<=0)this.stoneSprite.texture=this.stoneTextures[0],this.stoneSprite.alpha=this.regrowProgress/100;else{var t=this.materialsLeft,e=this.initialMaterials,i=this.stoneTextures,n=this.stoneSprite;if(t<=1e-7)n.texture=i[i.length-1];else{var r=Math.floor((e-t)/e*i.length);e!=t&&0==r&&1<i.length&&(r=1),n.texture=i[r]}this.stoneSprite.alpha=1}null==this.stoneSprite.texture&&console.log("FloatingSpaceCities/buildings/StoneTeleporter.hx:205:",Tr.lo("something_went_wrong_stone"))},save:function(t,e){null==e&&(e=!0),ee.prototype.save.call(this,t),e&&t.addString(hn.saveDefinition);var i=this.regrowProgress;if(t.size+8>t.bytes.length){var n=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+8))),t.bytes.blit(0,n,0,t.size)}t.bytes.setDouble(t.size,i),t.size+=8;i=this.materialsLeft;if(t.size+8>t.bytes.length){n=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+8))),t.bytes.blit(0,n,0,t.size)}t.bytes.setDouble(t.size,i),t.size+=8;i=this.hasBigStone;if(t.size+1>t.bytes.length){n=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+1))),t.bytes.blit(0,n,0,t.size)}t.bytes.b[t.size]=i?1:0,t.size+=1},load:function(t,e){ee.prototype.load.call(this,t),null==e&&(e=t.readString());var i=Dr.makeLoadMap(e,t);Object.prototype.hasOwnProperty.call(i.h,"regrowProgress")&&(this.regrowProgress=i.h.regrowProgress),Object.prototype.hasOwnProperty.call(i.h,"materialsLeft")&&(this.materialsLeft=i.h.materialsLeft),Object.prototype.hasOwnProperty.call(i.h,"hasBigStone")&&(this.hasBigStone=i.h.hasBigStone),this.postLoad()},__class__:hn});var un=function(t,e,i,n,r,s,o,a){this.numberOfLabs=0,this.knowledgeSoFar=0,_.call(this,t,e,i,n,r,s,o,a)};(q["buildings.Supercomputer"]=un).__name__="buildings.Supercomputer",un.__super__=_,un.prototype=e(_.prototype,{get_knowledgePerDay:function(){return 2*this.city.simulation.stats.peopleWorkingAtLabs*(1+this.city.upgrades.vars.superComputerUpgrade)},get_possibleCityUpgrades:function(){return[hr,rr,nr]},update:function(t){var e=t*(this.get_knowledgePerDay()/(1440/this.city.simulation.time.minutesPerTick))*this.city.simulation.boostManager.currentGlobalBoostAmount;this.city.materials.knowledge+=e,this.city.simulation.stats.materialProduction[10][0]+=e,this.knowledgeSoFar+=e},onCityChange:function(){},addWindowInfoLines:function(){var t=this;_.prototype.addWindowInfoLines.call(this),this.city.gui.windowAddInfoText(null,function(){return Tr.lo("knowledge_gathered_per_day",[0|t.get_knowledgePerDay()])}),this.city.gui.windowAddInfoText(null,function(){return Tr.lo("knowledge_gathered_so_far",[0|t.knowledgeSoFar])})},save:function(t,e){null==e&&(e=!0),_.prototype.save.call(this,t),e&&t.addString(un.saveDefinition);var i=this.knowledgeSoFar;if(t.size+8>t.bytes.length){var n=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+8))),t.bytes.blit(0,n,0,t.size)}t.bytes.setDouble(t.size,i),t.size+=8},load:function(t,e){_.prototype.load.call(this,t),null==e&&(e=t.readString());var i=Dr.makeLoadMap(e,t);Object.prototype.hasOwnProperty.call(i.h,"knowledgeSoFar")&&(this.knowledgeSoFar=i.h.knowledgeSoFar)},__class__:un});var cn=function(t,e,i,n,r,s,o,a){this.artSprite1Tex=0,this.artSprite3=null,this.artSprite2=null,this.artSprite1=null,ee.call(this,t,e,i,n,r,s,o,a),this.startTime=10,this.endTime=22,this.workTimePreferenceMod=.2,this.isEntertainment=!0;var l=dt.getTexturesByWidth("spr_techmuseum_minordisplay",9);for(this.mainTexture=il.getInt(cn.mainTextureOptions.length),this.secondTexture=il.getInt(l.length);this.thirdTexture=il.getInt(l.length),this.thirdTexture==this.secondTexture;);this.artTextures1=dt.getTexturesByWidth(cn.mainTextureOptions[this.mainTexture],5),this.artSprite1=new PIXI.Sprite(this.artTextures1[0]),i.addChild(this.artSprite1),this.artSprite1.position.set(s.x+3,s.y+3),this.artSprite2=new PIXI.Sprite(l[this.secondTexture]),this.artSprite2.position.set(s.x+8,s.y+3),n.cityBgStageAbove.addChild(this.artSprite2),this.artSprite3=new PIXI.Sprite(l[this.thirdTexture]),this.artSprite3.position.set(s.x+8,s.y+12),n.cityBgStageAbove.addChild(this.artSprite3)};(q["buildings.TechMuseum"]=cn).__name__="buildings.TechMuseum",cn.__interfaces__=[oe],cn.__super__=ee,cn.prototype=e(ee.prototype,{get_baseEntertainmentCapacity:function(){return 60*this.workers.length},get_isOpen:function(){if(1<=this.workers.length&&(0==this.workers[0].currentAction||2<=this.workers.length&&0==this.workers[1].currentAction)){var t=this.city.simulation.time.timeSinceStart/60%24,e=this.startTime-this.workTimePreferenceMod;return e<22?e<=t&&t<22:e<=t||t<22}return!1},get_entertainmentType:function(){return 2},get_secondaryEntertainmentTypes:function(){return null},get_minimumNormalTimeToSpend:function(){return 2},get_maximumNormalTimeToSpend:function(){return 4},get_minimumEntertainmentGroupSatisfy:function(){return 2},get_maximumEntertainmentGroupSatisfy:function(){return 4},get_entertainmentQuality:function(){return 100},get_isOpenForExistingVisitors:function(){return this.get_isOpen()},finishEntertainment:function(t,e){return!0},get_drawerType:function(){return Rn},postLoad:function(){this.artTextures1=dt.getTexturesByWidth(cn.mainTextureOptions[this.mainTexture],5)},onCityChange:function(){if(ee.prototype.onCityChange.call(this),null!=this.rightBuilding&&this.rightBuilding.is(cn)){var t=dt.getTexturesByWidth("spr_techmuseum_minordisplay_ext",15);this.artSprite2.texture=t[this.secondTexture],this.artSprite3.texture=t[this.thirdTexture]}else{var e=dt.getTexturesByWidth("spr_techmuseum_minordisplay",9);this.artSprite2.texture=e[this.secondTexture],this.artSprite3.texture=e[this.thirdTexture]}},update:function(t){ee.prototype.update.call(this,t),this.get_isOpen()?(this.artSprite1Tex+=t/2,this.artSprite1Tex>=this.artTextures1.length&&(this.artSprite1Tex=0),this.artSprite1.texture=this.artTextures1[Math.floor(this.artSprite1Tex)]):this.artSprite1.texture=this.artTextures1[0]},positionSprites:function(){ee.prototype.positionSprites.call(this),null!=this.artSprite1&&this.artSprite1.position.set(this.position.x+3,this.position.y+3),null!=this.artSprite2&&this.artSprite2.position.set(this.position.x+8,this.position.y+3),null!=this.artSprite3&&this.artSprite3.position.set(this.position.x+8,this.position.y+12)},destroy:function(){ee.prototype.destroy.call(this),this.artSprite1.destroy(),this.artSprite2.destroy(),this.artSprite3.destroy()},beEntertained:function(i,t){function e(){var t,e;i.relativeY<5?(null==(e=!0)&&(e=!1),null==(t=!1)&&(t=!1),i.moveAndWait(il.getInt(3,16),il.getInt(100,120),null,t,e)):(null==(e=!0)&&(e=!1),null==(t=!1)&&(t=!1),i.moveAndWait(il.getInt(8,16),il.getInt(100,120),null,t,e))}i.relativeY<5&&8<=i.relativeX&&il.getFloat()<.3?i.changeFloor(e):e(),i.hasBuildingInited||(i.educationLevel=Math.max(Math.min(i.educationLevel+.025,1.55),i.educationLevel),i.hasBuildingInited=!0)},work:function(t,e,i){if(i&&22<this.city.simulation.time.timeSinceStart/60%24)t.currentAction=2;else if(0==this.workers.indexOf(t)){null==(a=!0)&&(a=!1),null==(o=!1)&&(o=!1),t.moveAndWait(il.getInt(3,16),il.getInt(200,250),null,o,a)}else if(t.relativeY<5){var n;if(8<=t.relativeX)n=!0;else{var r=t.pathWalkSpeed*e;if(K.shouldUpdateDraw=!0,Math.abs(8-t.relativeX)<r)t.relativeX=8,n=!0;else{var s=8-t.relativeX;t.relativeX+=(0<s?1:s<0?-1:0)*r,n=!1}}n&&t.changeFloor()}else{var o,a;null==(a=!0)&&(a=!1),null==(o=!1)&&(o=!1),t.moveAndWait(il.getInt(8,16),il.getInt(300,320),null,o,a)}},save:function(t,e){null==e&&(e=!0),ee.prototype.save.call(this,t),e&&t.addString(cn.saveDefinition);var i=this.mainTexture;if(t.size+4>t.bytes.length){var n=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+4))),t.bytes.blit(0,n,0,t.size)}t.bytes.setInt32(t.size,i),t.size+=4;i=this.secondTexture;if(t.size+4>t.bytes.length){n=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+4))),t.bytes.blit(0,n,0,t.size)}t.bytes.setInt32(t.size,i),t.size+=4;i=this.thirdTexture;if(t.size+4>t.bytes.length){n=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+4))),t.bytes.blit(0,n,0,t.size)}t.bytes.setInt32(t.size,i),t.size+=4},load:function(t,e){ee.prototype.load.call(this,t),null==e&&(e=t.readString());var i=Dr.makeLoadMap(e,t);Object.prototype.hasOwnProperty.call(i.h,"mainTexture")&&(this.mainTexture=i.h.mainTexture),Object.prototype.hasOwnProperty.call(i.h,"secondTexture")&&(this.secondTexture=i.h.secondTexture),Object.prototype.hasOwnProperty.call(i.h,"thirdTexture")&&(this.thirdTexture=i.h.thirdTexture),this.postLoad()},__class__:cn});var dn=function(t,e,i,n,r,s,o,a){this.teleportX=9,this.timesUsedTo=0,this.timesUsed=0,_.call(this,t,e,i,n,r,s,o,a),this.doorX=12,n.teleporters.push(this)};(q["buildings.Teleporter"]=dn).__name__="buildings.Teleporter",dn.createUpkeepInfo=function(t,e){e.windowInner.addChild(new Ms(e.windowInner,new vr(2,4))),e.windowAddInfoText(null,function(){return Tr.lo("teleporters_operating_cost",[Math.round(t.simulation.operatingCost.getWholeCityOperatingCostTeleporters().knowledge)])});Io.create(e,function(){t.simulation.operatingCost.teleportersEnabled||!t.simulation.operatingCost.teleportersAreUserEnabled?t.simulation.operatingCost.changeTeleportersEnabledState(!t.simulation.operatingCost.teleportersEnabled,!0):t.simulation.operatingCost.teleportersAreUserEnabled?t.simulation.operatingCost.changeTeleportersEnabledState(!1,!0):e.showSimpleWindow(Tr.lo("cant_enable_teleporters"),null,!0)},e.windowInner,function(){return t.simulation.operatingCost.teleportersEnabled?Tr.lo("disable_all_teleporters"):t.simulation.operatingCost.teleportersAreUserEnabled?Tr.lo("keep_teleporters_disabled"):Tr.lo("enable_all_teleporters")},e.innerWindowStage);e.windowInner.addChild(new Ms(e.windowInner,new vr(2,4)))},dn.__super__=_,dn.prototype=e(_.prototype,{get_typeID:function(){return 1},destroy:function(){at.remove(this.city.teleporters,this),_.prototype.destroy.call(this)},addWindowInfoLines:function(){var t=this;_.prototype.addWindowInfoLines.call(this),this.city.gui.windowAddInfoText(null,function(){return Tr.lo("teleported_from",[t.timesUsed])}),this.city.gui.windowAddInfoText(null,function(){return Tr.lo("teleported_to",[t.timesUsedTo])}),dn.createUpkeepInfo(this.city,this.city.gui)},createTeleportParticle:function(t){null==t&&(t="spr_teleporter_ray"),this.city.particles.addParticle(dt.getTexturesByWidth(t,4),new vr(this.position.x+8,this.position.y+4))},save:function(t,e){null==e&&(e=!0),_.prototype.save.call(this,t),e&&t.addString(dn.saveDefinition);var i=this.timesUsed;if(t.size+4>t.bytes.length){var n=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+4))),t.bytes.blit(0,n,0,t.size)}t.bytes.setInt32(t.size,i),t.size+=4;i=this.timesUsedTo;if(t.size+4>t.bytes.length){n=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+4))),t.bytes.blit(0,n,0,t.size)}t.bytes.setInt32(t.size,i),t.size+=4},load:function(t,e){_.prototype.load.call(this,t),null==e&&(e=t.readString());var i=Dr.makeLoadMap(e,t);Object.prototype.hasOwnProperty.call(i.h,"timesUsed")&&(this.timesUsed=i.h.timesUsed),Object.prototype.hasOwnProperty.call(i.h,"timesUsedTo")&&(this.timesUsedTo=i.h.timesUsedTo)},__class__:dn});function pn(t,e,i,n,r,s,o,a){_.call(this,t,e,i,n,r,s,o,a)}(q["buildings.TheContraption"]=pn).__name__="buildings.TheContraption",pn.__super__=_,pn.prototype=e(_.prototype,{__class__:pn});var fn=function(t,e,i,n,r,s,o,a){this.hasUpgrade=!1,this.totalMaterialReward=null,this.thisDayMaterialReward=null,this.lastDayReward=-1,this.animProgress=0,this.featherAllianceHouse=null,this.secretSocietyFriendsHouse=null,this.secretSocietyHouse=null,_.call(this,t,e,i,n,r,s,o,a),this.bgTextures=dt.getTexturesByWidth("spr_secretsocietymachine_anim",20),this.backSprite=new PIXI.Sprite(this.bgTextures[0]),this.backSprite.position.set(s.x,s.y),i.addChild(this.backSprite),this.totalMaterialReward=new L};(q["buildings.TheMachine"]=fn).__name__="buildings.TheMachine",fn.__super__=_,fn.prototype=e(_.prototype,{get_possibleUpgrades:function(){return[Kt]},postLoad:function(){var t;if(null==this.totalMaterialReward.graphene!=null){var e=this.totalMaterialReward.graphene;t=isNaN(e)}else t=!0;if(t&&(this.totalMaterialReward.graphene=0),null!=this.totalMaterialReward.rocketFuel){e=this.totalMaterialReward.rocketFuel;t=isNaN(e)}else t=!0;t&&(this.totalMaterialReward.rocketFuel=0)},onBuild:function(){_.prototype.onBuild.call(this),dr.achieve("BUILD_MACHINE"),this.city.gui.triggerPremiumUpsellExperienceIfDesired("build_machine")},update:function(t){var e=this.city.getAmountOfPermanentsPerType();if((null==this.secretSocietyHouse||this.secretSocietyHouse.destroyed)&&1<=e.h["buildings.SecretSocietyHouse"]&&(this.secretSocietyHouse=lt.find(this.city.permanents,function(t){return t.is(Qi)})),null!=this.secretSocietyHouse)for(var i=0,n=this.secretSocietyHouse.workers;i<n.length;){var r=n[i];++i,r.dieAgeModifier=r.get_age()-75+3+(this.hasUpgrade?20:0)}if((null==this.secretSocietyFriendsHouse||this.secretSocietyFriendsHouse.destroyed)&&1<=e.h["buildings.HouseOfTheKeyFriends"]&&(this.secretSocietyFriendsHouse=lt.find(this.city.permanents,function(t){return t.is(ui)})),null!=this.secretSocietyFriendsHouse)for(i=0,n=this.secretSocietyFriendsHouse.residents;i<n.length;){r=n[i];++i,r.dieAgeModifier=r.get_age()-75+3+(this.hasUpgrade?20:0)}if((null==this.featherAllianceHouse||this.featherAllianceHouse.destroyed)&&1<=e.h["buildings.FeatherAlliance"]&&(this.featherAllianceHouse=lt.find(this.city.permanents,function(t){return t.is(Qe)})),null!=this.featherAllianceHouse)for(i=0,n=this.featherAllianceHouse.residents;i<n.length;){r=n[i];++i,r.dieAgeModifier=Math.max(50,r.dieAgeModifier)}var s=4*this.bgTextures.length*2+480+180;if(this.animProgress=(this.animProgress+t)%s,this.animProgress<480)this.backSprite.texture=this.bgTextures[(Math.floor(this.animProgress)/4|0)%2];else if(this.animProgress-480-180>4*this.bgTextures.length){var o=this.bgTextures.length-1-(Math.floor(this.animProgress-4*this.bgTextures.length-480-180)/4|0),a=this.bgTextures.length-1;this.backSprite.texture=this.bgTextures[o<0?0:a<o?a:o]}else if(this.animProgress-480>4*this.bgTextures.length)this.backSprite.texture=this.bgTextures[this.bgTextures.length-1];else{o=Math.floor(this.animProgress-480)/4|0,a=this.bgTextures.length-1;this.backSprite.texture=this.bgTextures[o<0?0:a<o?a:o]}this.lastDayReward!=1+((0|this.city.simulation.time.timeSinceStart)/1440|0)&&this.setReward()},setReward:function(){var t;switch(il.getInt(10)){case 0:t=new L(il.getInt(150,301));break;case 1:t=new L(0,il.getInt(100,501));break;case 2:t=new L(0,0,il.getInt(200,2001));break;case 3:t=new L(il.getInt(100,301),il.getInt(50,301),il.getInt(25,201));break;case 4:t=new L(il.getInt(100,201),il.getInt(150,251));break;case 5:t=new L(0,0,0,il.getInt(20,31));break;case 6:t=new L(0,0,0,0,0,il.getInt(40,81));break;case 7:t=new L(0,0,0,0,0,0,il.getInt(5,11));break;case 8:t=new L(0,0,0,il.getInt(15,31),0,il.getInt(20,51));break;default:switch(il.getInt(5)){case 0:t=new L(il.getInt(500,1501),0,il.getInt(1e3,2001));break;case 1:t=new L(0,0,0,0,il.getInt(500,1501));break;case 2:t=new L(0,il.getInt(1e3,2001),0,il.getInt(50,101),0);break;case 3:t=new L(0,0,0,0,0,il.getInt(200,301));break;default:switch(il.getInt(5)){case 0:t=new L(1e3,0,1e3,20,0,40,16);break;case 1:t=new L(0,0,0,0,0,0,100);break;case 2:t=new L(0,0,0,0,0,1e3);break;case 3:t=new L(0,1e4);break;default:t=new L(1e3,1e3,1e3,500)}}}if(this.thisDayMaterialReward=t,this.hasUpgrade){this.thisDayMaterialReward.multiply(1.5);var e=il.getInt(100);0==e?this.thisDayMaterialReward.graphene=50:1==e?this.thisDayMaterialReward.rocketFuel=500:e<5?this.thisDayMaterialReward.graphene=il.getInt(5,16):e<10?this.thisDayMaterialReward.rocketFuel=il.getInt(100,301):e<20?this.thisDayMaterialReward.graphene=il.getInt(1,4):e<30&&(this.thisDayMaterialReward.rocketFuel=il.getInt(10,50))}if(this.city.upgrades.vars.hasConnectedMachines){var i=gr.sum(this.city.progress.allCitiesInfo.subCityMachine,function(t){return t?1:0})-1;0<i&&this.thisDayMaterialReward.multiply(1+.5*i)}this.thisDayMaterialReward.multiply(this.city.simulation.boostManager.currentGlobalBoostAmount),this.thisDayMaterialReward.roundAll(),this.lastDayReward=1+((0|this.city.simulation.time.timeSinceStart)/1440|0),this.thisDayMaterialReward.addToProduction(this.city.simulation.stats),this.city.materials.add(this.thisDayMaterialReward),this.totalMaterialReward.add(this.thisDayMaterialReward)},addWindowInfoLines:function(){var t=this;null==this.thisDayMaterialReward&&this.setReward(),_.prototype.addWindowInfoLines.call(this);var e=this.lastDayReward,i=this.lastDayReward;this.city.gui.windowAddInfoText(Tr.lo("today_production"));var n=new Xs(this.thisDayMaterialReward,300),r=null;r=new ds(this.city.gui.windowInner,this.city.gui.innerWindowStage,n,null,function(){t.lastDayReward!=e&&(n.setMaterials(t.thisDayMaterialReward),e=t.lastDayReward,r.updateSize())}),this.city.gui.windowInner.addChild(r),this.city.gui.windowInner.addChild(new Ms(this.city.gui.windowInner,new vr(2,6))),this.city.gui.windowAddInfoText(Tr.lo("total_production"));var s=new Xs(this.totalMaterialReward,300),o=null;o=new ds(this.city.gui.windowInner,this.city.gui.innerWindowStage,s,null,function(){t.lastDayReward!=i&&(s.setMaterials(t.totalMaterialReward),i=t.lastDayReward,o.updateSize())}),this.city.gui.windowInner.addChild(o),this.city.gui.windowInner.addChild(new Ms(this.city.gui.windowInner,new vr(2,6))),this.city.gui.windowAddInfoText(null,function(){return((0|t.city.simulation.time.timeSinceStart)/60|0)%24==23?Tr.lo("next_production_in_1"):Tr.lo("next_production_in_n",[24-((0|t.city.simulation.time.timeSinceStart)/60|0)%24])})},positionSprites:function(){_.prototype.positionSprites.call(this),null!=this.backSprite&&this.backSprite.position.set(this.position.x,this.position.y)},destroy:function(){_.prototype.destroy.call(this),null!=this.backSprite&&this.backSprite.destroy()},save:function(t,e){null==e&&(e=!0),_.prototype.save.call(this,t),e&&t.addString(fn.saveDefinition);var i=this.animProgress;if(t.size+8>t.bytes.length){var n=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+8))),t.bytes.blit(0,n,0,t.size)}t.bytes.setDouble(t.size,i),t.size+=8;i=this.lastDayReward;if(t.size+4>t.bytes.length){n=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+4))),t.bytes.blit(0,n,0,t.size)}t.bytes.setInt32(t.size,i),t.size+=4,t.addString(Bo.run(this.thisDayMaterialReward)),t.addString(Bo.run(this.totalMaterialReward))},load:function(t,e){if(_.prototype.load.call(this,t),!(t.version<8)){null==e&&(e=t.readString());var i=Dr.makeLoadMap(e,t);Object.prototype.hasOwnProperty.call(i.h,"animProgress")&&(this.animProgress=i.h.animProgress),Object.prototype.hasOwnProperty.call(i.h,"lastDayReward")&&(this.lastDayReward=i.h.lastDayReward),Object.prototype.hasOwnProperty.call(i.h,"thisDayMaterialReward")&&(this.thisDayMaterialReward=i.h.thisDayMaterialReward),Object.prototype.hasOwnProperty.call(i.h,"totalMaterialReward")&&(this.totalMaterialReward=i.h.totalMaterialReward),this.postLoad()}},__class__:fn});var gn=function(t,e,i,n,r,s,o,a){this.backTextureUsed=0,this.frontTextureUsed=0,re.call(this,t,e,i,n,r,s,o,a),null==gn.frontTextures&&(gn.frontTextures=dt.getTexturesByWidth("spr_tinkerershouse_front_alt",20),gn.backTextures=dt.getTexturesByWidth("spr_tinkerershouse_back_alt",20)),this.frontTextureUsed=il.getInt(gn.frontTextures.length),this.backTextureUsed=il.getInt(gn.backTextures.length),this.get_customizableDrawer().setCustomTextures(gn.frontTextures[this.frontTextureUsed],null,gn.backTextures[this.backTextureUsed])};(q["buildings.TinkerersHome"]=gn).__name__="buildings.TinkerersHome",gn.__super__=re,gn.prototype=e(re.prototype,{get_drawerType:function(){return Nn},get_customizableDrawer:function(){return this.drawer},get_possibleUpgrades:function(){return[X]},onBuild:function(){re.prototype.onBuild.call(this),this.city.progress.unlocks.unlock(ir)},postLoad:function(){this.get_customizableDrawer().setCustomTextures(gn.frontTextures[this.frontTextureUsed],null,gn.backTextures[this.backTextureUsed])},walkAround:function(t,e){t.hasBuildingInited||(t.educationLevel=Math.max(Math.min(t.educationLevel+.01,1.25),t.educationLevel),t.hasBuildingInited=!0);var i=il.getInt(6);if(i<2&&120<e)t.changeFloorAndWaitRandom(30,60);else if(2==i||3==i||e<10)t.relativeY<5?2==i?t.moveAndWait(il.getInt(3,6),il.getInt(30,60),null,!1,!1):t.moveAndWait(il.getInt(15,16),il.getInt(30,60),null,!1,!1):2==i?t.moveAndWait(il.getInt(3,6),il.getInt(30,60),null,!1,!1):t.moveAndWait(il.getInt(12,16),il.getInt(30,60),null,!1,!1);else{var n=ka.pool,r=0<n[2].length?n[2].splice(n[2].length-1,1)[0]:new Int32Array(2);r[0]=8,r[1]=il.getInt(90,120),t.setPath(r,0,2,!0),t.pathEndFunction=null,t.pathOnlyRelatedTo=t.inPermanent}},save:function(t,e){null==e&&(e=!0),re.prototype.save.call(this,t),e&&t.addString(gn.saveDefinition);var i=this.frontTextureUsed;if(t.size+4>t.bytes.length){var n=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+4))),t.bytes.blit(0,n,0,t.size)}t.bytes.setInt32(t.size,i),t.size+=4;i=this.backTextureUsed;if(t.size+4>t.bytes.length){n=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+4))),t.bytes.blit(0,n,0,t.size)}t.bytes.setInt32(t.size,i),t.size+=4},load:function(t,e){re.prototype.load.call(this,t),null==e&&(e=t.readString());var i=Dr.makeLoadMap(e,t);Object.prototype.hasOwnProperty.call(i.h,"frontTextureUsed")&&(this.frontTextureUsed=i.h.frontTextureUsed),Object.prototype.hasOwnProperty.call(i.h,"backTextureUsed")&&(this.backTextureUsed=i.h.backTextureUsed),this.postLoad()},__class__:gn});function mn(t,e,i,n,r,s,o,a){_.call(this,t,e,i,n,r,s,o,a)}(q["buildings.TrainRail"]=mn).__name__="buildings.TrainRail",mn.__super__=_,mn.prototype=e(_.prototype,{save:function(t,e){null==e&&(e=!0),_.prototype.save.call(this,t),e&&t.addString(mn.saveDefinition)},load:function(t,e){_.prototype.load.call(this,t),null==e&&(e=t.readString());Dr.makeLoadMap(e,t)},__class__:mn});function yn(t,e,i,n,r,s,o,a){_.call(this,t,e,i,n,r,s,o,a)}(q["buildings.TrainStation"]=yn).__name__="buildings.TrainStation",yn.__super__=_,yn.prototype=e(_.prototype,{save:function(t,e){null==e&&(e=!0),_.prototype.save.call(this,t),e&&t.addString(yn.saveDefinition)},load:function(t,e){_.prototype.load.call(this,t),null==e&&(e=t.readString());Dr.makeLoadMap(e,t)},__class__:yn});function _n(t,e,i,n,r,s,o,a){this.parkSprite=null,re.call(this,t,e,i,n,r,s,o,a),this.parkSprite=new PIXI.Sprite(dt.getTexture("spr_treehuggerbase")),this.parkSprite.position.set(s.x,s.y),i.addChild(this.parkSprite)}(q["buildings.TreeHuggerBase"]=_n).__name__="buildings.TreeHuggerBase",_n.__super__=re,_n.prototype=e(re.prototype,{get_drawerType:function(){return Rn},get_mergingDrawer:function(){return this.drawer},onBuild:function(){re.prototype.onBuild.call(this),dr.achieve("TREE_HUGGER")},postCreate:function(){re.prototype.postCreate.call(this),this.positionSprites()},positionSprites:function(){re.prototype.positionSprites.call(this),null!=this.parkSprite&&this.parkSprite.position.set(this.position.x,this.position.y)},destroy:function(){re.prototype.destroy.call(this),this.parkSprite.destroy()},walkAround:function(t,e){if(10==t.relativeX)t.canViewSelfInBuilding=!1;else{var i=ka.pool,n=0<i[2].length?i[2].splice(i[2].length-1,1)[0]:new Int32Array(2);n[0]=4,n[1]=10,t.setPath(n,0,2,!0),t.pathEndFunction=null,t.pathOnlyRelatedTo=t.inPermanent}},__class__:_n});function vn(t,e,i,n,r,s,o,a){this.regrowSpeedBoost=1,this.initialMaterials=100,this.regrowProgress=0,this.maxCitizenX=14,this.minCitizenX=4,ee.call(this,t,e,i,n,r,s,o,a),this.materialsLeft=0,this.treesCutTextures=dt.getTexturesByWidth("spr_treeplantation_trees",20),this.regrowTextures=dt.getTexturesByWidth("spr_treeplantation_trees_grow",20),this.treesSprite=new PIXI.Sprite(this.regrowTextures[0]),this.treesSprite.position.set(s.x,s.y),i.addChild(this.treesSprite)}(q["buildings.TreePlantation"]=vn).__name__="buildings.TreePlantation",vn.__interfaces__=[ln],vn.__super__=ee,vn.prototype=e(ee.prototype,{get_destroyedOnEmpty:function(){return!1},get_resourceName:function(){return"wood"},get_regrowSpeed:function(){return.008*this.getExtraTreeGrowth()*this.regrowSpeedBoost},get_doNotGather:function(){return!1},get_stayIfEmpty:function(){return!1},get_possibleUpgrades:function(){return[W]},update:function(t){ee.prototype.update.call(this,t);var e=this.city;if(this.materialsLeft<=0){var i=e.simulation.time.timeSinceStart/60%24;if((n=7)<(r=20)?n<=i&&i<r:n<=i||i<r)this.regrowProgress+=this.get_regrowSpeed()*t;else{var n,r;i=e.simulation.time.timeSinceStart/60%24;((n=6)<(r=21)?n<=i&&i<r:n<=i||i<r)&&(this.regrowProgress+=this.get_regrowSpeed()*t*.5)}100<=this.regrowProgress&&(this.materialsLeft=this.initialMaterials,this.regrowProgress=0),this.updateTexture()}},updateTexture:function(){var t=this.materialsLeft,e=this.initialMaterials,i=this.treesCutTextures,n=this.regrowTextures,r=this.treesSprite;if(t<=1e-7)r.texture=null!=n?n[this.regrowProgress/100*n.length|0]:i[i.length-1];else{var s=Math.floor((e-t)/e*i.length);e!=t&&0==s&&1<i.length&&(s=1),r.texture=i[s]}},positionSprites:function(){ee.prototype.positionSprites.call(this),null!=this.treesSprite&&this.treesSprite.position.set(this.position.x,this.position.y)},destroy:function(){ee.prototype.destroy.call(this),this.treesSprite.destroy()},work:function(t,e,i){var n=this;if(i)t.currentAction=2;else{var r=0<this.materialsLeft,s=!0;null==s&&(s=!1),t.moveAndWait(il.getInt(this.minCitizenX,this.maxCitizenX),il.getInt(r?60:120,r?90:180),function(){if(r){var t=.2*n.city.simulation.boostManager.currentGlobalBoostAmount;n.materialsLeft-=t,n.city.materials.wood+=t,n.city.simulation.stats.materialProduction[1][0]+=t}else n.regrowProgress+=.5*n.getExtraTreeGrowth();n.updateTexture()},s,!1)}},addWindowInfoLines:function(){var t=this;ee.prototype.addWindowInfoLines.call(this),this.city.gui.windowAddInfoText(null,function(){return t.materialsLeft<=0?Tr.lo("trees_grown",[0|t.regrowProgress]):Tr.lo("wood_left",[0|t.materialsLeft,0|t.initialMaterials])})},getExtraTreeGrowth:function(){return 1+this.getEffectsOfAdjecentBuildings("increaseTreeGrowth")},postLoad:function(){this.updateTexture()},save:function(t,e){null==e&&(e=!0),ee.prototype.save.call(this,t),e&&t.addString(vn.saveDefinition);var i=this.regrowProgress;if(t.size+8>t.bytes.length){var n=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+8))),t.bytes.blit(0,n,0,t.size)}t.bytes.setDouble(t.size,i),t.size+=8;i=this.materialsLeft;if(t.size+8>t.bytes.length){n=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+8))),t.bytes.blit(0,n,0,t.size)}t.bytes.setDouble(t.size,i),t.size+=8},load:function(t,e){ee.prototype.load.call(this,t),null==e&&(e=t.readString());var i=Dr.makeLoadMap(e,t);Object.prototype.hasOwnProperty.call(i.h,"regrowProgress")&&(this.regrowProgress=i.h.regrowProgress),Object.prototype.hasOwnProperty.call(i.h,"materialsLeft")&&(this.materialsLeft=i.h.materialsLeft),this.postLoad()},__class__:vn});function bn(t,e,i,n,r,s,o,a){vn.call(this,t,e,i,n,r,s,o,a),this.treesCutTextures=dt.getTexturesByWidth("spr_treeplantation_dome_trees",20),this.regrowTextures=dt.getTexturesByWidth("spr_treeplantation_dome_trees_grow",20),this.treesSprite.texture=this.regrowTextures[0],this.initialMaterials=90}(q["buildings.TreePlantationDome"]=bn).__name__="buildings.TreePlantationDome",bn.__super__=vn,bn.prototype=e(vn.prototype,{getExtraTreeGrowth:function(){return 2*(1+this.getEffectsOfAdjecentBuildings("increaseTreeGrowth"))},__class__:bn});function wn(t,e,i,n,r,s,o,a){this.justBuilt=!1,re.call(this,t,e,i,n,r,s,o,a),this.adjecentBuildingEffects.push({name:"modernRusticHomeCommunityFeeling",intensity:1}),this.leftIsWaterFilled=!1,this.rightIsWaterFilled=!1,this.topIsWaterFilled=!1,this.bottomIsWaterFilled=!1,this.houseSprite=new PIXI.Sprite(dt.getTexture("spr_underwaterhouse")),this.houseSprite.position.set(s.x,s.y),n.cityMidStage.addChild(this.houseSprite)}(q["buildings.UnderwaterHouse"]=wn).__name__="buildings.UnderwaterHouse",wn.__interfaces__=[le],wn.__super__=re,wn.prototype=e(re.prototype,{get_drawerType:function(){return Rn},get_mergingDrawer:function(){return this.drawer},get_walkThroughCanViewSelfInThisBuilding:function(){return!1},postCreate:function(){re.prototype.postCreate.call(this),this.justBuilt&&(this.justBuilt=!1),this.positionSprites()},destroy:function(){re.prototype.destroy.call(this);for(var t=this.city.simulation.fishes.fishes,e=t.length;0<=--e;)t[e].inPermanent==this&&t[e].destroy();var i=this.city.cityMidStage,n=this.houseSprite;at.remove(i.cacheableChildren,n),i.isInvalid=!0,n.destroy({children:!0,texture:!1})},onCityChange:function(){},onBuild:function(){re.prototype.onBuild.call(this),this.justBuilt=!0},walkAround:function(t,e){},__class__:wn});var Sn=function(t,e,i,n,r,s,o,a){_.call(this,t,e,i,n,r,s,o,a)};(q["buildings.UnknownBuilding"]=Sn).__name__="buildings.UnknownBuilding",Sn.__super__=_,Sn.prototype=e(_.prototype,{load:function(t,e){var i=t.bytes.getInt32(t.readStart);t.readStart+=4;var n=i;t.readStart=n},save:function(t,e){null==e&&(e=!0);var i=t.size+4;if(t.size+4>t.bytes.length){var n=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+4))),t.bytes.blit(0,n,0,t.size)}t.bytes.setInt32(t.size,i),t.size+=4},__class__:Sn});var xn=function(t,e,i,n,r,s,o,a){this.teleportX=3,this.currentAdjBonus=0,this.timesUsedTo=0,this.timesUsed=0,re.call(this,t,e,i,n,r,s,o,a)};(q["buildings.Villa"]=xn).__name__="buildings.Villa",xn.__super__=re,xn.prototype=e(re.prototype,{get_hasPrivateTeleporter:function(){return!0},get_possibleUpgrades:function(){return[]},walkAround:function(t,e){var i=il.getInt(3);if(0==i&&120<e)if(t.relativeX<5){var n=t;(s=0<(r=ka.pool)[2].length?r[2].splice(r[2].length-1,1)[0]:new Int32Array(2))[0]=4,s[1]=5,n.setPath(s,0,2,!0),t.pathEndFunction=function(){t.changeFloorAndWaitRandom(30,60)},t.pathOnlyRelatedTo=t.inPermanent}else t.changeFloorAndWaitRandom(30,60);else if(1==i||e<=10&&t.relativeX<this.teleportX+.5)t.relativeY<5?t.moveAndWait(il.getInt(10,16),il.getInt(30,60),null,!1,!1):1==il.getInt(2)?t.moveAndWait(il.getInt(5,8),il.getInt(30,60),null,!1,!1):t.moveAndWait(il.getInt(13,16),il.getInt(30,60),null,!1,!1);else{var r,s;n=t;(s=0<(r=ka.pool)[2].length?r[2].splice(r[2].length-1,1)[0]:new Int32Array(2))[0]=8,s[1]=il.getInt(90,120),n.setPath(s,0,2,!0),t.pathEndFunction=null,t.pathOnlyRelatedTo=t.inPermanent}},addWindowInfoLines:function(){var t=this;re.prototype.addWindowInfoLines.call(this),this.city.gui.windowAddInfoText(null,function(){return Tr.lo("teleported_from",[t.timesUsed])}),this.city.gui.windowAddInfoText(null,function(){return Tr.lo("teleported_to",[t.timesUsedTo])}),dn.createUpkeepInfo(this.city,this.city.gui)},createTeleportParticle:function(t){null==t&&(t="unused"),this.city.particles.addParticle(dt.getTexturesByWidth("spr_smallteleporter_ray",3),new vr(this.position.x+3,this.position.y+12))},save:function(t,e){null==e&&(e=!0),re.prototype.save.call(this,t),e&&t.addString(xn.saveDefinition);var i=this.timesUsed;if(t.size+4>t.bytes.length){var n=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+4))),t.bytes.blit(0,n,0,t.size)}t.bytes.setInt32(t.size,i),t.size+=4;i=this.timesUsedTo;if(t.size+4>t.bytes.length){n=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+4))),t.bytes.blit(0,n,0,t.size)}t.bytes.setInt32(t.size,i),t.size+=4},load:function(t,e){if(re.prototype.load.call(this,t),!(t.version<6)){null==e&&(e=t.readString());var i=Dr.makeLoadMap(e,t);Object.prototype.hasOwnProperty.call(i.h,"timesUsed")&&(this.timesUsed=i.h.timesUsed),Object.prototype.hasOwnProperty.call(i.h,"timesUsedTo")&&(this.timesUsedTo=i.h.timesUsedTo)}},__class__:xn});function Tn(t,e,i,n,r,s,o,a){this.mirrored=!1,ee.call(this,t,e,i,n,r,s,o,a),this.startTime=16,this.endTime=2,this.workTimePreferenceMod=.5,this.isEntertainment=!0,this.doorX=8}(q["buildings.WizardHatCafe"]=Tn).__name__="buildings.WizardHatCafe",Tn.__interfaces__=[oe],Tn.__super__=ee,Tn.prototype=e(ee.prototype,{get_baseEntertainmentCapacity:function(){return 55*this.workers.length|0},get_isOpen:function(){if(1<=this.workers.length&&0==this.workers[0].currentAction){var t=this.city.simulation.time.timeSinceStart/60%24,e=this.startTime-this.workTimePreferenceMod;return e<.5?e<=t&&t<.5:e<=t||t<.5}return!1},get_entertainmentType:function(){return 1},get_secondaryEntertainmentTypes:function(){return null},get_minimumNormalTimeToSpend:function(){return 2},get_maximumNormalTimeToSpend:function(){return 4},get_minimumEntertainmentGroupSatisfy:function(){return 2},get_maximumEntertainmentGroupSatisfy:function(){return 4},get_entertainmentQuality:function(){return 100},get_isOpenForExistingVisitors:function(){return this.get_isOpen()},finishEntertainment:function(t,e){return!0},createWindowAddBottomButtons:function(){Io.create(this.city.gui,Uh(this,this.mirror),this.city.gui.windowInner,function(){return Tr.lo("mirror")},this.city.gui.innerWindowStage),this.city.gui.windowInner.addChild(new Ms(this.city.gui.windowInner,new vr(2,6))),ee.prototype.createWindowAddBottomButtons.call(this)},postLoad:function(){this.mirrored&&(this.mirror(),this.mirrored=!0)},mirror:function(){this.mirrored=!this.mirrored,this.drawer.mirror(),this.mirrored?this.doorX=4:this.doorX=14},beEntertained:function(t,e){},work:function(t,e,i){},save:function(t,e){null==e&&(e=!0),ee.prototype.save.call(this,t),e&&t.addString(Tn.saveDefinition);var i=this.mirrored;if(t.size+1>t.bytes.length){var n=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+1))),t.bytes.blit(0,n,0,t.size)}t.bytes.b[t.size]=i?1:0,t.size+=1},load:function(t,e){if(ee.prototype.load.call(this,t),!(t.version<57)){null==e&&(e=t.readString());var i=Dr.makeLoadMap(e,t);Object.prototype.hasOwnProperty.call(i.h,"mirrored")&&(this.mirrored=i.h.mirrored),this.postLoad()}},__class__:Tn});function In(t,e,i,n,r,s,o,a){ye.call(this,t,e,i,n,r,s,o,a)}(q["buildings.WoodcuttingCentre"]=In).__name__="buildings.WoodcuttingCentre",In.__super__=ye,In.prototype=e(ye.prototype,{work:function(t,e,i){var n=this;this.doBlueCollarJob(t,e,i,[Ph,vn],function(t){var e=n.city.simulation,i=.2*(n.city.progress.story.hiddenBoost&&n.city.materials.wood<=6?1.75:1)*(B.earlyGameFix1&&e.citizens.length<30?1.3-e.citizens.length/60*.3:1)*n.city.simulation.boostManager.currentGlobalBoostAmount;n.city.materials.wood+=i,n.city.simulation.stats.materialProduction[1][0]+=i,t.materialsLeft-=i},60,90)},__class__:In});function Pn(t,e,i,n,r,s,o,a){this.totalKnowledgeGenerated=0,this.totalMaterialUsed=0,this.materialMade=0,this.isProducingKnowledge=!0,ee.call(this,t,e,i,n,r,s,o,a)}(q["buildings.Workshop"]=Pn).__name__="buildings.Workshop",Pn.__super__=ee,Pn.prototype=e(ee.prototype,{onBuild:function(){this.city.simulation.bonuses.machinePartsFactorySpeed*=1.25},get_possibleBuildingModes:function(){return[Zt,Jt]},get_possibleCityUpgrades:function(){return[Yn,qn,Kn]},work:function(t,e,i){if(i)t.currentAction=2;else{if(0==this.workers.indexOf(t))if(il.getInt(5)<4)null==(r=!0)&&(r=!1),null==(n=!1)&&(n=!1),t.moveAndWait(il.getInt(4,8),il.getInt(60,120),null,n,r);else null==(r=!0)&&(r=!1),null==(n=!1)&&(n=!1),t.moveAndWait(il.getInt(11,14),il.getInt(60,120),null,n,r);else if(t.relativeY<2)t.changeFloor();else if(0==il.getInt(2)){null==(r=!0)&&(r=!1),null==(n=!1)&&(n=!1),t.moveAndWait(il.getInt(3,6),il.getInt(60,120),null,n,r)}else{var n,r;null==(r=!0)&&(r=!1),null==(n=!1)&&(n=!1),t.moveAndWait(il.getInt(13,14),il.getInt(60,120),null,n,r)}if(this.isProducingKnowledge){var s=.15*t.get_educationSpeedModifier()*this.city.simulation.boostManager.currentGlobalBoostAmount;this.city.materials.knowledge+=s,this.city.simulation.stats.materialProduction[10][0]+=s,this.totalKnowledgeGenerated+=s}else if(1<=this.city.materials.wood){var o=.075*t.get_educationSpeedModifier()*this.city.simulation.boostManager.currentGlobalBoostAmount;this.city.materials.machineParts+=o,this.city.simulation.stats.materialProduction[3][0]+=o,this.materialMade+=o;var a=2*o;this.city.materials.wood-=a,this.city.simulation.stats.materialUsed[1][0]+=a,this.totalMaterialUsed+=a}}},update:function(t){ee.prototype.update.call(this,t)},destroy:function(){ee.prototype.destroy.call(this),this.city.simulation.bonuses.machinePartsFactorySpeed/=1.25},addWindowInfoLines:function(){var t=this;ee.prototype.addWindowInfoLines.call(this),this.city.gui.windowAddInfoText(null,function(){return Tr.lo("knowledge_gathered",[0|t.totalKnowledgeGenerated])+" "+Tr.lo("wood_used_for_machine_parts",[0|t.totalMaterialUsed,0|t.materialMade])})},save:function(t,e){null==e&&(e=!0),ee.prototype.save.call(this,t),e&&t.addString(Pn.saveDefinition);var i=this.materialMade;if(t.size+8>t.bytes.length){var n=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+8))),t.bytes.blit(0,n,0,t.size)}t.bytes.setDouble(t.size,i),t.size+=8;i=this.totalMaterialUsed;if(t.size+8>t.bytes.length){n=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+8))),t.bytes.blit(0,n,0,t.size)}t.bytes.setDouble(t.size,i),t.size+=8;i=this.totalKnowledgeGenerated;if(t.size+8>t.bytes.length){n=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+8))),t.bytes.blit(0,n,0,t.size)}t.bytes.setDouble(t.size,i),t.size+=8},load:function(t,e){ee.prototype.load.call(this,t),null==e&&(e=t.readString());var i=Dr.makeLoadMap(e,t);Object.prototype.hasOwnProperty.call(i.h,"materialMade")&&(this.materialMade=i.h.materialMade),Object.prototype.hasOwnProperty.call(i.h,"totalMaterialUsed")&&(this.totalMaterialUsed=i.h.totalMaterialUsed),Object.prototype.hasOwnProperty.call(i.h,"totalKnowledgeGenerated")&&(this.totalKnowledgeGenerated=i.h.totalKnowledgeGenerated)},__class__:Pn});var Cn=function(t,e){this.park=t,this.podiumSprite=null,this.bgStage=e};(q["buildings.buildingBehaviours.ParkFestivalEntertainment"]=Cn).__name__="buildings.buildingBehaviours.ParkFestivalEntertainment",Cn.prototype={doFestivalWork:function(t,e,i,n,r){var s=!0,o=3;if(null!=this.park.leftBuilding&&(s&&this.park.leftBuilding.is(Ae)&&(s=!1),s&&this.park.leftBuilding.is(be)&&(s=!1,null!=this.park.leftBuilding.bottomBuilding&&this.park.leftBuilding.bottomBuilding.is(be)&&(0==n&&(o=-3),s=!0))),s){null==this.podiumSprite&&(this.podiumSprite=new PIXI.Sprite(dt.getTexture("spr_festival_podium_small")),this.bgStage.addChild(this.podiumSprite)),this.podiumSprite.position.set(this.park.position.x+o,this.park.position.y+20-this.podiumSprite.height-1);var a=0==r?o+3:o,l=e.pathWalkSpeed*i;if(K.shouldUpdateDraw=!0,Math.abs(a-e.relativeX)<l)e.relativeX=a;else{var h=a-e.relativeX;e.relativeX+=(0<h?1:h<0?-1:0)*l}e.relativeX>=a&&e.relativeX<=a+1&&e.setRelativePos(a,4)}else null!=this.podiumSprite&&(this.podiumSprite.destroy(),this.podiumSprite=null),e.moveAndWait(il.getInt(0,17),il.getInt(60,90),null,!1,!1)},beEntertainedFestival:function(t,e,i){if(null==this.podiumSprite)En.beEntertainedPark(this.park.leftBuilding,this.park.rightBuilding,e);else{var n=Math.ceil(this.podiumSprite.position.x+this.podiumSprite.width-this.park.position.x),r=null!=this.park.rightBuilding&&(this.park.rightBuilding.is(Ae)||this.park.rightBuilding.is(be)),s=!1,o=!0;null==o&&(o=!1),null==s&&(s=!1),e.moveAndWait(il.getInt(n,r?19:16),il.getInt(100,180),null,s,o)}},destroy:function(){null!=this.podiumSprite&&this.podiumSprite.destroy()},stop:function(){},__class__:Cn};var En=function(){};(q["buildings.buildingBehaviours.ParkWalk"]=En).__name__="buildings.buildingBehaviours.ParkWalk",En.beEntertainedPark=function(t,e,i){var n=!1,r=!1;null!=t&&t.is(Fi)&&(t=t.leftBuilding,n=!0),null!=e&&e.is(Fi)&&(e=e.rightBuilding,r=!0);var s=null!=t&&t.is(be),o=null!=e&&e.is(be),a=s&&(null==t.bottomBuilding||!t.bottomBuilding.is(be)),l=o&&(null==e.bottomBuilding||!e.bottomBuilding.is(be));s||null!=t&&t.is(Ae)&&(a=s=!0),o||null!=e&&e.is(Ae)&&(l=o=!0);var h=!1,u=il.getInt(1+(s?1:0)+(o?1:0));if(s&&0==u){if(n)a&&((d=0<(c=ka.pool)[10].length?c[10].splice(c[10].length-1,1)[0]:new Int32Array(10))[0]=12,d[1]=50,d[2]=2,d[3]=0,d[4]=2,d[5]=0,d[6]=4,d[7]=il.getInt(0,18),d[8]=8,d[9]=il.getInt(100,180),i.setPath(d,0,8,!0),h=!0);else if(a){(d=0<(c=ka.pool)[8].length?c[8].splice(c[8].length-1,1)[0]:new Int32Array(8))[0]=12,d[1]=50,d[2]=2,d[3]=0,d[4]=4,d[5]=il.getInt(0,18),d[6]=8,d[7]=il.getInt(100,180),i.setPath(d,0,8,!0),h=!0}else if(0==il.getInt(2)){null==(f=!0)&&(f=!1),null==(p=!1)&&(p=!1),i.moveAndWait(il.getInt(-3,-3),il.getInt(70,90),null,p,f),h=!0}}else if(o&&1==u){if(r){if(l)(d=0<(c=ka.pool)[10].length?c[10].splice(c[10].length-1,1)[0]:new Int32Array(10))[0]=12,d[1]=50,d[2]=3,d[3]=0,d[4]=3,d[5]=0,d[6]=4,d[7]=il.getInt(0,18),d[8]=8,d[9]=il.getInt(100,180),i.setPath(d,0,8,!0),h=!0}else if(l){var c,d;(d=0<(c=ka.pool)[8].length?c[8].splice(c[8].length-1,1)[0]:new Int32Array(8))[0]=12,d[1]=50,d[2]=3,d[3]=0,d[4]=4,d[5]=il.getInt(0,18),d[6]=8,d[7]=il.getInt(100,180),i.setPath(d,0,8,!0),h=!0}else if(0==il.getInt(2)){var p,f;null==(f=!0)&&(f=!1),null==(p=!1)&&(p=!1),i.moveAndWait(il.getInt(21,21),il.getInt(70,90),null,p,f),h=!0}}h||(null==(f=!0)&&(f=!1),null==(p=!1)&&(p=!1),i.moveAndWait(il.getInt(s?0:3,o?18:15),il.getInt(100,180),null,p,f))},En.beEntertainedRooftopPark=function(t,e,i){var n=null!=t&&t.is(qi),r=null!=e&&e.is(qi),s=!1;if(n&&i.relativeX<1)return null!=i.inPermanent&&i.inPermanent.onCitizenLeave(i,t),i.inBuildingSince=i.city.simulation.time.timeSinceStart,i.inPermanent=t,i.hasBuildingInited=!1,i.setRelativeX(i.relativeX+20),null==(l=!0)&&(l=!1),null==(o=!1)&&(o=!1),void i.moveAndWait(il.getInt(3,15),il.getInt(100,180),null,o,l);if(r&&19<i.relativeX)return null!=i.inPermanent&&i.inPermanent.onCitizenLeave(i,e),i.inBuildingSince=i.city.simulation.time.timeSinceStart,i.inPermanent=e,i.hasBuildingInited=!1,i.setRelativeX(i.relativeX-20),null==(l=!0)&&(l=!1),null==(o=!1)&&(o=!1),void i.moveAndWait(il.getInt(3,15),il.getInt(100,180),null,o,l);var o,a=il.getInt(1+(n?1:0)+(r?1:0));if(n&&0==a){if(null==(l=!0)&&(l=!1),l)(u=0<(h=ka.pool)[4].length?h[4].splice(h[4].length-1,1)[0]:new Int32Array(4))[0]=12,u[1]=50,u[2]=4,u[3]=0,i.setPath(u,0,4,!0);else(u=0<(h=ka.pool)[2].length?h[2].splice(h[2].length-1,1)[0]:new Int32Array(2))[0]=4,u[1]=0,i.setPath(u,0,2,!0);i.pathEndFunction=null,i.pathOnlyRelatedTo=i.inPermanent,s=!0}else if(r&&1==a){var l,h,u;if(null==(l=!0)&&(l=!1),l)(u=0<(h=ka.pool)[4].length?h[4].splice(h[4].length-1,1)[0]:new Int32Array(4))[0]=12,u[1]=50,u[2]=4,u[3]=20,i.setPath(u,0,4,!0);else(u=0<(h=ka.pool)[2].length?h[2].splice(h[2].length-1,1)[0]:new Int32Array(2))[0]=4,u[1]=20,i.setPath(u,0,2,!0);i.pathEndFunction=null,i.pathOnlyRelatedTo=i.inPermanent,s=!0}s||(null==(l=!0)&&(l=!1),null==(o=!1)&&(o=!1),i.moveAndWait(il.getInt(0,19),il.getInt(100,180),null,o,l))};function An(t,e,i,n){this.building=t,this.stage=e,this.bgStage=i,this.currentTextureName=n,this.currentTextureGroupName=n,this.canMergeH=!1,this.canMergeV=!1,this.canMergeRooftop=!1}(q["buildings.buildingDrawers.BuildingDrawer"]=An).__name__="buildings.buildingDrawers.BuildingDrawer",An.prototype={positionSpritesMerging:function(){},positionSprites:function(){},changeMainTexture:function(t){this.currentTextureName=t,this.currentTextureGroupName=t},changeTextureGroup:function(t){this.currentTextureGroupName=t},destroy:function(){},__class__:An};function Mn(){}(q["buildings.buildingDrawers.AtLeastLRMergingBuildingDrawer"]=Mn).__name__="buildings.buildingDrawers.AtLeastLRMergingBuildingDrawer",Mn.__isInterface__=!0;var Bn=function(t,e,i,n){this.bridgeRightMergeFlag=!1,this.bridgeLeftMergeFlag=!1,this.fgTexturesSet=null,this.bgTexturesSet=null,this.currentSecondaryTexture=0,this.secondaryBackgroundTextureName=null,An.call(this,t,e,i,n),this.canMergeH=!0,this.canMergeV=!0,this.bgSpriteTopLeft=new PIXI.Sprite,i.cacheableChildren.push(this.bgSpriteTopLeft),i.isInvalid=!0,this.bgSpriteTopRight=new PIXI.Sprite,i.cacheableChildren.push(this.bgSpriteTopRight),i.isInvalid=!0,this.spriteTopLeft=new PIXI.Sprite,e.cacheableChildren.push(this.spriteTopLeft),e.isInvalid=!0,this.spriteTopRight=new PIXI.Sprite,e.cacheableChildren.push(this.spriteTopRight),e.isInvalid=!0,this.bgSpriteBottomLeft=new PIXI.Sprite,i.cacheableChildren.push(this.bgSpriteBottomLeft),i.isInvalid=!0,this.bgSpriteBottomRight=new PIXI.Sprite,i.cacheableChildren.push(this.bgSpriteBottomRight),i.isInvalid=!0,this.spriteBottomLeft=new PIXI.Sprite,e.cacheableChildren.push(this.spriteBottomLeft),e.isInvalid=!0,this.spriteBottomRight=new PIXI.Sprite,e.cacheableChildren.push(this.spriteBottomRight),e.isInvalid=!0,this.spriteSecondaryBackground=new PIXI.Sprite,i.cacheableChildren.push(this.spriteSecondaryBackground),i.isInvalid=!0,this.positionSprites(),this.secondaryBackgroundTextureName=null};(q["buildings.buildingDrawers.AllDirMergingBuildingDrawer"]=Bn).__name__="buildings.buildingDrawers.AllDirMergingBuildingDrawer",Bn.__interfaces__=[Mn],Bn.__super__=An,Bn.prototype=e(An.prototype,{positionSprites:function(){this.building.city.updateConnectedBuildingSprites=!0},setBackgroundTextures:function(t){this.bgTexturesSet=dt.getTexturesAsGrid(t,10,2,2,!0)},setForegroundTextures:function(t){this.fgTexturesSet=dt.getTexturesAsGrid(t,10,2,2,!0)},positionSpritesMerging:function(){this.spriteTopLeft.position.set(this.building.position.x,this.building.position.y),this.bgSpriteTopLeft.position.set(this.building.position.x,this.building.position.y),this.spriteTopRight.position.set(this.building.position.x+10,this.building.position.y),this.bgSpriteTopRight.position.set(this.building.position.x+10,this.building.position.y),this.spriteBottomLeft.position.set(this.building.position.x,this.building.position.y+10),this.bgSpriteBottomLeft.position.set(this.building.position.x,this.building.position.y+10),this.spriteBottomRight.position.set(this.building.position.x+10,this.building.position.y+10),this.bgSpriteBottomRight.position.set(this.building.position.x+10,this.building.position.y+10),this.spriteSecondaryBackground.position.set(this.building.position.x,this.building.position.y);var t=this.isConnectedBuilding(this.building.leftBuilding),e=this.isConnectedBuilding(this.building.rightBuilding),i=this.isConnectedBuilding(this.building.topBuilding),n=this.isConnectedBuilding(this.building.bottomBuilding),r=!1,s=!1,o=!1,a=!1;t&&i&&(r=this.isConnectedBuilding(this.building.topBuilding.leftBuilding)),e&&i&&(s=this.isConnectedBuilding(this.building.topBuilding.rightBuilding)),t&&n&&(o=this.isConnectedBuilding(this.building.leftBuilding.bottomBuilding)),e&&n&&(a=this.isConnectedBuilding(this.building.rightBuilding.bottomBuilding)),t=t||this.bridgeLeftMergeFlag||this.isConnectedBuildingHOnly(this.building.leftBuilding),e=e||this.bridgeRightMergeFlag||this.isConnectedBuildingHOnly(this.building.rightBuilding);var l=dt.getTexturesBySize(this.currentTextureName,10,10,2,!0),h=0==this.building.worldPosition.y,u=6*((t?1:0)+(i?2:0)+(r?1:0)),c=1+6*((e?1:0)+(i?2:0)+(s?1:0)),d=6*((t?1:0)+(n?2:0)+(o?1:0)),p=1+6*((e?1:0)+(n?2:0)+(a?1:0));if(null==this.fgTexturesSet||h)this.spriteTopLeft.texture=l[u+(h?2:0)][0],this.spriteTopRight.texture=l[c+(h?2:0)][0],this.spriteBottomLeft.texture=l[d+(h?2:0)][1],this.spriteBottomRight.texture=l[p+(h?2:0)][1];else{var f=2*((t?1:0)+(i?2:0)+(r?1:0));this.spriteTopLeft.texture=this.fgTexturesSet[f][0];var g=1+2*((e?1:0)+(i?2:0)+(s?1:0));this.spriteTopRight.texture=this.fgTexturesSet[g][0];var m=2*((t?1:0)+(n?2:0)+(o?1:0));this.spriteBottomLeft.texture=this.fgTexturesSet[m][1];var y=1+2*((e?1:0)+(n?2:0)+(a?1:0));this.spriteBottomRight.texture=this.fgTexturesSet[y][1]}if(null!=this.bgTexturesSet){f=2*((t?1:0)+(i?2:0)+(r?1:0));this.bgSpriteTopLeft.texture=this.bgTexturesSet[f][0];g=1+2*((e?1:0)+(i?2:0)+(s?1:0));this.bgSpriteTopRight.texture=this.bgTexturesSet[g][0];m=2*((t?1:0)+(n?2:0)+(o?1:0));this.bgSpriteBottomLeft.texture=this.bgTexturesSet[m][1];y=1+2*((e?1:0)+(n?2:0)+(a?1:0));this.bgSpriteBottomRight.texture=this.bgTexturesSet[y][1]}else this.bgSpriteTopLeft.texture=l[4+u][0],this.bgSpriteTopRight.texture=l[4+c][0],this.bgSpriteBottomLeft.texture=l[4+d][1],this.bgSpriteBottomRight.texture=l[4+p][1];if(this.bgStage.isInvalid=!0,this.stage.isInvalid=!0,null!=this.secondaryBackgroundTextureName){for(var _=this.building,v=Ko.getClass(this.building);null!=_.bottomBuilding&&_.bottomBuilding.is(v);)_=_.bottomBuilding;if(_!=this.building){var b=_.drawer;if(null!=b.secondaryBackgroundTextureName){var w=b.getCurrentSecondaryTextureGroup();w!=this.getCurrentSecondaryTextureGroup()&&this.setGroupOfSecondaryTextureForBuilding(this.building,w)}}this.updateSecondaryBackgroundImage(i,n)}},setSecondaryBackgroundImages:function(t,e,i,n){this.secondaryBackgroundTextureName=t,this.secondaryBackgroundSets=e,this.currentSecondaryTexture=i,this.secondaryTextureOnSet=n,this.updateSecondaryBackgroundImageNoExtraInfo()},updateSecondaryBackgroundImageNoExtraInfo:function(){this.updateSecondaryBackgroundImage(this.isConnectedBuilding(this.building.topBuilding),this.isConnectedBuilding(this.building.bottomBuilding))},updateSecondaryBackgroundImage:function(t,e){if(null!=this.secondaryBackgroundTextureName){var i=this.getCurrentSecondaryBackTextures();this.spriteSecondaryBackground.texture=i[(e?1:0)+(t?3:0)+(t&&e?-2:0)],this.bgStage.isInvalid=!0}},changeMainTexture:function(t){An.prototype.changeMainTexture.call(this,t),this.positionSprites()},destroy:function(){An.prototype.destroy.call(this);var t=this.bgStage,e=this.bgSpriteTopLeft;at.remove(t.cacheableChildren,e),t.isInvalid=!0,e.destroy({children:!0,texture:!1});t=this.bgStage,e=this.bgSpriteTopRight;at.remove(t.cacheableChildren,e),t.isInvalid=!0,e.destroy({children:!0,texture:!1});t=this.bgStage,e=this.bgSpriteBottomLeft;at.remove(t.cacheableChildren,e),t.isInvalid=!0,e.destroy({children:!0,texture:!1});t=this.bgStage,e=this.bgSpriteBottomRight;at.remove(t.cacheableChildren,e),t.isInvalid=!0,e.destroy({children:!0,texture:!1});t=this.bgStage,e=this.spriteSecondaryBackground;at.remove(t.cacheableChildren,e),t.isInvalid=!0,e.destroy({children:!0,texture:!1});t=this.stage,e=this.spriteTopLeft;at.remove(t.cacheableChildren,e),t.isInvalid=!0,e.destroy({children:!0,texture:!1});t=this.stage,e=this.spriteTopRight;at.remove(t.cacheableChildren,e),t.isInvalid=!0,e.destroy({children:!0,texture:!1});t=this.stage,e=this.spriteBottomLeft;at.remove(t.cacheableChildren,e),t.isInvalid=!0,e.destroy({children:!0,texture:!1});t=this.stage,e=this.spriteBottomRight;at.remove(t.cacheableChildren,e),t.isInvalid=!0,e.destroy({children:!0,texture:!1}),this.building.city.updateConnectedBuildingSprites=!0},isConnectedBuilding:function(t){if(null==t)return!1;var e=this.getOtherAMDrawer(t);return null!=e&&(e.currentTextureName==this.currentTextureName||e.currentTextureGroupName==this.currentTextureGroupName)},isConnectedBuildingHOnly:function(t){if(null==t)return!1;var e=this.getOtherAMDrawerHOnly(t);return null!=e&&(e.currentTextureName==this.currentTextureName||e.currentTextureGroupName==this.currentTextureGroupName)},getOtherAMDrawer:function(t){if(null==t)return null;var e=t.drawer;return e.canMergeH&&e.canMergeV?e:null},getOtherAMDrawerHOnly:function(t){if(null==t)return null;var e=t.drawer;return e.canMergeH?e:null},getSecondaryBackTextures:function(){return dt.getTexturesBySize(this.secondaryBackgroundTextureName,20,20)},getCurrentSecondaryBackTextures:function(){return this.getSecondaryBackTextures()[this.currentSecondaryTexture]},getCurrentSecondaryTextureGroup:function(){return this.getSecondaryTextureGroup(this.currentSecondaryTexture)},getSecondaryTextureGroup:function(t){for(var e=-1,i=0;i<=t;)++e,i+=this.secondaryBackgroundSets[e];return e},getFirstSecondaryTextureOfGroup:function(t){for(var e=0,i=0;i<t;)e+=this.secondaryBackgroundSets[i],++i;return e},setSecondaryTextureWithinGroup:function(t){this.currentSecondaryTexture=this.getFirstSecondaryTextureOfGroup(this.getCurrentSecondaryTextureGroup())+t,this.secondaryTextureOnSet(this.currentSecondaryTexture),this.updateSecondaryBackgroundImageNoExtraInfo()},setGroupOfSecondaryTexture:function(t){for(var e=Ko.getClass(this.building),i=this.building;null!=i.bottomBuilding&&i.bottomBuilding.is(e)&&this.isConnectedBuilding(i.bottomBuilding);)i=i.bottomBuilding;for(;this.setGroupOfSecondaryTextureForBuilding(i,t),null!=i.topBuilding&&i.topBuilding.is(e)&&this.isConnectedBuilding(i.topBuilding);)i=i.topBuilding},setGroupOfSecondaryTextureForThisBuilding:function(t){this.setGroupOfSecondaryTextureForBuilding(this.building,t)},setGroupOfSecondaryTextureForBuilding:function(t,e){var i=t.drawer;i.currentSecondaryTexture=this.getFirstSecondaryTextureOfGroup(e)+il.getInt(this.secondaryBackgroundSets[e]),i.secondaryTextureOnSet(i.currentSecondaryTexture),i.updateSecondaryBackgroundImageNoExtraInfo()},__class__:Bn});var Rn=function(t,e,i,n){this.bridgeRightMergeFlag=!1,this.bridgeLeftMergeFlag=!1,An.call(this,t,e,i,n),this.canMergeH=!0,this.canMergeV=!1,this.bgSpriteLeft=new PIXI.Sprite,i.cacheableChildren.push(this.bgSpriteLeft),i.isInvalid=!0,this.bgSpriteRight=new PIXI.Sprite,i.cacheableChildren.push(this.bgSpriteRight),i.isInvalid=!0,this.spriteLeft=new PIXI.Sprite,e.cacheableChildren.push(this.spriteLeft),e.isInvalid=!0,this.spriteRight=new PIXI.Sprite,e.cacheableChildren.push(this.spriteRight),e.isInvalid=!0,this.positionSprites()};(q["buildings.buildingDrawers.AutoMergingBuildingDrawer"]=Rn).__name__="buildings.buildingDrawers.AutoMergingBuildingDrawer",Rn.__interfaces__=[Mn],Rn.__super__=An,Rn.prototype=e(An.prototype,{positionSpritesMerging:function(){this.spriteLeft.position.set(this.building.position.x,this.building.position.y),this.bgSpriteLeft.position.set(this.building.position.x,this.building.position.y),this.spriteRight.position.set(this.building.position.x+10,this.building.position.y),this.bgSpriteRight.position.set(this.building.position.x+10,this.building.position.y);var t=0==this.building.worldPosition.y,e=this.bridgeLeftMergeFlag||this.isConnectedBuilding(this.getLeftBuilding(this.building)),i=this.bridgeRightMergeFlag||this.isConnectedBuilding(this.getRightBuilding(this.building)),n=dt.getTexturesByWidth(this.currentTextureName,10,!0);this.bgSpriteLeft.texture=n[4+(e?6:0)],this.bgSpriteRight.texture=n[5+(i?6:0)],this.spriteLeft.texture=n[(t?2:0)+(e?6:0)],this.spriteRight.texture=n[1+(t?2:0)+(i?6:0)],this.stage.isInvalid=!0,this.bgStage.isInvalid=!0},getLeftBuilding:function(t){return t.leftBuilding},getRightBuilding:function(t){return t.rightBuilding},positionSprites:function(){this.building.city.updateConnectedBuildingSprites=!0},changeMainTexture:function(t){An.prototype.changeMainTexture.call(this,t),this.positionSprites()},destroy:function(){An.prototype.destroy.call(this);var t=this.bgStage,e=this.bgSpriteLeft;at.remove(t.cacheableChildren,e),t.isInvalid=!0,e.destroy({children:!0,texture:!1});t=this.bgStage,e=this.bgSpriteRight;at.remove(t.cacheableChildren,e),t.isInvalid=!0,e.destroy({children:!0,texture:!1});t=this.stage,e=this.spriteLeft;at.remove(t.cacheableChildren,e),t.isInvalid=!0,e.destroy({children:!0,texture:!1});t=this.stage,e=this.spriteRight;at.remove(t.cacheableChildren,e),t.isInvalid=!0,e.destroy({children:!0,texture:!1}),this.building.city.updateConnectedBuildingSprites=!0},isConnectedBuilding:function(t){if(null==t)return!1;var e=this.getOtherAMDrawer(t);return null!=e&&(e.currentTextureName==this.currentTextureName||e.currentTextureGroupName==this.currentTextureGroupName)},getOtherAMDrawer:function(t){if(null==t)return null;var e=t.drawer;return e.canMergeH?e:null},__class__:Rn});var On=function(t,e,i,n){An.call(this,t,e,i,n),this.canMergeH=!0,this.canMergeV=!1,this.bgSpriteLeft=new PIXI.Sprite,i.cacheableChildren.push(this.bgSpriteLeft),i.isInvalid=!0,this.bgSpriteRight=new PIXI.Sprite,i.cacheableChildren.push(this.bgSpriteRight),i.isInvalid=!0,this.spriteLeft=new PIXI.Sprite,e.cacheableChildren.push(this.spriteLeft),e.isInvalid=!0,this.spriteRight=new PIXI.Sprite,e.cacheableChildren.push(this.spriteRight),e.isInvalid=!0,this.positionSprites()};(q["buildings.buildingDrawers.AutoMergingBuildingDrawerDifferentForType"]=On).__name__="buildings.buildingDrawers.AutoMergingBuildingDrawerDifferentForType",On.__super__=An,On.prototype=e(An.prototype,{positionSpritesMerging:function(){this.spriteLeft.position.set(this.building.position.x,this.building.position.y),this.bgSpriteLeft.position.set(this.building.position.x,this.building.position.y),this.spriteRight.position.set(this.building.position.x+10,this.building.position.y),this.bgSpriteRight.position.set(this.building.position.x+10,this.building.position.y);var t=0==this.building.worldPosition.y,e=this.isConnectedBuilding(this.building.leftBuilding),i=this.isConnectedBuilding(this.building.rightBuilding),n=!0,r=!0;e&&(n=this.isFullyConnectedBuilding(this.building.leftBuilding)),i&&(r=this.isFullyConnectedBuilding(this.building.rightBuilding));var s=dt.getTexturesByWidth(this.currentTextureName,10,!0);this.bgSpriteLeft.texture=s[4+(e?6:0)+(n?0:6)],this.bgSpriteRight.texture=s[5+(i?6:0)+(r?0:6)],this.spriteLeft.texture=s[(t?2:0)+(e?6:0)+(n?0:6)],this.spriteRight.texture=s[1+(t?2:0)+(i?6:0)+(r?0:6)],this.stage.isInvalid=!0,this.bgStage.isInvalid=!0},positionSprites:function(){this.building.city.updateConnectedBuildingSprites=!0},changeMainTexture:function(t){An.prototype.changeMainTexture.call(this,t),this.positionSprites()},destroy:function(){An.prototype.destroy.call(this);var t=this.bgStage,e=this.bgSpriteLeft;at.remove(t.cacheableChildren,e),t.isInvalid=!0,e.destroy({children:!0,texture:!1});t=this.bgStage,e=this.bgSpriteRight;at.remove(t.cacheableChildren,e),t.isInvalid=!0,e.destroy({children:!0,texture:!1});t=this.stage,e=this.spriteLeft;at.remove(t.cacheableChildren,e),t.isInvalid=!0,e.destroy({children:!0,texture:!1});t=this.stage,e=this.spriteRight;at.remove(t.cacheableChildren,e),t.isInvalid=!0,e.destroy({children:!0,texture:!1}),this.building.city.updateConnectedBuildingSprites=!0},isConnectedBuilding:function(t){if(null==t)return!1;var e=this.getOtherAMDrawer(t);return null!=e&&(e.currentTextureName==this.currentTextureName||e.currentTextureGroupName==this.currentTextureGroupName)},isFullyConnectedBuilding:function(t){if(null==t)return!1;var e=this.getOtherAMDrawer(t);return null!=e&&e.currentTextureName==this.currentTextureName},getOtherAMDrawer:function(t){if(null==t)return null;var e=t.drawer;return e.canMergeH?e:null},__class__:On});var kn=function(t,e,i,n){Rn.call(this,t,e,i,n)};(q["buildings.buildingDrawers.AutoMergingBuildingDrawerRooftop"]=kn).__name__="buildings.buildingDrawers.AutoMergingBuildingDrawerRooftop",kn.__super__=Rn,kn.prototype=e(Rn.prototype,{getLeftBuilding:function(t){if(null!=t.bottomBuilding)return null==t.bottomBuilding.leftBuilding?null:t.bottomBuilding.leftBuilding.topBuilding;var e=t.city.getPermanentAtPos(t.position.x-20,t.position.y);return null!=e&&e.isBuilding?e:null},getRightBuilding:function(t){if(null!=t.bottomBuilding)return null==t.bottomBuilding.rightBuilding?null:t.bottomBuilding.rightBuilding.topBuilding;var e=t.city.getPermanentAtPos(t.position.x+20,t.position.y);return null!=e&&e.isBuilding?e:null},__class__:kn});function Dn(t,e,i,n){An.call(this,t,e,i,n),this.canMergeH=!1,this.canMergeV=!0,this.bgSpriteTop=new PIXI.Sprite,i.cacheableChildren.push(this.bgSpriteTop),i.isInvalid=!0,this.bgSpriteBottom=new PIXI.Sprite,i.cacheableChildren.push(this.bgSpriteBottom),i.isInvalid=!0,this.spriteTop=new PIXI.Sprite,e.cacheableChildren.push(this.spriteTop),e.isInvalid=!0,this.spriteBottom=new PIXI.Sprite,e.cacheableChildren.push(this.spriteBottom),e.isInvalid=!0,this.positionSprites()}(q["buildings.buildingDrawers.AutoMergingBuildingDrawerUD"]=Dn).__name__="buildings.buildingDrawers.AutoMergingBuildingDrawerUD",Dn.__super__=An,Dn.prototype=e(An.prototype,{positionSpritesMerging:function(){this.spriteTop.position.set(this.building.position.x,this.building.position.y),this.bgSpriteTop.position.set(this.building.position.x,this.building.position.y),this.spriteBottom.position.set(this.building.position.x,this.building.position.y+10),this.bgSpriteBottom.position.set(this.building.position.x,this.building.position.y+10);var t=0==this.building.worldPosition.y,e=this.isConnectedBuilding(this.building.topBuilding),i=this.isConnectedBuilding(this.building.bottomBuilding),n=dt.getTexturesAsGrid(this.currentTextureName,6,2,2);this.bgSpriteTop.texture=n[2+(e?3:0)][0],this.bgSpriteBottom.texture=n[2+(i?3:0)][1],this.spriteTop.texture=n[(t?1:0)+(e?3:0)][0],this.spriteBottom.texture=n[(t?1:0)+(i?3:0)][1],this.stage.isInvalid=!0,this.bgStage.isInvalid=!0},positionSprites:function(){this.building.city.updateConnectedBuildingSprites=!0},changeMainTexture:function(t){An.prototype.changeMainTexture.call(this,t),this.positionSprites()},destroy:function(){An.prototype.destroy.call(this);var t=this.bgStage,e=this.bgSpriteTop;at.remove(t.cacheableChildren,e),t.isInvalid=!0,e.destroy({children:!0,texture:!1});t=this.bgStage,e=this.bgSpriteBottom;at.remove(t.cacheableChildren,e),t.isInvalid=!0,e.destroy({children:!0,texture:!1});t=this.stage,e=this.spriteTop;at.remove(t.cacheableChildren,e),t.isInvalid=!0,e.destroy({children:!0,texture:!1});t=this.stage,e=this.spriteBottom;at.remove(t.cacheableChildren,e),t.isInvalid=!0,e.destroy({children:!0,texture:!1}),this.building.city.updateConnectedBuildingSprites=!0},isConnectedBuilding:function(t){if(null==t)return!1;var e=this.getOtherAMDrawer(t);return null!=e&&e.currentTextureName==this.currentTextureName},getOtherAMDrawer:function(t){if(null==t)return null;var e=t.drawer;return e.canMergeV?e:null},__class__:Dn});var Fn=function(t,e,i,n){An.call(this,t,e,i,n),this.bgSprite=dt.makeSprite(this.currentTextureName,new yr(44,0,20,20)),i.cacheableChildren.push(this.bgSprite),i.isInvalid=!0,this.sprite=new PIXI.Sprite,e.cacheableChildren.push(this.sprite),e.isInvalid=!0,this.positionSprites()};(q["buildings.buildingDrawers.NormalBuildingDrawer"]=Fn).__name__="buildings.buildingDrawers.NormalBuildingDrawer",Fn.__super__=An,Fn.prototype=e(An.prototype,{positionSprites:function(){this.sprite.position.set(this.building.position.x,this.building.position.y),this.bgSprite.position.set(this.building.position.x,this.building.position.y);var t=new yr(0,0,20,20);0==this.building.worldPosition.y&&(t.x+=22),this.sprite.texture=dt.getTexture(this.currentTextureName,t),this.stage.isInvalid=!0,this.bgStage.isInvalid=!0},mirror:function(){this.bgSprite.anchor.x=1-this.bgSprite.anchor.x,this.bgSprite.scale.x=-this.bgSprite.scale.x,this.sprite.anchor.x=1-this.sprite.anchor.x,this.sprite.scale.x=-this.sprite.scale.x,this.bgStage.isInvalid=!0,this.stage.isInvalid=!0},changeMainTexture:function(t){this.currentTextureName!=t&&(An.prototype.changeMainTexture.call(this,t),this.bgSprite.texture=dt.getTexture(this.currentTextureName,new yr(44,0,20,20)),this.bgStage.isInvalid=!0,this.positionSprites())},destroy:function(){An.prototype.destroy.call(this);var t=this.bgStage,e=this.bgSprite;at.remove(t.cacheableChildren,e),t.isInvalid=!0,e.destroy({children:!0,texture:!1});t=this.stage,e=this.sprite;at.remove(t.cacheableChildren,e),t.isInvalid=!0,e.destroy({children:!0,texture:!1})},getBackgroundTexture:function(){return this.bgSprite.texture},__class__:Fn});var Nn=function(t,e,i,n){this.backTexture=null,this.frontTextureWithDoor=null,this.frontTextureNoDoor=null,Fn.call(this,t,e,i,n)};(q["buildings.buildingDrawers.CustomizableBuildingDrawer"]=Nn).__name__="buildings.buildingDrawers.CustomizableBuildingDrawer",Nn.__super__=Fn,Nn.prototype=e(Fn.prototype,{positionSprites:function(){this.sprite.position.set(this.building.position.x,this.building.position.y),this.bgSprite.position.set(this.building.position.x,this.building.position.y);var t=this.frontTextureNoDoor,e=new yr(0,0,20,20);0==this.building.worldPosition.y&&(e.x+=22,t=this.frontTextureWithDoor);var i=null!=t?t:dt.getTexture(this.currentTextureName,e);this.sprite.texture=i,this.stage.isInvalid=!0,this.bgStage.isInvalid=!0},setCustomTextures:function(t,e,i){this.frontTextureNoDoor=t,this.frontTextureWithDoor=e,null!=(this.backTexture=i)&&(this.bgSprite.texture=i,this.bgStage.isInvalid=!0),this.positionSprites()},__class__:Nn});var Ln=function(t,e,i,n){this.subImage=0,An.call(this,t,e,i,n),this.sprite=new PIXI.Sprite,e.cacheableChildren.push(this.sprite),e.isInvalid=!0,this.positionSprites()};(q["buildings.buildingDrawers.DecorationBuildingDrawer"]=Ln).__name__="buildings.buildingDrawers.DecorationBuildingDrawer",Ln.__super__=An,Ln.prototype=e(An.prototype,{positionSprites:function(){this.sprite.position.set(this.building.position.x,this.building.position.y);var t=new yr(22*this.subImage,0,20,20);this.sprite.texture=dt.getTexture(this.currentTextureName,t),this.stage.isInvalid=!0},getSubImageNumber:function(){return Math.round(dt.getTexture(this.currentTextureName).width+2)/22|0},mirror:function(){this.sprite.anchor.x=1-this.sprite.anchor.x,this.sprite.scale.x=-this.sprite.scale.x,this.stage.isInvalid=!0},changeMainTexture:function(t){An.prototype.changeMainTexture.call(this,t),this.positionSprites()},changeSubImage:function(t){this.subImage=t,this.positionSprites()},setTint:function(t){this.sprite.tint=t,this.stage.isInvalid=!0},destroy:function(){An.prototype.destroy.call(this);var t=this.stage,e=this.sprite;at.remove(t.cacheableChildren,e),t.isInvalid=!0,e.destroy({children:!0,texture:!1})},__class__:Ln});var Un=function(t,e,i,n){this.fgTexturesSet=null,this.bgTexturesSet=null,this.currentSecondaryTexture=0,this.secondaryBackgroundTextureName=null,An.call(this,t,e,i,n),this.canMergeH=!0,this.canMergeV=!0,this.bgSprite=new PIXI.Sprite,i.cacheableChildren.push(this.bgSprite),i.isInvalid=!0,this.sprite=new PIXI.Sprite,e.cacheableChildren.push(this.sprite),e.isInvalid=!0,this.spriteSecondaryBackground=new PIXI.Sprite,i.cacheableChildren.push(this.spriteSecondaryBackground),i.isInvalid=!0,this.positionSprites(),this.secondaryBackgroundTextureName=null,this.mergeClass=Ko.getClass(t)};(q["buildings.buildingDrawers.RooftopDownMergingDrawer"]=Un).__name__="buildings.buildingDrawers.RooftopDownMergingDrawer",Un.__super__=An,Un.prototype=e(An.prototype,{positionSprites:function(){this.building.city.updateConnectedBuildingSprites=!0},positionSpritesMerging:function(){this.bgSprite.position.set(this.building.position.x,this.building.position.y),this.sprite.position.set(this.building.position.x,this.building.position.y),this.spriteSecondaryBackground.position.set(this.building.position.x,this.building.position.y);var t=this.isConnectedBuilding(this.building.bottomBuilding),e=dt.getTexturesByWidth(this.currentTextureName,20),i=0==this.building.worldPosition.y;if(this.bgSprite.texture=e[t?5:2],this.sprite.texture=e[(t?3:0)+(i?1:0)],this.bgStage.isInvalid=!0,this.stage.isInvalid=!0,null!=this.secondaryBackgroundTextureName){for(var n=this.building,r=this.mergeClass;null!=n.bottomBuilding&&n.bottomBuilding.is(r);)n=n.bottomBuilding;if(n!=this.building){var s=n.drawer;if(null!=s.secondaryBackgroundTextureName){var o=s.getCurrentSecondaryTextureGroup();o!=this.getCurrentSecondaryTextureGroup()&&this.setGroupOfSecondaryTextureForBuilding(this.building,o)}}this.updateSecondaryBackgroundImage(!1,t)}},setSecondaryBackgroundImages:function(t,e,i,n){this.secondaryBackgroundTextureName=t,this.secondaryBackgroundSets=e,this.currentSecondaryTexture=i,this.secondaryTextureOnSet=n,this.updateSecondaryBackgroundImageNoExtraInfo()},updateSecondaryBackgroundImageNoExtraInfo:function(){this.updateSecondaryBackgroundImage(this.isConnectedBuilding(this.building.topBuilding),this.isConnectedBuilding(this.building.bottomBuilding))},updateSecondaryBackgroundImage:function(t,e){if(null!=this.secondaryBackgroundTextureName){var i=this.getCurrentSecondaryBackTextures();this.spriteSecondaryBackground.texture=i[(e?1:0)+(t?3:0)+(t&&e?-2:0)],this.bgStage.isInvalid=!0}},changeMainTexture:function(t){An.prototype.changeMainTexture.call(this,t),this.positionSprites()},destroy:function(){An.prototype.destroy.call(this);var t=this.bgStage,e=this.bgSprite;at.remove(t.cacheableChildren,e),t.isInvalid=!0,e.destroy({children:!0,texture:!1});t=this.bgStage,e=this.spriteSecondaryBackground;at.remove(t.cacheableChildren,e),t.isInvalid=!0,e.destroy({children:!0,texture:!1});t=this.stage,e=this.sprite;at.remove(t.cacheableChildren,e),t.isInvalid=!0,e.destroy({children:!0,texture:!1}),this.building.city.updateConnectedBuildingSprites=!0},isConnectedBuilding:function(t){if(null==t)return!1;var e=this.getOtherAMDrawer(t);return null!=e&&(e.currentTextureName==this.currentTextureName||e.currentTextureGroupName==this.currentTextureGroupName)},getOtherAMDrawer:function(t){if(null==t)return null;var e=t.drawer;return e.canMergeH&&e.canMergeV?e:null},getOtherAMDrawerHOnly:function(t){if(null==t)return null;var e=t.drawer;return e.canMergeH?e:null},getOtherAMDrawerAboveOnly:function(t){if(null==t)return null;var e=t.drawer;return e.canMergeV||e.canMergeRooftop?e:null},getSecondaryBackTextures:function(){return dt.getTexturesBySize(this.secondaryBackgroundTextureName,20,20)},getCurrentSecondaryBackTextures:function(){return this.getSecondaryBackTextures()[this.currentSecondaryTexture]},getCurrentSecondaryTextureGroup:function(){return this.getSecondaryTextureGroup(this.currentSecondaryTexture)},getSecondaryTextureGroup:function(t){for(var e=-1,i=0;i<=t;)++e,i+=this.secondaryBackgroundSets[e];return e},getFirstSecondaryTextureOfGroup:function(t){for(var e=0,i=0;i<t;)e+=this.secondaryBackgroundSets[i],++i;return e},setSecondaryTextureWithinGroup:function(t){this.currentSecondaryTexture=this.getFirstSecondaryTextureOfGroup(this.getCurrentSecondaryTextureGroup())+t,this.secondaryTextureOnSet(this.currentSecondaryTexture),this.updateSecondaryBackgroundImageNoExtraInfo()},setGroupOfSecondaryTexture:function(t){for(var e=this.mergeClass,i=this.building;null!=i.bottomBuilding&&i.bottomBuilding.is(e)&&this.isConnectedBuilding(i.bottomBuilding);)i=i.bottomBuilding;for(;this.setGroupOfSecondaryTextureForBuilding(i,t),null!=i.topBuilding&&i.topBuilding.is(e)&&this.isConnectedBuilding(i.topBuilding);)i=i.topBuilding},setGroupOfSecondaryTextureForThisBuilding:function(t){this.setGroupOfSecondaryTextureForBuilding(this.building,t)},setGroupOfSecondaryTextureForBuilding:function(t,e){var i=t.drawer;i.currentSecondaryTexture=this.getFirstSecondaryTextureOfGroup(e)+il.getInt(this.secondaryBackgroundSets[e]),i.secondaryTextureOnSet(i.currentSecondaryTexture),i.updateSecondaryBackgroundImageNoExtraInfo()},__class__:Un});function zn(t){this.isActive=!1,this.city=t,this.gui=t.gui}(q["cityActions.CitySpecialAction"]=zn).__name__="cityActions.CitySpecialAction",zn.prototype={get_specialActionID:function(){return""},get_hasPermanentAction:function(){return!1},get_canBeRestoredAfterDeactivation:function(){return!1},activate:function(){this.isActive=!0,this.city.specialActionOld=null,this.city.specialAction=this},deactivate:function(t){null==t&&(t=!1),this.isActive=!1,this.city.specialAction=null,this.get_canBeRestoredAfterDeactivation()&&!t&&(this.city.specialActionOld=this)},__class__:zn};function Wn(t,e){zn.call(this,t),this.citizen=e}(q["cityActions.ChangeCitizenVitalBuildings"]=Wn).__name__="cityActions.ChangeCitizenVitalBuildings",Wn.__super__=zn,Wn.prototype=e(zn.prototype,{get_specialActionID:function(){return"ChangeCitizenVitalBuildings"},get_hasPermanentAction:function(){return!0},activate:function(){zn.prototype.activate.call(this)},performPermanentAction:function(t){if(t.is(Qi)&&"cityofthekey"==this.city.progress.story.storyName)this.city.gui.showSimpleWindow(Tr.lo("secret_society_forbidden"),null,!0,!0);else{var e=t;if(t.is(ee)&&null==this.citizen.school&&16<=this.citizen.get_age()){var i=e,n=null;if(this.citizen.job!=i&&(n=i.workers[0],i.workers.length>=i.get_jobs()&&n.loseJob(!1),this.citizen.loseJob(!0),this.city.simulation.jobAssigner.giveCitizenJob(this.citizen,i),this.city.game.audio.playSound(this.city.game.audio.changeVitalBuildingSound),null!=this.citizen.home&&this.citizen.home!=i&&this.citizen.home.is(ee))){var r=this.citizen.home;this.citizen.home.get_residentCapacity()<=r.get_jobs()&&this.citizen.evictFromHome()}if(i.is(re)){var s=i;if(this.citizen.home!=s){var o=s.residents.length>=s.get_residentCapacity(),a=!1;if(null!=n&&n.home==s&&o?(n.evictFromHome(),a=!0):o&&(s.residents[0].evictFromHome(),a=!0),!o||a)this.citizen.evictFromHome(),((h=this.citizen).home=s).residents.push(h),this.citizen.isForcedHome||this.city.simulation.houseAssigner.citizensWithFixedHomes.push(this.citizen),this.citizen.isForcedHome=!0}}}else{var l=t;if(t.is(re)){s=l;if(this.citizen.home!=s){var h;if(s.residents.length>=s.get_residentCapacity()&&s.residents[0].evictFromHome(),this.citizen.evictFromHome(),((h=this.citizen).home=s).residents.push(h),this.citizen.isForcedHome||this.city.simulation.houseAssigner.citizensWithFixedHomes.push(this.citizen),this.citizen.isForcedHome=!0,null!=this.citizen.job&&this.citizen.home!=this.citizen.job&&this.citizen.job.is(re))this.citizen.job.get_residentCapacity()<=this.citizen.job.get_jobs()&&this.citizen.loseJob(!1);this.city.game.audio.playSound(this.city.game.audio.changeVitalBuildingSound)}}else{var u=t;if(t.is(Ki)&&this.citizen.get_age()<16){var c=u;this.citizen.school!=c&&(c.students.length>=c.get_studentCapacity()&&c.students[0].leaveSchool(),this.citizen.leaveSchool(),(this.citizen.school=c).students.push(this.citizen),this.city.game.audio.playSound(this.city.game.audio.changeVitalBuildingSound))}}}}},__class__:Wn});function Gn(){}(q["cityActions.CityHighlightBuildingsOfType"]=Gn).__name__="cityActions.CityHighlightBuildingsOfType",Gn.doHighlight=function(c,d){var p=dt.getTexturesByWidth("spr_hoverhint",22);c.setHoverHightlight(function(t){if(t.is(d)){for(var e=t,i=!1,n=0,r=e.get_possibleUpgrades();n<r.length;){var s=[r[n]];if(++n,c.progress.unlocks.getUnlockState(s[0])!=$a.Locked){var o=dt.buildingUpgradesInfo,a=s[0].__name__,l=o.h[a],h=L.fromBuildingUpgradesInfo(l);if(!gr.any(e.upgrades,function(e){return function(t){return Ko.getClass(t)==e[0]}}(s))&&(i=!0,c.materials.canAfford(h)))return p[2]}}for(n=0,r=e.get_possibleCityUpgrades();n<r.length;){var u=[r[n]];if(++n,c.progress.unlocks.getUnlockState(u[0])!=$a.Locked){o=dt.cityUpgradesInfo,a=u[0].__name__,l=o.h[a],h=L.fromCityUpgradesInfo(l);if(!gr.any(c.upgrades.upgrades,function(e){return function(t){return Ko.getClass(t)==e[0]}}(u))&&(i=!0,c.materials.canAfford(h)))return p[2]}}return i?p[1]:p[0]}return c.progress.resetCtrlToHightlightHint(),null},6735360)},Gn.findLeastUpgraded=function(t,e){for(var i=null,n=1e4,r=0,s=t.permanents;r<s.length;){var o=s[r];if(++r,o.isBuilding){var a=o;a.is(e)&&a.upgrades.length<n&&(n=a.upgrades.length,i=a)}}return i};function Hn(t){zn.call(this,t)}(q["cityActions.FollowCitizenAction"]=Hn).__name__="cityActions.FollowCitizenAction",Hn.__super__=zn,Hn.prototype=e(zn.prototype,{get_specialActionID:function(){return"FollowCitizenAction"},activate:function(){var t=this;zn.prototype.activate.call(this),this.gui.showSimpleWindow(Tr.lo("tap_near_citizen_to_follow"),null,!0),this.city.gui.setWindowPositioning(fo.Top),(this.gui.windowRelatedTo=this).gui.windowOnDestroy=function(){t.isActive=!1,t.deactivate(!0)}},deactivate:function(t){null==t&&(t=!1),this.isActive&&null!=this.gui.window&&this.gui.windowRelatedTo==this&&this.gui.closeWindow(),zn.prototype.deactivate.call(this,t)},__class__:Hn});var Xn=function(t){this.city=t,this.gui=t.gui};(q["cityActions.ViewActions"]=Xn).__name__="cityActions.ViewActions",Xn.prototype={showFollow:function(){this.gui.get_keyboard().down[17]&&0<this.city.simulation.citizens.length?(il.fromArray(this.city.simulation.citizens).onClick(),null!=this.city.specialAction&&this.city.specialAction.deactivate(!0)):this.city.activateSpecialCityAction(new Hn(this.city))},isFollowOpen:function(){return null!=this.city.specialAction&&"FollowCitizenAction"==this.city.specialAction.get_specialActionID()},__class__:Xn};function jn(){var e=Ko.getClass(this).__name__;this.info=lt.find(dt.cityUpgradesInfo,function(t){return"cityUpgrades."+t.className==e})}(q["cityUpgrades.CityUpgrade"]=jn).__name__="cityUpgrades.CityUpgrade",jn.__interfaces__=[n],jn.prototype={addToCity:function(t){this.city=t},save:function(t,e){null==e&&(e=!0),e&&t.addString(jn.saveDefinition)},load:function(t,e){null==e&&(e=t.readString());Dr.makeLoadMap(e,t)},__class__:jn};var Vn=function(){jn.call(this)};(q["cityUpgrades.BirthControl"]=Vn).__name__="cityUpgrades.BirthControl",Vn.__super__=jn,Vn.prototype=e(jn.prototype,{addToCity:function(t){(this.city=t).upgrades.vars.hasBirthControl=!0},__class__:Vn});var Yn=function(){jn.call(this)};(q["cityUpgrades.BuildingRecycling"]=Yn).__name__="cityUpgrades.BuildingRecycling",Yn.__super__=jn,Yn.prototype=e(jn.prototype,{addToCity:function(t){jn.prototype.addToCity.call(this,t),t.upgrades.vars.recyclingAmount=Math.max(t.upgrades.vars.recyclingAmount,.5),t.progress.unlocks.unlock(qn)},__class__:Yn});var qn=function(){jn.call(this)};(q["cityUpgrades.BuildingRecycling2"]=qn).__name__="cityUpgrades.BuildingRecycling2",qn.__super__=jn,qn.prototype=e(jn.prototype,{addToCity:function(t){jn.prototype.addToCity.call(this,t),t.upgrades.vars.recyclingAmount=Math.max(t.upgrades.vars.recyclingAmount,.75),t.progress.unlocks.unlock(Kn)},__class__:qn});var Kn=function(){jn.call(this)};(q["cityUpgrades.BuildingRecycling3"]=Kn).__name__="cityUpgrades.BuildingRecycling3",Kn.__super__=jn,Kn.prototype=e(jn.prototype,{addToCity:function(t){jn.prototype.addToCity.call(this,t),t.upgrades.vars.recyclingAmount=Math.max(t.upgrades.vars.recyclingAmount,.9)},__class__:Kn});var $n=function(){jn.call(this)};(q["cityUpgrades.ChipBinning"]=$n).__name__="cityUpgrades.ChipBinning",$n.__super__=jn,$n.prototype=e(jn.prototype,{addToCity:function(t){(this.city=t).upgrades.vars.computerChipFactorySpeed*=1.2},__class__:$n});var Qn=function(t){this.city=t,this.upgrades=[],this.vars=new ur};(q["cityUpgrades.CityUpgrades"]=Qn).__name__="cityUpgrades.CityUpgrades",Qn.prototype={addUpgrade:function(t){this.upgrades.push(t),t.addToCity(this.city)},saveForCitySwitch:function(){for(var t=[],e=0,i=this.upgrades;e<i.length;){var n=i[e];++e;var r=Ko.getClass(n);t.push(r.__name__)}return t},loadFromCitySwitch:function(t){for(var e=0;e<t.length;){var i=t[e];++e;var n=[q[i]];if(!gr.any(this.upgrades,function(e){return function(t){return Ko.getClass(t)==e[0]}}(n))){var r=k.createInstance(n[0],[]);this.addUpgrade(r)}}},save:function(t){var e=this.upgrades.length;if(t.size+4>t.bytes.length){var i=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+4))),t.bytes.blit(0,i,0,t.size)}t.bytes.setInt32(t.size,e),t.size+=4;for(var n=0,r=this.upgrades;n<r.length;){var s=r[n];++n;var o=Ko.getClass(s);t.addString(o.__name__),s.save(t)}},load:function(t){var e=t.bytes.getInt32(t.readStart);t.readStart+=4;for(var i=0,n=e;i<n;){i++;var r=t.readString(),s=k.createInstance(q[r],[]);if(s.load(t),this.addUpgrade(s),t.version<=11&&s instanceof or)for(var o=0,a=this.city.permanents;o<a.length;){var l=a[o];if(++o,l.is(se)){var h=l;gr.any(h.upgrades,function(t){return t instanceof xt})||h.upgrades.push(k.createInstance(xt,[h.stage,this.city.cityMidStage,h.bgStage,h]))}}}},__class__:Qn};var Jn=function(){jn.call(this)};(q["cityUpgrades.ConnectedMachines"]=Jn).__name__="cityUpgrades.ConnectedMachines",Jn.__super__=jn,Jn.prototype=e(jn.prototype,{addToCity:function(t){(this.city=t).upgrades.vars.hasConnectedMachines=!0},__class__:Jn});var Zn=function(){jn.call(this)};(q["cityUpgrades.EcoFarmUpgrade"]=Zn).__name__="cityUpgrades.EcoFarmUpgrade",Zn.__super__=jn,Zn.prototype=e(jn.prototype,{addToCity:function(t){(this.city=t).upgrades.vars.extraEcoFarmFoodToPlot1=4;for(var e=0,i=t.permanents;e<i.length;){var n=i[e];if(++e,n.is(Ue)){var r=n;r.growthAreas[0].foodPerHarvest+=4,r.growthAreas[1].foodPerHarvest+=3}}},__class__:Zn});var tr=function(){jn.call(this)};(q["cityUpgrades.GeneEditing"]=tr).__name__="cityUpgrades.GeneEditing",tr.__super__=jn,tr.prototype=e(jn.prototype,{addToCity:function(t){(this.city=t).upgrades.vars.hasGeneEditing=!0,t.progress.unlocks.unlock(Fh),t.progress.unlocks.unlock(Dh)},__class__:tr});var er=function(){jn.call(this)};(q["cityUpgrades.LibraryAllowDuplicates"]=er).__name__="cityUpgrades.LibraryAllowDuplicates",er.__super__=jn,er.prototype=e(jn.prototype,{addToCity:function(t){(this.city=t).upgrades.vars.hasGalacticLibrary=!0},__class__:er});var ir=function(){jn.call(this)};(q["cityUpgrades.MechanicalLiving"]=ir).__name__="cityUpgrades.MechanicalLiving",ir.__super__=jn,ir.prototype=e(jn.prototype,{addToCity:function(t){jn.prototype.addToCity.call(this,t),t.progress.resources.buildingInfo.h["buildings.MechanicalHouse"].residents+=1,t.progress.resources.buildingInfo.h["buildings.TinkerersHome"].residents+=1},__class__:ir});var nr=function(){jn.call(this)};(q["cityUpgrades.MedicalMachineLearning"]=nr).__name__="cityUpgrades.MedicalMachineLearning",nr.__super__=jn,nr.prototype=e(jn.prototype,{addToCity:function(t){(this.city=t).upgrades.vars.extendAgeBy+=.05},__class__:nr});var rr=function(){jn.call(this)};(q["cityUpgrades.OptimizedChipLayouts"]=rr).__name__="cityUpgrades.OptimizedChipLayouts",rr.__super__=jn,rr.prototype=e(jn.prototype,{addToCity:function(t){(this.city=t).upgrades.vars.computerChipFactorySpeed*=1.33},__class__:rr});var sr=function(){jn.call(this)};(q["cityUpgrades.SecretiveLiving"]=sr).__name__="cityUpgrades.SecretiveLiving",sr.__super__=jn,sr.prototype=e(jn.prototype,{addToCity:function(t){jn.prototype.addToCity.call(this,t),t.progress.resources.buildingInfo.h["buildings.SecretSocietyHouse"].quality+=25},__class__:sr});var or=function(){jn.call(this)};(q["cityUpgrades.SlimyLiving"]=or).__name__="cityUpgrades.SlimyLiving",or.__super__=jn,or.prototype=e(jn.prototype,{addToCity:function(t){jn.prototype.addToCity.call(this,t),t.progress.resources.buildingInfo.h["buildings.AlienHouse"].quality+=25,t.progress.unlocks.unlock(xt,!0)},__class__:or});var ar=function(){jn.call(this)};(q["cityUpgrades.SpaciousLiving"]=ar).__name__="cityUpgrades.SpaciousLiving",ar.__super__=jn,ar.prototype=e(jn.prototype,{addToCity:function(t){jn.prototype.addToCity.call(this,t),t.progress.resources.buildingInfo.h["buildings.SpaciousHouse"].quality+=15},__class__:ar});var lr=function(){jn.call(this)};(q["cityUpgrades.SuperSpaciousLiving"]=lr).__name__="cityUpgrades.SuperSpaciousLiving",lr.__super__=jn,lr.prototype=e(jn.prototype,{addToCity:function(t){jn.prototype.addToCity.call(this,t),t.progress.resources.buildingInfo.h["buildings.SpaciousHouse"].residents+=1},__class__:lr});var hr=function(){jn.call(this)};(q["cityUpgrades.UniverseMapping"]=hr).__name__="cityUpgrades.UniverseMapping",hr.__super__=jn,hr.prototype=e(jn.prototype,{addToCity:function(t){(this.city=t).upgrades.vars.stoneTeleporterChanceForRefinedMetals=.04,t.upgrades.vars.stoneTeleporterHasBigStones=!0,t.upgrades.vars.starDatabaseIsMoreEffective=!0},__class__:hr});var ur=function(){this.nightClubEntertainmentQualityBonus=0,this.hasGeneEditing=!1,this.hasConnectedMachines=!1,this.hasGalacticLibrary=!1,this.fasterRocketFuelFactory=0,this.rocketTeleporterReward=0,this.superComputerUpgrade=0,this.extraEcoFarmFoodToPlot2=0,this.extraEcoFarmFoodToPlot1=0,this.advancedBuildingAllowed=!1,this.stoneResearchCenterWithFossils=null,this.stoneMiningSpeed=1,this.computerChipFactorySpeed=1,this.recyclingAmount=0,this.hasBirthControl=!1,this.extendAgeBy=0,this.stoneTeleporterChanceForRefinedMetals=0,this.starDatabaseIsMoreEffective=!1,this.stoneTeleporterHasBigStones=!1};(q["cityUpgrades.UpgradeVars"]=ur).__name__="cityUpgrades.UpgradeVars",ur.prototype={__class__:ur};var cr=function(){jn.call(this)};(q["cityUpgrades.WoodenLiving"]=cr).__name__="cityUpgrades.WoodenLiving",cr.__super__=jn,cr.prototype=e(jn.prototype,{addToCity:function(t){jn.prototype.addToCity.call(this,t),t.progress.resources.buildingInfo.h["buildings.ComfortableHouse"].quality+=10},__class__:cr});var dr=function(){};(q["common.Achievements"]=dr).__name__="common.Achievements",dr.achieve=function(t){},dr.setEnabled=function(t){dr.achievementsAreEnabled=t};var pr=function(){};(q["common.AdHelper"]=pr).__name__="common.AdHelper",pr.init=function(t){pr.provider=null},pr.prepare=function(t){t()},pr.afterSettingConsent=function(){pr.provider.afterSettingConsent()},pr.update=function(t){if(0<=pr.adExpireTime&&(pr.adExpireTime-=t),B.isMoreAdsTest&&(pr.adExpireTime=-1),0<=pr.adExpireTimeRewarded&&(pr.adExpireTimeRewarded-=t),0<=pr.initialWaitTime){if(null!=pr.afterPrepareFunction&&0<=pr.showEUConsent&&ra.premiumInfoLoadedStore&&ra.premiumInfoLoadedStorePass)return B.hasPremium()&&(pr.showEUConsent=0),pr.afterPrepareFunction(),pr.afterPrepareFunction=null,void(pr.initialWaitTime=-1);pr.initialWaitTime-=t,pr.initialWaitTime<0&&null!=pr.afterPrepareFunction&&(B.hasPremium()&&(pr.showEUConsent=0),pr.afterPrepareFunction(),pr.afterPrepareFunction=null)}},pr.cityUpdate=function(t,e){},pr.adAvailableInterstitial=function(){return pr.provider.adAvailableInterstitial()},pr.adAvailableRewarded=function(){return pr.provider.adAvailableRewarded()&&pr.adExpireTimeRewarded,!1},pr.showRewardedInterstitial=function(t,e,i){null==i&&(i=!1);function n(){r||(r=!0,pr.adExpireTime=-1,pr.adExpireTimeRewarded=-1,e())}var r=!1;pr.adExpireTimeRewarded+=pr.minTimeBetweenRewarded,pr.provider.showRewardedInterstitial(t,n)||n(),pr.adExpireTime=Math.min(Math.max(pr.adExpireTime,pr.minTimeBetweenRewarded),pr.standardAdExpireTime)},pr.showNonRewardedInterstitialAlways=function(){B.hasRemoveAds()||null!=pr.provider&&pr.provider.showNonRewardedInterstitialIfAllowed()&&(pr.adExpireTime+=pr.standardAdExpireTime,pr.noAdShown=!1)},pr.showNonRewardedInterstitialIfAllowed=function(t){null==t&&(t=!1),B.hasRemoveAds()||null!=pr.provider&&(pr.adExpireTime<=0||pr.noAdShown&&t)&&pr.provider.showNonRewardedInterstitialIfAllowed()&&(pr.adExpireTime+=pr.standardAdExpireTime,pr.noAdShown=!1)},pr.canShowBanner=function(){return!B.hasRemoveAds()&&(null!=pr.provider&&pr.provider.canShowBanner())},pr.showBanner=function(){pr.provider.showBanner()},pr.hideBanner=function(){pr.provider.hideBanner()};function fr(){}(q["common.AdProviderHelper"]=fr).__name__="common.AdProviderHelper",fr.__isInterface__=!0,fr.prototype={__class__:fr};var gr=function(){};(q["common.ArrayExtensions"]=gr).__name__="common.ArrayExtensions",gr.whereMax=function(t,e,i){null==i&&(i=function(t){return t});for(var n=-1/0,r=null,s=0;s<t.length;){var o=t[s];if(++s,e(o)){var a=i(o);n<a&&(r=o,n=a)}}return r},gr.whereMaxWithMax=function(t,e,i,n){null==i&&(i=function(t){return t});for(var r=-1/0,s=null,o=0;o<t.length;){var a=t[o];if(++o,e(a)){var l=i(a);if(r<l&&(s=a,n<(r=l)))return s}}return s},gr.whereMin=function(t,e,i){null==i&&(i=function(t){return t});for(var n=1/0,r=null,s=0;s<t.length;){var o=t[s];if(++s,e(o)){var a=i(o);a<n&&(r=o,n=a)}}return r},gr.max=function(t,e){null==e&&(e=function(t){return t});for(var i=-1/0,n=null,r=0;r<t.length;){var s=t[r];++r;var o=e(s);i<o&&(n=s,i=o)}return n},gr.min=function(t,e){null==e&&(e=function(t){return t});for(var i=1/0,n=null,r=0;r<t.length;){var s=t[r];++r;var o=e(s);o<i&&(n=s,i=o)}return n},gr.sum=function(t,e){null==e&&(e=function(t){return t});for(var i=0,n=0;n<t.length;){var r=t[n];++n,i+=e(r)}return i},gr.sumFPoint=function(t,e){null==e&&(e=function(t){return t});for(var i=new br(0,0),n=0;n<t.length;){var r=t[n];++n;var s=e(r);i=new br(i.x+s.x,i.y+s.y)}return i},gr.isum=function(t,e){null==e&&(e=function(t){return t});for(var i=0,n=0;n<t.length;){var r=t[n];++n,i+=e(r)}return i},gr.any=function(t,e){for(var i=0;i<t.length;){var n=t[i];if(++i,e(n))return!0}return!1},gr.all=function(t,e){for(var i=0;i<t.length;){var n=t[i];if(++i,!e(n))return!1}return!0},gr.findRandom=function(t,e){for(var i=il.getInt(t.length),n=i;i<t.length;){if(e(r=t[i]))return r;++i}for(i=0;i<n;){var r;if(e(r=t[i]))return r;++i}return null};var mr=function(){};(q["common.ColorExtensions"]=mr).__name__="common.ColorExtensions",mr.toHexInt=function(t){return 65536*gh.get_red(t)+256*gh.get_green(t)+gh.get_blue(t)},mr.parse=function(t){var e=wh.parseHex(t);if(null==e&&(e=wh.parseColor(t)),null==e)return null;try{switch(e.name){case"ciexyz":case"xyz":return _h.toRgbxa(_h.fromFloats(wh.getFloatChannels(e.channels,3,!1)));case"cmy":return nh.toRgbxa(nh.fromFloats(wh.getFloatChannels(e.channels,3,!1)));case"cmyk":return rh.toRgbxa(rh.fromFloats(wh.getFloatChannels(e.channels,4,!1)));case"cubehelix":return sh.toRgbxa(sh.fromFloats(wh.getFloatChannels(e.channels,3,!1)));case"gray":case"grey":var i=wh.getFloatChannels(e.channels,1,!1)[0];return oh.toRgbxa(i);case"hcl":var n=wh.getFloatChannels(e.channels,3,!1);i=[n[2],n[1],n[0]];return dh.toRgbxa(i);case"hsb":case"hsv":return hh.toRgbxa(hh.fromFloats(wh.getFloatChannels(e.channels,3,!1)));case"hsl":return ah.toRgbxa(ah.fromFloats(wh.getFloatChannels(e.channels,3,!1)));case"hsla":return lh.toRgbxa(lh.fromFloats(wh.getFloatChannels(e.channels,4,!1)));case"hsva":return uh.toRgbxa(uh.fromFloats(wh.getFloatChannels(e.channels,4,!1)));case"hunterlab":return ch.toRgbxa(ch.fromFloats(wh.getFloatChannels(e.channels,4,!1)));case"cielab":case"lab":return ph.toRgbxa(ph.fromFloats(wh.getFloatChannels(e.channels,3,!1)));case"cielch":case"lch":return dh.toRgbxa(dh.fromFloats(wh.getFloatChannels(e.channels,3,!1)));case"cieluv":case"luv":return fh.toRgbxa(fh.fromFloats(wh.getFloatChannels(e.channels,3,!1)));case"rgb":return mh.toRgbxa(mh.fromFloats(wh.getFloatChannels(e.channels,3,!0)));case"rgba":return yh.fromFloats(wh.getFloatChannels(e.channels,4,!0));case"yuv":return vh.toRgbxa(vh.fromFloats(wh.getFloatChannels(e.channels,3,!1)));case"yxy":return bh.toRgbxa(bh.fromFloats(wh.getFloatChannels(e.channels,3,!1)));default:return null}}catch(t){return null}};var yr=function(t,e,i,n){this.x=t,this.y=e,this.width=i,this.height=n};(q["common.Rectangle"]=yr).__name__="common.Rectangle",yr.fromPixiRect=function(t){return new yr(0|t.x,0|t.y,0|t.width,0|t.height)},yr.fromStoryRect=function(t){return new yr(t.x,t.y,t.width,t.height)},yr.prototype={get_x2:function(){return this.x+this.width},get_y2:function(){return this.y+this.height},get_center:function(){return new vr(this.x+(this.width/2|0),this.y+(this.height/2|0))},clone:function(){return new yr(this.x,this.y,this.width,this.height)},intersects:function(t){var e,i;(i=this.x)>=t.x&&i<t.x+t.width?e=!0:e=(i=t.x)>=this.x&&i<this.x+this.width;return!!e&&((i=t.y)>=this.y&&i<this.y+this.height||(i=this.y)>=t.y&&i<t.y+t.height)},fullyContains:function(t){return this.x<=t.x&&this.y<=t.y&&this.get_x2()>t.get_x2()&&this.get_y2()>t.get_y2()},contains:function(t){var e;return(e=t.x)>=this.x&&e<this.x+this.width&&((e=t.y)>=this.y&&e<this.y+this.height)},__class__:yr};var _r=function(t,e,i,n){this.x=t,this.y=e,this.width=i,this.height=n};(q["common.FRectangle"]=_r).__name__="common.FRectangle",_r.prototype={get_x2:function(){return this.x+this.width},get_y2:function(){return this.y+this.height},clone:function(){return new _r(this.x,this.y,this.width,this.height)},__class__:_r};var vr=function(t,e){this.x=t,this.y=e};(q["common.Point"]=vr).__name__="common.Point",vr.distance=function(t,e){return Math.sqrt((e.x-t.x)*(e.x-t.x)+(e.y-t.y)*(e.y-t.y))},vr.mean=function(t,e){return new br(.5*(t.x+e.x),.5*(t.y+e.y))},vr.prototype={__class__:vr};var br=function(t,e){this.x=t,this.y=e};(q["common.FPoint"]=br).__name__="common.FPoint",br.distance=function(t,e){return Math.sqrt((e.x-t.x)*(e.x-t.x)+(e.y-t.y)*(e.y-t.y))},br.prototype={get_length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},__class__:br};var wr=function(){};(q["common.DesktopHelpers"]=wr).__name__="common.DesktopHelpers",wr.update=function(t){var e;t.keyboard.pressed[119]&&null!=(e=chrome.app.window.getAll()[0])&&(e.innerBounds.width=1280,e.innerBounds.height=720);t.keyboard.pressed[118]&&null!=(e=chrome.app.window.getAll()[0])&&(e.innerBounds.width=1920,e.innerBounds.height=1080)};var Sr=function(){};(q["common.GetFileReader"]=Sr).__name__="common.GetFileReader",Sr.getFileReader=function(){return new FileReader};var xr=function(){};(q["common.KongTools"]=xr).__name__="common.KongTools",xr.init=function(){jsFunctions.loadJS("site-specific/kong/quickKong.js",function(){try{QuickKong.doInitKong(),xr.kongJSLoaded=!0}catch(t){}})},xr.reportHappiness=function(t){t>xr.highestHappinessKnown&&(xr.highestHappinessKnown=t,xr.statTimeout=60),xr.statTimeout<=0&&xr.highestHappinessKnown>xr.highestHappinessReported&&xr.kongJSLoaded&&(QuickKong.setStat("happiness",xr.highestHappinessKnown),xr.highestHappinessReported=xr.highestHappinessKnown,xr.statTimeout=120)},xr.setStat=function(t,e){xr.kongJSLoaded&&QuickKong.setStat(t,e)},xr.update=function(){0<xr.statTimeout&&(xr.statTimeout-=1)};var Tr=function(){};(q["common.Localize"]=Tr).__name__="common.Localize",Tr.init=function(t){Tr.game=t},Tr.loadLanguage=function(t,i,n,r){Ir.load(t,function(t,e){t?(i?Tr.defaultLocalizations=e:Tr.localizations=e,n()):r()})},Tr.translateFiles=function(t){for(var e=Vo.keysIterator(dt.buildingInfo.h);e.hasNext();){var i=e.next(),n="buildinginfo.json/"+(a=dt.buildingInfo.h[i]).className+".";if(!Tr.loExists(n+"name")&&null!=a.name||(a.name=Tr.lo(n+"name")),!Tr.loExists(n+"description")&&null!=a.description||(a.description=Tr.lo(n+"description")),null!=a.tooltipBottomIconInfo)for(var r=0,s=a.tooltipBottomIconInfo.length;r<s;){var o=r++;!Tr.loExists(n+"tooltipBottomIconInfo_"+o)&&null!=a.tooltipBottomIconInfo[o].text||(a.tooltipBottomIconInfo[o].text=Tr.lo(n+"tooltipBottomIconInfo_"+o))}null!=(l=Tr.lo(n+"showUnlockHint"))&&"!!! missing text !!!"!=l&&(a.showUnlockHint=l)}if(null!=t)for(r=0;r<t.length;){var a=t[r];++r;var l;n="buildinginfo.json/"+a.className+".";if(!Tr.loExists(n+"name")&&null!=a.name||(a.name=Tr.lo(n+"name")),!Tr.loExists(n+"description")&&null!=a.description||(a.description=Tr.lo(n+"description")),null!=a.tooltipBottomIconInfo){s=0;for(var h=a.tooltipBottomIconInfo.length;s<h;){o=s++;!Tr.loExists(n+"tooltipBottomIconInfo_"+o)&&null!=a.tooltipBottomIconInfo[o].text||(a.tooltipBottomIconInfo[o].text=Tr.lo(n+"tooltipBottomIconInfo_"+o))}}null!=(l=Tr.lo(n+"showUnlockHint"))&&"!!! missing text !!!"!=l&&(a.showUnlockHint=l)}for(var u=Vo.keysIterator(dt.buildingUpgradesInfo.h);u.hasNext();){var c=u.next();n="buildingUpgradesInfo.json/"+(a=dt.buildingUpgradesInfo.h[c]).className+".";!Tr.loExists(n+"name")&&null!=a.name||(a.name=Tr.lo(n+"name")),!Tr.loExists(n+"description")&&null!=a.description||(a.description=Tr.lo(n+"description"))}for(r=0,s=dt.worldResourcesInfo;r<s.length;){var d=s[r];++r;n="buildableWorldResourcesInfo.json/"+d.className+".";!Tr.loExists(n+"name")&&null!=d.name||(d.name=Tr.lo(n+"name")),!Tr.loExists(n+"description")&&null!=d.description||(d.description=Tr.lo(n+"description"))}for(r=0,s=dt.bridgesInfo;r<s.length;){var p=s[r];++r;n="bridgesInfo.json/"+p.className+".";!Tr.loExists(n+"name")&&null!=p.name||(p.name=Tr.lo(n+"name")),!Tr.loExists(n+"description")&&null!=p.description||(p.description=Tr.lo(n+"description"))}for(r=0,s=dt.buildingCategoriesInfo;r<s.length;){var f=s[r];++r,!Tr.loExists("categories/"+f.name+".name")&&null!=f.displayName||(f.displayName=Tr.lo("categories/"+f.name+".name")),!Tr.loExists("categories/"+f.name+".description")&&null!=f.description||(f.description=Tr.lo("categories/"+f.name+".description"))}for(r=0,s=dt.decorationsInfo;r<s.length;){var g=s[r];++r,!Tr.loExists("decorationsInfo.json/"+g.textureName+".name")&&null!=g.name||(g.name=Tr.lo("decorationsInfo.json/"+g.textureName+".name")),!Tr.loExists("decorationsInfo.json/"+g.textureName+".description")&&null!=g.description||(g.description=Tr.lo("decorationsInfo.json/"+g.textureName+".description")),"!!! missing text !!!"==g.description&&(g.description=null)}for(var m=Vo.valueIterator(dt.cityUpgradesInfo.h);m.hasNext();){n="cityUpgradesInfo.json/"+(y=m.next()).className+".";!Tr.loExists(n+"name")&&null!=y.name||(y.name=Tr.lo(n+"name")),!Tr.loExists(n+"description")&&null!=y.description||(y.description=Tr.lo(n+"description"))}for(m=Vo.valueIterator(dt.policiesInfo.h);m.hasNext();){var y;n="policiesInfo.json/"+(y=m.next()).className+".";!Tr.loExists(n+"name")&&null!=y.name||(y.name=Tr.lo(n+"name")),!Tr.loExists(n+"description")&&null!=y.description||(y.description=Tr.lo(n+"description"))}for(r=0,s=dt.allStoriesInfo;r<s.length;){var _=s[r];++r;n="stories.json/"+_.link+".";!Tr.loExists(n+"name")&&null!=_.name||(_.name=Tr.lo(n+"name")),!Tr.loExists(n+"description")&&null!=_.description||(_.description=Tr.lo(n+"description"))}},Tr.translateStory=function(t,e){for(var i=t+".json/",n=0,r=e.goals;n<r.length;){var s=r[n];++n;var o=i+s.name+".quickText";Tr.loExists(o)?s.quickText=Tr.lo(o):s.quickText="","Welcome to this Free Play Scenario!\nA few citizens are already here. Some more will arrive over the coming days."==s.text?s.text=Tr.lo("FreePlay.FreePlayStart.text"):!Tr.loExists(i+s.name+".text")&&null!=s.text||(s.text=Tr.lo(i+s.name+".text"));var a=Tr.lo(i+s.name+".title");if("!!! missing text !!!"!=a&&(s.title=a),null!=s.planning)for(var l=0,h=s.planning;l<h.length;){var u=h[l];if(++l,"ScriptedStoryPart"==u.type)if("SpawnCitizensRegularly"==u.className){var c=u;"All the people from your ship have now arrived. Of course, your population can still grow through their offspring."==c.afterDoneMessage?c.afterDoneMessage=Tr.lo("FreePlay.FreePlayStart.planning.afterDoneMessage"):"All the people from your previous city have now arrived. Of course, your population can still grow through their offspring."==c.afterDoneMessage?c.afterDoneMessage=Tr.lo("previous_city_arrived"):"The people who wanted to move here have now all arrived. Of course, your population can still grow through their offspring."==c.afterDoneMessage&&(c.afterDoneMessage=Tr.lo("moved_here_arrived"))}}}},Tr.loExists=function(t){var e=Tr.localizations.h[t];return null!=e||null!=(e=Tr.defaultLocalizations.h[t])},Tr.lo=function(t,e){var i=Tr.localizations.h[t];if(null==i&&null==(i=Tr.defaultLocalizations.h[t])&&(i="!!! missing text !!!"),-1!=i.indexOf("[")&&(i=C.replace(i,"[tap]",Tr.game.textHelper.clickOrTap(!1)),i=C.replace(i,"[Tap]",Tr.game.textHelper.clickOrTap(!0))),null!=e)for(var n=0,r=e.length;n<r;){var s=n++,o=e[s];i=C.replace(i,"["+s+"]",o)}return C.replace(i,"\\n","\n")};var Ir=function(){};(q["common.LocalizeLoader"]=Ir).__name__="common.LocalizeLoader",Ir.load=function(t,i){var e=new PIXI.Loader;e.add("lang_"+t+".csv?cache=20221005155535"),e.use(function(t,e){t.error?i(!1,null):(i(!0,Ir.processLangFile(t.data)),e())}),e.load(function(){})},Ir.processLangFile=function(t){var e=new Vo,i=t.split("\r\n");1==i.length&&(i=t.split("\n"));for(var n=0,r=i.length;n<r;){var s=i[n++],o=s.indexOf("|"),a=s.substring(0,o),l=at.substr(s,o+1,null);e.h[a]=l}return e};function Pr(){}(q["common.MathExtensions"]=Pr).__name__="common.MathExtensions",Pr.largeNumberFormat=function(t,e){return 1e8<e?Pr.floatFormat(Math,e/1e6,0)+"m":1e6<e?Pr.floatFormat(Math,e/1e6,1)+"m":1e4<e?Pr.floatFormat(Math,e/1e3,0)+"k":1e3<e?Pr.floatFormat(Math,e/1e3,1)+"k":""+e},Pr.largeNumberFormatAlt=function(t,e){return 1e6<e?Pr.floatFormat(Math,e/1e6,1)+"m":1e5<e?Pr.floatFormat(Math,e/1e3,0)+"k":""+e},Pr.floatFormat=function(t,e,i){if(0==i)return Y.string(Math.floor(e));var n=""+(e=Math.round(e*Math.pow(10,i))),r=n.length;if(r<=i){for(;r<i;)n="0"+n,++r;return"0."+n}return at.substr(n,0,n.length-i)+"."+at.substr(n,n.length-i,null)};var Cr=function(){};(q["common.MobileApplicationLifecycleManager"]=Cr).__name__="common.MobileApplicationLifecycleManager",Cr.update=function(t){Cr.lastPlannedUnfocusOn-=t},Cr.shouldShowPause=function(){return Cr.lastPlannedUnfocusOn<0},Cr.registerPlannedFocusLoss=function(){Cr.lastPlannedUnfocusOn=300};var Er=function(){};(q["common.Performance"]=Er).__name__="common.Performance",Er.get_fps=function(){return 1e3/(gr.sum(Er.frameTimeValues)/Er.frameTimeValues.length)},Er.registerFrame=function(){var t=window.performance.now();60<Er.frameTimeValues.length&&Er.frameTimeValues.splice(0,1),0!=Er.previousTime&&Er.frameTimeValues.push(t-Er.previousTime),Er.previousTime=t,Er.isDrawingFPSCurrently&&(Er.fpsBitmap.set_text(Math.round(Er.get_fps())+""),100<=Er.get_fps()&&(Er.fpsRect.clear(),Er.fpsRect.beginFill(0,.5),Er.fpsRect.drawRect(7*Er.dpi,7*Er.dpi,46*Er.dpi,29*Er.dpi),Er.fpsRect.endFill()))};var Ar=function(t){this.text2=null,this.stage=t,this.subStage1=new PIXI.Container,t.addChild(this.subStage1),this.subStage2=new PIXI.Container,t.addChild(this.subStage2),this.logoSprite=new PIXI.Sprite(dt.getTexture("spr_title")),this.subStage2.addChild(this.logoSprite),this.graphics=new PIXI.Graphics,this.subStage1.addChild(this.graphics),jsFunctions.orientationLockSupported()?(this.text=new Ur("Please tap anywhere to continue.",{font:"Arial18",tint:16777215}),this.text2=new Ur("(if this has no effect, please rotate your device manually)",{font:"Arial16",tint:12632256}),this.text.get_anchor().set(.5,1),this.text2.get_anchor().set(.5,1)):(this.text=new Ur("Please rotate your device to continue.",{font:"Arial18",tint:16777215}),this.text.get_anchor().set(.5,1)),this.text.set_align("center"),null!=this.text2&&(this.text2.set_align("center"),this.subStage1.addChild(this.text2)),this.subStage1.addChild(this.text)};(q["common.PleaseRotateDevice"]=Ar).__name__="common.PleaseRotateDevice",Ar.prototype={update:function(t,e,i){this.subStage1.scale.x=this.subStage1.scale.y=i;var n=Math.floor(t*i/this.logoSprite.width),r=n<1?1:n;this.subStage2.scale.x=this.subStage2.scale.y=r,this.logoSprite.anchor.set(.5,0),this.logoSprite.position.set(t/r*i/2,20),this.graphics.clear(),this.graphics.beginFill(2626656,1).drawRect(0,0,t,e),this.text.set_maxWidth(t-20),null!=this.text2?(this.text2.set_maxWidth(t-20),this.text2.position.set(t/2,e-20),this.text.position.set(t/2,e-20-this.text2.get_textHeight()-10)):this.text.position.set(t/2,e-20)},destroy:function(){this.subStage1.destroy(),this.subStage2.destroy()},__class__:Ar};var Mr=function(){};(q["common.PokiHelpers"]=Mr).__name__="common.PokiHelpers",Mr.reportStartGameplay=function(){},Mr.reportStopGameplay=function(){};var Br=function(t,e,i,n,r,s,o,a){this.stage=t,this.splashSprite=new PIXI.Sprite(PIXI.Texture.from(e)),t.addChild(this.splashSprite),this.logoWidth=i,this.logoHeight=n,this.resize(r,s),this.displayTimeLeft=o,this.onDone=a};(q["common.Splash"]=Br).__name__="common.Splash",Br.prototype={update:function(t){this.splashSprite.texture.baseTexture.valid&&(this.displayTimeLeft-=t,this.displayTimeLeft<=0&&(this.destroy(),this.onDone()))},resize:function(t,e){var i=Math.min(t/this.logoWidth,e/this.logoHeight);this.splashSprite.scale.x=i,this.splashSprite.scale.y=i,this.splashSprite.position.set((t/this.logoWidth-i)*this.logoWidth/2,(e/this.logoHeight-i)*this.logoHeight/2)},destroy:function(){this.splashSprite.destroy()},__class__:Br};var Rr=function(){};(q["common.Storage"]=Rr).__name__="common.Storage",Rr.testSupport=function(e,t){if(!Rr.knowsSupport||Rr.hasSupport)if(Rr.knowsSupport&&Rr.hasSupport)e();else try{localforage.ready().then(function(){Rr.hasSupport=!0,Rr.knowsSupport=!0,e()}).catch(function(){Rr.hasSupport=!1,Rr.knowsSupport=!0,Rr.storageReplacement=new Vo,t()})}catch(t){Rr.knowsSupport=!0,Rr.hasSupport=!0,e()}else t()},Rr.getItem=function(t,e,i){return null==i&&(i=!1),Rr.hasSupport?i?localforage.getItemBuffer(t,e):localforage.getItemParsed(t,e):(Rr.testSupport(function(){null==(i?localforage.getItemBuffer(t,e):localforage.getItemParsed(t,e))&&e("error",null)},function(){Object.prototype.hasOwnProperty.call(Rr.storageReplacement.h,t)?e(null,Rr.storageReplacement.h[t]):e("error",null)}),-1)},Rr.setItem=function(t,e,i){Rr.testSupport(function(){localforage.setItem(t,e,i)},function(){Rr.storageReplacement.h[t]=e,i()})},Rr.storageSupported=function(){return!Rr.knowsSupport||Rr.hasSupport};var Or=function(){};(q["common.StringExtensions"]=Or).__name__="common.StringExtensions",Or.firstToUpper=function(t){return 0==t.length?t:t.charAt(0).toUpperCase()+at.substr(t,1,null)};var kr=function(t){this.game=t};(q["common.TextHelper"]=kr).__name__="common.TextHelper",kr.prototype={ifNotMobile:function(t){return this.game.isMobile?"":t},clickOrTap:function(t){return null==t&&(t=!0),t?this.game.isMobile?Or.firstToUpper(Tr.lo("tap")):Or.firstToUpper(Tr.lo("click")):this.game.isMobile?Tr.lo("tap"):Tr.lo("click")},__class__:kr};var Dr=function(){};(q["gamesave.GameSaveHelper"]=Dr).__name__="gamesave.GameSaveHelper",Dr.makeLoadMap=function(t,e){for(var i=new Vo,n=0,r=t.split("|");n<r.length;){var s=r[n];if(++n,""!=s){var o,a=s.split("$"),l=a[1];switch(l){case"Bool":if(e.version<29){var h=e.bytes.getInt32(e.readStart);e.readStart+=4,o=1==h&&!0}else{var u=e.bytes.b[e.readStart];e.readStart+=1,o=0<u}break;case"FPoint":o=e.readFPoint();break;case"Float":var c=e.bytes.getDouble(e.readStart);e.readStart+=8,o=c;break;case"Int":var d=e.bytes.getInt32(e.readStart);e.readStart+=4,o=d;break;case"LifeAction":switch(e.readString()){case"Nothing":o=2;break;case"School":o=1;break;case"Work":o=0;break;default:o=2}break;case"Point":o=e.readPoint();break;case"Rectangle":o=e.readRectangle();break;case"String":o=e.readString();break;case"buildings.FarmStage":switch(e.readString()){case"Cleaning":o=2;break;case"Growing":o=0;break;case"Harvesting":o=1;break;default:o=2}break;case"ds":o=Oo.run(e.readString());break;default:var p=T[l];if(null==p)throw Co.thrown("That type isn't supported while loading the game!");o=k.createEnum(p,e.readString())}i.h[a[0]]=o}}return i};var Fr=function(t){this.version=0,this.bytes=null!=t?t:new Do(new ArrayBuffer(10)),this.size=0,this.readStart=0,this.stringLocations=new Vo};(q["gamesave.ResizingBytesQueue"]=Fr).__name__="gamesave.ResizingBytesQueue",Fr.fromBase64=function(t){var e=new Fr;return e.bytes=No.decode(t),e.size=e.bytes.length,e},Fr.fromData=function(t){var e=new Fr;return e.bytes=Do.ofData(t.buffer),e.size=e.bytes.length,e},Fr.prototype={addFloat:function(t){if(this.size+8>this.bytes.length){var e=this.bytes;this.bytes=new Do(new ArrayBuffer(2*(this.size+8))),this.bytes.blit(0,e,0,this.size)}this.bytes.setDouble(this.size,t),this.size+=8},addInt:function(t){if(this.size+4>this.bytes.length){var e=this.bytes;this.bytes=new Do(new ArrayBuffer(2*(this.size+4))),this.bytes.blit(0,e,0,this.size)}this.bytes.setInt32(this.size,t),this.size+=4},addByte:function(t){if(this.size+1>this.bytes.length){var e=this.bytes;this.bytes=new Do(new ArrayBuffer(2*(this.size+1))),this.bytes.blit(0,e,0,this.size)}this.bytes.b[this.size]=t,this.size+=1},addBool:function(t){if(this.size+1>this.bytes.length){var e=this.bytes;this.bytes=new Do(new ArrayBuffer(2*(this.size+1))),this.bytes.blit(0,e,0,this.size)}this.bytes.b[this.size]=t?1:0,this.size+=1},addString:function(t){var e=this.stringLocations.h[t];if(null!=e){if(this.size+1>this.bytes.length){var i=this.bytes;this.bytes=new Do(new ArrayBuffer(2*(this.size+1))),this.bytes.blit(0,i,0,this.size)}if(this.bytes.b[this.size]=1,this.size+=1,this.size+4>this.bytes.length){i=this.bytes;this.bytes=new Do(new ArrayBuffer(2*(this.size+4))),this.bytes.blit(0,i,0,this.size)}return this.bytes.setInt32(this.size,e),void(this.size+=4)}if(this.size+1>this.bytes.length){i=this.bytes;this.bytes=new Do(new ArrayBuffer(2*(this.size+1))),this.bytes.blit(0,i,0,this.size)}this.bytes.b[this.size]=0,this.size+=1;var n=this.size,r=(t.length,0);if(this.size+4>this.bytes.length){i=this.bytes;this.bytes=new Do(new ArrayBuffer(2*(this.size+4))),this.bytes.blit(0,i,0,this.size)}this.bytes.setInt32(this.size,0),this.size+=4;for(var s=0;s<t.length;){var o=t.charCodeAt(s++);if(55296<=o&&o<=56319&&(o=o-55232<<10|1023&t.charCodeAt(s++),0),o<=127){if(this.size+1>this.bytes.length){i=this.bytes;this.bytes=new Do(new ArrayBuffer(2*(this.size+1))),this.bytes.blit(0,i,0,this.size)}this.bytes.b[this.size]=o,this.size+=1,++r}else if(o<=2047){if(this.size+1>this.bytes.length){var a=this.bytes;this.bytes=new Do(new ArrayBuffer(2*(this.size+1))),this.bytes.blit(0,a,0,this.size)}if(this.bytes.b[this.size]=192|o>>6,this.size+=1,this.size+1>this.bytes.length){var l=this.bytes;this.bytes=new Do(new ArrayBuffer(2*(this.size+1))),this.bytes.blit(0,l,0,this.size)}this.bytes.b[this.size]=128|63&o,this.size+=1,0,r+=2}else if(o<=65535){if(this.size+1>this.bytes.length){var h=this.bytes;this.bytes=new Do(new ArrayBuffer(2*(this.size+1))),this.bytes.blit(0,h,0,this.size)}if(this.bytes.b[this.size]=224|o>>12,this.size+=1,this.size+1>this.bytes.length){var u=this.bytes;this.bytes=new Do(new ArrayBuffer(2*(this.size+1))),this.bytes.blit(0,u,0,this.size)}if(this.bytes.b[this.size]=128|o>>6&63,this.size+=1,this.size+1>this.bytes.length){var c=this.bytes;this.bytes=new Do(new ArrayBuffer(2*(this.size+1))),this.bytes.blit(0,c,0,this.size)}this.bytes.b[this.size]=128|63&o,this.size+=1,2,r+=3}else{if(this.size+1>this.bytes.length){var d=this.bytes;this.bytes=new Do(new ArrayBuffer(2*(this.size+1))),this.bytes.blit(0,d,0,this.size)}if(this.bytes.b[this.size]=240|o>>18,this.size+=1,this.size+1>this.bytes.length){var p=this.bytes;this.bytes=new Do(new ArrayBuffer(2*(this.size+1))),this.bytes.blit(0,p,0,this.size)}if(this.bytes.b[this.size]=128|o>>12&63,this.size+=1,this.size+1>this.bytes.length){var f=this.bytes;this.bytes=new Do(new ArrayBuffer(2*(this.size+1))),this.bytes.blit(0,f,0,this.size)}if(this.bytes.b[this.size]=128|o>>6&63,this.size+=1,this.size+1>this.bytes.length){var g=this.bytes;this.bytes=new Do(new ArrayBuffer(2*(this.size+1))),this.bytes.blit(0,g,0,this.size)}this.bytes.b[this.size]=128|63&o,this.size+=1,3,r+=4}}this.stringLocations.h[t]=n,this.bytes.setInt32(n,r)},addRectangle:function(t){var e=t.x;if(this.size+4>this.bytes.length){var i=this.bytes;this.bytes=new Do(new ArrayBuffer(2*(this.size+4))),this.bytes.blit(0,i,0,this.size)}this.bytes.setInt32(this.size,e),this.size+=4;e=t.y;if(this.size+4>this.bytes.length){i=this.bytes;this.bytes=new Do(new ArrayBuffer(2*(this.size+4))),this.bytes.blit(0,i,0,this.size)}this.bytes.setInt32(this.size,e),this.size+=4;e=t.width;if(this.size+4>this.bytes.length){i=this.bytes;this.bytes=new Do(new ArrayBuffer(2*(this.size+4))),this.bytes.blit(0,i,0,this.size)}this.bytes.setInt32(this.size,e),this.size+=4;e=t.height;if(this.size+4>this.bytes.length){i=this.bytes;this.bytes=new Do(new ArrayBuffer(2*(this.size+4))),this.bytes.blit(0,i,0,this.size)}this.bytes.setInt32(this.size,e),this.size+=4},readRectangle:function(){var t=this.bytes.getInt32(this.readStart);this.readStart+=4;var e=this.bytes.getInt32(this.readStart);this.readStart+=4;var i=this.bytes.getInt32(this.readStart);this.readStart+=4;var n=this.bytes.getInt32(this.readStart);return this.readStart+=4,new yr(t,e,i,n)},addFPoint:function(t){var e=t.x;if(this.size+8>this.bytes.length){var i=this.bytes;this.bytes=new Do(new ArrayBuffer(2*(this.size+8))),this.bytes.blit(0,i,0,this.size)}this.bytes.setDouble(this.size,e),this.size+=8;e=t.y;if(this.size+8>this.bytes.length){i=this.bytes;this.bytes=new Do(new ArrayBuffer(2*(this.size+8))),this.bytes.blit(0,i,0,this.size)}this.bytes.setDouble(this.size,e),this.size+=8},addJSON:function(t){this.addString(JSON.stringify(t))},readJSON:function(){return JSON.parse(this.readString())},readPoint:function(){var t=this.bytes.getInt32(this.readStart);this.readStart+=4;var e=this.bytes.getInt32(this.readStart);return this.readStart+=4,new vr(t,e)},readFPoint:function(){var t=this.bytes.getDouble(this.readStart);this.readStart+=8;var e=this.bytes.getDouble(this.readStart);return this.readStart+=8,new br(t,e)},readString:function(){var t=this.bytes.b[this.readStart];if(this.readStart+=1,1==t){var e=this.bytes.getInt32(this.readStart);this.readStart+=4;var i=e,n=this.bytes.getInt32(i);return this.bytes.getString(i+4,n)}e=this.bytes.getInt32(this.readStart);this.readStart+=4;var r=e,s=this.bytes.getString(this.readStart,r);return this.readStart+=r,s},readInt:function(){var t=this.bytes.getInt32(this.readStart);return this.readStart+=4,t},peekInt:function(){return this.bytes.getInt32(this.readStart)},readByte:function(){var t=this.bytes.b[this.readStart];return this.readStart+=1,t},readBool:function(){var t=this.bytes.b[this.readStart];return this.readStart+=1,0<t},readFloat:function(){var t=this.bytes.getDouble(this.readStart);return this.readStart+=8,t},toBase64:function(){var t=new Do(new ArrayBuffer(this.size));return t.blit(0,this.bytes,0,this.size),No.encode(t)},getData:function(){var t=new Do(new ArrayBuffer(this.size));return t.blit(0,this.bytes,0,this.size),t.b},__class__:Fr};var Nr=function(){};(q["gamesave.SaveMetaData"]=Nr).__name__="gamesave.SaveMetaData",Nr.saveMetaData=function(t,e,i){var n=lt.find(dt.allStoriesInfo,function(t){return t.link==i.progress.story.storyName}),r=Tr.lo("city");r=null!=n?n.name:Tr.lo("stories.json/"+i.progress.story.storyName+".name"),""!=i.cityName&&(r=i.cityName);var s=Tr.lo("file_description",[r,i.simulation.citizens.length]);0<i.subCities.length&&(s=Tr.lo("file_description_colony",[r,i.subCities.length,gr.sum(i.progress.allCitiesInfo.subCityPops)])),Rr.setItem(e+"__meta",s,function(){}),Rr.setItem("__meta__mostRecentlyPlayed",t,function(){})};var Lr=function(t,e){this.didntInit=!1,this.parallaxLayers=3,this.parallax=.2,this.cloudSpeedCurMult=1,this.cloudSpeedParallaxMult=.12500000125000002,this.cloudSpeedBase=.12500000125000002,this.stage=t;for(var i=[],n=0,r=this.parallaxLayers;n<r;){n++;i.push(new PIXI.Container)}this.cloudsStages=i;for(i=[],n=0,r=this.parallaxLayers;n<r;){n++;i.push([])}this.cloudsByLayer=i,this.backgroundImagesStage=new PIXI.Container,t.addChild(this.backgroundImagesStage);for(i=0,n=this.cloudsStages;i<n.length;){var s=n[i];++i,t.addChild(s)}this.city=e,this.backgroundSprites=[]};(q["graphics.BackgroundImages"]=Lr).__name__="graphics.BackgroundImages",Lr.prototype={postCreate:function(){if(null!=this.city.progress.story&&null!=this.city.progress.story.storyInfo&&null!=this.city.progress.story.storyInfo.backgroundSprites){for(var t=0,e=this.city.progress.story.storyInfo.backgroundSprites;t<e.length;){var i=e[t];++t;var n=dt.getTexturesByWidth(i.sprite,i.width),r=new PIXI.Sprite(n[n.length-2]);r.alpha=1,r.anchor.set(.5,.5),this.backgroundImagesStage.addChild(r);var s=new PIXI.Sprite(n[i.image]);s.alpha=.4,s.anchor.set(.5,.5),this.backgroundImagesStage.addChild(s);var o=new PIXI.Sprite(n[n.length-1]);o.alpha=.04,o.anchor.set(.5,.5),this.backgroundImagesStage.addChild(o),this.backgroundSprites.push({info:i,sprite:s,backgroundSprite:r,fgSprite:o})}this.resize()}if(O.disableClouds)this.didntInit=!0;else{var a=this.city.getCityEdges();for(t=0,e=this.parallaxLayers;t<e;)for(var l=t++,h=0,u=500+((a.maxX-a.minX)/40|0);h<u;){h++;this.doCloudsStep(40,a,l)}}},resize:function(){},update:function(t){if(this.backgroundImagesStage.visible=!O.disablePlanets,!O.disableClouds&&this.didntInit){for(var e=this.city.getCityEdges(),i=0,n=this.parallaxLayers;i<n;)for(var r=i++,s=0;s<500;){var o=s++;this.doCloudsStep(40,e,r)}this.didntInit=!1}this.city.skyColor;var a=this.city.stars.cloudsAlpha;for(i=0,n=this.backgroundSprites;i<n.length;){var l=n[i];++i;var h=Math.sqrt(l.info.x*l.info.x+l.info.y*l.info.y),u=Math.atan2(l.info.y,l.info.x)+0*this.city.simulation.time.timeSinceStart*125e-7*l.info.velocity,c=h*Math.cos(u),d=h*Math.sin(u);l.sprite.position.set(c+this.city.game.rect.width*this.city.game.scaling/2/this.city.zoomScale,d+this.city.game.rect.height*this.city.game.scaling/2/this.city.zoomScale),l.backgroundSprite.position.set(l.sprite.position.x,l.sprite.position.y),l.fgSprite.position.set(l.sprite.position.x,l.sprite.position.y)}for(i=0,n=this.backgroundSprites;i<n.length;){l=n[i];++i,l.backgroundSprite.tint=this.city.skyColor}var p=this.city.game,f=(e=this.city.getCityEdges(),this.city.zoomScale);for(i=0,n=this.parallaxLayers;i<n;){o=i++;var g=this.cloudsStages[o];if(O.disableClouds)g.visible=!1;else{var m=this.city.viewPos,y=this.parallax+this.parallax*o,_=m.x*y,v=m.y*y;g.alpha=a,0==g.alpha?g.visible=!1:g.visible=!0,this.city.cityView.city.viewIsControlled?g.position.set((-_+p.addX)*f+(p.rect.width/2|0)*p.scaling,(-v+p.addY)*f+p.scaling*(p.rect.height/2|0)):g.position.set(Math.floor((-_+p.addX)*f+(p.rect.width/2|0)*p.scaling),Math.floor((-v+p.addY)*f+p.scaling*(p.rect.height/2|0))),this.doCloudsStep(t,e,o)}}},doCloudsStep:function(t,e,i){var n=this.city.game,r=this.parallax*(i+1),s=this.cloudsByLayer[i],o=e.minX*r-300-300,a=(n.rect.width/2|0)*n.scaling,l=this.city.cityView.get_game().scaling/2,h=O.allowMoreZoom?1:2,u=o-a*Math.floor(l<1?1:h<l?h:l),c=e.maxX*r+120+300,d=(n.rect.width/2|0)*n.scaling,p=(l=this.city.cityView.get_game().scaling/2,h=O.allowMoreZoom?1:2,c+d*Math.floor(l<1?1:h<l?h:l)),f=(n.rect.height/2|0)*n.scaling,g=(l=this.city.cityView.get_game().scaling/2,h=O.allowMoreZoom?1:2,f*Math.floor(l<1?1:h<l?h:l)),m=e.minY*r-300-g,y=e.maxY*r+300+g;if(s.length<1e3&&il.getFloat()<t*Math.min(.15,(7-1.8*i)*(y-m)*9e-7)){var _=new Wr(this,this.cloudsStages[i],new br(u-300,il.getFloat(m,y)),i+1),v=_.rect.clone();gr.any(s,function(t){return v.x=_.rect.x+Math.round(_.position.x-t.position.x),v.y=_.rect.y+Math.round(_.position.y-t.position.y),t.rect.intersects(v)})?_.destroy():s.push(_)}for(var b=s.length;0<=--b;){var w=s[b];w.update(t),w.position.x>p&&(w.destroy(),s.splice(b,1))}},__class__:Lr};var Ur=function(t,e,i){null==i&&(i=!1),PIXI.Container.call(this),"vi"!=O.language||i||(e.font=Y.string(e.font)+"_vi"),e.fontName=e.font,e.font=null,this.internalText=new PIXI.BitmapText(t,e),this.addChild(this.internalText),"vi"!=O.language||i||(this.internalText.position.y=1)};(q["graphics.BitmapText"]=Ur).__name__="graphics.BitmapText",Ur.__super__=PIXI.Container,Ur.prototype=e(PIXI.Container.prototype,{set_maxWidth:function(t){return this.internalText.maxWidth=t},get_text:function(){return this.internalText.text},set_text:function(t){return this.internalText.text=t},get_textWidth:function(){return this.internalText.textWidth},get_textHeight:function(){return this.internalText.textHeight},set_tint:function(t){return this.internalText.tint=t},get_anchor:function(){return this.internalText.anchor},set_align:function(t){return this.internalText.align=t},get_fontName:function(){return this.internalText.fontName},destroy:function(t){null==t&&(t={children:!0}),PIXI.Container.prototype.destroy.call(this,t)},__class__:Ur});var zr=function(t){this.previousCullRectangle=null,this.isInvalid=!0,PIXI.Container.call(this),this.cacheWithinRect=t,this.cacheableChildren=[],this.cacheContainer=new PIXI.Container,this.explicitUncachedContainer=new PIXI.Container,this.addChild(this.cacheContainer),this.addChild(this.explicitUncachedContainer)};(q["graphics.CachingContainer"]=zr).__name__="graphics.CachingContainer",zr.__super__=PIXI.Container,zr.prototype=e(PIXI.Container.prototype,{preDraw:function(t){if(this.isInvalid){if(A.isCanvasRenderer&&!A.isMobile||this.cacheableChildren.length<512&&(!A.isMobile||0==this.cacheableChildren.length)){this.cacheContainer.cacheAsBitmap=!1;for(var e=0,i=this.cacheableChildren;e<i.length;){var n=i[e];++e,n.parent!=this.explicitUncachedContainer&&(null!=n.parent&&n.parent.removeChild(this.parent),this.explicitUncachedContainer.addChild(n),n.visible=!0)}}else{for(e=0,i=this.cacheableChildren;e<i.length;){var r;n=i[e];++e;var s=n;r=null!=s.width?new yr(Math.floor(n.x),Math.floor(n.y),Math.ceil(s.width+1),Math.ceil(s.height+1)):yr.fromPixiRect(n.getLocalBounds()),this.cacheWithinRect.fullyContains(r)?n.parent!=this.cacheContainer&&(null!=n.parent&&n.parent.removeChild(this.parent),this.cacheContainer.addChild(n),n.visible=!0):n.parent!=this.explicitUncachedContainer&&(null!=n.parent&&n.parent.removeChild(this.parent),this.explicitUncachedContainer.addChild(n))}this.cacheContainer.cacheAsBitmap=!1,this.cacheContainer.cacheAsBitmap=!0}this.isInvalid=!1,this.cull(t),this.previousCullRectangle=t.clone()}else null!=this.previousCullRectangle&&this.previousCullRectangle.x==t.x&&this.previousCullRectangle.y==t.y&&this.previousCullRectangle.width==t.width&&this.previousCullRectangle.height==t.height||(this.cull(t),this.previousCullRectangle=t.clone())},uncull:function(){for(var t=0,e=this.explicitUncachedContainer.children;t<e.length;){var i=e[t];++t,i.visible=!0}for(t=2,e=this.children.length;t<e;){var n=t++;this.children[n].visible=!0}this.previousCullRectangle=null},cull:function(t){for(var e=t.get_x2(),i=t.get_y2(),n=0,r=this.explicitUncachedContainer.children;n<r.length;){var s=r[n];++n,null!=(o=s).width&&null!=o.anchor&&null!=o.scale?s.visible=s.x+o.width-o.anchor.x*o.scale.x*o.width>=t.x&&s.y+o.height-o.anchor.y*o.scale.y*o.height>=t.y&&s.x-o.anchor.x*o.width<e&&s.y-o.anchor.y*o.height<i:null!=o.width&&(s.visible=s.x+o.width>=t.x&&s.y+o.height>=t.y&&s.x<e&&s.y<i)}for(n=2,r=this.children.length;n<r;){var o,a=n++;null!=(o=s=this.children[a]).width&&null!=o.anchor&&null!=o.scale?s.visible=s.x+o.width-o.anchor.x*o.scale.x*o.width>=t.x&&s.y+o.height-o.anchor.y*o.scale.y*o.height>=t.y&&s.x-o.anchor.x*o.width<e&&s.y-o.anchor.y*o.height<i:null!=o.width&&(s.visible=s.x+o.width>=t.x&&s.y+o.height>=t.y&&s.x<e&&s.y<i)}},removeCache:function(){this.cacheContainer.cacheAsBitmap=!1},__class__:zr});var Wr=function(t,e,i,n){if(this.stage=e,this.bgImages=t,this.textures=dt.getTextures("spr_clouds",16,!1,2),this.position=i,this.cloudStage=new PIXI.Container,this.parallaxLayer=n,this.rect=new yr(0,0,0,0),this.alph=.1+.15*n+il.getFloat(.1),e.addChild(this.cloudStage),this.cloudStage.position.set(i.x,i.y),!Wr.initedTexturesSuperMeta){Wr.initedTexturesSuperMeta=!0,Wr.topLeftCornerTextures=[],Wr.topRightCornerTextures=[],Wr.bottomLeftCornerTextures=[],Wr.bottomRightCornerTextures=[],Wr.topLeftSecondCornerTextures=[],Wr.bottomLeftSecondCornerTextures=[],Wr.topLeftSimpleCornerTextures=[],Wr.bottomLeftSimpleCornerTextures=[],Wr.topLeftSecondCornerTexturesNoUp=[],Wr.topRightCornerTexturesNoUp=[],Wr.leftTextures=[],Wr.rightTextures=[],Wr.topTextures=[],Wr.leftRightTextures=[],Wr.leftRightTexturesNoTop=[];for(var r=0,s=Wr.texturesMeta.length;r<s;){var o=r++,a=Wr.texturesMeta[o];7!=a&&9!=a&&10!=a||Wr.topLeftCornerTextures.push(o),9!=a&&10!=a||Wr.topLeftSecondCornerTextures.push(o),10==a&&Wr.topLeftSecondCornerTexturesNoUp.push(o),5!=a&&12!=a&&13!=a||Wr.topRightCornerTextures.push(o),5!=a&&13!=a||Wr.topRightCornerTexturesNoUp.push(o),8!=a&&11!=a||Wr.bottomLeftCornerTextures.push(o),11==a&&Wr.bottomLeftSecondCornerTextures.push(o),6!=a&&14!=a||Wr.bottomRightCornerTextures.push(o),7==a&&Wr.topLeftSimpleCornerTextures.push(o),8==a&&Wr.bottomLeftSimpleCornerTextures.push(o),1==a&&Wr.leftTextures.push(o),3==a&&Wr.rightTextures.push(o),0==a&&Wr.topTextures.push(o),2!=a&&4!=a||Wr.leftRightTextures.push(o),4==a&&Wr.leftRightTexturesNoTop.push(o)}}this.makeANiceCloudForMe()};(q["graphics.Cloud"]=Wr).__name__="graphics.Cloud",Wr.prototype={makeANiceCloudForMe:function(){var t=4-this.parallaxLayer,e=[],i=[],n=-1;if(3==t&&il.getFloat()<.8)this.addSpriteAt(new vr(0,0),il.fromArray(Wr.leftTextures)),i.push(new vr(1,0));else{var r=il.fromArray(Wr.topLeftCornerTextures),s=il.fromArray(Wr.topRightCornerTextures),o=il.fromArray(Wr.bottomLeftCornerTextures),a=il.fromArray(Wr.bottomRightCornerTextures);if(this.addSpriteAt(new vr(0,0),r),this.addSpriteAt(new vr(1,0),s),this.addSpriteAt(new vr(0,1),o),this.addSpriteAt(new vr(1,1),a),9!=Wr.texturesMeta[r]&&10!=Wr.texturesMeta[r]||e.push(new vr(-1,0)),11==Wr.texturesMeta[o]&&e.push(new vr(-1,1)),il.getFloat()<(2==t?.1:.8)&&t<3){var l=il.getInt(4);l<2&&(12==Wr.texturesMeta[s]||13==Wr.texturesMeta[s])&&14==Wr.texturesMeta[a]&&(n=0),2!=l||12!=Wr.texturesMeta[s]&&13!=Wr.texturesMeta[s]||(n=1),3==l&&14==Wr.texturesMeta[a]&&(n=2)}if(-1!=n&&2!=n||12!=Wr.texturesMeta[s]&&13!=Wr.texturesMeta[s]||i.push(new vr(2,0)),-1!=n&&1!=n||14!=Wr.texturesMeta[a]||i.push(new vr(2,1)),9==Wr.texturesMeta[r]&&this.addSpriteAt(new vr(0,-1),il.fromArray(Wr.topTextures)),12==Wr.texturesMeta[s]&&this.addSpriteAt(new vr(1,-1),il.fromArray(Wr.topTextures)),-1!=n){var h;switch(n){case 0:h=0;break;case 1:h=-1;break;case 2:h=1;break;default:h=0}r=il.fromArray(1==n?Wr.topLeftSimpleCornerTextures:2==n?Wr.topLeftSecondCornerTexturesNoUp:Wr.topLeftSecondCornerTextures),s=il.fromArray(2==n?Wr.topRightCornerTexturesNoUp:Wr.topRightCornerTextures),o=il.fromArray(2==n?Wr.bottomLeftCornerTextures:Wr.bottomLeftSecondCornerTextures),a=il.fromArray(Wr.bottomRightCornerTextures);this.addSpriteAt(new vr(2,h),r),this.addSpriteAt(new vr(3,h),s),this.addSpriteAt(new vr(2,h+1),o),this.addSpriteAt(new vr(3,h+1),a),2==n&&11==Wr.texturesMeta[o]&&e.push(new vr(1,h+1)),12!=Wr.texturesMeta[s]&&13!=Wr.texturesMeta[s]||i.push(new vr(4,h)),14==Wr.texturesMeta[a]&&i.push(new vr(4,h+1)),9==Wr.texturesMeta[r]&&this.addSpriteAt(new vr(2,h-1),il.fromArray(Wr.topTextures)),12==Wr.texturesMeta[s]&&this.addSpriteAt(new vr(3,h-1),il.fromArray(Wr.topTextures))}}for(;0<e.length;){if(-1<(c=e.pop()).x&&il.getFloat()<.6-.1*t){d=c.y<=0?il.fromArray(Wr.leftRightTextures):il.fromArray(Wr.leftRightTexturesNoTop),this.addSpriteAt(c,d),2==Wr.texturesMeta[d]&&this.addSpriteAt(new vr(c.x,c.y-1),il.fromArray(Wr.topTextures)),e.push(new vr(c.x-1,c.y))}else{var u=il.fromArray(Wr.leftTextures);this.addSpriteAt(c,u)}}for(;0<i.length;){var c;if((c=i.pop()).x<3&&il.getFloat()<.6-.1*t){var d;d=c.y<=0&&(1!=n||c.y<=-1)?il.fromArray(Wr.leftRightTextures):il.fromArray(Wr.leftRightTexturesNoTop),this.addSpriteAt(c,d),2==Wr.texturesMeta[d]&&this.addSpriteAt(new vr(c.x,c.y-1),il.fromArray(Wr.topTextures)),i.push(new vr(c.x+1,c.y))}else{u=il.fromArray(Wr.rightTextures);this.addSpriteAt(c,u)}}},addSpriteAt:function(t,e){var i=new PIXI.Sprite(this.textures[e]);i.position.set(60*t.x,60*t.y),this.cloudStage.addChild(i),i.alpha=this.alph;var n=this.rect.get_x2(),r=this.rect.get_y2(),s=this.rect.x,o=60*t.x;this.rect.x=o<s?o:s;s=this.rect.y,o=60*t.y;this.rect.y=o<s?o:s;o=60*t.x+60;this.rect.width=(n<o?o:n)-this.rect.x;o=60*t.y+60;this.rect.height=(r<o?o:r)-this.rect.y},update:function(t){this.position.x+=this.bgImages.cloudSpeedCurMult*(this.bgImages.cloudSpeedBase*t+this.bgImages.cloudSpeedParallaxMult*t*this.parallaxLayer),this.cloudStage.position.set(this.position.x,this.position.y)},destroy:function(){this.cloudStage.destroy({children:!0})},__class__:Wr};var Gr=function(){PIXI.Container.call(this)};(q["graphics.CullableContainer"]=Gr).__name__="graphics.CullableContainer",Gr.__super__=PIXI.Container,Gr.prototype=e(PIXI.Container.prototype,{preDraw:function(t){this.cull(t)},uncull:function(){for(var t=0,e=this.children;t<e.length;){var i=e[t];++t,i.visible=!0}},cull:function(t){for(var e=t.get_x2(),i=t.get_y2(),n=0,r=this.children;n<r.length;){var s=r[n];++n;var o=s;null!=o.width&&(s.visible=s.x+o.width>=t.x&&s.y+o.height>=t.y&&s.x<e&&s.y<i)}},__class__:Gr});var Hr=function(t,e,i,n){this.stage=t,this.position=e,this.textureName=i,this.textures=dt.getTexturesByWidth(i,20),null==n&&(n=il.getInt(this.textures.length)),this.sprite=new PIXI.Sprite(this.textures[n]),this.subImage=n,this.sprite.position.set(e.x,e.y),t.addChild(this.sprite)};(q["graphics.GroundDecoration"]=Hr).__name__="graphics.GroundDecoration",Hr.prototype={destroy:function(){this.sprite.destroy()},__class__:Hr};function Xr(){}(q["graphics.Particle"]=Xr).__name__="graphics.Particle",Xr.create=function(t,e,i){var n=0==Xr.pool.length?new Xr:Xr.pool.pop();return n.___internal_pooling_initObject(t,e,i),n},Xr.prototype={___internal_pooling_initObject:function(t,e,i){this.stage=t,this.textures=e,this.frame=0,this.animSpeed=.5,this.sprite=Fa.create(e[0],t),this.sprite.position.set(i.x,i.y)},update:function(t){if(this.frame+=this.animSpeed*t,this.frame>=this.textures.length){var e=this.sprite,i=this.stage;return e.visible=!1,e.position.set(-1e5,-1e5),Fa.pool.h[i.__id__].push(e),this.destroy(),!0}return this.sprite.texture=this.textures[0|this.frame],!1},destroy:function(){Xr.pool.push(this)},__class__:Xr};var jr=function(){};(q["graphics.ParticleContainerHelper"]=jr).__name__="graphics.ParticleContainerHelper",jr.recreateContainer=function(t){var e=t.parent,i=t.parent.children.indexOf(t);t.parent.removeChild(t),e.addChildAt(t,i)};var Vr=function(t,e){this.stage=t,this.particles=[],this.city=e};(q["graphics.Particles"]=Vr).__name__="graphics.Particles",Vr.prototype={update:function(t){for(var e=this.particles.length;0<=--e;)this.particles[e].update(t)&&(this.particles[e]=this.particles[this.particles.length-1],this.particles.pop())},addParticle:function(t,e,i){if(null==i&&(i=!0),i){var n=this.city.viewPos.x-.5*this.city.get_displayWidth()-20,r=this.city.viewPos.y-.5*this.city.get_displayHeight()-20,s=n+this.city.get_displayWidth()+40,o=r+this.city.get_displayHeight()+40;if(!(e.x>n&&e.y>r&&e.x<s&&e.y<o))return null}var a=Xr.create(this.stage,t,e);return this.particles.push(a),a},__class__:Vr};var Yr=function(t,e){this.maxStarY=800,this.maxStarX=800,this.stage=t,this.city=e,this.sprites=[],this.cloudsAlpha=0,this.resize()};(q["graphics.Stars"]=Yr).__name__="graphics.Stars",Yr.prototype={get_requiredNumberOfStars:function(){return this.maxStarX*this.maxStarY/1e3|0},resize:function(){var t=1,e=1;if(this.city.get_displayWidth()>this.maxStarX&&(t=this.city.get_displayWidth()/this.maxStarX,this.maxStarX=this.city.get_displayWidth()),this.city.get_displayHeight()>this.maxStarY&&(e=this.city.get_displayHeight()/this.maxStarY,this.maxStarY=this.city.get_displayHeight()),1!=t||1!=e)for(var i=0,n=this.sprites;i<n.length;){var r=n[i];++i,r.position.x*=t,r.position.y*=e}for(i=this.sprites.length,n=this.get_requiredNumberOfStars();i<n;){i++,il.getInt(this.maxStarX),il.getInt(this.maxStarY),r=dt.makeSprite("spr_pixel");var s=[il.getFloat(360),il.getFloat(0,1),il.getFloat(.9,1)];r.tint=gh.toInt(ah.toRgb(s)),r.position.set(il.getInt(this.maxStarX),il.getInt(this.maxStarY)),r.alpha=il.getFloat(.2,.6),this.sprites.push(r),this.stage.addChild(r)}},update:function(){var t=this.city.simulation.time.timeSinceStart/60%24;this.stage.alpha=23<=t||t<4?1:4<=t&&t<6?1-(t-4)/2:21<=t&&t<23?1-(23-t)/2:0,this.cloudsAlpha=21<=t||t<4?1:4<=t&&t<6?1-(t-4)/2:19.5<=t&&t<21.5?1-(23-t-1.5)/2:0;var e=1.3*(.7692307692307692-this.cloudsAlpha);this.cloudsAlpha=e<0?0:1<e?1:e,this.stage.visible=0!=this.stage.alpha},__class__:Yr};var qr=function(){};(q["graphics.WorldImage"]=qr).__name__="graphics.WorldImage",qr.makeWorldSprite=function(t,n,e,i){var r=2103312,s=5259312,o=e-((k=e-10)<0?0:12<k?12:k),a=Math.floor(o-o/4),l=Math.floor(o-o/3),h=Math.floor(o-o/2);"key"!=i&&"key2"!=i||(s=5195330,r=1973275),"rock"==i&&(s=5197647,r=1973790),"rock:lessJagged"==i&&(s=5197647,r=1973790,a=Math.floor(o-o/8),l=Math.floor(o-o/6),h=Math.floor(o-o/4));var u=window.document.createElement("canvas");u.width=n,u.height=e;for(var c=u.getContext("2d"),d=c.createImageData(n,e),p=[],f=0,g=n/20|0;f<g;){for(var m=f++,y=[],_=0,v=e/20|0;_<v;){var b=_++;y.push(!1)}p.push(y)}var w=p,S=[{x:0,y:0}],x=0|Math.min(o/4+t.getInt(-5,6),n/3),T=0|Math.max(1,Math.floor((n-2*x)/(t.getInt(25,35)+n/40))),I=Math.floor((n-2*x)/T),P=x+((n-2*x-I*(T-.5))/2|0);for(p=0,f=T;p<f;){var C=p++;S.push({x:P+t.getInt(-6,7),y:t.getInt(a,o)}),C!=T-1&&S.push({x:P+(I/2|0)+t.getInt(-6,7),y:t.getInt(h,l)}),P+=I}S.push({x:n-1,y:0});function E(t,e){var i=4*(n*e+t);d.data[i]=s>>16&255,d.data[1+i]=s>>8&255,d.data[2+i]=255&s,d.data[3+i]=255,w[t/20|0][e/20|0]=!0}var A=1.6,M=1.2,B=8;"key"==i&&(A=1,M=.8,B=3);var R=0,O=0;for(p=0,f=n;p<f;){C=p++;var k,D=B/(Math.abs(S[R+1].y-S[R].y)+5);if(O=(k=O+t.getFloat(-D,D))<-.2?-.2:.2<k?.2:k,C>S[R+1].x){if(S[R+1].y>S[R].y){var F=t.getInt(1,3),N=t.getInt(5,8);for(g=0,y=F;g<y;){var L=g++,U=t.getInt(-2,3)+C-(F-1)*N+(2*N*L|0),z=S[R+1].y+t.getInt(3),W=U-1,G=U;for(_=z+2,v=z+11;_<v;){if((b=_++)<=z+5)W-=t.getInt(b<z+5?3:2),G+=t.getInt(b<z+5?3:2);else{var H=W+t.getInt(z+6<b?3:2);W=G<H?G:H;var X=G-t.getInt(z+6<b?3:2);G=X<W?W:X}b==z+2&&G-W==1&&++G,b==z+3&&G-W==2&&--W;for(var j=W,V=G;j<V;){0<=(m=j++)&&m<n&&b+2<e&&E(m,b)}}}}++R}var Y=S[R],q=S[R+1],K=(C-Y.x)/(q.x-Y.x);K=q.y<Y.y?Math.pow(K,A-K*M+O):1-Math.pow(1-K,A-(1-K)*M-O);for(var $=Math.floor(K*(q.y-Y.y)+Y.y),Q=o-1,J=0,Z=(Q<$?Q:$)+1;J<Z;){E(C,J++)}}for(p=0,f=d.data.length/4|0;p<f;){m=(C=p++)%n,b=Math.floor(C/n);255!=d.data[4*C+3]||0!=m&&0!=b&&m!=n-1&&b!=e-1&&0!=d.data[4*C-1]&&0!=d.data[4*C+7]&&0!=d.data[4*((b-1)*n+m)+3]&&0!=d.data[4*((b+1)*n+m)+3]||(d.data[4*C]=r>>16&255,d.data[4*C+1]=r>>8&255,d.data[4*C+2]=255&r)}return c.putImageData(d,0,0),{sprite:new PIXI.Sprite(PIXI.Texture.from(u)),mask:w}};function Kr(){}(q["gui.ActivableButton"]=Kr).__name__="gui.ActivableButton",Kr.create=function(t,e,i,n,r,s){var o=new us(t,e,i,n,r,null,"spr_button_activable"),a=t.game.isMobile?3:0;return o.container.padding.top=3+a,o.container.padding.left=3,o.container.padding.right=3,o.container.padding.bottom=a,null!=s&&o.container.addChild(new ao(o.container,t.innerWindowStage,s)),o.container.fillSecondarySize=!0,o};function $r(){}(q["gui.AdRewardWindow"]=$r).__name__="gui.AdRewardWindow",$r.create=function(t,e,i,n,r,s){t.gui.windowAddTitleText(B.hasRemoveAds()?Tr.lo("boost_activated"):Tr.lo("thank_you_ex")),n.addChild(new ao(n,i,Tr.lo("boost_activated_description"),null,"Arial")),n.addChild(new Ms(n,new vr(2,6))),"en"==O.language&&n.addChild(new ao(n,i,r.text,null,"Arial15"));var o=new Xs(r.materials),a=new ds(t.gui.windowInner,t.gui.innerWindowStage,o);n.addChild(a),""!=s&&(n.addChild(new Ms(n,new vr(2,6))),e.windowAddInfoText(s)),e.windowAddBottomButtons()};function Qr(){}(q["gui.IGUIElement"]=Qr).__name__="gui.IGUIElement",Qr.__isInterface__=!0,Qr.prototype={__class__:Qr};function Jr(t,e,i,n,r,s,o){this.destroyed=!1,this.maskRect=null,this.game=t,this.outerStage=e,this.parent=i,this.stage=new PIXI.Container,e.addChild(this.stage),this.scrollPosition=new vr(0,0),this.rect=new yr(0,0,r,s),this.origin=o,this.updatePosition(n),this.updateSize(),this.dragDir=new br(0,0),this.dragDirRemaining=new br(0,0),this.remainingStepDragDir=new br(0,0)}(q["gui.Scrollable"]=Jr).__name__="gui.Scrollable",Jr.__interfaces__=[Qr],Jr.prototype={get_innerHeight:function(){return this.child.rect.height},setChild:function(t){this.child=t,this.updateSize()},updateSize:function(){if(null!=this.child){var t=this.scrollPosition.y,e=this.get_innerHeight()-this.rect.height,i=0<e?e:0;this.scrollPosition.y=t<0?0:i<t?i:t}null!=this.parent?this.parent.updateSize():this.updatePosition(this.position)},updateScrollPosition:function(t){this.scrollPosition=t,this.updateSize()},updateStageMask:function(){if(null==this.child||this.child.rect.width<=this.rect.width&&this.get_innerHeight()<=this.rect.height)return null!=this.stage.mask&&this.stage.mask.destroy(),this.stage.mask=null,void(this.maskRect=null);if((null==this.maskRect||this.maskRect.x!=this.rect.x||this.maskRect.y!=this.rect.y||this.maskRect.width!=this.rect.width||this.maskRect.height!=this.rect.height)&&(this.maskRect=this.rect.clone(),null!=this.stage.mask&&this.stage.mask.destroy(),this.stage.mask=null,!O.compatDisableMasking)){var t=new PIXI.Graphics;t.beginFill(16777215),this.stage.addChild(t),t.drawRect(this.rect.x,this.rect.y-1,this.rect.width,this.rect.height+1),t.endFill(),this.stage.mask=t}},updatePosition:function(t){this.position=t;var e=this.rect,i=this.position,n=this.origin.x*this.rect.width|0,r=this.origin.y*this.rect.height|0,s=i.x-n,o=i.y-r;e.x=s,e.y=o;if(null!=this.child){var a=(e=this.rect).x,l=e.y,h=this.scrollPosition;this.child.updatePosition(new vr(a-h.x,l-h.y))}this.updateStageMask()},destroy:function(){null!=this.child&&this.child.destroy(),this.stage.destroy(!0),this.destroyed=!0},claimMouseForScroll:function(e,t){null==t&&(t=!0);var i=this;return!!e.hasNoClaim()&&(this.mousePreviousY=e.position.y,e.strongClaimMouse("scrollWindow",function(){if(!i.destroyed){var t=i.mousePreviousY-e.position.y;i.updateScrollPosition(new vr(i.scrollPosition.x,i.scrollPosition.y+t)),i.mousePreviousY=e.position.y}},t),!0)},handleMouse:function(t){return!!this.rect.contains(t.position)&&(this.handleScrollWheel(t),t.isTouch&&t.weakClaimForScroll(this)&&this.claimMouseForScroll(t,!1)||null!=this.child&&this.child.handleMouse(t)||t.isTouch&&this.claimMouseForScroll(t)||t.claimMouse(this),!0)},handleScrollWheel:function(t){var e=this.rect.height-10;if(0!=t.scrollBarMovement){var i=Math.round(t.scrollBarMovement),n=-e;this.updateScrollPosition(new vr(this.scrollPosition.x,this.scrollPosition.y+(i<n?n:e<i?e:i)))}if(0!=t.scrollBarMovementPages){i=Math.round(this.rect.height*t.scrollBarMovementPages),n=-e;this.updateScrollPosition(new vr(this.scrollPosition.x,this.scrollPosition.y+(i<n?n:e<i?e:i)))}},update:function(){if(null!=this.child&&this.child.update(),this.game.mouse.pressed||this.dragDir.get_length()<.5)this.dragDir.x=0,this.dragDir.y=0,this.remainingStepDragDir.x=0,this.remainingStepDragDir.y=0;else if(!this.game.mouse.hasSpecificClaim("scrollWindow")){var t=this.game.mouse.isTouch?.933:.8;this.dragDir.x*=t,this.dragDir.y*=t;var e=this.dragDir.x+this.dragDirRemaining.x,i=this.dragDir.y+this.dragDirRemaining.y;this.dragDirRemaining.x+=this.dragDir.x-e,this.dragDirRemaining.y+=this.dragDir.y-i,this.remainingStepDragDir.x+=e,this.remainingStepDragDir.y+=i;var n=Math.floor(this.remainingStepDragDir.y);this.updateScrollPosition(new vr(this.scrollPosition.x,this.scrollPosition.y+n)),this.remainingStepDragDir.y-=n}},__class__:Jr};function Zr(t,e,i,n,r,s,o){this.maxWidth=r,this.maxHeight=s,Jr.call(this,t,e,i,n,r,s,o)}(q["gui.AutoScrollable"]=Zr).__name__="gui.AutoScrollable",Zr.__super__=Jr,Zr.prototype=e(Jr.prototype,{updateSize:function(){if(null!=this.child){var t=this.maxWidth,e=this.child.rect.width;this.rect.width=e<t?e:t;t=this.maxHeight,e=this.child.rect.height;this.rect.height=e<t?e:t}Jr.prototype.updateSize.call(this)},updatePosition:function(t){Jr.prototype.updatePosition.call(this,t)},__class__:Zr});var ts=function(){};(q["gui.BirthControlWindow"]=ts).__name__="gui.BirthControlWindow",ts.create=function(t,e,i,n){e.windowAddTitleText(Tr.lo("birth_control"));var r=t.simulation.babyMaker.mode;po.createActivatableButton(e,1==r,function(){t.simulation.babyMaker.mode=1,t.simulation.babyMaker.targetPopAmount=t.simulation.citizens.length,e.reloadWindow()},Tr.lo("greatly_discourage_children"),Tr.lo("pop_stabilize")),po.createActivatableButton(e,2==r,function(){t.simulation.babyMaker.mode=2,e.reloadWindow()},Tr.lo("encourage_contraception"),Tr.lo("slow_pop_growth")),po.createActivatableButton(e,0==r,function(){t.simulation.babyMaker.mode=0,e.reloadWindow()},Tr.lo("no_special_policy"),Tr.lo("babies_born_normal")),po.createActivatableButton(e,3==r,function(){t.simulation.babyMaker.mode=3,e.reloadWindow()},Tr.lo("encourage_parenthood"),Tr.lo("more_babies_born")),e.windowAddBottomButtons()};function es(t,e){this.mirrored=!1,this.wasLargeMobile=!1,this.previouslyShownCategory="",this.inviteCitizensButton=null,this.mobileStopBuildingOrManagingButton=null,this.activateBuildModeButton=null,this.activateManagementModeButton=null,this.buildingModeEnabled=!1,this.shownManagementOptions=!1,this.shownBuildingModes=!1,this.shownSubCategory=null,this.creatableCityElementsThatNeededAttention=[],this.categoryButtonPosition=new Vo,this.gui=t,this.city=e,this.createBuildingButtons(),this.shownCategory="",this.buttonsByCategory=new Vo,this.buttonsInCategory=new Vo,this.wasLargeMobile=this.gui.game.isLargeMobile}(q["gui.BuildingButtons"]=es).__name__="gui.BuildingButtons",es.prototype={resize:function(){this.buildingButtons.updatePosition(new vr(this.gui.safeAreaLeft,this.gui.game.rect.height-this.gui.safeAreaBottom)),this.allBuildingModeButtons.updatePosition(new vr(this.gui.safeAreaLeft,this.gui.game.rect.height-this.gui.safeAreaBottom-20-2)),this.allManagementOptionsButtons.updatePosition(new vr(this.gui.safeAreaLeft,this.gui.game.rect.height-this.gui.safeAreaBottom-20-2)),this.gui.game.isMobile&&this.gui.game.isLargeMobile!=this.wasLargeMobile&&(this.wasLargeMobile?this.buildingModeEnabled=null!=this.city.builder||""!=this.shownCategory||this.shownBuildingModes:(this.buildingModeEnabled&&(this.mobileStopBuildingOrManagingButton=null,this.gui.createCityInfo()),this.buildingModeEnabled=!1),this.refreshCategoryBuildingsShown(),this.wasLargeMobile=this.gui.game.isLargeMobile)},update:function(t){this.allBuildingModeButtons.update(),this.buildingButtons.update(),this.allManagementOptionsButtons.update(),this.updateGoalAttentions()},handleMouse:function(t){return!!this.allBuildingModeButtons.handleMouse(t)||(!!this.buildingButtons.handleMouse(t)||!!this.allManagementOptionsButtons.handleMouse(t))},activateLoserState:function(){this.buildingButtons.clear(),this.allBuildingModeButtons.clear(),this.allManagementOptionsButtons.clear()},createBuildingButtons:function(){this.buildingButtons=new ps(this.gui,this.gui.stage,null,new vr(this.gui.safeAreaLeft,this.gui.game.rect.height-this.gui.safeAreaBottom),new br(0,1)),this.categoryButtons=new ps(this.gui,this.gui.stage,this.buildingButtons),this.allBuildingModeButtons=new ps(this.gui,this.gui.stage,null,new vr(this.gui.safeAreaLeft,this.gui.game.rect.height-20-2-this.gui.safeAreaBottom),new br(0,1)),this.allManagementOptionsButtons=new ps(this.gui,this.gui.stage,null,new vr(this.gui.safeAreaLeft,this.gui.game.rect.height-20-2-this.gui.safeAreaBottom),new br(0,1)),this.buildingInCategoryButtons=new ps(this.gui,this.gui.stage,this.buildingButtons),this.buildingButtons.direction=Ps.Vertical,this.buildingInCategoryButtons.direction=this.gui.game.isMobile?Ps.Vertical:Ps.Horizontal,this.buildingInCategoryButtonsCol=null,this.buildingInCategoryButtonsColAmount=0,this.allBuildingModeButtons.direction=this.gui.game.isMobile?Ps.Horizontal:Ps.Vertical,this.allManagementOptionsButtons.direction=this.gui.game.isMobile?Ps.Horizontal:Ps.Vertical,this.buildingButtons.addChild(this.buildingInCategoryButtons),this.buildingButtons.addChild(this.categoryButtons),this.gui.game.isMobile&&!this.gui.game.isLargeMobile?this.createMobileBuildButton():this.createBuildingCategoryButtons()},showTutorialArrows1:function(t,e,i){var n=this,r=new Ds(this.gui,i,function(){return n.categoryButtons.children[n.buildingModeEnabled&&!n.gui.game.isLargeMobile?1:0]},function(){return!(!e()||null!=n.city.builder)&&""==n.shownCategory});this.gui.game.isMobile||r.useBigMovement(),t.push(r);var s=new Ds(this.gui,i,function(){var t=n.buildingInCategoryButtons.children[0];return t.children[t.children.length-1]},function(){return!(!e()||null!=n.city.builder)&&""!=n.shownCategory},ks.Left);t.push(s)},showTutorialArrows101:function(t,e,i){var n=this,r=new Ds(this.gui,i,function(){return n.categoryButtons.children[n.buildingModeEnabled&&!n.gui.game.isLargeMobile?1:0]},function(){return!(!e()||null!=n.city.builder)&&""==n.shownCategory});t.push(r);var s=new Ds(this.gui,i,function(){var t=n.buildingInCategoryButtons.children[0];return t.children[t.direction==Ps.Horizontal?t.children.length-1:t.children.length-2]},function(){return!(!e()||null!=n.city.builder)&&""!=n.shownCategory},ks.Left);t.push(s);var o=Tr.lo("you_have_enough_wood");r.addText(o),s.addText(o)},showTutorialArrows2:function(t,e,i,n){var r=this;t.push(new Ds(this.gui,i,function(){return r.mobileStopBuildingOrManagingButton},function(){return!(!n()||null!=go.tutorialStoneMineUpButton)&&!e()},ks.Down))},showTutorialArrowsInviteCitizens:function(t,e){var i=this;t.push(new Ds(this.gui,e,function(){return i.inviteCitizensButton},function(){return"invite_people"!=i.gui.windowRelatedTo},ks.Left)),t.push(new Ds(this.gui,e,function(){return i.activateManagementModeButton},function(){return null==i.inviteCitizensButton&&"invite_people"!=i.gui.windowRelatedTo},ks.Down))},createMobileBuildButton:function(){function t(t){null==t&&(t=!1),r.buildingModeEnabled=!0,r.activateBuildModeButton=null,r.activateManagementModeButton=null,t||"travel_time"==r.gui.windowRelatedTo||r.gui.closeWindow(),r.gui.hideCityInfo(),r.categoryButtons.clear(),e(),r.createBuildingCategoryButtons(),""!=r.previouslyShownCategory&&(r.showOrHideBuildingsOfCategory(r.previouslyShownCategory,null,r.categoryButtonPosition.h[r.previouslyShownCategory],!1,!0,!0),r.previouslyShownCategory="")}var r=this,e=null;if(e=function(){var t=r.gui,e=r.gui.stage,i=r.categoryButtons,n=dt.getTexture("spr_arrow_back");r.mobileStopBuildingOrManagingButton=new Us(t,e,i,function(){r.mobileStopBuildingOrManaging()},n,function(){return!1},function(){r.gui.tooltip.setText(r.mobileStopBuildingOrManagingButton,Tr.lo("back"))}),r.categoryButtons.addChild(r.mobileStopBuildingOrManagingButton)},this.buildingModeEnabled)return t(!0),void(this.shownManagementOptions=!1);function i(t){null==t&&(t=!1),r.shownManagementOptions=!0,r.activateBuildModeButton=null,r.activateManagementModeButton=null,t||r.gui.closeWindow(),r.gui.hideCityInfo(),r.categoryButtons.clear(),e(),r.showManagementOptions(r.categoryButtons)}var n,s;if(this.shownManagementOptions)return i(!0),void(this.buildingModeEnabled=!1);n=new Us(r.gui,r.gui.stage,r.categoryButtons,function(){t()},dt.getTexture("spr_icon_build"),function(){return!1},function(){r.gui.tooltip.setText(n,Tr.lo("build"))}),r.categoryButtons.addChild(n),r.activateBuildModeButton=n,this.city.progress.unlocks.unlockedManagementOptions&&(s=new Us(r.gui,r.gui.stage,r.categoryButtons,function(){i()},dt.getTexture("spr_icon_management"),function(){return!1},function(){r.gui.tooltip.setText(s,Tr.lo("management"))}),r.categoryButtons.addChild(s),r.activateManagementModeButton=s)},mobileStopBuildingOrManaging:function(){(this.buildingModeEnabled||this.shownManagementOptions)&&(this.mobileStopBuildingOrManagingButton=null,this.inviteCitizensButton=null,this.buildingModeEnabled=!1,this.shownManagementOptions=!1,this.gui.createCityInfo(),this.categoryButtons.clear(),""!=this.shownCategory&&(this.previouslyShownCategory=this.shownCategory,this.showOrHideBuildingsOfCategory(this.shownCategory,this.shownSubCategory,this.categoryButtonPosition.h[this.shownCategory],!1,!0,!0)),this.closeExtraBuildingModes(),this.createMobileBuildButton())},createBuildingCategoryButtons:function(){var n=this,t=0;this.buttonsByCategory=new Vo,this.buttonsInCategory=new Vo;for(var e=0,i=dt.buildingCategoriesInfo;e<i.length;){var r=[i[e]];++e;for(var s=!1,o=0,a=this.city.progress.resources.buildingInfoArray;o<a.length;){var l=a[o];++o;var h="buildings."+l.className,u=q[h],c=this.city.progress.unlocks.getUnlockState(u);l.category!=r[0].name||c!=$a.Unlocked&&c!=$a.Researched&&c!=$a.Createable||(s=!0)}for(var d=0,p=dt.decorationsInfo;d<p.length;){var f=p[d];++d,f.category==r[0].name&&this.city.progress.unlocks.unlockedDecorationTab&&(s=!0)}for(var g=0,m=dt.worldResourcesInfo;g<m.length;){var y=m[g];++g,y.category==r[0].name&&this.city.progress.unlocks.unlockedDecorationTab&&(s=!0)}if(s){var _=[null],v=[t];_[0]=new Us(this.gui,this.gui.stage,this.categoryButtons,function(t,e,i){return function(){n.shownSubCategory=null,e[0].stopNotify(),n.showOrHideBuildingsOfCategory(i[0].name,null,t[0]),n.updateGoalAttentions()}}(v,_,r),dt.getTexture(r[0].image),function(t){return function(){return n.shownCategory==t[0].name}}(r),function(t,e){return function(){n.gui.tooltip.setText(t[0],e[0].description,e[0].displayName)}}(_,r),null,"spr_transparentbutton"),this.categoryButtons.addChild(_[0]),this.categoryButtonPosition.h[r[0].name]=t,this.buttonsByCategory.h[r[0].name]=_[0],t+=22,this.city.progress.unlocks.getShouldNotifyForCategoryUnlock(r[0].name)&&(this.shownCategory==r[0].name||this.previouslyShownCategory==r[0].name?this.city.progress.unlocks.stopNotifyCategoryUnlock(r[0].name):_[0].notify(!1,function(t,e){return function(){t[0](e[0])}}([(N=this.city.progress.unlocks,Uh(N,N.stopNotifyCategoryUnlock))],[r[0].name])))}}this.city.progress.unlocks.unlockedBuildingModeButton&&this.addBuildingModeButtons(),this.gui.game.isMobile&&!this.gui.game.isLargeMobile||this.city.progress.unlocks.unlockedManagementOptions&&this.addManagementButtons()},showOrHideBuildingsOfCategory:function(t,e,i,n,r,s){if(null==s&&(s=!1),null==r&&(r=!0),null==n&&(n=!1),this.buildingInCategoryButtons.clear(),s||this.closeExtraBuildingModes(),!s&&this.shownManagementOptions&&this.closeManagementOptions(),this.buildingInCategoryButtonsCol=null,this.buildingInCategoryButtonsColAmount=0,this.buildingInCategoryButtonsNumberOfCols=0,this.buttonsInCategory=new Vo,r&&null!=this.city.builder&&this.city.builder.cancel(),this.shownCategory!=t||this.shownSubCategory!=e||n){var o=this.shownCategory=t;null!=e&&(o+="_"+e),this.shownSubCategory=e,null==i||this.gui.game.isMobile||(this.buildingInCategoryButtons.padding.left=i),null!=e&&(this.createSubCategoryBackButton(i),this.categoryHasMirror(o)&&this.createSubCategoryMirrorButton(i));for(var a=0,l=this.city.progress.resources.buildingInfoArray;a<l.length;){var h=l[a];++a;var u="buildings."+h.className,c=q[u],d=this.city.progress.unlocks.getUnlockState(c),p=this.city.progress.unlocks.getShouldNotifyForUnlock(c);if(h.category!=o||d!=$a.Unlocked&&d!=$a.Researched&&d!=$a.Createable||this.addBuildingButton(c,d,p),"Transportation"==t&&"HyperElevator"==h.className)for(var f=0,g=dt.bridgesInfo;f<g.length;){var m=g[f];++f;var y="miscCityElements."+m.className,_=q[y],v=this.city.progress.unlocks.getUnlockState(_),b=this.city.progress.unlocks.getShouldNotifyForUnlock(_);v!=$a.Unlocked&&v!=$a.Researched&&v!=$a.Createable||this.addBridgeButton(m,v,b)}}for(a=0,l=dt.decorationsInfo;a<l.length;){var w=l[a];++a,w.category==o&&(null==w.specialInfo||-1!=w.specialInfo.indexOf("snow")&&B.isSnowThemed||-1!=w.specialInfo.indexOf("geneEditingReq")&&this.city.upgrades.vars.hasGeneEditing)&&this.addDecorationButton(w)}for(a=0,l=dt.worldResourcesInfo;a<l.length;){var S=l[a];++a,S.category!=o||null!=S.specialInfo&&-1!=S.specialInfo.indexOf("snow")&&"snowWorld"!=this.city.progress.story.storyName||this.addWorldResourceButton(S)}if("Transportation"==t&&this.city.progress.unlocks.unlockedMaterial("graphene")){d=this.city.progress.unlocks.getShouldNotifyForMiscUnlock("FloatingPlatform");this.addFloatingPlatformButton(d)}this.addSubCategories(o,i);var x=this.buildingInCategoryButtons.padding.left;this.buildingInCategoryButtons.padding.left=0<x?x:0,this.buildingInCategoryButtons.updateSize()}else this.shownCategory=""},addFloatingPlatformButton:function(t){var e=this;this.makeSpaceForBuildingButton();var i=new Us(this.gui,this.gui.stage,this.buildingInCategoryButtonsCol,Uh(N=this.city,N.createOrRemoveFloatingPlatformBuilder),dt.getTexture("spr_floatingplatform"),function(){return null!=e.city.builder&&4==e.city.builder.builderType._hx_index},function(){e.showFloatingPlatformTooltip(i,!1)});if(t){var n=Uh(N=this.city.progress.unlocks,N.stopNotifyMiscUnlock);i.notify(!0,function(){n("FloatingPlatform")})}this.gui.game.isMobile?this.buildingInCategoryButtonsCol.addChild(i):this.buildingInCategoryButtonsCol.insertChild(i,0)},addBridgeButton:function(t,e,i){var n=this;this.makeSpaceForBuildingButton();var r="miscCityElements."+t.className,s=q[r],o=e==$a.Unlocked||!B.hasPremium(),a=o?dt.getTexture("spr_lockedbuilding@0,0,20,20"):dt.getTexture(t.textureName,new yr(66,0,20,20)),l=new Us(this.gui,this.gui.stage,this.buildingInCategoryButtonsCol,function(){if(o)return null!=n.city.builder&&n.city.builder.cancel(),void(B.hasPremium()?n.gui.showSimpleWindow(t.showUnlockHint,"",!0,!0):sa.showPremiumWall(n.city.gui));n.city.createOrRemoveBridgeBuilder(t)},a,function(){return null!=n.city.builder&&k.enumEq(n.city.builder.builderType,d.Bridge(t))},function(){n.showBridgeTooltip(t,l,!1)},o?dt.getTexture("spr_lockedbuilding@22,0,20,20"):dt.getTexture(t.textureName,new yr(88,0,20,20)));if(i){var h=Uh(N=this.city.progress.unlocks,N.stopNotifyForUnlock),u=s;l.notify(!0,function(){h(u)})}this.gui.game.isMobile?this.buildingInCategoryButtonsCol.addChild(l):this.buildingInCategoryButtonsCol.insertChild(l,0)},addSubCategories:function(t,e){"Decoration & Nature"==t&&(this.addSubCategoryButton(t,"coloredBlocks",e,Tr.lo("colored_blocks"),"spr_coloredblock"),this.addSubCategoryButton(t,"slantedroofs",e,Tr.lo("slanted_roofs"),"spr_slantedroof"),this.addSubCategoryButton(t,"slantedrooftops",e,Tr.lo("slanted_rooftops"),"spr_slantedrooftop"),this.addSubCategoryButton(t,"roofbottom",e,Tr.lo("roof_bottoms"),"spr_roofbottom"),this.addSubCategoryButton(t,"domeroofs",e,Tr.lo("domeroofs"),"spr_domeroof"))},categoryHasMirror:function(t){return"Decoration & Nature_slantedroofs"==t},addSubCategoryButton:function(t,e,i,n,r){var s=this;this.makeSpaceForBuildingButton();var o=new Us(this.gui,this.gui.stage,this.buildingInCategoryButtonsCol,function(){ls.colorPickedOnLastMultiMenuOpen=ls.colorPicked,s.showOrHideBuildingsOfCategory(t,e,i)},dt.getTexturesByWidth(r,20)[0],function(){return!1},function(){s.gui.tooltip.setText(o,n)});this.gui.game.isMobile?this.buildingInCategoryButtonsCol.addChild(o):this.buildingInCategoryButtonsCol.insertChild(o,0)},refreshCategoryBuildingsShown:function(){this.buildingButtons.destroy(),this.allBuildingModeButtons.destroy(),this.allManagementOptionsButtons.destroy(),this.buttonsByCategory=new Vo,this.createBuildingButtons(),""!=this.shownCategory&&this.showOrHideBuildingsOfCategory(this.shownCategory,this.shownSubCategory,this.categoryButtonPosition.h[this.shownCategory],!0,!1,!0),this.updateGoalAttentions()},makeSpaceForBuildingButton:function(){var t;if(this.gui.game.isMobile){var e=(this.gui.game.rect.width-40-this.gui.safeAreaLeft-this.gui.safeAreaRight)/22|0;t=this.buildingInCategoryButtonsColAmount>=(2<e?e:2)}else{e=(this.gui.game.rect.height-40-this.gui.safeAreaTop-this.gui.safeAreaBottom)/22|0;t=this.buildingInCategoryButtonsColAmount>=(2<e?e:2)}null!=this.buildingInCategoryButtonsCol&&!t||(this.buildingInCategoryButtonsColAmount=0,this.buildingInCategoryButtonsCol=new ps(this.gui,this.gui.stage,this.buildingInCategoryButtons),this.gui.game.isMobile?(this.buildingInCategoryButtonsCol.direction=Ps.Horizontal,this.buildingInCategoryButtonsCol.alignment=Cs.LeftOrTop,this.buildingInCategoryButtons.insertChild(this.buildingInCategoryButtonsCol,0)):(this.buildingInCategoryButtonsCol.direction=Ps.Vertical,this.buildingInCategoryButtonsCol.alignment=Cs.LeftOrTop,this.buildingInCategoryButtons.addChild(this.buildingInCategoryButtonsCol)),this.buildingInCategoryButtonsNumberOfCols+=1),this.buildingInCategoryButtonsColAmount+=1},addBuildingButton:function(s,t,e){var i,o,a=this,n=F.field(s,"spriteName"),r=s.__name__,l=this.city.progress.resources.buildingInfo.h[r],h=(null!=l.showUnlockHint||-1!=l.specialInfo.indexOf("premium")&&!B.hasPremium())&&(t==$a.Unlocked||-1!=l.specialInfo.indexOf("premium")&&!B.hasPremium()),u=-1!=l.specialInfo.indexOf("as_multi_decor"),c=[dt.getTexture(h?"spr_lockedbuilding@0,0,20,20":n+"@0,0,20,20")],d=null;if(u&&!h){if(-1!=l.specialInfo.indexOf("has_multi_decor_spec")){for(var p=lt.find(l.specialInfo,function(t){return C.startsWith(t,"multi_decor_spec")}).split(":")[1].split(","),f=new Array(p.length),g=0,m=p.length;g<m;){f[_=g++]=dt.getTexture(p[_]+"@0,0,20,20")}c=f;for(p=lt.find(l.specialInfo,function(t){return C.startsWith(t,"multi_decor_spec")}).split(":")[1].split(","),f=new Array(p.length),g=0,m=p.length;g<m;){f[_=g++]=dt.getTexture(p[_]+"@44,0,20,20")}d=f}else c=dt.getTexturesByWidth(n,20);g=[],m=0;for(var y=c.length;m<y;){var _=m++;g.push(_)}o=g}else o=[0];var v=!1;-1!=l.specialInfo.indexOf("as_multi_decor_anycolor")&&-1<ls.colorPickedOnLastMultiMenuOpen&&(o.splice(0,0,c.length-1),v=!0);for(g=0,m=o.length;g<m;){_=[g++];var b=[o[_[0]]],w=[-1];0==_[0]&&b[0]==c.length-1&&v&&(w[0]=ls.colorPickedOnLastMultiMenuOpen),this.makeSpaceForBuildingButton(),i=new Us(this.gui,this.gui.stage,this.buildingInCategoryButtonsCol,function(i,n,r){return function(){if(a.gui.game.isMobile&&a.closeExtraBuildingModes(),h)return null!=a.city.builder&&a.city.builder.cancel(),void(-1==l.specialInfo.indexOf("premium")||B.hasPremium()?a.gui.showSimpleWindow(l.showUnlockHint,"",!0,!0):sa.showPremiumWall(a.city.gui));if(-1!=l.specialInfo.indexOf("as_multi_decor_anycolor")&&r[0]==o.length-1)null!=a.city.builder&&a.city.builder.cancel(),a.city.gui.clearWindowStack(),hs.createWindow(a.city,(e=n,function(t){a.city.createOrRemoveBuilder(s,!1,e[0],-1!=l.specialInfo.indexOf("mirrorable")&&a.mirrored,t)}));else if(a.gui.get_keyboard().down[17]){var t=Gn.findLeastUpgraded(a.city,s);null==t?a.city.createOrRemoveBuilder(s,!1,n[0],-1!=l.specialInfo.indexOf("mirrorable")&&a.mirrored,i[0]):t.showWindow()}else a.city.createOrRemoveBuilder(s,!1,n[0],-1!=l.specialInfo.indexOf("mirrorable")&&a.mirrored,i[0]);var e}}(w,b,_),c[b[0]],function(t,e,i){return function(){return!(null==a.city.builder||a.city.builder.get_buildingToBuild()!=s||a.city.builder.decorationAppearance!=e[0]||v&&i[0]==o.length-1)&&a.city.builder.decorationAppearanceColor==t[0]}}(w,b,_),function(){h?-1==l.specialInfo.indexOf("premium")||B.hasPremium()?a.gui.tooltip.setText(i,l.showUnlockHint):a.gui.tooltip.setText(i,Tr.lo("get_premium_to_unlock")):a.gui.get_keyboard().down[17]?Gn.doHighlight(a.city,s):a.showBuildingTooltip(l,s,i)},null==d?"none"==l.buttonBack?null:dt.getTexture(h?"spr_lockedbuilding@22,0,20,20":null==l.buttonBack?n+"@44,0,20,20":l.buttonBack):d[b[0]]),-1<w[0]&&(i.imageSprite.tint=w[0]),e&&i.notify(!0,function(t,e){return function(){t[0](e[0])}}([(N=this.city.progress.unlocks,Uh(N,N.stopNotifyForUnlock))],[s])),this.mirrored&&-1!=l.specialInfo.indexOf("mirrorable")&&i.mirror(),-1!=l.specialInfo.indexOf("as_multi_decor_anycolor")&&_[0]==o.length-1&&i.addExtraSprite("spr_recolorable"),this.buttonsInCategory.h[r]=i,this.gui.game.isMobile?this.buildingInCategoryButtonsCol.addChild(i):this.buildingInCategoryButtonsCol.insertChild(i,0),null!=this.shownSubCategory&&0==_[0]&&null==this.city.builder&&this.city.createOrRemoveBuilder(s,!0,b[0],-1!=l.specialInfo.indexOf("mirrorable")&&this.mirrored,w[0])}},showBuildingTooltip:function(t,e,i,n){null==n&&(n=!1);var r=this.city.progress.buildingCost.getBuildingCost(t);this.city.progress.unlocks.getUnlockState(e)==$a.Researched&&(r.knowledge=0);var s,o=[];if(null!=t.tooltipBottomIconInfo){for(var a=t.tooltipBottomIconInfo,l=new Array(a.length),h=0,u=a.length;h<u;){var c=h++,d=a[c];l[c]={text:d.text,texture:dt.getTexture(d.texture)}}s=l}else s=[];if(null!=t.jobs&&0!=t.jobs&&o.push({texture:dt.getTexture("spr_work"),text:null==t.jobs?"null":""+t.jobs}),null!=t.residents&&0!=t.residents&&o.push({texture:dt.getTexture("spr_residents"),text:null==t.residents?"null":""+t.residents}),null!=t.quality&&0!=t.quality&&o.push({texture:dt.getTexture("spr_happiness"),text:null==t.quality?"null":""+t.quality}),this.city.upgrades.vars.hasGalacticLibrary&&-1!=t.specialInfo.indexOf("notUniqueIfGalacticLibrary")){var p=dt.getTexture("spr_uniquebuilding"),f=Tr.lo("limitedBuilding",["2"]);o.push({texture:p,text:2<=lt.count(this.city.permanents,function(t){return t.is(e)})?"[red]"+f:f})}else-1!=t.specialInfo.indexOf("unique")&&o.push({texture:dt.getTexture("spr_uniquebuilding"),text:gr.any(this.city.permanents,function(t){return t.is(e)})?"[red]"+Tr.lo("already_built"):Tr.lo("unique")});if(-1!=t.specialInfo.indexOf("limited")){p=dt.getTexture("spr_uniquebuilding");var g=Y.parseInt(lt.find(t.specialInfo,function(t){return C.startsWith(t,"limitedToCitizens")}).split(":")[1]),m=Math.ceil(this.city.simulation.citizens.length/g),y=lt.count(this.city.permanents,function(t){return t.is(e)});f=Tr.lo("limited_per_citizens",[g]);o.push({texture:p,text:m<=y?"[red]"+f:f})}var _=t.description;_=gr.any(this.city.permanents,function(t){return t.is(e)})?C.replace(_,"!unlocks",""):C.replace(_,"!unlocks"," "+Tr.lo("also_unlocks_new")),_+=this.city.progress.buildingCost.getBuildingCostDescriptionAdder(t);var v=this.city.simulation.operatingCost.getOperatingCost(t),b="";null!=v&&v.any()&&(b=this.city.simulation.operatingCost.getOperatingCostReason(t)),n?this.gui.tooltip.setTextForContinuous(_,Tr.lo("building_a_building",[t.name]),r,o,s,v,b):this.gui.tooltip.setText(i,_,t.name,r,o,s,v,b)},addDecorationButton:function(e){var t,i=this;this.makeSpaceForBuildingButton();var n=Uh(N=this.city,N.createOrRemoveDecorationBuilder),r=e;t=new Us(this.gui,this.gui.stage,this.buildingInCategoryButtonsCol,function(){n(r)},dt.getTexture(e.textureName+"@0,0,20,20"),function(){if(null==i.city.builder)return!1;var t=i.city.builder.builderType;return(1==t._hx_index?t.decorationInfo.name:"")==e.name},function(){i.showDecorationTooltip(e,t)}),this.gui.game.isMobile?this.buildingInCategoryButtonsCol.addChild(t):this.buildingInCategoryButtonsCol.insertChild(t,0)},showDecorationTooltip:function(t,e,i){null==i&&(i=!1);var n=L.fromDecorationInfo(t);i?t.isRemoveDecoration?this.gui.tooltip.setTextForContinuous(t.description,t.name+"",n):this.gui.tooltip.setTextForContinuous(t.description,Tr.lo("placing_a_decoration",[t.name]),n):this.gui.tooltip.setText(e,t.description,t.name,n)},showFloatingPlatformTooltip:function(t,e){null==e&&(e=!1);var i=U.floatingPlatformCost;e?this.gui.tooltip.setTextForContinuous(Tr.lo("floating_platform_description"),Tr.lo("building_a_building",[Tr.lo("floating_platform")]),i):this.gui.tooltip.setText(t,Tr.lo("floating_platform_description"),Tr.lo("floating_platform"),i)},showBridgeTooltip:function(t,e,i){null==i&&(i=!1);var n=L.fromBridgeInfo(t),r="miscCityElements."+t.className;this.city.progress.unlocks.getUnlockState(q[r])==$a.Researched&&(n.knowledge=0),i?this.gui.tooltip.setTextForContinuous(t.description,Tr.lo("building_a_building",[t.name]),n):this.gui.tooltip.setText(e,t.description,t.name,n)},addWorldResourceButton:function(e){var i=this,t="worldResources."+e.className,n=q[t];if(this.city.progress.unlocks.getUnlockState(n)!=$a.Locked){var r;this.makeSpaceForBuildingButton();var s=Uh(N=this.city,N.createOrRemoveWorldResourceBuilder),o=e;r=new Us(this.gui,this.gui.stage,this.buildingInCategoryButtonsCol,function(){s(o)},dt.getTexture(""+e.textureName),function(){if(null==i.city.builder)return!1;var t=i.city.builder.builderType;return(2==t._hx_index?t.resourceInfo:null)==e},function(){i.showWorldResourceTooltip(e,r)}),this.gui.game.isMobile?this.buildingInCategoryButtonsCol.addChild(r):this.buildingInCategoryButtonsCol.insertChild(r,0)}},showWorldResourceTooltip:function(t,e,i){null==i&&(i=!1);var n=L.fromWorldResourceInfo(t);i?this.gui.tooltip.setTextForContinuous(t.description,-1!=t.specialInfo.indexOf("planting")?Tr.lo("planting_a_forest",[t.name]):Tr.lo("placing_a_decoration",[t.name]),n):this.gui.tooltip.setText(e,t.description,t.name,n)},createSubCategoryMirrorButton:function(n){var r=this;this.makeSpaceForBuildingButton();var t=new Us(this.gui,this.gui.stage,this.buildingInCategoryButtonsCol,function(){var t=null,e=null,i=null;null!=r.city.builder&&(t=r.city.builder.get_buildingToBuild(),e=r.city.builder.decorationAppearance,i=r.city.builder.decorationAppearanceColor),r.mirrored=!r.mirrored,r.showOrHideBuildingsOfCategory(r.shownCategory,r.shownSubCategory,n,!0),null!=t&&r.city.createOrRemoveBuilder(t,!0,e,r.mirrored,i)},dt.getTexture("spr_mirror"),function(){return!1},function(){r.gui.tooltip.setText(t,Tr.lo("mirror"))});this.gui.game.isMobile?this.buildingInCategoryButtonsCol.addChild(t):this.buildingInCategoryButtonsCol.insertChild(t,0)},createSubCategoryBackButton:function(t){var e=this;this.makeSpaceForBuildingButton();var i=new Us(this.gui,this.gui.stage,this.buildingInCategoryButtonsCol,function(){e.showOrHideBuildingsOfCategory(e.shownCategory,null,t)},dt.getTexture("spr_arrow_back"),function(){return!1},function(){e.gui.tooltip.setText(i,Tr.lo("back"))});this.gui.game.isMobile?this.buildingInCategoryButtonsCol.addChild(i):this.buildingInCategoryButtonsCol.insertChild(i,0)},addBuildingModeButtons:function(){function r(t){switch(t._hx_index){case 0:return"spr_icon_buildingmode_ontop";case 1:return"spr_icon_buildingmode_insert";case 2:return"spr_icon_buildingmode_replace";case 3:return"spr_icon_buildingmode_drag";case 4:return"spr_icon_buildingmode_dragreplace";case 5:return"spr_icon_buildingmode_destroy";case 6:return"spr_icon_buildingmode_destroyleavinghole"}}function s(t,e,n){function i(t,e,i){n?o.gui.tooltip.setTextForContinuous(e,i):o.gui.tooltip.setText(t,e,i)}if(o.gui.game.isMobile)switch(e._hx_index){case 0:i(t,Tr.lo("build_mode_normal_explanation"),Tr.lo("build_mode_normal"));break;case 1:i(t,Tr.lo("build_anywhere"),Tr.lo("build_mode_insert"));break;case 2:i(t,Tr.lo("build_mode_replace_explanation"),Tr.lo("build_mode_replace"));break;case 3:i(t,Tr.lo("build_mode_multi_explanation"),Tr.lo("build_mode_multi"));break;case 4:i(t,Tr.lo("build_mode_multi_replace_explanation"),Tr.lo("build_mode_multi_replace"));break;case 5:i(t,Tr.lo("build_mode_destroy_explanation"),Tr.lo("build_mode_destroy"));break;case 6:i(t,Tr.lo("build_mode_destroyleavinghole_explanation"),Tr.lo("build_mode_destroyleavinghole"))}else switch(e._hx_index){case 0:i(t,Tr.lo("build_mode_normal_explanation_pc")+" "+Tr.lo("exception")+" "+(null==o.city.builder?Tr.lo("click_rooftop_selected"):Tr.lo("click_rooftop"))+" ",Tr.lo("build_mode_normal"));break;case 1:i(t,Tr.lo("build_anywhere_pc")+" "+(null==o.city.builder?Tr.lo("build_mode_insert_explanation_pc"):Tr.lo("build_mode_insert_explanation_pc_b")),Tr.lo("build_mode_insert"));break;case 2:i(t,Tr.lo("build_mode_replace_explanation_pc"),Tr.lo("build_mode_replace"));break;case 3:i(t,Tr.lo("build_mode_multi_explanation_pc"),Tr.lo("build_mode_multi"));break;case 4:i(t,Tr.lo("build_mode_multi_replace_explanation"),Tr.lo("build_mode_multi_replace"));break;case 5:i(t,Tr.lo("build_mode_destroy_explanation"),Tr.lo("build_mode_destroy"));break;case 6:i(t,Tr.lo("build_mode_destroyleavinghole_explanation"),Tr.lo("build_mode_destroyleavinghole"))}}function e(){for(var t=[ot.Normal,ot.Insert,ot.Replace,ot.Drag,ot.DragReplace,ot.Destroy,ot.DestroyLeavingHole],e=0;e<t.length;){var i=[t[e]];++e;var n=[];n[0]=new Us(o.gui,o.gui.stage,o.allBuildingModeButtons,function(n){return function(){if(o.city.buildingMode=n[0],o.gui.game.isMobile&&null!=o.city.builder&&o.city.builder.invalidateCache(),n[0]!=ot.Destroy&&n[0]!=ot.DestroyLeavingHole){if(null==o.city.builder&&null!=o.city.specialActionOld&&o.city.specialActionOld.activate(),!o.gui.game.isMobile||""!=o.shownCategory){if(o.gui.game.isMobile){var t,e,i=o.gui;switch(n[0]._hx_index){case 0:t=Tr.lo("build_mode_normal_explanation");break;case 1:t=Tr.lo("build_anywhere");break;case 2:t=Tr.lo("build_mode_replace_explanation");break;case 3:t=Tr.lo("build_mode_multi_explanation");break;case 5:t=Tr.lo("build_mode_destroy_explanation");break;case 6:t=Tr.lo("build_mode_destroyleavinghole_explanation");break;default:t=""}switch(n[0]._hx_index){case 0:e=Tr.lo("build_mode_normal");break;case 1:e=Tr.lo("build_mode_insert");break;case 2:e=Tr.lo("build_mode_replace");break;case 3:e=Tr.lo("build_mode_multi");break;case 5:e=Tr.lo("build_mode_destroy");break;case 6:e=Tr.lo("build_mode_destroyleavinghole");break;default:e=""}i.notify(t,e,120)}o.closeExtraBuildingModes()}}else null!=o.city.specialAction&&o.city.specialAction.deactivate(),o.gui.game.isMobile&&(o.allBuildingModeButtons.padding.bottom=0,o.allBuildingModeButtons.updateSize()),o.showOrHideBuildingsOfCategory(o.shownCategory,o.shownSubCategory,o.categoryButtonPosition.h[o.shownCategory],!1,!0,!0)}}(i),dt.getTexture(r(i[0])),function(t){return function(){return o.city.buildingMode==t[0]}}(i),function(t,e){return function(){s(t[0],e[0],!1)}}(n,i)),o.gui.game.isMobile?o.allBuildingModeButtons.addChild(n[0]):o.allBuildingModeButtons.insertChild(n[0],0)}o.gui.game.isMobile&&(o.allBuildingModeButtons.padding.bottom=""!=o.shownCategory?o.buildingInCategoryButtons.baseHeight:0,o.allBuildingModeButtons.updateSize()),o.gui.game.isMobile&&o.shownManagementOptions&&o.closeManagementOptions()}function t(){for(var t=Vo.valueIterator(o.categoryButtonPosition.h);t.hasNext();){t.next()+20+2}o.shownBuildingModes?o.closeExtraBuildingModes():(e(),o.shownBuildingModes=!0)}var i,o=this;this.gui.game.isMobile||(this.allBuildingModeButtons.padding.left=this.categoryButtons.rect.width),i=new Us(this.gui,this.gui.stage,this.categoryButtons,function(){o.gui.game.isMobile?t():(o.city.buildingMode=o.city.buildingMode==ot.Normal?ot.Insert:ot.Normal,o.closeExtraBuildingModes())},dt.getTexture(r(this.city.buildingMode)),function(){return!!o.gui.game.isMobile&&o.shownBuildingModes},function(){s(i,o.city.buildingMode,!1)},null,"spr_transparentbutton");var n=ot.Normal;if(i.onUpdate=function(){n!=o.city.buildingMode&&(i.updateTexture(dt.getTexture(r(o.city.buildingMode))),n=o.city.buildingMode),o.gui.game.isMobile&&o.shownBuildingModes&&null==o.city.builder&&s(i,o.city.buildingMode,!0)},this.categoryButtons.addChild(i),!this.gui.game.isMobile){var a=new Us(this.gui,this.gui.stage,this.categoryButtons,t,dt.getTexture("spr_morebuildingmodes_arrowup"),function(){return o.shownBuildingModes},function(){o.gui.tooltip.setText(a,Tr.lo("all_building_modes"))},null,"spr_morebuildingmodebuttons");this.categoryButtons.addChild(a)}this.shownBuildingModes&&e()},closeExtraBuildingModes:function(){this.allBuildingModeButtons.clear(),this.shownBuildingModes=!1,this.city.buildingMode!=ot.Destroy&&this.city.buildingMode!=ot.DestroyLeavingHole||(this.city.buildingMode=ot.Normal,null==this.city.builder&&null!=this.city.specialActionOld&&this.city.specialActionOld.activate())},showManagementOptions:function(t){var e=this;if(null==t&&(t=this.allManagementOptionsButtons),this.gui.game.isMobile&&this.shownBuildingModes&&this.closeExtraBuildingModes(),this.city.progress.story.storyInfo.useInviteCitizens){var i=new Us(this.gui,this.gui.stage,t,function(){"invite_people"==e.gui.windowRelatedTo?e.gui.closeWindow():bo.createWindow(e.city)},dt.getTexture("spr_icon_invitepeople"),function(){return"invite_people"==e.gui.windowRelatedTo},function(){e.gui.tooltip.setText(i,Tr.lo("invite_people"))});this.gui.game.isMobile?t.addChild(i):t.insertChild(i,0),this.inviteCitizensButton=i}var n=new Us(this.gui,this.gui.stage,t,function(){e.city.viewActions.isFollowOpen()?e.city.specialAction.deactivate(!0):e.city.viewActions.showFollow()},dt.getTexture("spr_icon_followcitizen"),function(){return e.city.viewActions.isFollowOpen()},function(){e.gui.tooltip.setText(n,Tr.lo("follow_citizen"))});this.gui.game.isMobile?t.addChild(n):t.insertChild(n,0);var r=new Us(this.gui,this.gui.stage,t,function(){"global_upgrades"==e.gui.windowRelatedTo?e.gui.closeWindow():(e.gui.createWindow("global_upgrades"),Rs.create(e.city,e.gui,e.gui.innerWindowStage,e.gui.windowInner))},dt.getTexture("spr_icon_upgrade"),function(){return"global_upgrades"==e.gui.windowRelatedTo},function(){e.gui.tooltip.setText(r,Tr.lo("upgrades_and_policies"))});this.gui.game.isMobile?t.addChild(r):t.insertChild(r,0);var s=new Us(this.gui,this.gui.stage,t,function(){"highlight_buildings"==e.gui.windowRelatedTo?e.gui.closeWindow():yo.createWindow(e.city)},dt.getTexture("spr_icon_findbuilding"),function(){return"highlight_buildings"==e.gui.windowRelatedTo},function(){e.gui.game.isMobile?e.gui.tooltip.setText(s,Tr.lo("highlight_buildings")):e.gui.tooltip.setText(s,Tr.lo("ctrl_to_highlight"),Tr.lo("highlight_buildings"))});this.gui.game.isMobile?t.addChild(s):t.insertChild(s,0),this.gui.game.isMobile&&this.gui.game.isLargeMobile&&""!=this.shownCategory&&this.showOrHideBuildingsOfCategory(this.shownCategory,this.shownSubCategory,this.categoryButtonPosition.h[this.shownCategory],!1,!0,!0)},closeManagementOptions:function(){this.allManagementOptionsButtons.clear(),this.shownManagementOptions=!1,this.inviteCitizensButton=null},addManagementButtons:function(){var t=this,e=new Us(this.gui,this.gui.stage,this.categoryButtons,function(){t.shownManagementOptions=!t.shownManagementOptions,t.shownManagementOptions?t.showManagementOptions():t.closeManagementOptions()},dt.getTexture("spr_icon_management"),function(){return t.shownManagementOptions},function(){t.gui.tooltip.setText(e,Tr.lo("management"))},null,"spr_transparentbutton");this.gui.game.isMobile||(this.allManagementOptionsButtons.padding.left=this.categoryButtons.rect.width),this.categoryButtons.addChild(e),this.activateManagementModeButton=e,this.shownManagementOptions&&this.showManagementOptions()},updateGoalAttentions:function(){function t(e,t){var i=e.__name__,n=dt.buildingInfo.h[i];if(null!=n&&(!t||y.city.materials.canAfford(L.fromBuildingInfo(n)))){var r,s=n.category;if(null!=y.activateBuildModeButton&&y.activateBuildModeButton.setNeedsAttention(t),p=null!=s&&""!=s&&null!=(r=y.buttonsByCategory.h[s])){r.setNeedsAttention(t);var o=y.buttonsInCategory.h[i];null!=o&&o.setNeedsAttention(t)}}var a=dt.buildingUpgradesInfo.h[i];if(null!=a&&(!t||y.city.materials.canAfford(L.fromBuildingUpgradesInfo(a)))){var l=!0;if(null!=y.gui.window&&y.gui.windowRelatedTo instanceof _)if(-1!=(m=y.gui.windowRelatedTo).get_possibleUpgrades().indexOf(e)&&!gr.any(m.upgrades,function(t){return Ko.getClass(t)==e}))null!=(g=y.gui.currentUpgradeButtons.h[i])&&g.setNeedsAttention(t),l=!1;if(l||!t)for(var h=0,u=y.city.permanents;h<u.length;){var c=u[h];if(++h,c.is(_))if(-1!=(m=c).get_possibleUpgrades().indexOf(e)&&!gr.any(m.upgrades,function(t){return Ko.getClass(t)==e}))if(t){if(null==m.highlightSprite){m.highlightSprite=new PIXI.Sprite(dt.getTexture("spr_whiteoutline")),m.highlightSprite.position.set(m.position.x-1,m.position.y-1),y.city.farForegroundStage.addChild(m.highlightSprite);var d=[89,1,.77],p=hh.toRgb(d);m.highlightSprite.tint=mr.toHexInt(p)}m.highlightSprite.alpha=(Math.sin(y.gui.guiTimer/10)+1)/2}else null!=m.highlightSprite&&(m.highlightSprite.destroy(),m.highlightSprite=null)}}var f=dt.cityUpgradesInfo.h[i];if(null!=f&&(!t||y.city.materials.canAfford(L.fromCityUpgradesInfo(f)))){var g;l=!0;if(null!=y.gui.window&&y.gui.windowRelatedTo instanceof _)if(-1!=(m=y.gui.windowRelatedTo).get_possibleCityUpgrades().indexOf(e)&&!gr.any(y.city.upgrades.upgrades,function(t){return Ko.getClass(t)==e}))null!=(g=y.gui.currentUpgradeButtons.h[i])&&g.setNeedsAttention(t),l=!1;if(l||!t)for(h=0,u=y.city.permanents;h<u.length;){var m;c=u[h];if(++h,c.is(_))if(-1!=(m=c).get_possibleCityUpgrades().indexOf(e)&&!gr.any(y.city.upgrades.upgrades,function(t){return Ko.getClass(t)==e}))if(t){if(null==m.highlightSprite){m.highlightSprite=new PIXI.Sprite(dt.getTexture("spr_whiteoutline")),m.highlightSprite.position.set(m.position.x-1,m.position.y-1),y.city.farForegroundStage.addChild(m.highlightSprite);d=[89,1,.77],p=hh.toRgb(d);m.highlightSprite.tint=mr.toHexInt(p)}m.highlightSprite.alpha=(Math.sin(y.gui.guiTimer/10)+1)/2}else null!=m.highlightSprite&&(m.highlightSprite.destroy(),m.highlightSprite=null)}}}var y=this,e=this.city.progress.story.getDesiredGoalHighlights();if(null!=this.creatableCityElementsThatNeededAttention&&0<this.creatableCityElementsThatNeededAttention.length)for(var i=0,n=this.creatableCityElementsThatNeededAttention;i<n.length;){var r=n[i];++i,t(r,!1)}for(i=0;i<e.length;){var s=e[i];++i,t(s,!0)}this.creatableCityElementsThatNeededAttention=e},__class__:es};function is(){}(q["gui.BuildingTypeImage"]=is).__name__="gui.BuildingTypeImage",is.create=function(t,e,i,n,r){var s=new PIXI.Container,o=F.field(i,"spriteName"),a=e.progress.resources.buildingInfo,l=i.__name__,h=a.h[l];"none"!=h.buttonBack&&s.addChild(dt.makeSprite(null==h.buttonBack?o+"@44,0,20,20":h.buttonBack)),s.addChild(dt.makeSprite(o+"@0,0,20,20"));var u=null;return u=new ds(n,t,s,null,null,function(t){return!!u.rect.contains(t.position)&&(r.tooltip.setText(u,h.name),!0)})};function ns(t,e,i,n,r,s){this.keyboardButton=null,this.canBeHeld=!1,this.mouseOut=!1,this.onUpdate=null,this.stage=e,this.gui=t,this.parent=i,this.action=n,this.onHover=s,null==r&&(r=function(){return!1}),this.isActive=r,this.buttonSound=R.get().buttonSound}(q["gui.Button"]=ns).__name__="gui.Button",ns.__interfaces__=[Qr],ns.prototype={updateSize:function(){null!=this.parent&&this.parent.updateSize()},updatePosition:function(t){this.rect.x=t.x,this.rect.y=t.y},handleMouse:function(t){return this.doHandleMouse(t,function(){},function(){})},doHandleMouse:function(t,e,i){if(this.rect.contains(t.position)){this.mouseOut=!1;var n=t.claimMouse(this,null,!0,this.canBeHeld);return n==$.Confirmed?(this.action(),null!=this.buttonSound&&R.get().playSound(this.buttonSound)):n==$.Active?i():e(),null!=this.onHover&&this.onHover(),!0}return!1},update:function(){null!=this.onUpdate&&this.onUpdate(),null!=this.keyboardButton&&this.gui.get_keyboard().pressed[this.keyboardButton]&&this.action(),this.mouseOut=!0},destroy:function(){},__class__:ns};var rs=function(){};(q["gui.ChangeCityNameWindow"]=rs).__name__="gui.ChangeCityNameWindow",rs.createWindow=function(t){t.gui.createWindow("changeCityNameWindow");var e=t;t.gui.addWindowToStack(function(){rs.createWindow(e)}),rs.create(t,t.gui,t.gui.innerWindowStage,t.gui.windowInner)},rs.create=function(e,t,i,n){t.windowAddTitleText(Tr.lo("change_city_name")),n.addChild(new ao(n,i,Tr.lo("give_city_name"))),n.addChild(new Ms(t.windowInner,new vr(2,4)));var r=new ho(t.windowInner,t,e.game,Tr.lo("city_name"),e.cityName);n.addChild(r),r.onInput=function(t){return null!=t&&(e.cityName=Be.sanitizeCityName(t),!0)},n.addChild(new Ms(t.windowInner,new vr(2,4))),t.windowAddBottomButtons()};var ss=function(t,e,i,n,r,s,o,a,l){null==l&&(l="spr_button_checked"),null==a&&(a="spr_button"),ns.call(this,t,e,i,n,s);var h=dt.getTextures(a,3),u=dt.getTextures(l,3);this.buttonPatch=new Ys(h[0],2,20,20),this.buttonPatch.texture=h[1],this.buttonPatch.updateTextures(!1),this.buttonPatch.texture=h[2],this.buttonPatch.updateTextures(!1),this.buttonPatch.texture=u[0],this.buttonPatch.updateTextures(!1),this.buttonPatch.texture=u[1],this.buttonPatch.updateTextures(!1),this.buttonPatch.texture=u[2],this.buttonPatch.updateTextures(!1),this.buttonPatch.setTextureSet(0),e.addChild(this.buttonPatch),this.container=new ps(t,e,this),this.rect=new yr(0,0,2,2),this.isChecked=r};(q["gui.CheckboxButton"]=ss).__name__="gui.CheckboxButton",ss.createSettingButton=function(t,e,i,n,r,s){var o=new ss(t,e,i,n,r),a=o.container;a.padding.top=3,a.padding.left=3,a.padding.right=3,a.padding.bottom=1,a.fillSecondarySize=!0,A.isMobile&&(a.padding.top+=2,a.padding.bottom+=2);var l=dt.getTextures("spr_checkbox",2),h=new PIXI.Sprite(l[1]),u=new ds(a,t.innerWindowStage,h,{left:0,right:3,top:0,bottom:0},function(){var t=l,e=r()?0:1;h.texture=t[e]});a.addChild(u),a.addChild(new ao(a,t.innerWindowStage,s)),i.addChild(o)},ss.__super__=ns,ss.prototype=e(ns.prototype,{updatePosition:function(t){ns.prototype.updatePosition.call(this,t),this.buttonPatch.position.set(t.x,t.y),this.buttonPatch.updateSprites(),this.container.updatePosition(t)},updateSize:function(){null!=this.container&&(this.rect.width=this.container.rect.width,this.rect.height=this.container.rect.height,this.updateSizeDisplay(),null!=this.parent&&this.parent.updateSize(),this.container.minWidth=this.container.baseWidth)},updateSizeDisplay:function(){null!=this.container&&(this.buttonPatch.npWidth=this.rect.width,this.buttonPatch.npHeight=this.rect.height,this.buttonPatch.updateSprites())},handleMouse:function(t){var e=this,i=this.isChecked();return ns.prototype.doHandleMouse.call(this,t,function(){e.buttonPatch.setTextureSet(i?4:1)},function(){e.buttonPatch.setTextureSet(i?5:2)})},update:function(){this.container.update(),this.mouseOut&&this.buttonPatch.setTextureSet(this.isChecked()?3:0),this.isActive()&&this.buttonPatch.setTextureSet(this.isChecked()?5:2),ns.prototype.update.call(this)},destroy:function(){ns.prototype.destroy.call(this),this.container.destroy(),this.buttonPatch.destroy()},__class__:ss});var os=function(t,e,i){this.persistentFullVersionUpsell=null,this.notificationTitleElem=null,this.notificationInner=null,this.resumeGameControl=null,this.gameSpeedOnUse=null,this.storyHelpButtonOnUse=null,this.hideShowUIButton=null,this.cityExtraInfoHidden=!1,this.simulationSpeedChosen=0,this.workerAssignButton=null,this.currentNotificationRelatedTo=null,this.materialsInfoScrollY=0,p.call(this,t,e),B.get_isCoolMathWithCrossPromotion()&&(this.persistentFullVersionUpsell=new Ks(this,this.stage)),this.initSimulationSpeeds(),this.tooltip=new uo(t,i,this.tooltipStage),this.city=i,this.cityInfo=new ps(this,this.stage,null,new vr(0,0),new br(1,1)),this.currentUpgradeButtons=new Vo,this.buildingButtons=new es(this,i),this.createCityInfo(),this.resize()};(q["gui.CityGUI"]=os).__name__="gui.CityGUI",os.__super__=p,os.prototype=e(p.prototype,{initSimulationSpeeds:function(){null==os.simulationSpeeds&&(os.simulationSpeeds=[{speed:1,icon:dt.getTexture("spr_icon_play_normalspeed"),tooltipTitle:Tr.lo("normal_speed")},{speed:1.5,icon:dt.getTexture("spr_oneandhalfspeed"),tooltipTitle:Tr.lo("onepointfive_speed")},{speed:2,icon:dt.getTexture("spr_icon_speedup"),tooltipTitle:Tr.lo("double_speed")},{speed:.5,icon:dt.getTexture("spr_icon_halfspeed"),tooltipTitle:Tr.lo("half_speed")},{speed:.75,icon:dt.getTexture("spr_icon_slightlyslowerspeed"),tooltipTitle:Tr.lo("threequarter_speed")}])},onLanguageChange:function(){p.prototype.onLanguageChange.call(this),this.tooltip=new uo(this.game,this.city,this.tooltipStage)},createWindowInCurrentContext:function(t,e){p.prototype.createWindow.call(this,t,e)},refreshCityInfo:function(){null!=this.materialsInfo&&(this.hideCityInfo(),this.createCityInfo())},createCityInfo:function(){this.addHelpAndGameSpeedButtons(),this.cityExtraInfoHidden||(this.addGeneralStatistics(),this.addAllMaterialsInfo())},hideCityInfo:function(){null!=this.materialsInfo&&(this.materialsInfoScrollY=this.materialsInfo.scrollable.scrollPosition.y),this.cityInfo.clear(),this.materialsInfo=null,this.workerAssignButton=null,this.hideShowUIButton=null,this.woodAmountDisplay=null,this.stoneAmountDisplay=null,this.storyHelpButton=null,this.gameSpeedButton=null},miniButtonToUse:function(){return this.game.isMobile?"spr_transparentbutton_info_miniplus":"spr_transparentbutton_info_mini"},addHelpAndGameSpeedButtons:function(){var r=this,i=new ps(this,this.stage,this.cityInfo,null);i.alignment=Cs.RightOrBottom,this.cityInfo.addChild(i);function s(){return r.city.progress.goalHelp.hasCurrentGoalHelp()}var t=null;t=function(){"quickMissionWindow"==r.windowRelatedTo?r.closeWindow():s()&&(r.city.gui.clearWindowStack(),r.city.gui.createWindow("quickMissionWindow"),r.city.gui.addWindowToStack(t),null!=r.storyHelpButtonOnUse&&r.storyHelpButtonOnUse(),vs.create(r.city,r.city.gui,r.city.gui.innerWindowStage,r.city.gui.windowInner))},this.storyHelpButton=new Us(this,this.stage,i,t,dt.getTexture("spr_icon_help"),function(){return"quickMissionWindow"==r.windowRelatedTo},function(){if(s()){var t=r.city.progress.goalHelp.getCurrentGoalHelp();if(1==t.length)r.tooltip.setText(r.storyHelpButton,t[0].text,t[0].category==Tr.lo("main_goal")?Tr.lo("current_task"):t[0].category);else{for(var e="",i=0;i<t.length;){var n=t[i];++i,""!=e&&(e+="\n\n"),e+="- "+n.category+"\n"+n.text}r.tooltip.setText(r.storyHelpButton,e,Tr.lo("current_tasks"))}}null!=r.storyHelpButtonOnUse&&r.storyHelpButtonOnUse()},null,this.miniButtonToUse(),this.game.isMobile?4:1),this.storyHelpButton.onUpdate=function(){s()?r.storyHelpButton.show():r.storyHelpButton.hide()},i.addChild(this.storyHelpButton);var e=new Us(this,this.stage,i,function(){r.city.set_pauseGame(!r.city.pauseGame),r.city.pauseGame?Mr.reportStopGameplay():Mr.reportStartGameplay()},dt.getTexture("spr_icon_pause"),function(){return r.city.pauseGame},function(){var t=r.game.isMobile?Or.firstToUpper(Tr.lo("tap")):Tr.lo("click_or_space");r.city.pauseGame?r.tooltip.setText(e,t+" "+Tr.lo("to_unpause"),Tr.lo("game_paused")):r.tooltip.setText(e,t+" "+Tr.lo("to_pause"),Tr.lo("game_running"))},null,this.miniButtonToUse(),this.game.isMobile?4:1);i.addChild(e),B.cheatSpeedEnabled&&!gr.any(os.simulationSpeeds,function(t){return 10<=t.speed})&&os.simulationSpeeds.push({speed:10,icon:dt.getTexture("spr_icon_speedup"),tooltipTitle:"Cheat Speed"}),this.gameSpeedButton=new Us(this,this.stage,i,function(){r.game.keyboard.down[17]?r.game.keyboard.down[16]?--r.simulationSpeedChosen<0&&(r.simulationSpeedChosen=os.simulationSpeeds.length-1):++r.simulationSpeedChosen>=os.simulationSpeeds.length&&(r.simulationSpeedChosen=0):1<r.simulationSpeedChosen?r.simulationSpeedChosen=0:r.simulationSpeedChosen=2,r.city.simulationSpeed=os.simulationSpeeds[r.simulationSpeedChosen].speed,r.gameSpeedButton.imageSprite.texture=os.simulationSpeeds[r.simulationSpeedChosen].icon,r.game.keyboard.down[16]||(r.city.set_pauseGame(!1),Mr.reportStartGameplay()),null!=r.gameSpeedOnUse&&r.gameSpeedOnUse()},gr.min(os.simulationSpeeds,function(t){return Math.abs(t.speed-r.city.simulationSpeed)}).icon,function(){return!1},function(){r.tooltip.setText(r.gameSpeedButton,r.game.isMobile?Tr.lo("change_game_speed_mobile"):Tr.lo("change_game_speed_pc")+(r.city.pauseGame?"\n"+Tr.lo("keep_paused_help"):""),os.simulationSpeeds[r.simulationSpeedChosen].tooltipTitle),null!=r.gameSpeedOnUse&&r.gameSpeedOnUse()},null,this.miniButtonToUse(),this.game.isMobile?4:1),this.gameSpeedButton.keyboardButton=f.getLetterCode("S"),i.addChild(this.gameSpeedButton);var n=new Us(this,this.stage,i,function(){"gameMenu"==r.windowRelatedTo?r.closeWindow():Bs.create(r,r.city)},dt.getTexture("spr_icon_menu"),function(){return"gameMenu"==r.windowRelatedTo},function(){r.tooltip.setText(n,"",Tr.lo("game_menu"))},null,this.miniButtonToUse(),this.game.isMobile?4:1);if(n.keyboardButton=f.getLetterCode("M"),i.addChild(n),(0<this.city.subCities.length||0<this.city.possibleSubCities.length)&&(this.rocketMenuButton=new Us(this,this.stage,i,function(){"switchCity"==r.windowRelatedTo?r.closeWindow():so.create(r.city,r.city.game,r)},dt.getTexture("spr_icon_rocket"),function(){return"switchCity"==r.windowRelatedTo},function(){r.tooltip.setText(r.rocketMenuButton,Tr.lo("switch_city_menu"))},null,this.miniButtonToUse(),this.game.isMobile?4:1),this.rocketMenuButton.keyboardButton=f.getLetterCode("R"),i.addChild(this.rocketMenuButton)),this.game.isMobile){var o=dt.getTexturesByWidth("spr_hideui",12);this.hideShowUIButton=new Us(this,this.stage,i,function(){if(r.cityExtraInfoHidden)r.addGeneralStatistics(),r.addAllMaterialsInfo(),r.cityExtraInfoHidden=!1;else{for(var t=r.cityInfo.children.length-1;0<=t;){var e=r.cityInfo.children[t];e!=i&&r.cityInfo.removeChild(e),--t}null!=r.materialsInfo&&(r.materialsInfoScrollY=r.materialsInfo.scrollable.scrollPosition.y),r.materialsInfo=null,r.workerAssignButton=null,r.woodAmountDisplay=null,r.stoneAmountDisplay=null,r.cityExtraInfoHidden=!0}r.hideShowUIButton.updateTexture(o[r.cityExtraInfoHidden?0:1])},o[this.cityExtraInfoHidden?0:1],null,function(){r.cityExtraInfoHidden?r.tooltip.setText(r.hideShowUIButton,Tr.lo("show_extra_info")):r.tooltip.setText(r.hideShowUIButton,Tr.lo("hide_extra_info"))},null,this.miniButtonToUse(),this.game.isMobile?4:1),i.addChild(this.hideShowUIButton)}},notifyInPanel:function(t,e,i){this.addNotifications(t);var n=this.notificationScrollableOuter.scrollable.stage,r=new ps(this,n,this.notificationInner,null,null,null,null,{top:3,right:3,bottom:1,left:3});r.addChild(new ao(r,n,e)),this.notificationInner.addChild(r),this.notificationPanel.updatePosition(new vr(this.game.rect.width/2|0,0)),this.currentNotificationRelatedTo=i},addNotifications:function(t){if(null==this.notificationPanel){var e=new Ys(dt.getTexture("spr_9p_window"),1,4,4);this.notificationPanel=new ps(this,this.notificationStage,null,new vr(0,0),new br(.5,0),null,e),this.notificationPanel.direction=Ps.Vertical,this.notificationScrollableOuter=new fs(500,100,this,this.notificationStage,this.notificationPanel,null,null,null,null,null,0),this.notificationPanel.addChild(this.notificationScrollableOuter),this.notificationInner=new ps(this,this.stage,this.notificationScrollableOuter,new vr(0,0),null,null,null,{top:0,right:0,bottom:0,left:0}),this.notificationInner.direction=Ps.Vertical,this.notificationScrollableOuter.setInnerContainer(this.notificationInner),this.addNotificationTitle(t)}},addNotificationTitle:function(t,e,i){null==t&&(t="");var n=this,r=this.notificationStage,s=this.notificationPanel,o=new Ms(this.notificationInner,new vr(0,0));this.notificationInner.addChild(o);var a=new Es(this,r,s);if(a.fillSecondarySize=!0,a.setSizeCallback(function(){o.rect.width=a.rect.width-6,o.updateSize()}),a.addChild(new Ms(a,new vr(3,0))),null!=i){var l=new PIXI.Sprite(i);a.addChild(new Ms(a,new vr(1,0))),a.addChild(new ds(s,this.windowStage,l,{top:4,bottom:0,left:0,right:0})),a.addChild(new Ms(a,new vr(2,0)))}var h=new ao(a,r,t,e,"Arial16",{left:0,top:3,right:0,bottom:-3},null,!0);a.addChild(h),a.addChild(new As(a));var u=new Us(this,r,a,function(){null!=n.notificationPanel&&(n.notificationPanel.destroy(),n.notificationPanel=null)},dt.getTexture("spr_icon_close"),null,null,null,this.game.isMobile?"spr_button_windowheader_mobi":"spr_button_windowheader",this.game.isMobile?2:1);return a.addChild(u),s.insertChild(a,0),this.notificationTitleElem=h,this.game.isMobile&&(this.notificationInner.padding.top=0),h},removeNotifyPanel:function(){null!=this.notificationPanel&&(this.notificationPanel.destroy(),this.notificationPanel=null)},addGeneralStatistics:function(){var o=this,t=new ps(this,this.stage,this.cityInfo,null);t.alignment=Cs.RightOrBottom,t.direction=Ps.Vertical,this.cityInfo.addChild(t);var a=this.city.simulation.happiness,e=new ps(this,this.stage,t);e.fillSecondarySize=!0,t.addChild(e);var i=this.createInfoButton(function(){"popInfo"==o.windowRelatedTo?o.closeWindow():(o.createWindow("popInfo"),$s.create(o.city,o,o.innerWindowStage,o.windowInner))},function(){var t=lt.count(o.city.simulation.citizens,function(t){return t.get_age()<=16});o.tooltip.setText(Tr.lo("population"),Tr.lo("total_amount_of_citizens")+"\n"+(1==t?Tr.lo("is_one_child"):Tr.lo("are_n_children",[t]))+"\n"+(1950<=o.city.simulation.citizens.length?Tr.lo("tap_for_age_distribution_or_pop_limit"):Tr.lo("tap_for_age_distribution"))+o.game.textHelper.ifNotMobile("\n\n"+Tr.lo("follow_hint")))},function(){return Y.string(0|o.city.simulation.citizens.length)},"spr_population",e,23,function(){return"popInfo"==o.windowRelatedTo});i.keyboardButton=f.getLetterCode("C"),e.addChild(i);var l=null;(l=this.createInfoButton(function(){if("happinessWindow"==o.windowRelatedTo)o.closeWindow();else{var t=function(){o.createWindow("happinessWindow"),Os.create(o.city,o,o.innerWindowStage,o.windowInner)};t(),o.city.gui.clearWindowStack(),o.city.gui.addWindowToStack(t)}},function(){var t="",e="",i="";0<a.foodShortageUnhappiness&&(e+=Tr.lo("food_shortage_unhappiness")+" "+(0|a.foodShortageUnhappiness)+"\n"),0<a.foodRationingUnhappiness&&(e+=Tr.lo("food_rationing_unhappiness")+" "+Math.ceil(a.foodRationingUnhappiness)+"\n"),0<a.overtimeUnhappinessShown&&(e+=Tr.lo("mandatory_overtime_unhappiness")+" "+Math.ceil(a.overtimeUnhappinessShown)+"\n"),0!=a.enthusiasmHappiness&&(t+=Tr.lo("new_city_enthousiasm")+" "+(0|a.enthusiasmHappiness)+"\n");for(var n=0,r=a.happinessBoosts;n<r.length;){var s=r[n];++n,i+=s.text+": "+(0|s.boost)+"\n"}o.tooltip.setText(l,Tr.lo("happiness_explainer")+"\n"+Tr.lo("home_happiness")+" "+(0|a.homeHappiness)+"\n"+Tr.lo("sense_of_purpose")+" "+(0|a.purposeHappiness)+"\n"+Tr.lo("entertainment_happiness")+" "+(0|a.entertainmentHappiness)+"\n"+Tr.lo("education_happiness")+" "+(0|a.schoolHappiness)+"\n"+Tr.lo("medical_happiness")+" "+(0|a.medicalHappiness)+"\n"+e+i+t+"\n"+Tr.lo("citizens_work_at_speed",[Pr.floatFormat(Math,a.actionSpeedModifier,2)]),Tr.lo("happiness"))},function(){return 99.99<=o.city.simulation.happiness.happiness?124.99<=o.city.simulation.happiness.happiness?"xD":":D":Y.string(0|o.city.simulation.happiness.happiness)},"spr_happiness",e,26,function(){return"happinessWindow"==o.windowRelatedTo})).keyboardButton=f.getLetterCode("H"),l.container.fillPrimarySize=!0,e.addChild(l);var n=this.city.simulation.stats,r=null;r=this.createInfoButton(function(){if("houseInfo"==o.windowRelatedTo)o.closeWindow();else{var t=null;(t=function(){o.createWindow("houseInfo"),Ns.create(o.city,o,o.innerWindowStage,o.windowInner),o.city.gui.clearWindowStack(),o.city.gui.addWindowToStack(t)})()}},function(){o.tooltip.setText(r,Ns.getHousingHelpText(n),Tr.lo("housing"))},function(){return n.peopleWithHome>=n.people?""+(n.houseCapacity-n.peopleWithHome):"[red]-"+(n.people-n.peopleWithHome)},"spr_housing",t,20,function(){return"houseInfo"==o.windowRelatedTo}),t.addChild(r);var s=this.city.simulation.stats;this.workerAssignButton=this.createInfoButton(function(){"workersAssign"==o.windowRelatedTo?o.closeWindow():(o.createWindow("workersAssign"),go.create(o.city,o,o.innerWindowStage,o.windowInner))},function(){o.tooltip.setText(Tr.lo("work"),Tr.lo("work_tooltip",[s.jobs]))},function(){return s.peopleWithAJob+"/"+s.laborForce},"spr_work",t,20,function(){return"workersAssign"==o.windowRelatedTo}),this.workerAssignButton.keyboardButton=f.getLetterCode("W"),t.addChild(this.workerAssignButton)},addAllMaterialsInfo:function(){function i(t,e){null==e&&(e=t);var i="",n=Math.floor(s.city.simulation.stats.materialUsed[ct.findMaterialIndex(t)][1]),r=Math.floor(s.city.simulation.stats.materialUsed[ct.findMaterialIndex(t)][0]);return 0==n&&0==r||"food"==t||(i="knowledge"==t?"\n"+Tr.lo("operating_cost",[n,e,r]):"\n"+Tr.lo("factory_operating_cost",[n,e,r])),"\n"+Tr.lo("citizen_production_cost",[Math.floor(s.city.simulation.stats.materialProduction[ct.findMaterialIndex(t)][1]),e,Math.floor(s.city.simulation.stats.materialProduction[ct.findMaterialIndex(t)][0])])+i}var s=this;this.materialsInfo=new fs(1e3,this.city.game.rect.height,this,this.stage,this.cityInfo,new vr(0,0),new br(0,0),null,null,null,0),this.materialsInfo.disableScrollbar=!0,this.materialsInfoInner=new ps(this,this.stage,this.cityInfo,new vr(0,0),new br(0,0)),this.materialsInfo.setInnerContainer(this.materialsInfoInner),this.materialsInfoInner.direction=Ps.Vertical,this.cityInfo.addChild(this.materialsInfo);this.city.simulation.stats.materialUsed,this.addMaterialInfo("food",Or.firstToUpper(Tr.lo("food")),function(){var t="",e=s.city.simulation.eating;return.1<e.foodShortage&&(t="\n"+Tr.lo("not_enough_food",[Math.ceil(e.foodShortage)])),e.getFoodText()+i("food",Tr.lo("food"))+t},function(){return Math.floor(s.city.materials.food)},"spr_resource_food",function(){return 0<s.city.simulation.eating.foodShortage},"food");this.woodAmountDisplay=this.addMaterialInfo("wood",Or.firstToUpper(Tr.lo("wood")),function(){return Tr.lo("wood_use")+i("wood",Tr.lo("wood"))},function(){return Math.floor(s.city.materials.wood)},"spr_resource_wood",null,"wood"),this.stoneAmountDisplay=this.addMaterialInfo("stone",Or.firstToUpper(Tr.lo("stone")),function(){return Tr.lo("stone_use")+i("stone",Tr.lo("stone"))},function(){return Math.floor(s.city.materials.stone)},"spr_resource_stone",null,"stone"),this.addMaterialInfo("knowledge",Or.firstToUpper(Tr.lo("knowledge")),function(){return Tr.lo("knowledge_use")+i("knowledge",Tr.lo("knowledge"))},function(){return Math.floor(s.city.materials.knowledge)},"spr_resource_knowledge",null,"knowledge"),this.addMaterialInfo("machineParts",Or.firstToUpper(Tr.lo("machine_parts")),function(){return Tr.lo("machine_parts_use")+i("machineParts",Tr.lo("machine_parts"))},function(){return Math.floor(s.city.materials.machineParts)},"spr_resource_machineparts",null,"machineParts"),this.addMaterialInfo("refinedMetal",Or.firstToUpper(Tr.lo("refined_metals")),function(){return Tr.lo("refined_metals_use")+i("refinedMetal",Tr.lo("refined_metals"))},function(){return Math.floor(s.city.materials.refinedMetal)},"spr_resource_refinedmetal",null,"refinedMetal"),this.addMaterialInfo("computerChips",Or.firstToUpper(Tr.lo("computer_chips")),function(){return Tr.lo("computer_chips_use")+i("computerChips",Tr.lo("computer_chips"))},function(){return Math.floor(s.city.materials.computerChips)},"spr_resource_computerchips",null,"computerChips"),this.city.progress.unlocks.unlockedMaterial("graphene")&&this.addMaterialInfo("graphene",Or.firstToUpper(Tr.lo("graphene")),function(){return Tr.lo("graphene_use")+i("graphene",Tr.lo("graphene"))},function(){return Math.floor(s.city.materials.graphene)},"spr_resource_graphene",null,"graphene"),this.city.progress.unlocks.unlockedMaterial("rocketFuel")&&this.addMaterialInfo("rocketFuel",Or.firstToUpper(Tr.lo("rocketFuel")),function(){return Tr.lo("rocketFuel_use")+i("rocketFuel",Tr.lo("rocketFuel"))},function(){return Math.floor(s.city.materials.rocketFuel)},"spr_resource_rocketfuel",null,"rocketFuel");for(var t=0,e=ct.modMaterials;t<e.length;){var n=[e[t]];++t,this.addMaterialInfo(n[0].variableName,n[0].displayName,function(t){return function(){return t[0].description+t[0].tooltipExt()+i(t[0].variableName,t[0].displayName.toLowerCase())}}(n),function(t){return function(){return Math.floor(s.city.materials[t[0].variableName])}}(n),"spr_resource_"+n[0].variableName.toLowerCase(),null,n[0].variableName)}this.materialsInfo.setScrollPosition(new vr(0,this.materialsInfoScrollY))},resize:function(){p.prototype.resize.call(this),null!=this.persistentFullVersionUpsell&&this.persistentFullVersionUpsell.resize(),this.buildingButtons.resize(),this.cityInfo.updatePosition(new vr(this.game.rect.width-this.safeAreaRight,this.game.rect.height-this.safeAreaBottom)),null!=this.notificationPanel&&this.notificationPanel.updatePosition(new vr(this.game.rect.width/2|0,0)),null!=this.resumeGameControl&&this.resumeGameControl.updatePosition(),null!=this.materialsInfo&&(this.materialsInfo.scrollable.maxHeight=this.game.rect.height-this.safeAreaBottom,this.materialsInfo.maxHeight=this.game.rect.height-this.safeAreaBottom,this.materialsInfo.scrollable.updateSize())},update:function(t){this.buildingButtons.update(t),this.cityInfo.update(),null!=this.notificationPanel&&this.notificationPanel.update(),null!=this.resumeGameControl&&this.resumeGameControl.update(t),p.prototype.update.call(this,t);this.window},triggerPremiumUpsellExperienceIfDesired:function(t,e){B.get_isCoolMathWithCrossPromotion()?this.triggerPremiumUpsellExperience(t,e):null!=e&&e()},triggerPremiumUpsellExperience:function(t,e){this.createWindow("premiumUpsell",dt.getTexture("spr_9p_window_purple"),40,4),Qs.create(this.city,this,this.innerWindowStage,this.windowInner,t,e)},onEscapePressWithoutWindow:function(){Bs.create(this,this.city)},handleMouse:function(t){if(null!=this.resumeGameControl&&this.resumeGameControl.handleMouse(t))return!0;for(var e=0,i=this.overlayElements;e<i.length;){var n=i[e];if(++e,n.handleMouse(t))return!0}return!(null==this.notificationPanel||!this.notificationPanel.handleMouse(t))||(!!p.prototype.handleMouse.call(this,t)||(!!this.buildingButtons.handleMouse(t)||(!!this.cityInfo.handleMouse(t)||!(null==this.persistentFullVersionUpsell||!this.persistentFullVersionUpsell.handleMouse(t)))))},addMaterialInfo:function(t,e,i,n,r,s,a){var l=this;null==s&&(s=function(){return!1});var h=this.createInfoBoxForMaterialsDynamicTooltip(t,e,i,function(){var t=Y.string(n());return null!=s&&s()?"[red]"+t:t},r,this.materialsInfoInner,42,this.materialsInfo.scrollable.stage),u=0,c=0;return h.onUpdate=function(){var t=l.city.simulation.stats.materialUsed[ct.findMaterialIndex(a)][1]+.2<l.city.simulation.stats.materialProduction[ct.findMaterialIndex(a)][1]||l.city.simulation.stats.materialUsed[ct.findMaterialIndex(a)][1]<.2&&"food"!=a||1+((0|l.city.simulation.time.timeSinceStart)/1440|0)<=5;if(!t){for(var e=0,i=0,n=0;n<2&&l.city.simulation.festivalManager.wasFestivalOnDay[1+n];)++n;for(e+=l.city.simulation.stats.materialUsed[ct.findMaterialIndex(a)][1+n],i+=l.city.simulation.stats.materialProduction[ct.findMaterialIndex(a)][1+n];n<2&&l.city.simulation.festivalManager.wasFestivalOnDay[2+n];)++n;for(e+=l.city.simulation.stats.materialUsed[ct.findMaterialIndex(a)][2+n],i+=l.city.simulation.stats.materialProduction[ct.findMaterialIndex(a)][2+n];n<2&&l.city.simulation.festivalManager.wasFestivalOnDay[3+n];)++n;t=(e+=l.city.simulation.stats.materialUsed[ct.findMaterialIndex(a)][3+n])+.2<=(i+=l.city.simulation.stats.materialProduction[ct.findMaterialIndex(a)][3+n])}if(!t){var r=l.city.simulation.stats.materialProduction[ct.findMaterialIndex(a)][0],s=l.city.simulation.stats.materialUsed[ct.findMaterialIndex(a)][0];10<l.city.simulation.time.timeSinceStart/60%24&&s<r&&(h.hasAdditionalSprite()?r*(1.1+.1*Math.max(0,12-l.city.simulation.time.timeSinceStart/60%24))>s&&(t=!0):t=!0)}var o=l.city.progress.sandbox.unlimitedResources||t||0<u;o&&c<=0?(h.setAdditionalSprite(null),o?u=20:u-=1):(h.setAdditionalSprite(dt.getTexture("spr_resource_downtrend")),o?c-=1:c=20)},h},createInfoBoxForMaterialsDynamicTooltip:function(t,e,i,n,r,s,o,a){null==o&&(o=42);var l,h=this;null==a&&(a=this.stage),(l=new us(this,a,s,function(){h.windowRelatedTo==t?h.closeWindow():(h.createWindow(t,dt.getTexture("spr_9p_window_moreopaque")),wo.create(h.city,h,h.innerWindowStage,h.windowInner,t,e))},function(){return h.windowRelatedTo==t},function(){h.tooltip.setText(l,i(),e)},"spr_transparentbutton_info")).container.fillSecondarySize=!0;var u=new zs(this,a,l.container,function(){return n()},dt.getTexture(r),o,function(){},"none",function(){return h.city.progress.sandbox.unlimitedResources});return u.fillSecondarySize=!0,u.fillPrimarySize=!0,l.container.addChild(u),s.addChild(l),u},createInfoButton:function(t,e,i,n,r,s,o){null==s&&(s=42);var a=new us(this,this.stage,r,t,o,e,"spr_transparentbutton_info");a.container.fillSecondarySize=!0;var l=this.game.isMobile?3:0,h=this.game.isMobile?2:0;return a.container.padding={left:2+l,right:3+l,top:2+l,bottom:l-1},a.container.updateSize(),a.container.addChild(new ds(a.container,this.stage,new PIXI.Sprite(dt.getTexture(n)))),a.container.addChild(new ao(a.container,this.stage,null,i,null,{left:1+h,right:0,top:1,bottom:0},null,!1,!0)),a.container.minWidth=s,a},closeWindow:function(t){null==t&&(t=!1),this.city.pauseGame&&this.pausedForWindow&&(this.city.set_pauseGame(!1),this.pausedForWindow=!1),this.city.pauseGame||-1!=this.city.gui.windowStackMeta.indexOf("GameMenu")&&1!=this.city.gui.windowStackMeta.length||t||Mr.reportStartGameplay(),p.prototype.closeWindow.call(this,t)},pauseForWindow:function(){var t=this.city.pauseGame,e=this.pausedForWindow;this.city.set_pauseGame(!0),!e&&t||(this.pausedForWindow=!0)},activateLoserState:function(){this.cityInfo.clear(),this.buildingButtons.activateLoserState()},showTutorialArrows1:function(){var t=this,e=this.windowOnDestroy,i=!1;this.windowOnDestroy=function(){i=!0,null!=e&&e()},this.overlayElements.push(new Ds(this,this.gameHelpStage,function(){return t.windowInner.children[t.windowInner.children.length-1].children[1]},function(){return!i},ks.Left,180)),this.buildingButtons.showTutorialArrows1(this.overlayElements,function(){return i},this.gameHelpStage)},showTutorialArrowsBuildStoneMine:function(t){var e=this,i=new Ds(this,this.gameHelpStage,function(){return e.woodAmountDisplay},function(){return!!t()&&e.city.materials.wood<4},ks.DownHint,0);i.addText(Tr.lo("see_wood_here")),this.overlayElements.push(i),this.buildingButtons.showTutorialArrows101(this.overlayElements,function(){return 4<=e.city.materials.wood},this.gameHelpStage)},showTutorialArrows2:function(t){function e(){return n&&null==r&&(r=i.window),n=n||Object.prototype.hasOwnProperty.call(i.city.simulation.jobAssigner.priorityJobs.h,"buildings.StoneMine")&&0!=i.city.simulation.jobAssigner.priorityJobs.h["buildings.StoneMine"]}var i=this,n=!1,r=null;this.overlayElements.push(new Ds(this,this.gameHelpStage,function(){return i.hideShowUIButton},function(){return!(!t()||null!=go.tutorialStoneMineUpButton||e())&&i.cityExtraInfoHidden},ks.Down));var s=new Ds(this,this.gameHelpStage,function(){return i.workerAssignButton},function(){return!(!t()||null!=go.tutorialStoneMineUpButton)&&!e()},ks.Down);this.game.isMobile||s.useBigMovement(),this.overlayElements.push(s),this.overlayElements.push(new Ds(this,this.gameHelpStage,function(){return go.tutorialStoneMineUpButton},function(){return null!=go.tutorialStoneMineUpButton&&!e()},ks.Left));var o=new Ds(this,this.gameHelpStage,function(){return i.woodAmountDisplay},function(){return!!e()&&(null==i.window||i.window==r)},ks.DownHint,0);this.game.rect.width<900&&(o.pleaseAlignExtraTextRight=!0),o.addText(Tr.lo("great_gather_stone")),this.overlayElements.push(o),this.buildingButtons.showTutorialArrows2(this.overlayElements,e,this.gameHelpStage,t);function a(){return 6<i.city.materials.stone&&i.city.materials.wood<6&&!lt.exists(i.city.permanents,function(t){return!!t.is(In)&&0<t.workers.length})}function l(){return!!Object.prototype.hasOwnProperty.call(i.city.simulation.jobAssigner.priorityJobs.h,"buildings.StoneMine")&&3<=i.city.simulation.jobAssigner.priorityJobs.h["buildings.StoneMine"]}var h=Tr.lo("you_have_enough_stone"),u=new Ds(this,this.gameHelpStage,function(){return i.hideShowUIButton},function(){return!(null!=go.tutorialStoneMineUpButton||!a())&&i.cityExtraInfoHidden},ks.Down);u.addText(h),this.overlayElements.push(u);var c=new Ds(this,this.gameHelpStage,function(){return i.workerAssignButton},function(){return null==go.tutorialStoneMineUpButton&&a()},ks.Down);c.addText(h),this.overlayElements.push(c);var d=new Ds(this,this.gameHelpStage,function(){return go.tutorialStoneMineDownButton},function(){return!(null==go.tutorialStoneMineDownButton||!a())&&l()},ks.Left);d.addText(Tr.lo("reduce_stone_mining_priority")),this.overlayElements.push(d);var p=new Ds(this,this.gameHelpStage,function(){return go.tutorialWoodCuttersUpButton},function(){return!(null==go.tutorialWoodCuttersUpButton||!a())&&!l()},ks.Left);p.addText(Tr.lo("increase_woodcutting_priority")),this.overlayElements.push(p)},showTutorialArrows3:function(){var t=this,e=!1,i=new Ds(this,this.gameHelpStage,function(){return t.storyHelpButton},function(){return!e&&null==t.window},ks.DownHint,0);i.addText(this.city.game.isMobile?Tr.lo("hint_hint"):Tr.lo("hint_hint_pc")),this.overlayElements.push(i),this.storyHelpButtonOnUse=function(){e=!0,t.storyHelpButtonOnUse=null}},showTutorialArrows4:function(){var t=this;if(0==this.simulationSpeedChosen){var e=!1,i=new Ds(this,this.gameHelpStage,function(){return t.gameSpeedButton},function(){return!e&&null==t.window},ks.DownHint,0);i.addText(Tr.lo("speedup_hint")),this.game.isMobile&&i.addHeaderAndCloseButton(Tr.lo("tip")),this.overlayElements.push(i),this.gameSpeedOnUse=function(){e=!0,t.gameSpeedOnUse=null}}},showTutorialArrowsBoost:function(){var t=this;if(!this.city.simulation.boostManager.boostShownExplainer){var e=new Ds(this,this.gameHelpStage,function(){return t.city.simulation.boostManager.infoButton},function(){return null==t.window},ks.UpHint,0);e.addText(Tr.lo("boost_use_case")+"\n"+Tr.lo("boost_earn_extra_reward")),e.addHeaderAndCloseButton(Tr.lo("tip")),this.overlayElements.push(e),this.city.simulation.boostManager.boostShownExplainer=!0,Rr.setItem("boostShownExplainer","boostShownExplainer",function(){})}},showTutorialArrowsInviteCitizens:function(){this.buildingButtons.showTutorialArrowsInviteCitizens(this.overlayElements,this.gameHelpStage)},showWindowCloseWarning:function(t){null==t&&(t=300);var e=this,i=this.windowOnDestroy,n=!1;return this.windowOnDestroy=function(){n=!0,null!=i&&i()},this.overlayElements.push(new Ds(this,this.gameHelpStage,function(){return e.windowInner.children[e.windowInner.children.length-1].children[1]},function(){return!n},ks.Left,t)),function(){return n}},clearTutorial:function(){for(var t=0,e=this.overlayElements;t<e.length;){var i=e[t];++t,i.destroy()}this.overlayElements=[]},refreshCategoryBuildingsShown:function(){this.buildingButtons.refreshCategoryBuildingsShown()},createResumeGameControl:function(){var t=this;null==this.resumeGameControl&&(this.outerStage.alpha=.3,this.notificationStage.alpha=3.3333333333333335,this.resumeGameControl=new to(this,this.notificationStage,this.city,function(){t.resumeGameControl=null,t.outerStage.alpha=1}))},__class__:os});var as=function(){};(q["gui.ClimateCrisisExplainerWindow"]=as).__name__="gui.ClimateCrisisExplainerWindow",as.create=function(t,e,i,n){t.gui.windowAddTitleText(Tr.lo("climate_crisis_explainer_1")),n.addChild(new ao(n,i,Tr.lo("climate_crisis_explainer_2"),null,"Arial")),n.addChild(new Ms(n,new vr(2,6))),n.addChild(new ao(n,i,Tr.lo("climate_crisis_explainer_3"),null,"Arial15")),n.addChild(new ao(n,i,Tr.lo("climate_crisis_explainer_4"),null,"Arial")),n.addChild(new Ms(n,new vr(2,6))),n.addChild(new ao(n,i,Tr.lo("climate_crisis_explainer_5"),null,"Arial15")),n.addChild(new ao(n,i,Tr.lo("climate_crisis_explainer_6"),null,"Arial")),n.addChild(new Ms(n,new vr(2,6))),n.addChild(new ao(n,i,Tr.lo("climate_crisis_explainer_7"),null,"Arial15")),n.addChild(new ao(n,i,Tr.lo("climate_crisis_explainer_8"),null,"Arial")),n.addChild(new Ms(n,new vr(2,6))),n.addChild(new ao(n,i,Tr.lo("climate_crisis_explainer_9"),null,"Arial15")),n.addChild(new ao(n,i,Tr.lo("climate_crisis_explainer_10"),null,"Arial")),n.addChild(new Ms(n,new vr(2,6))),n.addChild(new ao(n,i,Tr.lo("thanks_signoff"),null,"Arial")),n.addChild(new Ms(n,new vr(2,6))),n.addChild(new ao(n,i,"Florian van Strien",null,"Arial")),n.addChild(new Ms(n,new vr(2,10))),e.windowAddBottomButtons()};var ls=function(t,e,i){this.parent=t,this.rect=new yr(0,0,0,0),this.h=this.get_colorHSV()[0],this.s=this.get_colorHSV()[1],this.v=this.get_colorHSV()[2],this.onColorUpdate=i,this.colorPickSprite=dt.makeSprite("spr_colorcircle"),this.colorPickCircleSprite=dt.makeSprite("spr_colorpicker_circle"),this.colorPickCircleSprite.anchor.set(.5,.5),this.colorPickTriangleSprite=dt.makeSprite("spr_colorpicker_triangle"),this.colorPickTriangleSprite.anchor.set(.5,0),this.graphics=new PIXI.Graphics,A.isMobile&&(this.colorPickSprite.scale.x=.6,this.colorPickSprite.scale.y=.6),e.addChild(this.colorPickSprite),e.addChild(this.colorPickCircleSprite),e.addChild(this.colorPickTriangleSprite),e.addChild(this.graphics),this.rect.width=Math.round(this.colorPickSprite.width+10),this.rect.height=Math.round(this.colorPickSprite.height+10+(A.isMobile?25:40))};(q["gui.ColorPicker"]=ls).__name__="gui.ColorPicker",ls.__interfaces__=[Qr],ls.prototype={get_colorHSV:function(){var t=ls.colorPicked;return gh.toHsv(t)},updateSize:function(){null!=this.parent&&this.parent.updateSize()},updatePosition:function(t){this.rect.x=t.x,this.rect.y=t.y,this.colorPickSprite.position.set(this.rect.x+5,this.rect.y),this.graphics.position.set(this.rect.x,this.rect.y+this.colorPickSprite.height+20),this.updateColorPickerSubSprites(),this.redrawGraphics()},updateColor:function(){var t=[this.h,this.s,this.v];ls.colorPicked=mr.toHexInt(hh.toRgb(t)),this.onColorUpdate(ls.colorPicked),this.redrawGraphics()},updateColorPickerSubSprites:function(){this.colorPickCircleSprite.position.set(this.colorPickSprite.position.x+this.colorPickSprite.width/2+this.s*this.colorPickSprite.width/2*Math.cos(this.h/360*2*Math.PI),this.colorPickSprite.position.y+this.colorPickSprite.width/2+this.s*this.colorPickSprite.width/2*Math.sin(this.h/360*2*Math.PI)),this.colorPickTriangleSprite.position.set(this.colorPickSprite.position.x+this.v*this.colorPickSprite.width,this.colorPickSprite.position.y+this.colorPickSprite.height)},destroy:function(){this.colorPickSprite.destroy(),this.colorPickCircleSprite.destroy(),this.colorPickTriangleSprite.destroy(),this.graphics.destroy()},redrawGraphics:function(){this.graphics.clear(),this.graphics.beginFill(ls.colorPicked),this.graphics.drawRect(0,0,this.colorPickSprite.width+10,A.isMobile?15:30),this.graphics.endFill()},handleMouse:function(t){if(this.rect.contains(t.position)){if(t.claimMouse(this,"",!0,!0,!0)==$.Confirmed){var e=t.position.x-this.colorPickSprite.position.x,i=t.position.y-this.colorPickSprite.position.y;if(i<this.colorPickSprite.width){var n=Math.min(Math.sqrt(Math.pow(e-this.colorPickSprite.width/2,2)+Math.pow(i-this.colorPickSprite.width/2,2))/(this.colorPickSprite.width/2),1),r=Math.atan2(i-this.colorPickSprite.width/2,e-this.colorPickSprite.width/2);this.s=n,this.h=(r+2*Math.PI)/(2*Math.PI)*360%360,this.updateColor(),this.updateColorPickerSubSprites()}if(i>this.colorPickSprite.height-30&&i<this.colorPickSprite.height+12){var s=e/this.colorPickSprite.width;this.v=s<0?0:1<s?1:s,this.updateColor(),this.updateColorPickerSubSprites()}}return!0}return!1},update:function(){},__class__:ls};var hs=function(){};(q["gui.ColorPickerWindow"]=hs).__name__="gui.ColorPickerWindow",hs.createWindow=function(i,n){i.gui.createWindow("colorPicker",null,28);var t=i,e=n;i.gui.addWindowToStack(function(){hs.createWindow(t,e)});var r=Tr.lo("choose_color");i.gui.windowAddTitleText(r,null,dt.getTexture("spr_colorpicker_colorpicked"));var s=new ls(i.gui.windowInner,i.gui.innerWindowStage,function(t){i.gui.windowIconSprite.tint=t});i.gui.windowIconSprite.tint=ls.colorPicked,i.gui.windowInner.addChild(s),i.gui.windowInner.addChild(new Ms(i.gui.windowInner,new vr(2,4))),i.gui.windowAddBottomButtons([{text:Tr.lo("confirm"),action:function(){n(ls.colorPicked),i.gui.goPreviousWindow()}},{text:Tr.lo("color_code"),action:function(){var t=window.prompt(Tr.lo("color_code_enter"));if(null!=t){var e=mr.parse(t);null==e?window.alert(Tr.lo("color_not_parsed")):(n(mr.toHexInt(yh.toRgb(e))),i.gui.goPreviousWindow())}}}])};var us=function(t,e,i,n,r,s,o){null==o&&(o="spr_button"),this.needsAttention=!1,this.highlightPatch=null,ns.call(this,t,e,i,n,r,s),this.buttonTextures=dt.getTextures(o,3),this.buttonPatch=new Ys(this.buttonTextures[0],2,2,2),this.buttonPatch.texture=this.buttonTextures[1],this.buttonPatch.updateTextures(!1),this.buttonPatch.texture=this.buttonTextures[2],this.buttonPatch.updateTextures(!1),this.buttonPatch.setTextureSet(0),e.addChild(this.buttonPatch),this.container=new ps(t,e,this),this.rect=new yr(0,0,2,2)};(q["gui.ContainerButton"]=us).__name__="gui.ContainerButton",us.__super__=ns,us.prototype=e(ns.prototype,{setNeedsAttention:function(t){null==t&&(t=!1),this.needsAttention=t,this.updateNeedsAttention()},updateNeedsAttention:function(){null!=this.buttonPatch&&(this.needsAttention&&null==this.highlightPatch&&(this.highlightPatch=new Ys(dt.getTexture("spr_greenoutline"),2,this.buttonPatch.npWidth,this.buttonPatch.npHeight),this.stage.addChild(this.highlightPatch),this.highlightPatch.position.set(this.rect.x,this.rect.y),this.highlightPatch.updateSprites()),null!=this.highlightPatch&&(this.needsAttention&&0==this.buttonPatch.currentTextureSet?this.highlightPatch.alpha=(Math.sin(this.gui.guiTimer/10)+1)/2:this.highlightPatch.alpha=0))},updatePosition:function(t){ns.prototype.updatePosition.call(this,t),this.buttonPatch.position.set(t.x,t.y),this.buttonPatch.updateSprites(),null!=this.highlightPatch&&(this.highlightPatch.position.set(t.x,t.y),this.highlightPatch.updateSprites()),this.container.updatePosition(t)},updateSize:function(){null!=this.container&&(this.rect.width=this.container.rect.width,this.rect.height=this.container.rect.height,this.updateSizeDisplay(),null!=this.parent&&this.parent.updateSize(),this.container.minWidth=this.container.baseWidth)},updateSizeDisplay:function(){null!=this.container&&(this.buttonPatch.npWidth=this.rect.width,this.buttonPatch.npHeight=this.rect.height,this.buttonPatch.updateSprites(),null!=this.highlightPatch&&(this.highlightPatch.npWidth=this.rect.width,this.highlightPatch.npHeight=this.rect.height,this.highlightPatch.updateSprites()))},handleMouse:function(t){var e=this;return ns.prototype.doHandleMouse.call(this,t,function(){e.buttonPatch.setTextureSet(1)},function(){e.buttonPatch.setTextureSet(2)})},update:function(){this.container.update(),this.mouseOut&&this.buttonPatch.setTextureSet(0),this.isActive()&&this.buttonPatch.setTextureSet(2),this.updateNeedsAttention(),ns.prototype.update.call(this)},destroy:function(){ns.prototype.destroy.call(this),this.container.destroy(),this.buttonPatch.destroy(),null!=this.highlightPatch&&this.highlightPatch.destroy()},__class__:us});function cs(t,e,i,n,r,s,o,a,l,h){null==l&&(l=16777215),null==a&&(a=10526880),null==o&&(o="spr_button"),this.progressAmount=0,us.call(this,t,e,i,n,r,s,o),this.graphics=new PIXI.Graphics(!1),e.addChild(this.graphics),this.backColor=a,this.frontColor=l,this.autoSetProgress=h}(q["gui.ContainerButtonWithProgress"]=cs).__name__="gui.ContainerButtonWithProgress",cs.__super__=us,cs.prototype=e(us.prototype,{update:function(){us.prototype.update.call(this),null!=this.autoSetProgress&&this.setProgress(this.autoSetProgress())},updateProgressDisplay:function(){if(this.progressAmount<0)this.graphics.clear();else{var t=(i=this.rect).x,e=i.y;this.graphics.position.x=t;var i;t=(i=this.rect).x,e=i.y;this.graphics.position.y=e,this.graphics.clear().beginFill(this.backColor,1).drawRect(1,1,this.rect.width-2,this.rect.height-2).endFill().beginFill(this.frontColor,1).drawRect(1,1,Math.round((this.rect.width-2)*this.progressAmount),this.rect.height-2).endFill()}},updatePosition:function(t){us.prototype.updatePosition.call(this,t),this.updateProgressDisplay()},updateSizeDisplay:function(){us.prototype.updateSizeDisplay.call(this),this.updateProgressDisplay()},setProgress:function(t){this.progressAmount=t,this.updateProgressDisplay()},destroy:function(){us.prototype.destroy.call(this),this.graphics.destroy()},__class__:cs});var ds=function(t,e,i,n,r,s){this.container=i,this.stage=e,this.updateFunction=r,this.handleMouseFunction=s,e.addChild(i),this.rect=new yr(0,0,0,0),null==n&&(n={left:0,top:0,right:0,bottom:0}),this.padding=n,this.updateSize(),this.parent=t};(q["gui.ContainerHolder"]=ds).__name__="gui.ContainerHolder",ds.__interfaces__=[Qr],ds.prototype={updateSize:function(){var t=this.container;this.container instanceof Hs||this.container instanceof Xs?this.rect.width=Math.round(t.displayWidth):this.rect.width=Math.round(this.container.width),this.rect.height=Math.round(this.container.height),this.afterSizeUpdate()},afterSizeUpdate:function(){this.rect.width+=this.padding.left+this.padding.right,this.rect.height+=this.padding.top+this.padding.bottom,null!=this.parent&&this.parent.updateSize()},updatePosition:function(t){this.rect.x=t.x,this.rect.y=t.y,this.container.position.x=t.x+this.padding.left,this.container.position.y=t.y+this.padding.top},handleMouse:function(t){return null!=this.handleMouseFunction&&this.handleMouseFunction(t)},update:function(){null!=this.updateFunction&&this.updateFunction()},destroy:function(){this.container.destroy({children:!0})},__class__:ds};var ps=function(t,e,i,n,r,s,o,a){this.neverDownsize=!1,this.minHeight=0,this.minWidth=0,this.fillPrimarySize=!1,this.fillSecondarySize=!1,this.direction=Ps.Horizontal,this.alignment=Cs.LeftOrTop,this.parent=i,this.stage=e,this.gui=t,this.children=null==s?[]:s,this.background=o,null==a&&(a={top:0,right:0,bottom:0,left:0}),this.padding=a,null!=o&&e.addChild(o),this.rect=new yr(0,0,0,0),this.origin=null==r?new br(0,0):r,null==n&&(n=new vr(0,0)),this.updatePosition(n),this.updateSize()};(q["gui.GUIContainer"]=ps).__name__="gui.GUIContainer",ps.__interfaces__=[Qr],ps.prototype={handleMouse:function(t){for(var e=0,i=this.children;e<i.length;){var n=i[e];if(++e,n.handleMouse(t))return!0}return!(null==this.background||!this.rect.contains(t.position))&&(t.claimMouse(this),!0)},update:function(){null!=this.onUpdate&&this.onUpdate();for(var t=0,e=this.children;t<e.length;){var i=e[t];++t,i.update()}},updateSize:function(){this.updateSizeNonRecursive(),null!=this.parent?this.parent.updateSize():this.updateChildrenPosition()},updateSizeNonRecursive:function(){this.rect.width=0;for(var t=this.rect.height=0,e=this.children;t<e.length;){var i=e[t];if(++t,!(i instanceof As))if(i instanceof ps){var n=i;if(this.direction==Ps.Horizontal){this.rect.width+=n.originalRectWidth;var r=this.rect.height,s=n.originalRectHeight;this.rect.height=r<s?s:r}else{var o=this.rect.width,a=n.originalRectWidth;this.rect.width=o<a?a:o,this.rect.height+=n.originalRectHeight}}else if(i instanceof us&&i.container.fillPrimarySize){var l=i.container;if(this.direction==Ps.Horizontal){this.rect.width+=l.originalRectWidth;var h=this.rect.height,u=l.originalRectHeight;this.rect.height=h<u?u:h}else{var c=this.rect.width,d=l.originalRectWidth;this.rect.width=c<d?d:c,this.rect.height+=l.originalRectHeight}}else if(this.direction==Ps.Horizontal){this.rect.width+=i.rect.width;var p=this.rect.height,f=i.rect.height;this.rect.height=p<f?f:p}else{var g=this.rect.width,m=i.rect.width;this.rect.width=g<m?m:g,this.rect.height+=i.rect.height}}this.neverDownsize&&(this.rect.width>this.minWidth&&(this.minWidth=this.rect.width),this.rect.height>this.minHeight&&(this.minHeight=this.rect.height)),this.rect.width<this.minWidth&&(this.rect.width=this.minWidth),this.rect.height<this.minHeight&&(this.rect.height=this.minHeight),this.baseWidth=this.rect.width,this.baseHeight=this.rect.height;for(t=0,e=this.children;t<e.length;){i=e[t];if(++t,i instanceof As){var y=i;switch(this.direction._hx_index){case 0:this.rect.width+=y.minFill;break;case 1:this.rect.height+=y.minFill}}}this.rect.width+=this.padding.left+this.padding.right,this.rect.height+=this.padding.top+this.padding.bottom,this.originalRectWidth=this.rect.width,this.originalRectHeight=this.rect.height,this.nonBaseWidth=this.rect.width-this.baseWidth,this.nonBaseHeight=this.rect.height-this.baseHeight},updateBackgroundSize:function(){if(null!=this.background){var t=this.background.npWidth,e=this.background.npHeight;this.background.npWidth=this.rect.width,this.background.npHeight=this.rect.height,null!=this.background&&(this.background.position.x=this.rect.x,this.background.position.y=this.rect.y,this.background.updateSprites()),t==this.background.npWidth&&e==this.background.npHeight||this.background.updateSprites()}},updatePosition:function(t){this.position=t,this.updateChildrenPosition(),null!=this.background&&(this.background.position.x=this.rect.x,this.background.position.y=this.rect.y,this.background.updateSprites())},updateChildrenPosition:function(){var t=this.rect,e=this.position,i=this.origin.x*this.rect.width|0,n=this.origin.y*this.rect.height|0,r=e.x-i,s=e.y-n,o=(t.x=r,t.y=s,0),a=0;if(this.rect.width>this.originalRectWidth||this.rect.height>this.originalRectHeight){for(var l=0,h=0,u=this.children;h<u.length;){var c=u[h];if(++h,c instanceof ps&&c.fillPrimarySize){var d=c;switch(++a,this.direction._hx_index){case 0:l+=d.originalRectWidth;break;case 1:l+=d.originalRectHeight}}else if(c instanceof us&&c.container.fillPrimarySize){var p=c.container;switch(++a,this.direction._hx_index){case 0:l+=p.originalRectWidth;break;case 1:l+=p.originalRectHeight}}else switch(this.direction._hx_index){case 0:l+=c.rect.width;break;case 1:l+=c.rect.height}}if(0<=a)switch(this.direction._hx_index){case 0:l-=this.nonBaseWidth,o=this.rect.width-l;break;case 1:l-=this.nonBaseHeight,o=this.rect.height-l}}var f=this.rect.width-this.padding.left-this.padding.right,g=this.rect.height-this.padding.top-this.padding.bottom;for(h=0,u=this.children;h<u.length;){c=u[h];if(++h,c instanceof As)switch(this.direction._hx_index){case 0:c.rect.width=this.rect.width-this.padding.left-this.padding.right-this.baseWidth;break;case 1:c.rect.height=this.rect.height-this.padding.top-this.padding.bottom-this.baseHeight}else if(c instanceof us||c instanceof ss){var m=c;if(m.container.fillSecondarySize&&(this.direction==Ps.Horizontal?(c.rect.height=g,m.container.rect.height=g):(c.rect.width=f,m.container.rect.width=f)),m.container.fillPrimarySize){var y=o/a|0;switch(this.direction._hx_index){case 0:c.rect.width=m.container.originalRectWidth+y;break;case 1:c.rect.height=m.container.originalRectHeight+y}o-=y,--a}m.updateSizeDisplay()}else if(c instanceof ps){if((d=c).fillSecondarySize&&(this.direction==Ps.Horizontal?c.rect.height=g:c.rect.width=f),d.fillPrimarySize){var _=o/a|0;switch(this.direction._hx_index){case 0:c.rect.width=d.originalRectWidth+_;break;case 1:c.rect.height=d.originalRectHeight+_}o-=_,--a}}}var v=this.rect.x+this.padding.left,b=this.rect.y+this.padding.top;switch(this.direction._hx_index){case 0:for(h=0,u=this.children;h<u.length;){c=u[h];if(++h,c instanceof ps)switch((d=c).alignment._hx_index){case 0:c.updatePosition(new vr(v,b));break;case 1:c.updatePosition(new vr(v,b+((this.rect.height-this.padding.top-this.padding.bottom-c.rect.height)/2|0)));break;case 2:c.updatePosition(new vr(v,this.rect.get_y2()-this.padding.bottom-c.rect.height))}else c.updatePosition(new vr(v,b));v+=c.rect.width}break;case 1:for(h=0,u=this.children;h<u.length;){c=u[h];if(++h,c instanceof ps)switch((d=c).alignment._hx_index){case 0:c.updatePosition(new vr(v,b));break;case 1:c.updatePosition(new vr(v+((this.rect.width-this.padding.left-this.padding.right-c.rect.width)/2|0),b));break;case 2:c.updatePosition(new vr(this.rect.get_x2()-c.rect.width-this.padding.right,b))}else c.updatePosition(new vr(v,b));b+=c.rect.height}}this.updateBackgroundSize()},addChild:function(t){return this.children.push(t),this.updateSize(),t},addChildWithoutSizeUpdate:function(t){return this.children.push(t),t},insertChild:function(t,e){return this.children.splice(e,0,t),this.updateSize(),t},removeChild:function(t,e){null==e&&(e=!0),t.destroy(),at.remove(this.children,t),e&&this.updateSize()},clear:function(){lt.iter(this.children,function(t){t.destroy()}),this.children=[],this.updateSize()},destroy:function(){null!=this.onDestroy&&this.onDestroy(),lt.iter(this.children,function(t){t.destroy()}),null!=this.background&&this.background.destroy()},__class__:ps};var fs=function(t,e,i,n,r,s,o,a,l,h,u){null==u&&(u=1),this.disableScrollbar=!1,this.setScrollPositionNextUpdate=null,this.extraPadding=1,this.scrollable=null,ps.call(this,i,n,r,s,o,a,l,h),this.maxWidthWithoutScrollbar=t,this.maxHeight=e,this.scrollbar=null,this.extraPadding=u};(q["gui.ContainerWithScrollbar"]=fs).__name__="gui.ContainerWithScrollbar",fs.__super__=ps,fs.prototype=e(ps.prototype,{setInnerContainer:function(t){this.clear();var e=new ps(this.gui,this.stage,this,null,null,null,null,{top:this.extraPadding,right:this.extraPadding,bottom:this.extraPadding,left:this.extraPadding});this.addChild(e),this.scrollable=new Zr(this.gui.game,this.stage,e,new vr(0,0),this.maxWidthWithoutScrollbar,this.maxHeight,new br(0,0)),this.innerContainer=t,this.innerContainer.parent=this.scrollable,this.scrollable.setChild(this.innerContainer),e.addChild(this.scrollable)},addScrollBar:function(){this.disableScrollbar||(this.scrollbar=new io(this,this.stage,this.scrollable),this.addChild(this.scrollbar))},setScrollPosition:function(t){null!=this.scrollable&&this.scrollable.updateScrollPosition(t),null!=this.scrollbar&&this.scrollbar.redraw()},forceSetScrollPosition:function(t){this.setScrollPosition(new vr(t.x,t.y)),this.setScrollPositionNextUpdate=t},update:function(){ps.prototype.update.call(this),null!=this.setScrollPositionNextUpdate&&(this.setScrollPosition(this.setScrollPositionNextUpdate),this.setScrollPositionNextUpdate=null)},updateSize:function(){null!=this.scrollable&&(null!=this.scrollbar?this.scrollable.rect.height>=this.scrollable.get_innerHeight()&&(this.removeChild(this.scrollbar,!1),this.scrollbar=null):null==this.scrollbar&&this.scrollable.rect.height<this.scrollable.get_innerHeight()&&this.addScrollBar()),null!=this.scrollbar&&null!=this.scrollable&&(this.scrollbar.rect.height=this.scrollable.rect.height+2*this.extraPadding),ps.prototype.updateSize.call(this)},__class__:fs});var gs=function(){};(q["gui.CreateBuildingUpgrades"]=gs).__name__="gui.CreateBuildingUpgrades",gs.upgradeAll=function(t,e,i,n,r){for(var s=0,o=t.permanents;s<o.length;){var a=o[s];if(++s,a.isBuilding){var l=a;Ko.getClass(l)==Ko.getClass(e)&&!gr.any(l.upgrades,function(t){return Ko.getClass(t)==i})&&Ko.getClass(l.buildingMode)!=i&&t.materials.canAfford(n)&&(t.materials.remove(n),r(l))}}},gs.getUpgradeAllNumberAndCanAfford=function(t,e,i,n){for(var r=t.materials.copy(),s=0,o=!0,a=n.copy(),l=a.knowledge=0,h=t.permanents;l<h.length;){var u=h[l];if(++l,u.isBuilding){var c=u;Ko.getClass(c)==Ko.getClass(e)&&(gr.any(c.upgrades,function(t){return Ko.getClass(t)==i})||(r.canAfford(a)?(r.remove(a),++s):o=!1))}}return o||0!=s||(s=1),{number:s,canAffordAll:o}},gs.setUpgradeAllDisplay=function(t,e,i,n,r,s,o){null==o&&(o=!1);var a=gs.getUpgradeAllNumberAndCanAfford(t,e,n,r),l=i.displayWidth;if(a.number<=1)i.setBeforeKnowledgeText(0==a.number?Tr.lo("per_building"):o?Tr.lo("for_one_building"):Tr.lo("for_this_building")),i.setCost(r),l!=i.displayWidth&&s.updateSize();else{i.setBeforeKnowledgeText(a.canAffordAll?Tr.lo("for_all_buildings"):Tr.lo("for_n_buildings",[a.number]));var h=r.copy();h.multiply(a.number),h.knowledge=r.knowledge,i.setCost(h),l!=i.displayWidth&&s.updateSize()}},gs.addUpgradeButton=function(t,e,i,n,r,s,o,a){null==a&&(a=!1),null==o&&(o=!1);var l=t.gui,h=dt.buildingUpgradesInfo,u=i.__name__,c=h.h[u],d=L.fromBuildingUpgradesInfo(c);t.progress.unlocks.getUnlockState(i)==$a.Researched&&(d.knowledge=0);var p=gr.any(e.upgrades,function(t){return Ko.getClass(t)==i})||null!=e.buildingMode&&Ko.getClass(e.buildingMode)==i,f=p;o&&(p=0==gs.getUpgradeAllNumberAndCanAfford(t,e,i,d).number);if(!p||!a){var g=po.createActivatableButton(l,p,function(){t.materials.canAfford(d)&&(null!=s&&R.get().playSound(s),f||(t.materials.remove(d),n(e)),t.simulation.houseAssigner.shouldUpdateHouses=!0,t.progress.unlocks.research(i),d.knowledge=0,po.hasMultiUpgradeModeOn&&gs.upgradeAll(t,e,i,d,n),t.gui.reloadWindow())},c.name,c.description);null!=g.button&&null!=s&&(g.button.buttonSound=null);var m=g.container;if(null!=g.button){h=l.currentUpgradeButtons;var y=i.__name__,_=g.button;h.h[y]=_}if(p){if(!o){var v=lt.find(e.upgrades,function(t){return Ko.getClass(t)==i});if(null==v&&(v=e.buildingMode),r||1<v.textures.length){var b=new ps(l,l.innerWindowStage,m);if(r&&(m.padding.bottom+=1,b.addChild(new oo(l,l.innerWindowStage,m,function(){v.destroy(),at.remove(e.upgrades,v),t.simulation.houseAssigner.shouldUpdateHouses=!0,t.gui.reloadWindow()},Tr.lo("remove"))),b.addChild(new Ms(m,new vr(2,1)))),1<v.textures.length){var w=null;w=new oo(l,l.innerWindowStage,m,function(){v.changeAppearance()},Tr.lo("change_variant"),null,function(){l.tooltip.setText(w,Tr.lo("change_appearance_upgrade"))}),b.addChild(w)}m.addChild(b),m.addChild(new Ms(m,new vr(1,2)))}}}else if(d.any()){var S=new ps(l,l.innerWindowStage,m),x=new Hs(t,d,po.hasMultiUpgradeModeOn?Tr.lo("per_building"):"");t.game.isMobile&&(x.maxDisplayWidth=t.game.rect.width-10);var T=S.addChild(new ds(S,l.innerWindowStage,x,{left:0,right:0,top:0,bottom:po.hasMultiUpgradeModeOn?0==d.knowledge?0:1:2},Uh(x,x.updateCostDisplay)));if(po.hasMultiUpgradeModeOn){gs.setUpgradeAllDisplay(t,e,x,i,d,T,o);var I=t,P=e,C=x,E=i,A=d,M=T,B=o;S.onUpdate=function(){gs.setUpgradeAllDisplay(I,P,C,E,A,M,B)}}m.addChild(S)}}},gs.addUpgradesOrBuildingModes=function(e,t,i,n,r,s,o,a,l,h,u,c,d){null==d&&(d=!1),null==c&&(c=!1);var p=e.gui;if(gr.any(i,function(t){return e.progress.unlocks.getUnlockState(t)!=$a.Locked})){var f=null;null!=n&&(f=po.createHeader(p,n));for(var g=!1,m=!1,y=0;y<i.length;){var _=[i[y]];if(++y,e.progress.unlocks.getUnlockState(_[0])!=$a.Locked){var v=gr.any(t.upgrades,function(e){return function(t){return Ko.getClass(t)==e[0]}}(_))||null!=t.buildingMode&&Ko.getClass(t.buildingMode)==_[0];if(!v){var b=dt.buildingUpgradesInfo,w=_[0].__name__,S=b.h[w],x=L.fromBuildingUpgradesInfo(S);x.knowledge=0,x.any()&&(m=!0)}v||(g=!0),gs.addUpgradeButton(e,t,_[0],function(e,i){return function(t){e[0](i[0],t)}}([r],[_[0]]),s,u,c,d)}}g&&null!=f&&po.addOneAndMaxButtons(p,f,function(){po.hasMultiUpgradeModeOn=!1,e.gui.reloadWindow()},function(){po.hasMultiUpgradeModeOn=!0,null!=h&&h(),e.gui.reloadWindow()},o,a,l,m),p.windowInner.addChild(new Ms(p.windowInner,new vr(2,4)))}},gs.addUpgradeParts=function(i,n,t,e,r){null==r&&(r=!1),null==e&&(e=!1);var s=Ko.getClass(i);gs.addUpgradesOrBuildingModes(n,i,i.get_possibleUpgrades(),t?Tr.lo("upgrades"):null,function(t,e){e.upgrades.push(k.createInstance(t,[i.stage,n.cityMidStage,i.bgStage,e]))},!1,Tr.lo("upgrade_only_this"),function(){return Tr.lo("upgrade_afford",[n.simulation.stats.amountOfBuildingsOfType(s)])},function(){return Tr.lo("upgrade_all_explain",[n.simulation.stats.amountOfBuildingsOfType(s)])},null,R.get().buildingUpgradeSound,e,r)},gs.createMainWindowPart=function(a,l){l.gui.currentUpgradeButtons=new Vo,gs.addUpgradeParts(a,l,!0);function h(t,e){null!=e.buildingMode&&e.buildingMode.destroy(),e.buildingMode=k.createInstance(t,[a.stage,l.cityMidStage,a.bgStage,e])}var t=Ko.getClass(a);gs.addUpgradesOrBuildingModes(l,a,a.get_possibleBuildingModes(),Tr.lo("building_modes"),h,!1,Tr.lo("building_mode_only_this"),function(){return Tr.lo("building_mode_afford",[l.simulation.stats.amountOfBuildingsOfType(t)])},function(){return Tr.lo("building_mode_all_explain",[l.simulation.stats.amountOfBuildingsOfType(t)])},function(){var t=Ko.getClass(a.buildingMode),e=dt.buildingUpgradesInfo,i=t.__name__,n=e.h[i],r=L.fromBuildingUpgradesInfo(n);r.knowledge=0;var s=h,o=t;gs.upgradeAll(l,a,t,r,function(t){s(o,t)})}),ms.create(a.get_possibleCityUpgrades(),l),ys.create(a.get_possiblePolicies(),l)},gs.createBuildingUpgradesForType=function(t,e,i){null==i&&(i=!1),e.gui.windowInner.addChild(new Ms(e.gui.windowInner,new vr(2,4))),po.hasMultiUpgradeModeOn=!0,gs.addUpgradeParts(t,e,!1,!0,i),ms.create(t.get_possibleCityUpgrades(),e,!1,i),ys.create(t.get_possiblePolicies(),e,!1)};var ms=function(){};(q["gui.CreateCityUpgrades"]=ms).__name__="gui.CreateCityUpgrades",ms.create=function(t,g,e,m){null==m&&(m=!1),null==e&&(e=!0);for(var y=g.gui,i=[],n=0,r=t;n<r.length;){var s=r[n];++n,g.progress.unlocks.getUnlockState(s)==$a.Unlocked&&i.push(s)}var _=i,v=g.upgrades.upgrades;if(0!=_.length){e&&po.createHeader(y,Tr.lo("city_upgrades"));var b=new ps(y,y.innerWindowStage,y.windowInner);y.windowInner.addChild(b),b.direction=Ps.Vertical,b.fillSecondarySize=!0;!function(){b.clear();for(var t=0;t<_.length;){var e=[_[t]];++t;var i=gr.any(v,function(e){return function(t){return Ko.getClass(t)==e[0]}}(e));if(!i||!m){var n=[e[0].__name__],r=dt.cityUpgradesInfo.h[n[0]],s=r.name,o=r.description;if(null!=r.nextUpgrade&&""!=r.nextUpgrade){var a="cityUpgrades."+r.nextUpgrade;if(g.progress.unlocks.getUnlockState(q[a])!=$a.Locked)continue}else i&&(null!=r.nameIfNotDone&&(s=r.nameIfNotDone),null!=r.descriptionIfNotDone&&(o=r.descriptionIfNotDone));var l=[L.fromCityUpgradesInfo(r)],h=po.createActivatableButton(y,i,function(t,e,i){return function(){g.materials.canAfford(t[0])&&(g.materials.remove(t[0]),g.upgrades.addUpgrade(k.createInstance(i[0],[])),S.sendEvent("research",e[0]),S.sendEventFirebase("research","upgrade",e[0]),g.simulation.houseAssigner.shouldUpdateHouses=!0,g.gui.reloadWindow(),g.gui.refreshCategoryBuildingsShown(),R.get().playSound(R.get().buildingUpgradeSound))}}(l,n,e),s,o,b,null);if(null!=h.button&&(h.button.buttonSound=null),null!=h.button){var u=y.currentUpgradeButtons,c=e[0].__name__,d=h.button;u.h[c]=d}if(!i&&l[0].any()){var p=new ps(y,y.innerWindowStage,h.container),f=new Hs(g,l[0],"");g.game.isMobile&&(f.maxDisplayWidth=g.game.rect.width-10),p.addChild(new ds(p,y.innerWindowStage,f,{left:0,right:0,top:0,bottom:2},Uh(f,f.updateCostDisplay))),h.container.addChild(p)}}}}(),y.windowInner.addChild(new Ms(y.windowInner,new vr(2,4)))}};var ys=function(){};(q["gui.CreatePolicies"]=ys).__name__="gui.CreatePolicies",ys.create=function(t,a,e){null==e&&(e=!0);for(var l=a.gui,i=[],n=0,r=t;n<r.length;){var s=r[n];++n,a.progress.unlocks.getUnlockState(s)==$a.Unlocked&&i.push(s)}var h=i,u=(t=a.policies).policies;if(0!=h.length){e&&po.createHeader(l,Tr.lo("city_policies"));var c=new ps(l,l.innerWindowStage,l.windowInner);l.windowInner.addChild(c),c.direction=Ps.Vertical,c.fillSecondarySize=!0;!function(){c.clear();for(var t=0;t<h.length;){var e=[h[t]];++t;var i=e[0].__name__,n=dt.policiesInfo.h[i],r=n.name,s=n.description,o=[L.fromPoliciesInfo(n)];po.createCheckboxButton(l,function(t){return function(){return gr.any(u,(e=t,function(t){return Ko.getClass(t)==e[0]}));var e}}(e),function(i,n){return function(){var e,t=lt.find(u,(e=n,function(t){return Ko.getClass(t)==e[0]}));null!=t?(a.policies.removePolicy(t),a.simulation.houseAssigner.shouldUpdateHouses=!0):a.materials.canAfford(i[0])&&(a.materials.remove(i[0]),a.policies.addPolicy(k.createInstance(n[0],[])),a.simulation.houseAssigner.shouldUpdateHouses=!0)}}(o,e),r,s,c,null)}}(),l.windowInner.addChild(new Ms(l.windowInner,new vr(2,4)))}};var _s=function(){};(q["gui.CreditsWindow"]=_s).__name__="gui.CreditsWindow",_s.create=function(t,e,i,n){if(e.windowAddTitleText(Tr.lo("credits")),n.addChild(new ao(n,i,Tr.lo("game_by"),null,"Arial15")),n.addChild(new ao(n,i,Tr.lo("music_by"),null,"Arial15")),n.addChild(new Ms(n,new vr(2,6))),""!=Tr.lo("localized_by")&&(n.addChild(new ao(n,i,Tr.lo("localized_by"),null,"Arial")),n.addChild(new Ms(n,new vr(2,6)))),n.addChild(new ao(n,i,"Big thanks to CoolMath Games for their sponsorship!",null,"Arial")),n.addChild(new Ms(n,new vr(2,6))),n.addChild(new ao(n,i,Tr.lo("credits_additional_sprites"),null,"Arial")),n.addChild(new ao(n,i,Tr.lo("early_feedback"),null,"Arial")),n.addChild(new ao(n,i,"Rocket launch sound: sandyrb (CC BY 4.0)",null,"Arial")),n.addChild(new Ms(n,new vr(2,6))),n.addChild(new ao(n,i,Tr.lo("credits_software"),null,"Arial15")),n.addChild(new ao(n,i,Tr.lo("credits_software_1"),null,"Arial")),n.addChild(new ao(n,i,Tr.lo("credits_software_2"),null,"Arial")),n.addChild(new ao(n,i,"FileSaver.js; localForage; canvas-toBlob.js;",null,"Arial")),n.addChild(new ao(n,i,"polygonal-ds; thx.color; pixi-sound",null,"Arial")),n.addChild(new Ms(n,new vr(2,6))),n.addChild(new ao(n,i,Tr.lo("thanks_for_playing"),null,"Arial")),n.addChild(new ao(n,i,"While you're here on CoolMath Games, also check out my other games circloO 1 & 2 and Stop the Darkness!",null,"Arial")),B.get_enableCrossPromo()&&jsFunctions.crossPromoInited()){e.windowAddBottomButtons([{text:"Play More Games!",action:function(){jsFunctions.showCrossPromoDisplay(!1)}}])}else e.windowAddBottomButtons()};var vs=function(){};(q["gui.CurrentMissionsWindow"]=vs).__name__="gui.CurrentMissionsWindow",vs.create=function(r,t,e,i){var s=t.windowAddTitleText(Tr.lo("current_tasks")),o=!0,n=new ao(i,e,null,function(){for(var t=r.progress.goalHelp.getCurrentGoalHelp(),e="",i=0;i<t.length;){var n=t[i];++i,""!=e&&(e+="\n\n"),e+="- "+n.category+"\n"+n.text}return 1!=t.length!=o&&(1==t.length?s.setText(Tr.lo("current_task")):s.setText(Tr.lo("current_tasks")),o=1!=t.length),""==e&&(e="---"),e});i.addChild(n),t.windowAddBottomButtons()};function bs(){}(q["gui.EntertainmentInformationWindow"]=bs).__name__="gui.EntertainmentInformationWindow",bs.create=function(t,e,i,n){bs.createWindow(t,e,i,n)},bs.createWindow=function(t,e,i,n){e.windowAllowBanner(),n.clear(),e.windowAddTitleText(Tr.lo("categories/Entertainment.name"),null,dt.getTexture("spr_happiness"));for(var r=-1,s=!1,o=0,a=t.permanents;o<a.length;){var l=a[o];if(++o,l.isBuilding){var h=l;if(h.isEntertainment)if(-1==r)r=h.shardId;else if(h.shardId!=r){s=!0;break}}}s&&e.windowInner.addChild(new ao(n,i,Tr.lo("entertainment_information_multiple_wg_with_citizens"),null,null,null,150));var u=t.simulation.happiness;1<u.numberOfGroupsWithCitizens&&e.windowAddInfoText(null,function(){return 1<u.numberOfGroupsWithCitizens?Tr.lo("entertainment_information_no_citizens"):""});var c=[];for(o=0,a=u.entertainmentTypes.length;o<a;){var d=o++,p=u.entertainmentTypes[d];e.windowAddInfoText(gl.getName(p),null,"Arial15"),c.push(bs.addEntertainmentTypeInfo(t,e,i,n,p)),e.windowInner.addChild(new Ms(e.windowInner,new vr(2,4)))}var f=0;n.onUpdate=function(){c[f](),f=(f+1)%c.length};o=Uh(N=t.gui,N.reloadWindow);t.windowRelatedOnBuildOrDestroy=function(){o()},n.onDestroy=function(){t.windowRelatedOnBuildOrDestroy=null},e.windowAddBottomButtons()},bs.addEntertainmentTypeInfo=function(a,n,t,e,i){for(var r=[],s=[],o={left:2,top:5,bottom:0,right:0},l=0,h=a.permanents;l<h.length;){var u=h[l];if(++l,u.isBuilding&&u.isEntertainment){var c=u;if(c.get_entertainmentType()!=i&&(null==c.get_secondaryEntertainmentTypes()||-1==c.get_secondaryEntertainmentTypes().indexOf(i)))continue;var d=Ko.getClass(u);if(-1==(v=r.indexOf(d))){v=r.length,r.push(d);var p=d.__name__.split(".");s.push(p[p.length-1])}}}var f=[];for(l=0,h=a.progress.resources.buildingInfoArray;l<h.length;){var g=h[l];++l,-1!=(v=s.indexOf(g.className))&&f.push(r[v])}function m(){y=[];for(var t=_=0;t<f.length;){f[t];++t,y.push({number:0,capacity:0})}t=0;for(var e=a.permanents;t<e.length;){var i=e[t];++t;var n=i,r=Ko.getClass(i),s=f.indexOf(r);if(-1!=s){var o=y[s];o.capacity+=n.get_entertainmentCapacity(),o.number+=1,_+=n.get_entertainmentCapacity()}}}var y=[],_=0;m();for(l=0,h=f.length;l<h;){var v=l++,b=new ps(n,t,e);b.fillSecondarySize=!0;var w=f[v],S=[y[v]],x=new ps(n,t,b),T=new PIXI.Container,I=F.field(w,"spriteName"),P=a.progress.resources.buildingInfo,C=w.__name__,E=[P.h[C]];"none"!=E[0].buttonBack&&T.addChild(dt.makeSprite(null==E[0].buttonBack?I+"@44,0,20,20":E[0].buttonBack)),T.addChild(dt.makeSprite(I+"@0,0,20,20"));var A=[null];A[0]=new ds(x,t,T,null,null,function(e,i){return function(t){return!!e[0].rect.contains(t.position)&&(n.tooltip.setText(e[0],i[0].name),!0)}}(A,E)),x.addChild(A[0]);var M=new ps(n,t,x,null,null,null,null,o);M.addChild(new ao(M,t,"x"+S[0].number+": ")),x.addChild(M),b.addChild(x),b.addChild(new As(b));var B=new ps(n,t,b,null,null,null,null,o);B.minHeight=15,B.addChild(new ao(B,t,null,function(t){return function(){return""+t[0].capacity}}(S))),b.addChild(B),e.addChild(b)}if(0==f.length)n.windowAddInfoText("--");else{var R=new ps(n,t,e);R.fillSecondarySize=!0,R.addChild(new ao(R,t,Tr.lo("total")+":",null,null,{left:0,top:5,bottom:0,right:0})),R.addChild(new As(R));var O=new ps(n,t,R,null,null,null,null,o);O.minHeight=15,O.addChild(new ao(O,t,null,function(){return""+_})),R.addChild(O),e.addChild(R)}return m};function ws(){}(q["gui.FollowingAnimal"]=ws).__name__="gui.FollowingAnimal",ws.createWindow=function(e,i,t){null==t&&(t=!0),t&&e.gui.clearWindowStack(),e.gui.createWindow(i),e.gui.setWindowPositioning(e.game.isMobile?fo.TopLeft:fo.Top);var n=e,r=i,s=t,o=function(){ws.createWindow(n,r,s)};e.gui.setWindowReload(o);var a=e,l=i,h=t;o=function(){ws.createWindow(a,l,h)};e.gui.addWindowToStack(o);var u=Tr.lo("following_animal");e.gui.windowAddTitleText(u),e.gui.windowAddBottomButtons(),e.viewIsControlled=!0;var c=dt.makeSprite("spr_selectedfish");c.anchor.set(.5,1),e.furtherForegroundStage.addChild(c),e.gui.windowOnLateUpdate=function(){if(i.destroyed)ws.onanimalDie(e,i,u);else{var t=i.getCityPosition();e.viewPos=new br(t.x,t.y),c.position.set(t.x,t.y),e.cityView.updateMovingView()}},e.gui.windowOnDestroy=function(){e.viewIsControlled=!1,e.cityView.isDraggingView=!1,c.destroy()};var d=i.getCityPosition();o=new br(d.x,d.y);e.viewPos=o,e.cityView.updateMovingView()},ws.onanimalDie=function(t,e,i){t.gui.clearWindowStack(),t.gui.closeWindow(),t.gui.createWindow(),t.gui.windowAddTitleText(i),t.gui.windowInner.addChild(new ao(t.gui.windowInner,t.gui.innerWindowStage,Tr.lo("cant_find_animal"))),t.gui.windowAddBottomButtons()};var Ss=function(){};(q["gui.FollowingCitizen"]=Ss).__name__="gui.FollowingCitizen",Ss.createWindow=function(e,i,t){null==t&&(t=!0),t&&e.gui.clearWindowStack(),window.globalFollowingCitizen=i,e.gui.createWindow(i),e.gui.setWindowPositioning(e.game.isMobile?fo.TopLeft:fo.Top);var n=e,r=i,s=t,o=function(){Ss.createWindow(n,r,s)};e.gui.setWindowReload(o);var a=e,l=i,h=t;o=function(){Ss.createWindow(a,l,h)};e.gui.addWindowToStack(o);var u=Tr.lo("following",[i.nameIndex<dt.citizenNames.length?dt.citizenNames[i.nameIndex]:Or.firstToUpper(Tr.lo("citizen"))]),c=i.nameIndex<dt.citizenNames.length?dt.citizenNames[i.nameIndex]:Tr.lo("this_citizen");e.gui.windowAddTitleText(u),e.gui.windowInner.addChild(new ao(e.gui.windowInner,e.gui.innerWindowStage,null,function(){var t=i.educationLevel<.01?Tr.lo("education_level_0"):i.educationLevel<.1?Tr.lo("education_level_1"):i.educationLevel<.2?Tr.lo("education_level_2"):i.educationLevel<.4?Tr.lo("education_level_3"):i.educationLevel<.6?Tr.lo("education_level_4"):i.educationLevel<.7?Tr.lo("education_level_5"):i.educationLevel<.8?Tr.lo("education_level_6"):i.educationLevel<1?Tr.lo("education_level_7"):i.educationLevel<=1.005?Tr.lo("education_level_8"):i.educationLevel<=1.2?Tr.lo("education_level_9"):i.educationLevel<1.4?Tr.lo("education_level_10"):i.educationLevel<1.6?Tr.lo("education_level_11"):i.educationLevel<1.8?Tr.lo("education_level_12"):i.educationLevel<2?Tr.lo("education_level_13"):i.educationLevel<2.2?Tr.lo("education_level_14"):Tr.lo("education_level_15");return Tr.lo("age_and_education",[Math.floor(i.get_age()),t])}));var d=16<=i.get_age()&&null==i.school,p=[];"cityofthekey"==e.progress.story.storyName&&null!=i.job&&i.job.is(Qi)?e.gui.windowAddBottomButtons():p=e.gui.windowAddBottomButtons([{text:d?Tr.lo("change_home_job"):Tr.lo("change_home_school"),action:function(){Ss.createChangeHomeAndWorkOfCitizenWindow(e,i)}}]),e.viewIsControlled=!0;var f=dt.makeSprite("spr_selectedhuman");e.furtherForegroundStage.addChild(f),e.gui.windowOnLateUpdate=function(){if((window.__temp1=i).hasDied)Ss.onCitizenDie(e,i,c,u,null!=i.dynamicUnsavedVars.flyAwayInRocket);else{!d&&16<=i.get_age()&&null==i.school&&(0<p.length&&p[0].setText(Tr.lo("change_home_job")),d=!0);var t=i.getCityPosition();if(e.viewPos=new br(t.x,t.y),f.position.set(t.x-1,t.y-6),e.cityView.updateMovingView(),null!=i.hobby&&i.hobby instanceof Ul)i.hobby.isWalkingOnBall()&&dr.achieve("HOBBY_BALL");100<=i.get_age()&&null!=(null!=i.inPermanent&&i.inPermanent.isBuilding?i.inPermanent:null)&&(null!=i.inPermanent&&i.inPermanent.isBuilding?i.inPermanent:null).is(Mi)&&(null!=i.inPermanent&&i.inPermanent.isBuilding?i.inPermanent:null).get_isOpen()&&(null==i.path||i.pathOnlyRelatedTo==i.inPermanent)&&dr.achieve("OLD_PARTIER")}},e.gui.windowOnDestroy=function(){e.viewIsControlled=!1,e.cityView.isDraggingView=!1,f.destroy()};var g=i.getCityPosition();o=new br(g.x,g.y);e.viewPos=o,e.cityView.updateMovingView()},Ss.onCitizenDie=function(t,e,i,n,r){t.gui.clearWindowStack(),t.gui.closeWindow(),t.gui.createWindow(),t.gui.windowAddTitleText(n),t.gui.windowInner.addChild(new ao(t.gui.windowInner,t.gui.innerWindowStage,Tr.lo(r?"citizen_left":"citizen_passed_away",[i]))),t.gui.windowAddBottomButtons()},Ss.createChangeHomeAndWorkOfCitizenWindow=function(s,o){var i=o.nameIndex<dt.citizenNames.length?dt.citizenNames[o.nameIndex]:Tr.lo("this_citizen"),n=dt.makeSprite("spr_selectedhuman");s.furtherForegroundStage.addChild(n),s.activateSpecialCityAction(new Wn(s,o)),s.gui.createWindow(o),s.gui.setWindowPositioning(s.game.isMobile?fo.TopLeft:fo.Top);var t=s,e=o,r=function(){Ss.createChangeHomeAndWorkOfCitizenWindow(t,e)};s.gui.setWindowReload(r);var a=s,l=o;r=function(){Ss.createChangeHomeAndWorkOfCitizenWindow(a,l)};s.gui.addWindowToStack(r);function h(){return(16<=o.get_age()&&null==o.school?Tr.lo("change_home_job"):Tr.lo("change_home_school"))+" "+Tr.lo("for_citizen",[o.nameIndex<dt.citizenNames.length?dt.citizenNames[o.nameIndex]:Or.firstToUpper(Tr.lo("citizen"))])}s.gui.windowAddTitleText(null,h),s.gui.windowAddBottomButtons();var u=s.gui.windowInner.children[s.gui.windowInner.children.length-1],c=null;c=new Us(s.gui,s.gui.innerWindowStage,u,function(){if(null!=o.home){var t=o.home.position,e=new vr(t.x+10,t.y+10),i=new br(e.x,e.y);s.viewPos=i,s.cityView.updateMovingView()}},dt.getTexture("spr_housing"),null,function(){s.gui.tooltip.setText(c,Tr.lo("center_on_house"))},null,s.game.isMobile?"spr_button_smaller_mobile":"spr_button_smaller",s.game.isMobile?4:2),u.insertChild(c,0),u.insertChild(new Ms(u,new vr(4,2)),1);var d=null,p=null!=o.school||o.get_age()<16;d=new Us(s.gui,s.gui.innerWindowStage,u,function(){if(null!=o.job){var t=o.job.position,e=10,i=10,n=new vr(t.x+e,t.y+i),r=new br(n.x,n.y);s.viewPos=r,s.cityView.updateMovingView()}else if(null!=o.school){t=o.school.position,e=10,i=10,n=new vr(t.x+e,t.y+i),r=new br(n.x,n.y);s.viewPos=r,s.cityView.updateMovingView()}},dt.getTexture(p?"spr_icon_school":"spr_work"),function(){return p&&null==o.school&&16<=o.get_age()&&d.updateTexture(dt.getTexture("spr_work")),!1},function(){s.gui.tooltip.setText(d,null!=o.school||o.get_age()<16?Tr.lo("center_on_school"):Tr.lo("center_on_work"))},null,s.game.isMobile?"spr_button_smaller_mobile":"spr_button_smaller",s.game.isMobile?4:2),u.insertChild(d,2),s.gui.windowOnLateUpdate=function(){if(o.hasDied)Ss.onCitizenDie(s,o,i,h(),null!=o.dynamicUnsavedVars.flyAwayInRocket);else{var t=o.getCityPosition();n.position.set(t.x-1,t.y-6);var e=dt.getTextures("spr_hoverhints_citizen",4);s.setHoverHightlight(function(t){return o.job==t&&o.home==t?e[3]:o.job==t?e[0]:o.home==t?e[1]:o.school==t?e[2]:null},6735360)}},s.gui.windowOnDestroy=function(){n.destroy(),null!=s.specialAction&&s.specialAction.deactivate(!0)}};function xs(){}(q["gui.FollowingFish"]=xs).__name__="gui.FollowingFish",xs.createWindow=function(e,i,t){null==t&&(t=!0),t&&e.gui.clearWindowStack(),e.gui.createWindow(i),e.gui.setWindowPositioning(e.game.isMobile?fo.TopLeft:fo.Top);var n=e,r=i,s=t,o=function(){xs.createWindow(n,r,s)};e.gui.setWindowReload(o);var a=e,l=i,h=t;o=function(){xs.createWindow(a,l,h)};e.gui.addWindowToStack(o);var u=Tr.lo("following_fish");e.gui.windowAddTitleText(u),e.gui.windowAddBottomButtons(),e.viewIsControlled=!0;var c=dt.makeSprite("spr_selectedfish");c.anchor.set(.5,.5),e.furtherForegroundStage.addChild(c),e.gui.windowOnLateUpdate=function(){if(i.destroyed)xs.onFishDie(e,i,u);else{var t=i.getCityPosition();e.viewPos=new br(t.x,t.y),c.position.set(t.x,t.y),e.cityView.updateMovingView()}},e.gui.windowOnDestroy=function(){e.viewIsControlled=!1,e.cityView.isDraggingView=!1,c.destroy()};var d=i.getCityPosition();o=new br(d.x,d.y);e.viewPos=o,e.cityView.updateMovingView(),dr.achieve("FOLLOW_FISH")},xs.onFishDie=function(t,e,i){t.gui.clearWindowStack(),t.gui.closeWindow(),t.gui.createWindow(),t.gui.windowAddTitleText(i),t.gui.windowInner.addChild(new ao(t.gui.windowInner,t.gui.innerWindowStage,Tr.lo("cant_find_fish"))),t.gui.windowAddBottomButtons()};function Ts(){}(q["gui.FollowingFrog"]=Ts).__name__="gui.FollowingFrog",Ts.createWindow=function(e,i,t){null==t&&(t=!0),t&&e.gui.clearWindowStack(),e.gui.createWindow(i),e.gui.setWindowPositioning(e.game.isMobile?fo.TopLeft:fo.Top);var n=e,r=i,s=t,o=function(){Ts.createWindow(n,r,s)};e.gui.setWindowReload(o);var a=e,l=i,h=t;o=function(){Ts.createWindow(a,l,h)};e.gui.addWindowToStack(o);var u=Tr.lo("following_frog");e.gui.windowAddTitleText(u),e.gui.windowAddBottomButtons(),e.viewIsControlled=!0;var c=dt.makeSprite("spr_selectedfish");c.anchor.set(.5,.5),e.furtherForegroundStage.addChild(c),e.gui.windowOnLateUpdate=function(){if(i.destroyed)Ts.onFrogDie(e,i,u);else{var t=i.getCityPosition();e.viewPos=new br(t.x,t.y),c.position.set(t.x,t.y),e.cityView.updateMovingView()}},e.gui.windowOnDestroy=function(){e.viewIsControlled=!1,e.cityView.isDraggingView=!1,c.destroy()},e.viewPos=i.getCityPosition(),e.cityView.updateMovingView(),dr.achieve("FOLLOW_FROG")},Ts.onFrogDie=function(t,e,i){t.gui.clearWindowStack(),t.gui.closeWindow(),t.gui.createWindow(),t.gui.windowAddTitleText(i),t.gui.windowInner.addChild(new ao(t.gui.windowInner,t.gui.innerWindowStage,Tr.lo("cant_find_frog"))),t.gui.windowAddBottomButtons()};var Is=function(){};(q["gui.FreePlayConfigureWindow"]=Is).__name__="gui.FreePlayConfigureWindow",Is.createWindow=function(e,t,i,n){t.createWindow();var r=e,s=t,o=i,a=n;t.addWindowToStack(function(){Is.createWindow(r,s,o,a)}),t.windowAddTitleText(Tr.lo("customize_free_play")),t.windowInner.addChild(new Ms(t.windowInner,new vr(2,2))),t.windowAddInfoText(Tr.lo("starting_resources"),null,"Arial15");var l=e.materials.copy(),h=gr.isum(e.progress.story.storyInfo.worlds,function(t){return gr.isum(t.citizens,function(t){return t.amount})}),u=Kr.create(t,t.innerWindowStage,t.windowInner,function(){e.progress.sandbox.disableUnlimitedResources(),e.progress.sandbox.everPlayedWithUnlimitedResources=!1,e.materials.remove(e.materials),e.materials.add(l);var t=e.materials;t.set_food(t.food+3*(e.simulation.citizens.length-h))},function(){return!e.progress.sandbox.unlimitedResources&&e.materials.wood<1e3},Tr.lo("normal_resources"));if(t.windowInner.addChild(u),e.progress.story.canHaveExtraResources()){t.windowInner.addChild(new Ms(t.windowInner,new vr(2,2)));u=Kr.create(t,t.innerWindowStage,t.windowInner,function(){e.progress.sandbox.disableUnlimitedResources(),e.progress.sandbox.everPlayedWithUnlimitedResources=!1;e.materials.copy();e.materials.remove(e.materials),e.materials.add(new L(1e3,1e3,1e3,100,500));var t=e.materials;t.set_food(t.food+3*(e.simulation.citizens.length-h))},function(){return!e.progress.sandbox.unlimitedResources&&1e3<=e.materials.wood},Tr.lo("extra_resources"));t.windowInner.addChild(u)}if(B.get_allowUnlimitedResources()){t.windowInner.addChild(new Ms(t.windowInner,new vr(2,2)));u=Kr.create(t,t.innerWindowStage,t.windowInner,function(){e.progress.sandbox.enableUnlimitedResources()},function(){return e.progress.sandbox.unlimitedResources},Tr.lo("unlimited_resources"));t.windowInner.addChild(u)}t.windowInner.addChild(new Ms(t.windowInner,new vr(2,6))),t.windowAddInfoText(Tr.lo("starting_citizens"),null,"Arial15");var c=new ps(t,t.innerWindowStage,t.windowInner);c.direction=Ps.Horizontal;u=Kr.create(t,t.innerWindowStage,t.windowInner,function(){Is.setCityCitizens(e,h)},function(){return e.simulation.citizens.length==h},h+"");c.addChild(u),c.addChild(new Ms(c,new vr(2,2)));u=Kr.create(t,t.innerWindowStage,t.windowInner,function(){Is.setCityCitizens(e,10)},function(){return 10==e.simulation.citizens.length},"10");c.addChild(u),c.addChild(new Ms(c,new vr(2,2)));u=Kr.create(t,t.innerWindowStage,t.windowInner,function(){Is.setCityCitizens(e,25)},function(){return 25==e.simulation.citizens.length},"25");c.addChild(u),c.addChild(new Ms(c,new vr(2,2)));u=Kr.create(t,t.innerWindowStage,t.windowInner,function(){Is.setCityCitizens(e,100)},function(){return 100==e.simulation.citizens.length},"100");if(c.addChild(u),B.get_allowUnlimitedResources()){c.addChild(new Ms(c,new vr(2,2)));u=Kr.create(t,t.innerWindowStage,t.windowInner,function(){Is.setCityCitizens(e,200)},function(){return 200==e.simulation.citizens.length},"200");c.addChild(u),c.addChild(new Ms(c,new vr(2,2)));u=Kr.create(t,t.innerWindowStage,t.windowInner,function(){Is.setCityCitizens(e,500)},function(){return 500==e.simulation.citizens.length},"500");c.addChild(u)}if(t.windowInner.addChild(c),B.get_allowUnlimitedResources()){t.windowInner.addChild(new Ms(t.windowInner,new vr(2,6))),t.windowAddInfoText(Tr.lo("buildings_research"),null,"Arial15");u=Kr.create(t,t.innerWindowStage,t.windowInner,function(){e.progress.unlocks.unlockMost=!1},function(){return!e.progress.unlocks.unlockMost},Tr.lo("standard_unlocks"));t.windowInner.addChild(u),t.windowInner.addChild(new Ms(t.windowInner,new vr(2,2)));u=Kr.create(t,t.innerWindowStage,t.windowInner,function(){e.progress.unlocks.unlockMost=!0},function(){return e.progress.unlocks.unlockMost},Tr.lo("most_unlocks"));t.windowInner.addChild(u)}t.windowInner.addChild(new Ms(t.windowInner,new vr(2,6))),t.windowAddBottomButtons([{text:Tr.lo("back"),action:function(){n()}}],Tr.lo("continue"),function(){i()}),t.windowOnDestroy=n},Is.setCityCitizens=function(t,e){if(t.simulation.citizens.length>e)for(;t.simulation.citizens.length>e;){t.simulation.citizens[t.simulation.citizens.length-1].tryRemove(),(n=t.materials).set_food(n.food-3)}else for(;t.simulation.citizens.length<e;){for(var i=t.simulation,n=[],r=0,s=t.worlds;r<s.length;){var o=s[r];++r,gr.any(t.simulation.citizens,function(e){return function(t){return t.onWorld==e[0]}}([o]))&&n.push(o)}i.createCitizen(n[0],il.getFloat(18,40));var a=t.materials;a.set_food(a.food+3)}};var Ps=T["gui.GUIContainerDirection"]={__ename__:"gui.GUIContainerDirection",__constructs__:["Horizontal","Vertical"],Horizontal:{_hx_index:0,__enum__:"gui.GUIContainerDirection",toString:i},Vertical:{_hx_index:1,__enum__:"gui.GUIContainerDirection",toString:i}},Cs=T["gui.GUIContainerAlignment"]={__ename__:"gui.GUIContainerAlignment",__constructs__:["LeftOrTop","Center","RightOrBottom"],LeftOrTop:{_hx_index:0,__enum__:"gui.GUIContainerAlignment",toString:i},Center:{_hx_index:1,__enum__:"gui.GUIContainerAlignment",toString:i},RightOrBottom:{_hx_index:2,__enum__:"gui.GUIContainerAlignment",toString:i}},Es=function(t,e,i,n,r,s,o,a){this.sizeCallback=null,ps.call(this,t,e,i,n,r,s,o,a)};(q["gui.GUIContainerWithSizeCallback"]=Es).__name__="gui.GUIContainerWithSizeCallback",Es.__super__=ps,Es.prototype=e(ps.prototype,{setSizeCallback:function(t){this.sizeCallback=t},updateSize:function(){ps.prototype.updateSize.call(this),null!=this.sizeCallback&&this.sizeCallback()},__class__:Es});var As=function(t,e){null==e&&(e=0),this.parent=t,this.minFill=e,this.rect=new yr(0,0,1,1)};(q["gui.GUIFiller"]=As).__name__="gui.GUIFiller",As.__interfaces__=[Qr],As.prototype={updateSize:function(){this.parent.updateSize()},updatePosition:function(t){var e=this.rect;new vr(e.x=t.x,e.y=t.y)},destroy:function(){},handleMouse:function(t){return!1},update:function(){},__class__:As};var Ms=function(t,e){this.parent=t,this.rect=new yr(0,0,1,1),this.rect.width=e.x,this.rect.height=e.y};(q["gui.GUISpacing"]=Ms).__name__="gui.GUISpacing",Ms.__interfaces__=[Qr],Ms.prototype={updateSize:function(){this.parent.updateSize()},updatePosition:function(t){var e=this.rect;new vr(e.x=t.x,e.y=t.y)},destroy:function(){},handleMouse:function(t){return!1},update:function(){},__class__:Ms};var Bs=function(){};(q["gui.GameMenu"]=Bs).__name__="gui.GameMenu",Bs.create=function(t,s){var e="spr_button_small",i=2;s.game.isMobile&&(e="spr_button_medium",i=4),t.createWindow("gameMenu"),t.clearWindowStack();var n=t,r=s;t.addWindowToStack(function(){Bs.create(n,r)},!0,"GameMenu"),t.windowAddTitleText(Tr.lo("game_menu")),Mr.reportStopGameplay();var o=t.innerWindowStage;t.windowAddInfoText(null,function(){return Rr.storageSupported()?Tr.lo("last_saved",[Pr.floatFormat(Math,s.secondsSinceAutoSave,1)]):Tr.lo("temp_save")});var a=new ps(t,o,null,new vr(0,0),new br(0,0));a.addChild(new oo(t,o,a,function(){eo.createSaveWindow(s.game,t,Tr.lo("use_save_slot"),function(t){s.saveToOtherSaveSlot(t,function(){s.cityMainFile==s.cityFile?s.cityFile=t:s.cityFile=t+at.substr(s.cityFile,s.cityMainFile.length,null),s.cityMainFile=t,s.saveToBrowserStorage()})})},Tr.lo("save_command"))),a.addChild(new Ms(a,new vr(2,2))),a.addChild(new oo(t,o,a,function(){eo.createLoadWindow(s.game,t,Tr.lo("which_city_load"),function(t){s.game.loadFromStorage(t)})},Tr.lo("load_command"))),a.addChild(new Ms(a,new vr(2,2)));function l(t){jsFunctions.saveAs(new Blob([t],{type:"text/plain;charset=utf-8"}),"theFinalEarth2_save.sav")}s.game.isMobile&&jsFunctions.isAnyApple()||(a.addChild(new oo(t,o,a,function(){0<s.subCities.length?s.saveAllSubCitiesToString(l):l(s.saveToString())},Tr.lo("export"))),a.addChild(new Ms(a,new vr(2,2)))),a.addChild(new oo(t,o,a,function(){},Tr.lo("import_command"),null,function(){s.game.setOnClickTo=function(){Cr.registerPlannedFocusLoss();var t=window.document.getElementById("importFile");t.value="",t.click(),s.game.onClick=null}})),t.windowInner.addChild(a),t.windowInner.addChild(new Ms(t.windowInner,new vr(2,6)));var h=new ps(t,o,null,new vr(0,0),new br(0,0)),u=new oo(t,o,h,function(){Gs.createNewScenarioWindow(s.game,t)},Tr.lo("new_city"));u.setText(Tr.lo("new_city")),h.addChild(u),h.addChild(new Ms(h,new vr(2,2)));var c=s.progress.story.findGoal("Win");if(null==s.progress.story.currentGoal&&null!=c&&null!=c.nextStory&&""!=c.nextStory&&Ka.hasCompletedRequirements(s.game,lt.find(dt.allStoriesInfo,function(t){return t.link==c.nextStory}))){var d=new oo(t,o,a,function(){var t=s.game,e=s.gui,i=Tr.lo("use_save_slot_2"),n=Uh(N=s.game,N.newCity),r=c.nextStory;eo.createSaveWindow(t,e,i,function(t){n(r,t)})},Tr.lo("next_scenario"),null);h.addChild(d),d.setText(Tr.lo("next_scenario"))}else{var p=null;p=function(){t.createWindow(),t.addWindowToStack(p),t.windowAddTitleText(Tr.lo("restart_scenario_question")),t.windowAddInfoText(Tr.lo("sure_restart")),t.windowAddBottomButtons([{text:Tr.lo("restart"),action:function(){s.saveToBrowserStorage("preReset"),s.game.newCity(s.progress.story.storyName,s.cityFile),s.saveToBrowserStorage(),Bs.canUndoReset=!0}}])},h.addChild(new oo(t,o,a,p,Tr.lo("restart_scenario"),null))}if(t.windowInner.addChild(h),Bs.canUndoReset){t.windowInner.addChild(new Ms(t.windowInner,new vr(2,2)));var f=new ps(t,o,null,new vr(0,0),new br(0,0));f.addChild(new oo(t,o,h,function(){Rr.getItem("preReset",function(t,e){Bs.canUndoReset=!1,null!=t&&null==e||s.game.loadFromTypedArray(e,s.cityFile)},!0)},Tr.lo("undo_restart"),null)),t.windowInner.addChild(f)}t.windowInner.addChild(new Ms(t.windowInner,new vr(2,6))),u.extraWidth=t.windowInner.rect.width-gr.isum(h.children,function(t){return t.rect.width})-4,u.setText();var g=new ps(t,o,null);t.windowInner.addChild(g);var m=dt.getTextures("spr_music",2),y=null;(y=new Us(t,o,g,function(){s.game.audio.changeMusicEnabledness(!O.musicOn),y.imageSprite.texture=m[O.musicOn?0:1]},m[O.musicOn?0:1],function(){return!1},function(){t.tooltip.setText(y,O.musicOn?Tr.lo("mute_music"):Tr.lo("unmute_music"))},null,e,i)).imageSprite.tint=0,g.addChild(y),g.addChild(new Ms(g,new vr(2,2)));var _=dt.getTextures("spr_sound",2),v=null;(v=new Us(t,o,g,function(){s.game.audio.changeSoundEnabledness(!O.soundOn),v.imageSprite.texture=_[O.soundOn?0:1]},_[O.soundOn?0:1],function(){return!1},function(){t.tooltip.setText(v,O.soundOn?Tr.lo("mute_sfx"):Tr.lo("unmute_sfx"))},null,e,i)).imageSprite.tint=0,g.addChild(v),g.addChild(new Ms(g,new vr(2,2)));var b,w=dt.getTexture("spr_moresettings"),S=null;if(S=function(){t.createWindow("moreSettingsWindow"),t.addWindowToStack(S),js.create(s,t,t.innerWindowStage,t.windowInner,e,i,!0)},(b=new Us(t,o,g,S,w,function(){return!1},function(){t.tooltip.setText(b,Tr.lo("advanced_settings"))},null,e,i)).imageSprite.tint=0,g.addChild(b),g.addChild(new Ms(g,new vr(6,2))),B.hasFullscreen&&!s.game.isMobile){var x=dt.getTexture("spr_fullscreen"),T=new Us(t,o,g,function(){},x,function(){return!1},function(){t.tooltip.setText(T,Tr.lo("full_screen")),s.game.setOnClickTo=function(){jsFunctions.goFullscreen(!0)}},null,e,i);T.imageSprite.tint=0,g.addChild(T),g.addChild(new Ms(g,new vr(2,2)))}if(!s.game.isMobile||!jsFunctions.isAnyApple()){var I,P=dt.getTexture("spr_camera"),C=s;(I=new Us(t,o,g,E=function(){Bs.saveScreenShot(C)},P,function(){return!1},function(){t.tooltip.setText(I,Tr.lo("save_screenshot"))},null,e,i)).imageSprite.tint=0,g.addChild(I),g.addChild(new Ms(g,new vr(6,2)))}var E,A=dt.getTexture("spr_credits"),M=null;(M=function(){t.createWindow("creditsWindow"),t.addWindowToStack(M),_s.create(s,t,t.innerWindowStage,t.windowInner)},(E=new Us(t,o,g,M,A,function(){return!1},function(){t.tooltip.setText(E,Tr.lo("view_credits"))},null,e,i)).imageSprite.tint=0,g.addChild(E),g.addChild(new Ms(g,new vr(2,2))),t.windowInner.addChild(new Ms(t.windowInner,new vr(2,6))),B.isLimitedDemo)?((d=new oo(t,o,t.windowInner,function(){greenworks.activateGameOverlayToWebPage("https://store.steampowered.com/app/1180130/The_Final_Earth_2/")},Tr.lo("wishlist_full"))).fillWidth(),d.setText(Tr.lo("wishlist_full")),t.windowInner.addChild(d),t.windowInner.addChild(new Ms(t.windowInner,new vr(2,6)))):((d=new oo(t,o,t.windowInner,function(){},"Get the Extended Version!",function(){return!1},function(){s.game.setOnClickTo=function(){window.open("https://store.steampowered.com/app/1180130/The_Final_Earth_2/?utm_source=coolmathgames&utm_medium=web&utm_campaign=gamemenu")}})).buttonPatch.tint=1930651,d.bitmapText.set_tint(16777215),d.fillWidth(),d.setText("Get the Extended Version!"),t.windowInner.addChild(d),t.windowInner.addChild(new Ms(t.windowInner,new vr(2,6))));t.windowAddBottomButtons([{text:Tr.lo("back_to_title"),action:function(){s.game.createMainMenu()}}])},Bs.saveScreenShot=function(e){var t=e.getCityEdges(),i=t.minX,n=t.maxX,r=t.minY,s=t.maxY,o=e.game.application.renderer,a=e.movingViewStage.position.x,l=e.movingViewStage.position.y,h=e.movingViewStage.scale.x;e.movingViewStage.position.x=-i,e.movingViewStage.position.y=-r,e.movingViewStage.scale.x=1,e.movingViewStage.scale.y=1;var u=new PIXI.Graphics;try{u.beginFill(e.skyColor),u.drawRect(i,r,n-i,s-r),u.endFill(),e.movingViewStage.addChildAt(u,0),e.uncull();var c=PIXI.RenderTexture.create({width:n-i,height:s-r,scaleMode:1});o.render(e.movingViewStage,{renderTexture:c,clear:!0,skipUpdateTransform:!1}),o.plugins.extract.canvas(c).toBlob(function(t){jsFunctions.saveAs(t,"TheFinalEarth2_screenshot.png")})}catch(t){var d=Co.caught(t);console.log("FloatingSpaceCities/gui/GameMenu.hx:443:",d);var p=null;(p=function(){e.gui.showSimpleWindow(Tr.lo("save_screenshot_failed"),null,!0),e.gui.addWindowToStack(p,!0),e.gui.setWindowReload(p)})()}e.movingViewStage.position.x=a,e.movingViewStage.position.y=l,e.movingViewStage.scale.x=e.movingViewStage.scale.y=h,u.destroy()};var Rs=function(){};(q["gui.GlobalUpgradeWindow"]=Rs).__name__="gui.GlobalUpgradeWindow",Rs.create=function(t,e,i,n){Rs.createWindow(t,e,i,n)},Rs.createWindow=function(e,t,i,n){t.windowAllowBanner(),n.clear(),e.gui.windowAddTitleText(Tr.lo("upgrades_and_policies")),ss.createSettingButton(t,t.innerWindowStage,t.windowInner,function(){Rs.onlyShowNew=!Rs.onlyShowNew,t.reloadWindow()},function(){return Rs.onlyShowNew},Tr.lo("only_show_unupgraded")),e.gui.windowInner.addChild(new Ms(e.gui.windowInner,new vr(2,6)));for(var r=[],s=[],o=[],a=0,l=e.permanents;a<l.length;){var h=l[a];if(++a,h.isBuilding&&(gr.any(h.get_possibleUpgrades(),function(t){return e.progress.unlocks.getUnlockState(t)!=$a.Locked})||gr.any(h.get_possibleCityUpgrades(),function(t){return e.progress.unlocks.getUnlockState(t)!=$a.Locked})||gr.any(h.get_possiblePolicies(),function(t){return e.progress.unlocks.getUnlockState(t)!=$a.Locked}))){var u=Ko.getClass(h);if(-1==(w=r.indexOf(u))){var c=!1;if(Rs.onlyShowNew){if(c=!0,0<h.get_possiblePolicies().length&&gr.any(h.get_possiblePolicies(),function(t){return e.progress.unlocks.getUnlockState(t)!=$a.Locked})&&(c=!1),c)for(var d=0,p=h.get_possibleUpgrades();d<p.length;){var f=p[d];if(++d,e.progress.unlocks.getUnlockState(f)!=$a.Locked)if(0<gs.getUpgradeAllNumberAndCanAfford(e,h,f,new L).number){c=!1;break}}if(c)for(var g=0,m=h.get_possibleCityUpgrades();g<m.length;){var y=[m[g]];if(++g,e.progress.unlocks.getUnlockState(y[0])!=$a.Locked&&!gr.any(e.upgrades.upgrades,function(e){return function(t){return Ko.getClass(t)==e[0]}}(y))){c=!1;break}}}w=r.length,r.push(u);var _=u.__name__.split(".");s.push(_[_.length-1]),o.push(c)}}}var v=[];for(a=0,l=e.progress.resources.buildingInfoArray;a<l.length;){var b=l[a];++a,-1==(w=s.indexOf(b.className))||o[w]||v.push(r[w])}for(a=0,l=v.length;a<l;){var w,S=[v[w=a++]],x=new ps(t,t.innerWindowStage,t.windowInner),T=e.progress.resources.buildingInfo,I=S[0].__name__,P=T.h[I];x.addChild(is.create(i,e,S[0],x,t)),x.addChild(new ao(x,t.innerWindowStage,P.name,null,"Arial16",{top:3,left:3,right:0,bottom:0})),t.windowInner.addChildWithoutSizeUpdate(x),gs.createBuildingUpgradesForType(lt.find(e.permanents,function(e){return function(t){return t.is(e[0])}}(S)),e,Rs.onlyShowNew),S[0]==fi&&Rs.addSmartUpgradeForLabs(e)}t.windowInner.updateSize(),0==v.length&&e.gui.windowInner.addChild(new ao(e.gui.windowInner,e.gui.innerWindowStage,Tr.lo("no_upgrades"))),t.windowAddBottomButtons();var C=e,E=t,A=i,M=n,B=function(){Rs.createWindow(C,E,A,M)};e.gui.setWindowReload(B);a=Uh(N=e.gui,N.reloadWindow);function R(){Rs.createWindow(O,k,D,F)}var O=e,k=t,D=i,F=n;B=function(){a(R)};e.windowRelatedOnBuildOrDestroy=B,n.onDestroy=function(){e.windowRelatedOnBuildOrDestroy=null}},Rs.addSmartUpgradeForLabs=function(i){for(var n=new L,r=gt,s=$t,t=[],e=0,o=i.permanents;e<o.length;){var a=o[e];++e,a.is(fi)&&0<a.getEffectsOfAdjecentBuildings("farm")&&!gr.any(a.upgrades,function(t){return Ko.__instanceof(t,r)})&&t.push(a)}var l=t;for(t=[],e=0,o=i.permanents;e<o.length;){a=o[e];++e,a.is(fi)&&(null!=a.leftBuilding&&a.leftBuilding.is(vn)||null!=a.rightBuilding&&a.rightBuilding.is(vn)||null!=a.topBuilding&&a.topBuilding.is(vn)||null!=a.bottomBuilding&&a.bottomBuilding.is(vn))&&!gr.any(a.upgrades,function(t){return Ko.__instanceof(t,s)})&&t.push(a)}var h=t,u=0<l.length||0<h.length,c=po.createActivatableButton(i.gui,!u,function(){if(i.materials.canAfford(n)){i.materials.remove(n);for(var t=0;t<l.length;){var e=l[t];++t,e.upgrades.push(k.createInstance(r,[e.stage,i.cityMidStage,e.bgStage,e]))}for(t=0;t<h.length;){e=h[t];++t,e.upgrades.push(k.createInstance(s,[e.stage,i.cityMidStage,e.bgStage,e]))}R.get().playSound(R.get().buildingUpgradeSound),i.progress.unlocks.research(r),i.progress.unlocks.research(s),i.gui.reloadWindow()}},Tr.lo("auto_upgrade"),Tr.lo("upgrade_all_labs"),i.gui.windowInner,null);null!=c.button&&(c.button.buttonSound=null);var d=dt.buildingUpgradesInfo,p=r.__name__,f=L.fromBuildingUpgradesInfo(d.h[p]);(n=f.copy()).multiply(l.length);d=dt.buildingUpgradesInfo,p=s.__name__;var g=L.fromBuildingUpgradesInfo(d.h[p]),m=g.copy();if(m.multiply(h.length),i.progress.unlocks.getUnlockState(r)==$a.Researched?n.knowledge=0:n.knowledge=Math.min(n.knowledge,f.knowledge),i.progress.unlocks.getUnlockState(s)==$a.Researched?m.knowledge=0:m.knowledge=Math.min(m.knowledge,g.knowledge),n.add(m),u&&n.any()){var y=new ps(i.gui,i.gui.innerWindowStage,c.container),_=new Hs(i,n,"");i.game.isMobile&&(_.maxDisplayWidth=i.game.rect.width-10),y.addChild(new ds(y,i.gui.innerWindowStage,_,{left:0,right:0,top:0,bottom:2},Uh(_,_.updateCostDisplay))),c.container.addChild(y)}i.gui.windowInner.addChild(new Ms(i.gui.windowInner,new vr(2,4)))};var Os=function(){};(q["gui.HappinessWindow"]=Os).__name__="gui.HappinessWindow",Os.create=function(t,h,u,e){h.windowAllowBanner(),h.windowAddTitleText(Tr.lo("happiness"),null,dt.getTexture("spr_happiness"));var i=new ps(h,u,e);e.addChild(i);var c=new ps(h,u,i);c.direction=Ps.Vertical,i.addChild(c);var d=new ps(h,u,i);d.direction=Ps.Vertical,i.addChild(d);function n(t,e,i,n,r){null==r&&(r=0),null==n&&(n=0);var s=new Fs(c,i),o=new ps(h,u,s,null,null,null,null,{left:n,right:0,bottom:0,top:r});o.addChild(new ao(o,u,null,t,null,null,null,!0)),o.addChild(new Ms(o,new vr(5,12))),s.setChild(o),c.addChild(s);var a=new Fs(d,i),l=new ps(h,u,a,null,null,null,null,{left:0,right:0,bottom:0,top:r});l.addChild(new ao(l,u,null,e,null,null,null,!0)),l.addChild(new Ms(l,new vr(0,12))),a.setChild(l),d.addChild(a)}var r=t.simulation.happiness;n(function(){return Tr.lo("home_happiness")},function(){return""+(0|r.homeHappiness)}),n(function(){return Tr.lo("sense_of_purpose")},function(){return""+(0|r.purposeHappiness)}),function(t,e,i,n,r){null==r&&(r=0),null==n&&(n=0),null==i&&(i=0);var s=new Fs(d,e),o=new ps(h,u,s,null,null,null,null,{left:0,right:0,bottom:r,top:n});o.addChild(new ao(o,u,null,t,null,null,null,!0)),o.addChild(new Ms(o,new vr(0,12))),s.setChild(o),d.addChild(s)}(function(){return""+(0|r.entertainmentHappiness)},null,2,0);var s=new ps(t.gui,t.gui.innerWindowStage,c);c.addChild(s);var o=null;o=function(){t.gui.createWindow("entertainmentHappinessWindow"),bs.create(t,t.gui,t.gui.innerWindowStage,t.gui.windowInner),t.gui.addWindowToStack(o),t.gui.setWindowReload(o)};var a=new us(t.gui,t.gui.innerWindowStage,s,o),l=a.container;l.padding={left:2,right:3,top:0,bottom:0};var p=new ao(s,t.gui.innerWindowStage,Tr.lo("entertainment_happiness"),null,"Arial",{left:0,top:0,bottom:0,right:3},null,!0);s.addChild(p);p=new ao(l,t.gui.innerWindowStage,"...",null,"Arial",{left:3,top:-1,bottom:0,right:3},null,!0);l.addChild(p),s.addChild(a);for(var f=t.simulation.happiness,g=0,m=f.entertainmentTypes.length;g<m;){var y=[g++];n(function(t){return function(){return gl.getName(t[0])+":"}}([f.entertainmentTypes[y[0]]]),function(t){return function(){return""+(0|f.happinessPerEntertainmentType[t[0]])}}(y),null,10)}"cityofthekey"==t.progress.story.storyName&&(n(function(){return Tr.lo("glory_of_the_key")+":"},function(){return""+(0|f.gloryOfTheKey.gloryOfTheKeyHappiness)}),n(function(){return Tr.lo("sculptures")+":"},function(){return""+(0|f.gloryOfTheKey.sculpturesHappiness)},null,10),n(function(){return Tr.lo("luxury_housing")+":"},function(){return""+(0|f.gloryOfTheKey.highEndHomeHappiness)},null,10),n(function(){return Tr.lo("high_end_restaurants")+":"},function(){return""+(0|f.gloryOfTheKey.expensiveRestaurantHappiness)},null,10)),n(function(){return Tr.lo("education_happiness")},function(){return""+(0|f.schoolHappiness)}),n(function(){return Tr.lo("medical_happiness")},function(){return""+(0|f.medicalHappiness)}),n(function(){return Tr.lo("food_shortage_unhappiness")},function(){return"-"+(0|f.foodShortageUnhappiness)},function(){return 0<f.foodShortageUnhappiness}),n(function(){return Tr.lo("food_rationing_unhappiness")},function(){return"-"+(0|f.foodRationingUnhappiness)},function(){return 0<f.foodRationingUnhappiness}),n(function(){return Tr.lo("mandatory_overtime_unhappiness")},function(){return"-"+(0|f.overtimeUnhappinessShown)},function(){return 0<f.overtimeUnhappinessShown}),n(function(){return Tr.lo("new_city_enthousiasm")},function(){return"+"+(0|f.enthusiasmHappiness)},function(){return 0!=f.enthusiasmHappiness}),n(function(){for(var t="",e=0,i=f.happinessBoosts;e<i.length;){var n=i[e];++e,""!=t&&(t+="\n"),t+=n.text+":"}return t},function(){for(var t="",e=0,i=f.happinessBoosts;e<i.length;){var n=i[e];++e,""!=t&&(t+="\n"),t+="+"+(0|n.boost)}return t},function(){return 0<f.happinessBoosts.length},0,4),n(function(){return Tr.lo("total_happiness")},function(){return""+(0|f.happiness)},null,0,4),n(function(){return Tr.lo("work_speed_modifier")},function(){return""+Pr.floatFormat(Math,f.actionSpeedModifier,2)}),h.windowAddBottomButtons()};var ks=T["gui.HelpArrowDirection"]={__ename__:"gui.HelpArrowDirection",__constructs__:["Down","Left","DownHint","UpHint"],Down:{_hx_index:0,__enum__:"gui.HelpArrowDirection",toString:i},Left:{_hx_index:1,__enum__:"gui.HelpArrowDirection",toString:i},DownHint:{_hx_index:2,__enum__:"gui.HelpArrowDirection",toString:i},UpHint:{_hx_index:3,__enum__:"gui.HelpArrowDirection",toString:i}},Ds=function(t,e,i,n,r,s){switch(null==s&&(s=0),this.currentCloseButtonAnim=0,this.headerTextElement=null,this.closeButton=null,this.pleaseAlignExtraTextRight=!1,this.circleTme=Math.PI/2,this.arrowTime=0,this.gui=t,this.getPointsTo=i,this.stage=e,this.isActive=n,this.direction=null==r?ks.Down:r,this.onlyVisibleAfter=s,this.direction._hx_index){case 0:this.sprite=new PIXI.Sprite(dt.getTexture("spr_tutorialarrowdown")),this.sprite.anchor.set(.5,1);break;case 1:this.sprite=new PIXI.Sprite(dt.getTexture("spr_tutorialarrowleft")),this.sprite.anchor.set(0,.5);break;case 2:this.sprite=new PIXI.Sprite(dt.getTexture("spr_hintinfo_arrow")),this.sprite.anchor.set(.5,1);break;case 3:this.sprite=new PIXI.Sprite(dt.getTexture("spr_hintinfo_arrow")),this.sprite.anchor.set(.5,1),this.sprite.scale.set(1,-1)}e.addChild(this.sprite),this.extraText9P=null,this.extraText="",this.extraTextElement=null,this.setPosition()};(q["gui.HelpArrow"]=Ds).__name__="gui.HelpArrow",Ds.prototype={handleMouse:function(t){if(null!=this.closeButton&&this.closeButton.visible){if(t.position.x>this.closeButton.position.x&&t.position.y>this.closeButton.position.y&&t.position.x<this.closeButton.position.x+this.closeButton.width&&t.position.y<this.closeButton.position.y+this.closeButton.height){var e=t.claimMouse(this,null,!0);return this.currentCloseButtonAnim=1,e==$.Confirmed?(null!=R.get().buttonSound&&R.get().playSound(R.get().buttonSound),this.gui.clearTutorial()):e==$.Active&&(this.currentCloseButtonAnim=2),!0}if(t.position.x>this.extraText9P.position.x&&t.position.y>this.extraText9P.position.y&&t.position.x<this.extraText9P.position.x+this.extraText9P.width&&t.position.y<this.extraText9P.position.y+this.extraText9P.height)return!0}return!1},addHeaderAndCloseButton:function(t){this.hasCloseButton=!0,this.closeButtonTextures=dt.getTextures("spr_button_windowheader",3),this.closeButton=new PIXI.Sprite(this.closeButtonTextures[0]),this.stage.addChild(this.closeButton);var e=new PIXI.Sprite(dt.getTexture("spr_icon_close"));if(e.position.set(1,1),this.closeButton.addChild(e),this.headerText=t,this.headerTextElement=new Ur(t,{font:"Arial16",tint:0}),this.stage.addChild(this.headerTextElement),null!=this.extraText9P){var i=this.getExtraTextHeight();this.extraText9P.npHeight=i,this.extraText9P.updateSprites()}this.setPosition(),this.setExtraTextPosition()},useBigMovement:function(){this.useCircle=!0,this.setPosition()},addText:function(t){if(null!=this.extraTextElement)return this.extraText=t,this.extraTextElement.set_text(t),void this.setExtraTextPosition();this.extraText=t,this.extraTextElement=new Ur(t,{font:"Arial",tint:0}),t.length<45?this.extraTextElement.set_maxWidth(133):this.extraTextElement.set_maxWidth(200);var e=this.getExtraTextHeight();this.extraText9P=new Ys(dt.getTexture("spr_9p_hintinfo"),5,6+(0|this.extraTextElement.width),e),this.stage.addChild(this.extraText9P),this.stage.addChild(this.extraTextElement),this.setExtraTextPosition()},getExtraTextHeight:function(){var t=0;return null!=this.extraTextElement&&(t+=6+(0|this.extraTextElement.height)),null!=this.headerTextElement&&(t+=6+(0|this.headerTextElement.height)),t},update:function(t){!!(this.isActive()&&this.arrowTime>=this.onlyVisibleAfter)&&null!=this.getPointsTo()&&this.useCircle&&0<this.circleTme&&(this.circleTme-=.015*t+.04*t*(this.circleTme/(Math.PI/2))),this.arrowTime+=t,this.setPosition(),this.setExtraTextPosition(),null!=this.closeButton&&(this.closeButton.texture=this.closeButtonTextures[this.currentCloseButtonAnim],this.currentCloseButtonAnim=0)},destroy:function(){this.sprite.destroy(),null!=this.extraText9P&&this.extraText9P.destroy(),null!=this.extraTextElement&&this.extraTextElement.destroy(),null!=this.headerTextElement&&this.headerTextElement.destroy(),null!=this.closeButton&&this.closeButton.destroy()},setPosition:function(){var t;if(!!(this.isActive()&&this.arrowTime>=this.onlyVisibleAfter)&&null!=(t=this.getPointsTo())&&null!=this.sprite&&null!=this.sprite.texture){switch(this.direction._hx_index){case 0:this.sprite.position.set(t.rect.get_center().x,t.rect.y-2-2*Math.sin(this.arrowTime/10));break;case 1:this.sprite.position.set(t.rect.get_x2()+2+2*Math.sin(this.arrowTime/10),t.rect.get_center().y);break;case 2:this.pleaseAlignExtraTextRight?this.sprite.position.set(this.gui.game.rect.width-5-this.sprite.width-this.gui.safeAreaRight,t.rect.y-2):this.sprite.position.set(t.rect.get_center().x,t.rect.y-2);break;case 3:this.pleaseAlignExtraTextRight?this.sprite.position.set(this.gui.game.rect.width-5-this.sprite.width-this.gui.safeAreaRight,t.rect.get_y2()):this.sprite.position.set(t.rect.get_center().x,t.rect.get_y2())}this.useCircle&&0<this.circleTme?(this.sprite.position.x<this.gui.game.rect.width/2?this.sprite.rotation=this.circleTme:this.sprite.rotation=-this.circleTme,this.sprite.position.set(Math.cos(this.circleTme)*(this.sprite.position.x-this.gui.game.rect.width/2)+this.gui.game.rect.width/2,Math.sin(this.circleTme)*(this.gui.game.rect.height/2-this.sprite.position.y)+this.sprite.position.y),this.sprite.alpha=Math.cos(this.circleTme)):(this.sprite.rotation=0,this.sprite.alpha=1),this.sprite.visible=!0}else this.sprite.visible=!1},setExtraTextPosition:function(){var t;if(null!=this.extraText9P)if(!!(this.isActive()&&this.arrowTime>=this.onlyVisibleAfter)&&null!=(t=this.getPointsTo())){switch(this.direction._hx_index){case 0:t.rect.get_center().x>this.extraText9P.width+5+Math.floor(this.sprite.width/2)?this.extraText9P.position.set(t.rect.get_center().x-Math.floor(this.sprite.width/2)-2-this.extraText9P.width,t.rect.y-2-this.extraText9P.height):this.extraText9P.position.set(t.rect.get_center().x+Math.floor(this.sprite.width/2)+2,t.rect.y-2-this.extraText9P.height);break;case 1:t.rect.get_x2()+this.extraText9P.width>this.gui.game.rect.width?this.extraText9P.position.set(this.gui.game.rect.width-this.extraText9P.width-5,t.rect.get_center().y-2-Math.floor(this.sprite.height/2)-this.extraText9P.height):this.extraText9P.position.set(t.rect.get_x2(),t.rect.get_center().y-2-Math.floor(this.sprite.height/2)-this.extraText9P.height);break;case 2:this.pleaseAlignExtraTextRight?this.extraText9P.position.set(this.gui.game.rect.width-5-this.extraText9P.width,t.rect.y-2-this.sprite.height-this.extraText9P.height):t.rect.get_center().x>this.extraText9P.width+5+Math.floor(this.sprite.width/2)?this.extraText9P.position.set(t.rect.get_center().x-this.extraText9P.width+Math.floor(this.sprite.width/2),t.rect.y-2-this.sprite.height-this.extraText9P.height):t.rect.get_center().x-this.sprite.width+this.extraText9P.width<this.gui.game.rect.width?this.extraText9P.position.set(t.rect.get_center().x-Math.floor(this.sprite.width/2),t.rect.y-2-this.sprite.height-this.extraText9P.height):this.extraText9P.position.set(5,t.rect.y-2-this.sprite.height-this.extraText9P.height);break;case 3:this.pleaseAlignExtraTextRight?this.extraText9P.position.set(this.gui.game.rect.width-5-this.extraText9P.width,t.rect.get_y2()+this.sprite.height):t.rect.get_center().x>this.extraText9P.width+5+Math.floor(this.sprite.width/2)?this.extraText9P.position.set(t.rect.get_center().x-this.extraText9P.width+Math.floor(this.sprite.width/2),t.rect.get_y2()+this.sprite.height):t.rect.get_center().x-this.sprite.width+this.extraText9P.width<this.gui.game.rect.width?this.extraText9P.position.set(t.rect.get_center().x-Math.floor(this.sprite.width/2),t.rect.get_y2()+this.sprite.height):this.extraText9P.position.set(5,t.rect.get_y2()+this.sprite.height)}null!=this.headerTextElement?(this.headerTextElement.position.set(this.extraText9P.position.x+3,this.extraText9P.position.y+1),this.extraTextElement.position.set(this.extraText9P.position.x+3,this.extraText9P.position.y+5+this.headerTextElement.height),null!=this.closeButton&&this.closeButton.position.set(this.extraText9P.position.x+this.extraText9P.width-this.closeButton.width,this.extraText9P.position.y),this.headerTextElement.visible=!0,this.closeButton.visible=!0):this.extraTextElement.position.set(this.extraText9P.position.x+3,this.extraText9P.position.y+2),this.extraTextElement.visible=!0,this.extraText9P.visible=!0}else this.extraText9P.visible=!1,this.extraTextElement.visible=!1,null!=this.headerTextElement&&(this.headerTextElement.visible=!1,this.closeButton.visible=!1)},__class__:Ds};var Fs=function(t,e){this.alwaysUpdateChild=!1,this.visible=!0,this.parent=t,this.isShown=e,this.rect=new yr(0,0,0,0)};(q["gui.HideableContainer"]=Fs).__name__="gui.HideableContainer",Fs.__interfaces__=[Qr],Fs.prototype={show:function(){this.visible=!0,this.updateSize()},hide:function(){this.visible=!1,this.child.updatePosition(new vr(-1e4,-1e4)),this.updateSize()},setChild:function(t){this.child=t,this.updateSize(),null!=this.isShown&&(this.visible=this.isShown(),this.visible||this.hide())},updateSize:function(){this.visible&&null!=this.child?this.rect=this.child.rect:(this.rect.width=0,this.rect.height=0),null!=this.parent&&this.parent.updateSize()},updatePosition:function(t){this.visible&&null!=this.child&&this.child.updatePosition(t)},destroy:function(){null!=this.child&&this.child.destroy()},handleMouse:function(t){return!(!this.visible||null==this.child)&&this.child.handleMouse(t)},update:function(){if(null!=this.isShown){var t=this.isShown();t!=this.visible&&(this.visible=t,this.visible?this.show():this.hide())}(this.visible||this.alwaysUpdateChild)&&null!=this.child&&this.child.update()},__class__:Fs};var Ns=function(){};(q["gui.HouseInformationWindow"]=Ns).__name__="gui.HouseInformationWindow",Ns.create=function(t,e,i,n){Ns.createWindow(t,e,i,n)},Ns.createWindow=function(a,n,t,e){n.windowAllowBanner(),e.clear(),n.windowAddTitleText(Tr.lo("housing_information"),null,dt.getTexture("spr_housing")),e.addChild(new ao(e,t,null,function(){return Ns.getHousingHelpText(a.simulation.stats)})),a.simulation.stats.peopleWithHome<a.simulation.stats.people&&(Io.create(a.gui,function(){var t=gr.findRandom(a.simulation.citizens,function(t){return null==t.home});null!=t&&Ss.createWindow(a,t,!1)},a.gui.windowInner,function(){return Tr.lo("find_homeless")},a.gui.innerWindowStage),e.addChild(new Ms(e,new vr(2,6))));for(var i=[],r=[],s=0,o=a.permanents;s<o.length;){var l=o[s];if(++s,l.is(re)){var h=Ko.getClass(l);if(-1==(v=i.indexOf(h))){v=i.length,i.push(h);var u=h.__name__.split(".");r.push(u[u.length-1])}}}var c=[];for(s=0,o=a.progress.resources.buildingInfoArray;s<o.length;){var d=o[s];++s,-1!=(v=r.indexOf(d.className))&&c.push(i[v])}function p(){f=[];for(var t=0;t<c.length;){c[t];++t,f.push({number:0,filledHousing:0,housing:0})}t=0;for(var e=a.permanents;t<e.length;){var i=e[t];if(++t,i.is(re)){var n=i,r=Ko.getClass(i),s=c.indexOf(r);if(-1!=s){var o=f[s];o.housing+=n.get_residentCapacity(),o.filledHousing+=n.residents.length,o.number+=1}}}}var f=[];p(),e.onUpdate=p;var g={left:2,top:5,bottom:0,right:0},m=new ps(n,t,e),y=new ps(n,t,m),_=new ps(n,t,m);y.direction=Ps.Vertical,_.direction=Ps.Vertical;for(s=0,o=c.length;s<o;){var v=[s++],b=c[v[0]],w=(b.__name__,f[v[0]]),S=new ps(n,t,y),x=new PIXI.Container,T=F.field(b,"spriteName"),I=a.progress.resources.buildingInfo,P=b.__name__,C=[I.h[P]];"none"!=C[0].buttonBack&&x.addChild(dt.makeSprite(null==C[0].buttonBack?T+"@44,0,20,20":C[0].buttonBack)),x.addChild(dt.makeSprite(T+"@0,0,20,20"));var E=[null];E[0]=new ds(S,t,x,null,null,function(e,i){return function(t){return!!e[0].rect.contains(t.position)&&(n.tooltip.setText(e[0],i[0].name),!0)}}(E,C)),S.addChild(E[0]);var A=new ps(n,t,S,null,null,null,null,g);A.addChild(new ao(A,t,"x"+w.number+": ")),S.addChild(A),y.addChild(S);var M=new ps(n,t,_,null,null,null,null,g);M.minHeight=15,M.addChild(new ao(M,t,null,function(t){return function(){return Tr.lo("residents",[f[t[0]].filledHousing,f[t[0]].housing])}}(v))),_.addChild(M)}0==c.length&&n.windowAddInfoText(Tr.lo("there_are_no_houses")),m.addChild(y),m.addChild(_),e.addChild(m);s=Uh(N=a.gui,N.reloadWindow);function B(){Ns.createWindow(R,O,k,D)}var R=a,O=n,k=t,D=e;a.windowRelatedOnBuildOrDestroy=function(){s(B)},e.onDestroy=function(){a.windowRelatedOnBuildOrDestroy=null},n.windowAddBottomButtons()},Ns.getHousingHelpText=function(t){if(t.peopleWithHome>=t.people)return t.houseCapacity==t.peopleWithHome?Tr.lo("houses_exactly_enough"):Tr.lo("house_n_cap_remaining",[t.houseCapacity-t.peopleWithHome]);var e=t.people-t.peopleWithHome;return 1==e?Tr.lo("homeless_one"):Tr.lo("homeless_n",[e])};function Ls(t){PIXI.Container.call(this),this.setDisplay(t)}(q["gui.IconListDisplay"]=Ls).__name__="gui.IconListDisplay",Ls.__super__=PIXI.Container,Ls.prototype=e(PIXI.Container.prototype,{wouldChangeDisplay:function(t){if(this.displayedIcons.length!=t.length)return!0;for(var e=0,i=this.displayedIcons.length;e<i;){var n=e++;if(t[n].texture!=this.displayedIcons[n].texture||t[n].text!=this.displayedIcons[n].text)return!0}return!1},setDisplay:function(t){this.displayedIcons=t;for(var e=this.children.length;0<=--e;){var i=this.children[e];this.removeChildAt(e),i.destroy({children:!0})}for(var n=0,r=0;r<t.length;){var s=t[r];++r;var o=new PIXI.Sprite(s.texture);o.position.x=n,this.addChild(o),n+=2+(0|o.width);var a=s.text,l=0;"[red]"==at.substr(s.text,0,"[red]".length)&&(a=at.substr(a,"[red]".length,null),l=16711680);var h=new Ur(a,{font:"Arial",tint:l});"1"==a&&--n,h.position.set(n,-1),"1"==a&&--n,this.addChild(h),n+=3+(0|h.get_textWidth())}this.displayWidth=n},__class__:Ls});var Us=function(t,e,i,n,r,s,o,a,l,h){null==h&&(h=1),null==l&&(l="spr_buildingbutton"),this.needsAttention=!1,this.attentionGetterSprite=null,this.imageSpriteOffset=1,this.removeNotificationEver=!0,this.removeNotificationOnHover=!0,this.shown=!0,ns.call(this,t,e,i,n,s,o),this.buttonTextures=dt.getTextures(l,3),this.buttonSprite=new PIXI.Sprite(this.buttonTextures[0]),e.addChild(this.buttonSprite),null!=a&&(this.imageSpriteBack=new PIXI.Sprite(a),this.imageSpriteBack.position.set(1,1),e.addChild(this.imageSpriteBack)),this.imageSpriteOffset=h,this.imageSprite=new PIXI.Sprite(r),this.imageSprite.position.set(h,h),e.addChild(this.imageSprite),this.rect=new yr(0,0,(0|r.width)+2*h,(0|r.height)+2*h)};(q["gui.ImageButton"]=Us).__name__="gui.ImageButton",Us.__super__=ns,Us.prototype=e(ns.prototype,{updateTexture:function(t){this.imageSprite.texture=t},updatePosition:function(t){ns.prototype.updatePosition.call(this,t),this.buttonSprite.position.set(t.x,t.y),this.imageSprite.position.set(t.x+this.imageSpriteOffset,t.y+this.imageSpriteOffset),null!=this.imageSpriteBack&&this.imageSpriteBack.position.set(t.x+1,t.y+1),null!=this.imageSpriteForeground&&this.imageSpriteForeground.position.set(t.x,t.y),null!=this.attentionGetterSprite&&this.attentionGetterSprite.position.set(t.x,t.y)},handleMouse:function(t){var e=this;return!!this.shown&&ns.prototype.doHandleMouse.call(this,t,function(){e.buttonSprite.texture=e.buttonTextures[1],e.removeNotificationOnHover&&e.stopNotify()},function(){e.buttonSprite.texture=e.buttonTextures[2],e.removeNotificationEver&&e.stopNotify()})},update:function(){this.mouseOut&&(this.buttonSprite.texture=this.buttonTextures[0]),this.isActive()&&(this.buttonSprite.texture=this.buttonTextures[2]),this.updateNeedsAttention(),ns.prototype.update.call(this)},mirror:function(){var t;null!=(t=this.imageSprite)&&(t.anchor.set(1,0),t.scale.set(-1,1)),null!=(t=this.imageSpriteBack)&&(t.anchor.set(1,0),t.scale.set(-1,1)),null!=(t=this.imageSpriteForeground)&&(t.anchor.set(1,0),t.scale.set(-1,1))},setNeedsAttention:function(t){null==t&&(t=!1),this.needsAttention=t,this.updateNeedsAttention()},updateNeedsAttention:function(){if(null!=this.buttonSprite)if(this.needsAttention&&this.buttonSprite.texture==this.buttonTextures[0]){null==this.attentionGetterSprite&&(this.attentionGetterSprite=new PIXI.Sprite(dt.getTexture("spr_whiteoutline")),this.attentionGetterSprite.position.set(this.buttonSprite.position.x,this.buttonSprite.position.y),null!=this.buttonSprite.parent&&this.buttonSprite.parent.addChild(this.attentionGetterSprite));var t=hh.toRgb([89,1,.77]);this.attentionGetterSprite.tint=mr.toHexInt(t),this.attentionGetterSprite.alpha=(Math.sin(this.gui.guiTimer/10)+1)/2}else null!=this.attentionGetterSprite&&(this.needsAttention?this.attentionGetterSprite.alpha=0:(this.attentionGetterSprite.destroy(),this.attentionGetterSprite=null))},destroy:function(){ns.prototype.destroy.call(this),null!=this.buttonSprite.texture&&(this.buttonSprite.destroy(),this.imageSprite.destroy(),null!=this.imageSpriteBack&&this.imageSpriteBack.destroy(),null!=this.imageSpriteForeground&&(this.imageSpriteForeground.destroy(),this.imageSpriteForeground=null),null!=this.attentionGetterSprite&&(this.attentionGetterSprite.destroy(),this.attentionGetterSprite=null))},hide:function(){null!=this.imageSpriteBack&&(this.imageSpriteBack.visible=!1),this.imageSprite.visible=!1,this.buttonSprite.visible=!1,null!=this.imageSpriteForeground&&(this.imageSpriteForeground.visible=!1),null!=this.attentionGetterSprite&&(this.attentionGetterSprite.visible=!1),this.shown=!1},show:function(){null!=this.imageSpriteBack&&(this.imageSpriteBack.visible=!0),this.imageSprite.visible=!0,this.buttonSprite.visible=!0,null!=this.imageSpriteForeground&&(this.imageSpriteForeground.visible=!0),null!=this.attentionGetterSprite&&(this.attentionGetterSprite.visible=!0),this.shown=!0},notify:function(t,e){if(this.removeNotificationOnHover=t,null==this.imageSpriteForeground){this.imageSpriteForeground=new PIXI.Sprite(dt.getTexture("spr_buttonnotification"));var i=this.rect,n=i.x,r=i.y,s=new PIXI.Point(n,r);this.imageSpriteForeground.position=s,this.stage.addChild(this.imageSpriteForeground),this.doOnStopNotify=e}},addExtraSprite:function(t){if(null==this.imageSpriteForeground){this.removeNotificationOnHover=!1,this.removeNotificationEver=!1,this.imageSpriteForeground=new PIXI.Sprite(dt.getTexture(t));var e=this.rect,i=e.x,n=e.y,r=new PIXI.Point(i,n);this.imageSpriteForeground.position=r,this.stage.addChild(this.imageSpriteForeground)}},stopNotify:function(){null!=this.imageSpriteForeground&&(this.imageSpriteForeground.destroy(),this.imageSpriteForeground=null,this.doOnStopNotify())},__class__:Us});var zs=function(t,e,i,n,r,s,o,a,l){null==a&&(a="spr_9p_info"),null==s&&(s=0),this.showingInfinitySign=!1,this.additionalSprite=null,this.shouldShowInfinitySign=null==l?function(){return!1}:l;var h="none"==a?null:new Ys(dt.getTexture(a),2,10,14),u=t.game.isMobile?3:0;ps.call(this,t,e,i,null,null,null,h,{left:2+u,right:2+u,top:2+u,bottom:u-1}),this.fillSecondarySize=!0,this.fillPrimarySize=!0,this.onHover=o,this.minWidth=s,this.onTextUpdate=n,this.shouldShowInfinitySign=l,this.spriteContainer=new PIXI.Sprite(r),null!=r&&this.addChild(new ds(this,e,this.spriteContainer)),this.createSecondElement()};(q["gui.InfoBox"]=zs).__name__="gui.InfoBox",zs.__super__=ps,zs.prototype=e(ps.prototype,{update:function(){this.shouldShowInfinitySign()!=this.showingInfinitySign&&(this.removeChild(this.secondElement,!1),this.createSecondElement()),ps.prototype.update.call(this)},createSecondElement:function(){if(this.showingInfinitySign=this.shouldShowInfinitySign(),this.showingInfinitySign)this.secondElement=this.addChild(new ds(this,this.stage,new PIXI.Sprite(dt.getTexture("spr_icon_unlimited"))));else{var t=this.gui.game.isMobile?2:0;this.secondElement=new ao(this,this.stage,null,this.onTextUpdate,null,{left:1+t,right:1,top:1,bottom:0},null,!1,!0),this.addChild(this.secondElement)}},setAdditionalSprite:function(t){if(null==t)return null!=this.additionalSprite&&this.additionalSprite.destroy(),void(this.additionalSprite=null);null==this.additionalSprite&&(this.additionalSprite=new PIXI.Sprite),this.additionalSprite.texture=t,this.spriteContainer.addChild(this.additionalSprite)},hasAdditionalSprite:function(){return null!=this.additionalSprite},handleMouse:function(t){return!!this.rect.contains(t.position)&&(null!=this.onHover&&this.onHover(),t.claimMouse(this),!0)},updateSize:function(){ps.prototype.updateSize.call(this),this.minWidth=this.baseWidth},__class__:zs});var Ws=function(){};(q["gui.LanguageSelectWindow"]=Ws).__name__="gui.LanguageSelectWindow",Ws.changeLanguage=function(t,e,i){O.language=e,O.save(),Tr.loadLanguage(e,!1,function(){Tr.translateFiles(t.progress.resources.buildingInfoArray),Tr.translateStory(t.progress.story.storyName,t.progress.story.storyInfo),i.onLanguageChange()},function(){})},Ws.create=function(e,i,t,n){e.game;i.windowAddTitleText(Tr.lo("language")),i.windowAddInfoText("Full Translations:",null,"Arial15");for(var r=0,s=Ws.languages;r<s.length;){var o=s[r];++r;var a=[o];po.createActivatableButton(i,O.language==a[0].code,function(t){return function(){Ws.changeLanguage(e,t[0].code,i)}}(a),a[0].name,"",i.windowInner)}n.addChild(new Ms(n,new vr(2,4))),i.windowAddInfoText("(Partially) Machine Translated:",null,"Arial15");for(r=0,s=Ws.languagesSecondary;r<s.length;){o=s[r];++r;var l=[o];po.createActivatableButton(i,O.language==l[0].code,function(t){return function(){Ws.changeLanguage(e,t[0].code,i)}}(l),l[0].name,"",i.windowInner)}n.addChild(new Ms(n,new vr(2,4))),n.addChild(new Ms(n,new vr(2,6))),i.windowAddBottomButtons()};var Gs=function(t,e){p.call(this,t,e)};(q["gui.MainMenuGUI"]=Gs).__name__="gui.MainMenuGUI",Gs.createNewScenarioWindow=function(n,r,s){r.createWindow();var t=n,e=r,i=s;r.addWindowToStack(function(){Gs.createNewScenarioWindow(t,e,i)}),r.windowAddTitleText(Tr.lo("start_scenario"));for(var o=dt.allStoriesInfo,a=0;a<o.length;){var l=o[a];++a,!l.freePlay&&Ka.hasCompletedRequirements(n,l)&&Gs.addStoryToWindow(n,r,l)}if(Ka.shouldShowUnlockAllStoriesButton(n)){var h=new us(r,r.innerWindowStage,r.windowInner,function(){n.metaGame.unlockAll();var t=n,e=r,i=s;r.reloadWindow(function(){Gs.createNewScenarioWindow(t,e,i)})});h.container.padding.top=3,h.container.padding.left=3,h.container.padding.right=3,h.container.padding.bottom=1,h.container.fillSecondarySize=!0,h.container.addChild(new ao(h.container,r.innerWindowStage,Tr.lo("unlock_all"))),r.windowInner.addChild(h)}r.windowInner.addChild(new Ms(r.windowInner,new vr(4,6))),r.windowAddInfoText(Tr.lo("free_play")+":",null,"Arial");for(a=0;a<o.length;){l=o[a];++a,l.freePlay&&Ka.hasCompletedRequirements(n,l)&&Gs.addStoryToWindow(n,r,l)}r.windowAddBottomButtons(),r.windowOnDestroy=s},Gs.createPlayedBeforeWindow=function(e,t,i){t.createWindow(),t.clearWindowStack();var n=e,r=t,s=i;t.addWindowToStack(function(){Gs.createPlayedBeforeWindow(n,r,s)}),t.windowAddTitleText(Tr.lo("welcome_back")),po.createActivatableButton(t,!1,function(){},Tr.lo("import_city"),Tr.lo("got_export"),t.windowInner).button.onHover=function(){e.setOnClickTo=function(){var t=window.document.getElementById("importFile");t.value="",t.click(),e.onClick=null}},po.createActivatableButton(t,!1,function(){Gs.createNewScenarioWindow(e,t,i)},Tr.lo("new_city"),Tr.lo("new_city_explain"),t.windowInner),t.windowAddBottomButtons(),t.windowOnDestroy=i},Gs.addStoryToWindow=function(t,e,i){var n="";if(t.metaGame.hasWonScenario(i.link)){var r=t.metaGame.getScenarioTime(i.link);n=Tr.lo("best_time",[r/1440|0,(r/60|0)%24,r%60])+" \n","multipleWorlds"==i.link?dr.achieve("MULTIPLE_WORLDS_WIN"):"rocketLaunch"==i.link&&dr.achieve("ROCKETLAUNCH_WIN")}n+=i.description,po.createActivatableButton(e,!1,function(){e.windowOnDestroy;e.windowOnDestroy=null,t.createNewGameState(i.link)},C.replace(C.replace(i.name,"Free Play - ",""),Tr.lo("free_play")+" - ",""),n,e.windowInner)},Gs.__super__=p,Gs.prototype=e(p.prototype,{createPlayWindow:function(t){Gs.createNewScenarioWindow(this.game,this,t)},doCreatePlayedBeforeWindow:function(t){Gs.createPlayedBeforeWindow(this.game,this,t)},__class__:Gs});var Hs=function(t,e,i){null==i&&(i=""),this.afterKnowledgeText=" "+Tr.lo("to_research"),this.maxDisplayWidth=-1,this.displayCityAmounts=!1,PIXI.Container.call(this),this.city=t,this.materialDisplayedRed=new Vo,this.materialDisplayedRed.h.food=!1,this.materialDisplayedRed.h.wood=!1,this.materialDisplayedRed.h.stone=!1,this.materialDisplayedRed.h.machineParts=!1,this.materialDisplayedRed.h.refinedMetal=!1,this.materialDisplayedRed.h.computerChips=!1,this.materialDisplayedRed.h.cacao=!1,this.materialDisplayedRed.h.chocolate=!1,this.materialDisplayedRed.h.graphene=!1,this.materialDisplayedRed.h.rocketFuel=!1;for(var n=0,r=ct.modMaterials;n<r.length;){var s=r[n];++n;var o=s.variableName;this.materialDisplayedRed.h[o]=!1}this.materialDisplayedRed.h.knowledge=!1,this.beforeKnowledgeText=i,this.cost=e,this.cityAmountDisplayed=null,this.updateCostDisplay()};(q["gui.MaterialsCostDisplay"]=Hs).__name__="gui.MaterialsCostDisplay",Hs.__super__=PIXI.Container,Hs.prototype=e(PIXI.Container.prototype,{setAfterKnowledgeText:function(t){this.afterKnowledgeText=t},setBeforeKnowledgeText:function(t){this.beforeKnowledgeText=t},setCost:function(t){this.cost=t,this.updateCostDisplay()},updateCostDisplay:function(){for(var t=this,e=!1,i=!0;i;){i=!1;for(var n=this.children.length;0<=--n;){var r=this.children[n];this.removeChildAt(n),r.destroy({children:!0})}var s=[0],o=!1,a=!1;if(0<this.cost.food){s[0]-=2,a=!0;var l=new PIXI.Sprite(dt.getTexture("spr_resource_"+"food".toLowerCase()));l.position.x=s[0],this.addChild(l),s[0]+=1+(0|l.width),s[0]-=2;var h="";!this.displayCityAmounts||e||this.city.progress.sandbox.unlimitedResources||(h=Pr.largeNumberFormat(Math,0|this.city.materials.food)+"/");var u=null!=this.city&&this.city.materials.food<this.cost.food,c=new Ur(h+this.cost.food+"",{font:"Arial",tint:null!=this.city&&u?16711680:0});this.materialDisplayedRed.h.food=u,c.position.set(s[0],-1),this.addChild(c),s[0]+=3+(0|c.get_textWidth())}else this.materialDisplayedRed.h.food=!1;if(0<this.cost.wood){a=!0;var d=new PIXI.Sprite(dt.getTexture("spr_resource_"+"wood".toLowerCase()));d.position.x=s[0],this.addChild(d),s[0]+=1+(0|d.width);var p="";!this.displayCityAmounts||e||this.city.progress.sandbox.unlimitedResources||(p=Pr.largeNumberFormat(Math,0|this.city.materials.wood)+"/");var f=null!=this.city&&this.city.materials.wood<this.cost.wood,g=new Ur(p+this.cost.wood+"",{font:"Arial",tint:null!=this.city&&f?16711680:0});this.materialDisplayedRed.h.wood=f,g.position.set(s[0],-1),this.addChild(g),s[0]+=3+(0|g.get_textWidth())}else this.materialDisplayedRed.h.wood=!1;if(0<this.cost.stone){a=!0;var m=new PIXI.Sprite(dt.getTexture("spr_resource_"+"stone".toLowerCase()));m.position.x=s[0],this.addChild(m),s[0]+=1+(0|m.width);var y="";!this.displayCityAmounts||e||this.city.progress.sandbox.unlimitedResources||(y=Pr.largeNumberFormat(Math,0|this.city.materials.stone)+"/");var _=null!=this.city&&this.city.materials.stone<this.cost.stone,v=new Ur(y+this.cost.stone+"",{font:"Arial",tint:null!=this.city&&_?16711680:0});this.materialDisplayedRed.h.stone=_,v.position.set(s[0],-1),this.addChild(v),s[0]+=3+(0|v.get_textWidth())}else this.materialDisplayedRed.h.stone=!1;if(0<this.cost.machineParts){a=!0;var b=new PIXI.Sprite(dt.getTexture("spr_resource_"+"machineParts".toLowerCase()));b.position.x=s[0],this.addChild(b),s[0]+=1+(0|b.width);var w="";!this.displayCityAmounts||e||this.city.progress.sandbox.unlimitedResources||(w=Pr.largeNumberFormat(Math,0|this.city.materials.machineParts)+"/");var S=null!=this.city&&this.city.materials.machineParts<this.cost.machineParts,x=new Ur(w+this.cost.machineParts+"",{font:"Arial",tint:null!=this.city&&S?16711680:0});this.materialDisplayedRed.h.machineParts=S,x.position.set(s[0],-1),this.addChild(x),s[0]+=3+(0|x.get_textWidth())}else this.materialDisplayedRed.h.machineParts=!1;if(0<this.cost.refinedMetal){a=!0;var T=new PIXI.Sprite(dt.getTexture("spr_resource_"+"refinedMetal".toLowerCase()));T.position.x=s[0],this.addChild(T),s[0]+=1+(0|T.width);var I="";!this.displayCityAmounts||e||this.city.progress.sandbox.unlimitedResources||(I=Pr.largeNumberFormat(Math,0|this.city.materials.refinedMetal)+"/");var P=null!=this.city&&this.city.materials.refinedMetal<this.cost.refinedMetal,C=new Ur(I+this.cost.refinedMetal+"",{font:"Arial",tint:null!=this.city&&P?16711680:0});this.materialDisplayedRed.h.refinedMetal=P,C.position.set(s[0],-1),this.addChild(C),s[0]+=3+(0|C.get_textWidth())}else this.materialDisplayedRed.h.refinedMetal=!1;if(0<this.cost.computerChips){a=!0;var E=new PIXI.Sprite(dt.getTexture("spr_resource_"+"computerChips".toLowerCase()));E.position.x=s[0],this.addChild(E),s[0]+=1+(0|E.width);var A="";!this.displayCityAmounts||e||this.city.progress.sandbox.unlimitedResources||(A=Pr.largeNumberFormat(Math,0|this.city.materials.computerChips)+"/");var M=null!=this.city&&this.city.materials.computerChips<this.cost.computerChips,B=new Ur(A+this.cost.computerChips+"",{font:"Arial",tint:null!=this.city&&M?16711680:0});this.materialDisplayedRed.h.computerChips=M,B.position.set(s[0],-1),this.addChild(B),s[0]+=3+(0|B.get_textWidth())}else this.materialDisplayedRed.h.computerChips=!1;if(0<this.cost.cacao){a=!0;var R=new PIXI.Sprite(dt.getTexture("spr_resource_"+"cacao".toLowerCase()));R.position.x=s[0],this.addChild(R),s[0]+=1+(0|R.width);var O="";!this.displayCityAmounts||e||this.city.progress.sandbox.unlimitedResources||(O=Pr.largeNumberFormat(Math,0|this.city.materials.cacao)+"/");var k=null!=this.city&&this.city.materials.cacao<this.cost.cacao,D=new Ur(O+this.cost.cacao+"",{font:"Arial",tint:null!=this.city&&k?16711680:0});this.materialDisplayedRed.h.cacao=k,D.position.set(s[0],-1),this.addChild(D),s[0]+=3+(0|D.get_textWidth())}else this.materialDisplayedRed.h.cacao=!1;if(0<this.cost.chocolate){a=!0;var F=new PIXI.Sprite(dt.getTexture("spr_resource_"+"chocolate".toLowerCase()));F.position.x=s[0],this.addChild(F),s[0]+=1+(0|F.width);var N="";!this.displayCityAmounts||e||this.city.progress.sandbox.unlimitedResources||(N=Pr.largeNumberFormat(Math,0|this.city.materials.chocolate)+"/");var L=null!=this.city&&this.city.materials.chocolate<this.cost.chocolate,U=new Ur(N+this.cost.chocolate+"",{font:"Arial",tint:null!=this.city&&L?16711680:0});this.materialDisplayedRed.h.chocolate=L,U.position.set(s[0],-1),this.addChild(U),s[0]+=3+(0|U.get_textWidth())}else this.materialDisplayedRed.h.chocolate=!1;if(0<this.cost.graphene){a=!0;var z=new PIXI.Sprite(dt.getTexture("spr_resource_"+"graphene".toLowerCase()));z.position.x=s[0],this.addChild(z),s[0]+=1+(0|z.width);var W="";!this.displayCityAmounts||e||this.city.progress.sandbox.unlimitedResources||(W=Pr.largeNumberFormat(Math,0|this.city.materials.graphene)+"/");var G=null!=this.city&&this.city.materials.graphene<this.cost.graphene,H=new Ur(W+this.cost.graphene+"",{font:"Arial",tint:null!=this.city&&G?16711680:0});this.materialDisplayedRed.h.graphene=G,H.position.set(s[0],-1),this.addChild(H),s[0]+=3+(0|H.get_textWidth())}else this.materialDisplayedRed.h.graphene=!1;if(0<this.cost.rocketFuel){a=!0;var X=new PIXI.Sprite(dt.getTexture("spr_resource_"+"rocketFuel".toLowerCase()));X.position.x=s[0],this.addChild(X),s[0]+=1+(0|X.width);var j="";!this.displayCityAmounts||e||this.city.progress.sandbox.unlimitedResources||(j=Pr.largeNumberFormat(Math,0|this.city.materials.rocketFuel)+"/");var V=null!=this.city&&this.city.materials.rocketFuel<this.cost.rocketFuel,Y=new Ur(j+this.cost.rocketFuel+"",{font:"Arial",tint:null!=this.city&&V?16711680:0});this.materialDisplayedRed.h.rocketFuel=V,Y.position.set(s[0],-1),this.addChild(Y),s[0]+=3+(0|Y.get_textWidth())}else this.materialDisplayedRed.h.rocketFuel=!1;for(var q=0,K=ct.modMaterials;q<K.length;){var $=K[q];++q;var Q=$.variableName;if(0<this.cost[Q]){if("food"==Q)s[0]-=2;else if("knowledge"==Q&&""!=this.beforeKnowledgeText&&a){var J=new Ur(this.beforeKnowledgeText,{font:"Arial",tint:0});J.position.set(s[0],-1),this.addChild(J),o=!0,s[0]+=3+(0|J.get_textWidth())}a=!0;var Z=new PIXI.Sprite(dt.getTexture("spr_resource_"+Q.toLowerCase()));Z.position.x=s[0],this.addChild(Z),s[0]+=1+(0|Z.width),"food"==Q&&(s[0]-=2);var tt="",et="";!this.displayCityAmounts||e||this.city.progress.sandbox.unlimitedResources||(et=Pr.largeNumberFormat(Math,0|this.city.materials[Q])+"/"),"knowledge"!=Q||e||(tt=this.afterKnowledgeText);var it=null!=this.city&&this.city.materials[Q]<this.cost[Q],nt=new Ur(et+this.cost[Q]+tt,{font:"Arial",tint:null!=this.city&&it?16711680:0});this.materialDisplayedRed.h[Q]=it,nt.position.set(s[0],-1),this.addChild(nt),s[0]+=3+(0|nt.get_textWidth())}else this.materialDisplayedRed.h[Q]=!1}if(0<this.cost.knowledge){if(""!=this.beforeKnowledgeText&&a){var rt=new Ur(this.beforeKnowledgeText,{font:"Arial",tint:0});rt.position.set(s[0],-1),this.addChild(rt),o=!0,s[0]+=3+(0|rt.get_textWidth())}a=!0;var st=new PIXI.Sprite(dt.getTexture("spr_resource_"+"knowledge".toLowerCase()));st.position.x=s[0],this.addChild(st),s[0]+=1+(0|st.width);var ot="",at="";!this.displayCityAmounts||e||this.city.progress.sandbox.unlimitedResources||(at=Pr.largeNumberFormat(Math,0|this.city.materials.knowledge)+"/"),e||(ot=this.afterKnowledgeText);var lt=null!=this.city&&this.city.materials.knowledge<this.cost.knowledge,ht=new Ur(at+this.cost.knowledge+ot,{font:"Arial",tint:null!=this.city&&lt?16711680:0});this.materialDisplayedRed.h.knowledge=lt,ht.position.set(s[0],-1),this.addChild(ht),s[0]+=3+(0|ht.get_textWidth())}else this.materialDisplayedRed.h.knowledge=!1;if(!o&&""!=this.beforeKnowledgeText){var ut=new Ur(this.beforeKnowledgeText,{font:"Arial",tint:0});ut.position.set(s[0],-1),this.addChild(ut),s[0]+=3+(0|ut.get_textWidth())}(function(t){})(s);this.displayWidth=s[0],!e&&0<this.maxDisplayWidth&&s[0]>this.maxDisplayWidth&&(i=e=!0)}null!=this.city&&(this.cityAmountDisplayed=this.city.materials.copy())},wouldChangeDisplay:function(t){if(this.displayCityAmounts){if(null==this.cityAmountDisplayed)return!0;if(this.cityAmountDisplayed.anyMaterialDifferent(this.city.materials))return!0}if(t.food!=this.cost.food)return!0;var e=null!=this.city&&this.city.materials.food<t.food;if(this.materialDisplayedRed.h.food!=e)return!0;if(t.wood!=this.cost.wood)return!0;e=null!=this.city&&this.city.materials.wood<t.wood;if(this.materialDisplayedRed.h.wood!=e)return!0;if(t.stone!=this.cost.stone)return!0;e=null!=this.city&&this.city.materials.stone<t.stone;if(this.materialDisplayedRed.h.stone!=e)return!0;if(t.machineParts!=this.cost.machineParts)return!0;e=null!=this.city&&this.city.materials.machineParts<t.machineParts;if(this.materialDisplayedRed.h.machineParts!=e)return!0;if(t.refinedMetal!=this.cost.refinedMetal)return!0;e=null!=this.city&&this.city.materials.refinedMetal<t.refinedMetal;if(this.materialDisplayedRed.h.refinedMetal!=e)return!0;if(t.computerChips!=this.cost.computerChips)return!0;e=null!=this.city&&this.city.materials.computerChips<t.computerChips;if(this.materialDisplayedRed.h.computerChips!=e)return!0;if(t.cacao!=this.cost.cacao)return!0;e=null!=this.city&&this.city.materials.cacao<t.cacao;if(this.materialDisplayedRed.h.cacao!=e)return!0;if(t.chocolate!=this.cost.chocolate)return!0;e=null!=this.city&&this.city.materials.chocolate<t.chocolate;if(this.materialDisplayedRed.h.chocolate!=e)return!0;if(t.graphene!=this.cost.graphene)return!0;e=null!=this.city&&this.city.materials.graphene<t.graphene;if(this.materialDisplayedRed.h.graphene!=e)return!0;if(t.rocketFuel!=this.cost.rocketFuel)return!0;e=null!=this.city&&this.city.materials.rocketFuel<t.rocketFuel;if(this.materialDisplayedRed.h.rocketFuel!=e)return!0;for(var i=0,n=ct.modMaterials;i<n.length;){var r=n[i];++i;var s=r.variableName;if(t[s]!=this.cost[s])return!0;e=null!=this.city&&this.city.materials[s]<t[s];if(this.materialDisplayedRed.h[s]!=e)return!0}if(t.knowledge!=this.cost.knowledge)return!0;e=null!=this.city&&this.city.materials.knowledge<t.knowledge;return this.materialDisplayedRed.h.knowledge!=e},__class__:Hs});var Xs=function(t,e){null==e&&(e=1e3),this.maxWidth=1e3,PIXI.Container.call(this),this.maxWidth=e,this.materials=t,this.updateMaterialsDisplay()};(q["gui.MaterialsDisplay"]=Xs).__name__="gui.MaterialsDisplay",Xs.__super__=PIXI.Container,Xs.prototype=e(PIXI.Container.prototype,{setMaterials:function(t){this.materials=t,this.updateMaterialsDisplay()},updateMaterialsDisplay:function(){for(var t=this.children.length;0<=--t;){var e=this.children[t];this.removeChildAt(t),e.destroy({children:!0})}var i=0,n=0,r=0;0<this.materials.food&&((i-=2)+50>this.maxWidth&&(r<=i&&(r=i),i=0,n=12),(l=new PIXI.Sprite(dt.getTexture("spr_resource_"+"food".toLowerCase()))).position.x=i,l.position.y=n,this.addChild(l),i+=1+(0|l.width),i-=2,(h=new Ur(""+this.materials.food,{font:"Arial",tint:0},!0)).position.set(i,-1+n),this.addChild(h),i+=3+(0|h.get_textWidth()));0<this.materials.wood&&(i+50>this.maxWidth&&(r<=i&&(r=i),i=0,n=12),(l=new PIXI.Sprite(dt.getTexture("spr_resource_"+"wood".toLowerCase()))).position.x=i,l.position.y=n,this.addChild(l),i+=1+(0|l.width),(h=new Ur(""+this.materials.wood,{font:"Arial",tint:0},!0)).position.set(i,-1+n),this.addChild(h),i+=3+(0|h.get_textWidth()));0<this.materials.stone&&(i+50>this.maxWidth&&(r<=i&&(r=i),i=0,n=12),(l=new PIXI.Sprite(dt.getTexture("spr_resource_"+"stone".toLowerCase()))).position.x=i,l.position.y=n,this.addChild(l),i+=1+(0|l.width),(h=new Ur(""+this.materials.stone,{font:"Arial",tint:0},!0)).position.set(i,-1+n),this.addChild(h),i+=3+(0|h.get_textWidth()));0<this.materials.machineParts&&(i+50>this.maxWidth&&(r<=i&&(r=i),i=0,n=12),(l=new PIXI.Sprite(dt.getTexture("spr_resource_"+"machineParts".toLowerCase()))).position.x=i,l.position.y=n,this.addChild(l),i+=1+(0|l.width),(h=new Ur(""+this.materials.machineParts,{font:"Arial",tint:0},!0)).position.set(i,-1+n),this.addChild(h),i+=3+(0|h.get_textWidth()));0<this.materials.refinedMetal&&(i+50>this.maxWidth&&(r<=i&&(r=i),i=0,n=12),(l=new PIXI.Sprite(dt.getTexture("spr_resource_"+"refinedMetal".toLowerCase()))).position.x=i,l.position.y=n,this.addChild(l),i+=1+(0|l.width),(h=new Ur(""+this.materials.refinedMetal,{font:"Arial",tint:0},!0)).position.set(i,-1+n),this.addChild(h),i+=3+(0|h.get_textWidth()));0<this.materials.computerChips&&(i+50>this.maxWidth&&(r<=i&&(r=i),i=0,n=12),(l=new PIXI.Sprite(dt.getTexture("spr_resource_"+"computerChips".toLowerCase()))).position.x=i,l.position.y=n,this.addChild(l),i+=1+(0|l.width),(h=new Ur(""+this.materials.computerChips,{font:"Arial",tint:0},!0)).position.set(i,-1+n),this.addChild(h),i+=3+(0|h.get_textWidth()));0<this.materials.cacao&&(i+50>this.maxWidth&&(r<=i&&(r=i),i=0,n=12),(l=new PIXI.Sprite(dt.getTexture("spr_resource_"+"cacao".toLowerCase()))).position.x=i,l.position.y=n,this.addChild(l),i+=1+(0|l.width),(h=new Ur(""+this.materials.cacao,{font:"Arial",tint:0},!0)).position.set(i,-1+n),this.addChild(h),i+=3+(0|h.get_textWidth()));0<this.materials.chocolate&&(i+50>this.maxWidth&&(r<=i&&(r=i),i=0,n=12),(l=new PIXI.Sprite(dt.getTexture("spr_resource_"+"chocolate".toLowerCase()))).position.x=i,l.position.y=n,this.addChild(l),i+=1+(0|l.width),(h=new Ur(""+this.materials.chocolate,{font:"Arial",tint:0},!0)).position.set(i,-1+n),this.addChild(h),i+=3+(0|h.get_textWidth()));0<this.materials.graphene&&(i+50>this.maxWidth&&(r<=i&&(r=i),i=0,n=12),(l=new PIXI.Sprite(dt.getTexture("spr_resource_"+"graphene".toLowerCase()))).position.x=i,l.position.y=n,this.addChild(l),i+=1+(0|l.width),(h=new Ur(""+this.materials.graphene,{font:"Arial",tint:0},!0)).position.set(i,-1+n),this.addChild(h),i+=3+(0|h.get_textWidth()));0<this.materials.rocketFuel&&(i+50>this.maxWidth&&(r<=i&&(r=i),i=0,n=12),(l=new PIXI.Sprite(dt.getTexture("spr_resource_"+"rocketFuel".toLowerCase()))).position.x=i,l.position.y=n,this.addChild(l),i+=1+(0|l.width),(h=new Ur(""+this.materials.rocketFuel,{font:"Arial",tint:0},!0)).position.set(i,-1+n),this.addChild(h),i+=3+(0|h.get_textWidth()));for(var s=0,o=ct.modMaterials;s<o.length;){var a=o[s];++s;var l,h,u=a.variableName;if(0<this.materials[u])"food"==u&&(i-=2),i+50>this.maxWidth&&(r<=i&&(r=i),i=0,n=12),(l=new PIXI.Sprite(dt.getTexture("spr_resource_"+u.toLowerCase()))).position.x=i,l.position.y=n,this.addChild(l),i+=1+(0|l.width),"food"==u&&(i-=2),(h=new Ur(""+this.materials[u],{font:"Arial",tint:0},!0)).position.set(i,-1+n),this.addChild(h),i+=3+(0|h.get_textWidth())}0<this.materials.knowledge&&(i+50>this.maxWidth&&(r<=i&&(r=i),i=0,n=12),(l=new PIXI.Sprite(dt.getTexture("spr_resource_"+"knowledge".toLowerCase()))).position.x=i,l.position.y=n,this.addChild(l),i+=1+(0|l.width),(h=new Ur(""+this.materials.knowledge,{font:"Arial",tint:0},!0)).position.set(i,-1+n),this.addChild(h),i+=3+(0|h.get_textWidth()));this.displayWidth=i<r?r:i},__class__:Xs});var js=function(){};(q["gui.MoreSettingsWindow"]=js).__name__="gui.MoreSettingsWindow",js.create=function(e,i,t,n,r,s,o){var a=e.game;i.windowAddTitleText(Tr.lo("advanced_settings"));var l=null,h=null,u=null;u=function(){i.windowOnDestroy=null,i.createWindow("doConfirmLanguage"),i.addWindowToStack(u),i.setWindowReload(u),Ws.create(e,i,i.innerWindowStage,i.windowInner)},l=new oo(i,t,n,u,Tr.lo("language")),n.addChild(l),n.addChild(new Ms(n,new vr(2,4)));var c=new ro(i,t,n,function(){return O.musicVolume},function(t){O.musicVolume=t,O.save(),a.audio.setVolumeLevels()});c.addChild(new ao(c,t,Tr.lo("music_volume"))),n.addChild(c),i.windowInner.addChild(new Ms(i.windowInner,new vr(2,4)));var d=new ro(i,t,n,function(){return O.soundVolume},function(t){O.soundVolume=t,O.save(),a.audio.setVolumeLevels()});d.addChild(new ao(d,t,Tr.lo("sound_effect_volume"))),n.addChild(d),i.windowInner.addChild(new Ms(i.windowInner,new vr(2,4))),B.canHavePremium()&&(ss.createSettingButton(i,i.innerWindowStage,i.windowInner,function(){O.colorBlindMode=!O.colorBlindMode,O.save()},function(){return O.colorBlindMode},Tr.lo("color_blind_mode")),i.windowInner.addChild(new Ms(i.windowInner,new vr(2,4)))),ss.createSettingButton(i,i.innerWindowStage,i.windowInner,function(){O.disableClouds=!O.disableClouds,O.save()},function(){return O.disableClouds},Tr.lo("disable_clouds_background")),i.windowInner.addChild(new Ms(i.windowInner,new vr(2,4))),ss.createSettingButton(i,i.innerWindowStage,i.windowInner,function(){O.disablePlanets=!O.disablePlanets,O.save()},function(){return O.disablePlanets},Tr.lo("disable_planets_background")),i.windowInner.addChild(new Ms(i.windowInner,new vr(2,4)));var p=null,f=null;if(o&&e.progress.story.canHaveUnlimitedResources()&&(B.get_allowUnlimitedResources()||e.progress.sandbox.unlimitedResources)){var g=null;g=function(){i.windowOnDestroy=null,i.createWindow("confirmUnlimited"),i.addWindowToStack(g);i.windowAddTitleText(e.progress.sandbox.unlimitedResources?Tr.lo("disable_unlimited_resources"):Tr.lo("enable_unlimited_resources")),i.windowAddInfoText(e.progress.sandbox.unlimitedResources?Tr.lo("stop_play_unlimited"):Tr.lo("play_unlimited")+""),i.windowAddBottomButtons([{text:Tr.lo("yes"),action:function(){e.progress.sandbox.unlimitedResources?e.progress.sandbox.disableUnlimitedResources():e.progress.sandbox.enableUnlimitedResources(),i.goPreviousWindow()}}])},p=new oo(i,t,n,g,Tr.lo("unlimited")),n.addChild(p),a.isMobile||(p.extraWidth=18),p.setText(e.progress.sandbox.unlimitedResources?Tr.lo("disable_unlimited_resources"):Tr.lo("enable_unlimited_resources")),n.addChild(new Ms(n,new vr(2,4)))}if(a.isMobile){var m=new ps(i,t,n);m.direction=Ps.Vertical;var y=new ps(i,t,n);y.direction=Ps.Horizontal,3.999<=a.scaling?y.padding.bottom=4:y.padding.bottom=6;var _=new ao(m,t,Tr.lo("reduce_ui_size")+" ");_.handleMouseFunction=function(t){return!!_.rect.contains(t.position)},_.padding.top=1,y.addChild(_),y.addChild(new Ms(y,new vr(4,2)));x=new qs(i,t,y,{left:0,right:0,top:0,bottom:0},function(){return 0},function(){var t=Math.ceil((a.application.scaling-A.scalingMod-1)/2);return 1<t?t:1},-A.scalingMod,function(t){A.scalingMod=-t,a.application.setGameScale(),O.save()},function(){return 0},"");y.addChild(x),m.addChild(y),n.addChild(m),3.999<=a.scaling&&(ss.createSettingButton(i,i.innerWindowStage,i.windowInner,function(){O.allowMoreZoom=!O.allowMoreZoom,O.save()},function(){return O.allowMoreZoom},Tr.lo("allow_zooming_out_further")),i.windowInner.addChild(new Ms(i.windowInner,new vr(2,6))))}else{var v=new ps(i,t,n);v.direction=Ps.Vertical;var b=new ps(i,t,n);b.direction=Ps.Horizontal,b.padding.bottom=6;var w=new ao(v,t,Tr.lo("pathfinding_thread_limit")+" ");w.handleMouseFunction=function(t){return!!w.rect.contains(t.position)&&(i.tooltip.setText(null,Tr.lo("pathfinding_thread_limit_explain")),!0)},w.padding.top=1,b.addChild(w),b.addChild(new Ms(b,new vr(4,2)));var S=i,x=O.pathfindingWorkers,T=Tr.lo("reset_pathfinding_limit"),I=new qs(S,t,b,{left:0,right:0,top:0,bottom:0},function(){return 1},function(){return 15},x,function(t){O.pathfindingWorkers=t,e.simulation.pathfinder.setWorkerNumber(t,!0),O.save()},function(){return O.resetPathfindingWorkers()},T);b.addChild(I),v.addChild(b),n.addChild(v)}n.addChild(new ao(n,i.innerWindowStage,Tr.lo("have_code")));var P=new ps(i,i.innerWindowStage,i.windowInner),C=null;C=function(){i.windowOnDestroy=null,i.createWindow("secretWindow"),i.addWindowToStack(C),no.create(e,i,i.innerWindowStage,i.windowInner)};var E=new oo(i,t,i.windowInner,C,Tr.lo("input_code"));E.extraHeight+=3,E.extraTextPosY+=1,E.setText(Tr.lo("input_code")),P.addChild(E),n.addChild(P),n.addChild(new Ms(i.windowInner,new vr(2,4))),null!=l&&l.fillWidth(),a.isMobile&&(null!=p&&p.fillWidth(),null!=f&&f.fillWidth(),null!=h&&h.fillWidth()),i.windowAddBottomButtons(),i.windowOnDestroy=function(){a.state instanceof M&&a.state.language!=O.language&&a.createMainMenu()}};var Vs=function(){};(q["gui.MultiFollowWindow"]=Vs).__name__="gui.MultiFollowWindow",Vs.createWindow=function(u,c,t,d,p){u.gui.createWindow(c),u.gui.setWindowPositioning(u.game.isMobile?fo.TopLeft:fo.Top);var e=u,i=c,n=t,r=d,s=p,o=function(){Vs.createWindow(e,i,n,r,s)};u.gui.setWindowReload(o);var a=u,l=c,h=t,f=d,g=p;o=function(){Vs.createWindow(a,l,h,f,g)};u.gui.addWindowToStack(o);var m=t;u.gui.windowAddTitleText(m);var y=new ps(u.gui,u.gui.innerWindowStage,u.gui.windowInner);y.direction=Ps.Vertical;var _=[];u.gui.windowInner.addChild(y),u.gui.windowAddBottomButtons();var v=dt.getTexture("spr_selectedhuman"),b=[],w=null;null!=d&&((w=dt.makeSprite("spr_selectedbuilding")).alpha=.5,w.position.set(d.position.x-1,d.position.y-1),u.farForegroundStage.addChild(w)),u.gui.windowOnLateUpdate=function(){if(null!=d){if(d.destroyed)return u.gui.clearWindowStack(),void u.gui.closeWindow();w.position.set(d.position.x-1,d.position.y-1)}if(0==c.length){if(0<_.length){for(var t=0;t<_.length;){var e=_[t];++t,e.elem.destroy()}_=[],y.clear()}0==y.children.length&&y.addChild(new ao(y,u.gui.innerWindowStage,p))}else{0==_.length&&y.clear();for(t=0;t<c.length;){var i=[c[t]];if(++t,null==lt.find(_,function(e){return function(t){return t.citizen==e[0]}}(i))){var n=new us(u.gui,u.gui.innerWindowStage,y,function(t){return function(){Ss.createWindow(u,t[0],!1)}}(i));n.container.padding.top=3,n.container.padding.left=3,n.container.padding.right=3,n.container.padding.bottom=0,n.container.fillSecondarySize=!0,n.container.addChildWithoutSizeUpdate(new ao(n.container,u.gui.innerWindowStage,i[0].nameIndex<dt.citizenNames.length?dt.citizenNames[i[0].nameIndex]:Or.firstToUpper(Tr.lo("citizen")))),n.container.updateSizeNonRecursive();var r=n.container.parent.parent;n.container.parent.parent=null,n.container.parent.updateSize(),n.container.parent.parent=r,n.container.updateChildrenPosition(),y.addChildWithoutSizeUpdate(n);var s=new Ms(y,new vr(2,4));y.addChildWithoutSizeUpdate(s),_.push({elem:n,elem2:s,citizen:i[0]})}}y.updateSize();for(var o=_.length-1;0<=o;){e=_[o];-1==c.indexOf(e.citizen)&&(y.removeChild(e.elem),y.removeChild(e.elem2),_.splice(o,1)),--o}}if(b.length>c.length){t=c.length;for(var a=b.length;t<a;){o=t++;b[o].destroy()}b.splice(c.length,b.length-c.length)}for(t=0,a=c.length;t<a;){if((o=t++)>=b.length){var l=new PIXI.Sprite(v);b.push(l),u.furtherForegroundStage.addChild(l)}var h=c[o].getCityPosition();b[o].position.set(h.x-1,h.y-6)}},u.gui.windowOnDestroy=function(){for(var t=0;t<b.length;){var e=b[t];++t,e.destroy()}null!=w&&w.destroy()}};var Ys=function(t,e,i,n){this.tint=16777215,this.currentTextureSet=0,this.npWidth=i,this.npHeight=n,PIXI.Container.call(this),this.textureSets=[],this.texture=t,this.sidePixels=e,this.updateTextures(),this.updateSprites()};(q["gui.NinePatch"]=Ys).__name__="gui.NinePatch",Ys.__super__=PIXI.Container,Ys.prototype=e(PIXI.Container.prototype,{setTextureSet:function(t){var e=this.textureSets[t];this.currentTextureSet=t,e!=this.textureParts&&(this.textureParts=e,this.updateSprites())},updateTextures:function(t){if(null==t&&(t=!0),null==this.textureParts?this.textureParts=[]:t?this.textureSets.pop():this.textureParts=[],null!=Ys.ninePatchTextureCache.h.__keys__[this.texture.__id__]&&Ys.ninePatchTextureCache.h[this.texture.__id__].h.hasOwnProperty(this.sidePixels))this.textureParts=Ys.ninePatchTextureCache.h[this.texture.__id__].h[this.sidePixels];else{for(var e=0;e<9;){var i=e++;this.textureParts[i]=this.texture.clone();var n=new PIXI.Rectangle;i%3==1?(n.width=this.texture.width-2*this.sidePixels,n.x=this.sidePixels):(n.width=this.sidePixels,i%3==2&&(n.x=this.texture.width-this.sidePixels)),3<=i&&i<=5?(n.height=this.texture.height-2*this.sidePixels,n.y=this.sidePixels):(n.height=this.sidePixels,5<i&&(n.y=this.texture.height-this.sidePixels)),this.textureParts[i].frame=new PIXI.Rectangle(this.textureParts[i].frame.x+n.x,this.textureParts[i].frame.y+n.y,n.width,n.height),this.textureParts[i].update()}if(null==Ys.ninePatchTextureCache.h.__keys__[this.texture.__id__]){var r=Ys.ninePatchTextureCache,s=this.texture,o=new Wo;r.set(s,o)}o=this.textureParts;Ys.ninePatchTextureCache.h[this.texture.__id__].h[this.sidePixels]=o}this.textureSets.push(this.textureParts)},updateSprites:function(t){if(null==t&&(t=!1),0!=this.npWidth&&0!=this.npHeight){if(this.visible=!0,t){for(var e=0,i=this.children;e<i.length;){var n=i[e];++e,n.destroy()}this.children=[]}for(e=0;e<9;){var r,s,o=e++,a=null;switch(this.children.length<=o?(a=new PIXI.Sprite(this.textureParts[o]),this.addChild(a)):(a=this.children[o]).texture=this.textureParts[o],o%3){case 1:r=this.sidePixels;break;case 2:r=this.npWidth-this.sidePixels;break;default:r=0}switch(a.position.x=r,o%3==1&&(a.width=this.npWidth-2*this.sidePixels),o/3|0){case 1:s=this.sidePixels;break;case 2:s=this.npHeight-this.sidePixels;break;default:s=0}a.position.y=s,a.tint=this.tint,1==(o/3|0)&&(this.npHeight-2*this.sidePixels<0?a.height=0:a.height=this.npHeight-2*this.sidePixels)}}else this.visible=!1},__class__:Ys});var qs=function(t,e,i,n,r,s,o,a,l,h,u,c){null==c&&(c=20),null==u&&(u=1),null==h&&(h=""),null==o&&(o=0),this.number=0;var d=this;ps.call(this,t,e,i,null,null,null,null,n),this.getMinValue=r,this.getMaxValue=s,this.number=o,this.setValue=a,this.setToOnClick=l,this.numberButton=new us(t,e,this,function(){if(null!=l){var t=d.number;d.number=l(),d.number!=t&&a(d.number)}},null,function(){t.tooltip.setText(d,h)});var p=t.game.isMobile?2:0,f=t.game.isMobile?4:0;this.numberButton.container.padding={left:3+f,right:3+f,top:3+p,bottom:p-1},this.numberButton.container.minHeight=12,this.numberButton.container.minWidth=c,this.numberButton.container.addChild(new ao(this.numberButton.container,e,null,function(){return d.number==d.beyondHighestValue?d.beyondHighestText:""+d.number},null,null,null,!1,!0)),this.addChild(this.numberButton),this.numberButton.buttonPatch.updateSprites(!0);var g=new ps(t,e,this);g.direction=t.game.isMobile?Ps.Horizontal:Ps.Vertical,this.upButton=new Us(t,e,this,function(){null!=d.beyondHighestValue&&d.number==d.beyondHighestValue||(null==s||d.number+u<=s()?(d.number+=u,null!=a&&a(d.number)):null!=d.beyondHighestValue&&d.number!=d.beyondHighestValue&&(d.number=d.beyondHighestValue,null!=a&&a(d.number)))},dt.getTexture(t.game.isMobile?"spr_arrowup_big":"spr_arrowup"),null,null,null,t.game.isMobile?"spr_button_small":"spr_minibutton"),this.upButton.canBeHeld=!0,g.addChild(this.upButton),this.downButton=new Us(t,e,this,function(){null!=d.beyondHighestValue&&d.number==d.beyondHighestValue?(null!=s&&(d.number=s()),null!=a&&a(d.number)):(null==r||d.number-u>=r())&&(d.number-=u,null!=a&&a(d.number))},dt.getTexture(t.game.isMobile?"spr_arrowdown_big":"spr_arrowdown"),null,null,null,t.game.isMobile?"spr_button_small":"spr_minibutton"),this.downButton.canBeHeld=!0,g.addChild(this.downButton),this.addChild(g)};(q["gui.NumberSelectControl"]=qs).__name__="gui.NumberSelectControl",qs.__super__=ps,qs.prototype=e(ps.prototype,{enableBeyondHighestValuePossibility:function(t,e){this.beyondHighestValue=t,this.beyondHighestText=e},update:function(){if(ps.prototype.update.call(this),this.number!=this.beyondHighestValue){var t=this.number;if(null!=this.getMinValue){var e=this.getMinValue(),i=this.number;this.number=e<i?i:e}if(null!=this.getMaxValue){e=this.getMaxValue(),i=this.number;this.number=i<e?i:e}this.number!=t&&this.setValue(this.number)}},__class__:qs});var Ks=function(t,e){this.padding=5,this.gui=t,this.stage=e,this.create()};(q["gui.PersistentFullVersionUpsell"]=Ks).__name__="gui.PersistentFullVersionUpsell",Ks.prototype={create:function(){var t=this.gui.game;this.textures=dt.getTextures("steam_badge_coolmath",3),this.sprite=new PIXI.Sprite(this.textures[0]),this.sprite.scale.set(1/t.get_preDPIAdjustScaling(),1/t.get_preDPIAdjustScaling()),this.stage.addChild(this.sprite),this.sprite.position.set(t.rect.width-this.padding-this.sprite.width,this.padding)},handleMouse:function(t){var e=this.gui.game;return t.get_x()>=e.rect.width-this.padding*e.get_preDPIAdjustScaling()-this.sprite.width&&t.get_x()<e.rect.width-this.padding*e.get_preDPIAdjustScaling()&&t.get_y()>=this.padding*e.get_preDPIAdjustScaling()&&t.get_y()<this.padding*e.get_preDPIAdjustScaling()+this.sprite.height?(this.sprite.texture=t.down?this.textures[2]:this.textures[1],e.setOnClickTo=function(){window.open("https://store.steampowered.com/app/1180130/The_Final_Earth_2/?utm_source=coolmathgames&utm_medium=web&utm_campaign=ingamepersistent","_blank")},!0):(this.sprite.texture=this.textures[0],!1)},resize:function(){var t=this.gui.game;this.sprite.position.set(t.rect.width-10-this.sprite.width,10)},__class__:Ks};var $s=function(){};(q["gui.PopulationInfoWindow"]=$s).__name__="gui.PopulationInfoWindow",$s.create=function(t,e,i,n){$s.createWindow(t,e,i,n)},$s.createWindow=function(a,u,l,h){h.clear(),u.windowAddTitleText(Tr.lo("pop_by_age"),null,dt.getTexture("spr_population"));var o=0;u.windowAddInfoText(null,function(){return Tr.lo("citizens_and_children",[a.simulation.citizens.length,o])}),u.windowAddInfoText(null,function(){return Tr.lo("citizens_by_age_explain")});function t(){d=!1,p=0,f.clear(),f.beginFill(0),f.drawRect(0,0,1,120),f.drawRect(39,0,1,120),f.drawRect(0,120,40,1);for(var t=[],e=0;e<121;){e++;t.push(0)}for(c=t,t=o=0,e=a.simulation.citizens;t<e.length;){var i=e[t];++t,120<(r=0|i.get_age())?(c[120]++,d=!0):c[r]++,r<16&&(o+=1),p<r&&(p=r)}var n=gr.max(c);if(0!=n)for(t=0,e=121;t<e;){var r=t++,s=c[r]/n;f.drawRect(40,r,210*s,1),f.drawRect(40,r,210*s,1),r%10==0&&f.drawRect(0,r,40,1)}f.endFill()}var c,d=!1,p=0,e=new PIXI.Container,f=new PIXI.Graphics;t(),e.addChild(f);var g=null;g=new ds(h,l,e,{left:0,right:0,top:0,bottom:3},t,function(t){var e,i;(i=t.get_x())>=g.rect.x&&i<g.rect.x+g.rect.width?e=(i=t.get_y())>=g.rect.y&&i<g.rect.y+g.rect.height:e=!1;if(e){if(t.get_x()>=g.rect.x+40){var n=t.get_y()-g.rect.y;n<120||120==n&&!d?u.tooltip.setText(g,1==c[n]?Tr.lo("one_citizen_age",[n]):Tr.lo("n_citizens_age",[c[n],n])):120==n&&u.tooltip.setText(g,1==c[n]?Tr.lo("one_citizen_age_oldest",[n+"+",p]):Tr.lo("n_citizens_age_oldest",[c[n],n+"+",p]))}else{var r=10*((t.get_y()-g.rect.y)/10|0);if(r<120){for(var s=0,o=110==r,a=r,l=10+r+(o?1:0);a<l;){var h=a++;s+=c[h]}o&&d?u.tooltip.setText(g,1==s?Tr.lo("one_citizen_age_upper_range",[r]):Tr.lo("n_citizens_age_upper_range",[s,r])):u.tooltip.setText(g,1==s?Tr.lo("one_citizen_age_range",[r,10+r]):Tr.lo("n_citizens_age_range",[s,r,10+r]))}}return!0}return!1}),h.addChild(g);for(var i=0;i<12;){var n=i++,r=new Ur(10*n+"-"+(10*n+10),{font:"Arial10",tint:0},!0);11==n&&d&&r.set_text(10*n+"+"),r.position.set(2,10*n),e.addChild(r)}h.onDestroy=function(){f.destroy()};var m=new ps(u,l,h);m.direction=Ps.Vertical;var y=!1;m.onUpdate=function(){if(!y&&1950<=a.simulation.citizens.length){var t=new ps(u,l,h);t.direction=Ps.Horizontal,y=!0,t.padding.bottom=6;var e=new ao(m,l,Tr.lo("pop_limit")+" ");e.padding.top=1,t.addChild(e),t.addChild(new Ms(t,new vr(4,2)));var i=u,n=l,r=a.simulation.babyMaker.softPopLimit,s=Tr.lo("reset_pop_limit"),o=new qs(i,n,t,{left:0,right:0,top:0,bottom:0},function(){return 2e3},function(){return $s.maximumPopLimit},r,function(t){a.simulation.babyMaker.softPopLimit=t},function(){return 3e3},s,25);t.addChild(o),m.addChild(t),m.addChild(new ao(m,l,Tr.lo("pop_limit_hint")))}},h.addChild(m),u.windowAddBottomButtons([{text:Tr.lo("follow_citizen"),action:function(){a.viewActions.showFollow()}}])};var Qs=function(){};(q["gui.PremiumInfoWindow"]=Qs).__name__="gui.PremiumInfoWindow",Qs.create=function(t,e,i,n,r,s){Qs.createWindow(t,e,i,n,r,s)},Qs.createWindow=function(a,l,h,u,c,t){var e=new PIXI.Loader;Qs.unloaded&&(e.add("premium_promo_images/rocket.png"),e.add("premium_promo_images/treeland.png"),e.add("premium_promo_images/purple.png")),l.windowOnDestroy=t,l.windowRelatedTo="premiumUpsell",l.windowInner.addChild(new ao(l.windowInner,l.innerWindowStage,"[white]Loading...",null,"Arial",null,320,!0)),e.use(function(t,e){if(t.error)return console.log("FloatingSpaceCities/gui/PremiumInfoWindow.hx:41:",t.error),void l.closeWindow();e()}),e.load(function(){if(Qs.unloaded=!1,null!=l.window&&"premiumUpsell"==l.windowRelatedTo){u.clear(),l.windowAddTitleText("[white]Check out the extended version!",null,null,!1);var e=dt.makeSprite("premium_promo_images/rocket");l.windowInner.addChild(new ds(l.windowInner,l.innerWindowStage,e,{left:0,right:0,bottom:6,top:0})),l.windowInner.addChild(new ao(l.windowInner,l.innerWindowStage,"[white]I hope you're enjoying The Final Earth 2! Want even more?",null,"Arial",null,320,!0)),l.windowInner.addChild(new ao(l.windowInner,l.innerWindowStage,"[white]- Explore new worlds with the rocket!",null,"Arial",null,320,!0)),l.windowInner.addChild(new ao(l.windowInner,l.innerWindowStage,"[white]- Build trains, floating platforms and indoor landing pads!",null,"Arial",null,320,!0)),l.windowInner.addChild(new ao(l.windowInner,l.innerWindowStage,"[white]- Discover more buildings and missions!",null,"Arial",null,320,!0)),l.windowInner.addChild(new ao(l.windowInner,l.innerWindowStage,"[white]- Unlock sandbox mode for unlimited resources!",null,"Arial",null,320,!0));var t=new ps(l,h,l.windowInner);l.windowInner.addChild(t);var i=new oo(l,h,t,function(){},"Get it on Steam!",function(){return!1},function(){a.game.setOnClickTo=function(){window.open("https://store.steampowered.com/app/1180130/The_Final_Earth_2/?utm_source=coolmathgames&utm_medium=web&utm_campaign="+c)}},"spr_button_upsell","Arial16");i.bitmapText.set_tint(16777215),t.addChild(i);var n=new Ms(t,new vr(4,2));t.addChild(n);var r=new oo(l,h,t,function(){l.closeWindow()},"Not right now",function(){return!1},function(){},"spr_button_upsell_ignore");r.bitmapText.set_tint(12630990),r.extraHeight=4,r.extraTextPosY=2,r.setText("Not right now"),t.addChild(r),i.extraWidth=l.windowInner.rect.width-8-i.rect.width-r.rect.width,i.setText("Get it on Steam!");var s=0,o=0;l.windowOnUpdate=function(t){300<(o+=t)&&(s+=1,s%=3,e.texture=dt.getTexture(["premium_promo_images/rocket","premium_promo_images/treeland","premium_promo_images/purple"][s]),o=0)}}})};var Js=function(){};(q["gui.ReplaceAllHousesWindow"]=Js).__name__="gui.ReplaceAllHousesWindow",Js.create=function(t,e,i,n){Js.createWindow(t,e,i,n)},Js.createWindow=function(i,n,t,r){r.clear(),n.windowAddTitleText(Tr.lo("upgrade_basic_houses")),n.windowAddInfoText(Tr.lo("upgrade_basic_houses_hint")),n.windowInner.addChild(new Ms(n.windowInner,new vr(2,2)));var e=new ps(n,t,r);e.direction=Ps.Horizontal,n.windowInner.addChild(e);for(var s=0,o=0,a=i.progress.resources.buildingInfoArray;o<a.length;){var l=[a[o]];++o;var h="buildings."+l[0].className,u=q[h],c=i.progress.unlocks.getUnlockState(u),d=F.field(u,"spriteName");if("Houses"==l[0].category&&(c==$a.Unlocked&&null==l[0].showUnlockHint||c==$a.Researched||c==$a.Createable)&&-1==l[0].specialInfo.indexOf("rooftop")&&null!=l[0].residents&&"NormalHouse"!=l[0].className){9<++s&&((e=new ps(n,t,r)).direction=Ps.Horizontal,n.windowInner.addChild(e),s=0);var p=[],f=p,g=n,m=[null];m[0]=function(t,e){return function(){i.gui.createWindow(r),Zs.create(i,i.gui,i.gui.innerWindowStage,i.gui.windowInner,e[0]),i.gui.addWindowToStack(t[0])}}(m,l),f[0]=new Us(g,t,e,m[0],dt.getTexture(d+"@0,0,20,20"),function(){return!1},function(t,e){return function(){n.tooltip.setText(t[0],e[0].name)}}(p,l),"none"==l[0].buttonBack?null:dt.getTexture(null==l[0].buttonBack?d+"@44,0,20,20":l[0].buttonBack)),e.addChild(p[0])}}n.windowInner.addChild(new Ms(n.windowInner,new vr(2,6))),n.windowAddBottomButtons()};var Zs=function(){};(q["gui.ReplaceAllHousesWindowStep2"]=Zs).__name__="gui.ReplaceAllHousesWindowStep2",Zs.create=function(t,e,i,n,r){Zs.createWindow(t,e,i,n,r)},Zs.createWindow=function(c,l,t,e,d){e.clear(),l.windowAddTitleText(Tr.lo("upgrade_to_x",[d.name]));var p=new Hs(c,new L(2,2)),i=new ps(l,l.innerWindowStage,l.windowInner),f=i.addChild(new ds(i,l.innerWindowStage,p,{left:0,right:0,top:0,bottom:2})),g=L.fromBuildingInfo(d),m=null,y=null,_=0,v=null;l.windowAddInfoText(null,function(){for(var t=[],e=0,i=c.permanents;e<i.length;){var n=i[e];++e,Ko.getClass(n)==Bi&&t.push(n)}if(0==(y=t).length)return p.setCost(new L),_=0,v.setText("-"),Tr.lo("no_basic_houses");v.setText(Tr.lo("confirm"));var r=g.copy(),s="buildings."+d.className;c.progress.unlocks.getUnlockState(q[s])==$a.Researched&&(r.knowledge=0);var o=new L(4,4);o.multiply(c.upgrades.vars.recyclingAmount),r.remove(o),r.roundAll(),m=r.copy();var a=r.copy();a.knowledge=0;var l=c.materials.canAffordNumber(a),h=y.length;_=l<1?1:h<l?h:l,m.multiply(_),m.knowledge=r.knowledge;var u=m.copy();return u.wood<0&&(u.wood=0),u.stone<0&&(u.stone=0),p.setCost(u),f.updateSize(),Tr.lo("no_undo")+"\n\n"+Tr.lo("upgrade_basic_for",[_,y.length])}),l.windowInner.addChild(new Ms(l.windowInner,new vr(2,4))),l.windowInner.addChild(i),l.windowInner.addChild(new Ms(l.windowInner,new vr(2,4))),v=new oo(l,t,l.windowInner,function(){if(null!=m&&null!=y&&0<y.length&&0<_&&c.materials.canAfford(m)){var t=[],e="buildings."+d.className,i=q[e];c.progress.unlocks.research(i);for(var n=0,r=_;n<r;){var s=n++,o=y[s];o.destroyForReplacement(),o.world.build(i,o.worldPosition.x,o.worldPosition.y),t.push(o)}c.connections.updateCityConnections(),c.simulation.updatePathfinder(!0);for(n=0;n<t.length;){var a=t[n];++n,a.postCreate()}c.progress.unlocks.checkBuildRelatedUnlocks(),c.materials.remove(m),l.showSimpleWindow(Tr.lo("upgraded_houses",[_]),null,!0)}},Tr.lo("confirm")),l.windowInner.addChild(v),l.windowInner.addChild(new Ms(l.windowInner,new vr(2,6))),l.windowAddBottomButtons()};var to=function(t,e,i,n){this.playSpriteTint=0,this.infoButton=null;var r=this;this.gui=t,this.stage=e,this.city=i,this.container=new ps(t,e,null,new vr(0,0),new br(.5,.5)),this.updatePosition(),this.onDestroy=n,this.initUI(t,function(){i.set_pauseGame(!1),r.destroyControl()})};(q["gui.ResumeGameControl"]=to).__name__="gui.ResumeGameControl",to.prototype={updatePosition:function(){this.container.updatePosition(new vr(this.gui.game.rect.width/2|0,this.gui.game.rect.height/2|0))},handleMouse:function(t){switch(t.claimMouse(this)._hx_index){case 0:this.infoButton.buttonPatch.setTextureSet(2),this.infoButton.mouseOut=!1;break;case 1:this.city.set_pauseGame(!1),this.destroyControl()}return!0},update:function(t){this.city.pauseGame?this.container.update():this.destroyControl();var e=.6*Math.sin(this.playSpriteTint/10)+.5,i=Math.floor(200*(e<0?0:1<e?1:e));this.playSprite.tint=256*i,this.playSpriteTint+=t},destroyControl:function(){null!=this.infoButton&&(this.infoButton.destroy(),this.whiteGraphics.destroy(),this.infoButton=null,this.onDestroy())},initUI:function(t,e){this.whiteGraphics=new PIXI.Graphics,this.whiteGraphics.beginFill(16777215,.2),this.whiteGraphics.drawRect(0,0,t.game.rect.width,t.game.rect.height),this.whiteGraphics.endFill(),this.stage.addChild(this.whiteGraphics),this.infoButton=new us(t,this.stage,this.container,e,null,null,"spr_button"),this.infoButton.container.direction=Ps.Vertical,this.infoButton.container.fillSecondarySize=!0;var i=t.game.isMobile?3:0,n=t.game.isMobile?2:0;this.infoButton.container.padding={left:4+i,right:5+i,top:4+i,bottom:3+i},this.infoButton.container.updateSize(),this.playSprite=new PIXI.Sprite(dt.getTexture("spr_icon_play_big"));var r=new ds(this.infoButton.container,this.stage,this.playSprite,{left:0,right:0,top:2,bottom:2});this.infoButton.container.addChild(r),this.textElem=new ao(this.infoButton.container,this.stage,Tr.lo("resume"),null,"Arial16",{left:1+n,right:0,top:2,bottom:0});var s=new ao(this.infoButton.container,this.stage,"("+Tr.lo("tap_anywhere")+")",null,"Arial10",{left:1+n,right:0,top:2,bottom:0}),o=this.textElem.rect.width,a=s.rect.width;r.padding.left=((o<a?a:o)-r.rect.width)/2|0,this.infoButton.container.addChild(this.textElem),this.infoButton.container.addChild(s),this.textElem.rect.width>s.rect.width?s.padding.left=(this.textElem.rect.width-s.rect.width)/2|0:this.textElem.padding.left=(s.rect.width-this.textElem.rect.width)/2|0,this.infoButton.container.minWidth=200,this.container.insertChild(this.infoButton,0)},__class__:to};var eo=function(){};(q["gui.SaveLoadWindows"]=eo).__name__="gui.SaveLoadWindows",eo.createSaveWindow=function(t,e,i,n,r){e.createWindow(),e.windowRelatedTo="saveLoad";var s=t,o=e,a=i,l=n,h=r;e.addWindowToStack(function(){eo.createSaveWindow(s,o,a,l,h)}),e.windowAddTitleText(Tr.lo("choose_save_slot")),e.windowAddInfoText(i),e.windowAddBottomButtons(),eo.addSaveSlotButtons(t,e,function(t){n(t),e.windowOnDestroy=null,e.closeWindow()},!1,!0),e.windowOnDestroy=r},eo.createDeleteWindow=function(r,s,t,e,i){s.createWindow(),s.windowRelatedTo="saveLoadDEL";var n=r,o=s,a=t,l=e,h=i,u=function(){eo.createDeleteWindow(n,o,a,l,h)};s.addWindowToStack(u,!0);var c=r,d=s,p=t,f=e,g=i;u=function(){eo.createDeleteWindow(c,d,p,f,g)};s.setWindowReload(u),s.windowAddTitleText(Tr.lo("delete_save")),s.windowAddInfoText(t),s.windowAddBottomButtons(),eo.addSaveSlotButtons(r,s,function(n){var t=!0;r.state instanceof x&&(t=r.state.cityMainFile!=n);if(t)Rr.getItem("__meta__mostRecentlyPlayed",function(t,e){function i(){Rr.setItem(n+"__meta","SPEC_DELETED",function(){Rr.setItem(n,"",function(){Rr.setItem("__meta_mostRecentSubOf_"+n,"",function(){s.reloadWindow()})})})}if(C.startsWith(e,n)){if(r.state instanceof M)r.state.deletedCurSave=!0;Rr.setItem("__meta__mostRecentlyPlayed","DELETED_SAVE",i)}else i()});else{var e=null;(e=function(){s.showSimpleWindow(Tr.lo("cant_delete_curr"),null,!0),s.addWindowToStack(e,!0),s.setWindowReload(e)})()}},!0,!0,!0),s.windowOnDestroy=i},eo.createLoadWindow=function(e,i,t,n,r){i.createWindow(),i.windowRelatedTo="saveLoad";var s=e,o=i,a=t,l=n,h=r;i.addWindowToStack(function(){eo.createLoadWindow(s,o,a,l,h)}),i.windowAddTitleText(Tr.lo("load_a_game")),i.windowAddInfoText(t),i.windowAddBottomButtons([{text:Tr.lo("import_command"),action:function(){},onHover:function(){e.setOnClickTo=function(){var t=window.document.getElementById("importFile");t.value="",t.click(),e.onClick=null}}},{text:Tr.lo("delete_save"),action:function(){eo.createDeleteWindow(e,i,"",function(t){})}}]),eo.addSaveSlotButtons(e,i,function(t){i.windowOnDestroy=null,i.closeWindow(),n(t)},!0,!1),i.windowOnDestroy=r},eo.addSaveSlotButtons=function(t,e,i,n,r,s){null==s&&(s=!1),eo.createSaveSlotButton(t,e,0,i,n,r,!1,s),eo.createSaveSlotButton(t,e,1,i,n,r,!1,s),eo.createSaveSlotButton(t,e,2,i,n,r,!1,s),eo.createSaveSlotButton(t,e,3,i,n,r,!1,s),eo.createSaveSlotButton(t,e,4,i,n,r,!1,s),eo.createSaveSlotButton(t,e,5,i,n,r,!1,s),eo.createSaveSlotButton(t,e,6,i,n,r,!1,s),eo.createSaveSlotButton(t,e,7,i,n,r,!1,s),eo.createSaveSlotButton(t,e,8,i,n,r,!1,s),eo.createSaveSlotButton(t,e,9,i,n,r,!1,s)},eo.createSaveSlotButton=function(l,h,u,c,d,p,f,g){if("saveLoad"==h.windowRelatedTo||"saveLoadDEL"==h.windowRelatedTo){var m=new ps(h,h.innerWindowStage,h.windowInner);m.fillSecondarySize=!0,m.direction=Ps.Vertical,Rr.getItem(u+"__meta",function(t,e){if("saveLoad"==h.windowRelatedTo||"saveLoadDEL"==h.windowRelatedTo){var i=!1,n="",r=!1,s=!1;null!=t||null==e||"SPEC_DELETED"==e?(e=Tr.lo("empty"),i=d,"SPEC_DELETED"==e&&(s=!0)):(p&&(n=" "+Tr.lo("overwrite"),r=!0),s=!0);var o=!1,a=null;a=po.createActivatableButton(h,i,function(){if(r&&!o){o=!0;var t=a.titleText,e=g?Tr.lo("really_delete",[u+1]):Tr.lo("really_overwrite",[u+1]);t.setText(e)}else c(""+u)},Tr.lo("slot_n",[u+1])+n,e,m,"spr_9p_button_disabled",null,eo.isWeirdText(e)),f&&u<100&&s&&eo.createSaveSlotButton(l,h,u+1,c,d,p,!0,g)}}),m.padding.bottom=2,h.windowInner.insertChild(m,h.windowInner.children.length-1)}},eo.isWeirdText=function(t){return new c("[^a-zA-Z\\-: 0-9<>\\[\\]{}~`=|\\\\@!#$%^&*\\(\\)_?]+","g").match(t)};var io=function(t,e,i){this.resetTexturesNextUpdate=!1,this.width=10,A.isMobile&&(this.width=14),this.parent=t,this.stage=e,this.scrollable=i,this.rect=new yr(0,0,this.width,0);var n=dt.getTextures("spr_windowparts",4);this.background=new Ys(n[0],3,9,9),e.addChild(this.background),this.scrollbar=new Ys(n[1],3,9,9),this.scrollbar.texture=n[2],this.scrollbar.updateTextures(!1),this.scrollbar.texture=n[3],this.scrollbar.updateTextures(!1),this.scrollbar.texture=n[1],this.scrollbar.updateTextures(!1),e.addChild(this.scrollbar)};(q["gui.ScrollBar"]=io).__name__="gui.ScrollBar",io.__interfaces__=[Qr],io.prototype={get_scrollPart:function(){return this.scrollable.scrollPosition.y},get_scrollHandlePosition:function(){return Math.round(this.get_scrollPart()/this.scrollable.get_innerHeight()*this.rect.height)},get_scrollHandleHeight:function(){return Math.round(this.scrollable.rect.height/this.scrollable.get_innerHeight()*this.rect.height)},updateSize:function(){this.parent.updateSize()},updatePosition:function(t){var e=this.rect;e.x=t.x,e.y=t.y;this.redraw()},redraw:function(){if(null!=this.scrollable){this.background.npWidth=this.width,this.background.npHeight=this.rect.height;var t=(i=this.rect).x,e=i.y;this.background.position.x=t;t=(i=this.rect).x,e=i.y;this.background.position.y=e,this.background.updateSprites(!0),this.scrollbar.npWidth=this.width,this.scrollbar.npHeight=this.get_scrollHandleHeight();t=(i=this.rect).x,e=i.y;this.scrollbar.position.x=t;t=(i=this.rect).x,e=i.y;var i,n=this.get_scrollHandlePosition();this.scrollbar.position.y=e+n,this.scrollbar.updateSprites(!0)}},destroy:function(){this.background.destroy(),this.scrollbar.destroy()},handleMouse:function(a){var l=this;if(this.rect.contains(a.position)){this.scrollable.handleScrollWheel(a);var h,u,c=!0,d=0;h=a.get_y()-l.rect.y;var t=l.get_scrollHandlePosition(),e=l.get_scrollHandlePosition()+l.get_scrollHandleHeight();return(u=t<=h&&h<e)&&(this.scrollbar.setTextureSet(1),this.resetTexturesNextUpdate=!1),a.strongClaimMouse(this,function(){if(null!=l.scrollable&&null!=l.background.parent){l.resetTexturesNextUpdate=!1,l.scrollbar.setTextureSet(2),h=a.get_y()-l.rect.y;var t=l.get_scrollHandlePosition(),e=l.get_scrollHandlePosition()+l.get_scrollHandleHeight();u=t<=h&&h<e,a.pressed&&(d=h-l.get_scrollHandlePosition(),c=u);var i=l.scrollable.get_innerHeight()-l.scrollable.rect.height,n=l.scrollable.scrollPosition.y;if(c){var r=h-d;0!=l.rect.height&&(n=Math.round(r*(l.scrollable.get_innerHeight()/l.rect.height)))}else{var s=l.get_scrollHandlePosition()+l.get_scrollHandleHeight()/2,o=Math.round(8*a.timeMod);h<s-o?n-=o:s+o<=h&&(n+=o)}n<0?n=0:i<n&&(n=i),l.scrollable.updateScrollPosition(new vr(l.scrollable.scrollPosition.x,n))}}),!0}return!1},update:function(){this.resetTexturesNextUpdate&&this.scrollbar.setTextureSet(0),this.resetTexturesNextUpdate=!0},__class__:io};var no=function(){};(q["gui.SecretCodeWindow"]=no).__name__="gui.SecretCodeWindow",no.create=function(o,a,t,e){a.windowAddTitleText(Tr.lo("secret_code")),e.addChild(new ao(e,t,Tr.lo("secret_code_use")+"\n"+Tr.lo("sample_code_2")+" Dance All Night")),e.addChild(new Ms(a.windowInner,new vr(2,4)));function i(t){if(null==t)return!1;switch(t.toLowerCase()){case"compat no masking":return O.compatDisableMasking=!O.compatDisableMasking,a.showSimpleWindow("NO masking: "+Y.string(O.compatDisableMasking),null,!0),O.save(),!0;case"coolmath":var e=null;return(e=function(){a.showSimpleWindow(no.getCoolMathText(o,!0),"",!0),a.addWindowToStack(e,!0),a.setWindowReload(e)})(),!0;case"dance all night":O.unlockSecretCode("nightClubColors");var i=null;return(i=function(){a.showSimpleWindow(Tr.lo("secret_code_1"),Tr.lo("secret_code_activated"),!0),a.addWindowToStack(i,!0),a.setWindowReload(i)})(),!0;case"debug_pathfinder":return a.createWindow(),a.windowAddInfoText(null,function(){return o.simulation.pathfinder.getTotalNumberOfRequested()+" - "+o.simulation.pathfinder.numberOfPathsDoneLastStepPerThread}),!0;case"hangar":O.unlockSecretCode("hangar");var n=null;return(n=function(){a.showSimpleWindow("",Tr.lo("secret_code_activated"),!0),a.addWindowToStack(n,!0),a.setWindowReload(n)})(),!0;case"orchid":O.unlockSecretCode("orchid");var r=null;return(r=function(){a.showSimpleWindow(Tr.lo("secret_code_2"),Tr.lo("secret_code_activated"),!0),a.addWindowToStack(r,!0),a.setWindowReload(r)})(),!0;case"stats":var s=null;return(s=function(){a.showSimpleWindow(no.getCoolMathText(o,!1),"",!0),a.addWindowToStack(s,!0),a.setWindowReload(s)})(),!0}return!1}var n=new ho(a.windowInner,a,o.game,Tr.lo("enter_secret_code"));e.addChild(n),n.onInput=i,e.addChild(new Ms(a.windowInner,new vr(2,4))),a.windowAddBottomButtons()},no.getCoolMathText=function(t,e){var i=lt.count(t.permanents,function(t){return t.isBuilding}),n="";if(0<dt.citizenNames.length){for(var r=Object.create(null),s=0,o=t.simulation.citizens;s<o.length;){var a=o[s];++s;var l=a.nameIndex<dt.citizenNames.length?dt.citizenNames[a.nameIndex]:Or.firstToUpper(Tr.lo("citizen"));if(Object.prototype.hasOwnProperty.call(r,l)){var h=r[_=a.nameIndex<dt.citizenNames.length?dt.citizenNames[a.nameIndex]:Or.firstToUpper(Tr.lo("citizen"))]+1;r[_]=h}else r[a.nameIndex<dt.citizenNames.length?dt.citizenNames[a.nameIndex]:Or.firstToUpper(Tr.lo("citizen"))]=1}for(var u="",c=0,d=0,p=Vo.keysIterator(r);p.hasNext();){var f=p.next();c<r[f]&&(c=r[u=f]),++d}var g="";2<c&&e&&(g=" If you want to know why there is a name that is so relatively common, take a look at the birthday paradox."),n="\n\n"+Tr.lo("citizen_name_stats",[t.simulation.citizens.length,d,u,r[u]])+g}var m=0;for(s=0,o=t.worlds;s<o.length;){var y=o[s];++s;for(var _=0,v=y.permanents;_<v.length;){var b=v[_];++_;for(var w=0,S=0,x=0;x<b.length;){var T=b[x];++x,null!=T&&T.isBuilding?++w:w=0,S<=w&&(S=w)}m<=S&&(m=S)}}var I="";if(0<t.landingSites.length&&(""==I?I="\n\n":I+=" ",I+=Tr.lo("landing_pads_stats",[gr.sum(t.landingSites,function(t){return t.timesUsed}),gr.sum(t.landingSites,function(t){return t.timesUsedStopOver})]),10<t.simulation.flyingSaucers.length)){var P=gr.isum(t.simulation.flyingSaucers,function(t){return t.passengers.length});I+=" "+Tr.lo("landing_pads_air",[t.simulation.flyingSaucers.length,P])}for(s=[],o=0,_=t.permanents;o<_.length;){h=_[o];++o,h.is(ci)&&s.push(h)}var C=s;0<C.length&&(""==I?I="\n\n":I+="\n",I+=Tr.lo("hyper_elevators_stats",[gr.sum(C,function(t){return t.timesUsed})])),0<t.teleporters.length&&(""==I?I="\n\n":I+="\n",I+=Tr.lo("teleporter_stats",[gr.sum(t.teleporters,function(t){return t.timesUsed})]));var E=Tr.lo("stats_info");return e&&(E="Alright, I did some cool math; here are some stats about your city!"),E+" :)\n\n"+Tr.lo("building_stats",[i,m])+I+n};var ro=function(t,e,i,n,r){var s=dt.getTexture("spr_slider_fill");this.fillPatch=new Ys(s,2,20,20),this.fillLevel=n,this.setFillLevel=r,ps.call(this,t,e,i,null,null,null,new Ys(dt.getTexture("spr_slider_bg"),2,20,20)),this.padding.top=3,this.padding.left=3,this.padding.right=3,this.padding.bottom=1,this.fillSecondarySize=!0,e.addChild(this.fillPatch),this.updateFillSize()};(q["gui.Slider"]=ro).__name__="gui.Slider",ro.__super__=ps,ro.prototype=e(ps.prototype,{updateFillSize:function(){if(null!=this.fillPatch){var t=this.fillPatch.npWidth,e=this.fillPatch.npHeight,i=this.fillLevel()*this.rect.width;this.fillPatch.npWidth=Math.round(i),this.fillPatch.npHeight=this.rect.height,null!=this.fillPatch&&(this.fillPatch.position.x=this.rect.x,this.fillPatch.position.y=this.rect.y,this.fillPatch.updateSprites()),t==this.fillPatch.npWidth&&e==this.fillPatch.npHeight||this.fillPatch.updateSprites()}},updatePosition:function(t){ps.prototype.updatePosition.call(this,t),null!=this.fillPatch&&(this.fillPatch.position.x=this.rect.x,this.fillPatch.position.y=this.rect.y,this.fillPatch.updateSprites())},updateChildrenPosition:function(){ps.prototype.updateChildrenPosition.call(this),this.updateFillSize()},updateSizeNonRecursive:function(){ps.prototype.updateSizeNonRecursive.call(this)},handleMouse:function(i){var n=this;return!!this.rect.contains(i.position)&&(i.hasNoClaim()&&i.strongClaimMouse(this,function(){var t=(i.position.x-n.rect.x)/n.rect.width,e=t<0?0:1<t?1:t;e<.025&&(e=0),.975<e&&(e=1),n.setFillLevel(e),n.updateFillSize(),i.strongClaimOnEnd=function(){n.gui.game.audio.playSound(n.gui.game.audio.buttonSound)}}),!0)},update:function(){ps.prototype.update.call(this)},destroy:function(){ps.prototype.destroy.call(this),this.fillPatch.destroy()},__class__:ro});var so=function(){};(q["gui.SwitchCityWindow"]=so).__name__="gui.SwitchCityWindow",so.create=function(e,i,t){e.gui.clearTutorial(),t.createWindow(),t.windowRelatedTo="switchCity",e.gui.clearWindowStack();var n=e,r=i,s=t;t.addWindowToStack(function(){so.create(n,r,s)}),t.windowAddTitleText(Tr.lo("switch_city"));var o=e.subCities;e.cityMainFile!=e.cityFile&&po.createActivatableButton(t,!1,function(){i.loadSubCity(e,e.cityMainFile,"")},e.progress.allCitiesInfo.subCityNames[0],"",t.windowInner,"spr_9p_button_disabled");for(var a=1,l=0;l<o.length;){var h=[o[l]];++l,e.cityMainFile+"-"+h[0]!=e.cityFile&&po.createActivatableButton(t,!1,function(t){return function(){i.loadSubCity(e,e.cityMainFile,t[0])}}(h),e.progress.allCitiesInfo.subCityNames[a],"",t.windowInner,"spr_9p_button_disabled"),++a}l=0;for(var u=e.possibleSubCities;l<u.length;){var c=[u[l]];++l;var d=Tr.lo("stories.json/"+c[0]+".name");po.createActivatableButton(t,!1,function(t){return function(){at.remove(e.possibleSubCities,t[0]),i.createSubCity(e,t[0])}}(c),d,"",t.windowInner,"spr_9p_button_disabled")}t.windowAddBottomButtons()};var oo=function(t,e,i,n,r,s,o,a,l){null==l&&(l="Arial"),null==a&&(a="spr_button"),this.extraTextPosY=0,this.extraHeight=0,this.extraWidth=0,A.isMobile&&(this.extraHeight+=4,this.extraTextPosY+=2),ns.call(this,t,e,i,n,s,o),this.buttonTextures=dt.getTextures(a,3),this.buttonPatch=new Ys(this.buttonTextures[0],2,2,0|this.buttonTextures[0].height),this.buttonPatch.texture=this.buttonTextures[1],this.buttonPatch.updateTextures(!1),this.buttonPatch.texture=this.buttonTextures[2],this.buttonPatch.updateTextures(!1),this.buttonPatch.setTextureSet(0),e.addChild(this.buttonPatch),this.rect=new yr(0,0,1,2+(0|this.buttonTextures[0].height)),this.bitmapText=new Ur(r,{font:l,tint:0}),this.setText(r,!1),e.addChild(this.bitmapText)};(q["gui.TextButton"]=oo).__name__="gui.TextButton",oo.__super__=ns,oo.prototype=e(ns.prototype,{setText:function(t,e){null==e&&(e=!0),null!=t?this.text=t:t=this.text,this.bitmapText.set_text(t);var i=Math.ceil(this.bitmapText.get_textWidth())+6;this.rect.width=i+this.extraWidth;i=Math.ceil(this.bitmapText.get_textHeight());var n="Arial16"==this.bitmapText.get_fontName()?6:3;this.rect.height=i+n+this.extraHeight,this.buttonPatch.npWidth=this.rect.width,this.buttonPatch.npHeight=this.rect.height,e&&this.updateSize()},updatePosition:function(t){var e=this.rect;e.x=t.x,e.y=t.y;this.buttonPatch.position.set(t.x,t.y),this.buttonPatch.updateSprites(),this.bitmapText.position.set(t.x+3+(this.extraWidth/2|0),t.y+1+this.extraTextPosY),ns.prototype.updatePosition.call(this,t)},fillWidth:function(){this.extraWidth=this.parent.rect.width-this.rect.width-4,this.setText(this.text)},handleMouse:function(t){var e=this;return ns.prototype.doHandleMouse.call(this,t,function(){e.buttonPatch.setTextureSet(1)},function(){e.buttonPatch.setTextureSet(2)})},update:function(){this.mouseOut&&this.buttonPatch.setTextureSet(0),this.isActive()&&this.buttonPatch.setTextureSet(2),ns.prototype.update.call(this)},destroy:function(){ns.prototype.destroy.call(this),this.buttonPatch.destroy(),this.bitmapText.destroy()},__class__:oo});var ao=function(t,e,i,n,r,s,o,a,l){null==l&&(l=!1),null==a&&(a=!1),null==o&&(o=250),null==r&&(r="Arial"),null==i&&(i="");var h,u=new Ur("",{font:r,tint:0},l);switch(u.set_maxWidth(o),this.container=u,this.setTextWithoutSizeUpdate(i),this.textUpdateFunction=n,this.neverDecreaseSize=a,r){case"Arial":h={left:0,right:0,top:-2,bottom:2};break;case"Arial10":h={left:0,right:0,top:-3,bottom:3};break;case"Arial15":h={left:0,right:0,top:-3,bottom:2};break;case"Arial16":h={left:0,right:0,top:-2,bottom:4};break;default:h={left:0,right:0,top:-3,bottom:2}}s=null==s?h:{left:s.left+h.left,right:s.right+h.right,top:s.top+h.top,bottom:s.bottom+h.bottom},ds.call(this,t,e,u,s)};(q["gui.TextElement"]=ao).__name__="gui.TextElement",ao.__super__=ds,ao.prototype=e(ds.prototype,{get_textContainer:function(){return this.container},updateSize:function(){var t,e,i=this.rect.width-this.padding.left-this.padding.right,n=this.rect.height-this.padding.top-this.padding.bottom;if(""==this.get_textContainer().get_text())e=t=0;else{var r=this.container;t=Math.round(r.get_textWidth()),e=Math.round(r.get_textHeight())}this.neverDecreaseSize?(this.rect.width=i<t?t:i,this.rect.height=n<e?e:n):(this.rect.width=t,this.rect.height=e),i==this.rect.width&&n==this.rect.height||ds.prototype.afterSizeUpdate.call(this)},setTextAndTextUpdate:function(t,e){this.setText(t),this.textUpdateFunction=e},setText:function(t){this.setTextWithoutSizeUpdate(t),this.updateSize()},setTextWithoutSizeUpdate:function(t){var e=this.get_textContainer();C.startsWith(t,"[red]")?(t=at.substr(t,"[red]".length,null),e.set_tint(16711680)):C.startsWith(t,"[blue]")?(t=at.substr(t,"[blue]".length,null),e.set_tint(16528)):C.startsWith(t,"[green]")?(t=at.substr(t,"[green]".length,null),e.set_tint(65280)):C.startsWith(t,"[white]")?(t=at.substr(t,"[white]".length,null),e.set_tint(16777215)):e.set_tint(0),this.get_textContainer().set_text(t)},update:function(){if(null!=this.textUpdateFunction){var t=this.textUpdateFunction();this.get_textContainer().get_text()!=t&&this.setText(t)}},__class__:ao});var lo=function(t,e,i,n,r,s,o,a,l){null==l&&(l=12),null==a&&(a=!1),null==o&&(o=250),null==r&&(r="Arial"),null==i&&(i="");var h=new PIXI.Text("",{fontFamily:r,fill:0,fontSize:2*l,wordWrap:!0,wordWrapWidth:2*o});h.text=i,h.scale.x=.5,h.scale.y=.5,h.roundPixels=!0,this.textUpdateFunction=n,this.neverDecreaseSize=a,null==s&&(s={left:0,right:0,top:-3,bottom:2}),ds.call(this,t,e,h,s)};(q["gui.TextElementAlt"]=lo).__name__="gui.TextElementAlt",lo.__super__=ds,lo.prototype=e(ds.prototype,{get_textContainer:function(){return this.container},setText:function(t){var e=this.container;e.text=t,e.updateText(),e.updateTexture(),e.updateTransform(),this.updateSize()},update:function(){if(null!=this.textUpdateFunction){var t=this.textUpdateFunction();this.get_textContainer().text!=t&&this.setText(t)}},__class__:lo});var ho=function(t,e,i,n,r){null==r&&(r=""),null==n&&(n=""),this.onInput=null;var s=this;this.parent=t,this.gui=e,this.game=i,this.rect=new yr(0,0,250,20),this.inputElement=window.document.createElement("input"),this.inputElement.type="text",this.inputElement.style.position="absolute",this.inputElement.style.left="10px",this.inputElement.style.top="10px",this.inputElement.style.fontFamily="Arial,sans-serif",this.inputElement.style.fontSize="20px",this.inputElement.value=r,this.inputElement.placeholder=n,window.document.body.appendChild(this.inputElement),this.inputElement.focus(),i.keyboard.inputs.push(this.inputElement),this.inputElement.addEventListener("input",function(){null!=s.onInput&&s.onInput(s.inputElement.value)})};(q["gui.TextInput"]=ho).__name__="gui.TextInput",ho.__interfaces__=[Qr],ho.prototype={updateSize:function(){var t=""+Math.floor(this.rect.width*this.game.get_preDPIAdjustScaling()-6);this.inputElement.style.width=t+"px";t=""+Math.floor(10*this.game.get_preDPIAdjustScaling());this.inputElement.style.fontSize=t+"px";t=""+Math.floor(this.rect.height*this.game.get_preDPIAdjustScaling()-6);this.inputElement.style.height=t+"px"},updatePosition:function(t){var e=Math.floor(t.x*this.game.get_preDPIAdjustScaling());this.inputElement.style.left=e+"px";e=Math.floor(t.y*this.game.get_preDPIAdjustScaling());this.inputElement.style.top=e+"px",this.updateSize()},destroy:function(){this.inputElement.parentNode.removeChild(this.inputElement),at.remove(this.game.keyboard.inputs,this.inputElement)},handleMouse:function(t){return!!this.rect.contains(t.position)},update:function(){},__class__:ho};var uo=function(t,e,i){this.isContinousDisplay=!1,this.contentsSetLastStep=!1,this.timeBeforeShown=0,this.owner=null,this.emptyCost2=new L,this.emptyCost=new L,this.game=t,this.stage=i,this.bg=new Ys(dt.getTexture("spr_9p_tooltip"),2,4,4),this.bg.position.set(0,0),i.addChild(this.bg),this.tooltipHeader=new Ur("",{font:"Arial16",tint:0}),this.tooltipHeader.position.set(2,0),i.addChild(this.tooltipHeader),this.tooltipText=new Ur("",{font:"Arial",tint:0}),this.tooltipText.position.set(3,0),i.addChild(this.tooltipText),this.tooltipCost=new Hs(e,this.emptyCost),this.tooltipCost.position.set(3,0),i.addChild(this.tooltipCost),this.tooltipCost2=new Hs(e,new L),this.tooltipCost2.position.set(3,0),this.tooltipCost2.setAfterKnowledgeText(""),i.addChild(this.tooltipCost2),this.tooltipCost2Text=new Ur("",{font:"Arial",tint:0}),this.tooltipCost2Text.position.set(3,0),i.addChild(this.tooltipCost2Text),this.tooltipExtraIcons=new Ls([]),i.addChild(this.tooltipExtraIcons),this.tooltipExtraIcons2=new Ls([]),this.tooltipExtraIcons2.position.set(2,0),i.addChild(this.tooltipExtraIcons2),this.tooltipPosition=new vr(0,0),i.position.set(-100,-100),this.owner=null,this.timeBeforeShown=0,this.setTextDisplay("","")};(q["gui.Tooltip"]=uo).__name__="gui.Tooltip",uo.prototype={get_tooltipDelay:function(){return this.game.mouse.isTouch?30:0},get_knownGUI:function(){return this.game.state.get_publicGUI()},update:function(t){if(!this.contentsSetLastStep)return this.setTextDisplay(),this.isContinousDisplay=!1,this.owner=null,void(this.timeBeforeShown=0);if(this.contentsSetLastStep=!1,0<this.timeBeforeShown){if(this.isContinousDisplay||this.setTextDisplay(),this.timeBeforeShown-=t,!this.isContinousDisplay)return}else if(""==this.text&&""==this.header)return;if(this.isContinousDisplay){this.tooltipPosition=new vr(0,0);var e=this.get_knownGUI().safeAreaLeft,i=this.get_knownGUI().safeAreaTop,n=new PIXI.Point(e,i);this.stage.position=n;n=null==this.game.state||null==this.game.state.get_publicGUI().window;this.stage.visible=n}else{this.stage.visible=!0,this.game.mouse.isTouch||(this.tooltipPosition=this.game.mouse.position);var r=this.tooltipPosition;n=new PIXI.Point(r.x,r.y);this.stage.position=n,this.stage.position.y+=this.tooltipPosition.y>this.height?-this.height:21/this.game.scaling|0,this.stage.position.x+this.width>this.game.rect.width&&(this.stage.position.x-=this.width,this.stage.position.x<0&&(this.stage.position.x=0))}},destroy:function(){for(var t=this.stage,e=t.children.length-1;0<=e;)t.children[e].destroy(),--e},setText:function(t,e,i,n,r,s,o,a){null==a&&(a=""),null==i&&(i=""),this.contentsSetLastStep=!0,this.owner==t&&!this.game.mouse.pressed||(this.owner=t,this.timeBeforeShown=this.get_tooltipDelay(),this.game.mouse.isTouch&&(this.tooltipPosition=this.game.mouse.position)),0<this.timeBeforeShown?this.game.mouse.isTouch&&!this.game.mouse.down&&(this.owner=null,this.contentsSetLastStep=!1):(this.game.mouse.isTouch&&this.game.mouse.claimMouse(this),this.isContinousDisplay&&this.game.mouse.isTouch&&(this.tooltipPosition=this.game.mouse.position),this.isContinousDisplay=!1,this.setTextDisplay(e,i,n,r,s,o,a))},setTextForContinuous:function(t,e,i,n,r,s,o){null==o&&(o=""),null==e&&(e=""),null==this.owner&&(this.contentsSetLastStep=!0,this.isContinousDisplay=!0,this.setTextDisplay(t,e,i,n,r,s,o),this.isContinousDisplay=!0)},setTextDisplay:function(t,e,i,n,r,s,o){null==o&&(o=""),null==e&&(e=""),null==t&&(t="");var a=0,l=a,h=0;if(this.header!=e||this.text!=t||this.cost2Text!=o||(null!=i||this.tooltipCost.wouldChangeDisplay(this.emptyCost))&&this.tooltipCost.wouldChangeDisplay(i)||(null!=s||this.tooltipCost2.wouldChangeDisplay(this.emptyCost))&&this.tooltipCost2.wouldChangeDisplay(s)||(null!=n||this.tooltipExtraIcons.wouldChangeDisplay([]))&&this.tooltipExtraIcons.wouldChangeDisplay(n)||(null!=r||this.tooltipExtraIcons2.wouldChangeDisplay([]))&&this.tooltipExtraIcons2.wouldChangeDisplay(r)){var u=Math.max(this.game.rect.width/2,Math.min(Math.max(this.tooltipPosition.x-10,this.game.rect.width-this.tooltipPosition.x-10),240));if(this.isContinousDisplay&&(u=this.game.rect.width-this.get_knownGUI().safeAreaLeft-this.get_knownGUI().safeAreaRight),this.header=e,this.text=t,this.costInfo=i,null!=n&&0<n.length&&this.tooltipExtraIcons.setDisplay(n),this.width=0,!this.isContinousDisplay||""==this.header&&""==this.text||(this.width=Math.ceil(u)),""!=e){l=a,--a;var c=u-this.tooltipExtraIcons.displayWidth-10,d=this.isContinousDisplay?1e3:350;this.tooltipHeader.set_maxWidth(c<100?100:d<c?d:c),this.tooltipHeader.set_text(e),h=Math.ceil(this.tooltipHeader.get_textWidth())+6;var p=this.width;this.width=p<h?h:p,a+=Math.ceil(this.tooltipHeader.get_textHeight())+2}else this.tooltipHeader.set_text("");if(""!=t){++a;c=u-10,d=this.isContinousDisplay?1e3:350;this.tooltipText.set_maxWidth(c<100?100:d<c?d:c),this.tooltipText.set_text(t),this.tooltipText.position.y=a;p=this.width;var f=Math.ceil(this.tooltipText.get_textWidth())+6;this.width=p<f?f:p,a+=Math.ceil(this.tooltipText.get_textHeight())}else this.tooltipText.set_text("");if(null!=r&&0<r.length){this.tooltipExtraIcons2.setDisplay(r),this.tooltipExtraIcons2.position.y=a+1;p=this.width,f=Math.ceil(this.tooltipExtraIcons2.displayWidth)+6;this.width=p<f?f:p,a+=12}else this.tooltipExtraIcons2.setDisplay([]);if(null!=i&&i.any()){a+=2,this.tooltipCost.position.y=a,this.tooltipCost.displayCityAmounts=this.game.isMobile&&!this.game.isLargeMobile&&this.isContinousDisplay,this.tooltipCost.maxDisplayWidth=this.game.rect.width,this.tooltipCost.setCost(i);p=this.width,f=this.tooltipCost.displayWidth+6-6;this.width=p<f?f:p,a+=11}else this.tooltipCost.setCost(this.emptyCost);if(null!=s&&s.any()){var g=3;this.tooltipCost2Text.set_text(o),this.tooltipCost2Text.position.y=a,""!=o&&(g+=Math.ceil(this.tooltipCost2Text.get_textWidth())+3),a+=2,this.tooltipCost2.position.x=g,this.tooltipCost2.position.y=a,this.tooltipCost2.maxDisplayWidth=this.game.rect.width-g,this.tooltipCost2.setCost(s);p=this.width,f=this.tooltipCost2.displayWidth+6-6+g;this.width=p<f?f:p,a+=11}else this.tooltipCost2Text.set_text(""),this.tooltipCost2.setCost(this.emptyCost2);if(null!=n&&0<n.length){p=this.width,f=h+this.tooltipExtraIcons.displayWidth;this.width=p<f?f:p,this.tooltipExtraIcons.position.x=this.width-1-this.tooltipExtraIcons.displayWidth,this.tooltipExtraIcons.position.y=l+3}else this.tooltipExtraIcons.setDisplay([]);a+=2,this.height=a,this.bg.npWidth=this.width,this.bg.npHeight=this.height,this.bg.updateSprites()}},shown:function(){return""!=this.text||""!=this.header},__class__:uo};var co=function(t,e,i,n,r,s){null==s&&(s=600),this.fadeout=1,this.game=t,this.gui=e,this.stage=new PIXI.Container,this.outerStage=i,this.outerStage.addChild(this.stage),this.bg=new Ys(dt.getTexture("spr_9p_tooltip"),2,4,4),this.bg.position.set(0,0),this.stage.addChild(this.bg),this.tooltipHeader=new Ur("",{font:"Arial16",tint:0}),this.tooltipHeader.position.set(2,0),this.stage.addChild(this.tooltipHeader),this.tooltipText=new Ur("",{font:"Arial",tint:0}),this.tooltipText.position.set(3,0),this.stage.addChild(this.tooltipText),this.tooltipPosition=new vr(0,0),this.stage.position.set(0,0),this.setTextDisplay(n,r),this.displayTime=s};(q["gui.TopScreenNotification"]=co).__name__="gui.TopScreenNotification",co.prototype={update:function(t){if(this.displayTime<0)return this.fadeout-=.05*t,this.stage.alpha=this.fadeout,void(this.fadeout<0&&(this.stage.destroy(),at.remove(this.gui.notifications,this)));this.displayTime-=t},setTextDisplay:function(t,e){null==e&&(e=""),null==t&&(t="");var i=0;if(this.header!=e||this.text!=t){var n=this.game.rect.width;if(this.header=e,this.text=t,this.width=0,""==this.header&&""==this.text||(this.width=Math.ceil(n)),""!=e){--i;var r=n-10;this.tooltipHeader.set_maxWidth(r<100?100:1e3<r?1e3:r),this.tooltipHeader.set_text(e),Math.ceil(this.tooltipHeader.get_textWidth())+6,i+=Math.ceil(this.tooltipHeader.get_textHeight())+2}else this.tooltipHeader.set_text("");if(""!=t){++i;r=n-10;this.tooltipText.set_maxWidth(r<100?100:1e3<r?1e3:r),this.tooltipText.set_text(t),this.tooltipText.position.y=i,i+=Math.ceil(this.tooltipText.get_textHeight())}else this.tooltipText.set_text("");i+=2,this.height=i,this.bg.npWidth=this.width,this.bg.npHeight=this.height,this.bg.updateSprites()}},__class__:co};var po=function(){};(q["gui.UpgradeWindowParts"]=po).__name__="gui.UpgradeWindowParts",po.createActivatableButton=function(t,e,i,n,r,s,o,a,l){var h;null==l&&(l=!1),null==o&&(o="spr_9p_button_active"),null==s&&(s=t.windowInner);var u=null;if(e)h=new ps(t,t.innerWindowStage,s,null,null,null,new Ys(dt.getTexture(o),1,3,3)),s.addChild(h);else{var c=new us(t,t.innerWindowStage,s,i);h=c.container,s.addChild(c),null!=a&&(c.buttonSound=a),u=c}h.padding.top=3,h.padding.left=3,h.padding.right=3,h.padding.bottom=1,h.fillSecondarySize=!0,h.direction=Ps.Vertical;var d=h.addChild(new ao(h,t.innerWindowStage,n)),p=null;return""!=r&&(p=l?h.addChild(new lo(h,t.innerWindowStage,r,null,"Arial",null,250,null,10)):h.addChild(new ao(h,t.innerWindowStage,r,null,"Arial10"))),s.addChild(new Ms(s,new vr(2,2))),{container:h,titleText:d,description:p,button:u}},po.createCheckboxButton=function(t,i,e,n,r,s,o,a){null==o&&(o="spr_9p_button_active"),null==s&&(s=t.windowInner);var l,h=new ss(t,t.innerWindowStage,s,e,i),u=h.container;s.addChild(h),null!=a&&(h.buttonSound=a),l=h,u.padding.top=3,u.padding.left=3,u.padding.right=3,u.padding.bottom=1,u.fillSecondarySize=!0,u.direction=Ps.Vertical;var c=new ps(t,t.innerWindowStage,u);c.direction=Ps.Horizontal;var d=dt.getTextures("spr_checkbox",2),p=new PIXI.Sprite(d[1]),f=new ds(c,t.innerWindowStage,p,{left:0,right:3,top:0,bottom:0},function(){var t=d,e=i()?0:1;p.texture=t[e]});c.addChild(f);var g=new ao(c,t.innerWindowStage,n);c.addChild(g),u.addChild(c);var m=u.addChild(new ao(u,t.innerWindowStage,r,null,"Arial10"));return s.addChild(new Ms(s,new vr(2,2))),{container:u,titleText:g,description:m,button:l}},po.createHeader=function(t,e,i){null==i&&(i=t.windowInner);var n=new ps(t,t.innerWindowStage,i);return n.fillSecondarySize=!0,n.addChild(new ao(n,t.innerWindowStage,e,null,"Arial15",{left:0,right:0,top:3,bottom:0})),n.addChild(new As(n,2)),i.addChild(n),i.addChild(new Ms(i,new vr(2,2))),n},po.addOneAndMaxButtons=function(t,e,i,n,r,s,o,a){var l=new oo(t,t.innerWindowStage,e,i,Tr.lo("one"),function(){return!po.hasMultiUpgradeModeOn},function(){t.tooltip.setText(l,r)});e.addChild(l),e.addChild(new Ms(e,new vr(2,2)));var h=new oo(t,t.innerWindowStage,e,n,a?Tr.lo("max"):Tr.lo("all"),function(){return po.hasMultiUpgradeModeOn},function(){t.tooltip.setText(h,a?s():o())});e.addChild(h)};var fo=T["gui.WindowPosition"]={__ename__:"gui.WindowPosition",__constructs__:["Top","Center","CenterOffset","TopLeft","CenterWithBanner"],Top:{_hx_index:0,__enum__:"gui.WindowPosition",toString:i},Center:{_hx_index:1,__enum__:"gui.WindowPosition",toString:i},CenterOffset:(N=function(t){return{_hx_index:2,offsetToTop:t,__enum__:"gui.WindowPosition",toString:i}},N.__params__=["offsetToTop"],N),TopLeft:{_hx_index:3,__enum__:"gui.WindowPosition",toString:i},CenterWithBanner:{_hx_index:4,__enum__:"gui.WindowPosition",toString:i}},go=function(){};(q["gui.WorkerDistributionWindow"]=go).__name__="gui.WorkerDistributionWindow",go.create=function(t,e,i,n){go.createWindow(t,e,i,n)},go.createWindow=function(a,t,e,i){t.windowAllowBanner(),i.clear(),t.windowAddTitleText(Tr.lo("assign_workers"),null,dt.getTexture("spr_work"));for(var n=[],r=[],s=0,o=a.permanents;s<o.length;){var l=o[s];if(++s,l.is(ee)){var h=Ko.getClass(l);if(-1==(b=n.indexOf(h))){b=n.length,n.push(h);var u=h.__name__.split(".");r.push(u[u.length-1])}}}var c=[];for(s=0,o=a.progress.resources.buildingInfoArray;s<o.length;){var d=o[s];++s,-1!=(b=r.indexOf(d.className))&&c.push(n[b])}function p(){f=[];for(var t=0;t<c.length;){c[t];++t,f.push({number:0,filledJobs:0,jobs:0})}t=0;for(var e=a.permanents;t<e.length;){var i=e[t];if(++t,i.is(ee)){var n=i,r=Ko.getClass(i),s=c.indexOf(r);if(-1!=s){var o=f[s];o.jobs+=n.get_jobs(),o.filledJobs+=n.workers.length,o.number+=1}}}}var f=[];p(),i.onUpdate=p;var g={left:2,top:5,bottom:0,right:0},m=new ps(t,e,i),y=new ps(t,e,m),_=new ps(t,e,m),v=new ps(t,e,m);y.direction=Ps.Vertical,_.direction=Ps.Vertical,v.direction=Ps.Vertical;for(s=0,o=c.length;s<o;){var b=[s++],w=[c[b[0]]],S=[w[0].__name__];if("cityofthekey"!=a.progress.story.storyName||"buildings.SecretSocietyHouse"!=S[0]){var x=f[b[0]],T=new ps(t,e,y);T.addChild(is.create(e,a,w[0],T,t));var I=new ps(t,e,T,null,null,null,null,g);I.addChild(new ao(I,e,"x"+x.number+": ")),T.addChild(I),y.addChild(T);var P=new ps(t,e,_,null,null,null,null,g);P.minHeight=15,P.addChild(new ao(P,e,null,function(t){return function(){return Tr.lo("workers",[f[t[0]].filledJobs,f[t[0]].jobs])+","}}(b))),_.addChild(P);var C=new ps(t,e,v,null,null,null,null,{left:4,top:2,bottom:0,right:0});C.minHeight=18;var E=a.simulation.jobAssigner.priorityJobs.h[S[0]];null==E&&(E=0);var A=new qs(t,e,C,null,function(){return 0},function(t){return function(){return f[t[0]].jobs}}(b),E,function(i,n){return function(t){var e=a.simulation.jobAssigner.priorityJobs.h[i[0]];t<e&&a.simulation.jobAssigner.availableClassesForJob.push({classType:ht.getClassID(n[0].__name__),number:e-t}),a.simulation.jobAssigner.priorityJobs.h[i[0]]=t,a.simulation.jobAssigner.buildingsHaveWork=!0}}(S,w),function(t){return function(){return a.game.keyboard.down[16]?0:a.game.keyboard.down[17]?1e6:f[t[0]].filledJobs}}(b),a.game.isMobile?Tr.lo("set_priority_jobs_mobi"):Tr.lo("set_priority_jobs_desktop"));A.enableBeyondHighestValuePossibility(1e6,"Max"),C.addChild(A),"buildings.StoneMine"==S[0]?(go.tutorialStoneMineUpButton=A.upButton,go.tutorialStoneMineDownButton=A.downButton):"buildings.WoodcuttingCentre"==S[0]&&(go.tutorialWoodCuttersUpButton=A.upButton),C.addChild(new ao(C,e," "+Tr.lo("priority")+".",null,null,{left:0,top:3,bottom:0,right:0})),v.addChild(C)}}0==c.length&&t.windowAddInfoText(Tr.lo("no_work_buildings")),m.addChild(y),m.addChild(_),m.addChild(v),i.addChild(m);s=Uh(N=a.gui,N.reloadWindow);function M(){go.createWindow(B,R,O,k)}var B=a,R=t,O=e,k=i;a.windowRelatedOnBuildOrDestroy=function(){s(M)},i.onDestroy=function(){a.windowRelatedOnBuildOrDestroy=null,go.tutorialStoneMineUpButton=null,go.tutorialStoneMineDownButton=null,go.tutorialWoodCuttersUpButton=null},t.windowAddBottomButtons()};function mo(){}(q["gui.infoWindows.BoostHelpWindow"]=mo).__name__="gui.infoWindows.BoostHelpWindow",mo.createWindow=function(t,e,i){null==i&&(i=!0),i&&t.gui.clearWindowStack(),t.gui.createWindow("boost"),t.gui.clearWindowStack();var n=t,r=e,s=i,o=function(){mo.createWindow(n,r,s)};t.gui.setWindowReload(o);var a=t,l=e,h=i;o=function(){mo.createWindow(a,l,h)};t.gui.addWindowToStack(o);var u=Tr.lo("boost");t.gui.windowAddTitleText(u),t.gui.windowAddInfoText(Tr.lo("boost_use_case")+"\n"+Tr.lo("boost_earn_extra_reward"));var c=t.gui.innerWindowStage,d=t.gui.windowInner,p=new cs(t.gui,c,d,e,function(){return!1},function(){},"spr_button",10526880,16777215,function(){return-1});p.container.fillSecondarySize=!0;var f=t.gui.game.isMobile?3:0;p.container.padding={left:2+f,right:3+f,top:2+f,bottom:1+f},p.container.updateSize(),p.container.addChild(new ds(p.container,c,new PIXI.Sprite(dt.getTexture("spr_icon_boost")))),p.container.addChild(new ao(p.container,c,null,function(){return Tr.lo("boost")},"Arial15",{left:3,right:0,top:2,bottom:0})),d.addChild(p)};var yo=function(){};(q["gui.infoWindows.FindBuildingsOfType"]=yo).__name__="gui.infoWindows.FindBuildingsOfType",yo.createWindow=function(n,t){null==t&&(t=!0),t&&n.gui.clearWindowStack(),n.gui.createWindow("highlight_buildings");var e=n,i=t,r=function(){yo.createWindow(e,i)};n.gui.setWindowReload(r);function s(){yo.createWindow(a,l)}var o=Uh(N=n.gui,N.reloadWindow),a=n,l=t;r=function(){o(s)};n.windowRelatedOnBuildOrDestroy=r,n.gui.window.onDestroy=function(){n.windowRelatedOnBuildOrDestroy=null};var h=n,u=t;r=function(){yo.createWindow(h,u)};n.gui.addWindowToStack(r);var c=Tr.lo("highlight_buildings");n.gui.windowAddTitleText(c);for(var d=!0,p=0,f=dt.buildingCategoriesInfo;p<f.length;){var g=f[p];++p;var m=new Ms(n.gui.windowInner,new vr(2,d?0:6));n.gui.windowInner.addChild(m);var y=n.gui.windowAddInfoText(Tr.lo("categories/"+g.name+".name"),null,"Arial15"),_=new ps(n.gui,n.gui.innerWindowStage,n.gui.windowInner);_.direction=Ps.Horizontal,n.gui.windowInner.addChild(_);for(var v=!0,b=0,w=0,S=n.progress.resources.buildingInfoArray;w<S.length;){var x=[S[w]];++w;var T="buildings."+x[0].className,I=[q[T]],P=n.progress.unlocks.getUnlockState(I[0]),C=F.field(I[0],"spriteName"),E=(null!=x[0].showUnlockHint||-1!=x[0].specialInfo.indexOf("premium"))&&P==$a.Unlocked;if(x[0].category==g.name&&(P==$a.Unlocked&&!E||P==$a.Researched||P==$a.Createable)){var A=[];A[0]=new Us(n.gui,n.gui.innerWindowStage,n.gui.windowInner,function(t,e){return function(){_o.createWindow(n,t[0],e[0],!1),Gn.doHighlight(n,t[0])}}(I,x),dt.getTexture(C+"@0,0,20,20"),function(){return!1},function(t,e,i){return function(){n.gui.tooltip.setText(t[0],i[0].name),Gn.doHighlight(n,e[0])}}(A,I,x),"none"==x[0].buttonBack?null:dt.getTexture(null==x[0].buttonBack?C+"@44,0,20,20":x[0].buttonBack)),_.addChild(A[0]),v=!1,8<++b&&((_=new ps(n.gui,n.gui.innerWindowStage,n.gui.windowInner)).direction=Ps.Horizontal,n.gui.windowInner.addChild(_),b=0)}}v?(n.gui.windowInner.removeChild(m,!1),n.gui.windowInner.removeChild(_,!1),n.gui.windowInner.removeChild(y,!0)):d=!1}var M=new Ms(n.gui.windowInner,new vr(2,6));n.gui.windowInner.addChild(M),n.gui.windowAddBottomButtons()};var _o=function(){};(q["gui.infoWindows.FindBuildingsOfTypeActive"]=_o).__name__="gui.infoWindows.FindBuildingsOfTypeActive",_o.createWindow=function(e,i,t,n){null==n&&(n=!0),n&&e.gui.clearWindowStack(),e.gui.createWindow(i),e.gui.setWindowPositioning(e.game.isMobile?fo.TopLeft:fo.Top);var r=e,s=i,o=t,a=n,l=function(){_o.createWindow(r,s,o,a)};e.gui.setWindowReload(l);var h=e,u=i,c=t,d=n;l=function(){_o.createWindow(h,u,c,d)};e.gui.addWindowToStack(l);var p=Tr.lo("highlighting",[t.name]);e.gui.windowAddTitleText(p);e.gui.windowAddBottomButtons([{text:Tr.lo("select_any"),action:function(){var t=Gn.findLeastUpgraded(e,i);null!=t&&t.showWindow()}}]);e.gui.windowOnLateUpdate=function(){Gn.doHighlight(e,i)}};var vo=function(){};(q["gui.infoWindows.GDPRWindow"]=vo).__name__="gui.infoWindows.GDPRWindow",vo.createWindow=function(t,e){var i=new PIXI.Graphics;i.beginFill(2626656),i.drawRect(0,0,t.game.rect.width+10,t.game.rect.height+10),i.endFill(),t.stage.addChild(i),t.createWindow("gdpr_dialog",null,5),t instanceof os&&t.pauseForWindow();var n=t,r=e,s=function(){vo.createWindow(n,r)};t.setWindowReload(s);var o=t,a=e;s=function(){vo.createWindow(o,a)};t.addWindowToStack(s),t.windowReloadOnResize=!0,t.windowCapturesAllInput=!0,t.windowCanBeClosed=!1,t.windowOnDestroy=function(){null!=i&&(i.destroy(),i=null)};var l=t.game.rect.width-40,h=l<300?l:300;t.windowInner.addChild(new ao(t.windowInner,t.innerWindowStage,Tr.lo("gdpr_description_1"),null,null,null,h,!0)),t.windowAddInfoTextClickable(function(){window.open("https://florianvanstrien.nl/TheFinalEarth2/privacy.html","_blank")},"[blue]"+Tr.lo("more_info")),t.windowInner.addChild(new Ms(t.windowInner,new vr(2,10))),t.windowInner.addChild(new ao(t.windowInner,t.innerWindowStage,Tr.lo("gdpr_description_2"),null,null,null,h,!0)),e&&t.windowInner.addChild(new ao(t.windowInner,t.innerWindowStage,Tr.lo("changes_apply_on_reload"),null,null,null,h,!0));for(var u=t.windowAddBottomButtons([{text:Tr.lo("gdpr_option_reject"),action:function(){O.euAdConsentStatus=0,O.save(),pr.showEUConsent=0,pr.afterSettingConsent(),t.goPreviousWindow()},buttonTexture:"spr_button_gray"}],Tr.lo("gdpr_option_accept"),function(){O.euAdConsentStatus=1,pr.showEUConsent=0,O.save(),pr.afterSettingConsent(),t.goPreviousWindow()}),c=0;c<u.length;){var d=u[c];++c,d.extraWidth=(t.windowInner.rect.width/2|0)-d.rect.width,d.setText()}u[0].bitmapText.set_tint(4210752),u[1].buttonPatch.tint=8454016,u[1].buttonPatch.updateSprites()};var bo=function(){};(q["gui.infoWindows.InvitePeopleWindow"]=bo).__name__="gui.infoWindows.InvitePeopleWindow",bo.createWindow=function(o,t){null==t&&(t=!0);var e=1900;o.progress.story.storyInfo.isFreePlay&&(e=o.simulation.babyMaker.softPopLimit);function a(){return gr.isum(o.simulation.citizenSpawners,function(t){return t.spawn.amount})}function l(){return 5e3<o.simulation.citizens.length+a()?new L(0,0,10*(1+((o.simulation.citizens.length+a())/10|0)),0,0,10*(((o.simulation.citizens.length+a())/50|0)-8),50):500<o.simulation.citizens.length+a()?new L(0,0,10*(1+((o.simulation.citizens.length+a())/10|0)),0,0,10*(((o.simulation.citizens.length+a())/50|0)-8)):new L(0,0,10*Math.max(1,((o.simulation.citizens.length+a())/10|0)-5))}t&&o.gui.clearWindowStack(),o.gui.createWindow("invite_people");var i=o,n=t,r=function(){bo.createWindow(i,n)};o.gui.setWindowReload(r);var s=o,h=t;r=function(){bo.createWindow(s,h)};o.gui.addWindowToStack(r);var u=Tr.lo("invite_people");o.gui.windowAddTitleText(u);var c=" ",d=o.simulation.citizens.length+a()+10<e;if(o.gui.windowAddInfoText(null,function(){return d&&o.simulation.citizens.length+a()+10>=e?(o.gui.reloadWindow(),""):d?Tr.lo("invite_people_description",[10]):Tr.lo("invite_people_done")}),d){var p=new Hs(o,new L(0,0,10),"");p.displayCityAmounts=!0,o.game.isMobile&&(p.maxDisplayWidth=o.game.rect.width-10),o.gui.windowInner.addChild(new ds(o.gui.windowInner,o.gui.innerWindowStage,p,{left:0,right:0,top:0,bottom:2},function(){p.setCost(l())})),Io.create(o.gui,function(){var t=l();if(o.materials.canAfford(t))if(o.simulation.stats.houseCapacity>=o.simulation.citizens.length+a()+10){c=Tr.lo("invite_people_success",[10]),o.materials.remove(t),o.progress.story.justInvitedPeople=!0;var e=gr.min(o.worlds,function(t){return t.rect.y+1e-5*t.rect.x});if(o.progress.story.storyInfo.isFreePlay||"cityofthekey"!=o.progress.story.storyName){for(var i=new jo,n=0,r=o.simulation.citizens;n<r.length;){var s=r[n];++n,i.set(s.onWorld,!0)}null==(e=gr.whereMin(o.worlds,function(t){return null!=i.h.__keys__[t.__id__]},function(t){return t.rect.y+1e-5*t.rect.x}))&&(e=gr.min(o.worlds,function(t){return t.rect.y+1e-5*t.rect.x}))}o.simulation.citizenSpawners.push(new kl(o.simulation,o.farForegroundStage,e,{time:0,type:"SpawnCitizensFlyingSaucer",amount:10,ageRangeMin:18,ageRangeMax:22,world:o.worlds.indexOf(e)}))}else c=Tr.lo("invite_not_enough_houses");else c=Tr.lo("cant_afford")},o.gui.windowInner,function(){return Tr.lo("invite_people")},o.gui.innerWindowStage);var f=new Ms(o.gui.windowInner,new vr(2,4));o.gui.windowInner.addChild(f),o.gui.windowAddInfoText(null,function(){return c});f=new Ms(o.gui.windowInner,new vr(2,6));o.gui.windowInner.addChild(f)}o.gui.windowAddBottomButtons()};var wo=function(){};(q["gui.infoWindows.MaterialInfoWindow"]=wo).__name__="gui.infoWindows.MaterialInfoWindow",wo.create=function(t,e,i,n,r,s){wo.createWindow(t,e,i,n,r,s)},wo.createWindow=function(t,e,i,n,I,r){if(n.clear(),e.windowAddTitleText(r+"",null,dt.getTexture("spr_resource_"+I.toLowerCase())),"stone"==I){for(var s=[],o=0,a=t.connections.numberOfWorldGroups;o<a;){var l=o++;s.push(!1)}var h=s;for(s=[],o=0,a=t.connections.numberOfWorldGroups;o<a;){l=o++;s.push(!1)}var u=s;for(s=[],o=0,a=t.connections.numberOfWorldGroups;o<a;){l=o++;s.push(!1)}var c=s;for(s=0,o=t.simulation.citizens;s<o.length;){var d=o[s];++s,null!=d.onWorld&&(h[d.onWorld.worldGroup]=!0)}for(s=0,o=t.worlds;s<o.length;){var p=o[s];++s,gr.any(p.permanents,function(t){return gr.any(t,function(t){return null!=t&&t.is(on)})})&&(u[p.worldGroup]=!0),gr.any(p.permanents,function(t){return gr.any(t,function(t){return null!=t&&(!!t.is(Eh)||t.is(hn))})})&&(c[p.worldGroup]=!0)}var f=!0,g=!1;for(s=0,o=t.connections.numberOfWorldGroups;s<o;){h[l=s++]&&c[l]&&(f=!1),u[l]&&(g=!0)}f&&g&&0<t.simulation.citizens.length&&e.windowAddInfoText(Tr.lo("stone_warning"));var m=lt.count(t.permanents,function(t){return t.is(on)}),y=lt.count(t.permanents,function(t){return t.is(hn)});12<=y&&(m<=5||m/y<.3)&&e.windowAddInfoText(Tr.lo("mines_warning"))}function _(){P.clear(),P.beginFill(16711680,0),P.drawRect(0,0,1,1),P.endFill();var t=9,e=ct.findMaterialIndex(I),i=E.materialProduction[e],n=E.materialUsed[e],r=!1;t=Math.max(t,i[0]),t=Math.max(t,n[0]),0<n[0]&&(r=!0),t=Math.max(t,i[1]),t=Math.max(t,n[1]),0<n[1]&&(r=!0),t=Math.max(t,i[2]),t=Math.max(t,n[2]),0<n[2]&&(r=!0),t=Math.max(t,i[3]),t=Math.max(t,n[3]),0<n[3]&&(r=!0),t=Math.max(t,i[4]),t=Math.max(t,n[4]),0<n[4]&&(r=!0),t=Math.max(t,i[5]),t=Math.max(t,n[5]),0<n[5]&&(r=!0),t=Math.max(t,i[6]),t=Math.max(t,n[6]),0<n[6]&&(r=!0);var s=Math.floor(Math.log(t)/Math.log(10)),o=Math.floor(Math.pow(10,s));(Math.ceil(t)/o|0)<2?o=o/5|0:(Math.ceil(t)/o|0)<4&&(o=o/2|0);for(var a=Math.floor(t/o)*o+o,l=100/a,h=1+(a/o|0),u=179,c=0,d=7;c<d;){var p=l*i[m=c++],f=l*n[m];r?(P.beginFill(16711680),P.drawRect(u,105-f,9,f),P.endFill(),u-=9,P.beginFill(255),P.drawRect(u,105-p,9,p)):(u-=9,P.beginFill(255),P.drawRect(u,105-p,18,p)),P.endFill(),u-=13}var g=u+9+4-2;P.beginFill(0,1),P.drawRect(g-1,0,1,105),P.drawRect(g-1,105,188-g+3,1);for(var m=C.children.length-1;0<=m;)C.children[m].destroy(),--m;var y=Math.floor(a/(h-1));for(c=0,d=h;c<d;){m=c++;(b=new Ur(""+Pr.largeNumberFormatAlt(Math,y*m),{font:"Arial10",tint:0})).get_anchor().set(1,.5);var _=105-l*y*m;b.position.set(g-5,_),P.drawRect(g-3,_,2,1),C.addChild(b)}u=188;var v=0;for(c=0,d=7;c<d;){var b,w="";switch(m=c++){case 0:w=Tr.lo("today");break;case 1:w=Tr.lo("yesterday");break;default:w=Tr.lo("n_days_ago",[m])}(b=new Ur(w,{font:"Arial10",tint:0})).get_anchor().set(0,.5),b.rotation=Math.PI/2,b.position.set(u-9,109),C.addChild(b),u-=22;var S=Math.ceil(b.position.y+b.get_textWidth());v<S&&(v=S)}function x(t,e){var i=new Ur(t,{font:"Arial10",tint:0});188<u+13+Math.ceil(i.width)&&(u=0,T+=13),P.beginFill(e,1),P.drawRect(u,T,10,10),u+=13,i.position.set(u,T),u+=Math.ceil(i.width)+3,C.addChild(i),P.endFill()}P.endFill();var T=v+5;u=0,x(Tr.lo("production"),255),r&&(T+=13,u=0,x(Tr.lo("usage"),16711680)),null!=A&&A.updateSize()}var v=new PIXI.Container,P=new PIXI.Graphics,C=new PIXI.Container,E=t.simulation.stats,A=null;_(),v.addChild(P),v.addChild(C),A=new ds(n,i,v,{left:0,right:0,top:0,bottom:3},_,function(t){return!1}),n.addChild(A);new Ur("0-10",{font:"Arial10",tint:0}),new Ur("10-20",{font:"Arial10",tint:0}),new Ur("20-30",{font:"Arial10",tint:0}),new Ur("30-40",{font:"Arial10",tint:0}),new Ur("40-50",{font:"Arial10",tint:0}),new Ur("50-60",{font:"Arial10",tint:0}),new Ur("60-70",{font:"Arial10",tint:0});n.onDestroy=function(){P.destroy()},"food"==I&&e.windowInner.addChild(new ao(e.windowInner,e.innerWindowStage,"",function(){return t.simulation.eating.getFoodText()},"Arial",null,178,!0)),e.windowAddBottomButtons()};var So=function(){};(q["gui.infoWindows.StoreInfo"]=So).__name__="gui.infoWindows.StoreInfo",So.createWindow=function(t){window.CordovaStore||(window.CordovaStore={},window.CordovaStore.isAvailable=function(){return!1});var e=new PIXI.Graphics;e.beginFill(2626656),e.drawRect(0,0,t.game.rect.width+10,t.game.rect.height+10),e.endFill(),t.stage.addChild(e),t.createWindow("get_premium"),t instanceof os&&t.pauseForWindow();var i=t;t.setWindowReload(function(){So.createWindow(i)});var n=t;t.addWindowToStack(function(){So.createWindow(n)}),t.windowReloadOnResize=!0,t.windowCapturesAllInput=!0,t.windowOnDestroy=function(){null!=e&&(e.destroy(),e=null)},t.windowAddTitleText(Tr.lo("store"));t.windowInner.addChild(new Ms(t.windowInner,new vr(250,1))),t.windowInner.addChild(new ao(t.windowInner,t.innerWindowStage,Tr.lo("store_description"),null,null,null,250,!0)),t.windowInner.addChild(new Ms(t.windowInner,new vr(2,2))),CordovaStore.isAvailable()?B.hasPremium()?t.windowInner.addChild(new ao(t.windowInner,t.innerWindowStage,Tr.lo("already_has_premium"),null,null,null,250,!0)):ra.hasSpecific("remove_ads")&&!B.hasPremium()?(So.createVersionUpgradeButton(t,t.windowInner,"premium_upgrade",Tr.lo("premium_upgrade"),[Tr.lo("premium_advantage_6"),Tr.lo("premium_advantage_1"),Tr.lo("premium_advantage_7"),Tr.lo("premium_advantage_2"),Tr.lo("premium_advantage_3"),Tr.lo("premium_advantage_5")]),t.windowInner.addChild(new Ms(t.windowInner,new vr(2,6))),t.windowInner.addChild(new ao(t.windowInner,t.innerWindowStage,Tr.lo("removed_ads_already"),null,null,null,250,!0))):(So.createVersionUpgradeButton(t,t.windowInner,"premium",Tr.lo("get_premium_edition"),[Tr.lo("premium_advantage_6"),Tr.lo("premium_advantage_1"),Tr.lo("premium_advantage_7"),Tr.lo("premium_advantage_3"),Tr.lo("premium_advantage_2"),Tr.lo("premium_advantage_4"),Tr.lo("premium_advantage_5")]),t.windowInner.addChild(new Ms(t.windowInner,new vr(2,6))),So.createVersionUpgradeButton(t,t.windowInner,"remove_ads",Tr.lo("remove_ads"),[Tr.lo("remove_ads_1"),Tr.lo("remove_ads_2")]),t.windowInner.addChild(new Ms(t.windowInner,new vr(2,6)))):t.windowInner.addChild(new ao(t.windowInner,t.innerWindowStage,Tr.lo("store_not_available"),null,null,null,250,!0)),t.windowAddBottomButtons()},So.createVersionUpgradeButton=function(n,t,r,e,i){function s(){if(!CordovaStore.isAvailable())return!1;var t=CordovaStore.getProductInfo(r);return null!=t&&t.owned}var o=new us(n,n.innerWindowStage,t,function(){if(!s()){var t;t=function(){n.showSimpleWindow(Tr.lo("purchase_failed"),null,!0)};var e;if(e=function(){n.showSimpleWindow(Tr.lo("purchase_processing"),null,!0)},CordovaStore.isAvailable()){var i=CordovaStore.getProductInfo(r);null!=i&&i.canPurchase?CordovaStore.purchase(r):null==i||!i.deferred&&"initiated"!=i.state?(t(),n.addWindowToStack(t)):e()}else t(),n.addWindowToStack(t)}},s),a=o.container;a.padding.top=3,a.padding.left=3,a.padding.right=3,a.padding.bottom=1,a.fillSecondarySize=!0,a.direction=Ps.Vertical,t.addChild(o);var l=new ps(n,n.innerWindowStage,a);l.fillSecondarySize=!0,l.addChild(new ao(l,n.innerWindowStage,e,null,"Arial16")),l.addChild(new As(l)),l.addChild(new lo(l,n.innerWindowStage,null,function(){if(!CordovaStore.isAvailable())return Tr.lo("n/a");var t=CordovaStore.getProductInfo(r);return null==t?"":t.owned?Tr.lo("purchased"):t.deferred?"...":"initiated"==t.state?"...":t.valid?t.price:""},"Arial",{top:-2,bottom:0,right:0,left:0},200,null,14)),a.addChild(l),a.addChild(new ao(a,n.innerWindowStage,"- "+i.join("\n- ")))};var xo=function(){};(q["gui.windowParts.CreateBuildingTransformButton"]=xo).__name__="gui.windowParts.CreateBuildingTransformButton",xo.create=function(e,i,n,t,r,s){var o=e.gui,a=new L(20,0,20,0,20),l=po.createActivatableButton(o,!1,function(){if(e.materials.canAfford(a)){e.materials.remove(a),i.destroyForReplacement();var t=i.world.build(n,i.worldPosition.x,i.worldPosition.y);e.onBuildBuilding(!1,!0,t,n,i.worldPosition.y,i.world.permanents[i.worldPosition.x]),o.closeWindow(),t.showWindow(),null!=s&&s()}},t,r,e.gui.windowInner).container,h=new ps(o,o.innerWindowStage,l),u=new Hs(e,a,"");h.addChild(new ds(h,o.innerWindowStage,u,{left:0,right:0,top:0,bottom:2},Uh(u,u.updateCostDisplay))),u.setCost(a),l.addChild(h)};var To=function(){};(q["gui.windowParts.CycleValueButton"]=To).__name__="gui.windowParts.CycleValueButton",To.create=function(t,e,i,n,r,s,o){null==o&&(o=1),null==r&&(r=""),null==s&&(s=function(){return r});var a=Io.create(t,function(){var t=e();(t+=o)>=n()?i(t%o):i(t)},t.windowInner,s,t.innerWindowStage);return t.windowInner.addChild(new Ms(t.windowInner,new vr(2,4))),a};var Io=function(){};(q["gui.windowParts.FullSizeTextButton"]=Io).__name__="gui.windowParts.FullSizeTextButton",Io.create=function(t,e,i,n,r){var s=new us(t,r,i,e),o=s.container;i.addChild(s),o.padding.top=3,o.padding.left=3,o.padding.right=3,o.padding.bottom=0,o.fillSecondarySize=!0,o.direction=Ps.Vertical;var a=new ps(t,r,o);return a.alignment=Cs.Center,o.addChild(a),a.addChild(new ao(a,r,null,function(){return n()})),s.buttonPatch.updateSprites(!0),s};function Po(){}(q["haxe.IMap"]=Po).__name__="haxe.IMap",Po.__isInterface__=!0;var Co=function(t,e,i){Error.call(this,t),this.message=t,this.__previousException=e,this.__nativeException=null!=i?i:this};(q["haxe.Exception"]=Co).__name__="haxe.Exception",Co.caught=function(t){return t instanceof Co?t:t instanceof Error?new Co(t.message,null,t):new ko(t,null,t)},Co.thrown=function(t){return t instanceof Co?t.get_native():t instanceof Error?t:new ko(t)},Co.__super__=Error,Co.prototype=e(Error.prototype,{get_native:function(){return this.__nativeException},__class__:Co});var Eo={ucompare:function(t,e){return t<0?e<0?~e-~t|0:1:e<0?-1:t-e|0}},Ao={divMod:function(t,e){if(0==e.high)switch(e.low){case 0:throw Co.thrown("divide by zero");case 1:return{quotient:new Mo(t.high,t.low),modulus:new Mo(0,0)}}var i,n=t.high<0!=e.high<0;if(t.high<0){var r=~t.high;if(0==(c=1+~t.low|0)){r++;r|=0}i=new Mo(r,c)}else{i=new Mo(t.high,t.low)}if(e.high<0){r=~e.high;if(0==(c=1+~e.low|0)){r++;r|=0}e=new Mo(r,c)}for(var s=new Mo(0,0),o=new Mo(0,1);!(e.high<0);){var a=0!=(u=Eo.ucompare(e.high,i.high))?u:Eo.ucompare(e.low,i.low),l=1;if(0==(l&=63))e=new Mo(e.high,e.low);else if(l<32){e=new Mo(e.high<<l|e.low>>>32-l,e.low<<l)}else{e=new Mo(e.low<<l-32,0)}var h=1;if(0==(h&=63))o=new Mo(o.high,o.low);else if(h<32){o=new Mo(o.high<<h|o.low>>>32-h,o.low<<h)}else{o=new Mo(o.low<<h-32,0)}if(0<=a)break}for(;;){var u;if(0==o.high&&0==o.low)break;if(0<=(0!=(u=Eo.ucompare(i.high,e.high))?u:Eo.ucompare(i.low,e.low))){s=new Mo(s.high|o.high,s.low|o.low);r=i.high-e.high|0;var c=i.low-e.low|0;if(Eo.ucompare(i.low,e.low)<0){r--;r|=0}i=new Mo(r,c)}l=1;if(0==(l&=63))o=new Mo(o.high,o.low);else if(l<32){o=new Mo(o.high>>>l,o.high<<32-l|o.low>>>l)}else{o=new Mo(0,o.high>>>l-32)}h=1;if(0==(h&=63))e=new Mo(e.high,e.low);else if(h<32){e=new Mo(e.high>>>h,e.high<<32-h|e.low>>>h)}else{e=new Mo(0,e.high>>>h-32)}}if(n){r=~s.high;if(0==(c=1+~s.low|0)){r++;r|=0}s=new Mo(r,c)}if(t.high<0){r=~i.high;if(0==(c=1+~i.low|0)){r++;r|=0}i=new Mo(r,c)}return{quotient:s,modulus:i}}},Mo=function(t,e){this.high=t,this.low=e};(q["haxe._Int64.___Int64"]=Mo).__name__="haxe._Int64.___Int64",Mo.prototype={__class__:Mo};var Bo=function(){this.buf=new I,this.cache=[],this.useCache=Bo.USE_CACHE,this.useEnumIndex=Bo.USE_ENUM_INDEX,this.shash=new Vo,this.scount=0};(q["haxe.Serializer"]=Bo).__name__="haxe.Serializer",Bo.run=function(t){var e=new Bo;return e.serialize(t),e.toString()},Bo.prototype={toString:function(){return this.buf.b},serializeString:function(t){var e=this.shash.h[t];if(null!=e)return this.buf.b+="R",void(this.buf.b+=null==e?"null":""+e);this.shash.h[t]=this.scount++,this.buf.b+="y",t=encodeURIComponent(t),this.buf.b+=Y.string(t.length),this.buf.b+=":",this.buf.b+=null==t?"null":""+t},serializeRef:function(t){for(var e=typeof t,i=0,n=this.cache.length;i<n;){var r=i++,s=this.cache[r];if(typeof s==e&&s==t)return this.buf.b+="r",this.buf.b+=null==r?"null":""+r,!0}return this.cache.push(t),!1},serializeFields:function(t){for(var e=0,i=F.fields(t);e<i.length;){var n=i[e];++e,this.serializeString(n),this.serialize(F.field(t,n))}this.buf.b+="g"},serialize:function(t){switch((S=k.typeof(t))._hx_index){case 0:this.buf.b+="n";break;case 1:if(0==(e=t))return void(this.buf.b+="z");this.buf.b+="i",this.buf.b+=null==e?"null":""+e;break;case 2:var e=t;isNaN(e)?this.buf.b+="k":isFinite(e)?(this.buf.b+="d",this.buf.b+=null==e?"null":""+e):this.buf.b+=e<0?"m":"p";break;case 3:this.buf.b+=t?"t":"f";break;case 4:if(Ko.__instanceof(t,jh)){var i=t.__name__;this.buf.b+="A",this.serializeString(i)}else if(Ko.__instanceof(t,Vh))this.buf.b+="B",this.serializeString(t.__ename__);else{if(this.useCache&&this.serializeRef(t))return;this.buf.b+="o",this.serializeFields(t)}break;case 5:throw Co.thrown("Cannot serialize function");case 6:var n=S.c;if(n==String)return void this.serializeString(t);if(this.useCache&&this.serializeRef(t))return;switch(n){case Array:var r=0;this.buf.b+="a";for(var s=0,o=t.length;s<o;){null==t[d=s++]?++r:(0<r&&(1==r?this.buf.b+="n":(this.buf.b+="u",this.buf.b+=null==r?"null":""+r),r=0),this.serialize(t[d]))}0<r&&(1==r?this.buf.b+="n":(this.buf.b+="u",this.buf.b+=null==r?"null":""+r)),this.buf.b+="h";break;case Date:var a=t;this.buf.b+="v",this.buf.b+=Y.string(a.getTime());break;case Wo:this.buf.b+="q";for(var l=(e=t).keys();l.hasNext();){var h=l.next();this.buf.b+=":",this.buf.b+=null==h?"null":""+h,this.serialize(e.h[h])}this.buf.b+="h";break;case Go:this.buf.b+="l";for(var u=(e=t).h;null!=u;){var c=u.item;u=u.next;var d=c;this.serialize(d)}this.buf.b+="h";break;case jo:this.buf.b+="M";for(l=(e=t).keys();l.hasNext();){h=l.next();var p=F.field(h,"__id__");F.deleteField(h,"__id__"),this.serialize(h),h.__id__=p,this.serialize(e.h[h.__id__])}this.buf.b+="h";break;case Vo:this.buf.b+="b";for(e=t,l=Vo.keysIterator(e.h);l.hasNext();){h=l.next();this.serializeString(h),this.serialize(e.h[h])}this.buf.b+="h";break;case Do:e=t;this.buf.b+="s",this.buf.b+=Y.string(Math.ceil(8*e.length/6)),this.buf.b+=":";d=0;var f=e.length-2,g=Bo.BASE64_CODES;if(null==g){g=new Array(Bo.BASE64.length);for(s=0,o=Bo.BASE64.length;s<o;){var m=s++;g[m]=at.cca(Bo.BASE64,m)}Bo.BASE64_CODES=g}for(;d<f;){var y=e.b[d++],_=e.b[d++],v=e.b[d++];this.buf.b+=String.fromCodePoint(g[y>>2]),this.buf.b+=String.fromCodePoint(g[63&(y<<4|_>>4)]),this.buf.b+=String.fromCodePoint(g[63&(_<<2|v>>6)]),this.buf.b+=String.fromCodePoint(g[63&v])}if(d==f){y=e.b[d++],_=e.b[d++];this.buf.b+=String.fromCodePoint(g[y>>2]),this.buf.b+=String.fromCodePoint(g[63&(y<<4|_>>4)]),this.buf.b+=String.fromCodePoint(g[_<<2&63])}else if(d==1+f){y=e.b[d++];this.buf.b+=String.fromCodePoint(g[y>>2]),this.buf.b+=String.fromCodePoint(g[y<<4&63])}break;default:this.useCache&&this.cache.pop(),null!=t.hxSerialize?(this.buf.b+="C",this.serializeString(n.__name__),this.useCache&&this.cache.push(t),t.hxSerialize(this),this.buf.b+="g"):(this.buf.b+="c",this.serializeString(n.__name__),this.useCache&&this.cache.push(t),this.serializeFields(t))}break;case 7:var b=S.e;if(this.useCache){if(this.serializeRef(t))return;this.cache.pop()}if(this.buf.b+=Y.string(this.useEnumIndex?"j":"w"),this.serializeString(b.__ename__),this.useEnumIndex)this.buf.b+=":",this.buf.b+=Y.string(t._hx_index);else{b=t;this.serializeString(T[b.__enum__].__constructs__[b._hx_index])}this.buf.b+=":";var w=k.enumParameters(t);this.buf.b+=Y.string(w.length);for(var S=0;S<w.length;){var x=w[S];++S,this.serialize(x)}this.useCache&&this.cache.push(t);break;default:throw Co.thrown("Cannot serialize "+Y.string(t))}},__class__:Bo};function Ro(){}(q["haxe._Unserializer.DefaultResolver"]=Ro).__name__="haxe._Unserializer.DefaultResolver",Ro.prototype={resolveClass:function(t){return q[t]},resolveEnum:function(t){return T[t]},__class__:Ro};var Oo=function(t){this.buf=t,this.length=t.length,this.pos=0,this.scache=[],this.cache=[];var e=Oo.DEFAULT_RESOLVER;null==e&&(e=new Ro,Oo.DEFAULT_RESOLVER=e),this.resolver=e};(q["haxe.Unserializer"]=Oo).__name__="haxe.Unserializer",Oo.initCodes=function(){for(var t=[],e=0,i=Oo.BASE64.length;e<i;){var n=e++;t[Oo.BASE64.charCodeAt(n)]=n}return t},Oo.run=function(t){return new Oo(t).unserialize()},Oo.prototype={readDigits:function(){for(var t=0,e=!1,i=this.pos;;){var n=this.buf.charCodeAt(this.pos);if(n!=n)break;if(45!=n){if(n<48||57<n)break;t=10*t+(n-48),this.pos++}else{if(this.pos!=i)break;e=!0,this.pos++}}return e&&(t*=-1),t},readFloat:function(){for(var t=this.pos;;){var e=this.buf.charCodeAt(this.pos);if(e!=e)break;if(!(43<=e&&e<58||101==e||69==e))break;this.pos++}return parseFloat(at.substr(this.buf,t,this.pos-t))},unserializeObject:function(t){for(;;){if(this.pos>=this.length)throw Co.thrown("Invalid object");if(103==this.buf.charCodeAt(this.pos))break;var e=this.unserialize();if("string"!=typeof e)throw Co.thrown("Invalid object key");var i=this.unserialize();t[e]=i}this.pos++},unserializeEnum:function(t,e){if(58!=this.buf.charCodeAt(this.pos++))throw Co.thrown("Invalid enum format");var i=this.readDigits();if(0==i)return k.createEnum(t,e);for(var n=[];0<i--;)n.push(this.unserialize());return k.createEnum(t,e,n)},unserialize:function(){switch(this.buf.charCodeAt(this.pos++)){case 65:var t=this.unserialize();if(null==(l=this.resolver.resolveClass(t)))throw Co.thrown("Class not found "+t);return l;case 66:t=this.unserialize();if(null==(c=this.resolver.resolveEnum(t)))throw Co.thrown("Enum not found "+t);return c;case 67:t=this.unserialize();if(null==(l=this.resolver.resolveClass(t)))throw Co.thrown("Class not found "+t);var e=Object.create(l.prototype);if(this.cache.push(e),e.hxUnserialize(this),103!=this.buf.charCodeAt(this.pos++))throw Co.thrown("Invalid custom data");return e;case 77:var i=new jo;this.cache.push(i);for(var n=this.buf;104!=this.buf.charCodeAt(this.pos);){var r=this.unserialize();i.set(r,this.unserialize())}return this.pos++,i;case 82:if((o=this.readDigits())<0||o>=this.scache.length)throw Co.thrown("Invalid string reference");return this.scache[o];case 97:n=this.buf;var s=[];for(this.cache.push(s);;){if(104==(p=this.buf.charCodeAt(this.pos))){this.pos++;break}if(117==p){this.pos++;var o=this.readDigits();s[s.length+o-1]=null}else s.push(this.unserialize())}return s;case 98:i=new Vo;this.cache.push(i);for(n=this.buf;104!=this.buf.charCodeAt(this.pos);){r=this.unserialize();var a=this.unserialize();i.h[r]=a}return this.pos++,i;case 99:var l;t=this.unserialize();if(null==(l=this.resolver.resolveClass(t)))throw Co.thrown("Class not found "+t);e=Object.create(l.prototype);return this.cache.push(e),this.unserializeObject(e),e;case 100:return this.readFloat();case 102:return!1;case 105:return this.readDigits();case 106:t=this.unserialize();if(null==(P=this.resolver.resolveEnum(t)))throw Co.thrown("Enum not found "+t);this.pos++;var h=this.readDigits(),u=P.__constructs__.slice()[h];if(null==u)throw Co.thrown("Unknown enum index "+t+"@"+h);var c=this.unserializeEnum(P,u);return this.cache.push(c),c;case 107:return NaN;case 108:var d=new Go;this.cache.push(d);for(n=this.buf;104!=this.buf.charCodeAt(this.pos);)d.add(this.unserialize());return this.pos++,d;case 109:return-1/0;case 110:return null;case 111:e={};return this.cache.push(e),this.unserializeObject(e),e;case 112:return 1/0;case 113:i=new Wo;this.cache.push(i);n=this.buf;for(var p=this.buf.charCodeAt(this.pos++);58==p;){var f=this.readDigits();a=this.unserialize();i.h[f]=a,p=this.buf.charCodeAt(this.pos++)}if(104!=p)throw Co.thrown("Invalid IntMap format");return i;case 114:if((o=this.readDigits())<0||o>=this.cache.length)throw Co.thrown("Invalid reference");return this.cache[o];case 115:var g=this.readDigits();n=this.buf;if(58!=this.buf.charCodeAt(this.pos++)||this.length-this.pos<g)throw Co.thrown("Invalid bytes length");var m=Oo.CODES;null==m&&(m=Oo.initCodes(),Oo.CODES=m);for(var y=3&g,_=(f=this.pos)+(g-y),v=new Do(new ArrayBuffer(3*(g>>2)+(2<=y?y-1:0))),b=0;f<_;){var w=m[n.charCodeAt(f++)],S=m[n.charCodeAt(f++)];v.b[b++]=w<<2|S>>4;var x=m[n.charCodeAt(f++)];v.b[b++]=S<<4|x>>2;var T=m[n.charCodeAt(f++)];v.b[b++]=x<<6|T}if(2<=y){w=m[n.charCodeAt(f++)],S=m[n.charCodeAt(f++)];if(v.b[b++]=w<<2|S>>4,3==y){x=m[n.charCodeAt(f++)];v.b[b++]=S<<4|x>>2}}return this.pos+=g,this.cache.push(v),v;case 116:return!0;case 118:var I;return 48<=this.buf.charCodeAt(this.pos)&&this.buf.charCodeAt(this.pos)<=57&&48<=this.buf.charCodeAt(this.pos+1)&&this.buf.charCodeAt(this.pos+1)<=57&&48<=this.buf.charCodeAt(this.pos+2)&&this.buf.charCodeAt(this.pos+2)<=57&&48<=this.buf.charCodeAt(this.pos+3)&&this.buf.charCodeAt(this.pos+3)<=57&&45==this.buf.charCodeAt(this.pos+4)?(I=at.strDate(at.substr(this.buf,this.pos,19)),this.pos+=19):I=new Date(this.readFloat()),this.cache.push(I),I;case 119:var P;t=this.unserialize();if(null==(P=this.resolver.resolveEnum(t)))throw Co.thrown("Enum not found "+t);c=this.unserializeEnum(P,this.unserialize());return this.cache.push(c),c;case 120:throw Co.thrown(this.unserialize());case 121:g=this.readDigits();if(58!=this.buf.charCodeAt(this.pos++)||this.length-this.pos<g)throw Co.thrown("Invalid string length");r=at.substr(this.buf,this.pos,g);return this.pos+=g,r=decodeURIComponent(r.split("+").join(" ")),this.scache.push(r),r;case 122:return 0}throw this.pos--,Co.thrown("Invalid char "+this.buf.charAt(this.pos)+" at position "+this.pos)},__class__:Oo};var ko=function(t,e,i){Co.call(this,String(t),e,i),this.value=t};(q["haxe.ValueException"]=ko).__name__="haxe.ValueException",ko.__super__=Co,ko.prototype=e(Co.prototype,{__class__:ko});var Do=function(t){this.length=t.byteLength,this.b=new Uint8Array(t),(this.b.bufferValue=t).hxBytes=this,t.bytes=this.b};(q["haxe.io.Bytes"]=Do).__name__="haxe.io.Bytes",Do.ofString=function(t,e){if(e==Fo.RawNative){for(var i=new Uint8Array(t.length<<1),n=0,r=t.length;n<r;){var s=n++,o=t.charCodeAt(s);i[s<<1]=255&o,i[s<<1|1]=o>>8}return new Do(i.buffer)}var a=[];for(s=0;s<t.length;){55296<=(o=t.charCodeAt(s++))&&o<=56319&&(o=o-55232<<10|1023&t.charCodeAt(s++)),o<=127?a.push(o):(o<=2047?a.push(192|o>>6):(o<=65535?a.push(224|o>>12):(a.push(240|o>>18),a.push(128|o>>12&63)),a.push(128|o>>6&63)),a.push(128|63&o))}return new Do(new Uint8Array(a).buffer)},Do.ofData=function(t){var e=t.hxBytes;return null!=e?e:new Do(t)},Do.prototype={blit:function(t,e,i,n){if(t<0||i<0||n<0||t+n>this.length||i+n>e.length)throw Co.thrown(Yo.OutsideBounds);0==i&&n==e.b.byteLength?this.b.set(e.b,t):this.b.set(e.b.subarray(i,i+n),t)},getDouble:function(t){return null==this.data&&(this.data=new DataView(this.b.buffer,this.b.byteOffset,this.b.byteLength)),this.data.getFloat64(t,!0)},setDouble:function(t,e){null==this.data&&(this.data=new DataView(this.b.buffer,this.b.byteOffset,this.b.byteLength)),this.data.setFloat64(t,e,!0)},getInt32:function(t){return null==this.data&&(this.data=new DataView(this.b.buffer,this.b.byteOffset,this.b.byteLength)),this.data.getInt32(t,!0)},setInt32:function(t,e){null==this.data&&(this.data=new DataView(this.b.buffer,this.b.byteOffset,this.b.byteLength)),this.data.setInt32(t,e,!0)},getString:function(t,e,i){if(t<0||e<0||t+e>this.length)throw Co.thrown(Yo.OutsideBounds);null==i&&(i=Fo.UTF8);var n="",r=this.b,s=t,o=t+e;switch(i._hx_index){case 0:for(;s<o;){if((u=r[s++])<128){if(0==u)break;n+=String.fromCodePoint(u)}else if(u<224){var a=(63&u)<<6|127&r[s++];n+=String.fromCodePoint(a)}else if(u<240){var l=(31&u)<<12|(127&r[s++])<<6|127&r[s++];n+=String.fromCodePoint(l)}else{var h=(15&u)<<18|(127&r[s++])<<12|(127&r[s++])<<6|127&r[s++];n+=String.fromCodePoint(h)}}break;case 1:for(;s<o;){var u=r[s++]|r[s++]<<8;n+=String.fromCodePoint(u)}}return n},toString:function(){return this.getString(0,this.length)},__class__:Do};var Fo=T["haxe.io.Encoding"]={__ename__:"haxe.io.Encoding",__constructs__:["UTF8","RawNative"],UTF8:{_hx_index:0,__enum__:"haxe.io.Encoding",toString:i},RawNative:{_hx_index:1,__enum__:"haxe.io.Encoding",toString:i}},No=function(){};(q["haxe.crypto.Base64"]=No).__name__="haxe.crypto.Base64",No.encode=function(t,e){null==e&&(e=!0);var i=new Lo(No.BYTES).encodeBytes(t).toString();if(e)switch(t.length%3){case 1:i+="==";break;case 2:i+="="}return i},No.decode=function(t,e){if(null==e&&(e=!0),e)for(;61==at.cca(t,t.length-1);)t=at.substr(t,0,-1);return new Lo(No.BYTES).decodeBytes(Do.ofString(t))};var Lo=function(t){for(var e=t.length,i=1;1<<i<e;)++i;if(8<i||e!=1<<i)throw Co.thrown("BaseCode : base length must be a power of two.");this.base=t,this.nbits=i};(q["haxe.crypto.BaseCode"]=Lo).__name__="haxe.crypto.BaseCode",Lo.prototype={encodeBytes:function(t){for(var e=this.nbits,i=this.base,n=8*t.length/e|0,r=new Do(new ArrayBuffer(n+(8*t.length%e==0?0:1))),s=0,o=0,a=(1<<e)-1,l=0,h=0;h<n;){for(;o<e;)o+=8,s<<=8,s|=t.b[l++];o-=e,r.b[h++]=i.b[s>>o&a]}return 0<o&&(r.b[h++]=i.b[s<<e-o&a]),r},initTable:function(){for(var t=[],e=0;e<256;){t[n=e++]=-1}e=0;for(var i=this.base.length;e<i;){var n=e++;t[this.base.b[n]]=n}this.tbl=t},decodeBytes:function(t){var e=this.nbits;this.base;null==this.tbl&&this.initTable();for(var i=this.tbl,n=t.length*e>>3,r=new Do(new ArrayBuffer(n)),s=0,o=0,a=0,l=0;l<n;){for(;o<8;){o+=e,s<<=e;var h=i[t.b[a++]];if(-1==h)throw Co.thrown("BaseCode : invalid encoded char");s|=h}o-=8,r.b[l++]=s>>o&255}return r},__class__:Lo};function Uo(t,e){this.elt=t,this.next=e}(q["haxe.ds.GenericCell"]=Uo).__name__="haxe.ds.GenericCell",Uo.prototype={__class__:Uo};function zo(){}(q["haxe.ds.GenericStack"]=zo).__name__="haxe.ds.GenericStack",zo.prototype={__class__:zo};var Wo=function(){this.h={}};(q["haxe.ds.IntMap"]=Wo).__name__="haxe.ds.IntMap",Wo.__interfaces__=[Po],Wo.prototype={remove:function(t){return!!this.h.hasOwnProperty(t)&&(delete this.h[t],!0)},keys:function(){var t=[];for(var e in this.h)this.h.hasOwnProperty(e)&&t.push(0|e);return new qo(t)},iterator:function(){return{ref:this.h,it:this.keys(),hasNext:function(){return this.it.hasNext()},next:function(){var t=this.it.next();return this.ref[t]}}},__class__:Wo};var Go=function(){this.length=0};(q["haxe.ds.List"]=Go).__name__="haxe.ds.List",Go.prototype={add:function(t){var e=new Ho(t,null);null==this.h?this.h=e:this.q.next=e,this.q=e,this.length++},iterator:function(){return new Xo(this.h)},__class__:Go};var Ho=function(t,e){this.item=t,this.next=e};(q["haxe.ds._List.ListNode"]=Ho).__name__="haxe.ds._List.ListNode",Ho.prototype={__class__:Ho};var Xo=function(t){this.head=t};(q["haxe.ds._List.ListIterator"]=Xo).__name__="haxe.ds._List.ListIterator",Xo.prototype={hasNext:function(){return null!=this.head},next:function(){var t=this.head.item;return this.head=this.head.next,t},__class__:Xo};var jo=function(){this.h={__keys__:{}}};(q["haxe.ds.ObjectMap"]=jo).__name__="haxe.ds.ObjectMap",jo.__interfaces__=[Po],jo.prototype={set:function(t,e){var i=t.__id__;null==i&&(i=t.__id__=u.$haxeUID++),this.h[i]=e,this.h.__keys__[i]=t},remove:function(t){var e=t.__id__;return null!=this.h.__keys__[e]&&(delete this.h[e],delete this.h.__keys__[e],!0)},keys:function(){var t=[];for(var e in this.h.__keys__)this.h.hasOwnProperty(e)&&t.push(this.h.__keys__[e]);return new qo(t)},__class__:jo};var Vo=function(){this.h=Object.create(null)};(q["haxe.ds.StringMap"]=Vo).__name__="haxe.ds.StringMap",Vo.__interfaces__=[Po],Vo.keysIterator=function(t){var e=Object.keys(t),i=e.length,n=0;return{hasNext:function(){return n<i},next:function(){return e[(n+=1)-1]}}},Vo.valueIterator=function(t){var e=Object.keys(t),i=e.length,n=0;return{hasNext:function(){return n<i},next:function(){return t[e[(n+=1)-1]]}}},Vo.prototype={iterator:function(){return Vo.valueIterator(this.h)},__class__:Vo};var Yo=T["haxe.io.Error"]={__ename__:"haxe.io.Error",__constructs__:["Blocked","Overflow","OutsideBounds","Custom"],Blocked:{_hx_index:0,__enum__:"haxe.io.Error",toString:i},Overflow:{_hx_index:1,__enum__:"haxe.io.Error",toString:i},OutsideBounds:{_hx_index:2,__enum__:"haxe.io.Error",toString:i},Custom:(N=function(t){return{_hx_index:3,e:t,__enum__:"haxe.io.Error",toString:i}},N.__params__=["e"],N)},qo=function(t){this.current=0,this.array=t};(q["haxe.iterators.ArrayIterator"]=qo).__name__="haxe.iterators.ArrayIterator",qo.prototype={hasNext:function(){return this.current<this.array.length},next:function(){return this.array[this.current++]},__class__:qo};var Ko=function(){};(q["js.Boot"]=Ko).__name__="js.Boot",Ko.getClass=function(t){if(null==t)return null;if(t instanceof Array)return Array;var e=t.__class__;if(null!=e)return e;var i=Ko.__nativeClassName(t);return null!=i?Ko.__resolveNativeClass(i):null},Ko.__string_rec=function(r,s){if(null==r)return"null";if(5<=s.length)return"<...>";var t=typeof r;switch("function"==t&&(r.__name__||r.__ename__)&&(t="object"),t){case"function":return"<function>";case"object":if(r.__enum__){var e=T[r.__enum__],i=e.__constructs__[r._hx_index],o=e[i];return o.__params__?(s+="\t",i+"("+function(){for(var t=[],e=0,i=o.__params__;e<i.length;){var n=i[e];e+=1,t.push(Ko.__string_rec(r[n],s))}return t}().join(",")+")"):i}if(r instanceof Array){var n="[";s+="\t";for(var a=0,l=r.length;a<l;){var h=a++;n+=(0<h?",":"")+Ko.__string_rec(r[h],s)}return n+="]"}var u;try{u=r.toString}catch(a){return"???"}if(null!=u&&u!=Object.toString&&"function"==typeof u){var c=r.toString();if("[object Object]"!=c)return c}n="{\n";s+="\t";var d=null!=r.hasOwnProperty,p=null;for(p in r)d&&!r.hasOwnProperty(p)||"prototype"!=p&&"__class__"!=p&&"__super__"!=p&&"__interfaces__"!=p&&"__properties__"!=p&&(2!=n.length&&(n+=", \n"),n+=s+p+" : "+Ko.__string_rec(r[p],s));return n+="\n"+(s=s.substring(1))+"}";case"string":return r;default:return String(r)}},Ko.__interfLoop=function(t,e){if(null==t)return!1;if(t==e)return!0;var i=t.__interfaces__;if(null!=i)for(var n=0,r=i.length;n<r;){var s=i[n++];if(s==e||Ko.__interfLoop(s,e))return!0}return Ko.__interfLoop(t.__super__,e)},Ko.__instanceof=function(t,e){if(null==e)return!1;switch(e){case Array:return t instanceof Array;case Xh:return"boolean"==typeof t;case Gh:return null!=t;case Hh:return"number"==typeof t;case Wh:return"number"==typeof t&&(0|t)===t;case String:return"string"==typeof t;default:if(null==t)return!1;if("function"==typeof e){if(Ko.__downcastCheck(t,e))return!0}else if("object"==typeof e&&Ko.__isNativeObj(e)&&t instanceof e)return!0;return e==jh&&null!=t.__name__||(e==Vh&&null!=t.__ename__||null!=t.__enum__&&T[t.__enum__]==e)}},Ko.__downcastCheck=function(t,e){return t instanceof e||!!e.__isInterface__&&Ko.__interfLoop(Ko.getClass(t),e)},Ko.__implements=function(t,e){return Ko.__interfLoop(Ko.getClass(t),e)},Ko.__nativeClassName=function(t){var e=Ko.__toStr.call(t).slice(8,-1);return"Object"==e||"Function"==e||"Math"==e||"JSON"==e?null:e},Ko.__isNativeObj=function(t){return null!=Ko.__nativeClassName(t)},Ko.__resolveNativeClass=function(t){return u[t]};var $o=function(t,e){this.city=t,this.rect=e,this.ancestors=[];for(var i=Ko.getClass(this);i!=$o;)this.ancestors.push(i),i=i.__super__};(q["miscCityElements.MiscCityElement"]=$o).__name__="miscCityElements.MiscCityElement",$o.__interfaces__=[n],$o.prototype={onCityChange:function(){},onCityChangeStage2:function(){},postCreate:function(){},update:function(t){},save:function(t){},onClick:function(){},onHover:function(t){},is:function(t){for(var e=0,i=this.ancestors;e<i.length;){var n=i[e];if(++e,t==n)return!0}return!1},__class__:$o};var Qo=function(t,e,i){null==i&&(i=0),this.destroyed=!1;var n=this;$o.call(this,t,new yr(e.x,e.y,20,20)),this.position=e,this.sprites=[],this.backSprites=[],this.spriteIndex=i,this.bridgeTextures=dt.getTexturesBySizeInverse(this.get_texturesName(),20,20,2)[i],this.bridgeInfo=lt.find(dt.bridgesInfo,function(t){var e=Ko.getClass(n);return"miscCityElements."+t.className==e.__name__})};(q["miscCityElements.Bridge"]=Qo).__name__="miscCityElements.Bridge",Qo.instantiateFromSave=function(t,e){var i=e.bytes.getInt32(e.readStart);e.readStart+=4;var n=i;i=e.bytes.getInt32(e.readStart);e.readStart+=4;var r=i,s=0;if(47<=e.version){i=e.bytes.getInt32(e.readStart);e.readStart+=4,s=i}var o=new vr(n,r);return new Qo(t,o,s)},Qo.__super__=$o,Qo.prototype=e($o.prototype,{get_texturesName:function(){return"spr_bridge"},get_potentialTexturesName:function(){return"spr_bridge_potential"},get_humanCanWalkOn:function(){return!0},postCreate:function(){this.determinePlacement(!0)},save:function(t){var e=this.position.x;if(t.size+4>t.bytes.length){var i=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+4))),t.bytes.blit(0,i,0,t.size)}t.bytes.setInt32(t.size,e),t.size+=4;e=this.position.y;if(t.size+4>t.bytes.length){i=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+4))),t.bytes.blit(0,i,0,t.size)}t.bytes.setInt32(t.size,e),t.size+=4;e=this.spriteIndex;if(t.size+4>t.bytes.length){i=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+4))),t.bytes.blit(0,i,0,t.size)}t.bytes.setInt32(t.size,e),t.size+=4},determinePlacement:function(t){},onCityChange:function(){this.determinePlacement(!1)},resizeSpritesArray:function(t){for(;this.sprites.length<t;){var e=new PIXI.Sprite;this.sprites.push(e),this.city.cityMidStage.addChild(e);var i=new PIXI.Sprite;this.backSprites.push(i),this.city.cityBgStage.addChild(i)}for(;this.sprites.length>t;){this.sprites.pop().destroy(),this.backSprites.pop().destroy()}},updateSprite:function(){if(null!=this.leftBuilding&&null!=this.rightBuilding){var t=((this.rightBuilding.position.x-this.leftBuilding.position.x)/20|0)-1;this.resizeSpritesArray(t);for(var e=0,i=t;e<i;){var n=e++,r=this.backSprites[n];r.position.x=this.leftBuilding.position.x+20*(1+n),r.position.y=this.position.y,r.texture=this.bridgeTextures[4];var s=this.sprites[n];s.position.x=this.leftBuilding.position.x+20*(1+n),s.position.y=this.position.y,s.texture=this.bridgeTextures[(0==n?1:0)+(n==t-1?2:0)]}}else{this.resizeSpritesArray(1);var o=this.get_potentialTexturesName();this.sprites[0].texture=dt.getTexture(o),this.sprites[0].position.set(this.position.x,this.position.y);o=this.get_potentialTexturesName();this.backSprites[0].texture=dt.getTexture(o),this.backSprites[0].position.set(this.position.x,this.position.y)}},onClick:function(){this.city.game.keyboard.down[46]||this.city.buildingMode==ot.Destroy||this.city.buildingMode==ot.DestroyLeavingHole?this.city.progress.story.disableDestroy?this.city.gui.showSimpleWindow(Tr.lo("no_destroy_allowed"),null,!0):(this.city.gui.windowRelatedTo==this&&this.city.gui.closeWindow(),this.tryDestroy()&&this.city.game.audio.playSound(this.city.game.audio.buttonFailSound)):this.city.game.keyboard.down[16]||(this.createWindow(),this.city.game.audio.playSound(this.city.game.audio.buildingClickSound))},tryDestroy:function(){return this.destroy(),!0},destroy:function(){for(var t=0,e=this.city.simulation.citizens;t<e.length;){var i=e[t];++t,null!=this.rightBuilding&&(null!=i.inPermanent&&i.inPermanent.isBuilding?i.inPermanent:null)==this.rightBuilding&&i.relativeX<0&&(i.setRelativeX(0),i.actuallyUpdateDraw())}for(t=0,e=this.city.simulation.citizens;t<e.length;){i=e[t];++t,null!=this.leftBuilding&&(null!=i.inPermanent&&i.inPermanent.isBuilding?i.inPermanent:null)==this.leftBuilding&&18<i.relativeX&&(i.setRelativeX(18),i.actuallyUpdateDraw())}for(t=0,e=this.sprites;t<e.length;){var n=e[t];++t,n.destroy()}for(t=0,e=this.backSprites;t<e.length;){var r=e[t];++t,r.destroy()}null!=this.selectedSprite&&this.selectedSprite.destroy(),this.city.miscCityElements.destroyElement(this),this.destroyed=!0,this.city.connections.updateCityConnections(),this.city.simulation.updatePathfinder(!0),this.giveRecycleReward()},giveRecycleReward:function(){if(null!=this.bridgeInfo){var t=L.fromBridgeInfo(this.bridgeInfo);t.knowledge=0,t.multiply(this.city.upgrades.vars.recyclingAmount),this.city.materials.add(t)}},onHover:function(t){if((this.city.game.keyboard.down[46]||this.city.buildingMode==ot.Destroy||this.city.buildingMode==ot.DestroyLeavingHole)&&null==this.city.specialAction){var e=new PIXI.Sprite(dt.getTexture("spr_destroying"));e.position.set(this.rect.get_center().x-10,this.position.y),this.city.furtherForegroundTempStage.addChild(e),e.alpha=t?1:this.city.game.isMobile?0:.5}},createWindow:function(){var i=this;this.city.gui.createWindow(this),this.city.gui.setWindowReload(Uh(this,this.createWindow)),this.city.gui.windowAddTitleText(this.bridgeInfo.name),this.city.gui.windowAddInfoText(null,function(){return null==i.leftBuilding||null==i.rightBuilding?Tr.lo("bridge_is_potential"):""});var n=dt.getTexturesBySizeInverse(this.get_texturesName(),20,20,2);1<n.length&&To.create(this.city.gui,function(){return i.spriteIndex},function(t){i.spriteIndex=t;var e=i.spriteIndex;isNaN(e)&&(i.spriteIndex=0),i.bridgeTextures=n[i.spriteIndex],i.updateSprite(),i.onUpdateTexture()},function(){return n.length},Tr.lo("change_building_color"));var t=null,e=!1;t=this.city.gui.windowAddBottomButtons([{text:Tr.lo("destroy"),action:function(){e?(i.city.gui.closeWindow(),i.tryDestroy()):(t.setText(Tr.lo("really_destroy")),e=!0)}}])[0],this.selectedSprite=new Ys(dt.getTexture("spr_selectedbuilding"),10,this.rect.width+2,this.rect.height+2),this.selectedSprite.position.set(this.rect.x-1,this.position.y-1),this.city.farForegroundStage.addChild(this.selectedSprite),this.city.gui.windowOnDestroy=function(){i.selectedSprite.destroy(),i.selectedSprite=null},this.city.gui.clearWindowStack(),this.city.gui.addWindowToStack(function(){i.destroyed||i.createWindow()})},cycleSprite:function(){var t=dt.getTexturesBySizeInverse(this.get_texturesName(),20,20,2),e=this.spriteIndex+=1;(isNaN(e)||this.spriteIndex>=t.length)&&(this.spriteIndex=0),this.bridgeTextures=t[this.spriteIndex],this.updateSprite(),this.onUpdateTexture()},onUpdateTexture:function(){},__class__:Qo});function Jo(t,e,i){this.connectedRightTo=null,this.connectedLeftTo=null,Qo.call(this,t,e,i)}(q["miscCityElements.BotanicalBridge"]=Jo).__name__="miscCityElements.BotanicalBridge",Jo.instantiateFromSave=function(t,e){var i=e.bytes.getInt32(e.readStart);e.readStart+=4;var n=i;i=e.bytes.getInt32(e.readStart);e.readStart+=4;var r=i,s=0;if(47<=e.version){i=e.bytes.getInt32(e.readStart);e.readStart+=4,s=i}var o=new vr(n,r);return new Jo(t,o,s)},Jo.__super__=Qo,Jo.prototype=e(Qo.prototype,{get_texturesName:function(){return"spr_botanicalbridge"},get_potentialTexturesName:function(){return"spr_botanicalbridge_potential"},get_currentTextureName:function(){switch(this.spriteIndex){case 0:return"spr_botanicalgardens";case 1:return"spr_indoorpark";case 2:return"spr_indoorpark_alt1";default:return"spr_bloomrestaurant"}},postCreate:function(){Qo.prototype.postCreate.call(this),this.city.updateConnectedBuildingSprites=!0},onCityChange:function(){Qo.prototype.onCityChange.call(this)},onUpdateTexture:function(){this.city.updateConnectedBuildingSprites=!0,this.onCityChangeStage2()},onCityChangeStage2:function(){null!=this.leftBuilding&&null!=this.rightBuilding&&(null!=this.connectedLeftTo&&(this.getOtherAMDrawer(this.leftBuilding).bridgeRightMergeFlag=!0),null!=this.connectedRightTo&&(this.getOtherAMDrawer(this.rightBuilding).bridgeLeftMergeFlag=!0))},updateSprite:function(){null!=this.connectedLeftTo&&(this.getOtherAMDrawer(this.connectedLeftTo).bridgeRightMergeFlag=!1),null!=this.connectedRightTo&&(this.getOtherAMDrawer(this.connectedRightTo).bridgeLeftMergeFlag=!1),this.updateOwnSprite()},needsToChangeConnections:function(){var t=this.isConnectedBuilding(this.leftBuilding),e=this.isConnectedBuilding(this.rightBuilding);return null!=this.connectedLeftTo==t||null!=this.connectedRightTo==e},updateOwnSprite:function(){if(this.connectedLeftTo=null,(this.connectedRightTo=null)!=this.leftBuilding&&null!=this.rightBuilding){var t=((this.rightBuilding.position.x-this.leftBuilding.position.x)/20|0)-1;this.resizeSpritesArray(t);for(var e=0,i=t;e<i;){var n=e++,r=this.backSprites[n];r.position.x=this.leftBuilding.position.x+20*(1+n),r.position.y=this.position.y;var s=8;1==t?s=4:0==n?s=9:n==t-1&&(s=10),r.texture=this.bridgeTextures[s];var o=this.sprites[n];o.position.x=this.leftBuilding.position.x+20*(1+n),o.position.y=this.position.y;var a=0,l=this.isConnectedBuilding(this.leftBuilding),h=this.isConnectedBuilding(this.rightBuilding);1==t?o.texture=this.bridgeTextures[l&&h?7:l?12:h?11:3]:(0==n&&l?a=4:n==t-1&&h&&(a=4),o.texture=this.bridgeTextures[(0==n?1:0)+(n==t-1?2:0)+a]),l&&(this.connectedLeftTo=this.leftBuilding),h&&(this.connectedRightTo=this.rightBuilding)}}else{this.resizeSpritesArray(1);var u=this.get_potentialTexturesName();this.sprites[0].texture=dt.getTexture(u),this.sprites[0].position.set(this.position.x,this.position.y);u=this.get_potentialTexturesName();this.backSprites[0].texture=dt.getTexture(u),this.backSprites[0].position.set(this.position.x,this.position.y)}},isConnectedBuilding:function(t){if(null==t)return!1;var e=this.getOtherAMDrawer(t);return null!=e&&e.currentTextureName==this.get_currentTextureName()},getOtherAMDrawer:function(t){if(null==t)return null;var e=t.drawer;return e.canMergeH?e:null},destroy:function(){Qo.prototype.destroy.call(this),null!=this.connectedLeftTo&&(this.getOtherAMDrawer(this.connectedLeftTo).bridgeRightMergeFlag=!1),null!=this.connectedRightTo&&(this.getOtherAMDrawer(this.connectedRightTo).bridgeLeftMergeFlag=!1),this.city.updateConnectedBuildingSprites=!0},__class__:Jo});var Zo=function(t,e){this.destroyed=!1,$o.call(this,t,new yr(e.x,e.y,20,20))};(q["miscCityElements.FloatingPlatform"]=Zo).__name__="miscCityElements.FloatingPlatform",Zo.instantiateFromSave=function(t,e){var i=e.bytes.getInt32(e.readStart);e.readStart+=4;var n=i;i=e.bytes.getInt32(e.readStart);e.readStart+=4;var r=new vr(n,i);return new Zo(t,r)},Zo.__super__=$o,Zo.prototype=e($o.prototype,{save:function(t){var e=this.position.x;if(t.size+4>t.bytes.length){var i=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+4))),t.bytes.blit(0,i,0,t.size)}t.bytes.setInt32(t.size,e),t.size+=4;e=this.position.y;if(t.size+4>t.bytes.length){i=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+4))),t.bytes.blit(0,i,0,t.size)}t.bytes.setInt32(t.size,e),t.size+=4},postCreate:function(){this.updateSprites()},update:function(t){this.animSprite.texture=this.animSpriteTextures[Math.floor(this.city.simulation.time.timeSinceStart/1.5%this.animSpriteTextures.length)]},onCityChange:function(){this.updateSprites()},updateSprites:function(){var t=this.city.miscCityElements.collidesSpecific(new vr(this.position.x-20,this.position.y),Zo)?1:0,e=this.city.miscCityElements.collidesSpecific(new vr(this.position.x+20,this.position.y),Zo)?1:0;this.sprite.texture=this.topSpriteTextures[t+2*e]},destroy:function(){this.sprite.destroy(),null!=this.selectedSprite&&this.selectedSprite.destroy(),this.animSprite.destroy(),this.city.miscCityElements.destroyElement(this),this.destroyed=!0,this.city.connections.updateCityConnections(),this.city.simulation.updatePathfinder(!1),this.giveRecycleReward()},giveRecycleReward:function(){if(null!=U.floatingPlatformCost){var t=U.floatingPlatformCost.copy();t.knowledge=0,t.multiply(this.city.upgrades.vars.recyclingAmount),this.city.materials.add(t)}},tryDestroy:function(){return null==this.city.getPermanentAtPos(this.position.x,this.position.y-20)?(this.destroy(),!0):(this.city.gui.showSimpleWindow(Tr.lo("floating_platform_cannot_destroy"),null,!0),!1)},onHover:function(t){if((this.city.game.keyboard.down[46]||this.city.buildingMode==ot.Destroy||this.city.buildingMode==ot.DestroyLeavingHole)&&null==this.city.specialAction){var e=new PIXI.Sprite(dt.getTexture("spr_destroying"));e.position.set(this.position.x,this.position.y),this.city.furtherForegroundTempStage.addChild(e),e.alpha=t?1:this.city.game.isMobile?0:.5}},onClick:function(){this.city.game.keyboard.down[46]||this.city.buildingMode==ot.Destroy||this.city.buildingMode==ot.DestroyLeavingHole?this.city.progress.story.disableDestroy?this.city.gui.showSimpleWindow(Tr.lo("no_destroy_allowed"),null,!0):(this.city.gui.windowRelatedTo==this&&this.city.gui.closeWindow(),this.tryDestroy()&&this.city.game.audio.playSound(this.city.game.audio.buttonFailSound)):this.city.game.keyboard.down[16]||(this.createWindow(),this.city.game.audio.playSound(this.city.game.audio.buildingClickSound))},createWindow:function(){var t=this;this.city.gui.createWindow(this),this.city.gui.setWindowReload(Uh(this,this.createWindow)),this.city.gui.windowAddTitleText(Tr.lo("floating_platform"));var e=null,i=!1;e=this.city.gui.windowAddBottomButtons([{text:Tr.lo("destroy"),action:function(){i?(t.city.gui.closeWindow(),t.tryDestroy()):(e.setText(Tr.lo("really_destroy")),i=!0)}}])[0],this.selectedSprite=dt.makeSprite("spr_selectedbuilding"),this.selectedSprite.position.set(this.position.x-1,this.position.y-1),this.city.farForegroundStage.addChild(this.selectedSprite),this.city.gui.windowOnDestroy=function(){t.selectedSprite.destroy(),t.selectedSprite=null},this.city.gui.clearWindowStack(),this.city.gui.addWindowToStack(function(){t.destroyed||t.createWindow()})},__class__:Zo});var ta=function(t){this.city=t,this.allMiscElements=[],this.miscElementsByXPos=new Wo};(q["miscCityElements.MiscCityElements"]=ta).__name__="miscCityElements.MiscCityElements",ta.prototype={addElement:function(t){this.allMiscElements.push(t);for(var e=0,i=Math.floor(t.rect.width/20);e<i;){var n=e++,r=Math.floor(t.rect.x/20)+n;if(null==this.miscElementsByXPos.h[r]){this.miscElementsByXPos.h[r]=[]}this.miscElementsByXPos.h[r].push(t)}t.postCreate()},update:function(t){for(var e=0,i=this.allMiscElements;e<i.length;){var n=i[e];++e,n.update(t)}},onCityChange:function(){for(var t=0,e=this.allMiscElements;t<e.length;){var i=e[t];++t,i.onCityChange()}for(t=0,e=this.allMiscElements;t<e.length;){i=e[t];++t,i.onCityChangeStage2()}},destroyElement:function(t){for(var e=0,i=Math.floor(t.rect.width/20);e<i;){var n=e++,r=Math.floor(t.rect.x/20)+n;at.remove(this.miscElementsByXPos.h[r],t)}at.remove(this.allMiscElements,t)},handleMouse:function(e){var t=this.miscElementsByXPos,i=Math.floor(e.get_cityX()/20),n=t.h[i];if(null==n)return!1;var r=lt.find(n,function(t){return e.get_cityY()>=t.rect.y&&e.get_cityY()<t.rect.get_y2()});if(null==r)return!1;switch(e.claimMouse(r,null,!1)._hx_index){case 0:r.onHover(!0);break;case 1:r.onClick();break;case 2:r.onHover(!1)}return!0},isUnbuildable:function(t,e){var i=this.miscElementsByXPos.h[Math.floor(t.x/20)];if(null==i)return!1;for(var n=0;n<i.length;){var r=i[n];if(++n,t.y>=r.rect.y&&t.y<r.rect.get_y2()){if(!e)return!0;if(!r.is(Qo))return!0;if(r.rect.width<=20||t.x!=r.rect.x&&t.x!=r.rect.get_x2()-20)return!0}}return!1},collidesSpecific:function(e,i){var t=this.miscElementsByXPos.h[Math.floor(e.x/20)];return null!=t&&gr.any(t,function(t){return e.y>=t.rect.y&&e.y<t.rect.get_y2()&&Ko.__instanceof(t,i)})},findSpecific:function(e,i){var t=this.miscElementsByXPos.h[Math.floor(e.x/20)];return null==t?null:lt.find(t,function(t){return e.y>=t.rect.y&&e.y<t.rect.get_y2()&&Ko.__instanceof(t,i)})},save:function(t){var e=this.allMiscElements.length;if(t.size+4>t.bytes.length){var i=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+4))),t.bytes.blit(0,i,0,t.size)}t.bytes.setInt32(t.size,e),t.size+=4;for(var n=0,r=this.allMiscElements;n<r.length;){var s=r[n];++n;var o=Ko.getClass(s);t.addString(o.__name__),s.save(t)}},load:function(t){if(43<=t.version){var e=t.bytes.getInt32(t.readStart);t.readStart+=4;for(var i=0,n=e;i<n;){i++;var r=t.readString(),s=F.field(q[r],"instantiateFromSave").apply(this,[this.city,t]);this.addElement(s)}}},__class__:ta};function ea(t,e,i){Qo.call(this,t,e,i)}(q["miscCityElements.RailwayBridge"]=ea).__name__="miscCityElements.RailwayBridge",ea.__super__=Qo,ea.prototype=e(Qo.prototype,{__class__:ea});function ia(t,e,i){Qo.call(this,t,e,i)}(q["miscCityElements.ReinforcedBridge"]=ia).__name__="miscCityElements.ReinforcedBridge",ia.instantiateFromSave=function(t,e){var i=e.bytes.getInt32(e.readStart);e.readStart+=4;var n=i;i=e.bytes.getInt32(e.readStart);e.readStart+=4;var r=i,s=0;if(47<=e.version){i=e.bytes.getInt32(e.readStart);e.readStart+=4,s=i}var o=new vr(n,r);return new ia(t,o,s)},ia.__super__=Qo,ia.prototype=e(Qo.prototype,{get_texturesName:function(){return"spr_reinforcedbridge"},get_potentialTexturesName:function(){return"spr_reinforcedbridge_potential"},__class__:ia});function na(t,e,i){Qo.call(this,t,e,i)}(q["miscCityElements.WoodenBridge"]=na).__name__="miscCityElements.WoodenBridge",na.instantiateFromSave=function(t,e){var i=e.bytes.getInt32(e.readStart);e.readStart+=4;var n=i;i=e.bytes.getInt32(e.readStart);e.readStart+=4;var r=i,s=0;if(47<=e.version){i=e.bytes.getInt32(e.readStart);e.readStart+=4,s=i}var o=new vr(n,r);return new na(t,o,s)},na.__super__=Qo,na.prototype=e(Qo.prototype,{get_texturesName:function(){return"spr_woodenbridge"},get_potentialTexturesName:function(){return"spr_woodenbridge_potential"},__class__:na});var ra=function(){};(q["mobileSpecific.Premium"]=ra).__name__="mobileSpecific.Premium",ra.init=function(t,e){return ra.premiumInfoLoaded=!0,void e()},ra.getBoughtText=function(t){switch(t){case"premium":return Tr.lo("premium_activated");case"premium_upgrade":return Tr.lo("premium_upgrade_activated");case"remove_ads":return Tr.lo("remove_ads_activated");default:return""}},ra.save=function(){Rr.setItem("tfe2_iap",Bo.run(ra.savedPurchases),function(){})},ra.hasSpecific=function(t){return 1==ra.savedPurchases.h[t]},ra.has=function(t){switch(t){case"premium":return!(!ra.hasSpecific("premium")&&!ra.hasSpecific("premium_upgrade"))||ra.hasSpecific("full_version_pass");case"remove_ads":return!!(ra.hasSpecific("remove_ads")||ra.hasSpecific("premium")||ra.hasSpecific("premium_upgrade"))||ra.hasSpecific("full_version_pass");default:return!1}};var sa=function(){};(q["mobileSpecific.PremiumWall"]=sa).__name__="mobileSpecific.PremiumWall",sa.showPremiumWall=function(t){t.createWindow(),t.windowAddInfoText(Tr.lo("get_premium_to_unlock"));var e=new oo(t,t.innerWindowStage,t.windowInner,function(){So.createWindow(t)},Tr.lo("get_premium"));t.windowInner.addChild(e),t.windowInner.addChild(new Ms(t.windowInner,new vr(2,4))),t.windowAddBottomButtons(),e.fillWidth()};var oa=function(t,e,i){this.timer2=20,this.timer=90,this.game=t,this.stage=e,this.text=i};(q["mobileSpecific.WaitAndShowAd"]=oa).__name__="mobileSpecific.WaitAndShowAd",oa.generalUpdate=function(t){0<oa.timeBeforeNextAd&&(oa.timeBeforeNextAd-=t),B.isMoreAdsTest&&(oa.timeBeforeNextAd-=1e4)},oa.prototype={useIfPossible:function(t){if(B.hasRemoveAds())t();else if(pr.adAvailableInterstitial())if(0<oa.timeBeforeNextAd||0<pr.adExpireTime)t();else{(this.game.waitAndShowAdInstance=this).andThen=t,this.game.pause("WaitAndShowAd"),this.subStage=new PIXI.Container,this.stage.addChild(this.subStage),this.gameGraphics=new PIXI.Graphics,this.gameGraphics.beginFill(0,.5),this.gameGraphics.drawRect(0,0,this.game.rect.width*this.game.scaling,this.game.rect.height*this.game.scaling),this.gameGraphics.endFill(),this.subStage.addChild(this.gameGraphics);var e=new PIXI.Text(this.text,{fontFamily:"Arial,sans-serif",fontSize:24*this.game.scaling,fill:16777215,align:"center"});e.anchor.set(.5,.5),this.subStage.addChild(e),e.position.set(this.game.rect.width*this.game.scaling/2,this.game.rect.height*this.game.scaling/2-e.height/2+3*this.game.scaling);var i=new PIXI.Text(Tr.lo("please_wait"),{fontFamily:"Arial,sans-serif",fontSize:15*this.game.scaling,fill:16777215,align:"center"});i.anchor.set(.5,.5),this.subStage.addChild(i),i.position.set(this.game.rect.width*this.game.scaling/2,this.game.rect.height*this.game.scaling/2+i.height/2+3*this.game.scaling),oa.timeBeforeNextAd=18e3}else t()},update:function(t){0<=this.timer?(this.timer-=t,this.timer<0&&(pr.showNonRewardedInterstitialAlways(),this.timer=-1)):0<=this.timer2&&(this.timer2-=t,this.timer2<0&&(this.subStage.destroy(),this.game.resume("WaitAndShowAd"),this.game.waitAndShowAdInstance=null,this.andThen()))},__class__:oa};var aa=t.ModTools=function(){};(q["modding.ModTools"]=aa).__name__="modding.ModTools",aa._performOnLoadEarly=function(t,e){aa._performOnLoadAny(t,e,aa.onGlobalSaveFuncsEarly)},aa._performOnLoad=function(t,e){aa._performOnLoadAny(t,e,aa.onGlobalSaveFuncs)},aa._performOnLoadAny=function(t,e,i){var n=e.bytes.getInt32(e.readStart);e.readStart+=4;var r=n,s=Object.create(null);lt.iter(i,function(t){s[t.modIdentifier]=t});for(var o=0,a=r;o<a;){o++;var l=e.readString();n=e.bytes.getInt32(e.readStart);e.readStart+=4;var h=n,u=e.bytes.getInt32(e.readStart);e.readStart+=4;var c=u;null!=s[l]&&s[l].onLoad(t,e,h),e.readStart=c}};function la(){}(q["modding.WorkshopOverlay"]=la).__name__="modding.WorkshopOverlay",la.prototype={isOpen:function(){return!0},__class__:la};var ha=function(){};(q["pathfinder.DirectConnectionFinder"]=ha).__name__="pathfinder.DirectConnectionFinder",ha.find=function(t,e,i,n){var r=new Ea;r.capacity==r.mSize&&r.grow(),r.mData[(r.mSize+++r.mFront)%r.capacity]=e;var s=t.simulation.permanentFinder;null==s.buildingAdjacent&&s.preProcessQuery();var o=s.pfSeen;for(s.pfSeenStart+=3,1e5<s.pfSeenStart&&(s.pfSeenStart=1),o[e.tempId]=t.simulation.permanentFinder.pfSeenStart;0<r.mSize;){var a=r.mData[r.mFront++];r.mFront==r.capacity&&(r.mFront=0),r.mSize--;var l=a;if(i(l))return l;var h=l.leftBuilding;null!=h&&(n(h)||o[h.tempId]!=t.simulation.permanentFinder.pfSeenStart&&(r.capacity==r.mSize&&r.grow(),o[(r.mData[(r.mSize+++r.mFront)%r.capacity]=h).tempId]=t.simulation.permanentFinder.pfSeenStart));var u=l.rightBuilding;null!=u&&(n(u)||o[u.tempId]!=t.simulation.permanentFinder.pfSeenStart&&(r.capacity==r.mSize&&r.grow(),o[(r.mData[(r.mSize+++r.mFront)%r.capacity]=u).tempId]=t.simulation.permanentFinder.pfSeenStart));var c=l.topBuilding;null!=c&&(n(c)||o[c.tempId]!=t.simulation.permanentFinder.pfSeenStart&&(r.capacity==r.mSize&&r.grow(),o[(r.mData[(r.mSize+++r.mFront)%r.capacity]=c).tempId]=t.simulation.permanentFinder.pfSeenStart));var d=l.bottomBuilding;null!=d&&(n(d)||o[d.tempId]!=t.simulation.permanentFinder.pfSeenStart&&(r.capacity==r.mSize&&r.grow(),o[(r.mData[(r.mSize+++r.mFront)%r.capacity]=d).tempId]=t.simulation.permanentFinder.pfSeenStart))}return null};var ua=function(t){this.gridIStart=0,this.city=t,this.allWaypoints=[],this.highestYPositions=[]};(q["pathfinder.FlyingPathfinder"]=ua).__name__="pathfinder.FlyingPathfinder",ua.prototype={updateWaypoints:function(){this.allWaypoints=[];var t=[],e=0,i=20;0<this.city.worlds.length&&(e=gr.min(this.city.worlds,function(t){return t.rect.x}).rect.x-40,i=gr.max(this.city.worlds,function(t){return t.rect.get_x2()}).rect.get_x2()+40);var n=[];(n=this.city.worlds.slice()).sort(function(t,e){return t.rect.y-e.rect.y});for(var r=e/20|0,s=[],o=0,a=O=(i/20|0)-(this.gridIStart=r)+1;o<a;){var l=o++;s.push([])}var h=s;for(s=0,o=this.city.landingSites;s<o.length;){var u=o[s];++s,h[(u.position.x/20|0)-r].push(u)}for(s=0,o=O;s<o;){var c=20*((l=s++)+r);t.push([]);for(a=0;a<n.length;){var d=n[a];++a;var p=d.rect.x,f=d.rect.get_x2();if(p<=c&&c<f){var g=(c-d.rect.x)/20|0,m=null;if(null!=d.mask)for(var y=d.mask[g],_=0,v=y.length;_<v;){y[L=_++]&&(m=L)}for(var b=[d.rect.y-20*d.permanents[g].length],w=d.permanents[g].length,S=!1,x=d.permanents[g][w-1],T=null!=x&&x.is(mi);0<=--w;){var I=d.permanents[g][w];if(null==I||I.is(yi)||I.is(Zi)){if(!S){if(w!=d.permanents[g].length-1){var P=d.rect.y-20*(w+1),C=t[l][t[l].length-1];T&&(b[0]+=20),0==t[l].length||b[0]>C?(t[l].push(b[0]),t[l].push(P)):t[l][t[l].length-1]=P}S=!0}}else S&&(b[0]=d.rect.y-20*(w+1),S=!1,T=I.is(mi))}if(S&&(b[0]=d.rect.y,S=!1),null!=m){var E=20*(m+1)+d.rect.y,A=t[l][t[l].length-1];gr.any(h[l],function(e){return function(t){return t.position.y==e[0]}}(b))&&(b[0]+=20),0==t[l].length||b[0]>A?(t[l].push(b[0]),t[l].push(E)):t[l][t[l].length-1]=E}}}}var M=new Wo,B=[];this.highestYPositions=[];for(s=1,o=(i/20|0)-r;s<o;){c=20*((l=s++)+r);var R=[],O=t[l].length/2|0,k=[t[l+1]],D=0,F=0,N=new Wo;for(a=0,_=O+1;a<_;){var L=a++,U=[[]],z=[-1e6],W=[1e6];0!=O&&(0==L?W[0]=t[l][0]:L==O?z[0]=t[l][2*O-1]:(z[0]=t[l][2*L-1],W[0]=t[l][2*L])),0==L&&this.highestYPositions.push(0==O?-1e6:W[0]);for(var G=function(r,s,o,a){return function(t){for(var e=0,i=-1,n=-1;e<a[0].length;){if(t>=a[0][e]&&t<a[0][e+1]){i=a[0][e],n=a[0][e+1];break}if(a[0][e]>t)break;e+=2}-1!=i&&(i>s[0]?o[0].push(i-20):n<r[0]&&o[0].push(n))}}(W,z,U,k);F<k[0].length;){if(k[0][F]>z[0]&&k[0][F+1]<W[0])U[0].push(k[0][F]-20),U[0].push(k[0][F+1]);else if(k[0][F]>z[0])break;F+=2}for(;D<B.length;){var H=B[D];if(H>=z[0]&&H<W[0])U[0].push(H),G(H);else if(H>=z[0])break;++D}v=0;for(var X=h[l];v<X.length;){u=X[v];++v,u.position.y>=z[0]&&u.position.y<=W[0]-20&&(U[0].push(u.position.y),G(u.position.y))}U[0].sort(function(t,e){return t-e});for(var j=null,V=U[0].length;0<=--V;)U[0][V]==j&&U[0].splice(V,1),j=U[0][V];for(var Y=null,q=0;q<U[0].length;){var K=U[0][q];++q,R.push(K);var $=new da(c,K);if(null!=Y&&(Y.connections.push($),$.connections.push(Y)),M.h.hasOwnProperty(K)){var Q=M.h[K];Q.connections.push($),$.connections.push(Q)}N.h[K]=$,this.allWaypoints.push($),Y=$}}for(var J=0,Z=h[l];J<Z.length;){var tt=[Z[J]];++J;var et=function(e){return function(t){return t.y==e[0].position.y}}(tt);tt[0].connectedWaypoint=lt.find(N,et),null!=tt[0].connectedWaypoint&&(tt[0].connectedWaypoint.connectedSite=tt[0])}B=R,M=N}},findRoute:function(t,e){if(null==t.connectedWaypoint||null==e.connectedWaypoint)return console.log("FloatingSpaceCities/pathfinder/FlyingPathfinder.hx:304:","problem while finding an air route from:"),console.log("FloatingSpaceCities/pathfinder/FlyingPathfinder.hx:305:",t),console.log("FloatingSpaceCities/pathfinder/FlyingPathfinder.hx:306:","to:"),console.log("FloatingSpaceCities/pathfinder/FlyingPathfinder.hx:307:",e),console.log("FloatingSpaceCities/pathfinder/FlyingPathfinder.hx:308:","If you're an end user, please report this problem. The game should continue normally now, but saving+loading the game may help if you do encounter further pathfinding problems."),null;for(var i=0,n=this.allWaypoints;i<n.length;){var r=n[i];++i,r.seen=0}var s=new Ba(null,!0),o=t.connectedWaypoint;o.priority=0,s.enqueue(o);for(var a=e.connectedWaypoint;0!=s.mSize;){var l=s.dequeue();if(l.seen=2,l==a){for(var h=[];l!=o;)h.push(l),l=l.prevWaypoint;return h.push(o),h}for(i=0,n=l.connections;i<n.length;){var u=n[i];switch(++i,u.seen){case 0:u.seen=1,u.prevWaypoint=l,u.priority=l.priority+(Math.abs(l.x-u.x)+Math.abs(l.y-u.y)),s.enqueue(u);break;case 1:var c=l.priority+(Math.abs(l.x-u.x)+Math.abs(l.y-u.y));c<u.priority&&(u.prevWaypoint=l,s.reprioritize(u,c))}}}return null},findAnyOtherLandingSite:function(t){if(null==t.connectedWaypoint)return null;for(var e=0,i=this.allWaypoints;e<i.length;){var n=i[e];++e,n.seen=0}var r=new zo,s=t.connectedWaypoint;for(s.priority=0,r.head=new Uo(s,r.head);null!=r.head;){var o,a=r.head;if((o=null==a?null:(r.head=a.next,a.elt)).seen=2,null!=o.connectedSite&&o.connectedSite!=t&&null!=o.connectedSite.landingSiteGroup)return o.connectedSite;for(e=0,i=o.connections;e<i.length;){var l=i[e];++e,0==l.seen&&(l.seen=1,l.prevWaypoint=o,r.head=new Uo(l,r.head))}}return null},__class__:ua};function ca(){}(q["polygonal.ds.Prioritizable"]=ca).__name__="polygonal.ds.Prioritizable",ca.__isInterface__=!0,ca.prototype={__class__:ca};var da=function(t,e){this.connectedSite=null,this.prevWaypoint=null,this.seen=0,this.connections=[],this.position=0,this.priority=0,this.x=t,this.y=e};(q["pathfinder.FlyingPathfinderWaypoint"]=da).__name__="pathfinder.FlyingPathfinderWaypoint",da.__interfaces__=[ca],da.prototype={__class__:da};var pa=T["pathfinder.PathOwner"]={__ename__:"pathfinder.PathOwner",__constructs__:["PathForCitizen","PathForMultiCitizens"],PathForCitizen:(N=function(t){return{_hx_index:0,citizen:t,__enum__:"pathfinder.PathOwner",toString:i}},N.__params__=["citizen"],N),PathForMultiCitizens:(N=function(t){return{_hx_index:1,citizens:t,__enum__:"pathfinder.PathOwner",toString:i}},N.__params__=["citizens"],N)},fa=function(t){var e;this.numberOfMultiRequests=0,this.numberOfPathsDoneLastStepPerThread=0,this.lastSentEntertainmentInfo=0,this.previousRequestSentToWorker=0,this.currentMaxThreads=15,this.usedWorkers=0,this.activeWorkers=0,this.totalNumRequested=0,this.city=t,this.workers=[],(e=[]).push(new Ea),e.push(new Ea),e.push(new Ea),e.push(new Ea),e.push(new Ea),e.push(new Ea),e.push(new Ea),e.push(new Ea),e.push(new Ea),e.push(new Ea),e.push(new Ea),e.push(new Ea),e.push(new Ea),e.push(new Ea),e.push(new Ea),this.pathOwners=e,(e=[]).push(null),e.push(null),e.push(null),e.push(null),e.push(null),e.push(null),e.push(null),e.push(null),e.push(null),e.push(null),e.push(null),e.push(null),e.push(null),e.push(null),e.push(null),this.storedPathMessages=e,(e=[]).push(null),e.push(null),e.push(null),e.push(null),e.push(null),e.push(null),e.push(null),e.push(null),e.push(null),e.push(null),e.push(null),e.push(null),e.push(null),e.push(null),e.push(null),this.pathRequests=e,(e=[]).push(0),e.push(0),e.push(0),e.push(0),e.push(0),e.push(0),e.push(0),e.push(0),e.push(0),e.push(0),e.push(0),e.push(0),e.push(0),e.push(0),e.push(0),this.pathRequestPos=e,(e=[]).push(0),e.push(0),e.push(0),e.push(0),e.push(0),e.push(0),e.push(0),e.push(0),e.push(0),e.push(0),e.push(0),e.push(0),e.push(0),e.push(0),e.push(0),this.pathRequestNumber=e,(e=[]).push(0),e.push(0),e.push(0),e.push(0),e.push(0),e.push(0),e.push(0),e.push(0),e.push(0),e.push(0),e.push(0),e.push(0),e.push(0),e.push(0),e.push(0),this.pathNumberProcessed=e,this.plannedMultiPathRequests=new Wo,this.setWorkerNumber(O.pathfindingWorkers,!1)};(q["pathfinder.PathfinderManager"]=fa).__name__="pathfinder.PathfinderManager",fa.prototype={setWorkerNumber:function(t,e){if(!(t<=0))if(t>this.activeWorkers)for(var i=t-this.activeWorkers,n=this.activeWorkers,r=0,s=i;r<s;){var o=r++;if(this.initNewWorkerIfPossible(),e&&this.activeWorkers>o+n){var a=this.getPathfindingInfo();this.postInt32Array(a,o+n,!1)}}else this.usedWorkers=t},terminate:function(){for(var t=0,e=this.workers;t<e.length;){var i=e[t];++t,i.terminate()}this.activeWorkers=0},initNewWorkerIfPossible:function(){this.activeWorkers<this.currentMaxThreads&&(this.initWorker(this.activeWorkers),this.initPathRequests(this.activeWorkers),this.activeWorkers++,this.usedWorkers++)},initWorker:function(n){var r=this;try{this.workers[n]=new Worker(dt.pathfinderCodeUrl)}catch(t){this.workers[n]=new Worker("js/pathfinder.js")}this.useModernPostMessage=!0;try{var t=new Int32Array(1);t[0]=2,this.workers[n].postMessage(t.buffer,[t.buffer])}catch(t){this.useModernPostMessage=!1,console.log("FloatingSpaceCities/pathfinder/PathfinderManager.hx:138:","Using legacy mode for web workers.")}this.storedPathMessages[n]=new Ea(200),this.workers[n].onmessage=function(t){var e=r.storedPathMessages[n],i=new Int32Array(t.data);e.capacity==e.mSize&&e.grow(),e.mData[(e.mSize+++e.mFront)%e.capacity]=i}},getEntertainmentInfo:function(){var t=new Int32Array(2+2*this.city.permanents.length),e=0;t[e++]=3,t[e++]=this.city.permanents.length;for(var i=0,n=this.city.permanents;i<n.length;){var r=n[i];if(++i,t[e++]=r.id,r.isBuilding){var s=r;if(s.isEntertainment){var o=s;o.get_isOpen()?t[e++]=1<<o.get_entertainmentType():t[e++]=-1}else t[e++]=-1}else t[e++]=-1}return t},sendEntertainmentInfo:function(){for(var t=this.getEntertainmentInfo(),e=0,i=this.activeWorkers;e<i;){var n=e++;this.postInt32Array(t,n,!0)}this.lastSentEntertainmentInfo=30},getPathfindingInfo:function(){for(var t=0,e=0,i=this.city.worlds;e<i.length;){var n=i[e];++e,t+=3;for(var r=0,s=n.permanents;r<s.length;){var o=s[r];++r,t+=1+2*o.length}}var a=[];for(e=0,i=this.city.permanents;e<i.length;){i[e];++e}for(e=0,i=this.city.miscCityElements.allMiscElements;e<i.length;){var l=i[e];if(++e,l.is(Qo)){var h=l;if(null!=h.leftBuilding&&null!=h.rightBuilding&&h.get_humanCanWalkOn()){var u=h.rightBuilding.position.x-h.leftBuilding.position.x;a.push(16),a.push(h.leftBuilding.id),a.push(h.rightBuilding.id),a.push(u),a.push(15),a.push(h.rightBuilding.id),a.push(h.leftBuilding.id),a.push(u)}}}var c=new Int32Array(t+4*this.city.connections.directWorldConnectionNumber+4+this.city.connections.landingSiteGroups.length+this.city.landingSites.length+a.length),d=0;c[d++]=0,c[d++]=this.city.worlds.length;for(e=0,i=this.city.worlds;e<i.length;){n=i[e];++e,c[d++]=n.permanents.length,c[d++]=n.rect.x,c[d++]=n.rect.y;for(r=0,s=n.permanents;r<s.length;){o=s[r];++r,c[d++]=o.length;for(var p=0;p<o.length;){var f=o[p];++p,null!=f?(c[d++]=f.id,f.isBuilding?c[d++]=4*f.get_typeID()+(f.isBuilding&&f.isRooftopBuilding?1:0)+(f.isBuilding&&f.cannotBuildOnTop?2:0):c[d++]=12):(c[d++]=-1,c[d++]=-1)}}}c[d++]=this.city.connections.directWorldConnectionNumber+(a.length/4|0);for(e=0,i=this.city.worlds;e<i.length;){n=i[e];++e;for(r=0,s=n.permanents[0];r<s.length;){f=s[r];if(++r,null!=f&&f.isBuilding){var g=f;if(null!=g.leftBuilding){var m=g.leftBuilding,y=m.world;(y.rect.y>n.rect.y||y.rect.y==n.rect.y&&y.rect.x>n.rect.x)&&(c[d++]=2,c[d++]=g.id,c[d++]=m.id,c[d++]=20,c[d++]=3,c[d++]=m.id,c[d++]=g.id,c[d++]=20)}}}p=0;for(var _=n.permanents[n.permanents.length-1];p<_.length;){var v=_[p];if(++p,null!=v&&v.isBuilding){var b=v;if(null!=b.rightBuilding){var w=b.rightBuilding,S=w.world;(S.rect.y>n.rect.y||S.rect.y==n.rect.y&&S.rect.x>n.rect.x)&&(c[d++]=3,c[d++]=b.id,c[d++]=w.id,c[d++]=20,c[d++]=2,c[d++]=w.id,c[d++]=b.id,c[d++]=20)}}}}for(e=0;e<a.length;){var x=a[e];++e,c[d++]+=x}c[d++]=this.city.connections.landingSiteGroups.length;for(e=0,i=this.city.connections.landingSiteGroups;e<i.length;){var T=i[e];++e,c[d++]=T.length;for(r=0;r<T.length;){var I=T[r];++r,c[d++]=I.id}}return c},sendPathfindingInfo:function(){for(var t=this.getPathfindingInfo(),e=0,i=this.activeWorkers;e<i;){var n=e++;this.postInt32Array(t,n,!0)}this.sendEntertainmentInfo()},findPathEntertainment:function(t,e,i){this.findPathAny(t,null,1,i,e)},findPath:function(t,e){this.findPathAny(t,e,0,e.id,1e7)},findPathCombined:function(t,e){if(t.isRequestingPath=!0,t.requestingPathGoal=e,null==t.inPermanent)this.findPath(t,e);else{var i=this.plannedMultiPathRequests.h[t.inPermanent.id];null==i&&(i={citizens:[],goals:[]},this.plannedMultiPathRequests.h[t.inPermanent.id]=i,this.numberOfMultiRequests++),i.citizens.push(t),i.goals.push(e)}},findAllPaths:function(t,e){this.previousRequestSentToWorker++,this.previousRequestSentToWorker>=this.usedWorkers&&(this.previousRequestSentToWorker=0);var i=this.previousRequestSentToWorker,n=6+t.length;if(603<=this.pathRequestPos[i]+n){var r=3+n;this.requestPaths(i,603<r?r:603)}var s=this.pathRequests[i];this.pathRequestNumber[i]+=1;var o=t[0];null!=o.inPermanent?(s[this.pathRequestPos[i]++]=-1,s[this.pathRequestPos[i]++]=o.inPermanent.id):(s[this.pathRequestPos[i]++]=this.city.worlds.indexOf(o.onWorld),s[this.pathRequestPos[i]++]=0|o.relativeX),s[this.pathRequestPos[i]++]=2,s[this.pathRequestPos[i]++]=t.length,null!=o.home&&o.home.get_hasPrivateTeleporter()?s[this.pathRequestPos[i]++]=o.home.id:s[this.pathRequestPos[i]++]=-1,s[this.pathRequestPos[i]++]=1e6;var a=this.pathOwners[i];a.capacity==a.mSize&&a.grow(),a.mData[(a.mSize+++a.mFront)%a.capacity]=pa.PathForMultiCitizens(t);for(var l=0,h=t.length;l<h;){var u=l++,c=t[u],d=e[u];c.isRequestingPath=!0,c.requestingPathGoal=d,s[this.pathRequestPos[i]++]=d.id}603<this.pathRequestPos[i]+6&&this.requestPaths(i)},findPathAny:function(t,e,i,n,r){this.previousRequestSentToWorker++,this.previousRequestSentToWorker>=this.usedWorkers&&(this.previousRequestSentToWorker=0);var s=this.previousRequestSentToWorker,o=this.pathRequests[s];this.pathRequestNumber[s]+=1,null!=t.inPermanent?(o[this.pathRequestPos[s]++]=-1,o[this.pathRequestPos[s]++]=t.inPermanent.id):(o[this.pathRequestPos[s]++]=this.city.worlds.indexOf(t.onWorld),o[this.pathRequestPos[s]++]=0|t.relativeX),o[this.pathRequestPos[s]++]=i,o[this.pathRequestPos[s]++]=n,null!=t.home&&t.home.get_hasPrivateTeleporter()?o[this.pathRequestPos[s]++]=t.home.id:o[this.pathRequestPos[s]++]=-1,o[this.pathRequestPos[s]++]=r;var a=this.pathOwners[s];a.capacity==a.mSize&&a.grow(),a.mData[(a.mSize+++a.mFront)%a.capacity]=pa.PathForCitizen(t),t.isRequestingPath=!0,t.requestingPathGoal=e,603<this.pathRequestPos[s]+6&&this.requestPaths(s)},update:function(t){this.lastSentEntertainmentInfo-=t,this.lastSentEntertainmentInfo<=0&&this.sendEntertainmentInfo(),this.sendMultiPathRequests(),this.requestAllPaths()},sendMultiPathRequests:function(){for(var t=this.plannedMultiPathRequests.iterator();t.hasNext();){var e=t.next();this.findAllPaths(e.citizens,e.goals)}this.plannedMultiPathRequests=new Wo,this.numberOfMultiRequests=0},requestAllPaths:function(){for(var t=0,e=this.activeWorkers;t<e;){var i=t++;this.requestPaths(i)}},requestPaths:function(t,e){null==e&&(e=603),3<this.pathRequestPos[t]&&(this.pathRequests[t][0]=1,this.pathRequests[t][1]=this.pathRequestNumber[t],this.pathRequests[t][2]=this.city.simulation.operatingCost.teleportersEnabled?1:0,this.postInt32Array(this.pathRequests[t],t,!1),this.totalNumRequested+=(this.pathRequestPos[t]-3)/6|0,this.initPathRequests(t))},initPathRequests:function(t,e){null==e&&(e=603),this.pathRequests[t]=new Int32Array(e),this.pathRequestPos[t]=3,this.pathRequestNumber[t]=0},distributePaths:function(){for(var t=this.numberOfPathsDoneLastStepPerThread=0,e=this.activeWorkers;t<e;){for(var i=t++;0!=this.storedPathMessages[i].mSize;){var n=this.storedPathMessages[i],r=n.mData[n.mFront++];n.mFront==n.capacity&&(n.mFront=0),n.mSize--;var s=r,o=1;this.numberOfPathsDoneLastStepPerThread+=s[0];for(var a=0,l=s[0];a<l;){a++;var h=this.pathOwners[i],u=h.mData[h.mFront];switch(u._hx_index){case 0:var c=u.citizen,d=s[o];c.setPath(s,o+1,d);var p=this.pathOwners[i];p.mData[p.mFront++];p.mFront==p.capacity&&(p.mFront=0),p.mSize--,o+=d+1;break;case 1:var f=u.citizens,g=s[o++];this.pathNumberProcessed[i]+=g;for(var m=s[o+g],y=0,_=g;y<_;){f[s[o+y++]].setPath(s,o+g+1,m)}if(o+=m+1+g,this.pathNumberProcessed[i]>=f.length){this.pathNumberProcessed[i]=0;var v=this.pathOwners[i];v.mData[v.mFront++];v.mFront==v.capacity&&(v.mFront=0),v.mSize--}}}}this.totalNumRequested=0}this.numberOfPathsDoneLastStepPerThread=this.numberOfPathsDoneLastStepPerThread/this.activeWorkers|0},getTotalNumberOfRequested:function(){for(var t=0,e=0,i=this.activeWorkers;e<i;){var n=e++;t+=this.pathOwners[n].mSize}return t},mayRequestPathNow:function(t){var e=this.previousRequestSentToWorker+1;return e>=this.usedWorkers&&(e=0),null!=t&&null!=this.plannedMultiPathRequests.h[t.id]||this.pathOwners[e].mSize+this.numberOfMultiRequests<this.numberOfPathsDoneLastStepPerThread+100},postInt32Array:function(t,e,i){this.useModernPostMessage&&!i?this.workers[e].postMessage(t.buffer,[t.buffer]):this.workers[e].postMessage(t.buffer)},invalidateAllPaths:function(){for(var t=0,e=this.pathOwners;t<e.length;){var i=e[t];++t;for(var n=i.iterator();n.hasNext();){var r=n.next();switch(r._hx_index){case 0:var s=r.citizen;null!=s&&(s.isRequestingPath=!1);break;case 1:for(var o=r.citizens,a=0;a<o.length;){var l=o[a];++a,null!=l&&(l.isRequestingPath=!1)}}}}for(t=0,e=this.activeWorkers;t<e;){var h=t++;this.workers[h].terminate(),this.pathOwners[h].clear(),this.pathNumberProcessed[h]=0,this.initWorker(h),this.initPathRequests(h)}},__class__:fa};function ga(){}(q["pathfinder.PathfindingTools"]=ga).__name__="pathfinder.PathfindingTools",ga.findNearestBestBuildingStack=function(t,e){for(var i=t.get_worldX(),n=-1/0,r=null,s=1/0,o=0,a=t.onWorld.permanents.length;o<a;){var l=o++,h=e(t.onWorld.permanents[l]),u=Math.abs(i-20*l);(n<h||h==n&&u<s)&&(r=l,s=u,n=h)}return r};var ma=function(t){this.pfRelatedPrioritizable=null,this.pfSeen=null,this.buildingSpecialTransport=null,this.buildingAdjacentLast=null,this.buildingAdjacentIndex=null,this.buildingAdjacentDist=null,this.buildingAdjacent=null,this.pfSeenStart=1,this.limitQueryAmountFor=0,this.updateQueries=0,this.pathQueue=new Ba(10,!0),this.city=t,this.savedResults=new Vo};(q["pathfinder.PermanentFinder"]=ma).__name__="pathfinder.PermanentFinder",ma.prototype={preUpdate:function(){(this.updateQueries=0)<this.limitQueryAmountFor&&this.limitQueryAmountFor--},requestQueryLimiting:function(t){null==t&&(t=!1),this.limitQueryAmountFor=120,t&&(this.updateQueries=10)},canPerformQuery:function(){return!(0<this.limitQueryAmountFor)||this.updateQueries<10},clearPFCache:function(){this.buildingAdjacent=null,this.buildingAdjacentDist=null,this.buildingAdjacentIndex=null,this.buildingAdjacentLast=null,this.buildingSpecialTransport=null},preProcessQuery:function(){this.buildingAdjacent=[],this.buildingAdjacentDist=[],this.buildingAdjacentIndex=[],this.buildingAdjacentLast=[],this.buildingSpecialTransport=[],this.pfSeen=[],this.pfRelatedPrioritizable=[];for(var t=0,e=0,i=this.city.permanents.length;e<i;){var n=e++,r=this.city.permanents[n];if(this.buildingAdjacentIndex[n]=t,r.isBuilding){var s=r;if(null!=s.leftBuilding)this.buildingAdjacent.push(s.leftBuilding.tempId),this.buildingAdjacentDist.push(20),++t;else{var o=this.city.miscCityElements.findSpecific(new vr(s.position.x-20,s.position.y),Qo);null!=o&&null!=o.leftBuilding&&null!=o.rightBuilding&&o.get_humanCanWalkOn()&&(this.buildingAdjacent.push(o.leftBuilding.tempId),this.buildingAdjacentDist.push(o.rightBuilding.position.x-o.leftBuilding.position.x),++t)}if(null!=s.rightBuilding)this.buildingAdjacent.push(s.rightBuilding.tempId),this.buildingAdjacentDist.push(20),++t;else{var a=this.city.miscCityElements.findSpecific(new vr(s.position.x+20,s.position.y),Qo);null!=a&&null!=a.leftBuilding&&null!=a.rightBuilding&&a.get_humanCanWalkOn()&&(this.buildingAdjacent.push(a.rightBuilding.tempId),this.buildingAdjacentDist.push(a.rightBuilding.position.x-a.leftBuilding.position.x),++t)}null!=s.topBuilding&&(this.buildingAdjacent.push(s.topBuilding.tempId),this.buildingAdjacentDist.push(20),++t),null!=s.bottomBuilding&&(this.buildingAdjacent.push(s.bottomBuilding.tempId),this.buildingAdjacentDist.push(20),++t)}this.buildingAdjacentLast[n]=t,r.is(dn)?this.buildingSpecialTransport.push(1):r.is(mi)?this.buildingSpecialTransport.push(2):r.is(ci)?this.buildingSpecialTransport.push(3):r.is(yn)?this.buildingSpecialTransport.push(4):this.buildingSpecialTransport.push(0),this.pfSeen.push(this.pfSeenStart),this.pfRelatedPrioritizable.push(null)}},query:function(t,e,i,n,r,s,o,a){null==a&&(a=1e8),null==s&&(s=-1);var l=this;if(null==this.buildingAdjacent&&this.preProcessQuery(),this.updateQueries+=1,this.pfSeenStart+=3,1e5<this.pfSeenStart&&(this.pfSeenStart=1),null!=t){var h=ya.create(0,t.tempId);this.pfRelatedPrioritizable[t.tempId]=h,this.pathQueue.enqueue(h)}else for(var u=0,c=n.permanents;u<c.length;){var d=c[u];if(++u,0!=d.length&&null!=d[0]){var p=Math.abs(d[0].position.x-r);-1!=s&&s<p||(this.pfRelatedPrioritizable[d[0].tempId]=ya.create(p,d[0].tempId),this.pathQueue.enqueue(this.pfRelatedPrioritizable[d[0].tempId]),this.pfSeen[d[0].tempId]=this.pfSeenStart)}}var f=-1e4,g=null,m=this.city.connections.landingSiteGroups,y=!this.city.simulation.operatingCost.teleportersEnabled;for(u=[],c=0;c<m.length;){m[c];++c,u.push(!1)}var _=u,v=-1;for(null!=o&&null!=o.home&&(v=o.home.get_hasPrivateTeleporter()?o.home.tempId:null);0!=this.pathQueue.mSize;){var b=this.pathQueue.dequeue(),w=b.permanent;if(this.pfSeen[w]=this.pfSeenStart+1,e(this.city.permanents[w])){if(null==i){for(;0!=this.pathQueue.mSize;)this.pathQueue.dequeue().destroy();g=w;break}var S=i(this.city.permanents[w]);if(a<=S){g=w;break}f<S&&(g=w,f=S)}for(u=this.buildingAdjacentIndex[w],c=this.buildingAdjacentLast[w];u<c;){var x=u++,T=this.buildingAdjacent[x],I=this.buildingAdjacentDist[x];if(null!=T)if(l.pfSeen[T]==l.pfSeenStart){var P=l.pfRelatedPrioritizable[T];(p=b.priority+I)<P.priority&&l.pathQueue.reprioritize(P,p)}else if(l.pfSeen[T]!=l.pfSeenStart+1){var C=b.priority+I;(-1==s||C<=s)&&(l.pfSeen[T]=l.pfSeenStart,l.pfRelatedPrioritizable[T]=ya.create(C,T),l.pathQueue.enqueue(l.pfRelatedPrioritizable[T]))}}var E=this.buildingSpecialTransport[w],A=v==w;if((1==E||A)&&!y){for(var M=il.getFloat(2),B=this.city.teleporters.length,R=2/B,O=0,k=B;O<k;){var D=O++,F=this.city.teleporters[D].tempId,N=9+(M+D*R)%2;if(null!=F)if(l.pfSeen[F]==l.pfSeenStart){var L=l.pfRelatedPrioritizable[F],U=b.priority+N;U<L.priority&&l.pathQueue.reprioritize(L,U)}else if(l.pfSeen[F]!=l.pfSeenStart+1){var z=b.priority+N;(-1==s||z<=s)&&(l.pfSeen[F]=l.pfSeenStart,l.pfRelatedPrioritizable[F]=ya.create(z,F),l.pathQueue.enqueue(l.pfRelatedPrioritizable[F]))}}if(!A&&-1!=v&&null!=v)if(l.pfSeen[v]==l.pfSeenStart){var W=l.pfRelatedPrioritizable[v],G=b.priority+10;G<W.priority&&l.pathQueue.reprioritize(W,G)}else if(l.pfSeen[v]!=l.pfSeenStart+1){var H=b.priority+10;(-1==s||H<=s)&&(l.pfSeen[v]=l.pfSeenStart,l.pfRelatedPrioritizable[v]=ya.create(H,v),l.pathQueue.enqueue(l.pfRelatedPrioritizable[v]))}y=!0}else if(2!=E||_[this.city.permanents[w].landingSiteGroup])if(3!=E||b.dontCheckElevators||3==this.pfSeen[w]);else for(var X=this.city.permanents[w],j=0,V=this.city.connections.elevatorConnections.h[X.world.__id__][X.worldPosition.x];j<V.length;){var Y=V[j];++j;var q=Y.tempId,K=Math.abs(Y.worldPosition.y-X.worldPosition.y);if(null!=q)if(l.pfSeen[q]==l.pfSeenStart){var $=l.pfRelatedPrioritizable[q],Q=b.priority+K;Q<$.priority&&l.pathQueue.reprioritize($,Q)}else if(l.pfSeen[q]!=l.pfSeenStart+1){var J=b.priority+K;(-1==s||J<=s)&&(l.pfSeen[q]=l.pfSeenStart,l.pfRelatedPrioritizable[q]=ya.create(J,q),l.pathQueue.enqueue(l.pfRelatedPrioritizable[q]))}null!=this.pfRelatedPrioritizable[Y.tempId]&&(this.pfRelatedPrioritizable[Y.tempId].dontCheckElevators=!0)}else{for(var Z=this.city.permanents[w].landingSiteGroup,tt=0,et=this.city.connections.landingSiteGroups[Z];tt<et.length;){var it=et[tt];++tt;var nt=it.tempId,rt=it.estimatedFlyingDistanceTo(this.city.permanents[w]);if(null!=nt)if(l.pfSeen[nt]==l.pfSeenStart){var st=l.pfRelatedPrioritizable[nt],ot=b.priority+rt;ot<st.priority&&l.pathQueue.reprioritize(st,ot)}else if(l.pfSeen[nt]!=l.pfSeenStart+1){var at=b.priority+rt;(-1==s||at<=s)&&(l.pfSeen[nt]=l.pfSeenStart,l.pfRelatedPrioritizable[nt]=ya.create(at,nt),l.pathQueue.enqueue(l.pfRelatedPrioritizable[nt]))}}_[Z]=!0}if(0==this.city.permanents[w].worldPosition.y)for(var lt=0,ht=this.city.permanents[w].world.permanents;lt<ht.length;){d=ht[lt];if(++lt,0!=d.length&&null!=d[0]){var ut=d[0].tempId,ct=Math.abs(d[0].position.x-this.city.permanents[w].position.x);if(null!=ut)if(l.pfSeen[ut]==l.pfSeenStart){var dt=l.pfRelatedPrioritizable[ut],pt=b.priority+ct;pt<dt.priority&&l.pathQueue.reprioritize(dt,pt)}else if(l.pfSeen[ut]!=l.pfSeenStart+1){var ft=b.priority+ct;(-1==s||ft<=s)&&(l.pfSeen[ut]=l.pfSeenStart,l.pfRelatedPrioritizable[ut]=ya.create(ft,ut),l.pathQueue.enqueue(l.pfRelatedPrioritizable[ut]))}}}b.destroy()}return this.city.permanents[g]},queryForCitizen:function(t,e,i,n,r){return null==r&&(r=!1),null==n&&(n=-1),null!=t.inPermanent?this.query(t.inPermanent,e,i,null,0,n,r?null:t):this.query(null,e,i,t.onWorld,t.relativeX,n,r?null:t)},quickQueryForCitizen:function(t,e,i,n,r,s){null==s&&(s=-1);var o,a,l=this.city.simulation.time.timeSinceStart;a=null!=t.inPermanent?(o=t.inPermanent.worldPosition.x,t.inPermanent.worldPosition.y/5|0):(o=(0|t.relativeX)/20|0,0);var h=t.onWorld.rect.x+";"+t.onWorld.rect.y+";"+o+";"+a+i,u=this.savedResults.h[h],c=null;if(null!=u&&(l<u.expiry?c=u.permanent:null!=u.permanent&&e(u.permanent)&&(u.expiry+=60*n,c=u.permanent)),null==c){var d=this.queryForCitizen(t,e,r,s,!0),p={permanent:d,expiry:l+60*n};this.savedResults.h[h]=p,c=d}return c},invalidatePathfindingRelatedInfo:function(){this.savedResults=new Vo},__class__:ma};var ya=function(){this.dontCheckElevators=!1};(q["pathfinder.PermanentPrioritizable"]=ya).__name__="pathfinder.PermanentPrioritizable",ya.__interfaces__=[ca],ya.create=function(t,e){var i=0==ya.pool.length?new ya:ya.pool.pop();return i.___internal_pooling_initObject(t,e),i},ya.prototype={___internal_pooling_initObject:function(t,e){this.priority=t,this.permanent=e,this.dontCheckElevators=!1},destroy:function(){ya.pool.push(this)},__class__:ya};var _a=function(t){this.city=t,this.prev=new Wo};(q["pathfinder.RouteFinder"]=_a).__name__="pathfinder.RouteFinder",_a.prototype={__class__:_a};function va(){var e=Ko.getClass(this).__name__;this.info=lt.find(dt.cityUpgradesInfo,function(t){return"policies."+t.className==e})}(q["policies.Policy"]=va).__name__="policies.Policy",va.__interfaces__=[n],va.prototype={addToCity:function(t){this.city=t},destroy:function(){},save:function(t,e){null==e&&(e=!0),e&&t.addString(va.saveDefinition)},load:function(t,e){null==e&&(e=t.readString());Dr.makeLoadMap(e,t)},__class__:va};var ba=function(){va.call(this)};(q["policies.FoodRationing"]=ba).__name__="policies.FoodRationing",ba.__super__=va,ba.prototype=e(va.prototype,{addToCity:function(t){this.city=t,this.city.simulation.eating.foodRationing=!0},destroy:function(){this.city.simulation.eating.foodRationing=!1},__class__:ba});var wa=function(){va.call(this)};(q["policies.MandatoryOvertime"]=wa).__name__="policies.MandatoryOvertime",wa.__super__=va,wa.prototype=e(va.prototype,{addToCity:function(t){(this.city=t).policies.vars.workTimeChange=2},destroy:function(){this.city.policies.vars.workTimeChange=0},__class__:wa});var Sa=function(t){this.city=t,this.policies=[],this.vars=new xa};(q["policies.Policies"]=Sa).__name__="policies.Policies",Sa.prototype={addPolicy:function(t){this.policies.push(t),t.addToCity(this.city)},removePolicy:function(t){at.remove(this.policies,t),t.destroy()},save:function(t){var e=this.policies.length;if(t.size+4>t.bytes.length){var i=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+4))),t.bytes.blit(0,i,0,t.size)}t.bytes.setInt32(t.size,e),t.size+=4;for(var n=0,r=this.policies;n<r.length;){var s=r[n];++n;var o=Ko.getClass(s);t.addString(o.__name__),s.save(t)}},load:function(t){var e=t.bytes.getInt32(t.readStart);t.readStart+=4;for(var i=0,n=e;i<n;){i++;var r=t.readString(),s=k.createInstance(q[r],[]);s.load(t),this.addPolicy(s)}},__class__:Sa};var xa=function(){this.workTimeChange=0,this.schoolMaxEdu=1,this.schoolClassSizeMod=1};(q["policies.PolicyVars"]=xa).__name__="policies.PolicyVars",xa.prototype={__class__:xa};var Ta=function(){va.call(this)};(q["policies.SmallerClasses"]=Ta).__name__="policies.SmallerClasses",Ta.__super__=va,Ta.prototype=e(va.prototype,{addToCity:function(t){(this.city=t).policies.vars.schoolClassSizeMod=.6666667,t.simulation.schoolAssigner.schoolsShouldBeUpdated=!0,t.policies.vars.schoolMaxEdu=1.15;for(var e=0,i=t.permanents;e<i.length;){var n=i[e];if(++e,n.is(Ki))for(var r=n;r.students.length>r.get_studentCapacity();)r.students[r.students.length-1].leaveSchool()}},destroy:function(){this.city.policies.vars.schoolClassSizeMod=1,this.city.simulation.schoolAssigner.schoolsShouldBeUpdated=!0,this.city.policies.vars.schoolMaxEdu=1},__class__:Ta});function Ia(){}(q["polygonal.ds.Hashable"]=Ia).__name__="polygonal.ds.Hashable",Ia.__isInterface__=!0;function Pa(){}(q["polygonal.ds.Collection"]=Pa).__name__="polygonal.ds.Collection",Pa.__isInterface__=!0,Pa.__interfaces__=[Ia];function Ca(){}(q["polygonal.ds.Queue"]=Ca).__name__="polygonal.ds.Queue",Ca.__isInterface__=!0,Ca.__interfaces__=[Pa];var Ea=function(t,e,i){if(null==t&&(t=16),this.mIterator=null,this.mFront=0,this.mSize=0,this.reuseIterator=!1,this.growthRate=-2,this.mInitialCapacity=t<1?1:t,this.capacity=this.mInitialCapacity,null!=e){this.mSize=e.length;var n=this.mSize,r=this.capacity;this.capacity=r<n?n:r}if(this.mData=new Array(this.capacity),null!=e)for(var s=this.mData,o=0,a=this.mSize;o<a;){var l=o++;s[l]=e[l]}i&&(this.growthRate=0)};(q["polygonal.ds.ArrayedQueue"]=Ea).__name__="polygonal.ds.ArrayedQueue",Ea.__interfaces__=[Ca],Ea.prototype={clear:function(t){null==t&&(t=!1),t&&Oa.nullify(this.mData),this.mFront=this.mSize=0},iterator:function(){return this.reuseIterator?(null==this.mIterator?this.mIterator=new Ma(this):this.mIterator.reset(),this.mIterator):new Ma(this)},grow:function(){var t=this.capacity;this.capacity=Ra.compute(this.growthRate,this.capacity),this.resizeContainer(t,this.capacity)},resizeContainer:function(t,e){var i=new Array(e);if(t<e)if(this.mFront+this.mSize>t){var n=t-(r=t-this.mFront);Oa.blit(this.mData,this.mFront,i,0,r),Oa.blit(this.mData,0,i,r,n)}else Oa.blit(this.mData,this.mFront,i,0,this.mSize);else if(this.mFront+this.mSize>t){var r=t-this.mFront;n=this.mSize-this.mFront;Oa.blit(this.mData,this.mFront,i,0,r),Oa.blit(this.mData,0,i,this.mFront,n)}else Oa.blit(this.mData,this.mFront,i,0,this.mSize);this.mData=i,this.mFront=0},__class__:Ea};function Aa(){}(q["polygonal.ds.Itr"]=Aa).__name__="polygonal.ds.Itr",Aa.__isInterface__=!0,Aa.prototype={__class__:Aa};var Ma=function(t){this.mObject=t,this.reset()};(q["polygonal.ds.ArrayedQueueIterator"]=Ma).__name__="polygonal.ds.ArrayedQueueIterator",Ma.__interfaces__=[Aa],Ma.prototype={reset:function(){return this.mFront=this.mObject.mFront,this.mCapacity=this.mObject.capacity,this.mSize=this.mObject.mSize,this.mI=0,this.mData=this.mObject.mData.slice(),this},hasNext:function(){return this.mI<this.mSize},next:function(){return this.mData[(this.mI+++this.mFront)%this.mCapacity]},__class__:Ma};var Ba=function(t,e,i){if(null==e&&(e=!1),null==t&&(t=1),this.mSize=0,this.growthRate=-2,this.mInitialCapacity=t<1?1:t,this.capacity=t,this.mInverse=e,null!=i){this.mSize=i.length;var n=this.mSize,r=this.capacity;this.capacity=r<n?n:r}if(this.mData=new Array(this.capacity+1),(this.mData[0]=null)!=i){for(var s=this.mData,o=1,a=this.mSize+1;o<a;){var l=o++;s[l]=i[l-1]}this.repair()}};(q["polygonal.ds.PriorityQueue"]=Ba).__name__="polygonal.ds.PriorityQueue",Ba.__interfaces__=[Ca],Ba.prototype={enqueue:function(t){this.mSize==this.capacity&&this.grow(),(this.mData[++this.mSize]=t).position=this.mSize;var e=this.mSize,i=this.mData,n=e>>1,r=i[e],s=r.priority;if(this.mInverse)for(;0<n;){if(!(s-(o=i[n]).priority<0))break;(i[e]=o).position=e,e=n,n>>=1}else for(;0<n;){var o;if(!(0<s-(o=i[n]).priority))break;(i[e]=o).position=e,e=n,n>>=1}(i[e]=r).position=e},dequeue:function(){var t=(e=this.mData)[1];t.position=-1,e[1]=e[this.mSize];var e,i,n=1,r=n<<1,s=(e=this.mData)[n],o=s.priority;if(this.mInverse)for(;r<this.mSize&&(r<this.mSize-1&&0<e[r].priority-e[r+1].priority&&++r,0<o-(i=e[r]).priority);)(e[n]=i).position=n,n=s.position=r,r<<=1;else for(;r<this.mSize&&(r<this.mSize-1&&e[r].priority-e[r+1].priority<0&&++r,o-(i=e[r]).priority<0);)(e[n]=i).position=n,n=s.position=r,r<<=1;return(e[n]=s).position=n,this.mSize--,t},reprioritize:function(t,e){var i=t.priority;if(i==e)return this;t.priority=e;var n=t.position;if(this.mInverse)if(e<i){var r=(l=n)>>1,s=(u=(h=this.mData)[l]).priority;if(this.mInverse)for(;0<r;){if(!(s-(c=h[r]).priority<0))break;(h[l]=c).position=l,l=r,r>>=1}else for(;0<r;){if(!(0<s-(c=h[r]).priority))break;(h[l]=c).position=l,l=r,r>>=1}(h[l]=u).position=l}else{var o=(l=n)<<1;s=(u=(h=this.mData)[l]).priority;if(this.mInverse)for(;o<this.mSize&&(o<this.mSize-1&&0<h[o].priority-h[o+1].priority&&++o,0<s-(a=h[o]).priority);)(h[l]=a).position=l,l=u.position=o,o<<=1;else for(;o<this.mSize&&(o<this.mSize-1&&h[o].priority-h[o+1].priority<0&&++o,s-(a=h[o]).priority<0);)(h[l]=a).position=l,l=u.position=o,o<<=1;(h[l]=u).position=l;r=(l=this.mSize)>>1,s=(u=(h=this.mData)[l]).priority;if(this.mInverse)for(;0<r;){if(!(s-(c=h[r]).priority<0))break;(h[l]=c).position=l,l=r,r>>=1}else for(;0<r;){if(!(0<s-(c=h[r]).priority))break;(h[l]=c).position=l,l=r,r>>=1}(h[l]=u).position=l}else if(i<e){r=(l=n)>>1,s=(u=(h=this.mData)[l]).priority;if(this.mInverse)for(;0<r;){if(!(s-(c=h[r]).priority<0))break;(h[l]=c).position=l,l=r,r>>=1}else for(;0<r;){if(!(0<s-(c=h[r]).priority))break;(h[l]=c).position=l,l=r,r>>=1}(h[l]=u).position=l}else{var a;o=(l=n)<<1,s=(u=(h=this.mData)[l]).priority;if(this.mInverse)for(;o<this.mSize&&(o<this.mSize-1&&0<h[o].priority-h[o+1].priority&&++o,0<s-(a=h[o]).priority);)(h[l]=a).position=l,l=u.position=o,o<<=1;else for(;o<this.mSize&&(o<this.mSize-1&&h[o].priority-h[o+1].priority<0&&++o,s-(a=h[o]).priority<0);)(h[l]=a).position=l,l=u.position=o,o<<=1;(h[l]=u).position=l;var l,h,u;r=(l=this.mSize)>>1,s=(u=(h=this.mData)[l]).priority;if(this.mInverse)for(;0<r;){if(!(s-(c=h[r]).priority<0))break;(h[l]=c).position=l,l=r,r>>=1}else for(;0<r;){var c;if(!(0<s-(c=h[r]).priority))break;(h[l]=c).position=l,l=r,r>>=1}(h[l]=u).position=l}return this},repair:function(){for(var t=this.mSize>>1;1<=t;)this.heapify(t,this.mSize),--t},heapify:function(t,e){var i,n,r,s=this.mData,o=t<<1,a=1+o,l=t;this.mInverse?(o<=e&&s[o].priority-s[l].priority<0&&(l=o),1+o<=e&&s[1+o].priority-s[l].priority<0&&(l=a)):(o<=e&&0<s[o].priority-s[l].priority&&(l=o),1+o<=e&&0<s[1+o].priority-s[l].priority&&(l=a)),l!=t&&(i=s[l],n=s[t],s[l]=n,r=(s[t]=i).position,i.position=n.position,n.position=r,this.heapify(l,e))},grow:function(){this.capacity=Ra.compute(this.growthRate,this.capacity),this.resizeContainer(this.capacity)},resizeContainer:function(t){var e=new Array(t+1);Oa.blit(this.mData,0,e,0,this.mSize+1),this.mData=e},__class__:Ba};var Ra=function(){};(q["polygonal.ds.tools.GrowthRate"]=Ra).__name__="polygonal.ds.tools.GrowthRate",Ra.compute=function(t,e){if(0<t)e+=t;else switch(t){case-3:e<<=1;break;case-2:e=1+(3*e>>1);break;case-1:var i=e+1;e=(i>>3)+(i<9?3:6),e+=i;break;case 0:throw Co.thrown("out of space")}return e};var Oa=function(){};(q["polygonal.ds.tools.NativeArrayTools"]=Oa).__name__="polygonal.ds.tools.NativeArrayTools",Oa.blit=function(t,e,i,n,r){if(0<r)if(t==i){if(e<n)for(var s=e+r,o=n+r,a=0,l=r;a<l;){a++;--s,t[--o]=t[s]}else if(n<e)for(s=e,o=n,a=0,l=r;a<l;){a++;t[o]=t[s],++s,++o}}else if(0==e&&0==n)for(a=0,l=r;a<l;){i[s=a++]=t[s]}else if(0==e)for(a=0,l=r;a<l;){i[n+(s=a++)]=t[s]}else if(0==n)for(a=0,l=r;a<l;){i[s=a++]=t[e+s]}else for(a=0,l=r;a<l;){i[n+(s=a++)]=t[e+s]}},Oa.nullify=function(t,e,i){null==i&&(i=0),null==e&&(e=0);for(var n=e,r=i<=0?t.length:n+i;n<r;)t[n++]=null;return t};var ka=function(){};(q["pooling.Int32ArrayPool"]=ka).__name__="pooling.Int32ArrayPool",ka.returnToPool=function(t){t.length<20&&ka.pool[t.length].length<1e4&&ka.pool[t.length].push(t)};function Da(t){this.subCityMachine=[],this.subCitySentPeople=[],this.subCitySentResources=[],this.subCityPops=[],this.subCityNames=[],this.city=t}var Fa={create:function(t,e){if(null==Fa.pool.h[e.__id__]){Fa.pool.set(e,[])}var i;0==Fa.pool.h[e.__id__].length?(i=new PIXI.Sprite,e.addChild(i)):i=Fa.pool.h[e.__id__].pop();return i.texture=t,i.visible=!0,i}};(q["progress.AllConnectedCitiesInfo"]=Da).__name__="progress.AllConnectedCitiesInfo",Da.prototype={get_thisCityIndex:function(){return this.city.cityFile==this.city.cityMainFile?0:this.city.subCities.indexOf(at.substr(this.city.cityFile,this.city.cityMainFile.length+1,null))+1},update:function(){for(var e=this;this.subCitySentPeople.length<this.city.subCities.length+1;)this.subCityNames.push(""),this.subCityPops.push(0),this.subCitySentResources.push(new Vo),this.subCitySentPeople.push("");for(;this.subCityMachine.length<this.city.subCities.length+1;)this.subCityMachine.push(!1);var t=this.get_thisCityIndex(),i=lt.find(dt.allStoriesInfo,function(t){return t.link==e.city.progress.story.storyName});""==this.city.cityName||null==this.city.cityName?this.subCityNames[t]=null!=i?i.name:Tr.lo("stories.json/"+this.city.progress.story.storyName+".name"):this.subCityNames[t]=this.city.cityName,this.subCityPops[t]=this.city.simulation.citizens.length,this.subCityMachine[t]=1<=this.city.getAmountOfPermanentsPerType().h["buildings.TheMachine"]},doTransfer:function(){var t=this.subCitySentResources[this.get_thisCityIndex()];if(null!=t){if(null!=t.h.food&&0<=t.h.food)(e=this.city.materials).set_food(e.food+t.h.food);null!=t.h.wood&&0<=t.h.wood&&(this.city.materials.wood+=t.h.wood),null!=t.h.stone&&0<=t.h.stone&&(this.city.materials.stone+=t.h.stone),null!=t.h.machineParts&&0<=t.h.machineParts&&(this.city.materials.machineParts+=t.h.machineParts),null!=t.h.refinedMetal&&0<=t.h.refinedMetal&&(this.city.materials.refinedMetal+=t.h.refinedMetal),null!=t.h.computerChips&&0<=t.h.computerChips&&(this.city.materials.computerChips+=t.h.computerChips),null!=t.h.cacao&&0<=t.h.cacao&&(this.city.materials.cacao+=t.h.cacao),null!=t.h.chocolate&&0<=t.h.chocolate&&(this.city.materials.chocolate+=t.h.chocolate),null!=t.h.graphene&&0<=t.h.graphene&&(this.city.materials.graphene+=t.h.graphene),null!=t.h.rocketFuel&&0<=t.h.rocketFuel&&(this.city.materials.rocketFuel+=t.h.rocketFuel);for(var e=0,i=ct.modMaterials;e<i.length;){var n=i[e];++e;var r=n.variableName;null!=t.h[r]&&0<=t.h[r]&&(this.city.materials[r]+=t.h[r])}null!=t.h.knowledge&&0<=t.h.knowledge&&(this.city.materials.knowledge+=t.h.knowledge),this.subCitySentResources[this.get_thisCityIndex()]=new Vo}var s=this.subCitySentPeople[this.get_thisCityIndex()];if(null!=s){var o=s.split(";");o.pop();var a=null,l=new jo;for(e=0,i=this.city.simulation.citizens;e<i.length;){var h=i[e];++e,null!=l.h[h.onWorld.__id__]&&l.set(h.onWorld,!0)}a=gr.whereMin(this.city.worlds,function(t){return null!=l.h.__keys__[t.__id__]},function(t){return t.rect.y+1e-5*t.rect.x}),0<this.city.simulation.citizens.length&&(a=this.city.simulation.citizens[0].onWorld);for(e=0;e<o.length;){var u=o[e];++e;var c=u.split(","),d=this.city.simulation.createCitizen(a,parseFloat(c[0]),null,il.getInt(a.rect.width-2));d.spriteIndex=Y.parseInt(c[1]),d.educationLevel=parseFloat(c[2]),d.dieAgeModifier=parseFloat(c[3]);var p=d.educationLevel;isNaN(p)&&(d.educationLevel=0,console.log("FloatingSpaceCities/progress/AllConnectedCitiesInfo.hx:91:","education was NaN!"));var f=d.dieAgeModifier;isNaN(f)&&(d.dieAgeModifier=0),d.updateSpriteAndNameIndexInfo(),K.shouldUpdateDraw=!0}this.subCitySentPeople[this.get_thisCityIndex()]=""}},save:function(t,e){null==e&&(e=!0),e&&t.addString(Da.saveDefinition),t.addString(Bo.run(this.subCityNames)),t.addString(Bo.run(this.subCityPops)),t.addString(Bo.run(this.subCitySentResources)),t.addString(Bo.run(this.subCitySentPeople)),t.addString(Bo.run(this.subCityMachine))},load:function(t,e){null==e&&(e=t.readString());var i=Dr.makeLoadMap(e,t);Object.prototype.hasOwnProperty.call(i.h,"subCityNames")&&(this.subCityNames=i.h.subCityNames),Object.prototype.hasOwnProperty.call(i.h,"subCityPops")&&(this.subCityPops=i.h.subCityPops),Object.prototype.hasOwnProperty.call(i.h,"subCitySentResources")&&(this.subCitySentResources=i.h.subCitySentResources),Object.prototype.hasOwnProperty.call(i.h,"subCitySentPeople")&&(this.subCitySentPeople=i.h.subCitySentPeople),Object.prototype.hasOwnProperty.call(i.h,"subCityMachine")&&(this.subCityMachine=i.h.subCityMachine)},__class__:Da};function Na(t){this.city=t}(q["progress.BuildingCost"]=Na).__name__="progress.BuildingCost",Na.prototype={getBuildingCost:function(t){return"NormalHouse"!=t.className||"theLostShip"!=this.city.progress.story.storyName||null==this.city.progress.story.currentGoal||"BuildIndoorFarmAndHouse"!=this.city.progress.story.currentGoal.name||null!=this.city.getAmountOfPermanentsPerType().h["buildings.NormalHouse"]&&0!=this.city.getAmountOfPermanentsPerType().h["buildings.NormalHouse"]?L.fromBuildingInfo(t):new L(2,2)},getBuildingCostDescriptionAdder:function(t){return"NormalHouse"!=t.className||"theLostShip"!=this.city.progress.story.storyName||null==this.city.progress.story.currentGoal||"BuildIndoorFarmAndHouse"!=this.city.progress.story.currentGoal.name||null!=this.city.getAmountOfPermanentsPerType().h["buildings.NormalHouse"]&&0!=this.city.getAmountOfPermanentsPerType().h["buildings.NormalHouse"]?"":" "+Tr.lo("first_house_cheaper")},__class__:Na};function La(t){(this.city=t).enableDisplayOnly(),this.spaceShipSprite=new PIXI.Sprite(dt.getTexture("spr_explorationship"))}(q["progress.CityIntro"]=La).__name__="progress.CityIntro",La.prototype={update:function(t){this.city.gui.stage.visible=!1,this.city.gui.windowStage.visible=!1,null!=this.spaceShipSprite&&null==this.spaceShipSprite.parent&&(this.city.cityMidStage.addChild(this.spaceShipSprite),this.spaceShipSprite.position.set(this.city.viewPos.x,this.city.viewPos.y))},handleMouse:function(t){return this.spaceShipSprite.x=t.cityPosition.x,t.pressed&&(this.city.disableDisplayOnlyMode(null),this.city.gui.stage.visible=!0,this.city.gui.windowStage.visible=!0,this.city.progress.cityIntro=null),!0},__class__:La};function Ua(){dt.initializeCityResources(this)}(q["progress.CityResources"]=Ua).__name__="progress.CityResources",Ua.prototype={__class__:Ua};var za=function(t,e){this.shownPopLimitHint=!1,this.shownCtrlToHighlightHint=!1,this.city=t,this.storyName=e,this.goalHelp=new Ga(t),this.sandbox=new Xa(t),this.buildingCost=new Na(t),this.allCitiesInfo=new Da(t),this.sideQuests=new Ya(t)};(q["progress.GameProgress"]=za).__name__="progress.GameProgress",za.prototype={init:function(){this.resources=new Ua,this.unlocks=new Qa(this.city),this.story=new qa(this.city,this.storyName)},handleMouse:function(t){return null!=this.cityIntro&&this.cityIntro.handleMouse(t)},update:function(t){this.story.update(t),this.unlocks.update(t),this.sandbox.update(t),this.sideQuests.update(t),this.allCitiesInfo.update(),null!=this.cityIntro&&this.cityIntro.update(t),this.city.simulation.babyMaker.softPopLimit!=this.city.simulation.citizens.length||3e3!=this.city.simulation.babyMaker.softPopLimit||null!=this.city.gui.window||this.shownPopLimitHint||(this.shownPopLimitHint=!0,this.city.gui.showSimpleWindow(Tr.lo("change_pop_limit"),Tr.lo("pop_limit_reached")))},save:function(t){this.story.save(t),this.unlocks.save(t);var e=this.shownCtrlToHighlightHint?1:0;if(t.size+1>t.bytes.length){var i=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+1))),t.bytes.blit(0,i,0,t.size)}t.bytes.b[t.size]=e,t.size+=1,this.sandbox.save(t);e=this.shownPopLimitHint;if(t.size+1>t.bytes.length){i=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+1))),t.bytes.blit(0,i,0,t.size)}t.bytes.b[t.size]=e?1:0,t.size+=1,this.allCitiesInfo.save(t)},load:function(t){if(this.story.load(t),this.unlocks.load(t),13<=t.version){var e=t.bytes.b[t.readStart];t.readStart+=1,this.shownCtrlToHighlightHint=1==e}if(25<=t.version&&this.sandbox.load(t),40<=t.version){e=t.bytes.b[t.readStart];t.readStart+=1,this.shownPopLimitHint=0<e}53<=t.version&&this.allCitiesInfo.load(t)},resetCtrlToHightlightHint:function(){100<=this.city.simulation.citizens.length&&(this.shownCtrlToHighlightHint=!0)},__class__:za};function Wa(){}(q["progress.GenerateWorld"]=Wa).__name__="progress.GenerateWorld",Wa.doGenerate=function(t,e,i,n,r,s,o){"RandomMiniWorlds"==t&&el.doGenerate(e,i,n,r,s,o)};var Ga=function(t){this.neverUpdatedBuildingGoal=!0,this.knowsHasBuildingGoalHelp=!1,this.city=t};(q["progress.GoalHelp"]=Ga).__name__="progress.GoalHelp",Ga.prototype={getCurrentGoalHelp:function(){var t=[];null!=this.city.progress.story&&null!=this.city.progress.story.currentGoal&&""!=this.city.progress.story.currentGoal.quickText&&t.push({category:Tr.lo("main_goal"),text:this.city.progress.story.currentGoal.quickText});for(var e=this.getCurrentBuildingGoalHelp(),i=0;i<e.length;){var n=e[i];++i,t.push(n)}i=0;for(var r=this.city.progress.sideQuests.sidequests;i<r.length;){var s=r[i];++i;var o=s.getGoalHelp();null!=o&&t.push(o)}return t},getCurrentBuildingGoalHelp:function(){for(var t=[],e=0,i=this.city.permanents;e<i.length;){var n=i[e];if(++e,n.is(_)){var r=n.getGlobalGoal();null!=r&&t.push(r)}}return t},updateHasBuildingGoal:function(){this.knowsHasBuildingGoalHelp=0<this.getCurrentBuildingGoalHelp().length},hasCurrentGoalHelp:function(){if(null!=this.city.progress.story&&null!=this.city.progress.story.currentGoal&&""!=this.city.progress.story.currentGoal.quickText)return!0;for(var t=0,e=this.city.progress.sideQuests.sidequests;t<e.length;){var i=e[t];if(++t,null!=i.getGoalHelp())return!0}return this.neverUpdatedBuildingGoal&&(this.updateHasBuildingGoal(),this.neverUpdatedBuildingGoal=!1),this.knowsHasBuildingGoalHelp},__class__:Ga};var Ha=function(i){this.unlockedAll=!1;var n=this;Rr.getItem("progressFile",function(t,e){n.scenarioTimes=null==t&&null!=e?e:new Vo,i()}),Rr.getItem("unlockedAllScenarios",function(t,e){null==t&&null!=e&&(n.unlockedAll=e)})};(q["progress.MetaGame"]=Ha).__name__="progress.MetaGame",Ha.prototype={unlockAll:function(){this.unlockedAll=!0,Rr.setItem("unlockedAllScenarios",!0,function(){})},winScenario:function(t,e){(!Object.prototype.hasOwnProperty.call(this.scenarioTimes.h,t)||this.scenarioTimes.h[t]>e)&&(this.scenarioTimes.h[t]=e,this.saveProgress())},getScenarioTime:function(t){return Object.prototype.hasOwnProperty.call(this.scenarioTimes.h,t)?this.scenarioTimes.h[t]:null},hasWonScenario:function(t){return Object.prototype.hasOwnProperty.call(this.scenarioTimes.h,t)},saveProgress:function(){Rr.setItem("progressFile",this.scenarioTimes,function(){})},__class__:Ha};var Xa=function(t){this.everPlayedWithUnlimitedResources=!1,this.unlimitedResources=!1,this.city=t,g.isLoading||dr.setEnabled(!0)};(q["progress.SandboxHelper"]=Xa).__name__="progress.SandboxHelper",Xa.prototype={postLoad:function(){dr.setEnabled(!this.everPlayedWithUnlimitedResources)},update:function(t){if(this.unlimitedResources){this.city.materials.food<1e7&&this.city.materials.set_food(1e7),this.city.materials.wood<1e7&&(this.city.materials.wood=1e7),this.city.materials.stone<1e7&&(this.city.materials.stone=1e7),this.city.materials.machineParts<1e7&&(this.city.materials.machineParts=1e7),this.city.materials.refinedMetal<1e7&&(this.city.materials.refinedMetal=1e7),this.city.materials.computerChips<1e7&&(this.city.materials.computerChips=1e7),this.city.materials.cacao,this.city.materials.chocolate,this.city.materials.graphene<1e7&&(this.city.materials.graphene=1e7),this.city.materials.rocketFuel<1e7&&(this.city.materials.rocketFuel=1e7);for(var e=0,i=ct.modMaterials;e<i.length;){var n=i[e];++e;var r=n.variableName;this.city.materials[r]<1e7&&"cacao"!=r&&"chocolate"!=r&&(this.city.materials[r]=1e7)}this.city.materials.knowledge<1e7&&(this.city.materials.knowledge=1e7)}},enableUnlimitedResources:function(){if(!this.unlimitedResources){this.unlimitedResources=!0,this.everPlayedWithUnlimitedResources=!0,dr.setEnabled(!1),(t=this.city.materials).set_food(t.food+1e7),this.city.materials.wood+=1e7,this.city.materials.stone+=1e7,this.city.materials.machineParts+=1e7,this.city.materials.refinedMetal+=1e7,this.city.materials.computerChips+=1e7,this.city.materials.graphene+=1e7,this.city.materials.rocketFuel+=1e7;for(var t=0,e=ct.modMaterials;t<e.length;){var i=e[t];++t;var n=i.variableName;"cacao"!=n&&"chocolate"!=n&&(this.city.materials[n]+=1e7)}this.city.materials.knowledge+=1e7}},disableUnlimitedResources:function(){if(this.unlimitedResources){this.unlimitedResources=!1,(t=this.city.materials).set_food(t.food-1e7),this.city.materials.food<0&&this.city.materials.set_food(0),this.city.materials.wood-=1e7,this.city.materials.wood<0&&(this.city.materials.wood=0),this.city.materials.stone-=1e7,this.city.materials.stone<0&&(this.city.materials.stone=0),this.city.materials.machineParts-=1e7,this.city.materials.machineParts<0&&(this.city.materials.machineParts=0),this.city.materials.refinedMetal-=1e7,this.city.materials.refinedMetal<0&&(this.city.materials.refinedMetal=0),this.city.materials.computerChips-=1e7,this.city.materials.computerChips<0&&(this.city.materials.computerChips=0),this.city.materials.graphene-=1e7,this.city.materials.graphene<0&&(this.city.materials.graphene=0),this.city.materials.rocketFuel-=1e7,this.city.materials.rocketFuel<0&&(this.city.materials.rocketFuel=0);for(var t=0,e=ct.modMaterials;t<e.length;){var i=e[t];++t;var n=i.variableName;"cacao"!=n&&"chocolate"!=n&&(this.city.materials[n]-=1e7,this.city.materials[n]<0&&(this.city.materials[n]=0))}this.city.materials.knowledge-=1e7,this.city.materials.knowledge<0&&(this.city.materials.knowledge=0)}},save:function(t,e){null==e&&(e=!0),e&&t.addString(Xa.saveDefinition);var i=this.unlimitedResources;if(t.size+1>t.bytes.length){var n=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+1))),t.bytes.blit(0,n,0,t.size)}t.bytes.b[t.size]=i?1:0,t.size+=1;i=this.everPlayedWithUnlimitedResources;if(t.size+1>t.bytes.length){n=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+1))),t.bytes.blit(0,n,0,t.size)}t.bytes.b[t.size]=i?1:0,t.size+=1},load:function(t,e){null==e&&(e=t.readString());var i=Dr.makeLoadMap(e,t);Object.prototype.hasOwnProperty.call(i.h,"unlimitedResources")&&(this.unlimitedResources=i.h.unlimitedResources),Object.prototype.hasOwnProperty.call(i.h,"everPlayedWithUnlimitedResources")&&(this.everPlayedWithUnlimitedResources=i.h.everPlayedWithUnlimitedResources),this.postLoad()},__class__:Xa};function ja(t,e){this.city=t,this.simulation=t.simulation,this.story=e}(q["progress.ScriptedStoryPart"]=ja).__name__="progress.ScriptedStoryPart",ja.prototype={update:function(t){},initialize:function(t){},save:function(t,e){null==e&&(e=!0),e&&t.addString(ja.saveDefinition)},load:function(t,e){null==e&&(e=t.readString());Dr.makeLoadMap(e,t)},__class__:ja};function Va(t,e){this.city=t,this.simulation=t.simulation,this.sideQuests=e;var i=Ko.getClass(this);this.className=i.__name__}(q["progress.Sidequest"]=Va).__name__="progress.Sidequest",Va.prototype={get_isInstant:function(){return!1},start:function(){},onComplete:function(){},update:function(t){},getGoalHelp:function(){return null},canStart:function(){return!1},__class__:Va};var Ya=function(t){this.minimumTimeBetweenSidequests=1,this.canStartNewSidequestAt=0,this.city=t,this.sidequests=[],this.possibleSidequests=[],this.completedSidequests=[]};(q["progress.SidequestManager"]=Ya).__name__="progress.SidequestManager",Ya.prototype={update:function(t){if(this.canStartSidequest()){var e=il.fromArray(this.possibleSidequests);e.canStart()&&(e.start(),e.get_isInstant()?this.completedSidequests.push(e.className):this.sidequests.push(e),at.remove(this.possibleSidequests,e))}for(var i=this.sidequests.length;0<=--i;)this.sidequests[i].update(t)},showSidequestDialog:function(t,e){this.city.gui.removeNotifyPanel(),this.city.gui.notifyInPanel(t,e,this)},showSidequestFinishedDialog:function(t,e){this.city.gui.currentNotificationRelatedTo==this&&this.city.gui.removeNotifyPanel(),this.city.gui.showSimpleWindow(e,t,!0)},completeSidequest:function(t){t.onComplete(),at.remove(this.sidequests,t),this.canStartNewSidequestAt=this.city.simulation.time.timeSinceStart/1440+this.minimumTimeBetweenSidequests,this.completedSidequests.push(t.className)},findSidequestWithType:function(e){return lt.find(this.sidequests,function(t){return t.className==e.__name__})},canStartSidequest:function(){return this.city.simulation.time.timeSinceStart/1440>=this.canStartNewSidequestAt&&(null==this.city.gui.window||this.city.gui.windowRelatedTo!=this.city.progress.story)&&0==this.sidequests.length&&0<this.possibleSidequests.length&&null==this.city.gui.notificationPanel},__class__:Ya};var qa=function(t,e){null==e&&(e="theLostShip"),this.goalTimer=0,this.justInvitedPeople=!1,this.hiddenBoost=!1,this.disableDestroy=!1,this.disableDying=!1,this.city=t,this.storyInfo=dt.storiesInfo.h[e],this.storyName=e,Tr.translateStory(this.storyName,this.storyInfo),this.plannings=[],this.scriptedParts=[]};(q["progress.Story"]=qa).__name__="progress.Story",qa.prototype={get_speedUpStartNights:function(){return null!=this.storyInfo.speedUpStartNights&&this.storyInfo.speedUpStartNights},start:function(){if(this.city.materials.add(L.fromStoryMaterials(this.storyInfo.initialMaterials)),null!=this.storyInfo.lockPermanents)for(var t=0,e=this.storyInfo.lockPermanents;t<e.length;){var i=e[t];++t,this.city.progress.unlocks.lock(q["buildings."+i])}if(1==this.storyInfo.lockAllPermanents){this.city.progress.unlocks.unlockedDecorationTab=!1,this.city.progress.unlocks.unlockedBuildingModeButton=!1,this.city.progress.unlocks.unlockedManagementOptions=!1;for(t=0,e=this.city.progress.resources.buildingInfoArray;t<e.length;){i=e[t];++t;var n="buildings."+i.className;this.city.progress.unlocks.lock(q[n])}}""!=this.storyInfo.startGoal&&this.startGoal(this.findGoal(this.storyInfo.startGoal)),null!=this.storyInfo.viewYFromBottom&&(this.city.fixViewBottom(this.city.game.isMobile&&null!=this.storyInfo.viewYMobi?this.storyInfo.viewYMobi:this.storyInfo.viewYFromBottom),this.city.resize(),this.city.fixViewBottom(null)),this.city.game.isMobile&&null!=this.storyInfo.mobileViewStartX&&(this.city.viewPos.x=this.storyInfo.mobileViewStartX,this.city.resize()),null!=this.storyInfo.viewStartX&&(this.city.viewPos.x=this.storyInfo.viewStartX,this.city.resize()),"cityofthekey"==this.storyName&&this.city.simulation.happiness.createGloryOfTheKey()},update:function(t){this.city.displayOnly&&null!=this.storyInfo.viewYFromBottom&&(this.city.fixViewBottom(this.city.game.isMobile&&null!=this.storyInfo.viewYMobi?this.storyInfo.viewYMobi:this.storyInfo.viewYFromBottom),this.city.resize(),this.city.fixViewBottom(null)),null!=this.currentGoal&&this.city.gui.windowRelatedTo!=this&&this.goalComplete(this.currentGoal)&&(S.sendEvent("story","goal_complete",null,this.storyName+"-"+this.currentGoal.name),S.sendEventFirebase("goal_complete","goal",this.storyName+"-"+this.currentGoal.name),this.currentGoal.name,this.storyInfo.startGoal,""!=this.currentGoal.nextGoal?this.startGoal(this.findGoal(this.currentGoal.nextGoal)):this.currentGoal=null),this.updatePlannings();for(var e=this.scriptedParts.length;0<=--e;)this.scriptedParts[e].update(t);this.goalTimer+=t},updatePlannings:function(){for(var t=this.plannings.length;0<=--t;){var e=this.plannings[t];if(e.plan.length>e.nextEventToHandle){var i=e.plan[e.nextEventToHandle];e.timeStart+i.time<this.city.simulation.time.timeSinceStart/60&&(this.executePlannedEvent(i),e.nextEventToHandle+=1)}e.plan.length<=e.nextEventToHandle&&this.plannings.splice(t,1)}},executePlannedEvent:function(t){switch(t.type){case"BuildBridgeFeather":var e=lt.find(dt.bridgesInfo,function(t){return"WoodenBridge"==t.className}),i="miscCityElements."+e.className,n=k.createInstance(q[i],[this.city,new vr(-20,120)]);n.cycleSprite(),this.city.miscCityElements.addElement(n),this.city.connections.updateCityConnections(),this.city.simulation.updatePathfinder(!0);i="miscCityElements."+e.className;this.city.progress.unlocks.research(q[i]);break;case"FreeAutoUpgradeForFarms":for(var r=gt,s=$t,o=[],a=0,l=this.city.permanents;a<l.length;){var h=l[a];++a,h.is(fi)&&0<h.getEffectsOfAdjecentBuildings("farm")&&!gr.any(h.upgrades,function(t){return Ko.__instanceof(t,r)})&&o.push(h)}var u=o;for(o=[],a=0,l=this.city.permanents;a<l.length;){h=l[a];++a,h.is(fi)&&(null!=h.leftBuilding&&h.leftBuilding.is(vn)||null!=h.rightBuilding&&h.rightBuilding.is(vn)||null!=h.topBuilding&&h.topBuilding.is(vn)||null!=h.bottomBuilding&&h.bottomBuilding.is(vn))&&!gr.any(h.upgrades,function(t){return Ko.__instanceof(t,s)})&&o.push(h)}var c=o;for(o=0;o<u.length;){var d=u[o];++o,d.upgrades.push(k.createInstance(r,[d.stage,this.city.cityMidStage,d.bgStage,d]))}for(o=0;o<c.length;){d=c[o];++o,d.upgrades.push(k.createInstance(s,[d.stage,this.city.cityMidStage,d.bgStage,d]))}break;case"ScriptedStoryPart":var p=t,f=(i="progress.scriptedStoryParts."+p.className,k.createInstance(q[i],[this.city,this]));f.initialize(p),this.scriptedParts.push(f);break;case"SpawnCitizens":var g=t;this.spawnCitizens(this.city.worlds[g.world],g);break;case"SpawnCitizensFlyingSaucer":g=t;this.city.simulation.citizenSpawners.push(new kl(this.city.simulation,this.city.farForegroundStage,this.city.worlds[g.world],g,g.toXIndex))}},getDesiredGoalHighlights:function(){if(null==this.currentGoal)return[];for(var t=[],e=0,i=this.currentGoal.subGoals;e<i.length;){var n=i[e];if(++e,!this.subGoalComplete(n))switch(n.type){case"BuildPermanents":var r=n.permanentToBuildClass;C.startsWith(r,"buildings.")||C.startsWith(r,"worldResources.")||(r="buildings."+r),t.push(q[r]);break;case"PerformBuildingUpgrades":var s=n.upgradeClass;C.startsWith(s,"buildingUpgrades.")||(s="buildingUpgrades."+s),t.push(q[s]);break;case"PerformCityUpgrade":var o=n.upgradeClass;C.startsWith(o,"cityUpgrades.")||(o="cityUpgrades."+o),t.push(q[o])}}return t},goalComplete:function(t){for(var e=!0,i=0,n=t.subGoals;i<n.length;){var r=n[i];++i,this.subGoalComplete(r)||(e=!1)}return e},subGoalComplete:function(t){switch(t.type){case"Build3Bridges":return 3<=lt.count(this.city.miscCityElements.allMiscElements,function(t){return t.is(Qo)});case"BuildFloatingPlatform":return 1<=lt.count(this.city.miscCityElements.allMiscElements,function(t){return t.is(Zo)});case"BuildPermanents":var e=t,i=e.permanentToBuildClass;C.startsWith(i,"buildings.")||C.startsWith(i,"worldResources.")||(i="buildings."+i);var n=null!=e.needsExactClass&&e.needsExactClass?function(t){return Ko.getClass(t).__name__==i}:function(t){return t.is(q[i])};if(null!=e.onWorld){var r=this.city.worlds[e.onWorld],s=n;n=function(t){return!!s(t)&&t.world==r}}else if(null!=e.notOnWorld){var o=this.city.worlds[e.notOnWorld],a=n;n=function(t){return!!a(t)&&t.world!=o}}return lt.count(this.city.permanents,n)>=e.amount;case"BuildRocket":return!1;case"CompleteHackerMissions":for(var l=t,h=0,u=this.city.permanents;h<u.length;){var c=u[h];if(++h,c.is(oi))return c.currentMission>=l.amount}return!1;case"ExploreAlienRuins":for(h=0,u=this.city.worlds;h<u.length;){var d=u[h];++h;for(var p=0,f=d.permanents;p<f.length;){c=f[p];if(++p,1<=c.length&&null!=c[0]&&c[0].is(Bh))return 99.99<=c[0].explored}}return!1;case"ExploredWithResearchSpacecraft":for(h=0,u=this.city.permanents;h<u.length;){c=u[h];if(++h,c.is(zi))return 540<=c.timeWorking}return!1;case"GatherMaterials":var g=t;if(null!=g.materials.food&&this.city.materials.food<g.materials.food)return!1;if(null!=g.materials.wood&&this.city.materials.wood<g.materials.wood)return!1;if(null!=g.materials.stone&&this.city.materials.stone<g.materials.stone)return!1;if(null!=g.materials.machineParts&&this.city.materials.machineParts<g.materials.machineParts)return!1;if(null!=g.materials.refinedMetal&&this.city.materials.refinedMetal<g.materials.refinedMetal)return!1;if(null!=g.materials.computerChips&&this.city.materials.computerChips<g.materials.computerChips)return!1;if(null!=g.materials.cacao&&this.city.materials.cacao<g.materials.cacao)return!1;if(null!=g.materials.chocolate&&this.city.materials.chocolate<g.materials.chocolate)return!1;if(null!=g.materials.graphene&&this.city.materials.graphene<g.materials.graphene)return!1;if(null!=g.materials.rocketFuel&&this.city.materials.rocketFuel<g.materials.rocketFuel)return!1;for(h=0,u=ct.modMaterials;h<u.length;){var m=u[h];++h;var y=m.variableName;if(null!=g.materials[y]&&this.city.materials[y]<g.materials[y])return!1}return!(null!=g.materials.knowledge&&this.city.materials.knowledge<g.materials.knowledge);case"GloryGoal":return null!=this.city.simulation.happiness.gloryOfTheKey&&99.99<=this.city.simulation.happiness.gloryOfTheKey.gloryOfTheKeyHappiness;case"HousingCapacity":var _=t;return this.city.simulation.stats.houseCapacity>=_.amount;case"InvitePeople":return this.justInvitedPeople;case"MinimumCitizens":var v=t;return this.city.simulation.citizens.length>=v.number;case"MinimumHappiness":var b=t;return this.city.simulation.happiness.happiness>=b.happiness;case"PerformBuildingUpgrades":var w=t,S=w.upgradeClass;C.startsWith(S,"buildingUpgrades.")||(S="buildingUpgrades."+S);var x=q[S];return lt.count(this.city.permanents,function(t){return!!t.isBuilding&&gr.any(t.upgrades,function(t){return Ko.__instanceof(t,x)})})>=w.amount;case"PerformCityUpgrade":S=t.upgradeClass;C.startsWith(S,"cityUpgrades.")||(S="cityUpgrades."+S);var T=q[S];return 1<=lt.count(this.city.upgrades.upgrades,function(t){return Ko.__instanceof(t,T)});case"ProductionGoal":var I=t;if(null!=I.materials.food&&!gr.any(this.city.simulation.stats.materialProduction[ct.findMaterialIndex("food")],function(t){return t>=I.materials.food}))return!1;if(null!=I.materials.wood&&!gr.any(this.city.simulation.stats.materialProduction[ct.findMaterialIndex("wood")],function(t){return t>=I.materials.wood}))return!1;if(null!=I.materials.stone&&!gr.any(this.city.simulation.stats.materialProduction[ct.findMaterialIndex("stone")],function(t){return t>=I.materials.stone}))return!1;if(null!=I.materials.machineParts&&!gr.any(this.city.simulation.stats.materialProduction[ct.findMaterialIndex("machineParts")],function(t){return t>=I.materials.machineParts}))return!1;if(null!=I.materials.refinedMetal&&!gr.any(this.city.simulation.stats.materialProduction[ct.findMaterialIndex("refinedMetal")],function(t){return t>=I.materials.refinedMetal}))return!1;if(null!=I.materials.computerChips&&!gr.any(this.city.simulation.stats.materialProduction[ct.findMaterialIndex("computerChips")],function(t){return t>=I.materials.computerChips}))return!1;if(null!=I.materials.cacao&&!gr.any(this.city.simulation.stats.materialProduction[ct.findMaterialIndex("cacao")],function(t){return t>=I.materials.cacao}))return!1;if(null!=I.materials.chocolate&&!gr.any(this.city.simulation.stats.materialProduction[ct.findMaterialIndex("chocolate")],function(t){return t>=I.materials.chocolate}))return!1;if(null!=I.materials.graphene&&!gr.any(this.city.simulation.stats.materialProduction[ct.findMaterialIndex("graphene")],function(t){return t>=I.materials.graphene}))return!1;if(null!=I.materials.rocketFuel&&!gr.any(this.city.simulation.stats.materialProduction[ct.findMaterialIndex("rocketFuel")],function(t){return t>=I.materials.rocketFuel}))return!1;for(h=0,u=ct.modMaterials;h<u.length;){m=u[h];++h;y=[m.variableName];if(null!=I.materials[y[0]]&&!gr.any(this.city.simulation.stats.materialProduction[ct.findMaterialIndex(y[0])],function(e){return function(t){return t>=I.materials[e[0]]}}(y)))return!1}return!(null!=I.materials.knowledge&&!gr.any(this.city.simulation.stats.materialProduction[ct.findMaterialIndex("knowledge")],function(t){return t>=I.materials.knowledge}));case"Wait":var P=t;return this.goalTimer>P.waitTime;case"WaitForDecryption":for(h=0,u=this.city.permanents;h<u.length;){c=u[h];if(++h,c.is(te))return 1440<=c.timeWorking}return!1}return!1},findGoal:function(e){return lt.find(this.storyInfo.goals,function(t){return t.name==e})},startGoal:function(a){function t(){if(l.currentGoal=a,l.goalTimer=0,null!=a.flags&&l.handleFlagsChanges(a.flags),"Win"==a.name&&l.city.game.metaGame.winScenario(l.storyName,0|l.city.simulation.time.timeSinceStart),"NowArrivingRegularly"==a.name){var t=Uh(l,l.showGoalText);l.city.gui.triggerPremiumUpsellExperienceIfDesired("mid_first_scenario",function(){t()})}else""==a.text&&""==a.title||l.showGoalText();if(null!=a.unlocks)for(var e=0,i=a.unlocks;e<i.length;){var n=i[e];if(++e,"decorations"==n)l.city.progress.unlocks.unlockedDecorationTab=!0;else if("buildingModes"==n)l.city.progress.unlocks.unlockedBuildingModeButton=!0;else if("managementOptions"==n)l.city.progress.unlocks.unlockedManagementOptions=!0;else if(C.startsWith(n,"buildingUpgrades.")){var r="buildingUpgrades."+n.split(".")[1];l.city.progress.unlocks.unlock(q[r])}else if(C.startsWith(n,"worldResources.")){var s="worldResources."+n.split(".")[1];l.city.progress.unlocks.unlock(q[s])}else l.city.progress.unlocks.unlock(q["buildings."+n])}if(null!=a.researches)for(e=0,i=a.researches;e<i.length;){n=i[e];++e,l.city.progress.unlocks.research(q["buildings."+n],!1)}if(null!=a.planning&&l.plannings.push({goalName:a.name,plan:a.planning,nextEventToHandle:0,timeStart:l.city.simulation.time.timeSinceStart/60}),l.city.gui.clearTutorial(),(l.city.postCreateBuilder=null)!=a.showTutorial)if(1==a.showTutorial)l.city.gui.showTutorialArrows1(),l.city.postCreateBuilder=function(){l.city.builder.fixBuilder(l.city.worlds[0],2)};else if(2==a.showTutorial){var o=l.city.gui.showWindowCloseWarning(120);l.city.gui.showTutorialArrows2(o)}else if(101==a.showTutorial){o=l.city.gui.showWindowCloseWarning(120);l.city.gui.showTutorialArrowsBuildStoneMine(o)}else 3==a.showTutorial?l.city.gui.showTutorialArrows3():4==a.showTutorial?l.city.gui.showTutorialArrows4():4001==a.showTutorial?l.city.gui.showTutorialArrowsInviteCitizens():a.showTutorial}var l=this;t()},showGoalText:function(t){null==t&&(t=!1);var s=this,o=this.currentGoal;this.city.gui.createWindow(this),null!=o.title&&""!=o.title&&this.city.gui.windowAddTitleText(o.title);var e="",i=o.text;B.isLimitedDemo&&null!=o.flags&&null!=o.flags.demoText&&(i+=o.flags.demoText);for(var n=i.indexOf("["),r=!0,a=this.goalComplete(o);-1!=n;){r&&(e+=at.substr(i,0,n));var l=(i=at.substr(i,n+1,null)).indexOf("]"),h=at.substr(i,0,l);if(i=at.substr(i,l+1,null),"n"==h)r=!a;else if("c"==h)r=a;else if("mobi"==h)r=this.city.game.isMobile;else if("nonmobi"==h)r=!this.city.game.isMobile;else if("nmobi"==h)r=!a&&this.city.game.isMobile;else if("nnonmobi"==h)r=!a&&!this.city.game.isMobile;else if("/"==h)r=!0;else if("d"==h){var u=this.city.simulation.time;e+=(1+((0|u.timeSinceStart)/1440|0)==1?Tr.lo("one_day"):Tr.lo("n_days",[1+((0|u.timeSinceStart)/1440|0)]))+", "+(((0|u.timeSinceStart)/60|0)%24==1?Tr.lo("one_hour"):Tr.lo("n_hours",[((0|u.timeSinceStart)/60|0)%24]))+", "+Tr.lo("and")+" "+((0|u.timeSinceStart)%60==1?Tr.lo("one_minute"):Tr.lo("n_minutes",[(0|u.timeSinceStart)%60]))}n=i.indexOf("[")}r&&(e+=i),"Win"==o.name&&"hackersandaliens"==this.storyName&&(e+=" Get the Extended Version on Steam to unlock it!"),this.city.gui.windowAddInfoText(t?o.tldr:e),this.city.gui.pauseForWindow();var c=null!=o.tldr,d=[];if(c&&d.push({text:t?"Too short?":"tl;dr?",action:function(){s.showGoalText(!t)}}),"Win"==o.name){B.isLimitedDemo&&d.push({text:"Wishlist the Full Version Now!",action:function(){greenworks.activateGameOverlayToWebPage("https://store.steampowered.com/app/1180130/The_Final_Earth_2/")}});var p=!1;null!=o.nextStory&&""!=o.nextStory&&Ka.hasCompletedRequirements(this.city.game,lt.find(dt.allStoriesInfo,function(t){return t.link==o.nextStory}))?d.push({text:Tr.lo("next_scenario"),action:function(){p=!0,s.city.gui.triggerPremiumUpsellExperienceIfDesired("post_scenario",function(){var t=s.city.game,e=s.city.gui,i=Tr.lo("save_slot_choice"),n=Uh(N=s.city.game,N.newCity),r=o.nextStory;eo.createSaveWindow(t,e,i,function(t){n(r,t)})})}}):d.push({text:Tr.lo("new_city"),action:function(){p=!0,s.city.gui.triggerPremiumUpsellExperienceIfDesired("post_scenario",function(){Gs.createNewScenarioWindow(s.city.game,s.city.gui)})}}),this.city.gui.windowOnDestroy=function(){"Win"!=o.name||p||s.city.gui.triggerPremiumUpsellExperienceIfDesired("post_scenario")}}var f=this.city.gui.windowAddBottomButtons(d,null,function(){s.city.gui.goPreviousWindow()});c&&!t&&0<f.length&&(f[0].onHover=function(){s.city.gui.tooltip.setText(s,"Want a shorter version?")})},makeWorlds:function(t,e,i,n){for(var r=0,s=this.storyInfo.worlds;r<s.length;){var o=s[r];++r;var a=new Q(t,this.city,e,i,n,yr.fromStoryRect(o.rect),o.seed,o.appearance);this.city.worlds.push(a);for(var l=0,h=o.worldResources;l<h.length;){var u=h[l];++l;var c="worldResources."+u.className;a.createWorldResource(q[c],u.position)}for(var d=0,p=o.buildingStacks;d<p.length;){var f=p[d];++d;for(var g=0,m=f.classNames;g<m.length;){var y=m[g];if(++g,"NULL"!=y){var _="buildings."+y;"LandedExplorationShip_mirrored"==y&&(_="buildings.LandedExplorationShip"),"FuturisticHome_mirrored"==y&&(_="buildings.FuturisticHome"),"Loft_mirrored"==y&&(_="buildings.Loft");var v=!1,b=0;if(-1!=y.indexOf("*")){var w=y.split("*"),S=w[1].split(".");v="true"==S[0],b=Y.parseInt(S[1]),_="buildings."+w[0]}var x=a.build(q[_],f.position);"LandedExplorationShip_mirrored"==y&&x.mirror(),"FuturisticHome_mirrored"==y&&x.mirror(),"Loft_mirrored"==y&&x.mirror(),!v&&0==b||x.customize(b,v),x.postCreate()}else a.permanents[f.position].push(null)}}if(null!=o.decoration)for(var T=0,I=a.permanents.length;T<I;){var P=T++;a.setDecoration(o.decoration,P)}if(null!=o.decorations)for(var C=0,E=o.decorations;C<E.length;){var A=E[C];++C,a.setDecoration(A.spriteName,A.position)}for(var M=0,B=o.citizens;M<B.length;){var R=B[M];++M,this.spawnCitizens(a,R)}null!=o.unbuildableAliens&&o.unbuildableAliens&&a.setUnbuildableAliens(),null!=o.protectedKey&&o.protectedKey&&a.setProtectedKey()}if(null!=this.storyInfo.generatorScripts)for(r=0,s=this.storyInfo.generatorScripts;r<s.length;){var O=s[r];++r,Wa.doGenerate(O.name,O.args,this.city,this.storyInfo,e,i,n)}},spawnCitizens:function(t,e){for(var i=0,n=e.amount;i<n;){i++;var r=e.ageRangeMin;e.ageRangeMin!=e.ageRangeMax&&(r=il.getFloat(e.ageRangeMin,e.ageRangeMax));var s=null;null!=e.minX&&null!=e.maxX&&(s=e.minX==e.maxX?e.minX:il.getInt(e.minX,e.maxX)),this.city.simulation.createCitizen(t,r,null,s)}},handleFlagsChanges:function(t){if(null!=t.disableDying&&(this.disableDying=t.disableDying),null!=t.disableDestroy&&(this.disableDestroy=t.disableDestroy),null!=t.happinessEnthusiasmLevel&&(this.city.simulation.happiness.happinessEnthusiasmLevel=t.happinessEnthusiasmLevel),null!=t.hiddenBoost&&(this.hiddenBoost=t.hiddenBoost),null!=t.disableRewardedAd&&null!=this.city.simulation.boostManager&&(this.city.simulation.boostManager.disableRewardedAd=t.disableRewardedAd),null!=t.setBuildableAliens)for(var e=0,i=this.city.worlds;e<i.length;){var n=i[e];++e,n.makeBuildableAliens()}null!=t.unlockAchievementWithStoryPrefix&&dr.achieve("STORY_"+t.unlockAchievementWithStoryPrefix)},save:function(t){this.saveBasics(t),t.addString(null==this.currentGoal?"":this.currentGoal.name);var e=this.plannings.length;if(t.size+4>t.bytes.length){var i=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+4))),t.bytes.blit(0,i,0,t.size)}t.bytes.setInt32(t.size,e),t.size+=4;for(var n=0,r=this.plannings;n<r.length;){var s=r[n];++n,t.addString(s.goalName);e=s.nextEventToHandle;if(t.size+4>t.bytes.length){i=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+4))),t.bytes.blit(0,i,0,t.size)}t.bytes.setInt32(t.size,e),t.size+=4;var o=s.timeStart;if(t.size+8>t.bytes.length){var a=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+8))),t.bytes.blit(0,a,0,t.size)}t.bytes.setDouble(t.size,o),t.size+=8}e=this.scriptedParts.length;if(t.size+4>t.bytes.length){i=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+4))),t.bytes.blit(0,i,0,t.size)}t.bytes.setInt32(t.size,e),t.size+=4;for(n=0,r=this.scriptedParts;n<r.length;){s=r[n];++n;var l=Ko.getClass(s);t.addString(l.__name__),s.save(t)}},load:function(t){this.loadBasics(t),this.storyInfo=dt.storiesInfo.h[this.storyName];var e=t.readString();this.currentGoal=""==e?null:this.findGoal(e);var i=t.bytes.getInt32(t.readStart);t.readStart+=4;for(var n=0,r=i;n<r;){n++;var s=t.readString();i=t.bytes.getInt32(t.readStart);t.readStart+=4;var o=i,a=t.bytes.getDouble(t.readStart);t.readStart+=8;var l=a;this.plannings.push({goalName:s,plan:this.findGoal(s).planning,nextEventToHandle:o,timeStart:l})}i=t.bytes.getInt32(t.readStart);t.readStart+=4;for(n=0,r=i;n<r;){n++;var h=t.readString(),u=k.createInstance(q[h],[this.city,this]);u.load(t),this.scriptedParts.push(u)}""!=e&&"Win"!=e||("theLostShip"==this.storyName?xr.setStat("binaryWontheLostShip",1):"multipleWorlds"==this.storyName&&(xr.setStat("binaryWontheLostShip",1),xr.setStat("binaryWonmultipleWorlds",1)))},canHaveUnlimitedResources:function(){return null==this.currentGoal},canHaveExtraResources:function(){return null==this.storyInfo.extraResourcesDisabled||!this.storyInfo.extraResourcesDisabled},saveBasics:function(t,e){null==e&&(e=!0),e&&t.addString(qa.saveDefinition),t.addString(this.storyName);var i=this.disableDying;if(t.size+1>t.bytes.length){var n=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+1))),t.bytes.blit(0,n,0,t.size)}t.bytes.b[t.size]=i?1:0,t.size+=1;i=this.disableDestroy;if(t.size+1>t.bytes.length){n=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+1))),t.bytes.blit(0,n,0,t.size)}t.bytes.b[t.size]=i?1:0,t.size+=1;i=this.hiddenBoost;if(t.size+1>t.bytes.length){n=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+1))),t.bytes.blit(0,n,0,t.size)}t.bytes.b[t.size]=i?1:0,t.size+=1;i=this.goalTimer;if(t.size+8>t.bytes.length){n=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+8))),t.bytes.blit(0,n,0,t.size)}t.bytes.setDouble(t.size,i),t.size+=8},loadBasics:function(t,e){null==e&&(e=t.readString());var i=Dr.makeLoadMap(e,t);Object.prototype.hasOwnProperty.call(i.h,"storyName")&&(this.storyName=i.h.storyName),Object.prototype.hasOwnProperty.call(i.h,"disableDying")&&(this.disableDying=i.h.disableDying),Object.prototype.hasOwnProperty.call(i.h,"disableDestroy")&&(this.disableDestroy=i.h.disableDestroy),Object.prototype.hasOwnProperty.call(i.h,"hiddenBoost")&&(this.hiddenBoost=i.h.hiddenBoost),Object.prototype.hasOwnProperty.call(i.h,"goalTimer")&&(this.goalTimer=i.h.goalTimer)},__class__:qa};var Ka=function(n,t,r){var e="stories/"+n+".json",i=new PIXI.Loader;i.add(e);var s=!1;i.use(function(t,e){if(t.error)return console.log("FloatingSpaceCities/progress/StoryLoader.hx:21:",t.error),void(s||(r(),s=!0));var i=t.data;dt.storiesInfo.h[n]=i,e()}),i.load(t)};(q["progress.StoryLoader"]=Ka).__name__="progress.StoryLoader",Ka.shouldShowUnlockAllStoriesButton=function(t){for(var e=dt.allStoriesInfo,i=0;i<e.length;){var n=e[i];if(++i,n.unlockedWithAll&&!Ka.hasCompletedRequirements(t,n)&&(B.isLimitedDemo,gr.all(n.requirements,function(t){return"notDemo"!=t}))&&(B.hasPremium()||gr.all(n.requirements,function(t){return"premium"!=t})))return!0}return!1},Ka.hasCompletedRequirements=function(e,t){return null==t.requirements||(!!(t.unlockedWithAll&&e.metaGame.unlockedAll&&(B.isLimitedDemo,gr.all(t.requirements,function(t){return"notDemo"!=t}))&&(B.hasPremium()||gr.all(t.requirements,function(t){return"premium"!=t})))||gr.all(t.requirements,function(t){return!!("notDemo"==t&&(B.isLimitedDemo,0)||"premium"==t&&B.hasPremium()||"isSnow"==t&&B.isSnowThemed)||e.metaGame.hasWonScenario(t)}))},Ka.prototype={__class__:Ka};var $a=T["progress.UnlockState"]={__ename__:"progress.UnlockState",__constructs__:["Locked","Unlocked","Createable","Researched"],Locked:{_hx_index:0,__enum__:"progress.UnlockState",toString:i},Unlocked:{_hx_index:1,__enum__:"progress.UnlockState",toString:i},Createable:{_hx_index:2,__enum__:"progress.UnlockState",toString:i},Researched:{_hx_index:3,__enum__:"progress.UnlockState",toString:i}},Qa=function(t){this.unlockMost=!1,this.checkBuildRelatedUnlocksIn=0,this.numberOfModernArtMuseumArtworksUnlocked=4,this.unlockedManagementOptions=!0,this.unlockedBuildingModeButton=!0,this.unlockedDecorationTab=!0,this.city=t,this.unlockState=new Vo,this.shouldNotifyForUnlock=new Vo,this.shouldNotifyForCategoryUnlock=new Vo,this.explicityLocked=[],this.unlockedMaterials=[];for(var e=Vo.valueIterator(t.progress.resources.buildingInfo.h);e.hasNext();){var i=e.next(),n=i.unlockedByDefault&&0==i.knowledge?$a.Researched:i.unlockedByDefault?$a.Unlocked:$a.Locked;this.unlockState.h["buildings."+i.className]=n}for(var r=Vo.valueIterator(dt.buildingUpgradesInfo.h);r.hasNext();){var s=r.next();n=(p=null==s.unlockedByDefault||s.unlockedByDefault)&&0==s.knowledge?$a.Researched:p?$a.Unlocked:$a.Locked;this.unlockState.h["buildingUpgrades."+s.className]=n}for(var o=Vo.valueIterator(dt.cityUpgradesInfo.h);o.hasNext();){var a=o.next();n=(p=null==a.unlockedByDefault||a.unlockedByDefault)?$a.Unlocked:$a.Locked;this.unlockState.h["cityUpgrades."+a.className]=n}for(var l=Vo.valueIterator(dt.policiesInfo.h);l.hasNext();){var h=l.next();n=(p=null==h.unlockedByDefault||h.unlockedByDefault)?$a.Unlocked:$a.Locked;this.unlockState.h["policies."+h.className]=n}for(var u=0,c=dt.worldResourcesInfo;u<c.length;){var d=c[u];++u;var p;n=(p=null==d.unlockedByDefault||d.unlockedByDefault)?$a.Unlocked:$a.Locked;this.unlockState.h["worldResources."+d.className]=n}for(u=0,c=dt.bridgesInfo;u<c.length;){var f=c[u];++u;n=$a.Locked;this.unlockState.h["miscCityElements."+f.className]=n}};(q["progress.Unlocks"]=Qa).__name__="progress.Unlocks",Qa.prototype={saveForCitySwitch:function(){return{unlockState:this.unlockState,explicityLocked:this.explicityLocked,numberOfModernArtMuseumArtworksUnlocked:this.numberOfModernArtMuseumArtworksUnlocked,unlockedMaterials:this.unlockedMaterials}},restoreFromCitySwitch:function(t){this.unlockState=t.unlockState,this.explicityLocked=t.explicityLocked,this.numberOfModernArtMuseumArtworksUnlocked=t.numberOfModernArtMuseumArtworksUnlocked,this.unlockedMaterials=t.unlockedMaterials,this.city.gui.refreshCategoryBuildingsShown()},postInitialCreate:function(){if(this.unlockMost){for(var t=Vo.valueIterator(this.city.progress.resources.buildingInfo.h);t.hasNext();){var e=t.next(),i=e.notUnlockedWithAll||0!=e.knowledge?e.notUnlockedWithAll?$a.Locked:$a.Createable:$a.Researched;this.unlockState.h["buildings."+e.className]=i}for(var n=Vo.valueIterator(dt.buildingUpgradesInfo.h);n.hasNext();){var r=n.next();i=(l=null==r.notUnlockedWithAll||!r.notUnlockedWithAll)&&0==r.knowledge?$a.Researched:l?$a.Unlocked:$a.Locked;this.unlockState.h["buildingUpgrades."+r.className]=i}for(var s=Vo.valueIterator(dt.cityUpgradesInfo.h);s.hasNext();){var o=s.next();i=(l=null==o.notUnlockedWithAll||!o.notUnlockedWithAll)?$a.Unlocked:$a.Locked;this.unlockState.h["cityUpgrades."+o.className]=i}for(var a=Vo.valueIterator(dt.policiesInfo.h);a.hasNext();){var l,h=a.next();i=(l=null==h.notUnlockedWithAll||!h.notUnlockedWithAll)?$a.Unlocked:$a.Locked;this.unlockState.h["policies."+h.className]=i}for(var u=0,c=dt.bridgesInfo;u<c.length;){var d=c[u];++u;i=$a.Createable;this.unlockState.h["miscCityElements."+d.className]=i}this.unlockedMaterials.push("graphene"),this.checkBuildRelatedUnlocks(),this.city.gui.refreshCityInfo()}},postLoad:function(){for(var t=Vo.valueIterator(this.city.progress.resources.buildingInfo.h);t.hasNext();){var e=t.next(),i="buildings."+e.className,n=e.unlockedByDefault&&-1==this.explicityLocked.indexOf(i);if(n&&0==e.knowledge){var r=$a.Researched;this.unlockState.h[i]=r}else if(!n||null!=this.unlockState.h[i]&&this.unlockState.h[i]!=$a.Locked){if(null==this.unlockState.h[i]){var s=$a.Locked;this.unlockState.h[i]=s}}else{var o=$a.Unlocked;this.unlockState.h[i]=o}}for(var a=Vo.valueIterator(dt.buildingUpgradesInfo.h);a.hasNext();){var l=a.next();i="buildingUpgrades."+l.className;if((m=(null==l.unlockedByDefault||l.unlockedByDefault)&&-1==this.explicityLocked.indexOf(i))&&0==l.knowledge){r=$a.Researched;this.unlockState.h[i]=r}else if(!m||null!=this.unlockState.h[i]&&this.unlockState.h[i]!=$a.Locked){if(null==this.unlockState.h[i]){s=$a.Locked;this.unlockState.h[i]=s}}else{o=$a.Unlocked;this.unlockState.h[i]=o}}for(var h=Vo.valueIterator(dt.cityUpgradesInfo.h);h.hasNext();){var u=h.next();i="cityUpgrades."+u.className;if(!(m=null==u.unlockedByDefault||u.unlockedByDefault)||null!=this.unlockState.h[i]&&this.unlockState.h[i]!=$a.Locked){if(null==this.unlockState.h[i]){o=$a.Locked;this.unlockState.h[i]=o}}else{r=$a.Unlocked;this.unlockState.h[i]=r}}for(var c=Vo.valueIterator(dt.policiesInfo.h);c.hasNext();){var d=c.next();i="policies."+d.className;if(!(m=null==d.unlockedByDefault||d.unlockedByDefault)||null!=this.unlockState.h[i]&&this.unlockState.h[i]!=$a.Locked){if(null==this.unlockState.h[i]){o=$a.Locked;this.unlockState.h[i]=o}}else{r=$a.Unlocked;this.unlockState.h[i]=r}}for(var p=0,f=dt.worldResourcesInfo;p<f.length;){var g=f[p];if(++p,null==this.unlockState.h["worldResources."+g.className]){var m;r=(m=null==g.unlockedByDefault||g.unlockedByDefault)?$a.Unlocked:$a.Locked;this.unlockState.h["worldResources."+g.className]=r}}this.checkBuildRelatedUnlocks(),this.city.gui.refreshCategoryBuildingsShown()},lock:function(t){var e=t.__name__,i=$a.Locked;this.unlockState.h[e]=i,this.city.gui.refreshCategoryBuildingsShown(),this.explicityLocked.push(e)},unlock:function(t,e){null==e&&(e=!1);var i=t.__name__;if(null!=this.unlockState.h[i]&&this.unlockState.h[i]!=$a.Locked)return!1;var n=this.city.progress.resources.buildingInfo.h[i],r=!0,s=!1;null==n&&(n=dt.buildingUpgradesInfo.h[i],r=!1),null==n&&(n=lt.find(dt.worldResourcesInfo,function(t){return"worldResources."+t.className==i}),r=!1),null==n&&(n=dt.cityUpgradesInfo.h[i]),null==n&&(n=lt.find(dt.bridgesInfo,function(t){return"miscCityElements."+t.className==i}),s=!0);var o=0!=n.knowledge||s||r&&(null!=n.showUnlockHint||-1!=n.specialInfo.indexOf("premium"))?$a.Unlocked:$a.Researched;return this.unlockState.h[i]=o,null==n.showUnlockHint&&this.notifyForUnlock(t),this.city.gui.refreshCategoryBuildingsShown(),e||this.city.gui.reloadWindow(),this.checkBuildRelatedUnlocks(),!0},removeUnlock:function(t){var e=t.__name__,i=$a.Locked;this.unlockState.h[e]=i},fullyUnlock:function(t){var e=t.__name__;if(this.unlockState.h[e]==$a.Unlocked){var i=$a.Createable;this.unlockState.h[e]=i,this.notifyForUnlock(t),this.city.gui.refreshCategoryBuildingsShown(),this.city.gui.reloadWindow()}},research:function(t,e){null==e&&(e=!0);var i=t.__name__,n=this.unlockState.h[i],r=$a.Researched;this.unlockState.h[i]=r,n==$a.Locked&&this.city.gui.refreshCategoryBuildingsShown(),e&&n!=$a.Researched&&(S.sendEvent("research",i),S.sendEventFirebase("research","upgrade",i))},getUnlockState:function(t){var e=t.__name__;return this.unlockState.h[e]},getShouldNotifyForUnlock:function(t){var e=t.__name__,i=this.shouldNotifyForUnlock.h[e];return null!=i&&i},notifyForUnlock:function(t){var e,i=t.__name__;this.shouldNotifyForUnlock.h[i]=!0,null!=(e=this.city.progress.resources.buildingInfo.h[i])&&(this.shouldNotifyForCategoryUnlock.h[e.category]=!0),null!=(e=lt.find(dt.bridgesInfo,function(t){return"miscCityElements."+t.className==i}))&&(this.shouldNotifyForCategoryUnlock.h.Transportation=!0)},stopNotifyForUnlock:function(t){var e=t.__name__;this.shouldNotifyForUnlock.h[e]=!1},stopAllNotifyForUnlock:function(){this.shouldNotifyForUnlock=new Vo,this.shouldNotifyForCategoryUnlock=new Vo},getShouldNotifyForCategoryUnlock:function(t){return this.shouldNotifyForCategoryUnlock.h[t]},stopNotifyCategoryUnlock:function(t){this.shouldNotifyForCategoryUnlock.h[t]=!1},getShouldNotifyForMiscUnlock:function(t){return this.shouldNotifyForUnlock.h[t]},stopNotifyMiscUnlock:function(t){this.shouldNotifyForUnlock.h[t]=!1},checkBuildRelatedUnlocksSoon:function(){this.checkBuildRelatedUnlocksIn=0<this.checkBuildRelatedUnlocksIn?this.checkBuildRelatedUnlocksIn:60},update:function(t){0<this.checkBuildRelatedUnlocksIn&&(this.checkBuildRelatedUnlocksIn-=t,this.checkBuildRelatedUnlocksIn<=0&&this.checkBuildRelatedUnlocks())},checkBuildRelatedUnlocks:function(){var t=this.city.getAmountOfPermanentsPerType();if(5<=t.h["buildings.Park"]&&(this.unlock(be),10<=t.h["buildings.Park"]&&5<=t.h["buildings.Laboratory"]&&this.fullyUnlock(be)),3<=t.h["buildings.ModernArtMuseum"]&&this.fullyUnlock(de),this.unlockState.h["buildings.BotanicalGardens"]!=$a.Researched&&this.unlockState.h["buildings.BotanicalGardens"]!=$a.Createable||(this.unlock(Ue),10<=t.h["buildings.BotanicalGardens"]&&1<=t.h["buildings.ExperimentalFarm"]&&this.fullyUnlock(Ue),50<=t.h["buildings.BotanicalGardens"]&&1<=t.h["buildings.RefinedMetalFactory"]&&this.unlock(we)),5<=t.h["buildings.Laboratory"]&&1<=t.h["buildings.RefinedMetalFactory"]&&this.fullyUnlock(Ne),1<=t.h["buildings.ComputerResearchCenter"]&&this.unlock(Fe),3<=t.h["buildings.MachinePartsFactory"]&&this.fullyUnlock(Ti),1<=t.h["buildings.LivingResearchCenter"]&&(this.fullyUnlock(Le),this.unlock(Fi),this.unlock(et),this.unlock(Ht)),1<=t.h["buildings.ComputerChipFactory"]&&(this.unlock(oi),3<=t.h["buildings.Arcade"]&&this.fullyUnlock(oi)),2<=t.h["buildings.Pub"]&&(this.unlock(Wi),5<=t.h["buildings.Pub"]&&(this.fullyUnlock(Wi),this.unlock(ai))),2<=t.h["buildings.Restaurant"]&&this.fullyUnlock(ai),2<=t.h["buildings.BlossomRestaurant"]&&(this.unlock(ge),10<=t.h["buildings.BlossomRestaurant"]&&this.fullyUnlock(ge)),10<=t.h["buildings.FarmByProductProcessor"]&&200<=t.h["buildings.BotanicalGardens"]&&50<=t.h["buildings.BlossomHut"]&&this.unlock(_n),1<=t.h["buildings.RefinedMetalFactory"]&&15<=t.h["buildings.StoneMine"]&&3<=t.h["buildings.StoneTeleporter"]&&this.fullyUnlock(an),(4<=t.h["buildings.MechanicalHouse"]&&3<=t.h["buildings.RefinedMetalFactory"]&&1<=t.h["buildings.ComputerChipFactory"]||1<=t.h["buildings.RocketLaunchPlatform"])&&(this.unlock(He),(12<=t.h["buildings.MechanicalHouse"]&&10<=t.h["buildings.RefinedMetalFactory"]&&3<=t.h["buildings.ComputerChipFactory"]||1<=t.h["buildings.RocketLaunchPlatform"])&&this.fullyUnlock(He)),1<=t.h["buildings.TheMachine"]&&1<=t.h["buildings.FestivalHQ"]&&this.unlock(Ze),20<=t.h["buildings.FarmHouse"]&&(this.unlock(Li),40<=t.h["buildings.FarmHouse"]&&this.fullyUnlock(Li)),5<=t.h["buildings.School"]&&this.unlock(_i),1<=t.h["buildings.StatueOfHappiness"]&&this.unlock(pe),this.getUnlockState(fe)==$a.Unlocked&&20<=t.h["buildings.BotanicalGardens"]){for(var e=!1,i=0,n=this.city.permanents;i<n.length;){var r=n[i];if(++i,r.is(be)){var s=r;if(null==s.bottomBuilding||!s.bottomBuilding.is(be)){for(var o=s.topBuilding,a=1;null!=o&&o.is(be);)o=o.topBuilding,++a;20<=a&&(e=!0)}}}e&&this.fullyUnlock(fe)}1<=t.h["buildings.RefinedMetalFactory"]&&B.canHavePremium()&&(this.unlock(yi),this.unlock(Zi),this.unlock(Qo),B.hasPremium()&&(this.fullyUnlock(Qo),this.fullyUnlock(yi),this.fullyUnlock(Zi))),1<=t.h["buildings.ComputerChipFactory"]&&B.canHavePremium()&&(this.unlock(yn),B.hasPremium()&&this.fullyUnlock(yn)),5<=t.h["buildings.TrainStation"]&&B.canHavePremium()&&(this.unlock(mn),B.hasPremium()&&10<=t.h["buildings.TrainStation"]&&this.fullyUnlock(mn)),6<=t.h["buildings.HerbGarden"]&&1<=t.h["buildings.RefinedMetalFactory"]&&B.canHavePremium()&&(this.unlock(he),12<=t.h["buildings.HerbGarden"]&&B.hasPremium()&&this.fullyUnlock(he)),100<=t.h["buildings.EcoFarm"]&&B.canHavePremium()&&(this.unlock(bn),B.hasPremium()&&this.fullyUnlock(bn)),5<=t.h["buildings.ComputerChipFactory"]&&B.canHavePremium()&&(this.unlock(si),B.hasPremium()&&this.fullyUnlock(si)),10<=t.h["buildings.GrapheneLab"]&&B.hasPremium()&&this.unlock(ri),1<=t.h["buildings.GrapheneLab"]&&B.canHavePremium()&&(this.unlock(ia),this.unlock(Hi),this.unlock(en),this.unlock(cn),this.unlock(ii),100<=t.h["buildings.BotanicalGardens"]&&this.unlock(Jo),B.hasPremium()&&(this.fullyUnlock(ii),this.fullyUnlock(ia),100<=t.h["buildings.BotanicalGardens"]&&this.fullyUnlock(Jo),this.fullyUnlock(en),this.fullyUnlock(cn),this.fullyUnlock(Hi))),1<=t.h["buildings.RocketLaunchPlatform"]&&B.canHavePremium()&&(this.unlock(Gi),B.hasPremium()&&this.fullyUnlock(Gi)),1<=t.h["buildings.RocketLaunchPlatform"]&&1<=t.h["buildings.TheMachine"]&&1<=t.h["buildings.FestivalHQ"]&&1<=t.h["buildings.Misdirector"]&&B.canHavePremium()&&(this.unlock(Qe),B.hasPremium()&&this.fullyUnlock(Qe)),1<=t.h["buildings.LivingResearchCenter"]&&1<=t.h["buildings.ArtColony"]&&10<=t.h["buildings.ModernArtMuseum"]&&this.unlock(bi),B.isSnowThemed?(3<=t.h["buildings.Pub"]&&this.unlock(Ee),1<=t.h["buildings.ChristmasMarket"]&&this.unlock(Et),3<=t.h["buildings.ChristmasMarket"]&&this.unlock(Me)):"snowWorld"!=this.city.progress.story.storyName&&(this.removeUnlock(Ee),this.removeUnlock(Et),this.removeUnlock(Me)),g.isLoading||(1<=t.h["buildings.Supercomputer"]&&42<=t.h["buildings.Laboratory"]+t.h["buildings.ExperimentationLab"]&&dr.achieve("SUPERCOMPUTER_42"),2<=t.h["buildings.Supercomputer"]&&dr.achieve("TWO_SUPERCOMPUTERS"))},unlockMaterial:function(t){-1==this.unlockedMaterials.indexOf(t)&&(this.unlockedMaterials.push(t),this.city.gui.refreshCityInfo(),"graphene"==t&&(this.shouldNotifyForCategoryUnlock.h.Transportation=!0,this.shouldNotifyForUnlock.h.FloatingPlatform=!0))},unlockedMaterial:function(t){return"wood"==t||"stone"==t||"knowledge"==t||"machineParts"==t||"refinedMetal"==t||"computerChips"==t||"food"==t||-1!=this.unlockedMaterials.indexOf(t)},checkStatRelatedUnlocks:function(){200<=this.city.simulation.stats.peopleWithHome&&this.fullyUnlock(vi),200<=this.city.simulation.citizens.length&&this.fullyUnlock(ci),99.99<=this.city.simulation.happiness.happiness&&this.unlock(rn),500<=this.city.simulation.citizens.length&&1<this.city.teleporters.length&&this.unlock(Qi),5<=this.city.simulation.bonuses.fossilsCollected&&this.unlock(ti),750<=this.city.simulation.citizens.length&&this.unlock(fe),this.getUnlockState(pe)==$a.Unlocked&&20160<=this.city.simulation.happiness.fullHappinessTime&&(this.fullyUnlock(pe),console.log("FloatingSpaceCities/progress/Unlocks.hx:763:","beacon_unlocked")),100<=this.city.simulation.citizens.length&&1<this.city.workBuildings.length&&this.unlock(Be),this.getUnlockState(Me)==$a.Unlocked&&59.99<=this.city.simulation.happiness.happiness&&this.fullyUnlock(Me)},save:function(t,e){null==e&&(e=!0),e&&t.addString(Qa.saveDefinition),t.addString(Bo.run(this.unlockState)),t.addString(Bo.run(this.explicityLocked));var i=this.unlockedDecorationTab;if(t.size+1>t.bytes.length){var n=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+1))),t.bytes.blit(0,n,0,t.size)}t.bytes.b[t.size]=i?1:0,t.size+=1;i=this.unlockedBuildingModeButton;if(t.size+1>t.bytes.length){n=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+1))),t.bytes.blit(0,n,0,t.size)}t.bytes.b[t.size]=i?1:0,t.size+=1;i=this.unlockedManagementOptions;if(t.size+1>t.bytes.length){n=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+1))),t.bytes.blit(0,n,0,t.size)}t.bytes.b[t.size]=i?1:0,t.size+=1;i=this.numberOfModernArtMuseumArtworksUnlocked;if(t.size+4>t.bytes.length){n=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+4))),t.bytes.blit(0,n,0,t.size)}t.bytes.setInt32(t.size,i),t.size+=4,t.addString(Bo.run(this.unlockedMaterials))},load:function(t,e){null==e&&(e=t.readString());var i=Dr.makeLoadMap(e,t);Object.prototype.hasOwnProperty.call(i.h,"unlockState")&&(this.unlockState=i.h.unlockState),Object.prototype.hasOwnProperty.call(i.h,"explicityLocked")&&(this.explicityLocked=i.h.explicityLocked),Object.prototype.hasOwnProperty.call(i.h,"unlockedDecorationTab")&&(this.unlockedDecorationTab=i.h.unlockedDecorationTab),Object.prototype.hasOwnProperty.call(i.h,"unlockedBuildingModeButton")&&(this.unlockedBuildingModeButton=i.h.unlockedBuildingModeButton),Object.prototype.hasOwnProperty.call(i.h,"unlockedManagementOptions")&&(this.unlockedManagementOptions=i.h.unlockedManagementOptions),Object.prototype.hasOwnProperty.call(i.h,"numberOfModernArtMuseumArtworksUnlocked")&&(this.numberOfModernArtMuseumArtworksUnlocked=i.h.numberOfModernArtMuseumArtworksUnlocked),Object.prototype.hasOwnProperty.call(i.h,"unlockedMaterials")&&(this.unlockedMaterials=i.h.unlockedMaterials),this.postLoad()},__class__:Qa};function Ja(t,e){this.alienRayInited=!1,this.isInvasionFinished=!1,this.isInvasion=!1,this.invasionProgress=0,this.timeUntilInvasion=0,ja.call(this,t,e)}(q["progress.scriptedStoryParts.AlienInvasion"]=Ja).__name__="progress.scriptedStoryParts.AlienInvasion",Ja.__super__=ja,Ja.prototype=e(ja.prototype,{initialize:function(t){this.timeUntilInvasion=t.timeUntilInvasion},update:function(t){var e=this;if(!this.isInvasionFinished)if(this.isInvasion){this.invasionProgress+=t;var i=0;if(this.alienRayInited||(this.graphics=new PIXI.Graphics,this.city.movingViewStage.addChild(this.graphics),this.alienRayInited=!0),30<=this.invasionProgress?(this.city.mainMovingViewStage.alpha=0,i=1-(this.invasionProgress-30)/30,60<=this.invasionProgress&&(this.city.progress.story.currentGoal=null,this.loseAliens(),this.isInvasionFinished=!0)):i=this.invasionProgress/30,this.graphics.clear(),0<i){this.graphics.beginFill(4388075,i);var n=gr.min(this.city.worlds,function(t){return t.rect.x-10}).rect.x-10,r=gr.min(this.city.worlds,function(t){return t.rect.y-20*gr.max(t.permanents,function(t){return 20*t.length}).length-e.city.game.rect.height*e.city.game.scaling}),s=r.rect.y-20*gr.max(r.permanents,function(t){return 20*t.length}).length-e.city.game.rect.height*e.city.game.scaling;this.graphics.drawRect(n,s,gr.max(this.city.worlds,function(t){return t.rect.get_x2()+10}).rect.get_x2()+10-n,gr.max(this.city.worlds,function(t){return t.rect.get_y2()}).rect.get_y2()+this.city.game.rect.height*this.city.game.scaling-s),this.graphics.endFill()}}else this.timeUntilInvasion-=t,this.isInvasion=!0},loseAliens:function(){var t=this;this.city.activateLoserState(),this.city.gui.createWindow(),this.city.gui.windowAddTitleText("You Lost!"),this.city.gui.windowAddInfoText("Aliens have destroyed your city blah blah."),this.city.gui.windowAddBottomButtons(null,"Try Again"),this.city.gui.windowOnDestroy=function(){t.city.game.newCity(t.city.progress.story.storyName,t.city.cityFile)}},save:function(t,e){null==e&&(e=!0),ja.prototype.save.call(this,t),e&&t.addString(Ja.saveDefinition);var i=this.timeUntilInvasion;if(t.size+8>t.bytes.length){var n=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+8))),t.bytes.blit(0,n,0,t.size)}t.bytes.setDouble(t.size,i),t.size+=8;i=this.invasionProgress;if(t.size+8>t.bytes.length){n=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+8))),t.bytes.blit(0,n,0,t.size)}t.bytes.setDouble(t.size,i),t.size+=8;i=this.isInvasion;if(t.size+1>t.bytes.length){n=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+1))),t.bytes.blit(0,n,0,t.size)}t.bytes.b[t.size]=i?1:0,t.size+=1;i=this.isInvasionFinished;if(t.size+1>t.bytes.length){n=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+1))),t.bytes.blit(0,n,0,t.size)}t.bytes.b[t.size]=i?1:0,t.size+=1},load:function(t,e){ja.prototype.load.call(this,t),null==e&&(e=t.readString());var i=Dr.makeLoadMap(e,t);Object.prototype.hasOwnProperty.call(i.h,"timeUntilInvasion")&&(this.timeUntilInvasion=i.h.timeUntilInvasion),Object.prototype.hasOwnProperty.call(i.h,"invasionProgress")&&(this.invasionProgress=i.h.invasionProgress),Object.prototype.hasOwnProperty.call(i.h,"isInvasion")&&(this.isInvasion=i.h.isInvasion),Object.prototype.hasOwnProperty.call(i.h,"isInvasionFinished")&&(this.isInvasionFinished=i.h.isInvasionFinished)},__class__:Ja});function Za(t,e){this.afterDoneMessage=null,this.timeBetweenMax=0,this.timeBetweenMin=0,this.worldID=0,this.ageRangeMax=0,this.ageRangeMin=0,this.groupSizeMax=1,this.groupSizeMin=0,this.nextSpawn=0,this.spawnNumber=0,ja.call(this,t,e)}(q["progress.scriptedStoryParts.SpawnCitizensRegularly"]=Za).__name__="progress.scriptedStoryParts.SpawnCitizensRegularly",Za.__super__=ja,Za.prototype=e(ja.prototype,{update:function(t){if(0<this.spawnNumber&&this.simulation.time.timeSinceStart>=this.nextSpawn){var e=this.spawnNumber,i=il.getInt(this.groupSizeMin,this.groupSizeMax+1),n=i<e?i:e;if(this.spawnNumber-=n,this.city.simulation.citizens.length<200)1.5<this.city.simulation.boostManager.currentGlobalBoostAmount&&(n*=2);this.city.simulation.citizenSpawners.push(new kl(this.city.simulation,this.city.farForegroundStage,this.city.worlds[this.worldID],{time:0,type:"SpawnCitizensFlyingSaucer",amount:n,ageRangeMin:this.ageRangeMin,ageRangeMax:this.ageRangeMax,world:this.worldID}));var r=1;this.city.simulation.stats.houseCapacity>this.city.simulation.stats.peopleWithHome+this.groupSizeMin&&this.city.simulation.stats.jobs>this.city.simulation.stats.laborForce+this.groupSizeMin&&5<this.spawnNumber&&(r=10<this.city.materials.food?.6:.7),this.nextSpawn=this.simulation.time.timeSinceStart+60*r*il.getFloat(this.timeBetweenMin,this.timeBetweenMax)}else this.spawnNumber<=0&&0==this.simulation.citizenSpawners.length&&(null!=this.afterDoneMessage&&""!=this.afterDoneMessage?this.city.gui.showSimpleWindow(this.afterDoneMessage,null,!1,!0)&&at.remove(this.story.scriptedParts,this):at.remove(this.story.scriptedParts,this))},initialize:function(t){this.spawnNumber=t.spawnNumber,this.groupSizeMin=t.groupSizeMin,this.groupSizeMax=t.groupSizeMax,this.ageRangeMin=t.ageRangeMin,this.ageRangeMax=t.ageRangeMax,this.worldID=t.world,this.timeBetweenMin=t.timeBetweenMin,this.timeBetweenMax=t.timeBetweenMax,this.afterDoneMessage=t.afterDoneMessage},save:function(t,e){null==e&&(e=!0),ja.prototype.save.call(this,t),e&&t.addString(Za.saveDefinition);var i=this.spawnNumber;if(t.size+4>t.bytes.length){var n=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+4))),t.bytes.blit(0,n,0,t.size)}t.bytes.setInt32(t.size,i),t.size+=4;i=this.nextSpawn;if(t.size+8>t.bytes.length){n=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+8))),t.bytes.blit(0,n,0,t.size)}t.bytes.setDouble(t.size,i),t.size+=8;i=this.groupSizeMin;if(t.size+4>t.bytes.length){n=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+4))),t.bytes.blit(0,n,0,t.size)}t.bytes.setInt32(t.size,i),t.size+=4;i=this.groupSizeMax;if(t.size+4>t.bytes.length){n=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+4))),t.bytes.blit(0,n,0,t.size)}t.bytes.setInt32(t.size,i),t.size+=4;i=this.ageRangeMin;if(t.size+4>t.bytes.length){n=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+4))),t.bytes.blit(0,n,0,t.size)}t.bytes.setInt32(t.size,i),t.size+=4;i=this.ageRangeMax;if(t.size+4>t.bytes.length){n=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+4))),t.bytes.blit(0,n,0,t.size)}t.bytes.setInt32(t.size,i),t.size+=4;i=this.worldID;if(t.size+4>t.bytes.length){n=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+4))),t.bytes.blit(0,n,0,t.size)}t.bytes.setInt32(t.size,i),t.size+=4;i=this.timeBetweenMin;if(t.size+4>t.bytes.length){n=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+4))),t.bytes.blit(0,n,0,t.size)}t.bytes.setInt32(t.size,i),t.size+=4;i=this.timeBetweenMax;if(t.size+4>t.bytes.length){n=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+4))),t.bytes.blit(0,n,0,t.size)}t.bytes.setInt32(t.size,i),t.size+=4,t.addString(this.afterDoneMessage)},load:function(t,e){ja.prototype.load.call(this,t),null==e&&(e=t.readString());var i=Dr.makeLoadMap(e,t);Object.prototype.hasOwnProperty.call(i.h,"spawnNumber")&&(this.spawnNumber=i.h.spawnNumber),Object.prototype.hasOwnProperty.call(i.h,"nextSpawn")&&(this.nextSpawn=i.h.nextSpawn),Object.prototype.hasOwnProperty.call(i.h,"groupSizeMin")&&(this.groupSizeMin=i.h.groupSizeMin),Object.prototype.hasOwnProperty.call(i.h,"groupSizeMax")&&(this.groupSizeMax=i.h.groupSizeMax),Object.prototype.hasOwnProperty.call(i.h,"ageRangeMin")&&(this.ageRangeMin=i.h.ageRangeMin),Object.prototype.hasOwnProperty.call(i.h,"ageRangeMax")&&(this.ageRangeMax=i.h.ageRangeMax),Object.prototype.hasOwnProperty.call(i.h,"worldID")&&(this.worldID=i.h.worldID),Object.prototype.hasOwnProperty.call(i.h,"timeBetweenMin")&&(this.timeBetweenMin=i.h.timeBetweenMin),Object.prototype.hasOwnProperty.call(i.h,"timeBetweenMax")&&(this.timeBetweenMax=i.h.timeBetweenMax),Object.prototype.hasOwnProperty.call(i.h,"afterDoneMessage")&&(this.afterDoneMessage=i.h.afterDoneMessage)},__class__:Za});var tl=function(t,e){Va.call(this,t,e)};(q["progress.sidequests.CarrotJuiceBarMission"]=tl).__name__="progress.sidequests.CarrotJuiceBarMission",tl.__super__=Va,tl.prototype=e(Va.prototype,{start:function(){this.sideQuests.showSidequestDialog(Tr.lo("carrotjuice_sidequests_title"),Tr.lo("carrotjuice_sidequests_description"))},update:function(t){},onComplete:function(){this.sideQuests.showSidequestFinishedDialog(Tr.lo("sidequest_complete")+" "+Tr.lo("carrotjuice_sidequests_title"),Tr.lo("carrotjuice_sidequests_finish_description")),this.city.simulation.happiness.addBoost(Tl.withDuration(this.city.simulation.time,7200,10,Tr.lo("citizen_gratefulness_bonus")))},getGoalHelp:function(){return{category:Tr.lo("carrotjuice_sidequests_title"),text:Tr.lo("carrotjuice_sidequests_quickDescription")}},canStart:function(){return 50<this.city.simulation.citizens.length&&this.city.progress.unlocks.getUnlockState(Ni)!=$a.Locked},__class__:tl});var el=function(){};(q["progress.worldGenerators.RandomMiniWorlds"]=el).__name__="progress.worldGenerators.RandomMiniWorlds",el.doGenerate=function(t,e,i,n,r,s){for(var o=t.numberOfWorldsMin,a=t.numberOfWorldsMax,l=t.minX,h=t.minY,u=t.maxX,c=t.maxY,d=t.minWidth,p=t.maxWidth,f=t.minHeight,g=t.maxHeight,m=t.heightVariation,y=[],_=0,v=il.getInt(o,a);_<v;){_++;for(var b=0;++b<1e4;){for(var w=20*il.getInt(l/20|0,1+(u/20|0)),S=20*il.getInt(h/20|0,1+(c/20|0)),x=20*il.getInt(d/20|0,1+(p/20|0)),T=Math.round(((x-d)/(p-d)*(g-f)+f+il.getInt(m))/20),I=20*(T<1?1:100<T?100:T),P=!0,C=0,E=e.worlds;C<E.length;){var A=E[C];if(++C,A.rect.intersects(new yr(w-20,S-40,41+x,61+I))){P=!1;break}}if(P){var M=new Q(e.game,e,n,r,s,new yr(w,S,x,I),il.getInt(1e6));e.worlds.push(M),y.push(M);break}}1e3<=b&&(console.log("FloatingSpaceCities/progress/worldGenerators/RandomMiniWorlds.hx:48:","world not generated; max # of tries exceeded - RandomMiniWorlds.doGenerate with args:"),console.log("FloatingSpaceCities/progress/worldGenerators/RandomMiniWorlds.hx:49:",t))}var B=y.slice(),R=[];for(_=0,v=t.initialBuildings;_<v.length;){var O=v[_];++_;for(C=0,E=il.getInt(O.numberMin,O.numberMax);C<E;){C++;var k="buildings."+Y.string(O.className);R.push(q[k])}}for(_=0,v=t.initialWorldResources;_<v.length;){var D=v[_];++_;for(C=0,E=il.getInt(D.numberMin,D.numberMax);C<E;){C++,k="worldResources."+Y.string(D.className);R.push(q[k])}}var F=!1;for(_=0;_<R.length;){var N=R[_];++_;N.__name__.indexOf("AlienRuins");var L=-1!=N.__name__.indexOf("buildings.");F||L||(t.rememberWorldSpreadBetweenBuildingsAndWorldResources&&(B=y.slice()),F=!0);var U=[];for(b=0;++b<=2;){var z=y;(t.spreadBuildingsEvenlyBetweenWorlds&&L||t.spreadWorldResourcesEvenlyBetweenWorlds&&!L)&&(z=B);for(v=0;v<z.length;){var W=z[v];++v;var G=0;for(C=0,E=W.permanents.length;C<E;){w=C++;0==W.permanents[w].length&&++G}if(L||!t.avoidGeneratingOverfullWorlds||1<W.permanents.length&&1<G)for(var H=0,X=W.permanents.length;H<X;){var j=H++;0==W.permanents[j].length&&U.push({world:W,xPos:j})}}if(0!=U.length)break;B=y.slice()}if(0<U.length){var V=il.fromArray(U);at.remove(B,V.world),L?V.world.build(N,V.xPos):V.world.createWorldResource(N,V.xPos)}}};var il=function(){};(q["random.Random"]=il).__name__="random.Random",il.getFloat=function(t,e){var i=0,n=1;return null!=t&&null!=e?(i=t,n=e):null!=t&&(n=t),Math.random()*(n-i)+i},il.getInt=function(t,e){var i=0,n=2147483647;return null!=t&&null!=e?(i=t,n=e):null!=t&&(n=t),Math.floor(Math.random()*(n-i))+i},il.fromArray=function(t){if(0==t.length)throw Co.thrown("You can't get a random item from an empty array!");return t[il.getInt(t.length)]};var nl=function(t){var e=this.seed=null==t?Y.random(2147483647):t,i=new Mo(e>>31,e);this.state0=i;i=new Mo(0,89432);this.state1=i};(q["random.SeedeableRandom"]=nl).__name__="random.SeedeableRandom",nl.prototype={getInt64:function(){var t=this.state0,e=this.state1;this.state0=e;var i=23;if(0==(i&=63))r=n=new Mo(e.high,e.low);else if(i<32){r=n=new Mo(e.high<<i|e.low>>>32-i,e.low<<i)}else{r=n=new Mo(e.low<<i-32,0)}e=n=new Mo(e.high^r.high,e.low^r.low);i=18;if(0==(i&=63))r=n=new Mo(e.high,e.low);else if(i<32){r=n=new Mo(e.high>>i,e.high<<32-i|e.low>>>i)}else{r=n=new Mo(e.high>>31,e.high>>i-32)}var n=new Mo(e.high^r.high,e.low^r.low);e=n=new Mo((e=n).high^t.high,e.low^t.low);var r;i=5;if(0==(i&=63))r=n=new Mo(t.high,t.low);else if(i<32){r=n=new Mo(t.high>>i,t.high<<32-i|t.low>>>i)}else{r=n=new Mo(t.high>>31,t.high>>i-32)}e=n=new Mo(e.high^r.high,e.low^r.low),this.state1=e;var s=this.state0,o=(i=this.state1,s.high+i.high|0),a=s.low+i.low|0;if(Eo.ucompare(a,s.low)<0){o++;o|=0}return n=new Mo(o,a)},getInt:function(t,e){var i=0,n=2147483647;null!=t&&null!=e?(i=t,n=e):null!=t&&(n=t);var r,s=this.getInt64();r=a=new Mo(s.high>>>1,s.high<<31|s.low>>>1);var o,a=new Mo((o=n-i)>>31,o);if((o=Ao.divMod(r,a).modulus).high!=o.low>>31)throw Co.thrown("Overflow");return i+o.low},getFloat:function(t,e){var i=0,n=1;null!=t&&null!=e?(i=t,n=e):null!=t&&(n=t);var r=this.getInt64();return Math.abs(r.low/2147483647)*(n-i)+i},__class__:nl};function rl(t,e,i,n){this.destroyed=!1,this.actionTime=0,this.moveSpeed=.5,this.currentAction=2,this.relativeX=2,this.inPermanent=null,this.type=0,this.city=t,this.stage=e,this.type=il.getInt(4),this.sprite=new PIXI.Sprite,e.addChild(this.sprite),this.setTypeSprite(),this.sprite.anchor.set(.5,1),this.inPermanent=i,this.relativeX=n,g.isLoading||this.updateDisplay()}(q["simulation.Animal"]=rl).__name__="simulation.Animal",rl.prototype={destroy:function(){this.sprite.destroy(),at.remove(this.city.simulation.animals.animals,this),this.destroyed=!0},getCityPosition:function(){return new br(this.inPermanent.position.x+this.relativeX,this.inPermanent.position.y+20-1)},onClick:function(){ws.createWindow(this.city,this)},save:function(t){this.saveBasics(t);var e=this.inPermanent.id;if(t.size+4>t.bytes.length){var i=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+4))),t.bytes.blit(0,i,0,t.size)}t.bytes.setInt32(t.size,e),t.size+=4},load:function(t){this.loadBasics(t);var e=this.city.permanentsByID,i=t.bytes.getInt32(t.readStart);t.readStart+=4,this.inPermanent=e.h[i],this.updateDisplay()},update:function(t){var e=this.inPermanent;if(null!=e){var i=null!=e.leftBuilding&&e.leftBuilding.drawer.currentTextureGroupName==e.drawer.currentTextureGroupName,n=null!=e.rightBuilding&&e.rightBuilding.drawer.currentTextureGroupName==e.drawer.currentTextureGroupName;if(i){var r=null!=e.leftBuilding&&e.leftBuilding.is(be);if(r)r&&(null==e.leftBuilding.bottomBuilding||!e.leftBuilding.bottomBuilding.is(be))||(i=!1)}if(n){var s=null!=e.rightBuilding&&e.rightBuilding.is(be);if(s)s&&(null==e.rightBuilding.bottomBuilding||!e.rightBuilding.bottomBuilding.is(be))||(n=!1)}var o=.5*this.sprite.width;switch(this.actionTime<0?(this.currentAction=il.getInt(3),this.actionTime=il.getFloat(10,80),0==this.currentAction?this.sprite.scale.x=1:1==this.currentAction?this.sprite.scale.x=-1:this.sprite.texture=this.textures[0]):this.actionTime-=t,this.currentAction){case 0:this.sprite.texture=this.textures[.4*(this.relativeX+100)%this.textures.length|0],this.relativeX-this.moveSpeed*t<3+o?i?(this.relativeX+=20,this.inPermanent=e.leftBuilding):(this.currentAction=2,this.relativeX=3+o,this.sprite.texture=this.textures[0]):this.relativeX-=this.moveSpeed*t;break;case 1:this.sprite.texture=this.textures[.4*(this.relativeX+100)%this.textures.length|0],this.relativeX+this.moveSpeed*t>20-o-3?n?(this.relativeX-=20,this.inPermanent=e.rightBuilding):(this.currentAction=2,this.relativeX=20-o-3,this.sprite.texture=this.textures[0]):this.relativeX+=this.moveSpeed*t}this.updateDisplay()}},updateDisplay:function(){this.sprite.position.set(this.inPermanent.position.x+this.relativeX,this.inPermanent.position.y+20-3)},postLoad:function(){this.setTypeSprite()},setTypeSprite:function(){switch(this.type){case 0:this.textures=dt.getTexturesByWidth("spr_otherworldcreature_1",7);break;case 1:this.textures=dt.getTexturesByWidth("spr_otherworldcreature_2",7);break;case 2:this.textures=dt.getTexturesByWidth("spr_otherworldcreature_3",7);break;case 3:this.textures=dt.getTexturesByWidth("spr_otherworldcreature_4",8);break;default:this.textures=dt.getTexturesByWidth("spr_otherworldcreature_1",7)}this.sprite.texture=this.textures[0]},pushBackIntoPermanentOrDestroy:function(){if(this.inPermanent.destroyed)this.destroy();else{var t=this.relativeX;this.relativeX=t<0?0:20<t?20:t}},saveBasics:function(t,e){null==e&&(e=!0),e&&t.addString(rl.saveDefinition);var i=this.type;if(t.size+4>t.bytes.length){var n=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+4))),t.bytes.blit(0,n,0,t.size)}t.bytes.setInt32(t.size,i),t.size+=4;i=this.relativeX;if(t.size+8>t.bytes.length){n=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+8))),t.bytes.blit(0,n,0,t.size)}t.bytes.setDouble(t.size,i),t.size+=8},loadBasics:function(t,e){null==e&&(e=t.readString());var i=Dr.makeLoadMap(e,t);Object.prototype.hasOwnProperty.call(i.h,"type")&&(this.type=i.h.type),Object.prototype.hasOwnProperty.call(i.h,"relativeX")&&(this.relativeX=i.h.relativeX),this.postLoad()},__class__:rl};var sl=function(t){this.simulation=t,this.animals=[]};(q["simulation.AnimalManager"]=sl).__name__="simulation.AnimalManager",sl.prototype={update:function(t){for(var e=0,i=this.animals;e<i.length;){var n=i[e];++e,n.update(t)}},save:function(t){var e=this.animals.length;if(t.size+4>t.bytes.length){var i=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+4))),t.bytes.blit(0,i,0,t.size)}t.bytes.setInt32(t.size,e),t.size+=4;for(var n=0,r=this.animals;n<r.length;){var s=r[n];++n,s.save(t)}},load:function(t){var e=t.bytes.getInt32(t.readStart);t.readStart+=4;for(var i=0,n=e;i<n;){i++;var r=new rl(this.simulation.city,this.simulation.city.aboveCitizensInBuildingStage,null,0);r.load(t),this.animals.push(r)}},__class__:sl};var ol=function(t,e){this.totalBabyMakeCapacity=0,this.targetPopAmount=-1,this.mode=0,this.softPopLimit=3e3,this.updateStatsIn=-2,this.city=t,this.simulation=e,this.babyMakerCapacity=new jo,this.babiesPerYear=new jo,this.peoplePerWorld=new jo};(q["simulation.BabyMaker"]=ol).__name__="simulation.BabyMaker",ol.prototype={getCurrentBabyProduction:function(){if(this.simulation.happiness.happiness<10&&this.simulation.stats.peopleWithHome<this.simulation.stats.people/2&&this.city.materials.food<1)return 0;if(this.simulation.happiness.happiness<10)return.8;switch(this.mode){case 0:return 1+this.simulation.happiness.happiness/140/Math.pow((Math.pow(this.simulation.citizens.length,1.2)+500)/1400,.4);case 1:return-1==this.targetPopAmount?1:this.simulation.citizens.length>=this.targetPopAmount?.1:3;case 2:return 1+this.simulation.happiness.happiness/140*.4/Math.pow((Math.pow(this.simulation.citizens.length,1.2)+500)/1400,.4);case 3:return 1+(this.simulation.happiness.happiness/140+Math.max(0,(this.simulation.happiness.happiness-60)/120))/Math.pow((Math.pow(this.simulation.citizens.length,1.2)+500)/1400,.4)}},numberOfNewCitizens:function(){return gr.isum(this.city.simulation.citizenSpawners,function(t){return t.spawn.amount})},update:function(t){this.updateStatsIn<=0&&(this.updateStatsIn+=60,this.updateStats()),this.updateStatsIn-=t;for(var e=this.simulation.time.minutesPerTick*t/60/24,i=0,n=this.city.worlds;i<n.length;){var r=n[i];++i,this.simulation.citizens.length+this.numberOfNewCitizens()<this.softPopLimit&&2<=this.simulation.citizens.length&&2<=this.babyMakerCapacity.h[r.__id__]&&il.getFloat()<this.babiesPerYear.h[r.__id__]*e&&this.createBaby(r)}},createBaby:function(e){if(0!=this.simulation.citizens.length){var t=gr.findRandom(this.simulation.citizens,function(t){return t.onWorld==e&&20<=t.get_age()&&t.get_age()<55}),i=this.simulation.citizens[0];null!=t&&(i=t),this.simulation.createCitizen(i.onWorld,0,i.inPermanent,0|i.relativeX)}},onCitizenDeath:function(){if(this.simulation.citizens.length==this.softPopLimit&&(0==this.totalBabyMakeCapacity&&this.updateStats(),0!=this.totalBabyMakeCapacity)){for(var t=il.getFloat(),e=this.city.worlds[0],i=0,n=this.city.worlds;i<n.length;){var r=n[i];++i,(t-=this.babyMakerCapacity.h[r.__id__]/this.totalBabyMakeCapacity)<=0&&(e=r)}this.createBaby(e)}},updateStats:function(){for(var t=0,e=this.city.worlds;t<e.length;){var i=e[t];++t,this.babyMakerCapacity.set(i,0),this.peoplePerWorld.set(i,0)}var n=0;for(t=0,e=this.simulation.citizens;t<e.length;){var r=e[t];++t;var s=r.get_age(),o=20<=s&&s<45?1:45<=s&&s<55?1-(s-45)/10:0,a=r.onWorld,l=this.babyMakerCapacity,h=l.h[a.__id__]+o;if(l.set(a,h),20<=s){var u=r.onWorld,c=this.peoplePerWorld.h[u.__id__]+1;this.peoplePerWorld.set(u,c)}n+=o}var d=this.getCurrentBabyProduction();for(t=0,e=this.city.worlds;t<e.length;){i=e[t];if(++t,300<this.simulation.citizens.length&&n<.1*this.simulation.citizens.length&&this.babyMakerCapacity.h[i.__id__]<.1*this.peoplePerWorld.h[i.__id__]){h=.1*this.peoplePerWorld.h[i.__id__];this.babyMakerCapacity.set(i,h)}c=this.babyMakerCapacity.h[i.__id__]*d/30;this.babiesPerYear.set(i,c),this.totalBabyMakeCapacity+=this.babyMakerCapacity.h[i.__id__]}},save:function(t,e){null==e&&(e=!0),e&&t.addString(ol.saveDefinition);var i=this.softPopLimit;if(t.size+4>t.bytes.length){var n=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+4))),t.bytes.blit(0,n,0,t.size)}t.bytes.setInt32(t.size,i),t.size+=4;i=this.mode;if(t.size+4>t.bytes.length){n=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+4))),t.bytes.blit(0,n,0,t.size)}t.bytes.setInt32(t.size,i),t.size+=4;i=this.targetPopAmount;if(t.size+4>t.bytes.length){n=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+4))),t.bytes.blit(0,n,0,t.size)}t.bytes.setInt32(t.size,i),t.size+=4},load:function(t,e){null==e&&(e=t.readString());var i=Dr.makeLoadMap(e,t);Object.prototype.hasOwnProperty.call(i.h,"softPopLimit")&&(this.softPopLimit=i.h.softPopLimit),Object.prototype.hasOwnProperty.call(i.h,"mode")&&(this.mode=i.h.mode),Object.prototype.hasOwnProperty.call(i.h,"targetPopAmount")&&(this.targetPopAmount=i.h.targetPopAmount)},__class__:ol};var al=function(){this.waldoFound=!1,this.fossilsCollected=0,this.ecoFarmSpeed=1,this.indoorFarmSpeed=1,this.labSpeed=1,this.machinePartsFactorySpeed=1,this.extraFoodFromFarms=0};(q["simulation.BonusResults"]=al).__name__="simulation.BonusResults",al.prototype={save:function(t,e){null==e&&(e=!0),e&&t.addString(al.saveDefinition);var i=this.extraFoodFromFarms;if(t.size+4>t.bytes.length){var n=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+4))),t.bytes.blit(0,n,0,t.size)}t.bytes.setInt32(t.size,i),t.size+=4;i=this.machinePartsFactorySpeed;if(t.size+8>t.bytes.length){n=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+8))),t.bytes.blit(0,n,0,t.size)}t.bytes.setDouble(t.size,i),t.size+=8;i=this.labSpeed;if(t.size+8>t.bytes.length){n=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+8))),t.bytes.blit(0,n,0,t.size)}t.bytes.setDouble(t.size,i),t.size+=8;i=this.indoorFarmSpeed;if(t.size+8>t.bytes.length){n=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+8))),t.bytes.blit(0,n,0,t.size)}t.bytes.setDouble(t.size,i),t.size+=8;i=this.ecoFarmSpeed;if(t.size+8>t.bytes.length){n=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+8))),t.bytes.blit(0,n,0,t.size)}t.bytes.setDouble(t.size,i),t.size+=8;i=this.fossilsCollected;if(t.size+4>t.bytes.length){n=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+4))),t.bytes.blit(0,n,0,t.size)}t.bytes.setInt32(t.size,i),t.size+=4;i=this.waldoFound;if(t.size+1>t.bytes.length){n=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+1))),t.bytes.blit(0,n,0,t.size)}t.bytes.b[t.size]=i?1:0,t.size+=1},load:function(t,e){null==e&&(e=t.readString());var i=Dr.makeLoadMap(e,t);Object.prototype.hasOwnProperty.call(i.h,"extraFoodFromFarms")&&(this.extraFoodFromFarms=i.h.extraFoodFromFarms),Object.prototype.hasOwnProperty.call(i.h,"machinePartsFactorySpeed")&&(this.machinePartsFactorySpeed=i.h.machinePartsFactorySpeed),Object.prototype.hasOwnProperty.call(i.h,"labSpeed")&&(this.labSpeed=i.h.labSpeed),Object.prototype.hasOwnProperty.call(i.h,"indoorFarmSpeed")&&(this.indoorFarmSpeed=i.h.indoorFarmSpeed),Object.prototype.hasOwnProperty.call(i.h,"ecoFarmSpeed")&&(this.ecoFarmSpeed=i.h.ecoFarmSpeed),Object.prototype.hasOwnProperty.call(i.h,"fossilsCollected")&&(this.fossilsCollected=i.h.fossilsCollected),Object.prototype.hasOwnProperty.call(i.h,"waldoFound")&&(this.waldoFound=i.h.waldoFound)},__class__:al};var ll=T["simulation.ExtraBoostType"]={__ename__:"simulation.ExtraBoostType",__constructs__:["DoubleBoost","TripleBoost","DoubleMaterialReward","TripleMaterialReward"],DoubleBoost:{_hx_index:0,__enum__:"simulation.ExtraBoostType",toString:i},TripleBoost:{_hx_index:1,__enum__:"simulation.ExtraBoostType",toString:i},DoubleMaterialReward:{_hx_index:2,__enum__:"simulation.ExtraBoostType",toString:i},TripleMaterialReward:{_hx_index:3,__enum__:"simulation.ExtraBoostType",toString:i}},hl=function(t){this.boostShownExplainer=!1,this.timeUntilNextExtraBoost=0,this.claimedExtraBoostType=null,this.currentExtraBoostLeft=0,this.currentExtraBoostType=null,this.currentExtraBoostArrow=null,this.disableRewardedAd=!1,this.currentGlobalBoostAmount=1,this.infoButtonShown=!1,this.infoButtonParent=null,this.normalMaxBoost=10800,this.maxBoost=10800,this.boostLeft=0;this.simulation=t,this.city=t.city,this.timeUntilNextExtraBoost=36e3+il.getFloat(36e3),this.boostShownExplainer=!0};(q["simulation.BoostManager"]=hl).__name__="simulation.BoostManager",hl.prototype={update:function(t){0<this.boostLeft?(this.boostLeft-=t,this.currentGlobalBoostAmount=2):this.currentGlobalBoostAmount=1,this.actuallyCreateBoostButtonIfPossible(),this.optionallyCreateExtraBoost(t)},optionallyCreateExtraBoost:function(t){if(!(this.city.simulationSpeed<.1||this.city.pauseGame||this.city.game.isMobile));},getExtraBoostTypeText:function(){if(null==this.currentExtraBoostType)return"";switch(this.currentExtraBoostType._hx_index){case 0:return Tr.lo("2x_boost");case 1:return Tr.lo("3x_boost");case 2:return Tr.lo("double_bonus_boost");case 3:return Tr.lo("triple_bonus_boost")}},getSpecialSuccessText:function(){if(null==this.claimedExtraBoostType)return"";switch(this.claimedExtraBoostType._hx_index){case 0:return Tr.lo("2x_boost_claimed");case 1:return Tr.lo("3x_boost_claimed");case 2:return Tr.lo("double_bonus_boost_claimed");case 3:return Tr.lo("triple_bonus_boost_claimed")}},destroyExtraBoost:function(){null!=this.currentExtraBoostArrow&&(this.currentExtraBoostArrow.destroy(),this.currentExtraBoostArrow=null),this.currentExtraBoostLeft=0,this.currentExtraBoostType=null},createExtraBoost:function(){var t=this;if(null==this.currentExtraBoostArrow){this.currentExtraBoostArrow=new Ds(this.city.gui,this.city.gui.stage,function(){return t.infoButtonShown?t.infoButton:null},function(){return!0},ks.DownHint),this.currentExtraBoostType=il.fromArray([ll.DoubleBoost,ll.DoubleBoost,ll.DoubleBoost,ll.TripleBoost,ll.DoubleMaterialReward,ll.TripleMaterialReward]);this.currentExtraBoostArrow.addText(this.getExtraBoostTypeText()+" "+Tr.lo("claim_within_n_s",[16])),this.currentExtraBoostLeft=960}},boostAvailable:function(){return ra.has("remove_ads"),!(!(pr.adAvailableRewarded()&&this.boostLeft<=0)||this.disableRewardedAd)&&!this.city.progress.sandbox.unlimitedResources},doBoost:function(){var r=this;this.boostLeft<=0&&this.boostAvailable()&&(null!=this.currentExtraBoostType&&0<=this.currentExtraBoostLeft&&(this.claimedExtraBoostType=this.currentExtraBoostType,this.destroyExtraBoost()),pr.showRewardedInterstitial(function(){S.sendEventFirebase("rewarded_complete","rewarded_type","boost"),r.boostLeft=r.normalMaxBoost,r.maxBoost=r.normalMaxBoost;var t="",e=1;if(null!=r.claimedExtraBoostType){switch(r.claimedExtraBoostType._hx_index){case 0:r.boostLeft*=2,r.maxBoost*=2;break;case 1:r.boostLeft*=3,r.maxBoost*=3;break;case 2:e*=2;break;case 3:e*=3}t=r.getSpecialSuccessText(),r.claimedExtraBoostType=null}if(hl.enableExtraReward){r.city.game.mouse.resetPosition();var i=r.getRandomReward(e);i.materials.addToProduction(r.city.simulation.stats),r.city.materials.add(i.materials);var n=null;(n=function(){r.city.gui.createWindow("adRewardWindow"),r.city.gui.setWindowReload(n),$r.create(r.city,r.city.gui,r.city.gui.innerWindowStage,r.city.gui.windowInner,i,t)})(),r.city.gui.clearTutorial()}},function(){r.city.gui.showSimpleWindow(Tr.lo("boost_failed"))},!0))},actuallyCreateBoostButtonIfPossible:function(){null!=this.infoButtonParent&&((0<this.boostLeft||this.boostAvailable())&&!O.boostHidden?this.infoButtonShown||(this.infoButtonShown=!0,this.actuallyCreateBoostButton()):this.infoButtonShown&&(this.infoButtonShown=!1,this.infoButtonParent.removeChild(this.infoButton),this.infoButton=null))},actuallyCreateBoostButton:function(){var e=this,t=this.infoButtonParent,i=this.city.gui.stage,n=this.city.gui;this.infoButton=new cs(this.city.gui,i,t,function(){e.boostLeft<=0&&e.boostAvailable()&&(e.boostShownExplainer||B.hasRemoveAds()?e.doBoost():mo.createWindow(e.city,function(){e.doBoost(),e.boostShownExplainer=!0,Rr.setItem("boostShownExplainer","boostShownExplainer",function(){}),e.city.gui.closeWindow()}))},function(){return 0<e.boostLeft},function(){0<e.boostLeft?n.tooltip.setText(Tr.lo("boost"),Tr.lo("boost_active_description"),Tr.lo("boost_active")):n.tooltip.setText(Tr.lo("boost"),Tr.lo("boost_use_case")+(hl.enableExtraReward?"\n"+Tr.lo("boost_earn_extra_reward"):""))},"spr_transparentbutton_info",10526880,16777215,function(){if(e.boostLeft<=0)return-1;var t=e.boostLeft/e.maxBoost;return t<0?0:1<t?1:t}),this.infoButton.container.fillSecondarySize=!0;var r=n.game.isMobile?3:0,s=n.game.isMobile?2:0;return this.infoButton.container.padding={left:2+r,right:3+r,top:2+r,bottom:1+r},this.infoButton.container.updateSize(),this.infoButton.container.addChild(new ds(this.infoButton.container,i,new PIXI.Sprite(dt.getTexture("spr_icon_boost")))),this.infoButton.container.addChild(new ao(this.infoButton.container,i,null,function(){return Tr.lo("boost")},"Arial15",{left:1+s,right:0,top:2,bottom:0})),this.infoButton.container.minWidth=20,t.insertChild(this.infoButton,0),this.infoButton},getRandomReward:function(t){var e="",i=new L,n=!1,r=!1,s=!1,o=11;switch(.2<this.city.materials.machineParts&&(o=16,n=!0),.2<this.city.materials.refinedMetal&&(o=19,r=!0),.2<this.city.materials.computerChips&&(o=22,s=!0),il.getInt(o)){case 0:e="Lunchbox",i.add(new L(0,0,10));break;case 1:e="Pile of Wood",i.add(new L(25));break;case 2:e="Book",i.add(new L(0,0,0,0,15));break;case 3:e="Alien Candy Bar",i.add(new L(0,0,15,0,5));break;case 4:e="Rock",i.add(new L(0,20,0,0,0));break;case 5:e="Pile of Materials",i.add(new L(il.getInt(10,30),il.getInt(10,30),0,0,0));break;case 6:e="Flower",i.add(new L(5,0,0,0,9));break;case 7:e="Statue",i.add(new L(0,15,0,0,7));break;case 8:e="Comet",i.add(new L(0,20,0,0,15));break;case 9:e="Brick",i.add(new L(0,25,0,0));break;case 10:e=il.fromArray(["Cabbage","Potato","Carrot","Bread"]),i.add(new L(0,0,7));break;case 11:e="Box of Wires",i.add(new L(5,0,0,10,0));break;case 12:e="Toolbox",i.add(new L(0,12,0,9));break;case 13:e="Mechanical Pear",i.add(new L(0,0,1,1,20));break;case 14:e="Beeping Device",i.add(new L(0,10,0,5,2));break;case 15:e="Robot Arm",i.add(new L(0,10,0,10,25));break;case 16:e="Sphere",i.add(new L(0,0,0,0,10,10,0));break;case 17:e="Gem",i.add(new L(0,0,0,0,0,20,0));break;case 18:e="Pile of Pebbles",i.add(new L(0,40,0,0,0,10,0));break;case 19:e="Laptop",i.add(new L(0,0,0,5,0,4,1));break;case 20:e="UFO",i.add(new L(0,0,0,0,15,5,2));break;case 21:e="Flashing Box",i.add(new L(0,20,0,0,8,0,1))}var a,l=il.getFloat(.8),h=!1;l<.05&&!h&&(e="Big "+e,i.multiply(1.5),h=!0),(l-=.05)<.04&&!h&&(e="Mega "+e,i.multiply(2),h=!0),(l-=.04)<.02&&!h&&(e="Giant "+e,i.multiply(3),h=!0),(l-=.02)<.02&&!h&&(e="Smart "+e,i.knowledge+=5,s&&(i.computerChips+=1),h=!0),(l-=.02)<.01&&s&&!h&&(e="Network-Connected "+e,i.computerChips+=2,h=!0),(l-=.01)<.02&&!h&&(e="Edible "+e,(a=i).set_food(a.food+20),h=!0);(l-=.02)<.02&&!h&&(e="Slimy "+e,(a=i).set_food(a.food+5),h=!0);(l-=.02)<.02&&r&&!h&&(e="Cold "+e,i.refinedMetal+=5,h=!0),(l-=.02)<.02&&n&&!h&&-1==e.indexOf("Mechanical")&&(e="Mechanical "+e,i.machineParts+=6,h=!0),(l-=.02)<.02&&!h&&(e="Growing "+e,i.wood+=20,i.multiply(1.5),h=!0),(l-=.02)<.02&&!h&&r&&(e="Metal "+e,i.refinedMetal+=4,h=!0),(l-=.02)<.02&&!h&&(e="Musical "+e,i.wood+=5,i.knowledge+=10,h=!0),(l-=.02)<.02&&!h&&(e="Paper "+e,i.multiply(.5),i.knowledge+=15,h=!0),(l-=.02)<.02&&!h&&n&&(e="Rotating "+e,i.machineParts+=10,h=!0),(l-=.02)<.03&&!h&&(e="Cool-Looking "+e,i.multiply(2.2),i.knowledge+=1,h=!0),(l-=.03)<.02&&!h&&s&&(e="IOT "+e,i.computerChips+=1,h=!0),(l-=.02)<.02&&!h&&(e="Overgrown "+e,i.wood*=3,i.wood+=20,h=!0),(l-=.02)<.01&&!h&&(e="Tiny "+e,i.multiply(.75),h=!0),(l-=.01)<.02&&!h&&s&&(e="Luminous "+e,i.computerChips+=1,i.knowledge+=2,h=!0),(l-=.02)<.02&&!h&&(e="Dark "+e,i.knowledge+=5,i.stone+=2,h=!0),(l-=.02)<.02&&!h&&(e="Stony "+e,i.stone+=20,h=!0),(l-=.02)<.02&&!h&&(e="Ancient "+e,i.stone+=10,h=!0),(l-=.02)<.02&&!h&&(e="Starry "+e,i.stone+=10,i.knowledge+=5,h=!0),(l-=.02)<.02&&!h&&(e="Delicious "+e,(a=i).set_food(a.food+10),h=!0);(l-=.02)<.02&&!h&&(e="Profitable "+e,i.multiply(1.2),(a=i).set_food(a.food+15),h=!0);(l-=.02)<.02&&!h&&(e="Extremely Normal-Looking "+e,h=!0),(l-=.02)<.02&&!h&&r&&(e="Shiny "+e,i.refinedMetal+=10,h=!0),(l-=.02)<.02&&!h&&n&&(e="Dancing "+e,i.machineParts+=8,h=!0),(l-=.02)<.02&&!h&&s&&(e="Computerized "+e,i.computerChips+=2,h=!0),l-=.02;var u=Math.pow(this.city.simulation.stats.materialProduction[ct.findMaterialIndex("wood")][1]+this.city.simulation.stats.materialProduction[ct.findMaterialIndex("stone")][1]+this.city.simulation.stats.materialProduction[ct.findMaterialIndex("food")][1]+this.city.simulation.stats.materialProduction[ct.findMaterialIndex("knowledge")][1],.66)/16,c=1.5<t?2:1;return i.multiply(u<c?c:12<u?12:u),i.multiply(t),i.roundAll(),{text:e,materials:i}},save:function(t,e){null==e&&(e=!0),e&&t.addString(hl.saveDefinition);var i=this.boostLeft;if(t.size+8>t.bytes.length){var n=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+8))),t.bytes.blit(0,n,0,t.size)}t.bytes.setDouble(t.size,i),t.size+=8;i=this.maxBoost;if(t.size+8>t.bytes.length){n=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+8))),t.bytes.blit(0,n,0,t.size)}t.bytes.setDouble(t.size,i),t.size+=8;i=this.normalMaxBoost;if(t.size+8>t.bytes.length){n=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+8))),t.bytes.blit(0,n,0,t.size)}t.bytes.setDouble(t.size,i),t.size+=8},load:function(t,e){null==e&&(e=t.readString());var i=Dr.makeLoadMap(e,t);Object.prototype.hasOwnProperty.call(i.h,"boostLeft")&&(this.boostLeft=i.h.boostLeft),Object.prototype.hasOwnProperty.call(i.h,"maxBoost")&&(this.maxBoost=i.h.maxBoost),Object.prototype.hasOwnProperty.call(i.h,"normalMaxBoost")&&(this.normalMaxBoost=i.h.normalMaxBoost)},__class__:hl};var ul=function(t){this.entertainmentInited=!1,this.tryForDayEntertainment=0,this.tryForEntertainment=0;for(var e=[],i=this.entertainmentFinishedTime=0,n=gl.entertainmentTypeNumber;i<n;){i++;e.push(0)}this.recentEntertainmentTypes=e,this.citizen=t,this.entertainmentInited=!1,this.tryForDayEntertainment=0,this.setAgeRelatedEntertainment()};(q["simulation.CitizenEntertainment"]=ul).__name__="simulation.CitizenEntertainment",ul.prototype={get_normallyAtHomeTimeFrom:function(){var t,e=this.citizen.get_workTimePreference();if(null==this.citizen.job)t=23;else{var i=this.citizen.job.endTime;i+=4,t=i%=24}return e+t},get_normallyAtHomeTimeTo:function(){var t,e=this.citizen.get_workTimePreference();null==this.citizen.job?t=8:t=this.citizen.job.startTime;return e+t},setAgeRelatedEntertainment:function(){this.citizen.get_age()<16&&il.getInt(1e3)<998&&(this.recentEntertainmentTypes[0]=this.citizen.simulation.time.timeSinceStart+1440*(this.citizen.get_age()-il.getFloat(14,16)))},updateEntertainment:function(t){var e,i=!1;if(null!=this.citizen.inPermanent&&this.citizen.inPermanent.isBuilding&&this.citizen.inPermanent.isEntertainment){var n=!0,r=this.citizen.inPermanent,s=this.citizen.simulation.time.timeSinceStart;if(!this.entertainmentInited)if(r.get_isOpen()){var o=1;null==this.citizen.job&&null==this.citizen.school&&(o=.75),this.entertainmentFinishedTime=s+60*il.getFloat(r.get_minimumNormalTimeToSpend(),r.get_maximumNormalTimeToSpend()),this.recentEntertainmentTypes[r.get_entertainmentType()]=s+1440*il.getFloat(r.get_minimumEntertainmentGroupSatisfy(),r.get_maximumEntertainmentGroupSatisfy())*o,this.entertainmentInited=!0}else this.entertainmentFinishedTime=s-1e3;(!r.get_isOpenForExistingVisitors()||s>=this.entertainmentFinishedTime)&&r.finishEntertainment(this.citizen,t)?(n=!1,this.entertainmentInited=!1):r.beEntertained(this.citizen,t),i=n}if(i)return!0;if(16<this.citizen.get_age()&&this.citizen.likesNightclubs){var a=this.citizen.simulation.time.timeSinceStart/60%24;e=(l=23+this.citizen.get_workTimePreference())<(h=6+this.citizen.get_workTimePreference())?l<=a&&a<h:l<=a||a<h}else e=!1;if(e&&this.citizen.wantsNightEntertainmentIn<=0)i=this.searchNightEntertainment();else{var l,h;a=this.citizen.simulation.time.timeSinceStart/60%24;((l=this.get_normallyAtHomeTimeFrom())<(h=this.get_normallyAtHomeTimeTo())?l<=a&&a<h:l<=a||a<h)||(i=this.searchDayEntertainment())}return i},stop:function(){this.entertainmentInited=!1},searchNightEntertainment:function(){if(this.citizen.simulation.time.timeSinceStart>=this.tryForEntertainment){if(!this.citizen.simulation.pathfinder.mayRequestPathNow())return!0;var t=this.citizen,e=il.getFloat()<.02?480:320;return t.simulation.pathfinder.findPathEntertainment(t,e,-1),t.pathOnFail=null,this.entertainmentInited=!1,this.tryForEntertainment=this.citizen.simulation.time.timeSinceStart+120*this.citizen.simulation.time.minutesPerTick,!0}return!1},searchDayEntertainment:function(){var t=this.citizen.simulation.time.timeSinceStart;if(t>=this.tryForDayEntertainment){if(!this.citizen.simulation.pathfinder.mayRequestPathNow())return!0;for(var e=0,i=0,n=this.recentEntertainmentTypes.length;i<n;){var r=i++;t>=this.recentEntertainmentTypes[r]&&(e|=1<<r)}var s=this.citizen,o=il.getFloat()<.02?480:320;return s.simulation.pathfinder.findPathEntertainment(s,o,e),s.pathOnFail=null,this.entertainmentInited=!1,this.tryForDayEntertainment=t+120*this.citizen.simulation.time.minutesPerTick,!0}return!1},__class__:ul};function cl(t){this.citizen=null,this.citizen=t,this.simulation=t.onWorld.city.simulation,this.time=this.simulation.time}(q["simulation.CitizenSpecialAction"]=cl).__name__="simulation.CitizenSpecialAction",cl.prototype={update:function(t){},isActive:function(){return!1},onDie:function(){this.simulation.possibleCitizenHobbies.push({hobbyClass:Ko.getClass(this),minimumCitizenAmount:0})},__class__:cl};var dl=function(t){this.i=0,this.simulation=t};(q["simulation.CitizenUpdater"]=dl).__name__="simulation.CitizenUpdater",dl.prototype={update:function(t){this.i++;for(var e=0,i=this.simulation.citizens;e<i.length;){var n=i[e];++e,n.fullyBeingControlled||(K.shouldUpdateDraw=!1,n.delayCanViewSelfInBuilding&&(n.delayCanViewSelfInBuilding=!1,K.shouldUpdateDraw=!0),n.updatePath(t),null!=n.path||n.isRequestingPath||n.updateDailyLife(t),K.shouldUpdateDraw&&n.actuallyUpdateDraw())}},__class__:dl};var pl=function(t){this.city=t};(q["simulation.CityConnections"]=pl).__name__="simulation.CityConnections",pl.prototype={updateCityConnections:function(){var P=this;this.city.simulation.flyingPathfinder.updateWaypoints();var C=this.city.worlds,t=this.city.permanents,e=[];this.city.permanentsByPosition=null;for(var i=0;i<t.length;){var n=t[i];++i,n.isBuilding&&(n.leftBuilding=null,n.rightBuilding=null,n.topBuilding=null,n.bottomBuilding=null)}this.elevatorConnections=new jo;for(i=0;i<C.length;){var r=C[i];++i;var s=[];this.elevatorConnections.set(r,s);for(var o=0,a=r.permanents.length-1;o<a;)for(var l=o++,h=r.permanents[l],u=r.permanents[l+1],c=0,d=h.length,p=u.length,f=p<d?p:d;c<f;){var g=c++,m=h[g],y=u[g];if(null!=m&&null!=y&&m.isBuilding&&y.isBuilding){var _=m,v=y;_.cannotBuildOnTop||v.cannotBuildOnTop||((_.rightBuilding=v).leftBuilding=_)}}for(var b=0,w=r.permanents;b<w.length;){var S=w[b];++b;var x=[];s.push(x);for(var T=0;T<S.length;){var I=S[T];++T,null!=I&&I.is(ci)&&x.push(I)}for(var E=0,A=S.length-1;E<A;){var M=E++,B=S[M],R=S[1+M];null!=B&&null!=R&&B.isBuilding&&R.isBuilding&&!B.isRooftopBuilding&&((B.topBuilding=R).bottomBuilding=B)}}}for(i=0,o=this.city.teleporters;i<o.length;){var O=o[i];++i,-1==e.indexOf(O.world)&&e.push(O.world)}var k=this.city.simulation;this.landingSiteGroups=[];for(i=0,o=this.city.landingSites;i<o.length;){var D=o[i];++i,D.landingSiteGroup=null}for(i=0,o=this.city.landingSites;i<o.length;){D=o[i];++i;var F=!1,N=k.flyingPathfinder.findAnyOtherLandingSite(D);null!=N&&(F=!0,D.landingSiteGroup=N.landingSiteGroup,this.landingSiteGroups[N.landingSiteGroup].push(D)),F||(D.landingSiteGroup=this.landingSiteGroups.length,this.landingSiteGroups.push([D]))}for(i=this.directWorldConnectionNumber=0;i<C.length;){r=C[i];++i,-1!=e.indexOf(r)?r.reachableWorlds=e:r.reachableWorlds=[r]}for(i=0,o=this.landingSiteGroups;i<o.length;){var L=o[i];++i;var U=null;for(a=0;a<L.length;){var z=L[a];if(++a,null==U)U=z.world.reachableWorlds;else if(z.world.reachableWorlds!=U){for(c=0,f=z.world.reachableWorlds;c<f.length;){var W=f[c];++c,-1==U.indexOf(W)&&U.push(W),W.reachableWorlds=U}z.world.reachableWorlds=U}}}for(i=0,o=this.city.miscCityElements.allMiscElements;i<o.length;){var G=o[i];if(++i,G.is(Qo)){var H=G;if(null!=H.leftBuilding&&null!=H.rightBuilding&&H.leftBuilding.world!=H.rightBuilding.world){var X=H.leftBuilding.world,j=H.rightBuilding.world;U=X.reachableWorlds;if(j.reachableWorlds!=U){for(a=0,c=j.reachableWorlds;a<c.length;){W=c[a];++a,-1==U.indexOf(W)&&U.push(W),W.reachableWorlds=U}j.reachableWorlds=U}}}}for(i=0;i<C.length;){r=[C[i]];++i;var V=[null!=r[0].relevantWorldsForDirectCityConnectionsCache],Y=[V[0]?r[0].relevantWorldsForDirectCityConnectionsCache:C];V[0]||(r[0].relevantWorldsForDirectCityConnectionsCache=[]);var q=function(x,T,I){return function(t,e,i){if(null!=e)for(var n=0;n<x[0].length;){var r=x[0][n];if(++n,(r.rect.y>I[0].rect.y||r.rect.y==I[0].rect.y&&r.rect.x>I[0].rect.x)&&r.rect.x%20==I[0].rect.x%20&&r.rect.y%20==I[0].rect.y%20){var s=((e-r.rect.x)/20|0)+i;if(0<=s&&s<r.permanents.length){T[0]||-1!=I[0].relevantWorldsForDirectCityConnectionsCache.indexOf(r)||I[0].relevantWorldsForDirectCityConnectionsCache.push(r);var o=r.permanents[s],a=(r.rect.y-I[0].rect.y)/20|0;if(o.length>a){for(var l=!1,h=0,u=t.length,c=o.length-a,d=c<u?c:u;h<d;){var p=h++,f=t[p],g=o[p+a];if(null!=f&&null!=g&&f.isBuilding&&g.isBuilding){var m=f,y=g;m.cannotBuildOnTop||y.cannotBuildOnTop||(1==i?(m.rightBuilding=y).leftBuilding=m:(m.leftBuilding=y).rightBuilding=m,l=!0,P.directWorldConnectionNumber+=2)}}if(l){var _=I[0].reachableWorlds;if(I[0].reachableWorlds!=r.reachableWorlds){I[0].reachableWorlds=r.reachableWorlds;for(var v=0;v<_.length;){var b=_[v];++v,-1==I[0].reachableWorlds.indexOf(b)&&I[0].reachableWorlds.push(b)}}for(var w=0;w<C.length;){var S=C[w];++w,S.reachableWorlds==_&&(S.reachableWorlds=I[0].reachableWorlds)}}}}}}}}(Y,V,r);q(r[0].permanents[0],r[0].rect.x,-1),q(r[0].permanents[r[0].permanents.length-1],r[0].rect.x+20*(r[0].permanents.length-1),1)}var K=0;for(i=0,o=this.city.worlds;i<o.length;){var $=o[i];++i,$.worldGroup=null}for(i=0,o=this.city.worlds;i<o.length;){$=o[i];if(++i,null==$.worldGroup){var Q=!1;-1!=e.indexOf($)&&(Q=!0);for(a=0,c=$.reachableWorlds;a<c.length;){var J=c[a];++a,J.worldGroup=K,J.hasTeleporterOnGroup=Q}++K}}for(i=0,o=this.city.permanents.length;i<o;){l=i++;this.city.permanents[l].tempId=l}this.floodFillPermanentGroups(),this.numberOfWorldGroups=K,null!=this.city.builder&&this.city.builder.invalidateCache()},floodFillPermanentGroups:function(){for(var t=[],e=0,i=this.city.permanents.length;e<i;){var n=e++;t.push(!1)}var r=t;for(t=[],e=0,i=this.city.worlds.length;e<i;){n=e++;t.push(!1)}var s=t,o=!1;for(t=[],e=0,i=this.landingSiteGroups.length;e<i;){n=e++;t.push(!1)}var a=t;for(t=[],e=0,i=this.city.permanents.length;e<i;){n=e++;t.push(-1)}var l=t;for(t=[],e=0,i=this.city.permanents.length;e<i;){n=e++;t.push(-1)}var h=t;for(t=0,e=this.city.worlds.length;t<e;){n=t++;this.city.worlds[n].tempId=n,this.city.worlds[n].surfaceShardId=-1}var u=0;this.permanentsByShard=[];for(t=0,e=this.city.miscCityElements.allMiscElements;t<e.length;){var c=e[t];if(++t,c.is(Qo)){var d=c;null!=d.leftBuilding&&null!=d.rightBuilding&&(l[d.rightBuilding.tempId]=d.leftBuilding.tempId,h[d.leftBuilding.tempId]=d.rightBuilding.tempId)}}for(t=0,e=this.city.permanents.length;t<e;){if(!r[n=t++]){this.permanentsByShard[u]=[];var p=this.city.permanents[n];r[p.tempId]=!0;for(var f=[p];0<f.length;){var g=f.pop();if(g.shardId=u,this.permanentsByShard[u].push(g),g.isBuilding){var m=g,y=m.leftBuilding;null==y||r[y.tempId]||(r[y.tempId]=!0,f.push(y)),null==(y=m.topBuilding)||r[y.tempId]||(r[y.tempId]=!0,f.push(y)),null==(y=m.bottomBuilding)||r[y.tempId]||(r[y.tempId]=!0,f.push(y)),null==(y=m.rightBuilding)||r[y.tempId]||(r[y.tempId]=!0,f.push(y));var _=l[m.tempId];if(null==(y=this.city.permanents[_])||r[y.tempId]||(r[y.tempId]=!0,f.push(y)),_=h[m.tempId],null==(y=this.city.permanents[_])||r[y.tempId]||(r[y.tempId]=!0,f.push(y)),!o&&g.is(dn)){i=0;for(var v=this.city.teleporters;i<v.length;){var b=v[i];++i,r[b.tempId]||(r[b.tempId]=!0,f.push(b))}o=!0}if(g.is(mi)){var w=g.landingSiteGroup;if(!a[w]){for(var S=0,x=this.landingSiteGroups[w];S<x.length;){var T=x[S];++S,r[T.tempId]||(r[T.tempId]=!0,f.push(T))}a[w]=!0}}}if(0==g.worldPosition.y&&!s[g.world.tempId]){s[g.world.tempId]=!0,g.world.surfaceShardId=u;for(var I=0,P=g.world.permanents;I<P.length;){var C=P[I];++I,0<C.length&&null!=C[0]&&!r[C[0].tempId]&&(r[C[0].tempId]=!0,f.push(C[0]))}}}++u}}for(t=0,e=this.city.worlds.length;t<e;){n=t++;-1==this.city.worlds[n].surfaceShardId&&(this.city.worlds[n].surfaceShardId=u,this.permanentsByShard[u]=[],++u)}this.numberOfShards=u},__class__:pl};var fl=function(t){this.foodRationing=!1,this.currentFoodSaveByHerbsPct=0,this.herbsCap=0,this.foodShortage=0,this.totalConsumedFoodPerDay=-1,this.simulation=t};(q["simulation.Eating"]=fl).__name__="simulation.Eating",fl.prototype={update:function(t){var e=this.simulation.time.timeSinceStart/60%24;0!=this.totalConsumedFoodPerDay?this.currentFoodSaveByHerbsPct=Math.min(1,this.herbsCap/this.totalConsumedFoodPerDay):this.currentFoodSaveByHerbsPct=0;var i=.2*Math.min(this.totalConsumedFoodPerDay,this.herbsCap);if(this.totalConsumedFoodPerDay=this.simulation.citizens.length-.5*this.simulation.stats.children,this.totalConsumedFoodPerDay-=i,this.foodRationing&&(this.totalConsumedFoodPerDay*=.5),7<=e&&e<20){var n=this.simulation.time.minutesPerTick*t/60/13,r=Math.max(0,this.totalConsumedFoodPerDay*n),s=Math.min(this.simulation.city.materials.food,r);(a=(o=this.simulation.city).materials).set_food(a.food-s),o.simulation.stats.materialUsed[0][0]+=s,this.foodShortage+=r-s,this.foodShortage=Math.min(this.foodShortage,Math.ceil(this.totalConsumedFoodPerDay/2))}if(0<this.foodShortage&&.1<this.simulation.city.materials.food){var o,a,l=Math.min(this.simulation.city.materials.food,this.foodShortage);this.foodShortage-=l,(a=(o=this.simulation.city).materials).set_food(a.food-l),o.simulation.stats.materialUsed[0][0]+=l,0<this.simulation.city.materials.food&&(this.foodShortage=0)}},getFoodText:function(){var t="";return this.foodRationing&&(t=Tr.lo("rationing_halves_this")+" "),Tr.lo("food_description_1")+"\n"+Tr.lo("food_description_2")+" "+t+(this.currentFoodSaveByHerbsPct<1e-4?"":Tr.lo("food_description_3",[Math.round(.2*this.currentFoodSaveByHerbsPct*100),20])+" ")+(-1==this.totalConsumedFoodPerDay?"":Tr.lo("food_description_4",[0|this.totalConsumedFoodPerDay]))},save:function(t,e){null==e&&(e=!0),e&&t.addString(fl.saveDefinition);var i=this.foodShortage;if(t.size+8>t.bytes.length){var n=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+8))),t.bytes.blit(0,n,0,t.size)}t.bytes.setDouble(t.size,i),t.size+=8},load:function(t,e){null==e&&(e=t.readString());var i=Dr.makeLoadMap(e,t);Object.prototype.hasOwnProperty.call(i.h,"foodShortage")&&(this.foodShortage=i.h.foodShortage)},__class__:fl};var gl=function(){};(q["simulation.EntertainmentTypeHelpers"]=gl).__name__="simulation.EntertainmentTypeHelpers",gl.getName=function(t){switch(t){case 0:return Tr.lo("night_clubs");case 1:return Tr.lo("pubs_restaurants");case 2:return Tr.lo("art");case 3:return Tr.lo("nature");case 4:return Tr.lo("gaming");case 5:return Tr.lo("libraries")}};function ml(t,e,i,n,r){this.destroyed=!1,this.verticalHeightToUse=0,this.verticalWidthToUse=0,this.startSlowingProb=.05,this.stopMoveProb=.2,this.normalSlowdown=.1,this.normalAcceleration=.05,this.maxSpeed=.6,this.stopSpeedSpeed=.4,this.slowing=!1,this.speeding=!1,this.moveSpeed=0,this.relativeY=2,this.relativeX=2,this.inPermanent=null,this.spriteCanBeRotated=!1,this.height=1,this.width=2,this.type=0,this.city=t,this.stage=e,this.type=il.getInt(11),this.sprite=new PIXI.Sprite,e.addChild(this.sprite),this.setTypeSprite(),this.sprite.anchor.set(.5,.5),this.inPermanent=i,this.relativeX=n,this.relativeY=r,this.moveDirection=0,this.moveSpeed=0,g.isLoading||this.updateDisplay()}(q["simulation.Fish"]=ml).__name__="simulation.Fish",ml.prototype={destroy:function(){this.sprite.destroy(),at.remove(this.city.simulation.fishes.fishes,this),this.destroyed=!0},getCityPosition:function(){return new br(this.inPermanent.position.x+this.relativeX,this.inPermanent.position.y+this.relativeY)},onClick:function(){xs.createWindow(this.city,this)},save:function(t){this.saveBasics(t);var e=this.inPermanent.id;if(t.size+4>t.bytes.length){var i=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+4))),t.bytes.blit(0,i,0,t.size)}t.bytes.setInt32(t.size,e),t.size+=4},load:function(t){this.loadBasics(t);var e=this.city.permanentsByID,i=t.bytes.getInt32(t.readStart);t.readStart+=4,this.inPermanent=e.h[i],this.updateDisplay()},update:function(t){if(0<this.moveSpeed||this.speeding){var e=0;switch(this.moveDirection){case 0:(e=this.leftMovePotential())<=0?(this.moveSpeed=0,this.speeding=!1,this.slowing=!1):this.relativeX-=Math.min(e,t*this.moveSpeed);break;case 1:(e=this.topMovePotential())<=0?(this.moveSpeed=0,this.speeding=!1,this.slowing=!1):this.relativeY-=Math.min(e,t*this.moveSpeed);break;case 2:(e=this.rightMovePotential())<=0?(this.moveSpeed=0,this.speeding=!1,this.slowing=!1):this.relativeX+=Math.min(e,t*this.moveSpeed);break;case 3:(e=this.bottomMovePotential())<=0?(this.moveSpeed=0,this.speeding=!1,this.slowing=!1):this.relativeY+=Math.min(e,t*this.moveSpeed)}var i=this.inPermanent;this.relativeX<0&&i.leftIsWaterFilled&&(this.relativeX+=20,this.inPermanent=i.leftAsWaterFilled),this.relativeY<0&&i.topIsWaterFilled&&(this.relativeY+=20,this.inPermanent=i.topAsWaterFilled),20<=this.relativeX&&i.rightIsWaterFilled&&(this.relativeX-=20,this.inPermanent=i.rightAsWaterFilled),20<=this.relativeY&&i.bottomIsWaterFilled&&(this.relativeY-=20,this.inPermanent=i.bottomAsWaterFilled),this.speeding?(this.moveSpeed=Math.min(this.maxSpeed,this.moveSpeed+this.normalAcceleration*t),(this.moveSpeed>this.stopSpeedSpeed&&il.getFloat(1)<this.stopMoveProb*t||e<2)&&(this.speeding=!1)):this.slowing?this.moveSpeed=Math.max(0,this.moveSpeed-this.normalSlowdown*t):(il.getFloat(1)<this.startSlowingProb*(5/(e<1?1:15<e?15:e))*t||e<3)&&(this.slowing=!0)}if(0==this.moveSpeed){var n=il.getInt(12);0==n||4==n||0==this.moveDirection&&11==n?3<this.leftMovePotential()&&(this.moveDirection=0,this.speeding=!0,this.slowing=!1):1==n||5==n||2==this.moveDirection&&11==n?3<this.rightMovePotential()&&(this.moveDirection=2,this.speeding=!0,this.slowing=!1):2==n||1==this.moveDirection&&10<=n?3<this.topMovePotential()&&(this.moveDirection=1,this.speeding=!0,this.slowing=!1):3==n||3==this.moveDirection&&10<=n?3<this.bottomMovePotential()&&(this.moveDirection=3,this.speeding=!0,this.slowing=!1):(this.speeding=!1,this.slowing=!1)}this.updateDisplay()},leftMovePotential:function(){var t=0,e=this.inPermanent;return t+=this.relativeX-this.width/2-3,null!=e&&null!=(e=e.leftAsWaterFilled)&&(this.relativeY>3+this.height/2||e.topIsWaterFilled)&&(this.relativeY<17-this.height/2||e.bottomIsWaterFilled)&&(t+=20),t},rightMovePotential:function(){var t=0,e=this.inPermanent;return t+=17-this.width/2-this.relativeX,null!=e&&null!=(e=e.rightAsWaterFilled)&&(this.relativeY>3+this.height/2||e.topIsWaterFilled)&&(this.relativeY<17-this.height/2||e.bottomIsWaterFilled)&&(t+=20),t},topMovePotential:function(){var t=0,e=this.inPermanent;return t+=this.relativeY-this.verticalWidthToUse/2-3,null!=e&&null!=(e=e.topAsWaterFilled)&&(this.relativeX>3+this.verticalHeightToUse/2||e.leftIsWaterFilled)&&(this.relativeX<17-this.verticalHeightToUse/2||e.rightIsWaterFilled)&&(t+=20),t},bottomMovePotential:function(){var t=0,e=this.inPermanent;return t+=17-this.verticalWidthToUse/2-this.relativeY,null!=e&&null!=(e=e.bottomAsWaterFilled)&&(this.relativeX>3+this.verticalHeightToUse/2||e.leftIsWaterFilled)&&(this.relativeX<17-this.verticalHeightToUse/2||e.rightIsWaterFilled)&&(t+=20),t},updateDisplay:function(){this.sprite.position.set(this.inPermanent.position.x+this.relativeX,this.inPermanent.position.y+this.relativeY),this.spriteCanBeRotated&&(1==this.moveDirection?this.sprite.rotation=1.5*Math.PI:3==this.moveDirection?this.sprite.rotation=.5*Math.PI:2==this.moveDirection?this.sprite.rotation=0:this.sprite.rotation=Math.PI)},postLoad:function(){this.setTypeSprite()},setTypeSprite:function(){var t=dt.getTexturesByWidth("spr_fish",2),e=dt.getTexturesByWidth("spr_fish_jelly",5),i=dt.getTexturesByWidth("spr_fish_big",4),n=dt.getTexturesByWidth("spr_fish_snake",8),r=dt.getTexturesByWidth("spr_fish_big2",5);switch(this.spriteCanBeRotated=!1,this.type){case 0:this.sprite.texture=t[0],this.spriteCanBeRotated=!0;break;case 1:this.sprite.texture=t[1],this.spriteCanBeRotated=!0;break;case 2:this.sprite.texture=e[0],this.maxSpeed=.4,this.stopSpeedSpeed=.2,this.normalAcceleration=.025,this.normalSlowdown=.025,this.spriteCanBeRotated=!1,this.stopMoveProb=.03,this.startSlowingProb=.1;break;case 3:this.sprite.texture=i[0],this.spriteCanBeRotated=!0;break;case 4:this.sprite.texture=n[0],this.spriteCanBeRotated=!0,this.maxSpeed=.3,this.stopSpeedSpeed=.2,this.normalAcceleration=.02,this.normalSlowdown=.02,this.stopMoveProb=.02,this.startSlowingProb=.1;break;case 5:this.sprite.texture=t[2],this.spriteCanBeRotated=!0;break;case 6:this.sprite.texture=i[1],this.spriteCanBeRotated=!0;break;case 7:this.sprite.texture=r[0],this.spriteCanBeRotated=!0;break;case 8:this.sprite.texture=t[3],this.spriteCanBeRotated=!0;break;case 9:this.sprite.texture=t[4],this.spriteCanBeRotated=!0;break;case 10:this.sprite.texture=i[2],this.spriteCanBeRotated=!0}this.width=Math.round(this.sprite.texture.width),this.height=Math.round(this.sprite.texture.height),this.spriteCanBeRotated?(this.verticalWidthToUse=this.width,this.verticalHeightToUse=this.height):(this.verticalWidthToUse=this.height,this.verticalHeightToUse=this.width)},pushBackIntoPermanent:function(){var t=this.inPermanent,e=1==this.moveDirection||3==this.moveDirection?this.verticalHeightToUse:this.width,i=1==this.moveDirection||3==this.moveDirection?this.verticalWidthToUse:this.height;!t.leftIsWaterFilled&&this.relativeX<3+e/2&&(this.relativeX=3+e/2),!t.topIsWaterFilled&&this.relativeY<3+i/2&&(this.relativeY=3+i/2),!t.rightIsWaterFilled&&this.relativeX>17-e/2&&(this.relativeX=17-e/2),!t.bottomIsWaterFilled&&this.relativeY>17-i/2&&(this.relativeY=17-i/2)},saveBasics:function(t,e){null==e&&(e=!0),e&&t.addString(ml.saveDefinition);var i=this.type;if(t.size+4>t.bytes.length){var n=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+4))),t.bytes.blit(0,n,0,t.size)}t.bytes.setInt32(t.size,i),t.size+=4;i=this.relativeX;if(t.size+8>t.bytes.length){n=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+8))),t.bytes.blit(0,n,0,t.size)}t.bytes.setDouble(t.size,i),t.size+=8;i=this.relativeY;if(t.size+8>t.bytes.length){n=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+8))),t.bytes.blit(0,n,0,t.size)}t.bytes.setDouble(t.size,i),t.size+=8},loadBasics:function(t,e){null==e&&(e=t.readString());var i=Dr.makeLoadMap(e,t);Object.prototype.hasOwnProperty.call(i.h,"type")&&(this.type=i.h.type),Object.prototype.hasOwnProperty.call(i.h,"relativeX")&&(this.relativeX=i.h.relativeX),Object.prototype.hasOwnProperty.call(i.h,"relativeY")&&(this.relativeY=i.h.relativeY),this.postLoad()},__class__:ml};var yl=function(t){this.simulation=t,this.fishes=[]};(q["simulation.FishManager"]=yl).__name__="simulation.FishManager",yl.prototype={update:function(t){for(var e=0,i=this.fishes;e<i.length;){var n=i[e];++e,n.update(t)}},save:function(t){var e=this.fishes.length;if(t.size+4>t.bytes.length){var i=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+4))),t.bytes.blit(0,i,0,t.size)}t.bytes.setInt32(t.size,e),t.size+=4;for(var n=0,r=this.fishes;n<r.length;){var s=r[n];++n,s.save(t)}},load:function(t){var e=t.bytes.getInt32(t.readStart);t.readStart+=4;for(var i=0,n=e;i<n;){i++;var r=new ml(this.simulation.city,this.simulation.city.aboveCitizensInBuildingStage,null,0,0);r.load(t),this.fishes.push(r)}},__class__:yl};function _l(){}(q["simulation.Vehicle"]=_l).__name__="simulation.Vehicle",_l.prototype={get_citizenOffset:function(){return new br(0,0)},__class__:_l};var vl=function(t,e,i,n,r){this.stage=e,this.simulation=t,this.start=n,this.destination=r,this.pathPos=i.length-1,this.position=new br(i[this.pathPos].x,i[this.pathPos].y),this.sprite=dt.makeSprite(n.get_saucherTexture()),this.sprite.position.set(this.position.x,this.position.y),e.addChild(this.sprite),this.path=i,this.passengers=[],this.leavingIn=12,n.currentlyLandedSaucer=this};(q["simulation.FlyingSaucer"]=vl).__name__="simulation.FlyingSaucer",vl.__super__=_l,vl.prototype=e(_l.prototype,{get_citizenOffset:function(){return new br(9,16)},setDestination:function(t,e){this.path=e,this.pathPos=this.path.length-1,this.destination=t},addPassenger:function(t){this.passengers.push(t),this.start.timesUsed++},destroy:function(){at.remove(this.simulation.flyingSaucers,this),this.sprite.destroy()},cancel:function(){for(var t=0,e=this.passengers;t<e.length;){var i=e[t];++t,i.fullyBeingControlled=!1,i.canViewSelfInBuilding=!0,i.recyclePathArray&&(ka.returnToPool(i.path),i.recyclePathArray=!1),i.path=null,i.nextPathPos=-1,i.pathEnd=-1,i.currentPathAction=-2,i.canViewSelfInBuilding||(i.delayCanViewSelfInBuilding=!0),i.canViewSelfInBuilding=!0,i.verticalPathProgress=0,i.pathEndFunction=null,i.requestingPathGoal=null,i.pathOnlyRelatedTo=null,i.pathWalkSpeed=1,i.pathCanBeReconsidered=!0,0<i.sprite.alpha&&i.sprite.alpha<1&&(i.sprite.alpha=1)}this.destroy()},update:function(t){if(0<this.leavingIn)return this.leavingIn-=t,void(this.leavingIn<=0&&(this.start.currentlyLandedSaucer=null,this.startedOn=this.simulation.time.timeSinceStart));for(var e=3*t;0<e;){var i=this.path[this.pathPos].x,n=this.path[this.pathPos].y;if(.01<Math.abs(this.position.x-i)){var r=i-this.position.x;this.position.x+=(0<r?1:r<0?-1:0)*Math.min(e,Math.abs(r)),e-=Math.abs(r)}else if(.01<Math.abs(this.position.y-n)){var s=n-this.position.y;this.position.y+=(0<s?1:s<0?-1:0)*Math.min(e,Math.abs(s)),e-=Math.abs(s)}else{if(this.position.x=i,this.position.y=n,0==this.pathPos){for(var o=0,a=this.passengers;o<a.length;){var l=a[o];++o,l.fullyBeingControlled=!1,null!=l.inPermanent&&l.inPermanent.onCitizenLeave(l,this.destination),l.inPermanent=this.destination,l.onWorld=l.inPermanent.world,l.inBuildingSince=l.city.simulation.time.timeSinceStart,l.currentPathActionPermanent!=this.destination?this.destination.timesUsedStopOver++:this.destination.timesUsedTo++}return this.destination.addFlyingSaucer(),this.destroy(),void(this.simulation.time.timeSinceStart>this.startedOn+1440&&dr.achieve("SPACESHIP_FLIGHT_TIME"))}this.pathPos--}}this.sprite.position.set(this.position.x,this.position.y)},__class__:vl});function bl(t,e,i,n){this.destroyed=!1,this.relativeY=0,this.grav=0,this.relativeX=10,this.dir=1,this.city=t,this.stage=e,this.onWorld=i,this.relativeX=n,this.textures=dt.getTexturesByWidth("spr_frog",7),this.sprite=new PIXI.Sprite(this.textures[0]),this.sprite.anchor.set(.5,1),this.dir=-2*il.getInt(2)+1,e.addChild(this.sprite),this.updateDisplay()}(q["simulation.Frog"]=bl).__name__="simulation.Frog",bl.prototype={destroy:function(){this.sprite.destroy(),this.destroyed=!0},onClick:function(){Ts.createWindow(this.city,this)},update:function(t){0<this.relativeY?(this.relativeY+=this.grav,this.grav-=.1,this.relativeY<0&&(this.relativeY=0,this.grav=0),this.relativeX+=this.dir*t):(1==this.dir?this.relativeX>this.onWorld.rect.width-40&&(this.dir=-1):this.relativeX<40&&(this.dir=1),il.getFloat(1)<.05&&(this.grav=il.getFloat(1.2,1.5),this.relativeY+=.1)),this.updateDisplay(),6<this.city.simulation.time.timeSinceStart/60%24&&this.city.simulation.time.timeSinceStart/60%24<12&&(this.sprite.alpha=Math.max(0,1-(this.city.simulation.time.timeSinceStart/60%24-6)))},getCityPosition:function(){return new br(this.onWorld.rect.x+this.relativeX,this.onWorld.rect.y-this.relativeY-3.5)},updateDisplay:function(){this.sprite.position.x=this.onWorld.rect.x+this.relativeX,this.sprite.position.y=this.onWorld.rect.y-this.relativeY,this.sprite.scale.x=this.dir,this.sprite.texture=this.textures[0<this.relativeY?1:0]},save:function(t){this.saveBasics(t)},load:function(t){46<=t.version&&this.loadBasics(t),this.updateDisplay()},saveBasics:function(t,e){null==e&&(e=!0),e&&t.addString(bl.saveDefinition);var i=this.relativeX;if(t.size+8>t.bytes.length){var n=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+8))),t.bytes.blit(0,n,0,t.size)}t.bytes.setDouble(t.size,i),t.size+=8},loadBasics:function(t,e){null==e&&(e=t.readString());var i=Dr.makeLoadMap(e,t);Object.prototype.hasOwnProperty.call(i.h,"relativeX")&&(this.relativeX=i.h.relativeX)},__class__:bl};var wl=function(t){this.simulation=t,this.frogs=[]};(q["simulation.FrogManager"]=wl).__name__="simulation.FrogManager",wl.prototype={update:function(t){if(7<this.simulation.time.timeSinceStart/60%24&&this.simulation.time.timeSinceStart/60%24<12){for(var e=0,i=this.frogs;e<i.length;){var n=i[e];++e,n.destroy()}this.frogs=[]}else for(e=0,i=this.frogs;e<i.length;){n=i[e];++e,n.update(t)}},save:function(t){var e=this.frogs.length;if(t.size+4>t.bytes.length){var i=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+4))),t.bytes.blit(0,i,0,t.size)}t.bytes.setInt32(t.size,e),t.size+=4;for(var n=0,r=this.frogs;n<r.length;){var s=r[n];++n;e=s.onWorld.id;if(t.size+4>t.bytes.length){i=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+4))),t.bytes.blit(0,i,0,t.size)}t.bytes.setInt32(t.size,e),t.size+=4,s.save(t)}},load:function(t){var e=t.bytes.getInt32(t.readStart);t.readStart+=4;for(var i=0,n=e;i<n;){i++;var r=[0];if(46<=t.version){var s=r;e=t.bytes.getInt32(t.readStart);t.readStart+=4,s[0]=e}var o=lt.find(this.simulation.city.worlds,function(e){return function(t){return t.id==e[0]}}(r)),a=new bl(this.simulation.city,this.simulation.city.justAboveCitizensForegroundStage,o,0);a.load(t),this.frogs.push(a)}},__class__:wl};function Sl(t){this.sculpturesHappiness=0,this.expensiveRestaurantHappiness=0,this.highEndHomeHappiness=0,this.gloryOfTheKeyHappiness=0,this.city=t}(q["simulation.GloryOfTheKey"]=Sl).__name__="simulation.GloryOfTheKey",Sl.prototype={get_simulation:function(){return this.city.simulation},updateHappiness:function(){for(var t=0,e=0,i=0,n=0,r=this.city.permanents;n<r.length;){var s=r[n];++n,s.is(xn)||s.is(Ze)?++t:s.is(wi)?++e:(s.is(nn)||s.is(rn)||s.is(sn))&&++i}var o=16e3*t/(this.get_simulation().citizens.length+1);this.highEndHomeHappiness=o<0?0:100<o?100:o;o=11e3*e/(this.get_simulation().citizens.length+1);this.expensiveRestaurantHappiness=o<0?0:100<o?100:o;o=5e3*i/(this.get_simulation().citizens.length+1);this.sculpturesHappiness=o<0?0:100<o?100:o;o=(this.highEndHomeHappiness+this.expensiveRestaurantHappiness+this.sculpturesHappiness)/3+.01;this.gloryOfTheKeyHappiness=o<0?0:100<o?100:o},__class__:Sl};var xl=function(t,e){this.gloryOfTheKey=null,this.healthCapacityByType=null,this.veryUnhappyFromDay=-1,this.lastShownVeryUnhappyWarning=-1,this.shouldUpdateHappinessIn=0,this.happinessEnthusiasmLevel=0,this.actualHappiness=0,this.ignoreUnhappyCitizens=!1,this.numberOfGroupsWithCitizens=0,this.lastRestoreTime=-1,this.lastOvertimeDay=-1,this.lastOvertime=0,this.overtimeStarted=0,this.overtimeUnhappinessShown=0,this.overtimeUnhappinessActual=0,this.foodRationingUnhappiness=0,this.foodShortageUnhappiness=0,this.enthusiasmHappiness=0,this.fullHappinessTimeout=0,this.fullHappinessTime=0,this.happiness=-1,this.city=t,this.simulation=e,this.entertainmentTypes=[0,1,2,3,4],at.remove(this.entertainmentTypes,5);for(var i=[],n=0,r=this.entertainmentTypes.length;n<r;){n++;i.push(0)}this.happinessPerEntertainmentType=i,this.actionSpeedModifierWithoutPenalties=1,this.happinessBoosts=[],(i=[]).push(0),i.push(0),i.push(0),i.push(0),i.push(0),i.push(0),i.push(0),i.push(0),i.push(0),i.push(0),this.healthCapacityByType=i};(q["simulation.Happiness"]=xl).__name__="simulation.Happiness",xl.prototype={set_happiness:function(t){return this.actionSpeedModifier=t<=50?.25+t/50*.75:1+(t-50)/50,this.happiness=t},update:function(t){for(var e=this.simulation.time,i=this.happinessBoosts.length-1;0<=i;){this.happinessBoosts[i].hasPassed(e)&&this.happinessBoosts.splice(i,1),--i}this.shouldUpdateHappinessIn<=0?(this.actualHappiness=this.getActualHappiness(),this.shouldUpdateHappinessIn=60):this.shouldUpdateHappinessIn-=Math.max(1,t),-1==this.happiness&&this.set_happiness(this.actualHappiness);var n=.05*t;if(Math.abs(this.actualHappiness-this.happiness)<n)this.set_happiness(this.actualHappiness);else{var r=this.actualHappiness-this.happiness;this.set_happiness(this.happiness+(0<r?1:r<0?-1:0)*n)}99.99<=this.happiness?(this.fullHappinessTime+=t*this.city.simulation.time.minutesPerTick,this.fullHappinessTimeout=300,dr.achieve("HAPPINESS_100"),124.99<=this.happiness&&dr.achieve("HAPPINESS_125")):this.fullHappinessTimeout<0?this.fullHappinessTime=0:this.fullHappinessTimeout-=t,this.happiness<=10.01?1+((0|e.timeSinceStart)/1440|0)!=this.lastShownVeryUnhappyWarning&&-1==this.veryUnhappyFromDay&&(this.veryUnhappyFromDay=1+((0|e.timeSinceStart)/1440|0),this.lastShownVeryUnhappyWarning=1+((0|e.timeSinceStart)/1440|0),this.city.simulation.happiness.ignoreUnhappyCitizens||(this.city.gui.showSimpleWindow(Tr.lo("cityofthekey"==this.city.progress.story.storyName?"citizens_unhappy_key":0==this.city.materials.food?"citizens_unhappy_food":"citizens_unhappy")+" "+Tr.lo("more_happiness_info"),Tr.lo("citizens_unhappy_title"),!0,!0),this.city.gui.pauseForWindow())):this.veryUnhappyFromDay=-1},getActualHappiness:function(){for(var t=new jo,e=new jo,i=0,n=[],r=[],s=[],o=[],a=this.entertainmentTypes.length,l=0,h=this.city.worlds;l<h.length;){var u=h[l];if(++l,!t.h[u.__id__]){for(var c=[],d=0,p=a;d<p;){var f=d++;c.push([])}for(var g=c,m=[],y=0,_=0,v=u.reachableWorlds;_<v.length;){var b=v[_];++_,e.set(b,i),t.set(b,!0);for(var w=0,S=b.permanents;w<S.length;){var x=S[w];++w;for(var T=0;T<x.length;){var I=x[T];if(++T,null!=I){if(I.isBuilding)if(I.isEntertainment){var P=I,C=this.entertainmentTypes.indexOf(P.get_entertainmentType());if(-1!=C&&g[C].push(P),null!=P.get_secondaryEntertainmentTypes())for(var E=0,A=P.get_secondaryEntertainmentTypes();E<A.length;){var M=A[E];++E;var B=this.entertainmentTypes.indexOf(M);-1!=B&&g[B].push(P)}}else if(I.isMedical){var R=I;m.push(R)}y+=I.get_baseEntertainmentCapacity()+I.bonusEntertainmentCapacity}}}}n[i]=y,r[i]=g,s[i]=m,o[i]=0,++i}}this.homeHappiness=0,this.schoolHappiness=0;var O=this.purposeHappiness=0;for(l=0,h=this.simulation.citizens;l<h.length;){var k=h[l];++l,null!=k.home&&(this.homeHappiness+=k.home.get_attractiveness()),null!=k.job?this.purposeHappiness+=100:k.lastInfrequentUpdateAge<16&&(++O,null!=k.school&&(this.schoolHappiness+=100,this.purposeHappiness+=100)),o[e.h[k.onWorld.__id__]]+=1}0<this.simulation.citizens.length&&(this.homeHappiness/=this.simulation.citizens.length,this.purposeHappiness/=this.simulation.citizens.length),0<O?this.schoolHappiness/=O:this.schoolHappiness=gr.any(this.city.permanents,function(t){return!!t.is(Ki)&&1<=t.workers.length})?100:0;for(l=0,h=this.happinessPerEntertainmentType.length;l<h;){f=l++;this.happinessPerEntertainmentType[f]=0}this.entertainmentHappiness=0,this.medicalHappiness=0,(l=[]).push(0),l.push(0),l.push(0),l.push(0),l.push(0),l.push(0),l.push(0),l.push(0),l.push(0),l.push(0),this.healthCapacityByType=l;for(l=this.numberOfGroupsWithCitizens=0,h=i;l<h;){if(0!=o[f=l++]){this.numberOfGroupsWithCitizens++;var D=32.99999999999999*Math.min(n[f],o[f]);for(c=0,d=r[f].length;c<d;){var F=c++,N=r[f][F];N.sort(function(t,e){var i=e.get_entertainmentQuality()-t.get_entertainmentQuality();return 0<i?1:i<0?-1:0});var L=o[f],U=0;for(p=0;p<N.length;){P=N[p];++p;var z=L>P.get_entertainmentCapacity()?P.get_entertainmentCapacity():L;if(U+=z*P.get_entertainmentQuality(),(L-=z)<=0)break}D+=U*(.67/a),this.happinessPerEntertainmentType[F]+=U/this.simulation.citizens.length}this.entertainmentHappiness+=D/this.simulation.citizens.length,(m=s[f]).sort(function(t,e){var i=e.get_medicalQuality()-t.get_medicalQuality()+.01*(e.get_medicalTypeID()-t.get_medicalTypeID());return 0<i?1:i<0?-1:0});var W=o[f],G=0,H=0;for(_=0;_<m.length;){R=m[_];++_;var X=R.get_medicalTypeID()+1;H<X&&(H=X)}for(v=[],w=0,S=H;w<S;){w++;v.push(0)}var j=v;for(T=0;T<m.length;){var V=m[T];++T;var Y=W>V.get_medicalCapacity()?V.get_medicalCapacity():W;if((K=V.get_medicalTypeLimit()*o[f]-j[V.get_medicalTypeID()])<0?Y=0:Y<K||(Y=K),j[V.get_medicalTypeID()]+=Y,this.healthCapacityByType[V.get_medicalTypeID()]+=Y,G+=Y*V.get_medicalQuality(),(W-=Y)<=0)break}this.medicalHappiness+=G/this.simulation.citizens.length}}this.entertainmentHappiness=Math.min(100,this.entertainmentHappiness+.01),this.medicalHappiness=Math.min(100,this.medicalHappiness+.01);var q=this.city.getAmountOfPermanentsPerType().h["buildings.SpecializedMedicalClinic"];if(null==q||0==q)this.specializedMedicalHappiness=0;else{var K=q/this.simulation.citizens.length*1e3*100;this.specializedMedicalHappiness=K<0?0:100<K?100:K}var $=.1,Q=.4,J=.1,Z=.1,tt=.3;null!=this.gloryOfTheKey&&($-=.02,Q-=.02,J-=.02,Z-=.02,tt-=.02);var et=this.homeHappiness*Q+this.entertainmentHappiness*tt+this.schoolHappiness*Z+this.medicalHappiness*J+this.purposeHappiness*$;null!=this.gloryOfTheKey&&(this.gloryOfTheKey.updateHappiness(),et+=.1*this.gloryOfTheKey.gloryOfTheKeyHappiness),et=Math.min(100,et+.01),this.actionSpeedModifierWithoutPenalties=et<=50?.25+et/50*.75:1+(et-50)/50;var it=this.simulation.eating.foodShortage;if(0<it)this.foodRationingUnhappiness=0,this.actionSpeedModifierWithoutPenalties<1&&(this.actionSpeedModifierWithoutPenalties=1),10<=it?(this.foodShortageUnhappiness=et,et=0):10<et?(this.foodShortageUnhappiness=et-10,et=10):this.foodShortageUnhappiness=0;else if(this.foodShortageUnhappiness=0,this.foodRationingUnhappiness=0,10<et&&this.city.simulation.eating.foodRationing){var nt=Math.max(10,.67*et);this.foodRationingUnhappiness=et-nt,et=nt}if(0<this.city.policies.vars.workTimeChange)this.lastOvertime=this.city.simulation.time.timeSinceStart/1440,this.overtimeUnhappinessActual=Math.max(this.overtimeUnhappinessActual,5),-1==this.lastOvertimeDay?this.lastOvertimeDay=this.lastOvertime:this.city.simulation.time.timeSinceStart/1440>this.lastOvertimeDay+1&&(this.lastOvertimeDay=this.city.simulation.time.timeSinceStart/1440,this.overtimeUnhappinessActual=Math.min(this.overtimeUnhappinessActual+5,50)),this.lastRestoreTime=-1;else if(this.city.simulation.time.timeSinceStart/1440>this.lastOvertimeDay+1){if(-1==this.lastRestoreTime)this.lastRestoreTime=this.city.simulation.time.timeSinceStart/1440;else{var rt=10*(this.city.simulation.time.timeSinceStart/1440-this.lastRestoreTime);this.lastRestoreTime=this.city.simulation.time.timeSinceStart/1440,this.overtimeUnhappinessActual=Math.max(0,this.overtimeUnhappinessActual-rt)}this.lastOvertimeDay=-1}(this.overtimeUnhappinessShown=0)<this.overtimeUnhappinessActual&&(this.overtimeUnhappinessShown=Math.min(this.overtimeUnhappinessActual,et),et-=this.overtimeUnhappinessShown),et<this.happinessEnthusiasmLevel?(this.enthusiasmHappiness=this.happinessEnthusiasmLevel-et,et=this.happinessEnthusiasmLevel):this.enthusiasmHappiness=0;for(l=0,h=this.happinessBoosts;l<h.length;){var st=h[l];++l,st.canGoOverMax||(et=Math.min(100,et+st.boost))}for(l=0,h=this.happinessBoosts;l<h.length;){st=h[l];++l,st.canGoOverMax&&(et+=st.boost)}return et},addBoost:function(t){this.happinessBoosts.push(t)},save:function(t){this.saveBasics(t);var e=this.happinessBoosts.length;if(t.size+4>t.bytes.length){var i=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+4))),t.bytes.blit(0,i,0,t.size)}t.bytes.setInt32(t.size,e),t.size+=4;for(var n=0,r=this.happinessBoosts;n<r.length;){var s=r[n];++n,s.save(t)}},load:function(t){if(this.loadBasics(t),20<=t.version){var e=t.bytes.getInt32(t.readStart);t.readStart+=4;for(var i=0,n=e;i<n;){i++;var r=new Tl(0,0,"");r.load(t),this.happinessBoosts.push(r)}}"cityofthekey"==this.city.progress.story.storyName&&(this.gloryOfTheKey=new Sl(this.city))},createGloryOfTheKey:function(){this.gloryOfTheKey=new Sl(this.city)},saveBasics:function(t,e){null==e&&(e=!0),e&&t.addString(xl.saveDefinition);var i=this.happiness;if(t.size+8>t.bytes.length){var n=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+8))),t.bytes.blit(0,n,0,t.size)}t.bytes.setDouble(t.size,i),t.size+=8;i=this.homeHappiness;if(t.size+8>t.bytes.length){n=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+8))),t.bytes.blit(0,n,0,t.size)}t.bytes.setDouble(t.size,i),t.size+=8;i=this.purposeHappiness;if(t.size+8>t.bytes.length){n=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+8))),t.bytes.blit(0,n,0,t.size)}t.bytes.setDouble(t.size,i),t.size+=8;i=this.entertainmentHappiness;if(t.size+8>t.bytes.length){n=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+8))),t.bytes.blit(0,n,0,t.size)}t.bytes.setDouble(t.size,i),t.size+=8;i=this.schoolHappiness;if(t.size+8>t.bytes.length){n=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+8))),t.bytes.blit(0,n,0,t.size)}t.bytes.setDouble(t.size,i),t.size+=8;i=this.medicalHappiness;if(t.size+8>t.bytes.length){n=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+8))),t.bytes.blit(0,n,0,t.size)}t.bytes.setDouble(t.size,i),t.size+=8;i=this.specializedMedicalHappiness;if(t.size+8>t.bytes.length){n=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+8))),t.bytes.blit(0,n,0,t.size)}t.bytes.setDouble(t.size,i),t.size+=8;i=this.fullHappinessTime;if(t.size+8>t.bytes.length){n=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+8))),t.bytes.blit(0,n,0,t.size)}t.bytes.setDouble(t.size,i),t.size+=8;i=this.overtimeUnhappinessActual;if(t.size+8>t.bytes.length){n=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+8))),t.bytes.blit(0,n,0,t.size)}t.bytes.setDouble(t.size,i),t.size+=8;i=this.overtimeStarted;if(t.size+8>t.bytes.length){n=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+8))),t.bytes.blit(0,n,0,t.size)}t.bytes.setDouble(t.size,i),t.size+=8;i=this.lastOvertime;if(t.size+8>t.bytes.length){n=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+8))),t.bytes.blit(0,n,0,t.size)}t.bytes.setDouble(t.size,i),t.size+=8;i=this.lastOvertimeDay;if(t.size+8>t.bytes.length){n=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+8))),t.bytes.blit(0,n,0,t.size)}t.bytes.setDouble(t.size,i),t.size+=8;i=this.lastRestoreTime;if(t.size+8>t.bytes.length){n=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+8))),t.bytes.blit(0,n,0,t.size)}t.bytes.setDouble(t.size,i),t.size+=8;i=this.ignoreUnhappyCitizens;if(t.size+1>t.bytes.length){n=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+1))),t.bytes.blit(0,n,0,t.size)}t.bytes.b[t.size]=i?1:0,t.size+=1;i=this.actualHappiness;if(t.size+8>t.bytes.length){n=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+8))),t.bytes.blit(0,n,0,t.size)}t.bytes.setDouble(t.size,i),t.size+=8;i=this.happinessEnthusiasmLevel;if(t.size+4>t.bytes.length){n=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+4))),t.bytes.blit(0,n,0,t.size)}t.bytes.setInt32(t.size,i),t.size+=4;i=this.lastShownVeryUnhappyWarning;if(t.size+4>t.bytes.length){n=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+4))),t.bytes.blit(0,n,0,t.size)}t.bytes.setInt32(t.size,i),t.size+=4;i=this.veryUnhappyFromDay;if(t.size+4>t.bytes.length){n=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+4))),t.bytes.blit(0,n,0,t.size)}t.bytes.setInt32(t.size,i),t.size+=4},loadBasics:function(t,e){null==e&&(e=t.readString());var i=Dr.makeLoadMap(e,t);Object.prototype.hasOwnProperty.call(i.h,"happiness")&&this.set_happiness(i.h.happiness),Object.prototype.hasOwnProperty.call(i.h,"homeHappiness")&&(this.homeHappiness=i.h.homeHappiness),Object.prototype.hasOwnProperty.call(i.h,"purposeHappiness")&&(this.purposeHappiness=i.h.purposeHappiness),Object.prototype.hasOwnProperty.call(i.h,"entertainmentHappiness")&&(this.entertainmentHappiness=i.h.entertainmentHappiness),Object.prototype.hasOwnProperty.call(i.h,"schoolHappiness")&&(this.schoolHappiness=i.h.schoolHappiness),Object.prototype.hasOwnProperty.call(i.h,"medicalHappiness")&&(this.medicalHappiness=i.h.medicalHappiness),Object.prototype.hasOwnProperty.call(i.h,"specializedMedicalHappiness")&&(this.specializedMedicalHappiness=i.h.specializedMedicalHappiness),Object.prototype.hasOwnProperty.call(i.h,"fullHappinessTime")&&(this.fullHappinessTime=i.h.fullHappinessTime),Object.prototype.hasOwnProperty.call(i.h,"overtimeUnhappinessActual")&&(this.overtimeUnhappinessActual=i.h.overtimeUnhappinessActual),Object.prototype.hasOwnProperty.call(i.h,"overtimeStarted")&&(this.overtimeStarted=i.h.overtimeStarted),Object.prototype.hasOwnProperty.call(i.h,"lastOvertime")&&(this.lastOvertime=i.h.lastOvertime),Object.prototype.hasOwnProperty.call(i.h,"lastOvertimeDay")&&(this.lastOvertimeDay=i.h.lastOvertimeDay),Object.prototype.hasOwnProperty.call(i.h,"lastRestoreTime")&&(this.lastRestoreTime=i.h.lastRestoreTime),Object.prototype.hasOwnProperty.call(i.h,"ignoreUnhappyCitizens")&&(this.ignoreUnhappyCitizens=i.h.ignoreUnhappyCitizens),Object.prototype.hasOwnProperty.call(i.h,"actualHappiness")&&(this.actualHappiness=i.h.actualHappiness),Object.prototype.hasOwnProperty.call(i.h,"happinessEnthusiasmLevel")&&(this.happinessEnthusiasmLevel=i.h.happinessEnthusiasmLevel),Object.prototype.hasOwnProperty.call(i.h,"lastShownVeryUnhappyWarning")&&(this.lastShownVeryUnhappyWarning=i.h.lastShownVeryUnhappyWarning),Object.prototype.hasOwnProperty.call(i.h,"veryUnhappyFromDay")&&(this.veryUnhappyFromDay=i.h.veryUnhappyFromDay)},__class__:xl};var Tl=function(t,e,i){this.canGoOverMax=!0,this.boostUntil=t,this.boost=e,this.text=i};(q["simulation.HappinessBoost"]=Tl).__name__="simulation.HappinessBoost",Tl.withDuration=function(t,e,i,n){return new Tl(t.timeSinceStart+e,i,n)},Tl.prototype={hasPassed:function(t){return t.timeSinceStart>this.boostUntil},save:function(t,e){null==e&&(e=!0),e&&t.addString(Tl.saveDefinition);var i=this.boostUntil;if(t.size+8>t.bytes.length){var n=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+8))),t.bytes.blit(0,n,0,t.size)}t.bytes.setDouble(t.size,i),t.size+=8;i=this.boost;if(t.size+8>t.bytes.length){n=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+8))),t.bytes.blit(0,n,0,t.size)}t.bytes.setDouble(t.size,i),t.size+=8,t.addString(this.text);i=this.canGoOverMax;if(t.size+1>t.bytes.length){n=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+1))),t.bytes.blit(0,n,0,t.size)}t.bytes.b[t.size]=i?1:0,t.size+=1},load:function(t,e){null==e&&(e=t.readString());var i=Dr.makeLoadMap(e,t);Object.prototype.hasOwnProperty.call(i.h,"boostUntil")&&(this.boostUntil=i.h.boostUntil),Object.prototype.hasOwnProperty.call(i.h,"boost")&&(this.boost=i.h.boost),Object.prototype.hasOwnProperty.call(i.h,"text")&&(this.text=i.h.text),Object.prototype.hasOwnProperty.call(i.h,"canGoOverMax")&&(this.canGoOverMax=i.h.canGoOverMax)},__class__:Tl};var Il=function(t,e){this.shouldUpdateHouses=!0,this.city=t,this.simulation=e;for(var i=[],n=0;n<101;){n++;i.push(0)}this.peoplePerHomeQuality=i;for(i=[],n=0;n<101;){n++;i.push(0)}this.emptyPlacesPerHomeQuality=i;for(i=[],n=0;n<101;){n++;i.push(0)}this.transferFrom=i,this.citizensWithFixedHomes=[]};(q["simulation.HouseAssigner"]=Il).__name__="simulation.HouseAssigner",Il.prototype={assignHouses:function(){if(this.shouldUpdateHouses){for(var t=[],e=0,i=this.city.connections.numberOfShards;e<i;){var n=e++;t.push(0)}Il.privateTeleportersLeft=t;for(t=0,e=this.city.connections.numberOfShards;t<e;){var r=t++,s=this.city.connections.permanentsByShard[r];for(i=0;i<101;){n=i++;this.peoplePerHomeQuality[n]=0}for(var o=0;o<101;){var a=o++;this.emptyPlacesPerHomeQuality[a]=0}for(var l=0;l<101;){var h=l++;this.transferFrom[h]=0}for(var u=Il.privateTeleportersLeft[r]=0;u<s.length;){var c=s[u];if(++u,null!=c&&c.is(re)){var d=c,p=d.get_attractiveness(),f=0|(p<0?0:100<p?100:p);if(!c.is(ce)){d.get_hasPrivateTeleporter()&&0<d.get_remainingCapacity()&&99.9<d.get_attractiveness()&&(Il.privateTeleportersLeft[r]+=1);for(var g=0,m=d.residents;g<m.length;){var y=m[g];++g,y.isForcedHome||(this.peoplePerHomeQuality[f]+=1)}this.emptyPlacesPerHomeQuality[f]+=d.get_remainingCapacity()}}}for(var _=0,v=100;_<v;){for(;_<v&&0<this.peoplePerHomeQuality[_];){var b=this.emptyPlacesPerHomeQuality[v],w=this.peoplePerHomeQuality[_],S=w<b?w:b;this.transferFrom[_]+=S,this.emptyPlacesPerHomeQuality[v]-=S,this.peoplePerHomeQuality[_]-=S,--v}++_}for(var x=0;x<s.length;){var T=s[x];if(++x,null!=T&&T.is(re)){var I=T,P=I.get_attractiveness(),C=0|(P<0?0:100<P?100:P);if(0<this.transferFrom[C])for(var E=I.residents.length;0<=--E;){var A=I.residents[E];0<this.transferFrom[C]&&!A.isForcedHome&&(A.evictFromHome(),this.transferFrom[C]--)}}}}for(t=[],e=0,i=this.city.connections.numberOfShards;e<i;){n=e++;t.push(!1)}var M=t;for(t=0,e=this.simulation.citizens;t<e.length;){A=e[t];if(++t,!M[A.getShard()]){var B=[A],R=[this],O=[function(t,e){var i=e;return!!(i.is(re)&&0<i.get_remainingCapacity()&&(0==i.get_fixedCapacityForWorkers()||lt.count(i.workers,function(t){return t.job==i})>=i.get_fixedCapacityForWorkers()))&&t.getShard()==e.shardId}],k=[function(t,e){var i=e;return!!(i.is(re)&&0<i.get_remainingCapacity()&&(0==i.get_fixedCapacityForWorkers()||lt.count(i.workers,function(t){return t.job==i})>=i.get_fixedCapacityForWorkers()))&&t.shardId==e.shardId}],D=[function(n){return function(t,e){var i=e;return!!(i.is(re)&&0<i.get_remainingCapacity()&&(0==i.get_fixedCapacityForWorkers()||lt.count(i.workers,function(t){return t.job==i})>=i.get_fixedCapacityForWorkers())&&t.getShard()==e.shardId)||!!e.is(dn)&&n[0].city.simulation.operatingCost.teleportersEnabled}}(R)],F=[function(n){return function(t,e){var i=e;return!!(i.is(re)&&0<i.get_remainingCapacity()&&(0==i.get_fixedCapacityForWorkers()||lt.count(i.workers,function(t){return t.job==i})>=i.get_fixedCapacityForWorkers())&&t.shardId==e.shardId)||!!e.is(dn)&&n[0].city.simulation.operatingCost.teleportersEnabled}}(R)];if(null==B[0].home){var N=null;if(0<Il.privateTeleportersLeft[B[0].getShard()]){if(null!=B[0].job){var L=this.simulation.permanentFinder,U=B[0].job,z=function(e,i){return function(t){return i[0](e[0],t)}}([B[0].job],F),W=function(t){return t.is(dn)?100:t.get_baseAttractiveness()+t.bonusAttractiveness};N=L.query(U,z,W,null,99.999999)}else{var G=this.city.permanents,H=function(e,i){return function(t){return i[0](e[0],t)}}([B[0]],D),X=function(t){return t.is(dn)?100:t.get_baseAttractiveness()+t.bonusAttractiveness};N=gr.whereMaxWithMax(G,H,X,99.999999)}null!=N&&N.is(dn)&&(N=lt.find(this.city.permanents,function(i){return function(t){if(t.is(re)&&i[0].getShard()==t.shardId&&t.get_hasPrivateTeleporter()){var e=t;return!!(e.is(re)&&0<e.get_remainingCapacity())&&(0==e.get_fixedCapacityForWorkers()||lt.count(e.workers,function(t){return t.job==e})>=e.get_fixedCapacityForWorkers())}return!1}}(B)))}else if(null!=B[0].job){var j=this.simulation.permanentFinder,V=B[0].job,Y=function(e,i){return function(t){return i[0](e[0],t)}}([B[0].job],k),q=function(t){return t.get_baseAttractiveness()+t.bonusAttractiveness};N=j.query(V,Y,q,null,99.999999)}else{var K=this.city.permanents,$=function(e,i){return function(t){return i[0](e[0],t)}}([B[0]],O),Q=function(t){return t.get_baseAttractiveness()+t.bonusAttractiveness};N=gr.whereMaxWithMax(K,$,Q,99.999999)}if(null!=N)if((B[0].home=N).residents.push(B[0]),N.get_hasPrivateTeleporter())Il.privateTeleportersLeft[B[0].getShard()]--}null==A.home&&(M[A.getShard()]=!0)}}this.shouldUpdateHouses=!1}},load:function(t){var e=t.bytes.getInt32(t.readStart);t.readStart+=4;var i=e;this.citizensWithFixedHomes=[];for(var n=0,r=i;n<r;){n++;var s=this.simulation.citizens;e=t.bytes.getInt32(t.readStart);t.readStart+=4;var o=s[e];o.isForcedHome=!0,this.citizensWithFixedHomes.push(o)}},save:function(t){var e=this.citizensWithFixedHomes.length;if(t.size+4>t.bytes.length){var i=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+4))),t.bytes.blit(0,i,0,t.size)}if(t.bytes.setInt32(t.size,e),t.size+=4,10<=this.citizensWithFixedHomes.length)for(var n=0,r=0,s=this.simulation.citizens;r<s.length;){var o=s[r];if(++r,o.isForcedHome){if(t.size+4>t.bytes.length){i=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+4))),t.bytes.blit(0,i,0,t.size)}t.bytes.setInt32(t.size,n),t.size+=4}++n}else for(r=0,s=this.citizensWithFixedHomes;r<s.length;){o=s[r];++r;e=this.simulation.citizens.indexOf(o);if(t.size+4>t.bytes.length){i=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+4))),t.bytes.blit(0,i,0,t.size)}t.bytes.setInt32(t.size,e),t.size+=4}},__class__:Il};var Pl=function(t,e){this.availableClassesForJob=[],this.citizensWithoutJob=[],this.buildingsHaveWork=!0,this.city=t,this.simulation=e,this.priorityJobs=new Vo};(q["simulation.JobAssigner"]=Pl).__name__="simulation.JobAssigner",Pl.prototype={assignJobs:function(){if(this.doStorySpecific(),this.buildingsHaveWork){for(var t=[],e=[],i=0,n=ht.getClassIDLength();i<n;){var r=i++;e.push(0)}var s=e;for(e=[],i=0,n=ht.getClassIDLength();i<n;){r=i++;e.push(!1)}for(var o=e,a=Vo.keysIterator(this.priorityJobs.h);a.hasNext();){var l=a.next(),h=ht.getClassID(l),u=Object.prototype.hasOwnProperty.call(this.priorityJobs.h,l)?this.priorityJobs.h[l]:0;o[h]=1e6==u,s[h]=o[h]?0:u}for(e=0,i=this.city.workBuildings;e<i.length;){var c=i[e];++e,c.workers.length<c.get_jobs()&&t.push(c),o[c.classID]&&(s[c.classID]+=c.get_jobs()),s[c.classID]-=c.workers.length}var d=!1,p=0;for(e=0;e<s.length;){var f=s[e];++e,0<f&&(d=!0,++p)}if(!d&&0==this.citizensWithoutJob.length&&0==this.availableClassesForJob.length)return void(this.buildingsHaveWork=!1);var g=!0,m=!0;for(e=[],i=0,n=this.city.connections.numberOfShards;i<n;){r=i++;e.push(!1)}for(var y=e;m;){m=!1,g&&("cityofthekey"==this.city.progress.story.storyName?t.sort(function(t,e){return"buildings.SecretSocietyHouse"==t.className?-1:"buildings.SecretSocietyHouse"==e.className?1:t.workers.length>e.workers.length?1:t.workers.length<e.workers.length?-1:0}):t.sort(function(t,e){return t.workers.length>e.workers.length?1:t.workers.length<e.workers.length?-1:0}),g=!1);for(e=0;e<t.length;){var _=[t[e]];if(++e,_[0].workers.length!=_[0].get_jobs()&&!(d&&s[_[0].classID]<=0)){var v=lt.find(this.citizensWithoutJob,function(e){return function(t){return t.getShard()==e[0].shardId}}(_));if(d&&null==v){if(!y[_[0].shardId]){var b=null,w=0;for(i=0,n=this.city.workBuildings;i<n.length;){c=n[i];++i,_[0].shardId==c.shardId&&c.workers.length>w&&s[c.classID]<0&&(w=(b=c).workers.length)}null!=b&&0<b.workers.length?((v=b.workers[b.workers.length-1]).loseJob(!0),s[b.classID]+=1):y[_[0].shardId]=!0}}else if(0<this.availableClassesForJob.length&&null==v){for(var S=null,x=0,T=this.availableClassesForJob,I=new Array(T.length),P=0,C=T.length;P<C;){I[r=P++]=T[r].classType}for(var E=I,A=0,M=this.city.workBuildings;A<M.length;){var B=M[A];++A,_[0].shardId==B.shardId&&B.workers.length>x&&s[B.classID]<0&&-1!=E.indexOf(B.classID)&&(x=(S=B).workers.length)}if(null!=S){for(var R=0,O=this.availableClassesForJob.length;R<O;){var k=R++;if(this.availableClassesForJob[k].classType==_[0].classID){this.availableClassesForJob[k].number-=1,this.availableClassesForJob[k].number<=0&&this.availableClassesForJob.splice(k,1);break}}S!=_[0]&&((v=S.workers[S.workers.length-1]).loseJob(!0),s[S.classID]+=1)}}if(null!=v){if(m=!0,s[_[0].classID]-=1,at.remove(this.citizensWithoutJob,v),_[0].workers.push(v),v.job=_[0],_[0].afterGiveJob(v),v.getShard()==_[0].shardId&&(null==v.home||!v.home.is(ui))){v.evictFromHome();var D=!1;if(_[0].is(re)&&0<_[0].get_remainingCapacity()){var F=_[0];(v.home=F).residents.push(v),D=!0}if(null==v.home||!D&&v.home.get_hasPrivateTeleporter()){var N=this.simulation.houseAssigner,L=[v],U=[N],z=[function(t,e){var i=e;return!!(i.is(re)&&0<i.get_remainingCapacity()&&(0==i.get_fixedCapacityForWorkers()||lt.count(i.workers,function(t){return t.job==i})>=i.get_fixedCapacityForWorkers()))&&t.getShard()==e.shardId}],W=[function(t,e){var i=e;return!!(i.is(re)&&0<i.get_remainingCapacity()&&(0==i.get_fixedCapacityForWorkers()||lt.count(i.workers,function(t){return t.job==i})>=i.get_fixedCapacityForWorkers()))&&t.shardId==e.shardId}],G=[function(n){return function(t,e){var i=e;return!!(i.is(re)&&0<i.get_remainingCapacity()&&(0==i.get_fixedCapacityForWorkers()||lt.count(i.workers,function(t){return t.job==i})>=i.get_fixedCapacityForWorkers())&&t.getShard()==e.shardId)||!!e.is(dn)&&n[0].city.simulation.operatingCost.teleportersEnabled}}(U)],H=[function(n){return function(t,e){var i=e;return!!(i.is(re)&&0<i.get_remainingCapacity()&&(0==i.get_fixedCapacityForWorkers()||lt.count(i.workers,function(t){return t.job==i})>=i.get_fixedCapacityForWorkers())&&t.shardId==e.shardId)||!!e.is(dn)&&n[0].city.simulation.operatingCost.teleportersEnabled}}(U)];if(null==L[0].home){var X=null;if(0<Il.privateTeleportersLeft[L[0].getShard()]){if(null!=L[0].job){var j=N.simulation.permanentFinder,V=L[0].job,Y=function(e,i){return function(t){return i[0](e[0],t)}}([L[0].job],H),q=function(t){return t.is(dn)?100:t.get_baseAttractiveness()+t.bonusAttractiveness};X=j.query(V,Y,q,null,99.999999)}else{var K=N.city.permanents,$=function(e,i){return function(t){return i[0](e[0],t)}}([L[0]],G),Q=function(t){return t.is(dn)?100:t.get_baseAttractiveness()+t.bonusAttractiveness};X=gr.whereMaxWithMax(K,$,Q,99.999999)}null!=X&&X.is(dn)&&(X=lt.find(N.city.permanents,function(i){return function(t){if(t.is(re)&&i[0].getShard()==t.shardId&&t.get_hasPrivateTeleporter()){var e=t;return!!(e.is(re)&&0<e.get_remainingCapacity())&&(0==e.get_fixedCapacityForWorkers()||lt.count(e.workers,function(t){return t.job==e})>=e.get_fixedCapacityForWorkers())}return!1}}(L)))}else if(null!=L[0].job){var J=N.simulation.permanentFinder,Z=L[0].job,tt=function(e,i){return function(t){return i[0](e[0],t)}}([L[0].job],W),et=function(t){return t.get_baseAttractiveness()+t.bonusAttractiveness};X=J.query(Z,tt,et,null,99.999999)}else{var it=N.city.permanents,nt=function(e,i){return function(t){return i[0](e[0],t)}}([L[0]],z),rt=function(t){return t.get_baseAttractiveness()+t.bonusAttractiveness};X=gr.whereMaxWithMax(it,nt,rt,99.999999)}if(null!=X)if((L[0].home=X).residents.push(L[0]),X.get_hasPrivateTeleporter())Il.privateTeleportersLeft[L[0].getShard()]--}}}if(0==this.citizensWithoutJob.length&&!d)return void(this.availableClassesForJob=[]);if(s[_[0].classID]<=0&&--p<=0){g=!(d=!1);break}}}}!m&&d&&(g=!(d=!(m=!0)))}this.buildingsHaveWork=!1,this.availableClassesForJob=[]}},giveCitizenJob:function(t,e){-1!=this.citizensWithoutJob.indexOf(t)&&at.remove(this.citizensWithoutJob,t),e.workers.push(t),(t.job=e).afterGiveJob(t)},save:function(t){var e=lt.count(this.priorityJobs);if(t.size+4>t.bytes.length){var i=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+4))),t.bytes.blit(0,i,0,t.size)}t.bytes.setInt32(t.size,e),t.size+=4;for(var n=Vo.keysIterator(this.priorityJobs.h);n.hasNext();){var r=n.next();t.addString(r);e=this.priorityJobs.h[r];if(t.size+4>t.bytes.length){i=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+4))),t.bytes.blit(0,i,0,t.size)}t.bytes.setInt32(t.size,e),t.size+=4}},load:function(t){var e=t.bytes.getInt32(t.readStart);t.readStart+=4;for(var i=0,n=e;i<n;){i++;var r=t.readString(),s=this.priorityJobs;e=t.bytes.getInt32(t.readStart);t.readStart+=4;var o=e;s.h[r]=o}},doStorySpecific:function(){"cityofthekey"==this.city.progress.story.storyName&&(this.priorityJobs.h["buildings.SecretSocietyHouse"]=8)},__class__:Pl};var Cl=function(t){this.teleportersAreUserEnabled=!0,this.teleportersEnabled=!0,this.operatingCost=new L,this.city=t};(q["simulation.OperatingCost"]=Cl).__name__="simulation.OperatingCost",Cl.prototype={changeTeleportersEnabledState:function(t,e){t!=this.teleportersEnabled?(e||this.teleportersAreUserEnabled||this.teleportersEnabled)&&(this.teleportersEnabled=t,e&&(this.teleportersAreUserEnabled=this.teleportersEnabled),this.teleportersEnabled&&(this.city.simulation.houseAssigner.shouldUpdateHouses=!0),this.recalculate()):e&&(this.teleportersAreUserEnabled=this.teleportersEnabled)},recalculate:function(){this.operatingCost=this.getWholeCityOperatingCost()},update:function(t){this.city.materials.knowledge>10*t&&this.teleportersAreUserEnabled&&!this.teleportersEnabled&&this.changeTeleportersEnabledState(!0,!1);var e=this.operatingCost.copy();e.multiply(t/1440*this.city.simulation.time.minutesPerTick),this.city.materials.canAfford(e)?(this.city.materials.remove(e),e.addToConsumption(this.city.simulation.stats)):this.changeTeleportersEnabledState(!1,!1)},getWholeCityOperatingCost:function(){for(var t=new L,e=0,i=this.city.permanents;e<i.length;){var n=i[e];if(++e,n.isBuilding){var r=n;t.add(this.getOperatingCost(r.info,!0))}}return t},getWholeCityOperatingCostTeleporters:function(){for(var t=new L,e=0,i=this.city.permanents;e<i.length;){var n=i[e];if(++e,n.isBuilding){var r=n;0<r.info.teleporterOperatingCost&&t.add(this.getOperatingCost(r.info,!0))}}return t},getOperatingCost:function(t,e){if(null==e&&(e=!1),(!e||this.teleportersEnabled)&&0<t.teleporterOperatingCost){var i=null==this.city.misdirector?1:.5;return i*=1-this.city.upgrades.vars.rocketTeleporterReward,new L(0,0,0,0,t.teleporterOperatingCost*i)}return null},getOperatingCostReason:function(t){return Tr.lo("operating_cost_pd")+" "},save:function(t,e){null==e&&(e=!0),e&&t.addString(Cl.saveDefinition);var i=this.teleportersEnabled;if(t.size+1>t.bytes.length){var n=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+1))),t.bytes.blit(0,n,0,t.size)}t.bytes.b[t.size]=i?1:0,t.size+=1;i=this.teleportersAreUserEnabled;if(t.size+1>t.bytes.length){n=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+1))),t.bytes.blit(0,n,0,t.size)}t.bytes.b[t.size]=i?1:0,t.size+=1},load:function(t,e){null==e&&(e=t.readString());var i=Dr.makeLoadMap(e,t);Object.prototype.hasOwnProperty.call(i.h,"teleportersEnabled")&&(this.teleportersEnabled=i.h.teleportersEnabled),Object.prototype.hasOwnProperty.call(i.h,"teleportersAreUserEnabled")&&(this.teleportersAreUserEnabled=i.h.teleportersAreUserEnabled)},__class__:Cl};var El=function(t){this.priorities=[],this.city=t};(q["simulation.ResourcePriorityManager"]=El).__name__="simulation.ResourcePriorityManager",El.prototype={prioritize:function(t){-1==this.priorities.indexOf(t)&&this.priorities.push(t),this.invalidatePathfindingAfterPrioritizeChange(t)},invalidatePathfindingAfterPrioritizeChange:function(t){if(t.is(Eh))for(var e=0,i=this.city.permanents;e<i.length;){var n=i[e];++e,n.is(on)&&n.invalidatePathfindingRelatedInfo()}if(t.is(Ph))for(e=0,i=this.city.permanents;e<i.length;){n=i[e];++e,n.is(In)&&n.invalidatePathfindingRelatedInfo()}},hasResourcePrioritiesFor:function(e){return gr.any(this.priorities,function(t){return t.is(e)})},deprioritize:function(t){-1!=this.priorities.indexOf(t)&&(this.invalidatePathfindingAfterPrioritizeChange(t),at.remove(this.priorities,t))},isPrioritized:function(t){return-1!=this.priorities.indexOf(t)},load:function(t){var e=t.bytes.getInt32(t.readStart);t.readStart+=4;var i=e;this.priorities=[];for(var n=0,r=i;n<r;){n++;var s=this.city.permanentsByID;e=t.bytes.getInt32(t.readStart);t.readStart+=4;var o=s.h[e];null!=o&&this.priorities.push(o)}},save:function(t){var e=this.priorities.length;if(t.size+4>t.bytes.length){var i=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+4))),t.bytes.blit(0,i,0,t.size)}t.bytes.setInt32(t.size,e),t.size+=4;for(var n=0,r=this.priorities;n<r.length;){var s=r[n];++n;e=s.id;if(t.size+4>t.bytes.length){i=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+4))),t.bytes.blit(0,i,0,t.size)}t.bytes.setInt32(t.size,e),t.size+=4}},__class__:El};function Al(){}(q["simulation.Rocket"]=Al).__name__="simulation.Rocket",Al.__super__=_l,Al.prototype=e(_l.prototype,{__class__:Al});function Ml(){}(q["simulation.RocketGoingDown"]=Ml).__name__="simulation.RocketGoingDown",Ml.__super__=_l,Ml.prototype=e(_l.prototype,{__class__:Ml});function Bl(){}(q["simulation.RocketMission"]=Bl).__name__="simulation.RocketMission";var Rl=function(t){this.missionsDoneFar=0,this.missionsDoneNear=0,this.city=t,this.rockets=[],this.currentMissions=[]};(q["simulation.Rockets"]=Rl).__name__="simulation.Rockets",Rl.prototype={save:function(t,e){null==e&&(e=!0),e&&t.addString(Rl.saveDefinition);var i=this.missionsDoneNear;if(t.size+4>t.bytes.length){var n=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+4))),t.bytes.blit(0,n,0,t.size)}t.bytes.setInt32(t.size,i),t.size+=4;i=this.missionsDoneFar;if(t.size+4>t.bytes.length){n=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+4))),t.bytes.blit(0,n,0,t.size)}t.bytes.setInt32(t.size,i),t.size+=4},load:function(t,e){null==e&&(e=t.readString());var i=Dr.makeLoadMap(e,t);Object.prototype.hasOwnProperty.call(i.h,"missionsDoneNear")&&(this.missionsDoneNear=i.h.missionsDoneNear),Object.prototype.hasOwnProperty.call(i.h,"missionsDoneFar")&&(this.missionsDoneFar=i.h.missionsDoneFar)},__class__:Rl};var Ol=function(t,e){this.schoolsShouldBeUpdated=!1,this.city=t,this.simulation=e};(q["simulation.SchoolAssigner"]=Ol).__name__="simulation.SchoolAssigner",Ol.prototype={assignSchools:function(){if(this.schoolsShouldBeUpdated){for(var t=[],e=0,i=this.city.permanents;e<i.length;){var n=i[e];if(++e,n.is(Ki)){var r=n;s=r.students.length<r.get_studentCapacity()&&0<r.workers.length}else s=!1;s&&t.push(n)}var s;if(0<=(s=t).length){s.sort(function(t,e){return t.students.length-e.students.length});for(t=[],e=0,i=this.city.simulation.citizens;e<i.length;){n=i[e];++e,n.get_age()<16&&null==n.school&&t.push(n)}for(var o=t,a=!0;0<o.length&&a;){a=!1;for(var l=s.length;0<=--l;){var h=[s[l]],u=lt.find(o,function(e){return function(t){return t.getShard()==e[0].shardId||!(null==t.home||!t.home.get_hasPrivateTeleporter())&&e[0].world.hasTeleporterOnGroup}}(h));if(null!=u&&(a=!0,at.remove(o,u),u.school=h[0],h[0].students.push(u),h[0].students.length>=h[0].get_studentCapacity()&&s.splice(l,1)),0==o.length)break}}}this.schoolsShouldBeUpdated=!1}},__class__:Ol};var kl=function(t,e,i,n,r){if(this.stage=e,this.simulation=t,this.toWorld=i,this.spawn=n,null==r){for(var s=-5,o=[],a=0,l=i.permanents.length;a<l;){var h=a++,u=-1,c=i.permanents[h];0==c.length?u=1:null!=c[0]&&c[0].is(_)&&!c[0].isRooftopBuilding&&(u=0),s<u&&(s=u,o=[]),s<=u&&o.push(h)}r=il.fromArray(o)}this.toXIndex=r,this.yPositionAboveWorld=1e3+20*i.permanents[r].length,this.sprite=dt.makeSprite("spr_flyingsaucer"),this.setSpritePosition(),e.addChild(this.sprite)};(q["simulation.SpawnFlyingSaucer"]=kl).__name__="simulation.SpawnFlyingSaucer",kl.fromLoad=function(t,e,i){var n=e.city.worlds,r=t.bytes.getInt32(t.readStart);t.readStart+=4;var s=n[r];r=t.bytes.getInt32(t.readStart);t.readStart+=4;var o=r,a=t.bytes.getDouble(t.readStart);t.readStart+=8;var l=a,h=t.readJSON(),u=new kl(e,i,s,h,o);return u.yPositionAboveWorld=l,u},kl.prototype={update:function(t){this.yPositionAboveWorld-=3*t,this.setSpritePosition(),this.yPositionAboveWorld<=20*this.toWorld.permanents[this.toXIndex].length&&(this.spawnCitizens(),this.destroy())},spawnCitizens:function(){var t=null,e=null,i=this.toWorld.permanents[this.toXIndex];0==i.length?e=20*this.toXIndex:t=i[i.length-1];for(var n=0,r=this.spawn.amount;n<r;){n++;var s=this.spawn.ageRangeMin;this.spawn.ageRangeMin!=this.spawn.ageRangeMax&&(s=il.getFloat(this.spawn.ageRangeMin,this.spawn.ageRangeMax)),this.simulation.citizens.length+this.numberOfNewCitizens()<this.simulation.babyMaker.softPopLimit&&this.simulation.createCitizen(this.toWorld,s,t,e)}},numberOfNewCitizens:function(){for(var t=0,e=0,i=this.simulation.citizenSpawners;e<i.length;){var n=i[e];++e,t+=n.spawn.amount}return t},setSpritePosition:function(){this.sprite.position.set(this.toWorld.rect.x+20*this.toXIndex,this.toWorld.rect.y-this.yPositionAboveWorld-20+1)},destroy:function(){this.sprite.destroy(),at.remove(this.simulation.citizenSpawners,this)},save:function(t){var e=this.simulation.city.worlds.indexOf(this.toWorld);if(t.size+4>t.bytes.length){var i=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+4))),t.bytes.blit(0,i,0,t.size)}t.bytes.setInt32(t.size,e),t.size+=4;e=this.toXIndex;if(t.size+4>t.bytes.length){i=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+4))),t.bytes.blit(0,i,0,t.size)}t.bytes.setInt32(t.size,e),t.size+=4;e=this.yPositionAboveWorld;if(t.size+8>t.bytes.length){i=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+8))),t.bytes.blit(0,i,0,t.size)}t.bytes.setDouble(t.size,e),t.size+=8,t.addJSON(this.spawn)},__class__:kl};var Dl=function(t,e){this.peopleWorkingAtLabs=0,this.people=0,this.jobs=0,this.houseCapacity=0,this.peopleWithHome=0,this.peopleWithAJob=0,this.children=0,this.laborForce=0,this.shouldUpdateIn=-1,this.city=t,this.simulation=e,this.materialProduction=[],this.materialUsed=[],this.materialProduction.push([0,0,0,0,0,0,0]),this.materialProduction.push([0,0,0,0,0,0,0]),this.materialProduction.push([0,0,0,0,0,0,0]),this.materialProduction.push([0,0,0,0,0,0,0]),this.materialProduction.push([0,0,0,0,0,0,0]),this.materialProduction.push([0,0,0,0,0,0,0]),this.materialProduction.push([0,0,0,0,0,0,0]),this.materialProduction.push([0,0,0,0,0,0,0]),this.materialProduction.push([0,0,0,0,0,0,0]),this.materialProduction.push([0,0,0,0,0,0,0]);for(var i=0,n=ct.modMaterials;i<n.length;){var r=n[i];++i;r.variableName;this.materialProduction.push([0,0,0,0,0,0,0])}this.materialProduction.push([0,0,0,0,0,0,0]),this.materialUsed.push([0,0,0,0,0,0,0]),this.materialUsed.push([0,0,0,0,0,0,0]),this.materialUsed.push([0,0,0,0,0,0,0]),this.materialUsed.push([0,0,0,0,0,0,0]),this.materialUsed.push([0,0,0,0,0,0,0]),this.materialUsed.push([0,0,0,0,0,0,0]),this.materialUsed.push([0,0,0,0,0,0,0]),this.materialUsed.push([0,0,0,0,0,0,0]),this.materialUsed.push([0,0,0,0,0,0,0]),this.materialUsed.push([0,0,0,0,0,0,0]);for(i=0,n=ct.modMaterials;i<n.length;){r=n[i];++i;r.variableName;this.materialUsed.push([0,0,0,0,0,0,0])}this.materialUsed.push([0,0,0,0,0,0,0])};(q["simulation.Stats"]=Dl).__name__="simulation.Stats",Dl.prototype={save:function(t){this.saveBasics(t);var e=this.materialProduction.length;if(t.size+4>t.bytes.length){var i=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+4))),t.bytes.blit(0,i,0,t.size)}t.bytes.setInt32(t.size,e),t.size+=4;for(var n=0,r=this.materialProduction.length;n<r;){var s=n++;t.addString(ct.findMaterialName(s));e=this.materialProduction[s].length;if(t.size+4>t.bytes.length){i=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+4))),t.bytes.blit(0,i,0,t.size)}t.bytes.setInt32(t.size,e),t.size+=4;for(var o=0,a=this.materialProduction[s];o<a.length;){var l=a[o];if(++o,t.size+8>t.bytes.length){var h=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+8))),t.bytes.blit(0,h,0,t.size)}t.bytes.setDouble(t.size,l),t.size+=8}}e=this.materialUsed.length;if(t.size+4>t.bytes.length){i=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+4))),t.bytes.blit(0,i,0,t.size)}t.bytes.setInt32(t.size,e),t.size+=4;for(n=0,r=this.materialUsed.length;n<r;){s=n++;t.addString(ct.findMaterialName(s));e=this.materialUsed[s].length;if(t.size+4>t.bytes.length){i=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+4))),t.bytes.blit(0,i,0,t.size)}t.bytes.setInt32(t.size,e),t.size+=4;for(o=0,a=this.materialUsed[s];o<a.length;){l=a[o];if(++o,t.size+8>t.bytes.length){h=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+8))),t.bytes.blit(0,h,0,t.size)}t.bytes.setDouble(t.size,l),t.size+=8}}},load:function(t){if(this.loadBasics(t),5<=t.version){var e=t.bytes.getInt32(t.readStart);t.readStart+=4;for(var i=0,n=e;i<n;){i++;if(-1!=(d=ct.findMaterialIndex(t.readString()))){var r=t.bytes.getInt32(t.readStart);t.readStart+=4;for(var s=0,o=r;s<o;){var a=s++,l=t.bytes.getDouble(t.readStart);t.readStart+=8;var h=l;this.materialProduction[d].length<=a?this.materialProduction[d].push(h):this.materialProduction[d][a]=h}}else{e=t.bytes.getInt32(t.readStart);t.readStart+=4;for(var u=0,c=e;u<c;){u++,t.bytes.getDouble(t.readStart);t.readStart+=8}}}}if(11<=t.version){e=t.bytes.getInt32(t.readStart);t.readStart+=4;for(i=0,n=e;i<n;){var d;i++;if(-1!=(d=ct.findMaterialIndex(t.readString()))){r=t.bytes.getInt32(t.readStart);t.readStart+=4;for(s=0,o=r;s<o;){a=s++,l=t.bytes.getDouble(t.readStart);t.readStart+=8;var p=l;this.materialUsed[d].length<=a?this.materialUsed[d].push(p):this.materialUsed[d][a]=p}}else{e=t.bytes.getInt32(t.readStart);t.readStart+=4;for(u=0,c=e;u<c;){u++,t.bytes.getDouble(t.readStart);t.readStart+=8}}}}},update:function(t){if(this.shouldUpdateIn<=0){this.laborForce=0,this.peopleWithAJob=0,this.peopleWithHome=0,this.children=0,this.houseCapacity=0,this.peopleWorkingAtLabs=0,this.people=this.simulation.citizens.length,this.jobs=0;for(var e=this.simulation.eating.herbsCap=0,i=this.simulation.citizens;e<i.length;){var n=i[e];++e,16<=n.lastInfrequentUpdateAge?(this.laborForce+=1,null!=n.job&&(this.peopleWithAJob+=1,(n.job.is(fi)||n.job.is(He)||n.job.is(si))&&(this.peopleWorkingAtLabs+=1))):this.children+=1,null!=n.home&&(this.peopleWithHome+=1)}for(e=0,i=this.city.permanents;e<i.length;){var r=i[e];++e,r.is(re)&&(this.houseCapacity+=r.get_residentCapacity()),r.is(ee)&&(this.jobs+=r.get_jobs()),r.is(ai)&&(this.simulation.eating.herbsCap+=r.getHerbCapacity())}this.shouldUpdateIn+=20,this.city.progress.unlocks.checkStatRelatedUnlocks()}else this.shouldUpdateIn-=Math.max(1,t)},midnightUpdate:function(){for(var t=0,e=this.materialProduction;t<e.length;){var i=e[t];++t;for(var n=i.length;1<=--n;)i[n]=i[n-1];i[0]=0}for(t=0,e=this.materialUsed;t<e.length;){var r=e[t];++t;for(n=r.length;1<=--n;)r[n]=r[n-1];r[0]=0}},amountOfBuildingsOfType:function(t){for(var e=0,i=0,n=this.city.permanents;i<n.length;){var r=n[i];++i,r.is(t)&&++e}return e},saveBasics:function(t,e){null==e&&(e=!0),e&&t.addString(Dl.saveDefinition)},loadBasics:function(t,e){null==e&&(e=t.readString());Dr.makeLoadMap(e,t)},__class__:Dl};function Fl(){}(q["simulation.Train"]=Fl).__name__="simulation.Train",Fl.__super__=_l,Fl.prototype=e(_l.prototype,{__class__:Fl});var Nl=function(t){cl.call(this,t)};(q["simulation.citizenSpecialActions.ClimbIntoTree"]=Nl).__name__="simulation.citizenSpecialActions.ClimbIntoTree",Nl.__super__=cl,Nl.prototype=e(cl.prototype,{update:function(t){if(null!=this.citizen.inPermanent&&this.citizen.inPermanent.is(Ph)){var e=this.citizen.inPermanent;if(((0|this.time.timeSinceStart)/60|0)%24==4&&45<(0|this.time.timeSinceStart)%60){if(0!=this.citizen.relativeY){var i=this.citizen;(r=0<(n=ka.pool)[2].length?n[2].splice(n[2].length-1,1)[0]:new Int32Array(2))[0]=9,r[1]=0,i.setPath(r,0,2)}}else if(0==this.citizen.relativeY){var n,r;i=this.citizen;(r=0<(n=ka.pool)[4].length?n[4].splice(n[4].length-1,1)[0]:new Int32Array(4))[0]=4,r[1]=e.get_treeClimbX(),r[2]=9,r[3]=e.get_treeClimbY(),i.setPath(r,0,4)}}else{for(var s=null,o=1e5,a=0,l=this.citizen.onWorld.permanents;a<l.length;){var h=l[a];if(++a,1<=h.length&&null!=h[0]&&h[0].is(Ph)){var u=h[0];if(u.materialsLeft==u.initialMaterials){var c=20*u.worldPosition.x-this.citizen.get_worldX();c<o&&(s=u,o=c)}}}if(null!=s){var d=this.citizen;d.simulation.pathfinder.findPath(d,s),d.pathOnFail=null}}},isActive:function(){return 0<=((0|this.time.timeSinceStart)/60|0)%24&&((0|this.time.timeSinceStart)/60|0)%24<=4&&3!=this.citizen.currentAction},__class__:Nl});var Ll=function(t){this.cancelAction=!1,cl.call(this,t)};(q["simulation.citizenSpecialActions.ClimbOntoRuins"]=Ll).__name__="simulation.citizenSpecialActions.ClimbOntoRuins",Ll.__super__=cl,Ll.prototype=e(cl.prototype,{update:function(t){if(!this.cancelAction)if(null!=this.citizen.inPermanent&&this.citizen.inPermanent.is(Th)){var e=this.citizen.inPermanent;if(((0|this.time.timeSinceStart)/60|0)%24==4.5&&45<(0|this.time.timeSinceStart)%60){if(0!=this.citizen.relativeY){var i=this.citizen;(r=0<(n=ka.pool)[2].length?n[2].splice(n[2].length-1,1)[0]:new Int32Array(2))[0]=9,r[1]=0,i.setPath(r,0,2)}}else if(0==this.citizen.relativeY){var n,r;i=this.citizen;(r=0<(n=ka.pool)[4].length?n[4].splice(n[4].length-1,1)[0]:new Int32Array(4))[0]=4,r[1]=e.get_climbX(),r[2]=9,r[3]=e.get_climbY(),i.setPath(r,0,4)}}else{for(var s=null,o=1e5,a=0,l=this.citizen.onWorld.permanents;a<l.length;){var h=l[a];if(++a,1<=h.length&&null!=h[0]&&h[0].is(Th)){var u=h[0],c=20*u.worldPosition.x-this.citizen.get_worldX();c<o&&(s=u,o=c)}}if(null!=s){var d=this.citizen;d.simulation.pathfinder.findPath(d,s),d.pathOnFail=null}else this.cancelAction=!0}},isActive:function(){return.5<=((0|this.time.timeSinceStart)/60|0)%24&&((0|this.time.timeSinceStart)/60|0)%24<=4.5&&!this.cancelAction&&3!=this.citizen.currentAction},__class__:Ll});var Ul=function(t){this.goIntoDirection=1,this.currentSprite=null,cl.call(this,t)};(q["simulation.citizenSpecialActions.DanceOnBall"]=Ul).__name__="simulation.citizenSpecialActions.DanceOnBall",Ul.__super__=cl,Ul.prototype=e(cl.prototype,{update:function(t){if(1<=((0|this.time.timeSinceStart)/60|0)%24&&((0|this.time.timeSinceStart)/60|0)%24<=5)null!=this.citizen.inPermanent?this.citizen.goDownTowardsWorldSurface(t):(this.citizen.setRelativeY(4),null==this.currentSprite&&(this.goIntoDirection=il.fromArray([-1,1]),this.currentSprite=new PIXI.Sprite(dt.getTexture("spr_citizen_ball")),this.currentSprite.position.y=this.citizen.onWorld.rect.y-4,this.citizen.onWorld.city.farForegroundStage.addChild(this.currentSprite)),this.citizen.setRelativeX(this.citizen.relativeX+.5*t*this.goIntoDirection),(1==this.goIntoDirection&&this.citizen.relativeX>=this.citizen.onWorld.rect.width-2||-1==this.goIntoDirection&&this.citizen.relativeX<=0)&&(this.goIntoDirection=-this.goIntoDirection),this.currentSprite.position.x=this.citizen.onWorld.rect.x+this.citizen.relativeX-1);else if(null!=this.currentSprite){this.currentSprite.destroy();var e=this.citizen,i=ka.pool,n=0<i[2].length?i[2].splice(i[2].length-1,1)[0]:new Int32Array(2);n[0]=8,n[1]=5,e.setPath(n,0,2,!0),e.pathEndFunction=null,e.pathOnlyRelatedTo=e.inPermanent,this.currentSprite=null,this.citizen.setRelativeY(0)}},isActive:function(){return 1<=((0|this.time.timeSinceStart)/60|0)%24&&((0|this.time.timeSinceStart)/60|0)%24<=5&&3!=this.citizen.currentAction||null!=this.currentSprite},isWalkingOnBall:function(){return null!=this.currentSprite},onDie:function(){cl.prototype.onDie.call(this),null!=this.currentSprite&&(this.currentSprite.destroy(),this.currentSprite=null)},__class__:Ul});var zl=function(t){cl.call(this,t)};(q["simulation.citizenSpecialActions.MoveToEdge"]=zl).__name__="simulation.citizenSpecialActions.MoveToEdge",zl.__super__=cl,zl.prototype=e(cl.prototype,{update:function(t){var e=this.citizen.onWorld.rect.width-2;if(null!=this.citizen.inPermanent||0<this.citizen.relativeX&&this.citizen.relativeX<e)if(null==this.citizen.inPermanent){var i=this.citizen,n=this.citizen.relativeX<e/2?0:e,r=ka.pool,s=0<r[2].length?r[2].splice(r[2].length-1,1)[0]:new Int32Array(2);s[0]=4,s[1]=n,i.setPath(s,0,2,!0),i.pathEndFunction=null,i.pathOnlyRelatedTo=i.inPermanent}else this.citizen.goDownTowardsWorldSurface(t)},isActive:function(){var t=this.time.timeSinceStart/60%24;return(23<=t||t<5)&&3!=this.citizen.currentAction},__class__:zl});var Wl=function(t){this.goingIntoThisDirection=0,this.goIntoDirection=1,this.currentSprite=null,cl.call(this,t)};(q["simulation.citizenSpecialActions.Protester"]=Wl).__name__="simulation.citizenSpecialActions.Protester",Wl.__super__=cl,Wl.prototype=e(cl.prototype,{update:function(t){if(0<=((0|this.time.timeSinceStart)/60|0)%24&&((0|this.time.timeSinceStart)/60|0)%24<=4&&(this.citizensAreVeryHappy()||this.citizensAreVeryUnhappy()))null!=this.citizen.inPermanent?this.citizen.goDownTowardsWorldSurface(t):(null==this.currentSprite&&(this.goIntoDirection=il.fromArray([-1,1]),this.citizensAreVeryHappy()?this.currentSprite=new PIXI.Sprite(dt.getTexture("spr_protestsign_happy")):this.currentSprite=new PIXI.Sprite(dt.getTexture("spr_protestsign_sad")),this.currentSprite.position.y=this.citizen.onWorld.rect.y-this.currentSprite.height,this.citizen.onWorld.city.farForegroundStage.addChild(this.currentSprite)),this.citizen.setRelativeX(this.citizen.relativeX+.6666666666666666*t*this.goIntoDirection),1==this.goIntoDirection&&this.citizen.relativeX>=this.citizen.onWorld.rect.width-2||-1==this.goIntoDirection&&this.citizen.relativeX<=0?this.goIntoDirection=-this.goIntoDirection:150<this.goingIntoThisDirection&&1==il.getInt(90)?(this.goIntoDirection=-this.goIntoDirection,this.goingIntoThisDirection=0):this.goingIntoThisDirection+=t,this.currentSprite.position.x=this.citizen.onWorld.rect.x+this.citizen.relativeX-(1==this.goIntoDirection?2:5));else if(null!=this.currentSprite){this.currentSprite.destroy();var e=this.citizen,i=ka.pool,n=0<i[2].length?i[2].splice(i[2].length-1,1)[0]:new Int32Array(2);n[0]=8,n[1]=5,e.setPath(n,0,2,!0),e.pathEndFunction=null,e.pathOnlyRelatedTo=e.inPermanent,this.currentSprite=null}},isActive:function(){return!!(0<=((0|this.time.timeSinceStart)/60|0)%24&&((0|this.time.timeSinceStart)/60|0)%24<=4&&3!=this.citizen.currentAction&&(this.citizensAreVeryHappy()||this.citizensAreVeryUnhappy()))||null!=this.currentSprite},citizensAreVeryHappy:function(){return 99.99<=this.simulation.happiness.happiness},citizensAreVeryUnhappy:function(){return this.simulation.happiness.happiness<=10.01},onDie:function(){cl.prototype.onDie.call(this),null!=this.currentSprite&&(this.currentSprite.destroy(),this.currentSprite=null)},__class__:Wl});var Gl=function(t){Wl.call(this,t)};(q["simulation.citizenSpecialActions.Protester2"]=Gl).__name__="simulation.citizenSpecialActions.Protester2",Gl.__super__=Wl,Gl.prototype=e(Wl.prototype,{citizensAreVeryHappy:function(){return!1},citizensAreVeryUnhappy:function(){return this.simulation.happiness.happiness<=10.01&&this.simulation.happiness.veryUnhappyFromDay<1+((0|this.simulation.time.timeSinceStart)/1440|0)-2},__class__:Gl});var Hl=function(t){Wl.call(this,t)};(q["simulation.citizenSpecialActions.Protester3"]=Hl).__name__="simulation.citizenSpecialActions.Protester3",Hl.__super__=Wl,Hl.prototype=e(Wl.prototype,{citizensAreVeryHappy:function(){return!1},citizensAreVeryUnhappy:function(){return this.simulation.happiness.happiness<=10.01&&this.simulation.happiness.veryUnhappyFromDay<1+((0|this.simulation.time.timeSinceStart)/1440|0)-4},__class__:Hl});var Xl=function(t){Wl.call(this,t)};(q["simulation.citizenSpecialActions.Protester4"]=Xl).__name__="simulation.citizenSpecialActions.Protester4",Xl.__super__=Wl,Xl.prototype=e(Wl.prototype,{citizensAreVeryHappy:function(){return!1},citizensAreVeryUnhappy:function(){return this.simulation.happiness.happiness<=10.01&&this.simulation.happiness.veryUnhappyFromDay<1+((0|this.simulation.time.timeSinceStart)/1440|0)-7},__class__:Xl});var jl=function(t){this.currentSprite=null,cl.call(this,t)};(q["simulation.citizenSpecialActions.WatchStars"]=jl).__name__="simulation.citizenSpecialActions.WatchStars",jl.__super__=cl,jl.prototype=e(cl.prototype,{update:function(t){var e=this;if(0<=((0|this.time.timeSinceStart)/60|0)%24&&((0|this.time.timeSinceStart)/60|0)%24<=4){if(null==this.currentSprite)if(null!=this.citizen.inPermanent)this.citizen.goDownTowardsWorldSurface(t);else{var i=20*ga.findNearestBestBuildingStack(this.citizen,function(t){return 0==t.length||null==t[0]?1e3:t[0].is(Ph)?999:0})+il.getInt(4,14),n=this.citizen;(s=0<(r=ka.pool)[2].length?r[2].splice(r[2].length-1,1)[0]:new Int32Array(2))[0]=4,s[1]=i,n.setPath(s,0,2,!0),n.pathEndFunction=function(){var t=dt.getTexture("spr_telescope");e.currentSprite=new PIXI.Sprite(t),e.currentSprite.position.y=e.citizen.onWorld.rect.y-5,0==il.getInt(2)?e.currentSprite.position.x=e.citizen.onWorld.rect.x+i-4:(e.currentSprite.position.x=e.citizen.onWorld.rect.x+i+2+4,e.currentSprite.scale.x=-1),e.citizen.onWorld.city.farForegroundStage.addChild(e.currentSprite)},n.pathOnlyRelatedTo=n.inPermanent}}else if(null!=this.currentSprite){this.currentSprite.destroy();var r,s;n=this.citizen;(s=0<(r=ka.pool)[2].length?r[2].splice(r[2].length-1,1)[0]:new Int32Array(2))[0]=8,s[1]=5,n.setPath(s,0,2,!0),n.pathEndFunction=null,n.pathOnlyRelatedTo=n.inPermanent,this.currentSprite=null}},isActive:function(){return 0<=((0|this.time.timeSinceStart)/60|0)%24&&((0|this.time.timeSinceStart)/60|0)%24<=4&&3!=this.citizen.currentAction||null!=this.currentSprite},onDie:function(){cl.prototype.onDie.call(this),null!=this.currentSprite&&(this.currentSprite.destroy(),this.currentSprite=null)},__class__:jl});function Vl(t,e,i,n){this.started=!1,this.city=t,this.simulation=e,this.manager=i,this.centerBuilding=n}(q["simulation.festival.Festival"]=Vl).__name__="simulation.festival.Festival",Vl.prototype={get_normalDuration:function(){return 1440},plan:function(){this.city.simulation.time.timeSinceStart;this.timeStart=this.city.simulation.time.timeSinceStart,this.timeEnd=this.timeStart+this.get_normalDuration()},isNow:function(){return this.city.simulation.time.timeSinceStart>=this.timeStart},getText:function(){return Tr.lo("festival_doing")},end:function(){this.manager.endFestival(this);for(var t=0,e=this.city.permanents;t<e.length;){var i=e[t];if(++t,Ko.__implements(i,ve))i.stopFestival()}},update:function(t){this.city.simulation.time.timeSinceStart>this.timeEnd?this.end():this.isNow()&&(this.started||(this.startFestival(),this.started=!0),this.updateFestival(t))},updateFestival:function(t){},startFestival:function(){},doStartRepeatables:function(){for(var t=0,e=this.city.permanents;t<e.length;){var i=e[t];if(++t,Ko.__implements(i,ve))i.initFestival()}},isInvolvedWithFestival:function(t){return!0},citizenFestivalUpdate:function(t,e){},updateFestivalCitizen:function(t,e){if(this.isInvolvedWithFestival(t)){if(!t.fullyBeingControlled){if(K.shouldUpdateDraw=!1,t.delayCanViewSelfInBuilding&&(t.delayCanViewSelfInBuilding=!1,K.shouldUpdateDraw=!0),t.updatePath(e),null==t.path&&!t.isRequestingPath)Uh(this,this.citizenFestivalUpdate)(t,e);K.shouldUpdateDraw&&t.actuallyUpdateDraw()}}else t.fullyBeingControlled||(K.shouldUpdateDraw=!1,t.delayCanViewSelfInBuilding&&(t.delayCanViewSelfInBuilding=!1,K.shouldUpdateDraw=!0),t.updatePath(e),null!=t.path||t.isRequestingPath||t.updateDailyLife(e),K.shouldUpdateDraw&&t.actuallyUpdateDraw())},save:function(t,e){null==e&&(e=!0),e&&t.addString(Vl.saveDefinition);var i=this.timeStart;if(t.size+8>t.bytes.length){var n=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+8))),t.bytes.blit(0,n,0,t.size)}t.bytes.setDouble(t.size,i),t.size+=8;i=this.timeEnd;if(t.size+8>t.bytes.length){n=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+8))),t.bytes.blit(0,n,0,t.size)}t.bytes.setDouble(t.size,i),t.size+=8;i=this.started;if(t.size+1>t.bytes.length){n=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+1))),t.bytes.blit(0,n,0,t.size)}t.bytes.b[t.size]=i?1:0,t.size+=1},load:function(t,e){null==e&&(e=t.readString());var i=Dr.makeLoadMap(e,t);Object.prototype.hasOwnProperty.call(i.h,"timeStart")&&(this.timeStart=i.h.timeStart),Object.prototype.hasOwnProperty.call(i.h,"timeEnd")&&(this.timeEnd=i.h.timeEnd),Object.prototype.hasOwnProperty.call(i.h,"started")&&(this.started=i.h.started)},__class__:Vl};var Yl=function(t,e){this.festivalCoolDown=0,this.city=t,this.simulation=e,this.festivals=[];var i=[];i.push(!1),i.push(!1),i.push(!1),i.push(!1),i.push(!1),i.push(!1),i.push(!1),this.wasFestivalOnDay=i};(q["simulation.festival.FestivalManager"]=Yl).__name__="simulation.festival.FestivalManager",Yl.prototype={addFestival:function(t){this.festivals.push(t)},hasNoPlannedFestival:function(){return 0==this.festivals.length},plannedFestival:function(){for(var t=0,e=this.festivals;t<e.length;){var i=e[t];if(++t,!i.started)return i}return null},hasFestival:function(){return gr.any(this.festivals,function(t){return t.isNow()})},updateFestivalCitizens:function(t){for(var e=0,i=this.festivals;e<i.length;){var n=i[e];++e;for(var r=0,s=this.simulation.citizens;r<s.length;){var o=s[r];++r,n.updateFestivalCitizen(o,t)}}},currentFestival:function(){for(var t=0,e=this.festivals;t<e.length;){var i=e[t];if(++t,i.isNow())return i}return null},update:function(t){var e=this.currentFestival();null!=e&&(e.update(t),this.wasFestivalOnDay[0]=!0),-1<this.festivalCoolDown&&(this.festivalCoolDown-=t*this.city.simulation.time.minutesPerTick)},endFestival:function(t){at.remove(this.festivals,t)},save:function(t){var e=this.festivals.length;if(t.size+4>t.bytes.length){var i=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+4))),t.bytes.blit(0,i,0,t.size)}t.bytes.setInt32(t.size,e),t.size+=4;for(var n=0,r=this.festivals;n<r.length;){var s=r[n];++n;var o=Ko.getClass(s);t.addString(o.__name__);e=s.centerBuilding.id;if(t.size+4>t.bytes.length){i=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+4))),t.bytes.blit(0,i,0,t.size)}t.bytes.setInt32(t.size,e),t.size+=4,s.save(t)}e=this.wasFestivalOnDay.length;if(t.size+4>t.bytes.length){i=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+4))),t.bytes.blit(0,i,0,t.size)}t.bytes.setInt32(t.size,e),t.size+=4;for(n=0,r=this.wasFestivalOnDay.length;n<r;){var a=n++;e=this.wasFestivalOnDay[a];if(t.size+1>t.bytes.length){i=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+1))),t.bytes.blit(0,i,0,t.size)}t.bytes.b[t.size]=e?1:0,t.size+=1}e=this.festivalCoolDown;if(t.size+8>t.bytes.length){i=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+8))),t.bytes.blit(0,i,0,t.size)}t.bytes.setDouble(t.size,e),t.size+=8},load:function(t){var e=t.bytes.getInt32(t.readStart);t.readStart+=4;for(var i=0,n=e;i<n;){var r=i++,s=t.readString();e=t.bytes.getInt32(t.readStart);t.readStart+=4;var o=e,a=k.createInstance(q[s],[this.city,this.simulation,this,this.city.findPermanentByID(o)]);a.load(t),this.festivals.push(a)}if(28<=t.version){e=t.bytes.getInt32(t.readStart);t.readStart+=4;for(i=0,n=e;i<n;){r=i++;var l=t.bytes.b[t.readStart];t.readStart+=1,this.wasFestivalOnDay[r]=0<l}}if(30<=t.version){var h=t.bytes.getDouble(t.readStart);t.readStart+=8,this.festivalCoolDown=h}},afterLoad:function(){for(var t=0,e=this.festivals;t<e.length;){var i=e[t];++t,i.started&&i.doStartRepeatables()}},__class__:Yl};var ql=function(t,e,i,n){Vl.call(this,t,e,i,n)};(q["simulation.festival.MusicFestival"]=ql).__name__="simulation.festival.MusicFestival",ql.involvedCitizens=function(t){for(var e=[],i=0,n=t.citizens;i<n.length;){var r=n[i];++i,18<r.get_age()&&(null==r.job||!r.job.is(Ki))&&e.push(r)}return e},ql.canDo=function(t,e,i){var n=ql.involvedCitizens(e).length,r=ql.relevantBuildings(e,i).length;return n>ql.minCitizens&&(n/100|0)<r},ql.relevantBuildings=function(t,e){var n=[];return t.permanentFinder.query(e,function(t){if(t.isBuilding){var e=t;if(e.isEntertainment){var i=e;3!=i.get_entertainmentType()&&0!=i.get_entertainmentType()&&1!=i.get_entertainmentType()||e.couldStandHere()&&!e.is(Ue)&&n.push(i)}}return!1}),n},ql.__super__=Vl,ql.prototype=e(Vl.prototype,{isInvolvedWithFestival:function(t){return 18<t.get_age()&&(null==t.job||!t.job.is(Ki))},updateFestival:function(t){},doStartRepeatables:function(){Vl.prototype.doStartRepeatables.call(this);var t=ql.involvedCitizens(this.simulation).length/ql.citizensPerVenue|0,e=[];this.currentFestivalVenues=ql.relevantBuildings(this.simulation,this.centerBuilding),this.currentFestivalVenues.length>t&&(e=this.currentFestivalVenues.splice(t,this.currentFestivalVenues.length-t));for(var i=0,n=this.currentFestivalVenues.length;i<n;){for(var r=i++,s=this.currentFestivalVenues[r];null!=s.leftBuilding&&-1!=e.indexOf(s.leftBuilding);)at.remove(e,s.leftBuilding),this.currentFestivalVenues.push(s.leftBuilding),s=s.leftBuilding;for(s=this.currentFestivalVenues[r];null!=s.rightBuilding&&-1!=e.indexOf(s.rightBuilding);)at.remove(e,s.rightBuilding),this.currentFestivalVenues.push(s.rightBuilding),s=s.rightBuilding}this.currentFestivalVenuesSet=new jo,this.currentTempWorkers=new jo;for(i=0,n=this.currentFestivalVenues;i<n.length;){s=n[i];++i,this.currentFestivalVenuesSet.set(s,!0);this.currentTempWorkers.set(s,[])}},startFestival:function(){this.doStartRepeatables(),this.simulation.happiness.addBoost(Tl.withDuration(this.simulation.time,ql.happinessBoostDuration,ql.happinessBoostGiven,Tr.lo("music_festival_boost")))},citizenFestivalUpdate:function(t,e){var i=!1;if(t.tryFinishWork(e)){if(null!=(null!=t.inPermanent&&t.inPermanent.isBuilding?t.inPermanent:null)&&null!=this.currentFestivalVenuesSet.h.__keys__[(null!=t.inPermanent&&t.inPermanent.isBuilding?t.inPermanent:null).__id__]){var n=this.currentTempWorkers.h[(null!=t.inPermanent&&t.inPermanent.isBuilding?t.inPermanent:null).__id__],r=(null!=t.inPermanent&&t.inPermanent.isBuilding?t.inPermanent:null).is(ee),s=null!=t.inPermanent&&t.inPermanent.isBuilding?t.inPermanent:null,o=null,a=!1;Ko.__implements(null!=t.inPermanent&&t.inPermanent.isBuilding?t.inPermanent:null,ve)&&(o=null!=t.inPermanent&&t.inPermanent.isBuilding?t.inPermanent:null,a=!0);for(var l=!1,h=n.length,u=0;0<=--h;){var c=n[h];c.hasDied||!this.isInvolvedWithFestival(c)?n.splice(h,1):c==t&&(u=h,l=!0)}if((!a&&r&&n.length<s.get_jobs()||a&&n.length<o.festivalJobs)&&(l||(l=!0,n.push(t))),l)i=!0,a?o.doFestivalWork(this,t,e,u):s.work(t,e,!1);else{var d=y=t.entertainment,p=!0,f=y.citizen.inPermanent,g=y.citizen.simulation.time.timeSinceStart;if(!y.entertainmentInited){var m=1;null==y.citizen.job&&null==y.citizen.school&&(m=.75),y.entertainmentFinishedTime=g+60*il.getFloat(f.get_minimumNormalTimeToSpend(),f.get_maximumNormalTimeToSpend()),y.recentEntertainmentTypes[f.get_entertainmentType()]=g+1440*il.getFloat(f.get_minimumEntertainmentGroupSatisfy(),f.get_maximumEntertainmentGroupSatisfy())*m,y.entertainmentInited=!0}if(g>=y.entertainmentFinishedTime)if(f.finishEntertainment(y.citizen,e))p=!1,y.entertainmentInited=!1;else if(a){(o=null!=(y=d.citizen).inPermanent&&y.inPermanent.isBuilding?y.inPermanent:null).beEntertainedFestival(this,d.citizen,e)}else f.beEntertained(d.citizen,e);else if(a){var y;(o=null!=(y=d.citizen).inPermanent&&y.inPermanent.isBuilding?y.inPermanent:null).beEntertainedFestival(this,d.citizen,e)}else f.beEntertained(d.citizen,e);i=p,t.dynamicUnsavedVars.searchingFestivalBuilding=null}t.canViewSelfInBuilding=!0}if(!i)if(null==t.dynamicUnsavedVars.searchingFestivalBuilding||t.dynamicUnsavedVars.searchingFestivalBuilding.destroyed){var _=il.fromArray(this.currentFestivalVenues);_.destroyed||(t.simulation.pathfinder.findPath(t,_),t.pathOnFail=null,t.dynamicUnsavedVars.searchingFestivalBuilding=_)}else t.simulation.pathfinder.findPath(t,t.dynamicUnsavedVars.searchingFestivalBuilding),t.pathOnFail=null}},getText:function(){return this.isNow()?Tr.lo("music_festival_doing"):Tr.lo("music_festival_planned")},end:function(){for(var t=0,e=this.city.simulation.citizens;t<e.length;){var i=e[t];if(++t,null!=(null!=i.inPermanent&&i.inPermanent.isBuilding?i.inPermanent:null)){var n=this.currentTempWorkers.h[(null!=i.inPermanent&&i.inPermanent.isBuilding?i.inPermanent:null).__id__];if(null!=n&&-1!=n.indexOf(i)){var r=null,s=!1,o=null!=i.inPermanent&&i.inPermanent.isBuilding?i.inPermanent:null;Ko.__implements(null!=i.inPermanent&&i.inPermanent.isBuilding?i.inPermanent:null,ve)&&(r=null!=i.inPermanent&&i.inPermanent.isBuilding?i.inPermanent:null,s=!0),s?r.endFestivalWork(this,i):o.work(i,0,!0)}}}Vl.prototype.end.call(this)},save:function(t,e){null==e&&(e=!0),Vl.prototype.save.call(this,t),e&&t.addString(ql.saveDefinition)},load:function(t,e){Vl.prototype.load.call(this,t),null==e&&(e=t.readString());Dr.makeLoadMap(e,t)},__class__:ql});function Kl(t){this.city=t}(q["simulation.winter.SantaHats"]=Kl).__name__="simulation.winter.SantaHats",Kl.prototype={update:function(t){for(var e=dt.getTexturesByWidth("spr_santahat",4),i=0,n=this.city.simulation.citizens;i<n.length;){var r=n[i];++i,null==r.inPermanent||r.inPermanent.is(E)?(null==r.accessorySprite&&(r.accessorySprite=new PIXI.Sprite(e[r.nameIndex%e.length]),r.accessorySprite.anchor.set(.5,0),r.accessorySprite.position.set(1,-r.actualSpriteHeight),r.sprite.addChild(r.accessorySprite)),null!=r.path&&(4==r.currentPathAction?r.currentPathActionTimerXY<r.relativeX?r.accessorySprite.scale.x=1:r.accessorySprite.scale.x=-1:5==r.currentPathAction&&(null!=r.currentPathActionPermanent&&r.currentPathActionPermanent.position.x+(r.currentPathActionPermanent.isBuilding?r.currentPathActionPermanent.doorX:0)<r.relativeX?r.accessorySprite.scale.x=1:r.accessorySprite.scale.x=-1))):null==r.accessorySprite||r.inPermanent.is(li)||(r.accessorySprite.destroy(),r.accessorySprite=null)}},__class__:Kl};function $l(t){this.hasCreated=!1,this.city=t,this.snowSprites=[]}(q["simulation.winter.Snow"]=$l).__name__="simulation.winter.Snow",$l.prototype={update:function(t){if(!this.hasCreated){this.hasCreated=!0;this.city.getCityEdges();for(var e=dt.getTexturesByWidth("spr_snow",20),i=0,n=this.city.worlds;i<n.length;){var r=n[i];if(++i,0!=r.rect.height)for(var s=0,o=r.permanents.length;s<o;){var a=s++,l=new PIXI.Sprite(il.fromArray(e));l.position.set(r.rect.x+20*a,r.rect.y-20+17),this.city.furtherForegroundStage.addChild(l)}}}},__class__:$l};var Ql=function(t){this.city=t,this.snow=new $l(t),this.santaHats=new Kl(t)};(q["simulation.winter.Winter"]=Ql).__name__="simulation.winter.Winter",Ql.prototype={update:function(t){null!=this.santaHats&&this.santaHats.update(t),null!=this.snow&&this.snow.update(t)},__class__:Ql};var Jl=function(){};(q["testing.PermanentFinderPerfTest"]=Jl).__name__="testing.PermanentFinderPerfTest",Jl.doTest=function(t){for(var e=function(){var e=il.fromArray(t.permanents);t.simulation.permanentFinder.query(il.fromArray(t.permanents),function(t){return t==e})},i=window.performance.now(),n=0;n<1e4;){n++;e()}console.log("FloatingSpaceCities/testing/PermanentFinderPerfTest.hx:21:",window.performance.now()-i)};function Zl(){}(q["thx.ArrayFloats"]=Zl).__name__="thx.ArrayFloats",Zl.resize=function(t,e,i){for(null==i&&(i=0);t.length<e;)t.push(i);return t.splice(e,t.length-e),t},Zl.resized=function(t,e,i){return null==i&&(i=0),t=t.slice(),Zl.resize(t,e,i)};function th(){}(q["thx.ArrayInts"]=th).__name__="thx.ArrayInts",th.resize=function(t,e,i){for(null==i&&(i=0);t.length<e;)t.push(i);return t.splice(e,t.length-e),t},th.resized=function(t,e,i){return null==i&&(i=0),t=t.slice(),th.resize(t,e,i)};function eh(){}(q["thx.Floats"]=eh).__name__="thx.Floats",eh.canParse=function(t){return!(!eh.pattern_parse.match(t)&&!eh.pattern_inf.match(t))||eh.pattern_neg_inf.match(t)},eh.parse=function(t){return"+"==t.substring(0,1)&&(t=t.substring(1)),eh.pattern_inf.match(t)?1/0:eh.pattern_neg_inf.match(t)?-1/0:parseFloat(t)},eh.wrapCircular=function(t,e){return(t%=e)<0&&(t+=e),t};function ih(){}(q["thx.Ints"]=ih).__name__="thx.Ints",ih.parse=function(t,e){null==e&&(e="0x"==t.substring(0,2)?16:10);var i=parseInt(t,e);return isNaN(i)?null:i};var nh={fromFloats:function(t){return[(t=Zl.resized(t,3))[0],t[1],t[2]]},toRgbx:function(t){return[1-t[0],1-t[1],1-t[2]]},toRgbxa:function(t){return mh.toRgbxa(nh.toRgbx(t))}},rh={fromFloats:function(t){return[(t=Zl.resized(t,4))[0],t[1],t[2],t[3]]},toRgbx:function(t){return[(1-t[3])*(1-t[0]),(1-t[3])*(1-t[1]),(1-t[3])*(1-t[2])]},toRgbxa:function(t){return mh.toRgbxa(rh.toRgbx(t))}},sh={fromFloats:function(t){t.length<4&&(t=Zl.resized(t,3)).push(1);var e=t[3];return[t[0],t[1],t[2],null==e?1:e]},toRgbx:function(t){var e=isNaN(t[0])?0:(t[0]+120)/180*Math.PI,i=Math.pow(t[2],t[3]),n=isNaN(t[1])?0:t[1]*i*(1-i),r=Math.cos(e),s=Math.sin(e);return t=[i+n*(-.14861*r+1.78277*s),i+n*(-.29227*r+-.90649*s),i+1.97294*r*n]},toRgbxa:function(t){return mh.toRgbxa(sh.toRgbx(t))}},oh={toRgbx:function(t){return[t,t,t]},toRgbxa:function(t){return mh.toRgbxa(oh.toRgbx(t))}},ah={fromFloats:function(t){return[(t=Zl.resized(t,3))[0],t[1],t[2]]},toRgb:function(t){return mh.toRgb(ah.toRgbx(t))},toRgbx:function(t){return[ah._c(t[0]+120,t[1],t[2]),ah._c(t[0],t[1],t[2]),ah._c(t[0]-120,t[1],t[2])]},toRgbxa:function(t){return mh.toRgbxa(ah.toRgbx(t))},_c:function(t,e,i){var n=i<=.5?i*(1+e):i+e-i*e,r=2*i-n;return(t=eh.wrapCircular(t,360))<60?r+(n-r)*t/60:t<180?n:t<240?r+(n-r)*(240-t)/60:r}},lh={fromFloats:function(t){return[(t=Zl.resized(t,4))[0],t[1],t[2],t[3]]},toRgbxa:function(t){return[ah._c(t[0]+120,t[1],t[2]),ah._c(t[0],t[1],t[2]),ah._c(t[0]-120,t[1],t[2]),t[3]]}},hh={fromFloats:function(t){return[(t=Zl.resized(t,3))[0],t[1],t[2]]},toRgb:function(t){return mh.toRgb(hh.toRgbx(t))},toRgbx:function(t){var e,i,n;if(0==t[1])return[t[2],t[2],t[2]];var r=t[0]/60,s=Math.floor(r),o=r-s,a=t[2]*(1-t[1]),l=t[2]*(1-o*t[1]),h=t[2]*(1-(1-o)*t[1]);switch(s){case 0:e=t[2],i=h,n=a;break;case 1:e=l,i=t[2],n=a;break;case 2:e=a,i=t[2],n=h;break;case 3:e=a,i=l,n=t[2];break;case 4:e=h,i=a,n=t[2];break;default:e=t[2],i=a,n=l}return t=[e,i,n]},toRgbxa:function(t){return mh.toRgbxa(hh.toRgbx(t))}},uh={fromFloats:function(t){return[(t=Zl.resized(t,4))[0],t[1],t[2],t[3]]},toRgbxa:function(t){var e,i,n;if(0==t[1])return[t[2],t[2],t[2],t[3]];var r=t[0]/60,s=Math.floor(r),o=r-s,a=t[2]*(1-t[1]),l=t[2]*(1-o*t[1]),h=t[2]*(1-(1-o)*t[1]);switch(s){case 0:e=t[2],i=h,n=a;break;case 1:e=l,i=t[2],n=a;break;case 2:e=a,i=t[2],n=h;break;case 3:e=a,i=l,n=t[2];break;case 4:e=h,i=a,n=t[2];break;default:e=t[2],i=a,n=l}return[e,i,n,t[3]]}},ch={fromFloats:function(t){return[(t=Zl.resized(t,3))[0],t[1],t[2]]},toRgbx:function(t){return _h.toRgbx(ch.toXyz(t))},toRgbxa:function(t){return mh.toRgbxa(ch.toRgbx(t))},toXyz:function(t){var e=t[1]/17.5*(t[0]/10),i=t[0]/10,n=i*i;return t=[(e+n)/1.02,n,-(t[2]/7*(t[0]/10)-n)/.847]}},dh={fromFloats:function(t){return[(t=Zl.resized(t,3))[0],t[1],t[2]]},toLab:function(t){var e=t[2]*(Math.PI/180),i=Math.cos(e)*t[1],n=Math.sin(e)*t[1];return[t[0],i,n]},toRgbx:function(t){return ph.toRgbx(dh.toLab(t))},toRgbxa:function(t){return mh.toRgbxa(dh.toRgbx(t))}},ph={fromFloats:function(t){return[(t=Zl.resized(t,3))[0],t[1],t[2]]},toRgbx:function(t){return _h.toRgbx(ph.toXyz(t))},toRgbxa:function(t){return mh.toRgbxa(ph.toRgbx(t))}};ph.toXyz=function(t){function e(t){return.20689655172413793<t?Math.pow(t,3):.12841854934601665*(t-.13793103448275862)}return t=[_h.whiteReference[0]*e(.008620689655172414*(t[0]+16)+.002*t[1]),_h.whiteReference[1]*e(.008620689655172414*(t[0]+16)),_h.whiteReference[2]*e(.008620689655172414*(t[0]+16)-.005*t[2])]};var fh={fromFloats:function(t){return[(t=Zl.resized(t,3))[0],t[1],t[2]]},toRgbx:function(t){return _h.toRgbx(fh.toXyz(t))},toRgbxa:function(t){return mh.toRgbxa(fh.toRgbx(t))},toXyz:function(t){var e=100*t[0],i=100*t[1],n=100*t[2],r=(0==e?0:i/(13*e))+100*_h.get_u(_h.whiteReference),s=(0==e?0:n/(13*e))+100*_h.get_v(_h.whiteReference),o=8<e?100*_h.whiteReference[1]*Math.pow((16+e)/116,3):100*_h.whiteReference[1]*e*Math.pow(.10344827586206896,3);return t=[9*o*r/(4*s)/100,o/100,o*(12-3*r-20*s)/(4*s)/100]}},gh={toHsv:function(t){return mh.toHsv(gh.toRgbx(t))},toRgbx:function(t){return mh.fromInts([gh.get_red(t),gh.get_green(t),gh.get_blue(t)])},toInt:function(t){return t},get_red:function(t){return t>>16&255},get_green:function(t){return t>>8&255},get_blue:function(t){return 255&t}},mh={fromFloats:function(t){return[(t=Zl.resized(t,3))[0],t[1],t[2]]},fromInts:function(t){return[(t=th.resized(t,3))[0]/255,t[1]/255,t[2]/255]},withAlpha:function(t,e){return t.concat([e])},toHsv:function(t){var e,i,n=Math.min(Math.min(t[0],t[1]),t[2]),r=Math.max(Math.max(t[0],t[1]),t[2]),s=r-n,o=r;return 0==s?[e=-1,i=0,o]:(i=s/r,e=t[0]==r?(t[1]-t[2])/s:t[1]==r?2+(t[2]-t[0])/s:4+(t[0]-t[1])/s,(e*=60)<0&&(e+=360),t=[e,i,o])},toRgb:function(t){return(255&Math.round(255*t[0]))<<16|(255&Math.round(255*t[1]))<<8|255&Math.round(255*t[2])},toRgbxa:function(t){return mh.withAlpha(t,1)}},yh={fromFloats:function(t){return[(t=Zl.resized(t,4))[0],t[1],t[2],t[3]]},toRgb:function(t){return mh.toRgb(yh.toRgbx(t))},toRgbx:function(t){return t.slice(0,3)}},_h={fromFloats:function(t){return[(t=Zl.resized(t,3))[0],t[1],t[2]]},toRgbx:function(t){var e=t[0],i=t[1],n=t[2],r=3.2406*e+-1.5372*i+-.4986*n,s=-.9689*e+1.8758*i+.0415*n,o=.0557*e+-.204*i+1.057*n;return t=[r=.0031308<r?1.055*Math.pow(r,.4166666666666667)-.055:12.92*r,s=.0031308<s?1.055*Math.pow(s,.4166666666666667)-.055:12.92*s,o=.0031308<o?1.055*Math.pow(o,.4166666666666667)-.055:12.92*o]},toRgbxa:function(t){return mh.toRgbxa(_h.toRgbx(t))},get_u:function(t){try{return 4*t[0]/(t[0]+15*t[1]+3*t[2])}catch(t){return 0}},get_v:function(t){try{return 9*t[1]/(t[0]+15*t[1]+3*t[2])}catch(t){return 0}}},vh={fromFloats:function(t){return[(t=Zl.resized(t,3))[0],t[1],t[2]]},toRgbx:function(t){return t=[t[0]+1.1398373983739838*t[2],t[0]-.39465170435897035*t[1]-.5805986066674976*t[2],t[0]+2.032110091743119*t[1]]},toRgbxa:function(t){return mh.toRgbxa(vh.toRgbx(t))}},bh={fromFloats:function(t){return[(t=Zl.resized(t,3))[0],t[1],t[2]]},toRgbxa:function(t){return _h.toRgbxa(bh.toXyz(t))},toXyz:function(t){return[t[1]*(t[0]/t[2]),t[0],(1-t[1]-t[2])*(t[0]/t[2])]}},wh=function(){this.pattern_color=new c("^\\s*([^(]+)\\s*\\(([^)]*)\\)\\s*$","i"),this.pattern_channel=new c("^\\s*(-?\\d*.\\d+|-?\\d+)(%|deg|rad)?\\s*$","i")};(q["thx.color.parse.ColorParser"]=wh).__name__="thx.color.parse.ColorParser",wh.parseColor=function(t){return wh.parser.processColor(t)},wh.parseHex=function(t){return wh.parser.processHex(t)},wh.getFloatChannels=function(t,e,i){if(e!=t.length)throw Co.thrown("invalid number of channels, expected "+e+" but it is "+t.length);for(var n,r=i,s=new Array(t.length),o=0,a=t.length;o<a;){var l=o++;s[l]=(n=t[l],wh.getFloatChannel(n,r))}return s},wh.getFloatChannel=function(t,e){switch(null==e&&(e=!0),t._hx_index){case 0:return(n=t.value)/100;case 1:case 2:return n=t.value;case 3:var i=t.value;n=i;return e?n/255:n=i;case 4:return n=t.value;case 5:var n;return(n=t.value)?1:0}},wh.prototype={processHex:function(t){if(!wh.isPureHex.match(t))if("#"==at.substr(t,0,1))t=4==t.length?t.charAt(1)+t.charAt(1)+t.charAt(2)+t.charAt(2)+t.charAt(3)+t.charAt(3):5==t.length?t.charAt(1)+t.charAt(1)+t.charAt(2)+t.charAt(2)+t.charAt(3)+t.charAt(3)+t.charAt(4)+t.charAt(4):at.substr(t,1,null);else{if("0x"!=at.substr(t,0,2))return null;t=at.substr(t,2,null)}for(var e=[];0<t.length;)e.push(xh.CIInt8(Y.parseInt("0x"+at.substr(t,0,2)))),t=at.substr(t,2,null);if(4!=e.length)return new Sh("rgb",e);var i=e[0];return new Sh("rgba",e.slice(1).concat([i]))},processColor:function(t){if(!this.pattern_color.match(t))return null;var e=this.pattern_color.matched(1);if(null==e)return null;e=e.toLowerCase();for(var i,n=this.pattern_color.matched(2),r=null==n?[]:n.split(","),s=[],o=0;o<r.length;){var a=r[o];if(++o,null==(i=this.processChannel(a)))return null;s.push(i)}return new Sh(e,s)},processChannel:function(t){if(!this.pattern_channel.match(t))return null;var e=this.pattern_channel.matched(1),i=this.pattern_channel.matched(2);null==i&&(i="");try{switch(i){case"":if(e!=""+ih.parse(e))return eh.canParse(e)?xh.CIFloat(eh.parse(e)):null;var n=ih.parse(e);return 0==n?xh.CIBool(!1):1==n?xh.CIBool(!0):n<256?xh.CIInt8(n):xh.CIInt(n);case"%":return eh.canParse(e)?xh.CIPercent(eh.parse(e)):null;case"DEG":case"deg":return eh.canParse(e)?xh.CIDegree(eh.parse(e)):null;case"RAD":case"rad":return eh.canParse(e)?xh.CIDegree(180*eh.parse(e)/Math.PI):null;default:return null}}catch(t){return null}},__class__:wh};var Sh=function(t,e){this.name=t,this.channels=e};(q["thx.color.parse.ColorInfo"]=Sh).__name__="thx.color.parse.ColorInfo",Sh.prototype={__class__:Sh};var xh=T["thx.color.parse.ChannelInfo"]={__ename__:"thx.color.parse.ChannelInfo",__constructs__:["CIPercent","CIFloat","CIDegree","CIInt8","CIInt","CIBool"],CIPercent:(N=function(t){return{_hx_index:0,value:t,__enum__:"thx.color.parse.ChannelInfo",toString:i}},N.__params__=["value"],N),CIFloat:(N=function(t){return{_hx_index:1,value:t,__enum__:"thx.color.parse.ChannelInfo",toString:i}},N.__params__=["value"],N),CIDegree:(N=function(t){return{_hx_index:2,value:t,__enum__:"thx.color.parse.ChannelInfo",toString:i}},N.__params__=["value"],N),CIInt8:(N=function(t){return{_hx_index:3,value:t,__enum__:"thx.color.parse.ChannelInfo",toString:i}},N.__params__=["value"],N),CIInt:(N=function(t){return{_hx_index:4,value:t,__enum__:"thx.color.parse.ChannelInfo",toString:i}},N.__params__=["value"],N),CIBool:(N=function(t){return{_hx_index:5,value:t,__enum__:"thx.color.parse.ChannelInfo",toString:i}},N.__params__=["value"],N)},Th=function(t,e,i,n,r,s,o,a){this.standingPlaces=[],this.spriteName="",this.bonusesAwarded=0,this.explored=0,this.spriteName=null==a?il.fromArray(["spr_alienruins","spr_alienruins_2"]):a,E.call(this,t,e,i,n,r,s,o,dt.getTexture(this.spriteName)),this.standingPlaces=[2,3,8,9,10,15,16],this.bonusesAwarded=0,this.myAwardedBonuses=[]};(q["worldResources.AlienRuins"]=Th).__name__="worldResources.AlienRuins",Th.__super__=E,Th.prototype=e(E.prototype,{get_name:function(){return Tr.lo("alien_ruins")},get_climbX:function(){return"spr_alienruins"==this.spriteName?9:15},get_climbY:function(){return"spr_alienruins"==this.spriteName?17:16},getBonuses:function(t){function e(t,e,i){return{name:t,description:e,onGet:i}}function i(t,e,i){return{name:t,description:e,onGet:function(){n.city.materials.add(i),i.addToProduction(n.city.simulation.stats)}}}var n=this;switch(t){case 0:return[i(Tr.lo("alien_ruins_find_1a"),Tr.lo("alien_ruins_description_1a"),new L(20)),i(Tr.lo("alien_ruins_find_1b"),Tr.lo("alien_ruins_description_1b"),new L(0,25)),i(Tr.lo("alien_ruins_find_1c"),Tr.lo("alien_ruins_description_1c"),new L(0,22)),i(Tr.lo("alien_ruins_find_1d"),Tr.lo("alien_ruins_description_1d"),new L(0,0,12,5))];case 1:return[i(Tr.lo("alien_ruins_find_2a"),Tr.lo("alien_ruins_description_2a"),new L(40)),i(Tr.lo("alien_ruins_find_2b"),Tr.lo("alien_ruins_description_2b"),new L(0,35)),i(Tr.lo("alien_ruins_find_2c"),Tr.lo("alien_ruins_description_2c"),new L(0,0,0,20)),i(Tr.lo("alien_ruins_find_2d"),Tr.lo("alien_ruins_description_2d"),new L(0,0,42,0))];case 2:return[i(Tr.lo("alien_ruins_find_3a"),Tr.lo("alien_ruins_description_3a"),new L(10,0,0,5)),i(Tr.lo("alien_ruins_find_3b"),Tr.lo("alien_ruins_description_3b"),new L(17)),i(Tr.lo("alien_ruins_find_3c"),Tr.lo("alien_ruins_description_3c"),new L(0,15)),i(Tr.lo("alien_ruins_find_3d"),Tr.lo("alien_ruins_description_3d"),new L(0,0,22))];case 3:return[e(Tr.lo("alien_ruins_find_4a"),Tr.lo("alien_ruins_description_4a"),function(){n.city.simulation.bonuses.extraFoodFromFarms+=5}),e(Tr.lo("alien_ruins_find_4b"),Tr.lo("alien_ruins_description_4b"),function(){n.city.progress.unlocks.unlock(se),n.city.progress.unlocks.unlock(or)}),e(Tr.lo("alien_ruins_find_4c"),Tr.lo("alien_ruins_description_4c"),function(){n.city.simulation.bonuses.machinePartsFactorySpeed*=1.1}),e(Tr.lo("alien_ruins_find_4d"),Tr.lo("alien_ruins_description_4d"),function(){n.city.simulation.bonuses.labSpeed*=1.05})];default:return[]}},addWindowInfoLines:function(){var t=this;E.prototype.addWindowInfoLines.call(this);var e=this.city.gui,i=e.windowInner;if(e.windowAddInfoText(null,function(){return Tr.lo("n_pct_explored",[0|t.explored])}),i.addChild(new ao(i,e.innerWindowStage,Tr.lo("findings"),null,"Arial15",{left:0,right:0,top:3,bottom:0})),0==this.myAwardedBonuses.length)e.windowAddInfoText(Tr.lo("exploration_nothing_found"));else for(var n=0,r=this.myAwardedBonuses;n<r.length;){var s=r[n];++n,e.windowAddInfoText(s.name+": "+s.description)}},createMoveWindow:function(){var i=this;this.city.createWorldResourceBuilderMove(this),this.city.gui.showSimpleWindow(Tr.lo("move_ruins_howto"),null,!0),this.city.gui.setWindowPositioning(fo.Top),this.selectedSprite=dt.makeSprite("spr_selectedbuilding"),this.selectedSprite.position.set(this.position.x-1,this.position.y-1),this.city.farForegroundStage.addChild(this.selectedSprite),this.city.gui.windowOnDestroy=function(){var t;if(null!=i.city.builder){var e=i.city.builder.builderType;if(3==e._hx_index){e.worldResource;t=!0}else t=!1}else t=!1;t&&i.city.builder.cancel(),null!=i.selectedSprite&&(i.selectedSprite.destroy(),i.selectedSprite=null)},this.city.gui.windowOnLateUpdate=function(){var t;if(null!=i.city.builder){var e=i.city.builder.builderType;if(3==e._hx_index){e.worldResource;t=!1}else t=!0}else t=!0;t&&i.city.gui.closeWindow()},this.city.gui.addWindowToStack(Uh(this,this.createMoveWindow))},createWindowAddBottomButtons:function(){var t=this;100<=this.explored?this.city.gui.windowAddBottomButtons([{text:Tr.lo("move"),action:function(){t.createMoveWindow()}}]):this.city.gui.windowAddBottomButtons()},awardAnyBonuses:function(){if(this.bonusesAwarded<((0|this.explored)/25|0)&&this.explored>=25*(this.bonusesAwarded+1)){for(var t,e=this.getBonuses(this.bonusesAwarded),i=[],n=0,r=e;n<r.length;){var s=r[n];++n,-1==Th.alreadyFoundBonuses.indexOf(s.name)&&i.push(s)}if(0<(e=lt.array(i)).length){t=il.fromArray(e);var o=lt.find(e,function(t){return t.name==Tr.lo("alien_ruins_find_4b")});lt.count(this.city.permanents,function(t){return t.is(Th)})<4&&null!=o&&(t=o),t.onGet(),this.myAwardedBonuses.push(t),Th.alreadyFoundBonuses.push(t.name),this.city.gui.windowRelatedTo==this&&this.reloadWindow()}this.bonusesAwarded+=1}},createBonusWindow:function(t){this.city.gui.showSimpleWindow(t.description,"Alien Ruins Exploration Update",!0)},save:function(t,e){null==e&&(e=!1),E.prototype.save.call(this,t),this.saveBasics(t);var i=this.myAwardedBonuses.length;if(t.size+4>t.bytes.length){var n=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+4))),t.bytes.blit(0,n,0,t.size)}t.bytes.setInt32(t.size,i),t.size+=4;for(var r=0,s=this.myAwardedBonuses;r<s.length;){var o=s[r];++r,t.addString(o.name),t.addString(o.description)}},load:function(t,e){E.prototype.load.call(this,t),this.loadBasics(t);var i=t.bytes.getInt32(t.readStart);t.readStart+=4;for(var n=0,r=i;n<r;){n++;var s={name:t.readString(),description:t.readString()};this.myAwardedBonuses.push(s),Th.alreadyFoundBonuses.push(s.name)}},postLoad:function(){this.sprite.texture=dt.getTexture(this.spriteName)},saveBasics:function(t,e){null==e&&(e=!0),e&&t.addString(Th.saveDefinition);var i=this.explored;if(t.size+8>t.bytes.length){var n=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+8))),t.bytes.blit(0,n,0,t.size)}t.bytes.setDouble(t.size,i),t.size+=8;i=this.bonusesAwarded;if(t.size+4>t.bytes.length){n=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+4))),t.bytes.blit(0,n,0,t.size)}t.bytes.setInt32(t.size,i),t.size+=4,t.addString(this.spriteName)},loadBasics:function(t,e){null==e&&(e=t.readString());var i=Dr.makeLoadMap(e,t);Object.prototype.hasOwnProperty.call(i.h,"explored")&&(this.explored=i.h.explored),Object.prototype.hasOwnProperty.call(i.h,"bonusesAwarded")&&(this.bonusesAwarded=i.h.bonusesAwarded),Object.prototype.hasOwnProperty.call(i.h,"spriteName")&&(this.spriteName=i.h.spriteName),this.postLoad()},__class__:Th});var Ih=function(t,e,i,n,r,s,o,a,l,h){this.maxCitizenX=17,this.minCitizenX=1,this.regrowProgress=0,this.textures=dt.getTexturesByWidth(a,20),this.regrowTextures=null==h?null:dt.getTexturesByWidth(h,20),this.initialMaterials=l,this.materialsLeft=l,E.call(this,t,e,i,n,r,s,o,this.textures[0])};(q["worldResources.LimitedWorldResource"]=Ih).__name__="worldResources.LimitedWorldResource",Ih.__interfaces__=[ln],Ih.updateTextureOfLimitedResourceSprite=function(t,e,i,n,r,s){if(t<=1e-7)s.texture=null!=r?r[i/100*r.length|0]:n[n.length-1];else{var o=Math.floor((e-t)/e*n.length);e!=t&&0==o&&1<n.length&&(o=1),s.texture=n[o]}},Ih.updateRegrow=function(t,e,i){if(t.materialsLeft<=0){var n=i.simulation.time.timeSinceStart/60%24;if((r=7)<(s=20)?r<=n&&n<s:r<=n||n<s)t.regrowProgress+=t.get_regrowSpeed()*e;else{var r,s;n=i.simulation.time.timeSinceStart/60%24;((r=6)<(s=21)?r<=n&&n<s:r<=n||n<s)&&(t.regrowProgress+=t.get_regrowSpeed()*e*.5)}100<=t.regrowProgress&&(t.materialsLeft=t.initialMaterials,t.regrowProgress=0),t.updateTexture()}},Ih.__super__=E,Ih.prototype=e(E.prototype,{get_destroyedOnEmpty:function(){return!0},get_doNotGather:function(){return!1},get_resourceName:function(){return""},get_regrowSpeed:function(){return 0},get_stayIfEmpty:function(){return!1},postLoad:function(){this.updateTexture()},update:function(t){E.prototype.update.call(this,t);var e=this.city;if(this.materialsLeft<=0){var i=e.simulation.time.timeSinceStart/60%24;if((n=7)<(r=20)?n<=i&&i<r:n<=i||i<r)this.regrowProgress+=this.get_regrowSpeed()*t;else{var n,r;i=e.simulation.time.timeSinceStart/60%24;((n=6)<(r=21)?n<=i&&i<r:n<=i||i<r)&&(this.regrowProgress+=this.get_regrowSpeed()*t*.5)}100<=this.regrowProgress&&(this.materialsLeft=this.initialMaterials,this.regrowProgress=0),this.updateTexture()}},updateTexture:function(){var t=this.materialsLeft,e=this.initialMaterials,i=this.textures,n=this.regrowTextures,r=this.sprite;if(t<=1e-7)r.texture=null!=n?n[this.regrowProgress/100*n.length|0]:i[i.length-1];else{var s=Math.floor((e-t)/e*i.length);e!=t&&0==s&&1<i.length&&(s=1),r.texture=i[s]}},addWindowInfoLines:function(){var t=this;E.prototype.addWindowInfoLines.call(this),this.city.gui.windowAddInfoText(null,function(){return t.materialsLeft<=0?Tr.lo("pct_grown",[0|t.regrowProgress]):Tr.lo("pct_left",[0|t.materialsLeft,t.initialMaterials,t.get_resourceName()])})},save:function(t,e){null==e&&(e=!0),E.prototype.save.call(this,t),e&&t.addString(Ih.saveDefinition);var i=this.materialsLeft;if(t.size+8>t.bytes.length){var n=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+8))),t.bytes.blit(0,n,0,t.size)}t.bytes.setDouble(t.size,i),t.size+=8;i=this.regrowProgress;if(t.size+8>t.bytes.length){n=t.bytes;t.bytes=new Do(new ArrayBuffer(2*(t.size+8))),t.bytes.blit(0,n,0,t.size)}t.bytes.setDouble(t.size,i),t.size+=8},load:function(t,e){E.prototype.load.call(this,t),null==e&&(e=t.readString());var i=Dr.makeLoadMap(e,t);Object.prototype.hasOwnProperty.call(i.h,"materialsLeft")&&(this.materialsLeft=i.h.materialsLeft),Object.prototype.hasOwnProperty.call(i.h,"regrowProgress")&&(this.regrowProgress=i.h.regrowProgress),this.postLoad()},__class__:Ih});var Ph=function(t,e,i,n,r,s,o,a,l,h){null==h&&(h="spr_forest_grow"),null==l&&(l=200),null==a&&(a="spr_forest"),Ih.call(this,t,e,i,n,r,s,o,a,l,h),this.managementMode=Oh.CutDownAndRegrow};(q["worldResources.Forest"]=Ph).__name__="worldResources.Forest",Ph.__super__=Ih,Ph.prototype=e(Ih.prototype,{get_name:function(){return Tr.lo("forest")},get_resourceName:function(){return"wood"},get_regrowSpeed:function(){return.003},get_destroyedOnEmpty:function(){return this.managementMode==Oh.CutDownAndUproot},get_doNotGather:function(){return this.managementMode==Oh.Protect},get_treeClimbX:function(){return 7},get_treeClimbY:function(){return 13},setManagementMode:function(t,e){if(null==e&&(e=!1),this.managementMode=t,!e&&po.hasMultiUpgradeModeOn)for(var i=0,n=this.city.permanents;i<n.length;){var r=n[i];++i,r.is(Ph)&&r.setManagementMode(t,!0)}},createMainWindowPart:function(){var t=this,e=this.city.gui;Ih.prototype.createMainWindowPart.call(this),"en"==O.language&&(e.window.minWidth=235);var i=po.createHeader(e,Tr.lo("forest_management"));po.addOneAndMaxButtons(e,i,function(){po.hasMultiUpgradeModeOn=!1,t.reloadWindow()},function(){po.hasMultiUpgradeModeOn=!0,t.reloadWindow()},Tr.lo("forest_management_only_this"),function(){return"---"},function(){return Tr.lo("forest_management_all")+" ("+t.city.simulation.stats.amountOfBuildingsOfType(Ph)+")."},!1),e.windowAddInfoText(po.hasMultiUpgradeModeOn?Tr.lo("forest_management_question_1")+" ":Tr.lo("forest_management_question_2")+" "),po.createActivatableButton(e,this.managementMode==Oh.CutDownAndRegrow,function(){t.setManagementMode(Oh.CutDownAndRegrow),t.reloadWindow()},Tr.lo("forest_regrow"),po.hasMultiUpgradeModeOn?Tr.lo("forest_regrow_description_1"):Tr.lo("forest_regrow_description_2")),po.createActivatableButton(e,this.managementMode==Oh.Protect,function(){t.setManagementMode(Oh.Protect),t.reloadWindow()},Tr.lo("forest_protect"),po.hasMultiUpgradeModeOn?Tr.lo("forest_protect_description_1"):Tr.lo("forest_protect_description_2")),po.createActivatableButton(e,this.managementMode==Oh.CutDownAndUproot,function(){t.setManagementMode(Oh.CutDownAndUproot),t.reloadWindow()},Tr.lo("forest_uproot"),po.hasMultiUpgradeModeOn?Tr.lo("forest_uproot_description_1"):Tr.lo("forest_uproot_description_2")),e.windowInner.addChild(new Ms(e.windowInner,new vr(2,4)))},createWindowAddBottomButtons:function(){var t=this,e=null,i=!1;e=this.city.gui.windowAddBottomButtons([{text:this.materialsLeft<=0?Tr.lo("forest_instant_uproot"):this.city.simulation.resourcePriorityManager.isPrioritized(this)?Tr.lo("prioritized"):Tr.lo("prioritize"),onHover:function(){t.materialsLeft<=0?i||t.city.gui.tooltip.setText(t,Tr.lo("forest_instant_uproot_description")):t.city.simulation.resourcePriorityManager.isPrioritized(t)?t.city.gui.tooltip.setText(t,Tr.lo("prioritize_description_1"),Tr.lo("prioritized")):t.city.gui.tooltip.setText(t,Tr.lo("prioritize_description_2"),Tr.lo("prioritize"))},action:function(){t.materialsLeft<=0?i?(t.city.gui.closeWindow(),t.destroy(),t.materialsLeft=0):(e.setText(Tr.lo("really_uproot")),i=!0):t.city.simulation.resourcePriorityManager.isPrioritized(t)?(t.city.simulation.resourcePriorityManager.deprioritize(t),e.setText(Tr.lo("prioritize"))):(t.city.simulation.resourcePriorityManager.prioritize(t),e.setText(Tr.lo("prioritized")))}}])[0];var n=this.materialsLeft<=0;e.onUpdate=function(){t.materialsLeft<=0!=n&&(t.materialsLeft<=0?(i=!1,e.setText(Tr.lo("forest_instant_uproot"))):t.city.simulation.resourcePriorityManager.isPrioritized(t)?e.setText(Tr.lo("prioritize")):e.setText(Tr.lo("prioritized")),n=t.materialsLeft<=0)}},save:function(t,e){null==e&&(e=!0),Ih.prototype.save.call(this,t),e&&t.addString(Ph.saveDefinition);var i=this.managementMode;t.addString(T[i.__enum__].__constructs__[i._hx_index])},load:function(t,e){Ih.prototype.load.call(this,t),null==e&&(e=t.readString());var i=Dr.makeLoadMap(e,t);Object.prototype.hasOwnProperty.call(i.h,"managementMode")&&(this.managementMode=i.h.managementMode)},__class__:Ph});function Ch(t,e,i,n,r,s,o){Ph.call(this,t,e,i,n,r,s,o,"spr_birchforest",120,"spr_pineforest_grow")}(q["worldResources.BirchForest"]=Ch).__name__="worldResources.BirchForest",Ch.__super__=Ph,Ch.prototype=e(Ph.prototype,{get_name:function(){return"Pine Forest"},get_regrowSpeed:function(){return.01},get_treeClimbX:function(){return 12},get_treeClimbY:function(){return 13},__class__:Ch});var Eh=function(t,e,i,n,r,s,o,a,l){null==l&&(l=250),null==a&&(a="spr_rock"),Ih.call(this,t,e,i,n,r,s,o,a,l),this.managementMode=Nh.Mine};(q["worldResources.Rock"]=Eh).__name__="worldResources.Rock",Eh.__super__=Ih,Eh.prototype=e(Ih.prototype,{get_name:function(){return Tr.lo("rock")},get_resourceName:function(){return"stone"},get_doNotGather:function(){return this.managementMode==Nh.Protect},setManagementMode:function(t,e){if(null==e&&(e=!1),this.managementMode=t,!e&&po.hasMultiUpgradeModeOn)for(var i=0,n=this.city.permanents;i<n.length;){var r=n[i];++i,r.is(Eh)&&r.setManagementMode(t,!0)}},createMainWindowPart:function(){var t=this,e=this.city.gui;"en"==O.language&&(e.window.minWidth=195),Ih.prototype.createMainWindowPart.call(this);var i=po.createHeader(e,Tr.lo("rock_mining"));po.addOneAndMaxButtons(e,i,function(){po.hasMultiUpgradeModeOn=!1,t.reloadWindow()},function(){po.hasMultiUpgradeModeOn=!0,t.reloadWindow()},Tr.lo("set_management_rock"),function(){return"---"},function(){return Tr.lo("set_management_all_rocks")+" ("+t.city.simulation.stats.amountOfBuildingsOfType(Eh)+")."},!1),e.windowAddInfoText(po.hasMultiUpgradeModeOn?Tr.lo("rock_management_question_1")+" ":Tr.lo("rock_management_question_2")+" "),po.createActivatableButton(e,this.managementMode==Nh.Mine,function(){t.setManagementMode(Nh.Mine),t.reloadWindow()},Tr.lo("rock_management_mine"),po.hasMultiUpgradeModeOn?Tr.lo("rock_management_mine_description_1"):Tr.lo("rock_management_mine_description_2")),po.createActivatableButton(e,this.managementMode==Nh.Protect,function(){t.setManagementMode(Nh.Protect),t.reloadWindow()},Tr.lo("forest_protect"),po.hasMultiUpgradeModeOn?Tr.lo("rock_management_protect_description_1"):Tr.lo("rock_management_protect_description_2")),e.windowInner.addChild(new Ms(e.windowInner,new vr(2,4)))},createWindowAddBottomButtons:function(){var t=this,e=null;e=this.city.gui.windowAddBottomButtons([{text:this.city.simulation.resourcePriorityManager.isPrioritized(this)?Tr.lo("prioritized"):Tr.lo("prioritize"),onHover:function(){t.city.simulation.resourcePriorityManager.isPrioritized(t)?t.city.gui.tooltip.setText(t,Tr.lo("rock_prioritized_description"),Tr.lo("prioritized")):t.city.gui.tooltip.setText(t,Tr.lo("rock_prioritized_description_2"),Tr.lo("prioritize"))},action:function(){t.city.simulation.resourcePriorityManager.isPrioritized(t)?(t.city.simulation.resourcePriorityManager.deprioritize(t),e.setText(Tr.lo("prioritize"))):(t.city.simulation.resourcePriorityManager.prioritize(t),e.setText(Tr.lo("prioritized")))}}])[0]},save:function(t,e){null==e&&(e=!0),Ih.prototype.save.call(this,t),e&&t.addString(Eh.saveDefinition);var i=this.managementMode;t.addString(T[i.__enum__].__constructs__[i._hx_index])},load:function(t,e){if(Ih.prototype.load.call(this,t),!(t.version<39)){null==e&&(e=t.readString());var i=Dr.makeLoadMap(e,t);Object.prototype.hasOwnProperty.call(i.h,"managementMode")&&(this.managementMode=i.h.managementMode)}},__class__:Eh});function Ah(t,e,i,n,r,s,o){Eh.call(this,t,e,i,n,r,s,o,"spr_boulder",200)}(q["worldResources.Boulder"]=Ah).__name__="worldResources.Boulder",Ah.__super__=Eh,Ah.prototype=e(Eh.prototype,{get_name:function(){return"Boulder"},createMainWindowPart:function(){this.city.gui.windowAddInfoText("Texture by DT from the Discord, who won the first art contest!"),this.city.gui.windowInner.addChild(new Ms(this.city.gui.windowInner,new vr(2,4))),Eh.prototype.createMainWindowPart.call(this)},__class__:Ah});function Mh(t,e,i,n,r,s,o){Ph.call(this,t,e,i,n,r,s,o,"spr_forest_branches",200,"spr_forest_branches_grow")}(q["worldResources.BranchyForest"]=Mh).__name__="worldResources.BranchyForest",Mh.__super__=Ph,Mh.prototype=e(Ph.prototype,{get_name:function(){return Tr.lo("buildableWorldResourcesInfo.json/BranchyForest.name")},get_regrowSpeed:function(){return.005},get_treeClimbX:function(){return 16},get_treeClimbY:function(){return 12},createMainWindowPart:function(){this.city.gui.windowAddInfoText("Texture by DT from the Discord, who won the first art contest!"),this.city.gui.windowInner.addChild(new Ms(this.city.gui.windowInner,new vr(2,4))),Ph.prototype.createMainWindowPart.call(this)},__class__:Mh});var Bh=function(t,e,i,n,r,s,o){Th.call(this,t,e,i,n,r,s,o,"spr_alienruins_3")};(q["worldResources.ComputerAlienRuins"]=Bh).__name__="worldResources.ComputerAlienRuins",Bh.__super__=Th,Bh.prototype=e(Th.prototype,{get_climbX:function(){return 9},get_climbY:function(){return 15},getBonuses:function(t){function e(t,e,i){return{name:t,description:e,onGet:function(){s.city.materials.add(i),i.addToProduction(s.city.simulation.stats)}}}var i,n,r,s=this;switch(t){case 0:return[e(Tr.lo("alien_ruins_find_1e"),Tr.lo("alien_ruins_description_1e"),new L(0,35))];case 1:return[e(Tr.lo("alien_ruins_find_2e"),Tr.lo("alien_ruins_description_2e"),new L(0,0,55))];case 2:return[e(Tr.lo("alien_ruins_find_3e"),Tr.lo("alien_ruins_description_3e"),new L(0,0,0,7))];case 3:return[(i=Tr.lo("alien_ruins_find_4e"),n=Tr.lo("alien_ruins_description_4e"),r=function(){},{name:i,description:n,onGet:r})];default:return[]}},__class__:Bh});function Rh(t,e,i,n,r,s,o){Ph.call(this,t,e,i,n,r,s,o,"spr_forest_snow",200,"spr_forest_snow_grow")}var Oh=T["worldResources.ForestManagementMode"]={__ename__:"worldResources.ForestManagementMode",__constructs__:["CutDownAndRegrow","Protect","CutDownAndUproot"],CutDownAndRegrow:{_hx_index:0,__enum__:"worldResources.ForestManagementMode",toString:i},Protect:{_hx_index:1,__enum__:"worldResources.ForestManagementMode",toString:i},CutDownAndUproot:{_hx_index:2,__enum__:"worldResources.ForestManagementMode",toString:i}};(q["worldResources.ForestSnow"]=Rh).__name__="worldResources.ForestSnow",Rh.__super__=Ph,Rh.prototype=e(Ph.prototype,{get_name:function(){return Tr.lo("forest")},__class__:Rh});function kh(t,e,i,n,r,s,o){Ph.call(this,t,e,i,n,r,s,o,"spr_pineforest",200,"spr_pineforest_grow")}(q["worldResources.PineForest"]=kh).__name__="worldResources.PineForest",kh.__super__=Ph,kh.prototype=e(Ph.prototype,{get_name:function(){return Tr.lo("pine_forest")},get_regrowSpeed:function(){return.005},get_treeClimbX:function(){return 15},get_treeClimbY:function(){return 3},__class__:kh});var Dh=function(t,e,i,n,r,s,o){Ph.call(this,t,e,i,n,r,s,o,"spr_purpleforest",200,"spr_purpleforest_grow")};(q["worldResources.PurpleForest"]=Dh).__name__="worldResources.PurpleForest",Dh.__super__=Ph,Dh.prototype=e(Ph.prototype,{get_name:function(){return Tr.lo("forest")},get_regrowSpeed:function(){return.005},get_treeClimbX:function(){return 16},get_treeClimbY:function(){return 12},__class__:Dh});var Fh=function(t,e,i,n,r,s,o){Ph.call(this,t,e,i,n,r,s,o,"spr_redforest",200,"spr_redforest_grow")};(q["worldResources.RedForest"]=Fh).__name__="worldResources.RedForest",Fh.__super__=Ph,Fh.prototype=e(Ph.prototype,{get_name:function(){return Tr.lo("forest")},get_regrowSpeed:function(){return.005},get_treeClimbX:function(){return 16},get_treeClimbY:function(){return 12},__class__:Fh});var Nh=T["worldResources.RockManagementMode"]={__ename__:"worldResources.RockManagementMode",__constructs__:["Mine","Protect"],Mine:{_hx_index:0,__enum__:"worldResources.RockManagementMode",toString:i},Protect:{_hx_index:1,__enum__:"worldResources.RockManagementMode",toString:i}};function Lh(t){return t instanceof Array?new qo(t):t.iterator()}function Uh(t,e){return null==e?null:(null==e.__id__&&(e.__id__=u.$haxeUID++),null==t.hx__closures__?t.hx__closures__={}:i=t.hx__closures__[e.__id__],null==i&&(i=e.bind(t),t.hx__closures__[e.__id__]=i),i);var i}u.$haxeUID|=0,"undefined"!=typeof performance&&"function"==typeof performance.now&&(at.now=performance.now.bind(performance)),q.Math=Math,null==String.fromCodePoint&&(String.fromCodePoint=function(t){return t<65536?String.fromCharCode(t):String.fromCharCode(55232+(t>>10))+String.fromCharCode(56320+(1023&t))}),String.prototype.__class__=q.String=String,String.__name__="String",q.Array=Array,Array.__name__="Array",Date.prototype.__class__=q.Date=Date,Date.__name__="Date";var zh,Wh={},Gh={},Hh=Number,Xh=Boolean,jh={},Vh={};jo.count=0,Ko.__toStr={}.toString,S.enabled=!1,S.enabledFirebase=!1,S.ready=!1,S.useAltEarlyGame=!1,S.sessionTime=0,S.reportedLongPlaytime=!1,S.didABTest=!1,S.capturedErrors=[],S.errorsReported=0,L.saveDefinition="wood$Float|stone$Float|food$Float|machineParts$Float|knowledge$Float|refinedMetal$Float|computerChips$Float|graphene$Float|rocketFuel$Float|cacao$Float|chocolate$Float",U.floatingPlatformCost=new L(0,0,0,100,0,0,0,0,0,10),y.width=20,y.height=20,y.destroyingForReplacement=!1,y.destroyingDisableMoveDown=!1,y.saveDefinition="",_.spriteName="",s.saveDefinition="spriteIndex$Int",K.spriteCitizens=new jo,K.shouldUpdateDraw=!1,K.saveDefinition="hasBuildingInited$Bool|spriteIndex$Int|relativeX$Float|bornOn$Float|currentAction$Int|hasWorkTools$Bool|lastInfrequentUpdateAge$Float|dieAgeModifier$Float|educationLevel$Float|actualWorkTimePreference$Float",x.saveDefinition="maxPermanentID$Int|viewPos$FPoint|zoomScale$Float|cityMainFile$String|cityName$String|subCities$ds|possibleSubCities$ds",h.saveDefinition="timeSinceStart$Float",B.isAdsTest=!1,B.isMoreAdsTest=!1,B.enableCheats=!0,B.earlyGameFix1=!0,B.earlyGameFix2=!1,B.isLimitedDemo=!1,B.splashScreenDone=!1,B.hasFullscreen=!1,B.canBeMobile=!0,B.mobileTrailerMode=!1,B.mobileTrailerModeMultiplier=2,B.iosMobileScreenshotMode=!1,B.forceMobile=B.mobileTrailerMode,B.isSnowThemed=!1,B.noInputYet=!0,B.hadFullStepWithInput=!1,B.lastInput=0,B.cheatSpeedEnabled=!1,p.closeButtonEnabled=!0,g.isLoading=!1,f.mobileBackPressed=!1,A.scalingMod=0,A.isMobile=!1,A.isLargeMobile=!1,A.isCanvasRenderer=!1,M.fireBaseReportScale=0,ct.materialNames=["food","wood","stone","machineParts","refinedMetal","computerChips","cacao","chocolate","graphene","rocketFuel","knowledge"],ct.modMaterials=[],ct.productionReasons=[[],[],[],[],[],[],[],[],[],[]],w.MEASUREMENT_INTERVAL=1e3,w.FONT_FAMILY="Helvetica,Arial",w.FPS_BG_CLR="#00FF00",w.FPS_WARN_BG_CLR="#FF8000",w.FPS_PROB_BG_CLR="#FF0000",w.MS_BG_CLR="#FFFF00",w.MEM_BG_CLR="#086A87",w.INFO_BG_CLR="#00FFFF",w.FPS_TXT_CLR="#000000",w.MS_TXT_CLR="#000000",w.MEM_TXT_CLR="#FFFFFF",w.INFO_TXT_CLR="#000000",w.TOP_LEFT="TL",w.TOP_RIGHT="TR",w.BOTTOM_LEFT="BL",w.BOTTOM_RIGHT="BR",w.DELAY_TIME=4e3,ht.buildingClassesNumber=0,ht.registeredClassNames=new Vo,dt.storiesInfo=new Vo,dt.bridgesInfo=[],dt.singleTextureCache=new Vo,dt.multiTextureCache=new Vo,dt.multiTextureCache2=new Vo,dt.citizenNames=[],O.settingsLoaded=!1,O.musicOn=!0,O.soundOn=!0,O.fullscreen=!1,O.musicVolume=1,O.soundVolume=1,O.boostHidden=!1,O.colorBlindMode=!1,O.allowMoreZoom=!1,O.language="en",O.secretCodesEnabled=[],O.pathfindingWorkers=-1,O.euAdConsentStatus=-1,O.compatDisableMasking=!1,O.disableClouds=!1,O.disablePlanets=!1,z.stoneBoost=.3,G.entertainmentBoost=40,H.stoneBoost=.2,nt.efficiencyMod=2,nt.extraChipsPerStepPerWorker=5e-5,gt.extraFoodPerHarvest=7.5,yt.stoneBoost=.3,_t.extraChipsPerStepPerWorker=625e-7,Tt.efficiencyMod=1,It.efficiencyMod=2,It.extraMachinePartsMadePerStepPerWorker=.0015,kt.extraYearsPerYear=.05,Ft.stoneBoost=.3,Nt.efficiencyMod=1,Nt.extraRFPerStepPerWorker=15e-5,Lt.efficiencyMod=1,Lt.extraRefinedMetalsMadePerWorker=5e-4,zt.efficiencyMod=.5,zt.extraFuelPerStepPerWorker=5e-4,$t.growthSpeedBoost=.2,Qt.efficiencyMod=.058,te.spriteName="spr_aliendecryptor",te.saveDefinition="timeWorking$Float",ie.spriteName="spr_alienfarm",ie.foodPerHarvest=20,ie.growSpeed=2,ie.harvestAmount=.3,ie.cleanSpeed=5,ie.passiveGrowSpeed=.05,ie.passiveGrowSpeedBadLight=.025,ie.saveDefinition="farmStage$Int|percentGrown$Float|foodLeft$Float|percentCleaned$Float",se.spriteName="spr_alienhouse",ae.spriteName="spr_aliennightclub",ae.laserMinXWithLeft=1,ae.laserMinX=6,ae.laserMaxX=18,ae.laserMaxY=18,ae.closeTime=6,ae.saveDefinition="",he.spriteName="spr_aquarium",he.gardenTextureSets=[1],he.openTime=5,he.closeTime=23.5,he.saveDefinition="currentTexture$Int",ue.spriteName="spr_arcade",ue.closeTime=23,ue.saveDefinition="",de.spriteName="spr_artcolony",de.progressPerStep=2e-5,de.unlockNewWorkAfter=[4,7,8,10,13,13],de.openTime=15,de.closeTime=21.5,de.saveDefinition="currentTexture$Int|currentWorkProgress$Float",pe.spriteName="spr_beacon",pe.saveDefinition="",fe.spriteName="spr_blossomhippiehq",fe.lastMission=8,fe.saveDefinition="lastEventDoneOnDay$Int|doingEvent$Int|eventPhase$Int|currentMission$Int",ge.spriteName="spr_bloomrestaurant",me.spriteName="spr_bloomrestaurant",me.closeTime=.5,ye.workToolsX=4,ye.workToolsTime=20,_e.spriteName="spr_boardgamestore",_e.closeTime=23,_e.firstFloorChairs=[4,12],_e.saveDefinition="",be.spriteName="spr_botanicalgardens",be.gardenTextureSets=[2,3,2,4,2,2],be.openTime=6,be.closeTime=22,be.saveDefinition="currentMainTexture$Int|currentTexture$Int",we.mainTexturesNonDome=["spr_botanicalgardens","spr_indoorpark","spr_indoorpark_alt1"],we.gardenTextureSets=[2,3,2,4,2,2],we.spriteName="spr_dome_botanicalgarden",we.saveDefinition="currentDomeVersion$Int",Se.spriteName="spr_cacaofarm",Se.foodPerHarvest=35,Se.growSpeed=.75,Se.harvestAmount=.025,Se.passiveGrowSpeed=.012,Se.passiveGrowSpeedBadLight=.006,Se.saveDefinition="farmStage$buildings.CacaoFarmStage|percentGrown$Float|foodLeft$Float|percentCleaned$Float",Te.spriteName="spr_carrotjuicebar",Te.closeTime=4.5,Ie.timePerFrame=4,Pe.saveDefinition="totalMaterialUsed$Float|materialMade$Float",Ce.spriteName="spr_chocolatefactory",Ce.saveDefinition="",Ee.spriteName="spr_christmasmarket",Ee.closeTime=4.5,Ee.saveDefinition="",Ae.spriteName="spr_botanicalgardens",Ae.mainTextures=["spr_botanicalgardens","spr_indoorpark","spr_indoorpark_alt1"],Ae.openTime=6,Ae.closeTime=22,Ae.saveDefinition="currentTexture$Int|currentMainTexture$Int",Me.spriteName="spr_botanicalgardens",Me.openTime=0,Me.closeTime=23.5,Me.saveDefinition="",Be.spriteName="spr_cityhall",Be.saveDefinition="totalKnowledgeGenerated$Float",ke.spriteName="spr_coloredblock",ke.saveDefinition="currentTexture$Int|currentRecolor$Int",De.spriteName="spr_comfortablehouse",Fe.spriteName="spr_computerchipfactory",Fe.saveDefinition="",Ne.spriteName="spr_computerresearchcenter",Ne.knowledgePerStep=.0014,Ne.saveDefinition="totalKnowledgeGenerated$Float",Le.spriteName="spr_cuttingedgehome",Ue.spriteName="spr_ecofarm",Ue.openTime=12,Ue.closeTime=20.5,Ue.crop2Sprites=["spr_ecofarm_crop2","spr_ecofarm_crop2_alt","spr_ecofarm_crop2_alt2"],Ue.crop3Sprites=["spr_ecofarm_crop3","spr_ecofarm_crop3_alt"],Ue.saveDefinition="openDay$Int|crop2Sprite$Int|crop3Sprite$Int",ze.spriteName="spr_labescaperoom",ze.closeTime=23.99,ze.maxVisitors=10,ze.saveDefinition="",Ge.spriteName="spr_experimentalfarm",Ge.indoorFarmSpeedIncrease=.1,Ge.saveDefinition="",He.spriteName="spr_experimentationlab",He.saveDefinition="",Xe.spriteName="spr_explorationcentre",Xe.explorePerAction=.25,Xe.knowledgePerExploreAction=.25,Xe.knowledgePerStep=.001,Ve.spriteName="spr_refinedmetalfactory",Ve.originalEfficiency=5,Ve.origMaterialsMadePerStepPerWorker=.001,Ve.saveDefinition="",Ye.spriteName="spr_refinedmetalfactorypub",Ye.closeTime=4.5,Ye.saveDefinition="",qe.spriteName="spr_farmbyproductprocessor",qe.woodPerFarm=.0014,qe.saveDefinition="woodMade$Float",Ke.saveDefinition="farmStage$Int|percentGrown$Float|foodLeft$Float|originalFoodLeft$Float|percentCleaned$Float",$e.spriteName="spr_farmhouse",$e.saveDefinition="stageProgress$Float|materialPhase$Int|totalMaterialsProduced$Float",Qe.wantsToDoTripAt=5,Qe.lastMission=8,Qe.spriteName="spr_featheralliance",Qe.saveDefinition="currentMission$Int",Je.spriteName="spr_festivalhq",Je.saveDefinition="festivalCoolDown$Float",Ze.spriteName="spr_flowerpenthouse",Ze.saveDefinition="mirrored$Bool|timesUsed$Int|timesUsedTo$Int",ti.spriteName="spr_fossilmuseum",ti.knowledgePerStepPerFossil=.001,ti.closeTime=23,ti.educationPerDay=.035,ti.educationCap=1.61,ti.saveDefinition="totalKnowledgeGenerated$Float",ii.spriteName="spr_futuristichome",ii.educationPerDay=.005,ii.educationCap=1.2,ii.saveDefinition="mirrored$Bool|interior$Int",ni.spriteName="spr_indoorfarm",ni.saveDefinition="currentTexture$Int",ri.spriteName="spr_graphenefactory",ri.saveDefinition="totalStoneUsed$Float|totalKnowledgeUsed$Float|materialMade$Float",si.spriteName="spr_grapheneresearchcenter",si.stoneUsePerGrapheneSheet=2,si.grapheneSheetsPerAction=.0015,si.knowledgePerAction=.0375,si.saveDefinition="totalKnowledgeGenerated$Float|totalStoneUsed$Float|totalGrapheneProduced$Float",oi.spriteName="spr_hackerhq",oi.lastMission=11,oi.walkAroundPositions=[3,9,12,13],oi.saveDefinition="lastEventDoneOnDay$Int|doingEvent$Int|eventPhase$Int|currentMission$Int",ai.spriteName="spr_herbgarden",ai.saveDefinition="currentTexture$Int",li.spriteName="spr_tech_nightclub",li.closeTime=6,li.saveDefinition="",hi.spriteName="spr_hologamehall",hi.openTime=12,hi.closeTime=2,hi.monsterSize=14,hi.boosterSpriteSize=9,ui.spriteName="spr_houseofthekeyfriends",ci.spriteName="spr_hyperelevator",ci.closeDoorSpeed=.5,ci.openDoorSpeed=.5,ci.doorOpenTime=45,ci.saveDefinition="timesUsed$Int|timesUsedTo$Int",di.spriteName="spr_indoorfarm",di.foodPerHarvest=25,di.growSpeed=1.35,di.harvestAmount=.25,di.cleanSpeed=5,di.passiveGrowSpeed=.03,di.passiveGrowSpeedBadLight=.015,di.saveDefinition="farmStage$Int|percentGrown$Float|foodLeft$Float|percentCleaned$Float",pi.spriteName="spr_intergalacticlibrary",pi.closeTime=23,pi.educationPerDay=.033,pi.educationCap=1.81,pi.knowledgePerPerson=.05,pi.saveDefinition="knowledgeSoFar$Float",fi.spriteName="spr_laboratory",fi.knowledgePerStep=.00125,fi.firstScientistX=5,fi.secondScientistX=13,fi.scientistY=9,fi.saveDefinition="totalKnowledgeGenerated$Float",gi.spriteName="spr_explorationship",gi.saveDefinition="mirrored$Bool",mi.spriteName="spr_landingplace",mi.flyingSpeed=3,mi.flyingSpeedForPathCalculations=1.5,mi.gettingNewFlyingSaucerStageNumber=16,mi.yChangePerNewGetStep=.25,mi.maxTimeUntilCanGetNewFlyingSaucer=30,mi.numberOfFlyingSaucerTypes=6,mi.saveDefinition="timesUsed$Int|timesUsedTo$Int|timesUsedStopOver$Int|saucerType$Int",yi.spriteName="spr_landingpad_tunnel",_i.spriteName="spr_library",_i.closeTime=22,_i.educationPerDay=.025,_i.educationCap=1.5,_i.saveDefinition="",vi.spriteName="spr_livingresearchcenter",vi.knowledgePerWalk=.10799999999999998,vi.saveDefinition="totalKnowledgeGenerated$Float",bi.spriteName="spr_loft",bi.openTime=12,bi.closeTime=20.5,bi.saveDefinition="mirrored$Bool|interior$Int",wi.spriteName="spr_luxuryrestaurant",wi.closeTime=.5,Si.spriteName="spr_machinepartsfactory",Si.saveDefinition="",xi.spriteName="spr_mansion",xi.educationPerDay=.01,xi.educationCap=1.25,xi.saveDefinition="timesUsed$Int|timesUsedTo$Int",Ti.spriteName="spr_mechanicalhouse",Ti.ifMachinePartsFactoryBonus=50,Ii.spriteName="spr_medicalclinic",Ci.spriteName="spr_misdirector",Ci.normalKnowledgeProduction=.5,Ci.reducedKnowledgeProduction=.05,Ci.saveDefinition="knowledgeGenerated$Float|timesUsedTo$Int",Ei.spriteName="spr_modernartmuseum",Ei.closeTime=21.5,Ei.saveDefinition="currentTexture$Int",Ai.spriteName="spr_modernrustichome",Mi.spriteName="spr_nightclub",Mi.laserMinXWithLeft=1,Mi.laserMinX=6,Mi.laserMaxX=18,Mi.laserMaxY=18,Mi.closeTime=6,Mi.nightClubColorOptions=5,Mi.saveDefinition="nightClubColor$Int",Bi.spriteName="spr_normalhouse",Bi.saveDefinition="doorMainTexture$Int",Ri.spriteName="spr_observatory",Ri.knowledgePerStep=.002,Ri.starDatabaseUpgradeAmount=1.5,Ri.starDatabaseAndUniverseDBUpgradeAmount=6,Ri.saveDefinition="totalKnowledgeGenerated$Float",Oi.spriteName="spr_botanicalgardens",Oi.openTime=0,Oi.closeTime=23.5,Oi.saveDefinition="totalExtraYears$Float",ki.spriteName="spr_botanicalgardens",ki.saveDefinition="",Di.spriteName="spr_outposthouse",Fi.spriteName="spr_botanicalgardens",Fi.mainTextures=["spr_botanicalgardens","spr_indoorpark","spr_indoorpark_alt1"],Fi.saveDefinition="currentTexture$Int|currentMainTexture$Int",Ni.spriteName="spr_pub",Ni.closeTime=4.5,Ni.saveDefinition="markingTexture$String",Li.spriteName="spr_redwood",Li.openTime=5,Li.closeTime=23.5,Li.saveDefinition="lastExpanded$Float|subImageIfRelevant$Int|isPrimary$Bool|hasGrass$Bool",Ui.spriteName="spr_redwoodtreehouse",zi.spriteName="spr_researchbot_landingplace",zi.knowledgePerStep=.00125,zi.hSpeed=3,zi.vSpeed=3,zi.saveDefinition="flying$Bool|returning$Bool|flyingSaucerXProg$Float|flyingSaucerXI$Int|flyingSaucerY$Float|flyingSaucerTargetX$Int|waiting$Float|timeWorking$Float",Wi.spriteName="spr_restaurant",Wi.closeTime=.5,Gi.spriteName="spr_rocketfuelfactory",Gi.originalEfficiency=1,Gi.origMaterialsMadePerStepPerWorker=.001,Gi.saveDefinition="currentMaterialUsed$Int",Xi.spriteName="spr_slantedroof",Xi.saveDefinition="mirrored$Bool|currentTexture$Int|currentRecolor$Int",ji.spriteName="spr_slantedrooftop",ji.saveDefinition="mirrored$Bool|currentTexture$Int|currentRecolor$Int",Vi.spriteName="spr_domeroof",Vi.saveDefinition="mirrored$Bool|currentTexture$Int|currentRecolor$Int",Yi.spriteName="spr_roofbottom",Yi.saveDefinition="mirrored$Bool|currentTexture$Int|currentRecolor$Int",qi.spriteName="spr_rooftoppark",qi.openTime=6,qi.closeTime=22,qi.saveDefinition="currentTexture$Int",Ki.spriteName="spr_school",$i.spriteName="spr_scrapyardnightclub",$i.closeTime=6,$i.saveDefinition="mainTextureLeft$Int|mainTextureOther$Int",Qi.spriteName="spr_secretsocietyhouse",Qi.lastMission=8,Qi.saveDefinition="lastEventDoneOnDay$Int|doingEvent$Int|eventPhase$Int|currentMission$Int",Ji.spriteName="spr_shadyhouse",Zi.spriteName="spr_landingpad_tunnel",tn.spriteName="spr_spacioushouse",en.spriteName="spr_advancedmedicalclinic",nn.spriteName="spr_botanicalgardens",nn.saveDefinition="mirrored$Bool",rn.spriteName="spr_botanicalgardens",rn.openTime=0,rn.closeTime=23.5,rn.saveDefinition="",sn.spriteName="spr_botanicalgardens",sn.openTime=0,sn.closeTime=23.5,sn.saveDefinition="",on.spriteName="spr_stonemine",on.normalStoneMinedPerAction=.2,on.stoneMineTimeMin=90,on.stoneMineTimeMax=120,an.spriteName="spr_stoneresearchcentre",an.bonusDivider=200,an.bonusMultiplier=.075,an.bonusMultiplierStart=.15,an.bonusLogFactor=2,an.bonusDividerPT=195,an.bonusMultiplierPT=.1,an.bonusLogFactorPT=1.65,an.linearBonusFactorPT=25e-6,an.saveDefinition="totalKnowledgeGenerated$Float",hn.spriteName="spr_stoneteleporter",hn.bigStoneInitialMaterials=150,hn.fossilChancePerIM=1e-5,hn.saveDefinition="regrowProgress$Float|materialsLeft$Float|hasBigStone$Bool",un.spriteName="spr_supercomputer",un.knowledgePerDayPerEmployee=2,un.saveDefinition="knowledgeSoFar$Float",cn.spriteName="spr_techmuseum",cn.closeTime=22,cn.educationPerDay=.025,cn.educationCap=1.55,cn.mainTextureOptions=["spr_techmuseum_majordisplay_1","spr_techmuseum_majordisplay_2"],cn.saveDefinition="mainTexture$Int|secondTexture$Int|thirdTexture$Int",dn.spriteName="spr_teleporter",dn.saveDefinition="timesUsed$Int|timesUsedTo$Int",pn.spriteName="spr_contraption",fn.spriteName="spr_secretsocietymachine",fn.saveDefinition="animProgress$Float|lastDayReward$Int|thisDayMaterialReward$ds|totalMaterialReward$ds",gn.spriteName="spr_tinkerershouse",gn.educationPerDay=.01,gn.educationCap=1.25,gn.saveDefinition="frontTextureUsed$Int|backTextureUsed$Int",yn.saveDefinition=mn.saveDefinition="",_n.spriteName="spr_bloomrestaurant",vn.spriteName="spr_treeplantation",vn.workerRegrowBoost=.5,vn.growWaitTimeMin=120,vn.growWaitTimeMax=180,vn.saveDefinition="regrowProgress$Float|materialsLeft$Float",bn.spriteName="spr_dome_treeplantation",wn.spriteName="spr_aquarium",Sn.spriteName="spr_unknownbuilding",xn.spriteName="spr_villa",xn.saveDefinition="timesUsed$Int|timesUsedTo$Int",Tn.spriteName="spr_wizardhatcafe",Tn.closeTime=.5,Tn.saveDefinition="mirrored$Bool",In.spriteName="spr_woodcuttingcentre",In.woodCutPerAction=.2,In.woodCutTimeMin=60,In.woodCutTimeMax=90,Pn.spriteName="spr_workshop",Pn.materialsMadePerWalkPerWorker=.075,Pn.woodToMachinePartsEfficiency=2,Pn.knowledgePerWalk=.15,Pn.machinePartsFactorySpeedIncrease=1.25,Pn.saveDefinition="materialMade$Float|totalMaterialUsed$Float|totalKnowledgeGenerated$Float",jn.saveDefinition="",dr.achievementsAreEnabled=!0,pr.adExpireTime=18e3,pr.noAdShown=!0,pr.adExpireTimeRewarded=0,pr.adCapRemaining=1e6,pr.initialWaitTime=120,pr.knownNotInEU=!1,pr.showEUConsent=0,pr.minTimeBetweenRewarded=18e3,pr.standardAdExpireTime=18e3,xr.highestHappinessReported=0,xr.highestHappinessKnown=0,xr.statTimeout=0,xr.kongJSLoaded=!1,Tr.defaultLocalizations=new Vo,Tr.localizations=new Vo,Cr.lastPlannedUnfocusOn=-1,Er.frameTimeValues=[],Er.previousTime=0,Er.isDrawingFPSCurrently=!1,Mr.isAdBlockEnabled=!1,Rr.knowsSupport=!1,Rr.hasSupport=!1,Wr.texturesMeta=[0,0,0,1,2,3,1,2,3,1,4,3,1,4,5,6,3,7,7,8,8,9,10,11,11,12,13,14,14,5,6],Wr.initedTexturesSuperMeta=!1,Xr.pool=[],ls.colorPicked=16777215,ls.colorPickedOnLastMultiMenuOpen=-1,Bs.canUndoReset=!1,Rs.onlyShowNew=!1,Ws.languages=[{code:"en",name:"English"},{code:"de",name:"Deutsch"}],Ws.languagesSecondary=[{code:"es",name:"Español"},{code:"fr",name:"Français"},{code:"pt",name:"Português"},{code:"ru",name:"Русский"},{code:"vi",name:"Tiếng Việt"}],Ys.ninePatchTextureCache=new jo,$s.maximumPopLimit=15e3,Qs.unloaded=!0,Bo.USE_CACHE=!1,Bo.USE_ENUM_INDEX=!1,Bo.BASE64="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789%:",Oo.DEFAULT_RESOLVER=new Ro,Oo.BASE64="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789%:",No.CHARS="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",No.BYTES=Do.ofString(No.CHARS),ra.premiumInfoLoaded=!1,ra.premiumInfoLoadedStore=!1,ra.premiumInfoLoadedStorePass=!1,ra.savedPurchases=new Vo,oa.timeBeforeNextAd=7200,aa.onGlobalSaveFuncs=[],aa.onGlobalSaveFuncsEarly=[],ya.pool=[],va.saveDefinition="",ka.maxSize=20,ka.maxPoolAmount=1e4,ka.pool=((zh=[]).push([]),zh.push([]),zh.push([]),zh.push([]),zh.push([]),zh.push([]),zh.push([]),zh.push([]),zh.push([]),zh.push([]),zh.push([]),zh.push([]),zh.push([]),zh.push([]),zh.push([]),zh.push([]),zh.push([]),zh.push([]),zh.push([]),zh.push([]),zh),Fa.pool=new jo,Da.saveDefinition="subCityNames$ds|subCityPops$ds|subCitySentResources$ds|subCitySentPeople$ds|subCityMachine$ds",Xa.saveDefinition="unlimitedResources$Bool|everPlayedWithUnlimitedResources$Bool",ja.saveDefinition="",qa.saveDefinition="storyName$String|disableDying$Bool|disableDestroy$Bool|hiddenBoost$Bool|goalTimer$Float",Qa.saveDefinition="unlockState$ds|explicityLocked$ds|unlockedDecorationTab$Bool|unlockedBuildingModeButton$Bool|unlockedManagementOptions$Bool|numberOfModernArtMuseumArtworksUnlocked$Int|unlockedMaterials$ds",Ja.saveDefinition="timeUntilInvasion$Float|invasionProgress$Float|isInvasion$Bool|isInvasionFinished$Bool",Za.saveDefinition="spawnNumber$Int|nextSpawn$Float|groupSizeMin$Int|groupSizeMax$Int|ageRangeMin$Int|ageRangeMax$Int|worldID$Int|timeBetweenMin$Int|timeBetweenMax$Int|afterDoneMessage$String",rl.saveDefinition="type$Int|relativeX$Float",ol.saveDefinition="softPopLimit$Int|mode$Int|targetPopAmount$Int",al.saveDefinition="extraFoodFromFarms$Int|machinePartsFactorySpeed$Float|labSpeed$Float|indoorFarmSpeed$Float|ecoFarmSpeed$Float|fossilsCollected$Int|waldoFound$Bool",hl.enableExtraReward=!1,hl.saveDefinition="boostLeft$Float|maxBoost$Float|normalMaxBoost$Float",fl.saveDefinition="foodShortage$Float",gl.entertainmentTypeNumber=6,ml.saveDefinition="type$Int|relativeX$Float|relativeY$Float",bl.saveDefinition="relativeX$Float",xl.saveDefinition="happiness$Float|homeHappiness$Float|purposeHappiness$Float|entertainmentHappiness$Float|schoolHappiness$Float|medicalHappiness$Float|specializedMedicalHappiness$Float|fullHappinessTime$Float|overtimeUnhappinessActual$Float|overtimeStarted$Float|lastOvertime$Float|lastOvertimeDay$Float|lastRestoreTime$Float|ignoreUnhappyCitizens$Bool|actualHappiness$Float|happinessEnthusiasmLevel$Int|lastShownVeryUnhappyWarning$Int|veryUnhappyFromDay$Int",Tl.saveDefinition="boostUntil$Float|boost$Float|text$String|canGoOverMax$Bool",Il.privateTeleportersLeft=[],Cl.saveDefinition="teleportersEnabled$Bool|teleportersAreUserEnabled$Bool",Rl.saveDefinition="missionsDoneNear$Int|missionsDoneFar$Int",Dl.saveDefinition="",Nl.fromHour=0,Nl.toHour=4,Ll.fromHour=.5,Ll.toHour=4.5,Ul.fromHour=1,Ul.toHour=5,Ul.moveSpeed=.5,zl.fromHour=23,zl.toHour=5,Wl.fromHour=0,Wl.toHour=4,Wl.moveSpeed=.6666666666666666,jl.fromHour=0,jl.toHour=4,Vl.saveDefinition="timeStart$Float|timeEnd$Float|started$Bool",ql.minCitizens=100,ql.happinessBoostDuration=10080,ql.happinessBoostGiven=25,ql.citizensPerVenue=20,ql.saveDefinition="",eh.pattern_parse=new c("^(\\+|-)?(:?\\d+(\\.\\d+)?(e-?\\d+)?|nan|NaN|NAN)$",""),eh.pattern_inf=new c("^\\+?(inf|Inf|INF)$",""),eh.pattern_neg_inf=new c("^-(inf|Inf|INF)$",""),_h.whiteReference=[.95047,1,1.08883],wh.parser=new wh,wh.isPureHex=new c("^([0-9a-f]{2}){3,4}$","i"),Th.saveDefinition="explored$Float|bonusesAwarded$Int|spriteName$String",Ih.saveDefinition="materialsLeft$Float|regrowProgress$Float",Ph.saveDefinition="managementMode$worldResources.ForestManagementMode",Eh.saveDefinition="managementMode$worldResources.RockManagementMode",A.main()}("undefined"!=typeof exports?exports:"undefined"!=typeof window?window:"undefined"!=typeof self?self:this,"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this);
function B.checkSitelock() {
    console.error(":D");
}